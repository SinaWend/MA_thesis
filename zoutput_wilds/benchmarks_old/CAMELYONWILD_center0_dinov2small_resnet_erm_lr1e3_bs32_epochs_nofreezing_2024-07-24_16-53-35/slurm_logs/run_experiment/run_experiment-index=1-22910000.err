Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 24 16:58:43 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_resnet_erm_lr1e3_bs32_epochs_nofreezing_2024-07-24_16-53-35/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_resnet_erm_lr1e3_bs32_epochs_nofreezing_2024-07-24_16-53-35/rule_results/1.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910000

 Experiment start at: 2024-07-24 19:17:24.826498
before training, model accuracy: 0.3186810612678528
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9537898, 'precision': 0.9548687, 'recall': 0.9538095, 'specificity': 0.9538095, 'f1': 0.9537637, 'auroc': 0.9889035, 'binary_precision': 0.97722435, 'binary_recall': 0.92931306, 'binary_specificity': 0.978306, 'binary_f1_score': 0.9526667}
confusion matrix:
        0       1
0  135648    3008
1    9817  129063
---- Validation: 
scalar performance:
{'acc': 0.965459, 'precision': 0.9656458, 'recall': 0.9654408, 'specificity': 0.9654408, 'f1': 0.9654544, 'auroc': 0.99269325, 'binary_precision': 0.97451353, 'binary_recall': 0.95578426, 'binary_specificity': 0.97509736, 'binary_f1_score': 0.96505797}
confusion matrix:
       0      1
0  58108   1484
1   2625  56743
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9622197, 'precision': 0.96300507, 'recall': 0.9622352, 'specificity': 0.9622352, 'f1': 0.9622046, 'auroc': 0.9918821, 'binary_precision': 0.982261, 'binary_recall': 0.9414986, 'binary_specificity': 0.9829718, 'binary_f1_score': 0.96144795}
confusion matrix:
       0      1
0  20435    354
1   1218  19602
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-25 01:52:09.382853,epoch time: 6:34:44.556355,used: 6:34:44.556355,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910000
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.958146, 'precision': 0.9581614, 'recall': 0.95814836, 'specificity': 0.95814836, 'f1': 0.95814574, 'auroc': 0.9910716, 'binary_precision': 0.9610271, 'binary_recall': 0.95508975, 'binary_specificity': 0.961207, 'binary_f1_score': 0.95804924}
confusion matrix:
        0       1
0  133280    5379
1    6237  132640
---- Validation: 
scalar performance:
{'acc': 0.97468895, 'precision': 0.9748889, 'recall': 0.9746704, 'specificity': 0.9746704, 'f1': 0.97468555, 'auroc': 0.99612194, 'binary_precision': 0.98417497, 'binary_recall': 0.9647958, 'binary_specificity': 0.98454493, 'binary_f1_score': 0.9743891}
confusion matrix:
       0      1
0  58671    921
1   2090  57278
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96147466, 'precision': 0.9625907, 'recall': 0.9614931, 'specificity': 0.9614931, 'f1': 0.9614525, 'auroc': 0.98944277, 'binary_precision': 0.9854985, 'binary_recall': 0.93679154, 'binary_specificity': 0.9861946, 'binary_f1_score': 0.9605279}
confusion matrix:
       0      1
0  20502    287
1   1316  19504
better model found
persisted
after epoch: 2,now: 2024-07-25 07:49:00.141952,epoch time: 5:56:50.759099,used: 12:31:35.315454,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910000
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96272194, 'precision': 0.9635608, 'recall': 0.9627396, 'specificity': 0.9627396, 'f1': 0.9627061, 'auroc': 0.99250126, 'binary_precision': 0.98348707, 'binary_recall': 0.94130987, 'binary_specificity': 0.98416924, 'binary_f1_score': 0.9619364}
confusion matrix:
        0       1
0  136459    2195
1    8151  130731
---- Validation: 
scalar performance:
{'acc': 0.9697041, 'precision': 0.97038424, 'recall': 0.969669, 'specificity': 0.969669, 'f1': 0.9696914, 'auroc': 0.99435616, 'binary_precision': 0.9878057, 'binary_recall': 0.95103425, 'binary_specificity': 0.9883038, 'binary_f1_score': 0.9690713}
confusion matrix:
       0      1
0  58895    697
1   2907  56461
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.942176, 'precision': 0.94623065, 'recall': 0.94221157, 'specificity': 0.94221157, 'f1': 0.9420475, 'auroc': 0.9893942, 'binary_precision': 0.98895377, 'binary_recall': 0.89442843, 'binary_specificity': 0.9899947, 'binary_f1_score': 0.939319}
confusion matrix:
       0      1
0  20581    208
1   2198  18622
early stop counter: 1
val acc:0.9697040915489197, best validation acc: 0.9746889472007751, corresponding to test acc:                         0.9614746570587158 / 0.9622197151184082
after epoch: 3,now: 2024-07-25 14:20:44.699949,epoch time: 6:31:44.557997,used: 19:03:19.873451,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910000
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
slurmstepd: error: *** JOB 22910000 ON supergpu02 CANCELLED AT 2024-07-25T18:39:50 ***
