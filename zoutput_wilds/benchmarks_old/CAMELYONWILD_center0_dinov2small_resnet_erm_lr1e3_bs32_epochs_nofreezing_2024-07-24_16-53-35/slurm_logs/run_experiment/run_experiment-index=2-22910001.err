Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 24 16:58:45 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_resnet_erm_lr1e3_bs32_epochs_nofreezing_2024-07-24_16-53-35/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_resnet_erm_lr1e3_bs32_epochs_nofreezing_2024-07-24_16-53-35/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910001

 Experiment start at: 2024-07-24 19:17:25.119405
before training, model accuracy: 0.34487733244895935
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.954532, 'precision': 0.9548998, 'recall': 0.9545437, 'specificity': 0.9545437, 'f1': 0.9545237, 'auroc': 0.98959416, 'binary_precision': 0.9680392, 'binary_recall': 0.940179, 'binary_specificity': 0.9689084, 'binary_f1_score': 0.95390576}
confusion matrix:
        0       1
0  134344    4311
1    8308  130573
---- Validation: 
scalar performance:
{'acc': 0.9697882, 'precision': 0.9706181, 'recall': 0.96974933, 'specificity': 0.96974933, 'f1': 0.96977293, 'auroc': 0.9954691, 'binary_precision': 0.989916, 'binary_recall': 0.94913083, 'binary_specificity': 0.9903678, 'binary_f1_score': 0.9690945}
confusion matrix:
       0      1
0  59018    574
1   3020  56348
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9601769, 'precision': 0.9605831, 'recall': 0.96018803, 'specificity': 0.96018803, 'f1': 0.9601688, 'auroc': 0.98936456, 'binary_precision': 0.9744491, 'binary_recall': 0.9451969, 'binary_specificity': 0.9751792, 'binary_f1_score': 0.95960015}
confusion matrix:
       0      1
0  20273    516
1   1141  19679
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-25 01:31:08.355473,epoch time: 6:13:43.236068,used: 6:13:43.236068,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910001
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9604628, 'precision': 0.9606357, 'recall': 0.9604708, 'specificity': 0.9604708, 'f1': 0.96045953, 'auroc': 0.9911853, 'binary_precision': 0.96976644, 'binary_recall': 0.9506268, 'binary_specificity': 0.9703148, 'binary_f1_score': 0.96010125}
confusion matrix:
        0       1
0  134539    4116
1    6857  132024
---- Validation: 
scalar performance:
{'acc': 0.96875423, 'precision': 0.96934736, 'recall': 0.96872145, 'specificity': 0.96872145, 'f1': 0.96874267, 'auroc': 0.9934076, 'binary_precision': 0.98556846, 'binary_recall': 0.9513206, 'binary_specificity': 0.9861223, 'binary_f1_score': 0.96814173}
confusion matrix:
       0      1
0  58765    827
1   2890  56478
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94919366, 'precision': 0.95193756, 'recall': 0.9492228, 'specificity': 0.9492228, 'f1': 0.9491188, 'auroc': 0.9871209, 'binary_precision': 0.9873385, 'binary_recall': 0.9101345, 'binary_specificity': 0.9883111, 'binary_f1_score': 0.9471659}
confusion matrix:
       0      1
0  20546    243
1   1871  18949
early stop counter: 1
val acc:0.968754231929779, best validation acc: 0.9697881937026978, corresponding to test acc:                         0.9601768851280212 / 0.9601768851280212
after epoch: 2,now: 2024-07-25 07:19:22.520394,epoch time: 5:48:14.164921,used: 12:01:57.400989,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910001
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9679357, 'precision': 0.96803176, 'recall': 0.9679418, 'specificity': 0.9679418, 'f1': 0.96793437, 'auroc': 0.99406767, 'binary_precision': 0.974949, 'binary_recall': 0.9606074, 'binary_specificity': 0.97527623, 'binary_f1_score': 0.96772504}
confusion matrix:
        0       1
0  135224    3428
1    5471  133413
---- Validation: 
scalar performance:
{'acc': 0.97697544, 'precision': 0.97724634, 'recall': 0.97695374, 'specificity': 0.97695374, 'f1': 0.9769714, 'auroc': 0.99657035, 'binary_precision': 0.9881558, 'binary_recall': 0.9654359, 'binary_specificity': 0.9884716, 'binary_f1_score': 0.9766637}
confusion matrix:
       0      1
0  58905    687
1   2052  57316
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95777357, 'precision': 0.95966315, 'recall': 0.9577975, 'specificity': 0.9577975, 'f1': 0.9577317, 'auroc': 0.9896985, 'binary_precision': 0.9893218, 'binary_recall': 0.9256004, 'binary_specificity': 0.9899947, 'binary_f1_score': 0.95640093}
confusion matrix:
       0      1
0  20581    208
1   1549  19271
better model found
persisted
after epoch: 3,now: 2024-07-25 13:23:30.485429,epoch time: 6:04:07.965035,used: 18:06:05.366024,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910001
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9680726, 'precision': 0.9684392, 'recall': 0.96808416, 'specificity': 0.96808416, 'f1': 0.96806693, 'auroc': 0.99424493, 'binary_precision': 0.9817483, 'binary_recall': 0.9539318, 'binary_specificity': 0.9822365, 'binary_f1_score': 0.96764016}
confusion matrix:
        0       1
0  136192    2463
1    6398  132483
---- Validation: 
slurmstepd: error: *** JOB 22910001 ON supergpu03 CANCELLED AT 2024-07-25T18:39:50 ***
