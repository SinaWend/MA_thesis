Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 24 16:58:46 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_resnet_erm_lr1e3_bs32_epochs_nofreezing_2024-07-24_16-53-35/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_resnet_erm_lr1e3_bs32_epochs_nofreezing_2024-07-24_16-53-35/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910002

 Experiment start at: 2024-07-24 19:17:24.808731
before training, model accuracy: 0.5626667737960815
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5747831, 'precision': 0.59261125, 'recall': 0.57461, 'specificity': 0.57461, 'f1': 0.5529834, 'auroc': 0.6124947, 'binary_precision': 0.55217355, 'binary_recall': 0.79499125, 'binary_specificity': 0.3542287, 'binary_f1_score': 0.65169924}
confusion matrix:
       0       1
0  49117   89542
1  28471  110406
---- Validation: 
scalar performance:
{'acc': 0.52385676, 'precision': 0.7356385, 'recall': 0.5247475, 'specificity': 0.5247475, 'f1': 0.38731778, 'auroc': 0.7432712, 'binary_precision': 0.5117754, 'binary_recall': 0.99781024, 'binary_specificity': 0.05168479, 'binary_f1_score': 0.6765495}
confusion matrix:
      0      1
0  3080  56512
1   130  59238
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5111635, 'precision': 0.73726, 'recall': 0.5107995, 'specificity': 0.5107995, 'f1': 0.35765216, 'auroc': 0.7493458, 'binary_precision': 0.5058352, 'binary_recall': 0.99927956, 'binary_specificity': 0.022319496, 'binary_f1_score': 0.6716707}
confusion matrix:
     0      1
0  464  20325
1   15  20805
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-25 01:31:08.499872,epoch time: 6:13:43.691141,used: 6:13:43.691141,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910002
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.7066831, 'precision': 0.7350515, 'recall': 0.7065414, 'specificity': 0.7065414, 'f1': 0.69746625, 'auroc': 0.7880348, 'binary_precision': 0.6535968, 'binary_recall': 0.8805092, 'binary_specificity': 0.53257364, 'binary_f1_score': 0.75027144}
confusion matrix:
       0       1
0  73844   64811
1  16595  122286
---- Validation: 
scalar performance:
{'acc': 0.7308591, 'precision': 0.7811214, 'recall': 0.7312565, 'specificity': 0.7312565, 'f1': 0.7184867, 'auroc': 0.8576187, 'binary_precision': 0.6617809, 'binary_recall': 0.9422753, 'binary_specificity': 0.5202376, 'binary_f1_score': 0.7775037}
confusion matrix:
       0      1
0  31002  28590
1   3427  55941
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.79122305, 'precision': 0.802929, 'recall': 0.79114974, 'specificity': 0.79114974, 'f1': 0.78915787, 'auroc': 0.886001, 'binary_precision': 0.74356604, 'binary_recall': 0.8895293, 'binary_specificity': 0.69277024, 'binary_f1_score': 0.8100247}
confusion matrix:
       0      1
0  14402   6387
1   2300  18520
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-25 07:19:23.130570,epoch time: 5:48:14.630698,used: 12:01:58.321839,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910002
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.49957845, 'precision': 0.47201324, 'recall': 0.49999273, 'specificity': 0.49999273, 'f1': 0.33319712, 'auroc': 0.5868292, 'binary_precision': 0.44444445, 'binary_recall': 5.7602443e-05, 'binary_specificity': 0.9999279, 'binary_f1_score': 0.000115189956}
confusion matrix:
        0   1
0  138643  10
1  138875   8
---- Validation: 
scalar performance:
{'acc': 0.50076497, 'precision': 0.25042668, 'recall': 0.4998238, 'specificity': 0.4998238, 'f1': 0.33367315, 'auroc': 0.7549454, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9996476, 'binary_f1_score': 0.0}
confusion matrix:
       0   1
0  59571  21
1  59368   0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.49962747, 'precision': 0.24981374, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33316773, 'auroc': 0.74862266, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  20789  0
1  20820  0
early stop counter: 1
val acc:0.5007649660110474, best validation acc: 0.730859100818634, corresponding to test acc:                         0.7912230491638184 / 0.7912230491638184
after epoch: 3,now: 2024-07-25 13:23:30.427830,epoch time: 6:04:07.297260,used: 18:06:05.619099,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_24_19_17_24_seed_0_22910002
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.72354215, 'precision': 0.7503494, 'recall': 0.72340876, 'specificity': 0.72340876, 'f1': 0.7158599, 'auroc': 0.81978035, 'binary_precision': 0.66863096, 'binary_recall': 0.8872488, 'binary_specificity': 0.5595687, 'binary_f1_score': 0.7625808}
confusion matrix:
       0       1
0  77587   61068
1  15659  123222
---- Validation: 
slurmstepd: error: *** JOB 22910002 ON gpusrv27 CANCELLED AT 2024-07-25T18:39:50 ***
