Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Tue Jul 16 11:16:34 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreezing/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreezing/rule_results/6.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=6
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179

 Experiment start at: 2024-07-16 13:12:11.611397
before training, model accuracy: 0.5626667737960815
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9715549, 'precision': 0.97160447, 'recall': 0.97155917, 'specificity': 0.97155917, 'f1': 0.9715543, 'auroc': 0.9953119, 'binary_precision': 0.9766469, 'binary_recall': 0.96626085, 'binary_specificity': 0.97685754, 'binary_f1_score': 0.97142607}
confusion matrix:
        0       1
0  135454    3209
1    4686  134203
---- Validation: 
scalar performance:
{'acc': 0.9796318, 'precision': 0.9799059, 'recall': 0.9796101, 'specificity': 0.9796101, 'f1': 0.9796282, 'auroc': 0.9979142, 'binary_precision': 0.9909136, 'binary_recall': 0.9680636, 'binary_specificity': 0.9911565, 'binary_f1_score': 0.9793554}
confusion matrix:
       0      1
0  59065    527
1   1896  57472
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97257805, 'precision': 0.9729252, 'recall': 0.97258824, 'specificity': 0.97258824, 'f1': 0.97257346, 'auroc': 0.9955791, 'binary_precision': 0.98592526, 'binary_recall': 0.95888567, 'binary_specificity': 0.9862908, 'binary_f1_score': 0.97221756}
confusion matrix:
       0      1
0  20504    285
1    856  19964
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-16 20:32:42.518412,epoch time: 7:20:30.907015,used: 7:20:30.907015,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9733347, 'precision': 0.974065, 'recall': 0.973351, 'specificity': 0.973351, 'f1': 0.97332513, 'auroc': 0.9968842, 'binary_precision': 0.99287796, 'binary_recall': 0.9535532, 'binary_specificity': 0.9931488, 'binary_f1_score': 0.9728183}
confusion matrix:
        0       1
0  137712     950
1    6451  132439
---- Validation: 
scalar performance:
{'acc': 0.97905177, 'precision': 0.97969073, 'recall': 0.9790182, 'specificity': 0.9790182, 'f1': 0.97904366, 'auroc': 0.99854064, 'binary_precision': 0.9967336, 'binary_recall': 0.96117437, 'binary_specificity': 0.996862, 'binary_f1_score': 0.97863114}
confusion matrix:
       0      1
0  59405    187
1   2305  57063
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96354157, 'precision': 0.9652475, 'recall': 0.9635642, 'specificity': 0.9635642, 'f1': 0.9635094, 'auroc': 0.99491477, 'binary_precision': 0.9936071, 'binary_recall': 0.93314123, 'binary_specificity': 0.9939872, 'binary_f1_score': 0.9624254}
confusion matrix:
       0      1
0  20664    125
1   1392  19428
early stop counter: 1
val acc:0.9790517687797546, best validation acc: 0.979631781578064, corresponding to test acc:                         0.9725780487060547 / 0.9725780487060547
after epoch: 2,now: 2024-07-17 02:56:59.182090,epoch time: 6:24:16.663678,used: 13:44:47.570693,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97542083, 'precision': 0.9755008, 'recall': 0.97541577, 'specificity': 0.97541577, 'f1': 0.97541964, 'auroc': 0.9971672, 'binary_precision': 0.96953106, 'binary_recall': 0.9817333, 'binary_specificity': 0.9690982, 'binary_f1_score': 0.97559404}
confusion matrix:
        0       1
0  134380    4285
1    2537  136350
---- Validation: 
scalar performance:
{'acc': 0.9860121, 'precision': 0.98602366, 'recall': 0.9860176, 'specificity': 0.9860176, 'f1': 0.9860121, 'auroc': 0.9988672, 'binary_precision': 0.9831374, 'binary_recall': 0.98893344, 'binary_specificity': 0.9831018, 'binary_f1_score': 0.9860269}
confusion matrix:
       0      1
0  58585   1007
1    657  58711
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9730827, 'precision': 0.9730835, 'recall': 0.9730834, 'specificity': 0.9730834, 'f1': 0.9730828, 'auroc': 0.9957261, 'binary_precision': 0.97387666, 'binary_recall': 0.9722863, 'binary_specificity': 0.9738804, 'binary_f1_score': 0.9730808}
confusion matrix:
       0      1
0  20246    543
1    577  20243
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-17 09:22:05.592517,epoch time: 6:25:06.410427,used: 20:09:53.981120,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.98079276, 'precision': 0.9808074, 'recall': 0.98079073, 'specificity': 0.98079073, 'f1': 0.98079264, 'auroc': 0.99800086, 'binary_precision': 0.9783526, 'binary_recall': 0.9833751, 'binary_specificity': 0.97820634, 'binary_f1_score': 0.98085743}
confusion matrix:
        0       1
0  135642    3022
1    2309  136579
---- Validation: 
scalar performance:
{'acc': 0.98920643, 'precision': 0.9892065, 'recall': 0.9892064, 'specificity': 0.9892064, 'f1': 0.98920643, 'auroc': 0.9991095, 'binary_precision': 0.98921907, 'binary_recall': 0.98915243, 'binary_specificity': 0.9892603, 'binary_f1_score': 0.98918575}
confusion matrix:
       0      1
0  58952    640
1    644  58724
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97988415, 'precision': 0.9800323, 'recall': 0.9798908, 'specificity': 0.9798908, 'f1': 0.97988284, 'auroc': 0.9970039, 'binary_precision': 0.9886536, 'binary_recall': 0.9709414, 'binary_specificity': 0.9888402, 'binary_f1_score': 0.9797175}
confusion matrix:
       0      1
0  20557    232
1    605  20215
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-07-17 19:16:29.563202,epoch time: 9:54:23.970685,used: 1 day, 6:04:17.951805,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98212945, 'precision': 0.9821657, 'recall': 0.98213315, 'specificity': 0.98213315, 'f1': 0.9821292, 'auroc': 0.99809813, 'binary_precision': 0.98655087, 'binary_recall': 0.97761506, 'binary_specificity': 0.9866512, 'binary_f1_score': 0.98206264}
confusion matrix:
        0       1
0  136813    1851
1    3109  135779
---- Validation: 
scalar performance:
{'acc': 0.9880212, 'precision': 0.9880606, 'recall': 0.9880135, 'specificity': 0.9880135, 'f1': 0.9880208, 'auroc': 0.99904597, 'binary_precision': 0.99200135, 'binary_recall': 0.98393077, 'binary_specificity': 0.99209625, 'binary_f1_score': 0.98794955}
confusion matrix:
       0      1
0  59121    471
1    954  58414
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9736836, 'precision': 0.9742669, 'recall': 0.97369677, 'specificity': 0.97369677, 'f1': 0.97367597, 'auroc': 0.99575233, 'binary_precision': 0.99108696, 'binary_recall': 0.95600384, 'binary_specificity': 0.9913897, 'binary_f1_score': 0.9732293}
confusion matrix:
       0      1
0  20610    179
1    916  19904
early stop counter: 1
val acc:0.988021194934845, best validation acc: 0.9892064332962036, corresponding to test acc:                         0.979884147644043 / 0.979884147644043
after epoch: 5,now: 2024-07-18 02:07:02.965198,epoch time: 6:50:33.401996,used: 1 day, 12:54:51.353801,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98195654, 'precision': 0.98196, 'recall': 0.9819578, 'specificity': 0.9819578, 'f1': 0.9819565, 'auroc': 0.99817586, 'binary_precision': 0.9834678, 'binary_recall': 0.9804229, 'binary_specificity': 0.9834926, 'binary_f1_score': 0.98194295}
confusion matrix:
        0       1
0  136376    2289
1    2719  136168
---- Validation: 
scalar performance:
{'acc': 0.9886432, 'precision': 0.98868096, 'recall': 0.9886358, 'specificity': 0.9886358, 'f1': 0.9886429, 'auroc': 0.9991584, 'binary_precision': 0.99252933, 'binary_recall': 0.984655, 'binary_specificity': 0.9926165, 'binary_f1_score': 0.98857653}
confusion matrix:
       0      1
0  59152    440
1    911  58457
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96981424, 'precision': 0.97041047, 'recall': 0.9698276, 'specificity': 0.9698276, 'f1': 0.96980524, 'auroc': 0.99486345, 'binary_precision': 0.9873456, 'binary_recall': 0.9518732, 'binary_specificity': 0.987782, 'binary_f1_score': 0.96928495}
confusion matrix:
       0      1
0  20535    254
1   1002  19818
early stop counter: 2
val acc:0.988643229007721, best validation acc: 0.9892064332962036, corresponding to test acc:                         0.979884147644043 / 0.979884147644043
after epoch: 6,now: 2024-07-18 08:47:47.957954,epoch time: 6:40:44.992756,used: 1 day, 19:35:36.346557,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_13_12_11_seed_0_22014179
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
slurmstepd: error: *** JOB 22014179 ON gpusrv35 CANCELLED AT 2024-07-18T11:16:59 DUE TO TIME LIMIT ***
