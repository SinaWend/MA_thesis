Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Tue Jul 16 14:13:17 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreezing/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreezing/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182

 Experiment start at: 2024-07-16 16:37:15.255475
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.5626667737960815
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96961653, 'precision': 0.96965975, 'recall': 0.96962047, 'specificity': 0.96962047, 'f1': 0.969616, 'auroc': 0.994949, 'binary_precision': 0.97437125, 'binary_recall': 0.96465474, 'binary_specificity': 0.97458625, 'binary_f1_score': 0.9694887}
confusion matrix:
        0       1
0  135141    3524
1    4909  133978
---- Validation: 
scalar performance:
{'acc': 0.9779926, 'precision': 0.978242, 'recall': 0.97797185, 'specificity': 0.97797185, 'f1': 0.97798896, 'auroc': 0.9976697, 'binary_precision': 0.98870176, 'binary_recall': 0.9669519, 'binary_specificity': 0.9889918, 'binary_f1_score': 0.97770584}
confusion matrix:
       0      1
0  58936    656
1   1962  57406
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95647573, 'precision': 0.95716864, 'recall': 0.9564904, 'specificity': 0.9564904, 'f1': 0.9564602, 'auroc': 0.9921577, 'binary_precision': 0.97515374, 'binary_recall': 0.9368876, 'binary_specificity': 0.9760931, 'binary_f1_score': 0.9556377}
confusion matrix:
       0      1
0  20292    497
1   1314  19506
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-16 21:39:50.018861,epoch time: 5:02:34.763386,used: 5:02:34.763386,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9766566, 'precision': 0.9769143, 'recall': 0.9766661, 'specificity': 0.9766661, 'f1': 0.9766538, 'auroc': 0.9969816, 'binary_precision': 0.98820126, 'binary_recall': 0.96487075, 'binary_specificity': 0.9884614, 'binary_f1_score': 0.9763966}
confusion matrix:
        0       1
0  137065    1600
1    4879  134008
---- Validation: 
scalar performance:
{'acc': 0.9842972, 'precision': 0.9845047, 'recall': 0.98427856, 'specificity': 0.98427856, 'f1': 0.984295, 'auroc': 0.9985876, 'binary_precision': 0.9940711, 'binary_recall': 0.97434646, 'binary_specificity': 0.99421066, 'binary_f1_score': 0.98410994}
confusion matrix:
       0      1
0  59247    345
1   1523  57845
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97351533, 'precision': 0.9737202, 'recall': 0.9735232, 'specificity': 0.9735232, 'f1': 0.9735128, 'auroc': 0.9960786, 'binary_precision': 0.98375857, 'binary_recall': 0.9629683, 'binary_specificity': 0.9840781, 'binary_f1_score': 0.9732525}
confusion matrix:
       0      1
0  20458    331
1    771  20049
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-17 02:56:59.441566,epoch time: 5:17:09.422705,used: 10:19:44.186091,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9783896, 'precision': 0.97841847, 'recall': 0.97839296, 'specificity': 0.97839296, 'f1': 0.9783894, 'auroc': 0.99724925, 'binary_precision': 0.9823383, 'binary_recall': 0.97433186, 'binary_specificity': 0.982454, 'binary_f1_score': 0.9783187}
confusion matrix:
        0       1
0  136231    2433
1    3565  135323
---- Validation: 
scalar performance:
{'acc': 0.98580194, 'precision': 0.9858879, 'recall': 0.9857902, 'specificity': 0.9857902, 'f1': 0.98580104, 'auroc': 0.9988042, 'binary_precision': 0.9918982, 'binary_recall': 0.97955126, 'binary_specificity': 0.99202913, 'binary_f1_score': 0.9856861}
confusion matrix:
       0      1
0  59117    475
1   1214  58154
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96231586, 'precision': 0.9637348, 'recall': 0.96233654, 'specificity': 0.96233654, 'f1': 0.96228814, 'auroc': 0.9936203, 'binary_precision': 0.9895738, 'binary_recall': 0.9345341, 'binary_specificity': 0.990139, 'binary_f1_score': 0.9612667}
confusion matrix:
       0      1
0  20584    205
1   1363  19457
better model found
persisted
after epoch: 3,now: 2024-07-17 07:32:15.626851,epoch time: 4:35:16.185285,used: 14:55:00.371376,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97789246, 'precision': 0.97831, 'recall': 0.9779045, 'specificity': 0.9779045, 'f1': 0.977888, 'auroc': 0.99780643, 'binary_precision': 0.9926448, 'binary_recall': 0.9629558, 'binary_specificity': 0.9928532, 'binary_f1_score': 0.97757494}
confusion matrix:
        0       1
0  137673     991
1    5145  133743
---- Validation: 
scalar performance:
{'acc': 0.9820612, 'precision': 0.982488, 'recall': 0.98203397, 'specificity': 0.98203397, 'f1': 0.98205644, 'auroc': 0.9988128, 'binary_precision': 0.9963748, 'binary_recall': 0.96757513, 'binary_specificity': 0.9964928, 'binary_f1_score': 0.9817638}
confusion matrix:
       0      1
0  59383    209
1   1925  57443
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.966762, 'precision': 0.96823716, 'recall': 0.96678305, 'specificity': 0.96678305, 'f1': 0.9667369, 'auroc': 0.9955171, 'binary_precision': 0.99470603, 'binary_recall': 0.9385687, 'binary_specificity': 0.9949974, 'binary_f1_score': 0.96582234}
confusion matrix:
       0      1
0  20685    104
1   1279  19541
early stop counter: 1
val acc:0.9820612072944641, best validation acc: 0.9858019351959229, corresponding to test acc:                         0.9623158574104309 / 0.9735153317451477
after epoch: 4,now: 2024-07-17 13:14:46.651852,epoch time: 5:42:31.025001,used: 20:37:31.396377,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9751398, 'precision': 0.9753691, 'recall': 0.97513115, 'specificity': 0.97513115, 'f1': 0.97513646, 'auroc': 0.9976225, 'binary_precision': 0.9651262, 'binary_recall': 0.9859454, 'binary_specificity': 0.9643169, 'binary_f1_score': 0.9754247}
confusion matrix:
        0       1
0  133717    4948
1    1952  136935
---- Validation: 
scalar performance:
{'acc': 0.98582715, 'precision': 0.98587096, 'recall': 0.985837, 'specificity': 0.985837, 'f1': 0.985827, 'auroc': 0.9990363, 'binary_precision': 0.98076344, 'binary_recall': 0.9910389, 'binary_specificity': 0.980635, 'binary_f1_score': 0.9858744}
confusion matrix:
       0      1
0  58438   1154
1    532  58836
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9699584, 'precision': 0.9700966, 'recall': 0.9699649, 'specificity': 0.9699649, 'f1': 0.9699565, 'auroc': 0.99423313, 'binary_precision': 0.9783438, 'binary_recall': 0.9612392, 'binary_specificity': 0.9786906, 'binary_f1_score': 0.9697161}
confusion matrix:
       0      1
0  20346    443
1    807  20013
better model found
persisted
after epoch: 5,now: 2024-07-17 20:43:16.064546,epoch time: 7:28:29.412694,used: 1 day, 4:06:00.809071,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98235285, 'precision': 0.98236096, 'recall': 0.98235464, 'specificity': 0.98235464, 'f1': 0.98235285, 'auroc': 0.99818516, 'binary_precision': 0.98455095, 'binary_recall': 0.9801133, 'binary_specificity': 0.98459595, 'binary_f1_score': 0.9823271}
confusion matrix:
        0       1
0  136529    2136
1    2762  136125
---- Validation: 
scalar performance:
{'acc': 0.9898285, 'precision': 0.9898496, 'recall': 0.9898231, 'specificity': 0.9898231, 'f1': 0.9898283, 'auroc': 0.9992678, 'binary_precision': 0.9926306, 'binary_recall': 0.9869458, 'binary_specificity': 0.99270034, 'binary_f1_score': 0.98978007}
confusion matrix:
       0      1
0  59157    435
1    775  58593
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9716648, 'precision': 0.9721083, 'recall': 0.97167635, 'specificity': 0.97167635, 'f1': 0.9716586, 'auroc': 0.9954887, 'binary_precision': 0.9867658, 'binary_recall': 0.95619595, 'binary_specificity': 0.9871567, 'binary_f1_score': 0.9712404}
confusion matrix:
       0      1
0  20522    267
1    912  19908
better model found
persisted
after epoch: 6,now: 2024-07-18 02:05:07.287345,epoch time: 5:21:51.222799,used: 1 day, 9:27:52.031870,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9817944, 'precision': 0.98180425, 'recall': 0.9817927, 'specificity': 0.9817927, 'f1': 0.98179424, 'auroc': 0.99820447, 'binary_precision': 0.9798156, 'binary_recall': 0.9838862, 'binary_specificity': 0.97969925, 'binary_f1_score': 0.9818467}
confusion matrix:
        0       1
0  135850    2815
1    2238  136649
---- Validation: 
scalar performance:
{'acc': 0.9877774, 'precision': 0.9877794, 'recall': 0.98777616, 'specificity': 0.98777616, 'f1': 0.98777735, 'auroc': 0.9990337, 'binary_precision': 0.98839605, 'binary_recall': 0.98709744, 'binary_specificity': 0.9884548, 'binary_f1_score': 0.98774636}
confusion matrix:
       0      1
0  58904    688
1    766  58602
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97438055, 'precision': 0.974671, 'recall': 0.9743899, 'specificity': 0.9743899, 'f1': 0.97437704, 'auroc': 0.99490154, 'binary_precision': 0.9865997, 'binary_recall': 0.9618636, 'binary_specificity': 0.9869162, 'binary_f1_score': 0.97407466}
confusion matrix:
       0      1
0  20517    272
1    794  20026
new oracle model saved
early stop counter: 1
val acc:0.9877774119377136, best validation acc: 0.9898285269737244, corresponding to test acc:                         0.9716647863388062 / 0.9743805527687073
after epoch: 7,now: 2024-07-18 07:13:17.338559,epoch time: 5:08:10.051214,used: 1 day, 14:36:02.083084,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9840138, 'precision': 0.9841135, 'recall': 0.9840198, 'specificity': 0.9840198, 'f1': 0.9840131, 'auroc': 0.9985178, 'binary_precision': 0.9912673, 'binary_recall': 0.9766576, 'binary_specificity': 0.991382, 'binary_f1_score': 0.98390824}
confusion matrix:
        0       1
0  137468    1195
1    3242  135647
---- Validation: 
scalar performance:
{'acc': 0.9872562, 'precision': 0.9873948, 'recall': 0.98724115, 'specificity': 0.98724115, 'f1': 0.987255, 'auroc': 0.99919456, 'binary_precision': 0.99515563, 'binary_recall': 0.97923124, 'binary_specificity': 0.99525106, 'binary_f1_score': 0.9871292}
confusion matrix:
       0      1
0  59309    283
1   1233  58135
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96274847, 'precision': 0.9643316, 'recall': 0.96277034, 'specificity': 0.96277034, 'f1': 0.9627179, 'auroc': 0.9944484, 'binary_precision': 0.9916318, 'binary_recall': 0.9334294, 'binary_specificity': 0.9921112, 'binary_f1_score': 0.9616507}
confusion matrix:
       0      1
0  20625    164
1   1386  19434
early stop counter: 2
val acc:0.9872562289237976, best validation acc: 0.9898285269737244, corresponding to test acc:                         0.9716647863388062 / 0.9743805527687073
after epoch: 8,now: 2024-07-18 12:15:31.312091,epoch time: 5:02:13.973532,used: 1 day, 19:38:16.056616,model: dset_te_0_erm_b44271c83_not_commited_2024md_07md_16_16_37_15_seed_0_22014182
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
slurmstepd: error: *** JOB 22014182 ON supergpu02 CANCELLED AT 2024-07-18T14:12:38 DUE TO TIME LIMIT ***
