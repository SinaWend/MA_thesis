Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Jul 18 03:40:46 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432

 Experiment start at: 2024-07-18 05:20:45.072155
before training, model accuracy: 0.3186810612678528
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.7896826, 'precision': 0.7919702, 'recall': 0.789718, 'specificity': 0.789718, 'f1': 0.78928363, 'auroc': 0.86822224, 'binary_precision': 0.8180145, 'binary_recall': 0.7455701, 'binary_specificity': 0.8338658, 'binary_f1_score': 0.7801141}
confusion matrix:
        0       1
0  115628   23037
1   35337  103550
---- Validation: 
scalar performance:
{'acc': 0.81719065, 'precision': 0.81720585, 'recall': 0.81718373, 'specificity': 0.81718373, 'f1': 0.81718564, 'auroc': 0.89377, 'binary_precision': 0.81897885, 'binary_recall': 0.81350225, 'binary_specificity': 0.8208652, 'binary_f1_score': 0.8162313}
confusion matrix:
       0      1
0  48917  10675
1  11072  48296
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8082386, 'precision': 0.81049615, 'recall': 0.8082068, 'specificity': 0.8082068, 'f1': 0.8078782, 'auroc': 0.89231086, 'binary_precision': 0.7842061, 'binary_recall': 0.8509126, 'binary_specificity': 0.76550096, 'binary_f1_score': 0.8161986}
confusion matrix:
       0      1
0  15914   4875
1   3104  17716
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-18 08:47:48.169759,epoch time: 3:27:03.097604,used: 3:27:03.097604,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.81678027, 'precision': 0.818723, 'recall': 0.81681144, 'specificity': 0.81681144, 'f1': 0.81651074, 'auroc': 0.8930179, 'binary_precision': 0.8438076, 'binary_recall': 0.77783376, 'binary_specificity': 0.8557891, 'binary_f1_score': 0.80947864}
confusion matrix:
        0       1
0  118668   19997
1   30856  108031
---- Validation: 
scalar performance:
{'acc': 0.8384919, 'precision': 0.8392563, 'recall': 0.8384471, 'specificity': 0.8384471, 'f1': 0.83838785, 'auroc': 0.9117029, 'binary_precision': 0.8548955, 'binary_recall': 0.8146476, 'binary_specificity': 0.86224663, 'binary_f1_score': 0.83428645}
confusion matrix:
       0      1
0  51383   8209
1  11004  48364
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83313704, 'precision': 0.8335396, 'recall': 0.8331241, 'specificity': 0.8331241, 'f1': 0.8330828, 'auroc': 0.91288066, 'binary_precision': 0.8221366, 'binary_recall': 0.85052836, 'binary_specificity': 0.81571984, 'binary_f1_score': 0.8360915}
confusion matrix:
       0      1
0  16958   3831
1   3112  17708
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-18 12:15:31.800720,epoch time: 3:27:43.630961,used: 6:54:46.728565,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.8228584, 'precision': 0.82560575, 'recall': 0.82289577, 'specificity': 0.82289577, 'f1': 0.8224956, 'auroc': 0.89984643, 'binary_precision': 0.855719, 'binary_recall': 0.77701616, 'binary_specificity': 0.86877537, 'binary_f1_score': 0.8144707}
confusion matrix:
        0       1
0  120467   18196
1   30970  107919
---- Validation: 
scalar performance:
{'acc': 0.83470917, 'precision': 0.83988523, 'recall': 0.8345928, 'specificity': 0.8345928, 'f1': 0.8340434, 'auroc': 0.91324234, 'binary_precision': 0.8813608, 'binary_recall': 0.77282375, 'binary_specificity': 0.89636195, 'binary_f1_score': 0.82353157}
confusion matrix:
       0      1
0  53416   6176
1  13487  45881
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.820063, 'precision': 0.8204657, 'recall': 0.8200761, 'specificity': 0.8200761, 'f1': 0.82001054, 'auroc': 0.9035497, 'binary_precision': 0.83201355, 'binary_recall': 0.80240154, 'binary_specificity': 0.83775073, 'binary_f1_score': 0.8169393}
confusion matrix:
       0      1
0  17416   3373
1   4114  16706
early stop counter: 1
val acc:0.8347091674804688, best validation acc: 0.8384919166564941, corresponding to test acc:                         0.833137035369873 / 0.833137035369873
after epoch: 3,now: 2024-07-18 16:00:13.109448,epoch time: 3:44:41.308728,used: 10:39:28.037293,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.8244077, 'precision': 0.82692826, 'recall': 0.8244431, 'specificity': 0.8244431, 'f1': 0.8240795, 'auroc': 0.90120566, 'binary_precision': 0.8558369, 'binary_recall': 0.7805858, 'binary_specificity': 0.8683004, 'binary_f1_score': 0.8164812}
confusion matrix:
        0       1
0  120402   18262
1   30474  108414
---- Validation: 
scalar performance:
{'acc': 0.8328009, 'precision': 0.83852863, 'recall': 0.8326783, 'specificity': 0.8326783, 'f1': 0.8320542, 'auroc': 0.91151845, 'binary_precision': 0.88209444, 'binary_recall': 0.7675684, 'binary_specificity': 0.8977883, 'binary_f1_score': 0.820856}
confusion matrix:
       0      1
0  53501   6091
1  13799  45569
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8077099, 'precision': 0.80984735, 'recall': 0.8077408, 'specificity': 0.8077408, 'f1': 0.80738837, 'auroc': 0.89843535, 'binary_precision': 0.8357693, 'binary_recall': 0.76628244, 'binary_specificity': 0.8491991, 'binary_f1_score': 0.79951894}
confusion matrix:
       0      1
0  17654   3135
1   4866  15954
early stop counter: 2
val acc:0.8328009247779846, best validation acc: 0.8384919166564941, corresponding to test acc:                         0.833137035369873 / 0.833137035369873
after epoch: 4,now: 2024-07-18 19:40:08.347245,epoch time: 3:39:55.237797,used: 14:19:23.275090,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.8206066, 'precision': 0.8315563, 'recall': 0.82067925, 'specificity': 0.82067925, 'f1': 0.8191363, 'auroc': 0.90871286, 'binary_precision': 0.89200985, 'binary_recall': 0.72985953, 'binary_specificity': 0.91149896, 'binary_f1_score': 0.802829}
confusion matrix:
        0       1
0  126393   12272
1   37519  101368
---- Validation: 
scalar performance:
{'acc': 0.8526984, 'precision': 0.8599087, 'recall': 0.85256517, 'specificity': 0.85256517, 'f1': 0.85192287, 'auroc': 0.92705107, 'binary_precision': 0.9103819, 'binary_recall': 0.78180164, 'binary_specificity': 0.92332864, 'binary_f1_score': 0.8412067}
confusion matrix:
       0      1
0  55023   4569
1  12954  46414
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8342907, 'precision': 0.83804655, 'recall': 0.8343299, 'specificity': 0.8343299, 'f1': 0.83384037, 'auroc': 0.9185667, 'binary_precision': 0.87386566, 'binary_recall': 0.7816523, 'binary_specificity': 0.88700753, 'binary_f1_score': 0.82519084}
confusion matrix:
       0      1
0  18440   2349
1   4546  16274
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-07-18 23:51:52.896235,epoch time: 4:11:44.548990,used: 18:31:07.824080,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.84022456, 'precision': 0.84185755, 'recall': 0.8402524, 'specificity': 0.8402524, 'f1': 0.8400411, 'auroc': 0.91260886, 'binary_precision': 0.8656878, 'binary_recall': 0.80571395, 'binary_specificity': 0.87479085, 'binary_f1_score': 0.8346248}
confusion matrix:
        0       1
0  121302   17362
1   26984  111904
---- Validation: 
scalar performance:
{'acc': 0.8504539, 'precision': 0.85631263, 'recall': 0.8503332, 'specificity': 0.8503332, 'f1': 0.8498051, 'auroc': 0.92343795, 'binary_precision': 0.9015336, 'binary_recall': 0.78621477, 'binary_specificity': 0.9144516, 'binary_f1_score': 0.8399344}
confusion matrix:
       0      1
0  54494   5098
1  12692  46676
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81162727, 'precision': 0.8151798, 'recall': 0.8116668, 'specificity': 0.8116668, 'f1': 0.8111083, 'auroc': 0.9049468, 'binary_precision': 0.84882843, 'binary_recall': 0.75864553, 'binary_specificity': 0.86468804, 'binary_f1_score': 0.80120724}
confusion matrix:
       0      1
0  17976   2813
1   5025  15795
early stop counter: 1
val acc:0.8504539132118225, best validation acc: 0.8526983857154846, corresponding to test acc:                         0.8342906832695007 / 0.8342906832695007
after epoch: 6,now: 2024-07-19 03:00:44.611752,epoch time: 3:08:51.715517,used: 21:39:59.539597,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.8443283, 'precision': 0.8452246, 'recall': 0.844349, 'specificity': 0.844349, 'f1': 0.8442326, 'auroc': 0.91456187, 'binary_precision': 0.86302036, 'binary_recall': 0.81888413, 'binary_specificity': 0.86981386, 'binary_f1_score': 0.8403731}
confusion matrix:
        0       1
0  120611   18052
1   25155  113734
---- Validation: 
scalar performance:
{'acc': 0.85439646, 'precision': 0.85950553, 'recall': 0.8542842, 'specificity': 0.8542842, 'f1': 0.853849, 'auroc': 0.92519355, 'binary_precision': 0.90189445, 'binary_recall': 0.7946874, 'binary_specificity': 0.91388106, 'binary_f1_score': 0.8449037}
confusion matrix:
       0      1
0  54460   5132
1  12189  47179
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83140665, 'precision': 0.8342328, 'recall': 0.8314409, 'specificity': 0.8314409, 'f1': 0.8310596, 'auroc': 0.91612744, 'binary_precision': 0.8651537, 'binary_recall': 0.78549474, 'binary_specificity': 0.8773871, 'binary_f1_score': 0.8234021}
confusion matrix:
       0      1
0  18240   2549
1   4466  16354
better model found
persisted
after epoch: 7,now: 2024-07-19 05:48:34.145747,epoch time: 2:47:49.533995,used: 1 day, 0:27:49.073592,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.847942, 'precision': 0.8489051, 'recall': 0.8479636, 'specificity': 0.8479636, 'f1': 0.8478426, 'auroc': 0.9179623, 'binary_precision': 0.86744297, 'binary_recall': 0.82170063, 'binary_specificity': 0.8742265, 'binary_f1_score': 0.8439524}
confusion matrix:
        0       1
0  121222   17440
1   24764  114126
---- Validation: 
scalar performance:
{'acc': 0.8453262, 'precision': 0.8525604, 'recall': 0.84519124, 'specificity': 0.84519124, 'f1': 0.8444921, 'auroc': 0.9231408, 'binary_precision': 0.9025943, 'binary_recall': 0.77354807, 'binary_specificity': 0.9168345, 'binary_f1_score': 0.83310354}
confusion matrix:
       0      1
0  54636   4956
1  13444  45924
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82426876, 'precision': 0.8280319, 'recall': 0.82430863, 'specificity': 0.82430863, 'f1': 0.82377565, 'auroc': 0.9141202, 'binary_precision': 0.8633527, 'binary_recall': 0.7707973, 'binary_specificity': 0.87782, 'binary_f1_score': 0.8144539}
confusion matrix:
       0      1
0  18249   2540
1   4772  16048
early stop counter: 1
val acc:0.8453261852264404, best validation acc: 0.8543964624404907, corresponding to test acc:                         0.8314066529273987 / 0.8342906832695007
after epoch: 8,now: 2024-07-19 08:41:54.391415,epoch time: 2:53:20.245668,used: 1 day, 3:21:09.319260,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.84541273, 'precision': 0.8495391, 'recall': 0.8454562, 'specificity': 0.8454562, 'f1': 0.84496665, 'auroc': 0.9191765, 'binary_precision': 0.8877174, 'binary_recall': 0.79113954, 'binary_specificity': 0.8997728, 'binary_f1_score': 0.8366506}
confusion matrix:
        0       1
0  124767   13898
1   29008  109879
---- Validation: 
scalar performance:
{'acc': 0.86079353, 'precision': 0.8669614, 'recall': 0.8606715, 'specificity': 0.8606715, 'f1': 0.8601769, 'auroc': 0.931372, 'binary_precision': 0.9140679, 'binary_recall': 0.7958833, 'binary_specificity': 0.9254598, 'binary_f1_score': 0.8508914}
confusion matrix:
       0      1
0  55150   4442
1  12118  47250
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8383763, 'precision': 0.8417294, 'recall': 0.83841324, 'specificity': 0.83841324, 'f1': 0.83798915, 'auroc': 0.92155993, 'binary_precision': 0.87576646, 'binary_recall': 0.7889049, 'binary_specificity': 0.8879215, 'binary_f1_score': 0.8300695}
confusion matrix:
       0      1
0  18459   2330
1   4395  16425
new oracle model saved
better model found
persisted
after epoch: 9,now: 2024-07-19 12:04:45.811595,epoch time: 3:22:51.420180,used: 1 day, 6:44:00.739440,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.84172696, 'precision': 0.8500227, 'recall': 0.8417896, 'specificity': 0.8417896, 'f1': 0.8408007, 'auroc': 0.92081034, 'binary_precision': 0.90411264, 'binary_recall': 0.7648266, 'binary_specificity': 0.9187527, 'binary_f1_score': 0.8286574}
confusion matrix:
        0       1
0  127397   11266
1   32663  106226
---- Validation: 
scalar performance:
{'acc': 0.8359112, 'precision': 0.856108, 'recall': 0.835687, 'specificity': 0.835687, 'f1': 0.8334862, 'auroc': 0.92889667, 'binary_precision': 0.94044566, 'binary_recall': 0.71658134, 'binary_specificity': 0.9547926, 'binary_f1_score': 0.81339145}
confusion matrix:
       0      1
0  56898   2694
1  16826  42542
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.812853, 'precision': 0.8281604, 'recall': 0.81293344, 'specificity': 0.81293344, 'f1': 0.8106719, 'auroc': 0.9196373, 'binary_precision': 0.89922196, 'binary_recall': 0.7049952, 'binary_specificity': 0.9208716, 'binary_f1_score': 0.79035085}
confusion matrix:
       0      1
0  19144   1645
1   6142  14678
early stop counter: 1
val acc:0.835911214351654, best validation acc: 0.8607935309410095, corresponding to test acc:                         0.8383762836456299 / 0.8383762836456299
after epoch: 10,now: 2024-07-19 15:49:27.217875,epoch time: 3:44:41.406280,used: 1 day, 10:28:42.145720,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_05_20_44_seed_0_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
Experiment finished at epoch: 10 with time: 1 day, 10:28:42.145720 at 2024-07-19 15:49:27.217875
persisted model performance metric: 

scalar performance:
{'acc': 0.8383763, 'precision': 0.8417294, 'recall': 0.83841324, 'specificity': 0.83841324, 'f1': 0.83798915, 'auroc': 0.92155993, 'binary_precision': 0.87576646, 'binary_recall': 0.7889049, 'binary_specificity': 0.8879215, 'binary_f1_score': 0.8300695}
confusion matrix:
       0      1
0  18459   2330
1   4395  16425
oracle model performance metric: 

scalar performance:
{'acc': 0.8383763, 'precision': 0.8417294, 'recall': 0.83841324, 'specificity': 0.83841324, 'f1': 0.83798915, 'auroc': 0.92155993, 'binary_precision': 0.87576646, 'binary_recall': 0.7889049, 'binary_specificity': 0.8879215, 'binary_f1_score': 0.8300695}
confusion matrix:
       0      1
0  18459   2330
1   4395  16425
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 211606 KiB | 578953 KiB |    781 TiB |    781 TiB |
|       from large pool | 167936 KiB | 499596 KiB |    780 TiB |    780 TiB |
|       from small pool |  43670 KiB |  82614 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 211606 KiB | 578953 KiB |    781 TiB |    781 TiB |
|       from large pool | 167936 KiB | 499596 KiB |    780 TiB |    780 TiB |
|       from small pool |  43670 KiB |  82614 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 202745 KiB | 565549 KiB |    774 TiB |    774 TiB |
|       from large pool | 165120 KiB | 492300 KiB |    773 TiB |    773 TiB |
|       from small pool |  37625 KiB |  76498 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 735232 KiB | 735232 KiB | 735232 KiB |      0 B   |
|       from large pool | 651264 KiB | 651264 KiB | 651264 KiB |      0 B   |
|       from small pool |  83968 KiB |  83968 KiB |  83968 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  79209 KiB | 210112 KiB | 551408 GiB | 551408 GiB |
|       from large pool |  67584 KiB | 208064 KiB | 550100 GiB | 550100 GiB |
|       from small pool |  11625 KiB |  11625 KiB |   1307 GiB |   1307 GiB |
|---------------------------------------------------------------------------|
| Allocations           |   16506    |   35463    |  167256 K  |  167240 K  |
|       from large pool |      36    |      76    |   54257 K  |   54257 K  |
|       from small pool |   16470    |   35425    |  112998 K  |  112982 K  |
|---------------------------------------------------------------------------|
| Active allocs         |   16506    |   35463    |  167256 K  |  167240 K  |
|       from large pool |      36    |      76    |   54257 K  |   54257 K  |
|       from small pool |   16470    |   35425    |  112998 K  |  112982 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      56    |      56    |      56    |       0    |
|       from large pool |      15    |      15    |      15    |       0    |
|       from small pool |      41    |      41    |      41    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      54    |   17361    |   74083 K  |   74083 K  |
|       from large pool |       7    |      11    |   20648 K  |   20648 K  |
|       from small pool |      47    |   17355    |   53434 K  |   53434 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB | 578953 KiB |    781 TiB |    781 TiB |
|       from large pool |  16640 KiB | 499596 KiB |    780 TiB |    780 TiB |
|       from small pool |      0 KiB |  82614 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB | 578953 KiB |    781 TiB |    781 TiB |
|       from large pool |  16640 KiB | 499596 KiB |    780 TiB |    780 TiB |
|       from small pool |      0 KiB |  82614 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 565549 KiB |    774 TiB |    774 TiB |
|       from large pool |  16640 KiB | 492300 KiB |    773 TiB |    773 TiB |
|       from small pool |      0 KiB |  76498 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 290816 KiB | 735232 KiB | 735232 KiB | 444416 KiB |
|       from large pool | 235520 KiB | 651264 KiB | 651264 KiB | 415744 KiB |
|       from small pool |  55296 KiB |  83968 KiB |  83968 KiB |  28672 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55040 KiB | 210112 KiB | 551408 GiB | 551408 GiB |
|       from large pool |  55040 KiB | 208064 KiB | 550100 GiB | 550100 GiB |
|       from small pool |      0 KiB |  19220 KiB |   1307 GiB |   1307 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |   35463    |  167256 K  |  167256 K  |
|       from large pool |       2    |      76    |   54257 K  |   54257 K  |
|       from small pool |       0    |   35425    |  112998 K  |  112998 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |   35463    |  167256 K  |  167256 K  |
|       from large pool |       2    |      76    |   54257 K  |   54257 K  |
|       from small pool |       0    |   35425    |  112998 K  |  112998 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      37    |      56    |      56    |      19    |
|       from large pool |      10    |      15    |      15    |       5    |
|       from small pool |      27    |      41    |      41    |      14    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |   17361    |   74091 K  |   74091 K  |
|       from large pool |       3    |      13    |   20648 K  |   20648 K  |
|       from small pool |       0    |   17355    |   53442 K  |   53442 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB | 578953 KiB |    781 TiB |    781 TiB |
|       from large pool |  16640 KiB | 499596 KiB |    780 TiB |    780 TiB |
|       from small pool |      0 KiB |  82614 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB | 578953 KiB |    781 TiB |    781 TiB |
|       from large pool |  16640 KiB | 499596 KiB |    780 TiB |    780 TiB |
|       from small pool |      0 KiB |  82614 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 565549 KiB |    774 TiB |    774 TiB |
|       from large pool |  16640 KiB | 492300 KiB |    773 TiB |    773 TiB |
|       from small pool |      0 KiB |  76498 KiB |      1 TiB |      1 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 290816 KiB | 735232 KiB | 735232 KiB | 444416 KiB |
|       from large pool | 235520 KiB | 651264 KiB | 651264 KiB | 415744 KiB |
|       from small pool |  55296 KiB |  83968 KiB |  83968 KiB |  28672 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55040 KiB | 210112 KiB | 551408 GiB | 551408 GiB |
|       from large pool |  55040 KiB | 208064 KiB | 550100 GiB | 550100 GiB |
|       from small pool |      0 KiB |  19220 KiB |   1307 GiB |   1307 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |   35463    |  167256 K  |  167256 K  |
|       from large pool |       2    |      76    |   54257 K  |   54257 K  |
|       from small pool |       0    |   35425    |  112998 K  |  112998 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |   35463    |  167256 K  |  167256 K  |
|       from large pool |       2    |      76    |   54257 K  |   54257 K  |
|       from small pool |       0    |   35425    |  112998 K  |  112998 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      37    |      56    |      56    |      19    |
|       from large pool |      10    |      15    |      15    |       5    |
|       from small pool |      27    |      41    |      41    |      14    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |   17361    |   74091 K  |   74091 K  |
|       from large pool |       3    |      13    |   20648 K  |   20648 K  |
|       from small pool |       0    |   17355    |   53442 K  |   53442 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_19_20_30_35_seed_1_22281432

 Experiment start at: 2024-07-19 20:30:36.029963
before training, model accuracy: 0.5290355086326599
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.779017, 'precision': 0.78759426, 'recall': 0.7790586, 'specificity': 0.7790586, 'f1': 0.77737427, 'auroc': 0.8619509, 'binary_precision': 0.8373819, 'binary_recall': 0.6927849, 'binary_specificity': 0.8653323, 'binary_f1_score': 0.7582513}
confusion matrix:
        0      1
0  119974  18671
1   42635  96144
---- Validation: 
scalar performance:
{'acc': 0.7612118, 'precision': 0.78837276, 'recall': 0.7610402, 'specificity': 0.7610402, 'f1': 0.755373, 'auroc': 0.8685466, 'binary_precision': 0.8765953, 'binary_recall': 0.60739744, 'binary_specificity': 0.91468304, 'binary_f1_score': 0.71757996}
confusion matrix:
       0      1
0  54527   5086
1  23352  36128
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.78326386, 'precision': 0.79458606, 'recall': 0.78348386, 'specificity': 0.78348386, 'f1': 0.7812501, 'auroc': 0.8758484, 'binary_precision': 0.85290444, 'binary_recall': 0.685773, 'binary_specificity': 0.8811948, 'binary_f1_score': 0.7602618}
confusion matrix:
       0      1
0  18350   2474
1   6573  14345
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-19 23:32:35.866432,epoch time: 3:01:59.836469,used: 3:01:59.836469,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_19_20_30_35_seed_1_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.8133651, 'precision': 0.8147969, 'recall': 0.8133814, 'specificity': 0.8133814, 'f1': 0.81315804, 'auroc': 0.8894282, 'binary_precision': 0.8361487, 'binary_recall': 0.7797001, 'binary_specificity': 0.84706265, 'binary_f1_score': 0.8069384}
confusion matrix:
        0       1
0  117441   21204
1   30573  108206
---- Validation: 
scalar performance:
{'acc': 0.8194856, 'precision': 0.83000207, 'recall': 0.8193859, 'specificity': 0.8193859, 'f1': 0.81800354, 'auroc': 0.90946424, 'binary_precision': 0.8886342, 'binary_recall': 0.7300605, 'binary_specificity': 0.9087112, 'binary_f1_score': 0.8015801}
confusion matrix:
       0      1
0  54171   5442
1  16056  43424
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81270665, 'precision': 0.81411576, 'recall': 0.81278163, 'specificity': 0.81278163, 'f1': 0.81252086, 'auroc': 0.89538574, 'binary_precision': 0.83572525, 'binary_recall': 0.77947223, 'binary_specificity': 0.84609103, 'binary_f1_score': 0.8066192}
confusion matrix:
       0      1
0  17619   3205
1   4613  16305
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-20 02:24:56.632933,epoch time: 2:52:20.766501,used: 5:54:20.602970,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_19_20_30_35_seed_1_22281432
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
slurmstepd: error: *** JOB 22281432 ON supergpu03 CANCELLED AT 2024-07-20T03:41:08 DUE TO TIME LIMIT ***
