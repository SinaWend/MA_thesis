Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Jul 18 11:17:25 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/rule_results/1.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435

 Experiment start at: 2024-07-18 13:09:11.289259
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.3185849189758301
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.78995645, 'precision': 0.7922854, 'recall': 0.7899921, 'specificity': 0.7899921, 'f1': 0.78955114, 'auroc': 0.8684261, 'binary_precision': 0.8185764, 'binary_recall': 0.74546933, 'binary_specificity': 0.83451486, 'binary_f1_score': 0.78031427}
confusion matrix:
        0       1
0  115718   22947
1   35351  103536
---- Validation: 
scalar performance:
{'acc': 0.8174008, 'precision': 0.8174217, 'recall': 0.81739277, 'specificity': 0.81739277, 'f1': 0.8173946, 'auroc': 0.8938204, 'binary_precision': 0.8195647, 'binary_recall': 0.81313163, 'binary_specificity': 0.8216539, 'binary_f1_score': 0.81633544}
confusion matrix:
       0      1
0  48964  10628
1  11094  48274
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80847895, 'precision': 0.8106368, 'recall': 0.80844784, 'specificity': 0.80844784, 'f1': 0.8081349, 'auroc': 0.8924206, 'binary_precision': 0.78493196, 'binary_recall': 0.8501921, 'binary_specificity': 0.76670355, 'binary_f1_score': 0.81625974}
confusion matrix:
       0      1
0  15939   4850
1   3119  17701
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-18 16:24:53.919185,epoch time: 3:15:42.629926,used: 3:15:42.629926,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.8170361, 'precision': 0.81899595, 'recall': 0.8170674, 'specificity': 0.8170674, 'f1': 0.81676483, 'auroc': 0.89324427, 'binary_precision': 0.8442005, 'binary_recall': 0.77793455, 'binary_specificity': 0.8562002, 'binary_f1_score': 0.809714}
confusion matrix:
        0       1
0  118725   19940
1   30842  108045
---- Validation: 
scalar performance:
{'acc': 0.8384331, 'precision': 0.8392208, 'recall': 0.8383876, 'specificity': 0.8383876, 'f1': 0.838326, 'auroc': 0.91177213, 'binary_precision': 0.8551035, 'binary_recall': 0.8142265, 'binary_specificity': 0.86254865, 'binary_f1_score': 0.8341645}
confusion matrix:
       0      1
0  51401   8191
1  11029  48339
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8333293, 'precision': 0.83370364, 'recall': 0.8333168, 'specificity': 0.8333168, 'f1': 0.8332789, 'auroc': 0.9129982, 'binary_precision': 0.8227118, 'binary_recall': 0.85009605, 'binary_specificity': 0.8165376, 'binary_f1_score': 0.8361798}
confusion matrix:
       0      1
0  16975   3814
1   3121  17699
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-18 19:40:07.978037,epoch time: 3:15:14.058852,used: 6:30:56.688778,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.8229413, 'precision': 0.8257308, 'recall': 0.822979, 'specificity': 0.822979, 'f1': 0.82257307, 'auroc': 0.9000546, 'binary_precision': 0.8560784, 'binary_recall': 0.776757, 'binary_specificity': 0.8692009, 'binary_f1_score': 0.814491}
confusion matrix:
        0       1
0  120526   18137
1   31006  107883
---- Validation: 
scalar performance:
{'acc': 0.8346671, 'precision': 0.8399303, 'recall': 0.83454984, 'specificity': 0.83454984, 'f1': 0.8339903, 'auroc': 0.9133234, 'binary_precision': 0.8817601, 'binary_recall': 0.7722679, 'binary_specificity': 0.8968318, 'binary_f1_score': 0.82338995}
confusion matrix:
       0      1
0  53444   6148
1  13520  45848
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81991875, 'precision': 0.82035935, 'recall': 0.8199325, 'specificity': 0.8199325, 'f1': 0.8198612, 'auroc': 0.90365326, 'binary_precision': 0.832427, 'binary_recall': 0.8014409, 'binary_specificity': 0.83842415, 'binary_f1_score': 0.81664014}
confusion matrix:
       0      1
0  17430   3359
1   4134  16686
early stop counter: 1
val acc:0.8346670866012573, best validation acc: 0.8384330868721008, corresponding to test acc:                         0.8333293199539185 / 0.8333293199539185
after epoch: 3,now: 2024-07-18 22:18:32.395199,epoch time: 2:38:24.417162,used: 9:09:21.105940,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.82484365, 'precision': 0.82731235, 'recall': 0.8248787, 'specificity': 0.8248787, 'f1': 0.82452357, 'auroc': 0.9014751, 'binary_precision': 0.8559408, 'binary_recall': 0.7815002, 'binary_specificity': 0.8682571, 'binary_f1_score': 0.81702846}
confusion matrix:
        0       1
0  120396   18268
1   30347  108541
---- Validation: 
scalar performance:
{'acc': 0.8330363, 'precision': 0.83870804, 'recall': 0.83291435, 'specificity': 0.83291435, 'f1': 0.8322983, 'auroc': 0.9116652, 'binary_precision': 0.88206965, 'binary_recall': 0.7681411, 'binary_specificity': 0.8976876, 'binary_f1_score': 0.82117265}
confusion matrix:
       0      1
0  53495   6097
1  13765  45603
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8080944, 'precision': 0.8102395, 'recall': 0.8081253, 'specificity': 0.8081253, 'f1': 0.80777276, 'auroc': 0.8986043, 'binary_precision': 0.8362236, 'binary_recall': 0.7666186, 'binary_specificity': 0.849632, 'binary_f1_score': 0.7999098}
confusion matrix:
       0      1
0  17663   3126
1   4859  15961
early stop counter: 2
val acc:0.8330363035202026, best validation acc: 0.8384330868721008, corresponding to test acc:                         0.8333293199539185 / 0.8333293199539185
after epoch: 4,now: 2024-07-19 01:32:23.456705,epoch time: 3:13:51.061506,used: 12:23:12.167446,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.8209525, 'precision': 0.83180636, 'recall': 0.8210248, 'specificity': 0.8210248, 'f1': 0.81949914, 'auroc': 0.9089316, 'binary_precision': 0.89201826, 'binary_recall': 0.73063713, 'binary_specificity': 0.9114124, 'binary_f1_score': 0.80330265}
confusion matrix:
        0       1
0  126381   12284
1   37411  101476
---- Validation: 
scalar performance:
{'acc': 0.8530178, 'precision': 0.8601302, 'recall': 0.8528855, 'specificity': 0.8528855, 'f1': 0.85225475, 'auroc': 0.9271836, 'binary_precision': 0.9102717, 'binary_recall': 0.782627, 'binary_specificity': 0.92314404, 'binary_f1_score': 0.8416371}
confusion matrix:
       0      1
0  55012   4580
1  12905  46463
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8342666, 'precision': 0.83804655, 'recall': 0.834306, 'specificity': 0.834306, 'f1': 0.83381337, 'auroc': 0.91875935, 'binary_precision': 0.8739794, 'binary_recall': 0.7814601, 'binary_specificity': 0.88715184, 'binary_f1_score': 0.82513434}
confusion matrix:
       0      1
0  18443   2346
1   4550  16270
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-07-19 04:39:43.515351,epoch time: 3:07:20.058646,used: 15:30:32.226092,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.840556, 'precision': 0.8421613, 'recall': 0.8405836, 'specificity': 0.8405836, 'f1': 0.8403763, 'auroc': 0.91282606, 'binary_precision': 0.8658003, 'binary_recall': 0.80635476, 'binary_specificity': 0.8748125, 'binary_f1_score': 0.8350209}
confusion matrix:
        0       1
0  121305   17359
1   26895  111993
---- Validation: 
scalar performance:
{'acc': 0.8507397, 'precision': 0.85657513, 'recall': 0.8506193, 'specificity': 0.8506193, 'f1': 0.8500953, 'auroc': 0.923597, 'binary_precision': 0.90172225, 'binary_recall': 0.78665274, 'binary_specificity': 0.9145858, 'binary_f1_score': 0.8402663}
confusion matrix:
       0      1
0  54502   5090
1  12666  46702
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8119157, 'precision': 0.81549764, 'recall': 0.81195533, 'specificity': 0.81195533, 'f1': 0.8113937, 'auroc': 0.9051969, 'binary_precision': 0.8493011, 'binary_recall': 0.7587416, 'binary_specificity': 0.8651691, 'binary_f1_score': 0.8014713}
confusion matrix:
       0      1
0  17986   2803
1   5023  15797
early stop counter: 1
val acc:0.8507397174835205, best validation acc: 0.8530178070068359, corresponding to test acc:                         0.8342666029930115 / 0.8342666029930115
after epoch: 6,now: 2024-07-19 07:57:47.752190,epoch time: 3:18:04.236839,used: 18:48:36.462931,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.8445985, 'precision': 0.8454821, 'recall': 0.84461904, 'specificity': 0.84461904, 'f1': 0.8445045, 'auroc': 0.9147732, 'binary_precision': 0.8631589, 'binary_recall': 0.81934494, 'binary_specificity': 0.8698932, 'binary_f1_score': 0.84068143}
confusion matrix:
        0       1
0  120622   18041
1   25091  113798
---- Validation: 
scalar performance:
{'acc': 0.85456455, 'precision': 0.8596556, 'recall': 0.8544526, 'specificity': 0.8544526, 'f1': 0.8540198, 'auroc': 0.9253802, 'binary_precision': 0.901978, 'binary_recall': 0.79497373, 'binary_specificity': 0.9139314, 'binary_f1_score': 0.8451022}
confusion matrix:
       0      1
0  54463   5129
1  12172  47196
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8316951, 'precision': 0.83449984, 'recall': 0.8317292, 'specificity': 0.8317292, 'f1': 0.8313515, 'auroc': 0.9163536, 'binary_precision': 0.8653165, 'binary_recall': 0.78597504, 'binary_specificity': 0.8774833, 'binary_f1_score': 0.82373965}
confusion matrix:
       0      1
0  18242   2547
1   4456  16364
better model found
persisted
after epoch: 7,now: 2024-07-19 11:16:53.963784,epoch time: 3:19:06.211594,used: 22:07:42.674525,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.8482086, 'precision': 0.849164, 'recall': 0.8482301, 'specificity': 0.8482301, 'f1': 0.8481102, 'auroc': 0.9181615, 'binary_precision': 0.8676348, 'binary_recall': 0.8220822, 'binary_specificity': 0.87437797, 'binary_f1_score': 0.8442445}
confusion matrix:
        0       1
0  121243   17419
1   24711  114179
---- Validation: 
scalar performance:
{'acc': 0.8456036, 'precision': 0.8527451, 'recall': 0.8454696, 'specificity': 0.8454696, 'f1': 0.8447819, 'auroc': 0.92334795, 'binary_precision': 0.9024677, 'binary_recall': 0.774306, 'binary_specificity': 0.9166331, 'binary_f1_score': 0.83348894}
confusion matrix:
       0      1
0  54624   4968
1  13399  45969
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82470137, 'precision': 0.8284489, 'recall': 0.8247411, 'specificity': 0.8247411, 'f1': 0.8242122, 'auroc': 0.9143632, 'binary_precision': 0.86371946, 'binary_recall': 0.7713737, 'binary_specificity': 0.8781086, 'binary_f1_score': 0.81493884}
confusion matrix:
       0      1
0  18255   2534
1   4760  16060
early stop counter: 1
val acc:0.8456035852432251, best validation acc: 0.8545645475387573, corresponding to test acc:                         0.8316950798034668 / 0.8342666029930115
after epoch: 8,now: 2024-07-19 14:30:17.712617,epoch time: 3:13:23.748833,used: 1 day, 1:21:06.423358,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.8456722, 'precision': 0.84979045, 'recall': 0.8457155, 'specificity': 0.8457155, 'f1': 0.845228, 'auroc': 0.91936827, 'binary_precision': 0.8879456, 'binary_recall': 0.79147077, 'binary_specificity': 0.89996034, 'binary_f1_score': 0.8369371}
confusion matrix:
        0       1
0  124793   13872
1   28962  109925
---- Validation: 
scalar performance:
{'acc': 0.8612307, 'precision': 0.8673444, 'recall': 0.86110926, 'specificity': 0.86110926, 'f1': 0.8606219, 'auroc': 0.9315532, 'binary_precision': 0.9142664, 'binary_recall': 0.7966413, 'binary_specificity': 0.9255773, 'binary_f1_score': 0.85141045}
confusion matrix:
       0      1
0  55157   4435
1  12073  47295
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8386647, 'precision': 0.84200746, 'recall': 0.8387015, 'specificity': 0.8387015, 'f1': 0.8382798, 'auroc': 0.92180574, 'binary_precision': 0.8760062, 'binary_recall': 0.7892891, 'binary_specificity': 0.8881139, 'binary_f1_score': 0.83038986}
confusion matrix:
       0      1
0  18463   2326
1   4387  16433
new oracle model saved
better model found
persisted
after epoch: 9,now: 2024-07-19 17:44:59.679953,epoch time: 3:14:41.967336,used: 1 day, 4:35:48.390694,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.84202963, 'precision': 0.8503167, 'recall': 0.8420922, 'specificity': 0.8420922, 'f1': 0.8411069, 'auroc': 0.92098296, 'binary_precision': 0.90440124, 'binary_recall': 0.765201, 'binary_specificity': 0.91898346, 'binary_f1_score': 0.8289984}
confusion matrix:
        0       1
0  127429   11234
1   32611  106278
---- Validation: 
scalar performance:
{'acc': 0.8362643, 'precision': 0.85639787, 'recall': 0.8360405, 'specificity': 0.8360405, 'f1': 0.8338541, 'auroc': 0.92908084, 'binary_precision': 0.9406372, 'binary_recall': 0.7171709, 'binary_specificity': 0.95491004, 'binary_f1_score': 0.81384283}
confusion matrix:
       0      1
0  56905   2687
1  16791  42577
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8131654, 'precision': 0.8285381, 'recall': 0.81324595, 'specificity': 0.81324595, 'f1': 0.81098104, 'auroc': 0.91985846, 'binary_precision': 0.8997916, 'binary_recall': 0.7051393, 'binary_specificity': 0.9213526, 'binary_f1_score': 0.79066133}
confusion matrix:
       0      1
0  19154   1635
1   6139  14681
early stop counter: 1
val acc:0.8362643122673035, best validation acc: 0.8612306714057922, corresponding to test acc:                         0.838664710521698 / 0.838664710521698
after epoch: 10,now: 2024-07-19 20:31:51.585101,epoch time: 2:46:51.905148,used: 1 day, 7:22:40.295842,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_18_13_09_11_seed_0_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
Experiment finished at epoch: 10 with time: 1 day, 7:22:40.295842 at 2024-07-19 20:31:51.585101
persisted model performance metric: 

scalar performance:
{'acc': 0.8386647, 'precision': 0.84200746, 'recall': 0.8387015, 'specificity': 0.8387015, 'f1': 0.8382798, 'auroc': 0.92180574, 'binary_precision': 0.8760062, 'binary_recall': 0.7892891, 'binary_specificity': 0.8881139, 'binary_f1_score': 0.83038986}
confusion matrix:
       0      1
0  18463   2326
1   4387  16433
oracle model performance metric: 

scalar performance:
{'acc': 0.8386647, 'precision': 0.84200746, 'recall': 0.8387015, 'specificity': 0.8387015, 'f1': 0.8382798, 'auroc': 0.92180574, 'binary_precision': 0.8760062, 'binary_recall': 0.7892891, 'binary_specificity': 0.8881139, 'binary_f1_score': 0.83038986}
confusion matrix:
       0      1
0  18463   2326
1   4387  16433
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/rule_results/1.csv
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_2024-07-17_23-28-42/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 211606 KiB | 647356 KiB |   1813 TiB |   1813 TiB |
|       from large pool | 167936 KiB | 568000 KiB |   1813 TiB |   1813 TiB |
|       from small pool |  43670 KiB |  82614 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 211606 KiB | 647356 KiB |   1813 TiB |   1813 TiB |
|       from large pool | 167936 KiB | 568000 KiB |   1813 TiB |   1813 TiB |
|       from small pool |  43670 KiB |  82614 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 202745 KiB | 633953 KiB |   1808 TiB |   1808 TiB |
|       from large pool | 165120 KiB | 560704 KiB |   1807 TiB |   1807 TiB |
|       from small pool |  37625 KiB |  76498 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 763904 KiB | 763904 KiB | 763904 KiB |      0 B   |
|       from large pool | 679936 KiB | 679936 KiB | 679936 KiB |      0 B   |
|       from small pool |  83968 KiB |  83968 KiB |  83968 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  79209 KiB | 213907 KiB |    785 TiB |    785 TiB |
|       from large pool |  67584 KiB | 209284 KiB |    785 TiB |    785 TiB |
|       from small pool |  11625 KiB |  11625 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Allocations           |   16506    |   35463    |  166394 K  |  166377 K  |
|       from large pool |      36    |      76    |   65035 K  |   65035 K  |
|       from small pool |   16470    |   35425    |  101359 K  |  101342 K  |
|---------------------------------------------------------------------------|
| Active allocs         |   16506    |   35463    |  166394 K  |  166377 K  |
|       from large pool |      36    |      76    |   65035 K  |   65035 K  |
|       from small pool |   16470    |   35425    |  101359 K  |  101342 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      55    |      55    |      55    |       0    |
|       from large pool |      14    |      14    |      14    |       0    |
|       from small pool |      41    |      41    |      41    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      54    |   17361    |   73497 K  |   73497 K  |
|       from large pool |       7    |      11    |   22397 K  |   22397 K  |
|       from small pool |      47    |   17355    |   51100 K  |   51100 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB | 647356 KiB |   1813 TiB |   1813 TiB |
|       from large pool |  16640 KiB | 568000 KiB |   1813 TiB |   1813 TiB |
|       from small pool |      0 KiB |  82614 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB | 647356 KiB |   1813 TiB |   1813 TiB |
|       from large pool |  16640 KiB | 568000 KiB |   1813 TiB |   1813 TiB |
|       from small pool |      0 KiB |  82614 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 633953 KiB |   1808 TiB |   1808 TiB |
|       from large pool |  16640 KiB | 560704 KiB |   1807 TiB |   1807 TiB |
|       from small pool |      0 KiB |  76498 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 290816 KiB | 763904 KiB | 763904 KiB | 473088 KiB |
|       from large pool | 235520 KiB | 679936 KiB | 679936 KiB | 444416 KiB |
|       from small pool |  55296 KiB |  83968 KiB |  83968 KiB |  28672 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55040 KiB | 213907 KiB |    785 TiB |    785 TiB |
|       from large pool |  55040 KiB | 209284 KiB |    785 TiB |    785 TiB |
|       from small pool |      0 KiB |  19220 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |   35463    |  166394 K  |  166394 K  |
|       from large pool |       2    |      76    |   65035 K  |   65035 K  |
|       from small pool |       0    |   35425    |  101359 K  |  101359 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |   35463    |  166394 K  |  166394 K  |
|       from large pool |       2    |      76    |   65035 K  |   65035 K  |
|       from small pool |       0    |   35425    |  101359 K  |  101359 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      37    |      55    |      55    |      18    |
|       from large pool |      10    |      14    |      14    |       4    |
|       from small pool |      27    |      41    |      41    |      14    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |   17361    |   73505 K  |   73505 K  |
|       from large pool |       3    |      13    |   22397 K  |   22397 K  |
|       from small pool |       0    |   17355    |   51108 K  |   51108 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB | 647356 KiB |   1813 TiB |   1813 TiB |
|       from large pool |  16640 KiB | 568000 KiB |   1813 TiB |   1813 TiB |
|       from small pool |      0 KiB |  82614 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB | 647356 KiB |   1813 TiB |   1813 TiB |
|       from large pool |  16640 KiB | 568000 KiB |   1813 TiB |   1813 TiB |
|       from small pool |      0 KiB |  82614 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 633953 KiB |   1808 TiB |   1808 TiB |
|       from large pool |  16640 KiB | 560704 KiB |   1807 TiB |   1807 TiB |
|       from small pool |      0 KiB |  76498 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 290816 KiB | 763904 KiB | 763904 KiB | 473088 KiB |
|       from large pool | 235520 KiB | 679936 KiB | 679936 KiB | 444416 KiB |
|       from small pool |  55296 KiB |  83968 KiB |  83968 KiB |  28672 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55040 KiB | 213907 KiB |    785 TiB |    785 TiB |
|       from large pool |  55040 KiB | 209284 KiB |    785 TiB |    785 TiB |
|       from small pool |      0 KiB |  19220 KiB |      0 TiB |      0 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |   35463    |  166394 K  |  166394 K  |
|       from large pool |       2    |      76    |   65035 K  |   65035 K  |
|       from small pool |       0    |   35425    |  101359 K  |  101359 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |   35463    |  166394 K  |  166394 K  |
|       from large pool |       2    |      76    |   65035 K  |   65035 K  |
|       from small pool |       0    |   35425    |  101359 K  |  101359 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      37    |      55    |      55    |      18    |
|       from large pool |      10    |      14    |      14    |       4    |
|       from small pool |      27    |      41    |      41    |      14    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |   17361    |   73505 K  |   73505 K  |
|       from large pool |       3    |      13    |   22397 K  |   22397 K  |
|       from small pool |       0    |   17355    |   51108 K  |   51108 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_20_00_17_10_seed_1_22281435

 Experiment start at: 2024-07-20 00:17:10.941402
before training, model accuracy: 0.5293469429016113
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.7791503, 'precision': 0.7877902, 'recall': 0.77919215, 'specificity': 0.77919215, 'f1': 0.77749777, 'auroc': 0.8621478, 'binary_precision': 0.8377754, 'binary_recall': 0.6926336, 'binary_specificity': 0.8657507, 'binary_f1_score': 0.758322}
confusion matrix:
        0      1
0  120032  18613
1   42656  96123
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.7614721, 'precision': 0.7886965, 'recall': 0.76130044, 'specificity': 0.76130044, 'f1': 0.7556326, 'auroc': 0.86876625, 'binary_precision': 0.87707204, 'binary_recall': 0.6075656, 'binary_specificity': 0.9150353, 'binary_f1_score': 0.717857}
confusion matrix:
       0      1
0  54548   5065
1  23342  36138
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7833597, 'precision': 0.79468566, 'recall': 0.7835797, 'specificity': 0.7835797, 'f1': 0.7813468, 'auroc': 0.87601334, 'binary_precision': 0.85302335, 'binary_recall': 0.6858686, 'binary_specificity': 0.8812908, 'binary_f1_score': 0.7603678}
confusion matrix:
       0      1
0  18352   2472
1   6571  14347
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-20 03:07:33.919281,epoch time: 2:50:22.977879,used: 2:50:22.977879,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_20_00_17_10_seed_1_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.81370753, 'precision': 0.8151363, 'recall': 0.8137238, 'specificity': 0.8137238, 'f1': 0.81350154, 'auroc': 0.88963103, 'binary_precision': 0.83647674, 'binary_recall': 0.7800964, 'binary_specificity': 0.84735113, 'binary_f1_score': 0.8073034}
confusion matrix:
        0       1
0  117481   21164
1   30518  108261
---- Validation: 
scalar performance:
{'acc': 0.8197711, 'precision': 0.8302521, 'recall': 0.8196715, 'specificity': 0.8196715, 'f1': 0.8182975, 'auroc': 0.90956867, 'binary_precision': 0.88880706, 'binary_recall': 0.7305313, 'binary_specificity': 0.9088118, 'binary_f1_score': 0.8019342}
confusion matrix:
       0      1
0  54177   5436
1  16028  43452
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8127545, 'precision': 0.814168, 'recall': 0.8128297, 'specificity': 0.8128297, 'f1': 0.81256825, 'auroc': 0.8954995, 'binary_precision': 0.83581096, 'binary_recall': 0.77947223, 'binary_specificity': 0.8461871, 'binary_f1_score': 0.8066591}
confusion matrix:
       0      1
0  17621   3203
1   4613  16305
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-20 05:57:35.618795,epoch time: 2:50:01.699514,used: 5:40:24.677393,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_20_00_17_10_seed_1_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.8074175, 'precision': 0.8200542, 'recall': 0.8074648, 'specificity': 0.8074648, 'f1': 0.80551416, 'auroc': 0.8981062, 'binary_precision': 0.88376904, 'binary_recall': 0.7081526, 'binary_specificity': 0.90677696, 'binary_f1_score': 0.7862741}
confusion matrix:
        0      1
0  125721  12925
1   40502  98276
---- Validation: 
scalar performance:
{'acc': 0.8283946, 'precision': 0.84388757, 'recall': 0.82827604, 'specificity': 0.82827604, 'f1': 0.8264037, 'auroc': 0.91967094, 'binary_precision': 0.9166009, 'binary_recall': 0.72210824, 'binary_specificity': 0.93444383, 'binary_f1_score': 0.8078128}
confusion matrix:
       0      1
0  55705   3908
1  16529  42951
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8222174, 'precision': 0.82640404, 'recall': 0.82234466, 'specificity': 0.82234466, 'f1': 0.82168496, 'auroc': 0.9104271, 'binary_precision': 0.86393785, 'binary_recall': 0.7658476, 'binary_specificity': 0.8788417, 'binary_f1_score': 0.8119409}
confusion matrix:
       0      1
0  18301   2523
1   4898  16020
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-20 08:30:45.709671,epoch time: 2:33:10.090876,used: 8:13:34.768269,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_20_00_17_10_seed_1_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.8135093, 'precision': 0.823035, 'recall': 0.8135507, 'specificity': 0.8135507, 'f1': 0.8121381, 'auroc': 0.900952, 'binary_precision': 0.87862784, 'binary_recall': 0.7277254, 'binary_specificity': 0.8993761, 'binary_f1_score': 0.7960886}
confusion matrix:
        0       1
0  124694   13951
1   37786  100993
---- Validation: 
scalar performance:
{'acc': 0.79401815, 'precision': 0.8177993, 'recall': 0.7938652, 'specificity': 0.7938652, 'f1': 0.7900325, 'auroc': 0.90712595, 'binary_precision': 0.9044555, 'binary_recall': 0.6569771, 'binary_specificity': 0.93075335, 'binary_f1_score': 0.76110435}
confusion matrix:
       0      1
0  55485   4128
1  20403  39077
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7824493, 'precision': 0.79324126, 'recall': 0.7826646, 'specificity': 0.7826646, 'f1': 0.7805166, 'auroc': 0.89094126, 'binary_precision': 0.85006213, 'binary_recall': 0.68706375, 'binary_specificity': 0.87826544, 'binary_f1_score': 0.7599207}
confusion matrix:
       0      1
0  18289   2535
1   6546  14372
early stop counter: 1
val acc:0.7940181493759155, best validation acc: 0.8283945918083191, corresponding to test acc:                         0.8222174048423767 / 0.8222174048423767
after epoch: 4,now: 2024-07-20 11:01:39.169209,epoch time: 2:30:53.459538,used: 10:44:28.227807,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_20_00_17_10_seed_1_22281435
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
slurmstepd: error: *** JOB 22281435 ON gpusrv35 CANCELLED AT 2024-07-20T11:17:42 DUE TO TIME LIMIT ***
