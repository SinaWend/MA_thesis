Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Aug 12 19:56:33 2024]
rule parameter_sampling:
    input: /ictstr01/home/aih/sina.wendrich/MA_thesis/conf/CAMELYONwild_benchmark.yaml
    output: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/hyperparameters.csv
    jobid: 1
    reason: Updated input files: /ictstr01/home/aih/sina.wendrich/MA_thesis/conf/CAMELYONwild_benchmark.yaml
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal




!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
[Mon Aug 12 19:58:06 2024]
Finished job 1.
1 of 2 steps (50%) done
Select jobs to execute...

[Mon Aug 12 19:58:06 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/rule_results/1.csv
    jobid: 0
    reason: Input files updated by another job: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/hyperparameters.csv
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9602374, 'precision': 0.9602716, 'recall': 0.9602314, 'specificity': 0.9602314, 'f1': 0.9602362, 'auroc': 0.9923935, 'binary_precision': 0.9566543, 'binary_recall': 0.96428275, 'binary_specificity': 0.95618004, 'binary_f1_score': 0.9604534}
confusion matrix:
        0       1
0  103299    4734
1    3870  104481
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_21_37_15_seed_0_24146772

 Experiment start at: 2024-08-12 21:37:15.658397
scalar performance:
{'acc': 0.96911657, 'precision': 0.9694178, 'recall': 0.96916234, 'specificity': 0.96916234, 'f1': 0.96911347, 'auroc': 0.9965001, 'binary_precision': 0.9566416, 'binary_recall': 0.9825544, 'binary_specificity': 0.95577025, 'binary_f1_score': 0.9694249}
confusion matrix:
       0      1
0  44515   2060
1    807  45451
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96499884, 'precision': 0.96597624, 'recall': 0.9649851, 'specificity': 0.9649851, 'f1': 0.96497977, 'auroc': 0.99319917, 'binary_precision': 0.98716694, 'binary_recall': 0.94220394, 'binary_specificity': 0.9877662, 'binary_f1_score': 0.9641615}
confusion matrix:
       0      1
0  50786    629
1   2968  48385
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-12 22:21:52.030210,epoch time: 3:54:10.781968,used: 3:54:10.781968,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
before training, model accuracy: 0.3761676847934723
[Mon Aug 12 22:22:07 2024]
Error in rule run_experiment:
    jobid: 0
    input: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/rule_results/1.csv

RuleException:
OutOfMemoryError in file /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk, line 161:
CUDA out of memory. Tried to allocate 14.00 MiB. GPU 
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk", line 161, in __rule_run_experiment
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/exp_protocol/run_experiment.py", line 172, in run_experiment
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/exp/exp_main.py", line 78, in execute
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 36, in tr_epoch
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 76, in _cal_reg_loss
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 71, in _cal_phi
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/models/a_model_classif.py", line 110, in cal_logit_y
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/models/a_model_classif.py", line 102, in extract_semantic_feat
  File "/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/models/a_model.py", line 124, in extract_semantic_feat
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
  File "/home/aih/sina.wendrich/MA_thesis/nets/dinov2_nofreeze.py", line 53, in forward
  File "/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/models/vision_transformer.py", line 261, in forward_features
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1532, in _wrapped_call_impl
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1541, in _call_impl
  File "/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py", line 254, in forward
  File "/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py", line 113, in forward
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/concurrent/futures/thread.py", line 58, in run
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9718787, 'precision': 0.9719193, 'recall': 0.9718859, 'specificity': 0.9718859, 'f1': 0.9718784, 'auroc': 0.99488175, 'binary_precision': 0.97667545, 'binary_recall': 0.9669312, 'binary_specificity': 0.9768406, 'binary_f1_score': 0.971779}
confusion matrix:
        0       1
0  105532    2502
1    3583  104767
---- Validation: 
scalar performance:
{'acc': 0.98360497, 'precision': 0.98361564, 'recall': 0.98359907, 'specificity': 0.98359907, 'f1': 0.98360455, 'auroc': 0.9979887, 'binary_precision': 0.985185, 'binary_recall': 0.9818626, 'binary_specificity': 0.98533547, 'binary_f1_score': 0.983521}
confusion matrix:
       0      1
0  45892    683
1    839  45419
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9623715, 'precision': 0.9641061, 'recall': 0.96235317, 'specificity': 0.96235317, 'f1': 0.9623352, 'auroc': 0.9948667, 'binary_precision': 0.9923278, 'binary_recall': 0.9319027, 'binary_specificity': 0.99280363, 'binary_f1_score': 0.96116644}
confusion matrix:
       0      1
0  51045    370
1   3497  47856
better model found
persisted
after epoch: 2,now: 2024-08-13 01:33:10.470866,epoch time: 3:11:18.440656,used: 7:05:29.222624,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96763164, 'precision': 0.9690317, 'recall': 0.9676722, 'specificity': 0.9676722, 'f1': 0.9676094, 'auroc': 0.9953511, 'binary_precision': 0.9950276, 'binary_recall': 0.9400559, 'binary_specificity': 0.9952885, 'binary_f1_score': 0.96676093}
confusion matrix:
        0       1
0  107524     509
1    6495  101856
---- Validation: 
scalar performance:
{'acc': 0.98113817, 'precision': 0.9816513, 'recall': 0.98108494, 'specificity': 0.98108494, 'f1': 0.98113143, 'auroc': 0.9981978, 'binary_precision': 0.9965415, 'binary_recall': 0.96549785, 'binary_specificity': 0.99667203, 'binary_f1_score': 0.9807741}
confusion matrix:
       0      1
0  46420    155
1   1596  44662
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92974466, 'precision': 0.93740785, 'recall': 0.9297048, 'specificity': 0.9297048, 'f1': 0.92943114, 'auroc': 0.9919517, 'binary_precision': 0.9951531, 'binary_recall': 0.8636107, 'binary_specificity': 0.9957989, 'binary_f1_score': 0.9247274}
confusion matrix:
       0      1
0  51199    216
1   7004  44349
early stop counter: 1
val acc:0.9811381697654724, best validation acc: 0.9836049675941467, corresponding to test acc:                         0.9623715281486511 / 0.9649988412857056
after epoch: 3,now: 2024-08-13 03:30:28.267425,epoch time: 1:57:17.796559,used: 9:02:47.019183,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97698534, 'precision': 0.9770546, 'recall': 0.9769945, 'specificity': 0.9769945, 'f1': 0.97698486, 'auroc': 0.9963591, 'binary_precision': 0.98317254, 'binary_recall': 0.97065014, 'binary_specificity': 0.9833389, 'binary_f1_score': 0.97687125}
confusion matrix:
        0       1
0  106236    1800
1    3180  105168
---- Validation: 
scalar performance:
{'acc': 0.9858994, 'precision': 0.9859507, 'recall': 0.9858843, 'specificity': 0.9858843, 'f1': 0.98589855, 'auroc': 0.9984784, 'binary_precision': 0.9901638, 'binary_recall': 0.98145187, 'binary_specificity': 0.9903167, 'binary_f1_score': 0.9857886}
confusion matrix:
       0      1
0  46124    451
1    858  45400
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9618753, 'precision': 0.96401864, 'recall': 0.9618549, 'specificity': 0.9618549, 'f1': 0.96183, 'auroc': 0.9963009, 'binary_precision': 0.9954047, 'binary_recall': 0.92798865, 'binary_specificity': 0.9957211, 'binary_f1_score': 0.9605152}
confusion matrix:
       0      1
0  51195    220
1   3698  47655
better model found
persisted
after epoch: 4,now: 2024-08-13 06:02:33.205249,epoch time: 2:32:04.937824,used: 11:34:51.957007,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97700846, 'precision': 0.9772462, 'recall': 0.97702515, 'specificity': 0.97702515, 'f1': 0.9770062, 'auroc': 0.9963629, 'binary_precision': 0.9882673, 'binary_recall': 0.96554655, 'binary_specificity': 0.98850375, 'binary_f1_score': 0.9767749}
confusion matrix:
        0       1
0  106793    1242
1    3733  104616
---- Validation: 
scalar performance:
{'acc': 0.98345417, 'precision': 0.9837656, 'recall': 0.98341334, 'specificity': 0.98341334, 'f1': 0.9834503, 'auroc': 0.9982593, 'binary_precision': 0.99521637, 'binary_recall': 0.9714644, 'binary_specificity': 0.99536234, 'binary_f1_score': 0.983197}
confusion matrix:
       0      1
0  46359    216
1   1320  44938
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8648412, 'precision': 0.8925564, 'recall': 0.8647611, 'specificity': 0.8647611, 'f1': 0.8623943, 'auroc': 0.98448837, 'binary_precision': 0.99671185, 'binary_recall': 0.7319339, 'binary_specificity': 0.9975883, 'binary_f1_score': 0.8440447}
confusion matrix:
       0      1
0  51291    124
1  13766  37587
early stop counter: 1
val acc:0.983454167842865, best validation acc: 0.9858993887901306, corresponding to test acc:                         0.961875319480896 / 0.9649988412857056
after epoch: 5,now: 2024-08-13 08:11:33.256898,epoch time: 2:09:00.051649,used: 13:43:52.008656,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9742125, 'precision': 0.97473633, 'recall': 0.9742374, 'specificity': 0.9742374, 'f1': 0.9742063, 'auroc': 0.99629897, 'binary_precision': 0.99087703, 'binary_recall': 0.95731467, 'binary_specificity': 0.9911601, 'binary_f1_score': 0.97380674}
confusion matrix:
        0       1
0  107078     955
1    4625  103726
---- Validation: 
scalar performance:
{'acc': 0.9828832, 'precision': 0.9831648, 'recall': 0.98284453, 'specificity': 0.98284453, 'f1': 0.9828795, 'auroc': 0.99813235, 'binary_precision': 0.99400586, 'binary_recall': 0.9715076, 'binary_specificity': 0.99418145, 'binary_f1_score': 0.9826279}
confusion matrix:
       0      1
0  46304    271
1   1318  44940
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96445394, 'precision': 0.96606314, 'recall': 0.9644363, 'specificity': 0.9644363, 'f1': 0.9644222, 'auroc': 0.9958881, 'binary_precision': 0.9932986, 'binary_recall': 0.93517417, 'binary_specificity': 0.99369836, 'binary_f1_score': 0.9633604}
confusion matrix:
       0      1
0  51091    324
1   3329  48024
early stop counter: 2
val acc:0.9828832149505615, best validation acc: 0.9858993887901306, corresponding to test acc:                         0.961875319480896 / 0.9649988412857056
after epoch: 6,now: 2024-08-13 11:04:36.149265,epoch time: 2:53:02.892367,used: 16:36:54.901023,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.97762775, 'precision': 0.9777986, 'recall': 0.977642, 'specificity': 0.977642, 'f1': 0.9776262, 'auroc': 0.9967525, 'binary_precision': 0.98720664, 'binary_recall': 0.9678634, 'binary_specificity': 0.9874206, 'binary_f1_score': 0.97743934}
confusion matrix:
        0       1
0  106675    1359
1    3482  104868
---- Validation: 
scalar performance:
{'acc': 0.98569477, 'precision': 0.98581636, 'recall': 0.9856702, 'specificity': 0.9856702, 'f1': 0.9856932, 'auroc': 0.99860764, 'binary_precision': 0.9926967, 'binary_recall': 0.97849023, 'binary_specificity': 0.99285024, 'binary_f1_score': 0.98554236}
confusion matrix:
       0      1
0  46242    333
1    995  45263
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9551806, 'precision': 0.9578234, 'recall': 0.95515776, 'specificity': 0.95515776, 'f1': 0.95511425, 'auroc': 0.9934888, 'binary_precision': 0.9924573, 'binary_recall': 0.91727847, 'binary_specificity': 0.99303705, 'binary_f1_score': 0.95338815}
confusion matrix:
       0      1
0  51057    358
1   4248  47105
early stop counter: 3
val acc:0.9856947660446167, best validation acc: 0.9858993887901306, corresponding to test acc:                         0.961875319480896 / 0.9649988412857056
after epoch: 7,now: 2024-08-13 14:05:33.267341,epoch time: 3:00:57.118076,used: 19:37:52.019099,model: dset_te_4_erm_b8efecac6_not_commited_2024md_08md_12_18_27_40_seed_0_24146772
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
Experiment finished at epoch: 7 with time: 19:37:52.019099 at 2024-08-13 14:05:33.267341
persisted model performance metric: 

scalar performance:
{'acc': 0.9618753, 'precision': 0.96401864, 'recall': 0.9618549, 'specificity': 0.9618549, 'f1': 0.96183, 'auroc': 0.9963009, 'binary_precision': 0.9954047, 'binary_recall': 0.92798865, 'binary_specificity': 0.9957211, 'binary_f1_score': 0.9605152}
confusion matrix:
       0      1
0  51195    220
1   3698  47655
oracle model performance metric: 

scalar performance:
{'acc': 0.96499884, 'precision': 0.96597624, 'recall': 0.9649851, 'specificity': 0.9649851, 'f1': 0.96497977, 'auroc': 0.99319917, 'binary_precision': 0.98716694, 'binary_recall': 0.94220394, 'binary_specificity': 0.9877662, 'binary_f1_score': 0.9641615}
confusion matrix:
       0      1
0  50786    629
1   2968  48385
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/rule_results/1.csv
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_irm_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-08-12_15-48-32/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 465258 KiB |  26078 MiB |   1067 TiB |   1067 TiB |
|       from large pool | 415111 KiB |  26030 MiB |   1059 TiB |   1059 TiB |
|       from small pool |  50147 KiB |     71 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 465258 KiB |  26078 MiB |   1067 TiB |   1067 TiB |
|       from large pool | 415111 KiB |  26030 MiB |   1059 TiB |   1059 TiB |
|       from small pool |  50147 KiB |     71 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 452278 KiB |  26073 MiB |   1066 TiB |   1066 TiB |
|       from large pool | 407075 KiB |  26026 MiB |   1059 TiB |   1059 TiB |
|       from small pool |  45203 KiB |     67 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  27754 MiB |  27754 MiB |  27754 MiB |      0 B   |
|       from large pool |  27678 MiB |  27678 MiB |  27678 MiB |      0 B   |
|       from small pool |     76 MiB |     76 MiB |     76 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |    769 MiB |   1649 MiB | 514953 GiB | 514953 GiB |
|       from large pool |    750 MiB |   1645 MiB | 507291 GiB | 507290 GiB |
|       from small pool |     19 MiB |     20 MiB |   7662 GiB |   7662 GiB |
|---------------------------------------------------------------------------|
| Allocations           |   20408    |   20779    |  105869 K  |  105849 K  |
|       from large pool |     187    |    1413    |   50533 K  |   50533 K  |
|       from small pool |   20221    |   20517    |   55336 K  |   55316 K  |
|---------------------------------------------------------------------------|
| Active allocs         |   20408    |   20779    |  105869 K  |  105849 K  |
|       from large pool |     187    |    1413    |   50533 K  |   50533 K  |
|       from small pool |   20221    |   20517    |   55336 K  |   55316 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     837    |     837    |     837    |       0    |
|       from large pool |     799    |     799    |     799    |       0    |
|       from small pool |      38    |      38    |      38    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      74    |    6828    |   73126 K  |   73126 K  |
|       from large pool |      40    |     798    |   46188 K  |   46188 K  |
|       from small pool |      34    |    6788    |   26938 K  |   26938 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  26078 MiB |   1067 TiB |   1067 TiB |
|       from large pool |  16640 KiB |  26030 MiB |   1059 TiB |   1059 TiB |
|       from small pool |      0 KiB |     71 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  26078 MiB |   1067 TiB |   1067 TiB |
|       from large pool |  16640 KiB |  26030 MiB |   1059 TiB |   1059 TiB |
|       from small pool |      0 KiB |     71 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  26073 MiB |   1066 TiB |   1066 TiB |
|       from large pool |  16640 KiB |  26026 MiB |   1059 TiB |   1059 TiB |
|       from small pool |      0 KiB |     67 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1224 MiB |  27754 MiB |  27754 MiB |  26530 MiB |
|       from large pool |   1156 MiB |  27678 MiB |  27678 MiB |  26522 MiB |
|       from small pool |     68 MiB |     76 MiB |     76 MiB |      8 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB |   1649 MiB | 514954 GiB | 514954 GiB |
|       from large pool |   3840 KiB |   1645 MiB | 507291 GiB | 507291 GiB |
|       from small pool |      0 KiB |     57 MiB |   7662 GiB |   7662 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |   20779    |  105869 K  |  105869 K  |
|       from large pool |       2    |    1413    |   50533 K  |   50533 K  |
|       from small pool |       0    |   20517    |   55336 K  |   55336 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |   20779    |  105869 K  |  105869 K  |
|       from large pool |       2    |    1413    |   50533 K  |   50533 K  |
|       from small pool |       0    |   20517    |   55336 K  |   55336 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      72    |     837    |     837    |     765    |
|       from large pool |      38    |     799    |     799    |     761    |
|       from small pool |      34    |      38    |      38    |       4    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |    6828    |   73136 K  |   73136 K  |
|       from large pool |       1    |     798    |   46188 K  |   46188 K  |
|       from small pool |       0    |    6788    |   26947 K  |   26947 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Tue Aug 13 15:00:46 2024]
Finished job 0.
1 of 1 steps (100%) done
