Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Jul 29 07:44:11 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_resnet_densenet_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-07-28_19-14-12/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_resnet_densenet_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-07-28_19-14-12/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211

 Experiment start at: 2024-07-29 09:27:29.235407
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.3761676847934723
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96948016, 'precision': 0.9699771, 'recall': 0.96950406, 'specificity': 0.96950406, 'f1': 0.9694732, 'auroc': 0.9942366, 'binary_precision': 0.9856237, 'binary_recall': 0.9529479, 'binary_specificity': 0.9860602, 'binary_f1_score': 0.9690104}
confusion matrix:
        0       1
0  106530    1506
1    5098  103250
---- Validation: 
scalar performance:
{'acc': 0.98072886, 'precision': 0.98111236, 'recall': 0.9806831, 'specificity': 0.9806831, 'f1': 0.98072344, 'auroc': 0.99799705, 'binary_precision': 0.99386954, 'binary_recall': 0.96729213, 'binary_specificity': 0.99407405, 'binary_f1_score': 0.9804008}
confusion matrix:
       0      1
0  46299    276
1   1513  44745
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9375389, 'precision': 0.9439535, 'recall': 0.93750274, 'specificity': 0.93750274, 'f1': 0.9373089, 'auroc': 0.9937669, 'binary_precision': 0.9971675, 'binary_recall': 0.877495, 'binary_specificity': 0.99751043, 'binary_f1_score': 0.93351156}
confusion matrix:
       0      1
0  51287    128
1   6291  45062
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-29 16:22:43.290335,epoch time: 6:55:14.054928,used: 6:55:14.054928,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9734962, 'precision': 0.97350484, 'recall': 0.97349346, 'specificity': 0.97349346, 'f1': 0.97349596, 'auroc': 0.99613476, 'binary_precision': 0.97181505, 'binary_recall': 0.9753579, 'binary_specificity': 0.971629, 'binary_f1_score': 0.9735833}
confusion matrix:
        0       1
0  104968    3065
1    2670  105681
---- Validation: 
scalar performance:
{'acc': 0.98639494, 'precision': 0.98640597, 'recall': 0.9863889, 'specificity': 0.9863889, 'f1': 0.9863945, 'auroc': 0.99868226, 'binary_precision': 0.9880258, 'binary_recall': 0.9846297, 'binary_specificity': 0.98814815, 'binary_f1_score': 0.9863248}
confusion matrix:
       0      1
0  46023    552
1    711  45547
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9657773, 'precision': 0.9668642, 'recall': 0.9657628, 'specificity': 0.9657628, 'f1': 0.96575654, 'auroc': 0.9951508, 'binary_precision': 0.9892407, 'binary_recall': 0.94175607, 'binary_specificity': 0.9897695, 'binary_f1_score': 0.96491456}
confusion matrix:
       0      1
0  50889    526
1   2991  48362
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-29 23:48:03.374056,epoch time: 7:25:20.083721,used: 14:20:34.138649,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97689295, 'precision': 0.9769737, 'recall': 0.97690296, 'specificity': 0.97690296, 'f1': 0.9768923, 'auroc': 0.996588, 'binary_precision': 0.9835587, 'binary_recall': 0.97006947, 'binary_specificity': 0.98373646, 'binary_f1_score': 0.97676754}
confusion matrix:
        0       1
0  106276    1757
1    3243  105108
---- Validation: 
scalar performance:
{'acc': 0.98612565, 'precision': 0.98622036, 'recall': 0.98610425, 'specificity': 0.98610425, 'f1': 0.9861243, 'auroc': 0.99870473, 'binary_precision': 0.992207, 'binary_recall': 0.97985214, 'binary_specificity': 0.9923564, 'binary_f1_score': 0.9859908}
confusion matrix:
       0      1
0  46219    356
1    932  45326
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92738014, 'precision': 0.9356276, 'recall': 0.92733866, 'specificity': 0.92733866, 'f1': 0.92702997, 'auroc': 0.99134827, 'binary_precision': 0.9954172, 'binary_recall': 0.8586256, 'binary_specificity': 0.9960517, 'binary_f1_score': 0.92197514}
confusion matrix:
       0      1
0  51212    203
1   7260  44093
early stop counter: 1
val acc:0.986125648021698, best validation acc: 0.9863949418067932, corresponding to test acc:                         0.9657772779464722 / 0.9657772779464722
after epoch: 3,now: 2024-07-30 08:15:04.138661,epoch time: 8:27:00.764605,used: 22:47:34.903254,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.98054844, 'precision': 0.9806968, 'recall': 0.980562, 'specificity': 0.980562, 'f1': 0.9805473, 'auroc': 0.99755085, 'binary_precision': 0.98951805, 'binary_recall': 0.9714449, 'binary_specificity': 0.989679, 'binary_f1_score': 0.9803982}
confusion matrix:
        0       1
0  106917    1115
1    3094  105258
---- Validation: 
scalar performance:
{'acc': 0.98662114, 'precision': 0.98674643, 'recall': 0.9865962, 'specificity': 0.9865962, 'f1': 0.9866196, 'auroc': 0.998708, 'binary_precision': 0.99374807, 'binary_recall': 0.9793117, 'binary_specificity': 0.9938808, 'binary_f1_score': 0.9864771}
confusion matrix:
       0      1
0  46290    285
1    957  45301
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9583431, 'precision': 0.9606434, 'recall': 0.9583218, 'specificity': 0.9583218, 'f1': 0.9582896, 'auroc': 0.9948039, 'binary_precision': 0.9930451, 'binary_recall': 0.9231009, 'binary_specificity': 0.99354273, 'binary_f1_score': 0.9567964}
confusion matrix:
       0      1
0  51083    332
1   3949  47404
better model found
persisted
after epoch: 4,now: 2024-07-30 16:28:28.418961,epoch time: 8:13:24.280300,used: 1 day, 7:00:59.183554,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.979199, 'precision': 0.97954994, 'recall': 0.9792197, 'specificity': 0.9792197, 'f1': 0.97919583, 'auroc': 0.99753916, 'binary_precision': 0.9928997, 'binary_recall': 0.9653632, 'binary_specificity': 0.9930761, 'binary_f1_score': 0.97893786}
confusion matrix:
        0       1
0  107283     748
1    3753  104600
---- Validation: 
scalar performance:
{'acc': 0.9871274, 'precision': 0.98730594, 'recall': 0.98709726, 'specificity': 0.98709726, 'f1': 0.98712546, 'auroc': 0.9990839, 'binary_precision': 0.9958189, 'binary_recall': 0.97827405, 'binary_specificity': 0.99592054, 'binary_f1_score': 0.9869685}
confusion matrix:
       0      1
0  46385    190
1   1005  45253
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9490016, 'precision': 0.9530057, 'recall': 0.9489733, 'specificity': 0.9489733, 'f1': 0.9488864, 'auroc': 0.9944117, 'binary_precision': 0.99544436, 'binary_recall': 0.90207, 'binary_specificity': 0.99587667, 'binary_f1_score': 0.9464598}
confusion matrix:
       0      1
0  51203    212
1   5029  46324
better model found
persisted
after epoch: 5,now: 2024-07-30 22:18:17.310908,epoch time: 5:49:48.891947,used: 1 day, 12:50:48.075501,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9789356, 'precision': 0.97898895, 'recall': 0.97894394, 'specificity': 0.97894394, 'f1': 0.97893524, 'auroc': 0.9972023, 'binary_precision': 0.98443025, 'binary_recall': 0.97332793, 'binary_specificity': 0.98456, 'binary_f1_score': 0.9788476}
confusion matrix:
        0       1
0  106363    1668
1    2890  105463
---- Validation: 
scalar performance:
{'acc': 0.986675, 'precision': 0.98672175, 'recall': 0.9866607, 'specificity': 0.9866607, 'f1': 0.9866742, 'auroc': 0.9988278, 'binary_precision': 0.9907135, 'binary_recall': 0.9824679, 'binary_specificity': 0.9908535, 'binary_f1_score': 0.98657346}
confusion matrix:
       0      1
0  46149    426
1    811  45447
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9532345, 'precision': 0.95598936, 'recall': 0.95321107, 'specificity': 0.95321107, 'f1': 0.95316195, 'auroc': 0.9918206, 'binary_precision': 0.9912819, 'binary_recall': 0.9144549, 'binary_specificity': 0.9919673, 'binary_f1_score': 0.9513198}
confusion matrix:
       0      1
0  51002    413
1   4393  46960
early stop counter: 1
val acc:0.9866750240325928, best validation acc: 0.987127423286438, corresponding to test acc:                         0.9490016102790833 / 0.9657772779464722
after epoch: 6,now: 2024-07-31 03:55:24.604625,epoch time: 5:37:07.293717,used: 1 day, 18:27:55.369218,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_09_27_29_seed_0_23200211
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
slurmstepd: error: *** JOB 23200211 ON supergpu03 CANCELLED AT 2024-07-31T07:44:16 DUE TO TIME LIMIT ***
