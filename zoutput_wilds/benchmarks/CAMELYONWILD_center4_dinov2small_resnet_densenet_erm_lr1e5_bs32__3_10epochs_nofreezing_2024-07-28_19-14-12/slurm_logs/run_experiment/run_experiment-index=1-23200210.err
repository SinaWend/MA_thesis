Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Jul 29 04:38:05 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_resnet_densenet_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-07-28_19-14-12/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center4_dinov2small_resnet_densenet_erm_lr1e5_bs32__3_10epochs_nofreezing_2024-07-28_19-14-12/rule_results/1.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210

 Experiment start at: 2024-07-29 07:11:15.665794
before training, model accuracy: 0.49969837069511414
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.8797647, 'precision': 0.87986004, 'recall': 0.8797532, 'specificity': 0.8797532, 'f1': 0.8797546, 'auroc': 0.9474403, 'binary_precision': 0.8741967, 'binary_recall': 0.8876142, 'binary_specificity': 0.87189215, 'binary_f1_score': 0.88085437}
confusion matrix:
       0      1
0  94194  13840
1  12177  96173
---- Validation: 
scalar performance:
{'acc': 0.8694322, 'precision': 0.8775782, 'recall': 0.8691819, 'specificity': 0.8691819, 'f1': 0.8686679, 'auroc': 0.95640945, 'binary_precision': 0.93219054, 'binary_recall': 0.7958623, 'binary_specificity': 0.94250137, 'binary_f1_score': 0.8586489}
confusion matrix:
       0      1
0  43897   2678
1   9443  36815
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.72724, 'precision': 0.7398418, 'recall': 0.72730905, 'specificity': 0.72730905, 'f1': 0.7236489, 'auroc': 0.77192366, 'binary_precision': 0.6847141, 'binary_recall': 0.84174246, 'binary_specificity': 0.61287564, 'binary_f1_score': 0.7551514}
confusion matrix:
       0      1
0  31511  19904
1   8127  43226
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-29 11:28:38.804229,epoch time: 4:17:23.138435,used: 4:17:23.138435,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.8937583, 'precision': 0.89375824, 'recall': 0.89375913, 'specificity': 0.89375913, 'f1': 0.89375824, 'auroc': 0.9563389, 'binary_precision': 0.89445037, 'binary_recall': 0.8932369, 'binary_specificity': 0.8942813, 'binary_f1_score': 0.8938432}
confusion matrix:
       0      1
0  96611  11421
1  11568  96784
---- Validation: 
scalar performance:
{'acc': 0.9034072, 'precision': 0.90823853, 'recall': 0.90322256, 'specificity': 0.90322256, 'f1': 0.9030906, 'auroc': 0.9649892, 'binary_precision': 0.95180404, 'binary_recall': 0.8491504, 'binary_specificity': 0.9572947, 'binary_f1_score': 0.8975516}
confusion matrix:
       0      1
0  44586   1989
1   6978  39280
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7024658, 'precision': 0.74290544, 'recall': 0.70258874, 'specificity': 0.70258874, 'f1': 0.689625, 'auroc': 0.73714924, 'binary_precision': 0.6436434, 'binary_recall': 0.9064125, 'binary_specificity': 0.49876496, 'binary_f1_score': 0.7527553}
confusion matrix:
       0      1
0  25644  25771
1   4806  46547
better model found
persisted
after epoch: 2,now: 2024-07-29 19:10:05.244114,epoch time: 7:41:26.439885,used: 11:58:49.578320,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9016794, 'precision': 0.9016825, 'recall': 0.9016775, 'specificity': 0.9016775, 'f1': 0.9016787, 'auroc': 0.9620553, 'binary_precision': 0.9008793, 'binary_recall': 0.9029995, 'binary_specificity': 0.90035546, 'binary_f1_score': 0.9019382}
confusion matrix:
       0      1
0  97269  10765
1  10510  97840
---- Validation: 
scalar performance:
{'acc': 0.9173893, 'precision': 0.91816914, 'recall': 0.91731685, 'specificity': 0.91731685, 'f1': 0.9173403, 'auroc': 0.972355, 'binary_precision': 0.93539435, 'binary_recall': 0.89610445, 'binary_specificity': 0.93852925, 'binary_f1_score': 0.91532797}
confusion matrix:
       0      1
0  43712   2863
1   4806  41452
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.42871323, 'precision': 0.42335194, 'recall': 0.42863402, 'specificity': 0.42863402, 'f1': 0.4186515, 'auroc': 0.50326383, 'binary_precision': 0.40292916, 'binary_recall': 0.29733413, 'binary_specificity': 0.5599339, 'binary_f1_score': 0.34217015}
confusion matrix:
       0      1
0  28789  22626
1  36084  15269
better model found
persisted
after epoch: 3,now: 2024-07-30 02:21:26.777337,epoch time: 7:11:21.533223,used: 19:10:11.111543,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.90602815, 'precision': 0.90607756, 'recall': 0.90603673, 'specificity': 0.90603673, 'f1': 0.90602636, 'auroc': 0.96500516, 'binary_precision': 0.9109482, 'binary_recall': 0.90035534, 'binary_specificity': 0.91171813, 'binary_f1_score': 0.90562075}
confusion matrix:
       0      1
0  98492   9537
1  10797  97558
---- Validation: 
scalar performance:
{'acc': 0.919813, 'precision': 0.92075336, 'recall': 0.91973364, 'specificity': 0.91973364, 'f1': 0.9197571, 'auroc': 0.97514844, 'binary_precision': 0.9398087, 'binary_recall': 0.89649355, 'binary_specificity': 0.9429737, 'binary_f1_score': 0.91764027}
confusion matrix:
       0      1
0  43919   2656
1   4788  41470
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6414254, 'precision': 0.64374876, 'recall': 0.64146346, 'specificity': 0.64146346, 'f1': 0.6400082, 'auroc': 0.6839232, 'binary_precision': 0.62532187, 'binary_recall': 0.7045937, 'binary_specificity': 0.5783332, 'binary_f1_score': 0.6625953}
confusion matrix:
       0      1
0  29735  21680
1  15170  36183
better model found
persisted
after epoch: 4,now: 2024-07-30 10:44:36.731370,epoch time: 8:23:09.954033,used: 1 day, 3:33:21.065576,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.91418034, 'precision': 0.91526645, 'recall': 0.91421866, 'specificity': 0.91421866, 'f1': 0.9141294, 'auroc': 0.9702175, 'binary_precision': 0.936879, 'binary_recall': 0.88847566, 'binary_specificity': 0.9399617, 'binary_f1_score': 0.9120356}
confusion matrix:
        0      1
0  101545   6486
1   12084  96269
---- Validation: 
scalar performance:
{'acc': 0.9264809, 'precision': 0.9281446, 'recall': 0.926376, 'specificity': 0.926376, 'f1': 0.92639637, 'auroc': 0.97399366, 'binary_precision': 0.95399386, 'binary_recall': 0.8956505, 'binary_specificity': 0.95710146, 'binary_f1_score': 0.92390203}
confusion matrix:
       0      1
0  44577   1998
1   4827  41431
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.53171223, 'precision': 0.53445566, 'recall': 0.53162575, 'specificity': 0.53162575, 'f1': 0.52185297, 'auroc': 0.6497202, 'binary_precision': 0.5440286, 'binary_recall': 0.3883512, 'binary_specificity': 0.6749003, 'binary_f1_score': 0.45319334}
confusion matrix:
       0      1
0  34700  16715
1  31410  19943
better model found
persisted
after epoch: 5,now: 2024-07-30 17:56:31.469016,epoch time: 7:11:54.737646,used: 1 day, 10:45:15.803222,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.92091376, 'precision': 0.9210762, 'recall': 0.92092824, 'specificity': 0.92092824, 'f1': 0.92090774, 'auroc': 0.9743778, 'binary_precision': 0.92971796, 'binary_recall': 0.9109175, 'binary_specificity': 0.930939, 'binary_f1_score': 0.9202217}
confusion matrix:
        0      1
0  100574   7461
1    9652  98697
---- Validation: 
scalar performance:
{'acc': 0.94151866, 'precision': 0.9418005, 'recall': 0.94147724, 'specificity': 0.94147724, 'f1': 0.94150484, 'auroc': 0.9846847, 'binary_precision': 0.95213836, 'binary_recall': 0.92935276, 'binary_specificity': 0.9536017, 'binary_f1_score': 0.9406076}
confusion matrix:
       0      1
0  44414   2161
1   3268  42990
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5001557, 'precision': 0.49994957, 'recall': 0.4999689, 'specificity': 0.4999689, 'f1': 0.4470509, 'auroc': 0.6258726, 'binary_precision': 0.4996167, 'binary_recall': 0.19036862, 'binary_specificity': 0.8095692, 'binary_f1_score': 0.2756909}
confusion matrix:
       0     1
0  41624  9791
1  41577  9776
better model found
persisted
after epoch: 6,now: 2024-07-30 23:33:17.091560,epoch time: 5:36:45.622544,used: 1 day, 16:22:01.425766,model: dset_te_4_erm_b8efecac6_not_commited_2024md_07md_29_07_11_14_seed_0_23200210
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.92250353, 'precision': 0.9225131, 'recall': 0.92250025, 'specificity': 0.92250025, 'f1': 0.9225025, 'auroc': 0.97564256, 'binary_precision': 0.92083377, 'binary_recall': 0.92473465, 'binary_specificity': 0.92026585, 'binary_f1_score': 0.9227801}
confusion matrix:
       0       1
0  99420    8614
1   8155  100195
---- Validation: 
scalar performance:
{'acc': 0.94472873, 'precision': 0.9450754, 'recall': 0.94468284, 'specificity': 0.94468284, 'f1': 0.9447134, 'auroc': 0.9858513, 'binary_precision': 0.9566724, 'binary_recall': 0.93125516, 'binary_specificity': 0.9581106, 'binary_f1_score': 0.9437927}
confusion matrix:
       0      1
0  44624   1951
1   3180  43078
---- Test Domain (oracle): 
slurmstepd: error: *** JOB 23200210 ON supergpu03 CANCELLED AT 2024-07-31T04:38:16 DUE TO TIME LIMIT ***
