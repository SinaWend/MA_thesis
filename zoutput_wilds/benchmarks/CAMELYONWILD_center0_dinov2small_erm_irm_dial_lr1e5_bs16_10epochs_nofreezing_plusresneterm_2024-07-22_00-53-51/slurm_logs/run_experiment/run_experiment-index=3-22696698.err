Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Jul 22 10:29:25 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/rule_results/3.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=3
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698

 Experiment start at: 2024-07-22 12:19:36.958951
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.5626667737960815
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9654191, 'precision': 0.96576816, 'recall': 0.9654304, 'specificity': 0.9654304, 'f1': 0.9654132, 'auroc': 0.99418044, 'binary_precision': 0.97872436, 'binary_recall': 0.95158005, 'binary_specificity': 0.9792807, 'binary_f1_score': 0.96496135}
confusion matrix:
        0       1
0  135790    2873
1    6725  132164
---- Validation: 
scalar performance:
{'acc': 0.9700235, 'precision': 0.9708767, 'recall': 0.9699842, 'specificity': 0.9699842, 'f1': 0.970008, 'auroc': 0.9970798, 'binary_precision': 0.9904549, 'binary_recall': 0.9490803, 'binary_specificity': 0.99088806, 'binary_f1_score': 0.9693263}
confusion matrix:
       0      1
0  59049    543
1   3023  56345
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95589894, 'precision': 0.95670485, 'recall': 0.95591474, 'specificity': 0.95591474, 'f1': 0.9558805, 'auroc': 0.9922639, 'binary_precision': 0.976077, 'binary_recall': 0.9347743, 'binary_specificity': 0.9770552, 'binary_f1_score': 0.9549793}
confusion matrix:
       0      1
0  20312    477
1   1358  19462
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-22 19:16:03.851509,epoch time: 6:56:26.892558,used: 6:56:26.892558,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96721333, 'precision': 0.9686519, 'recall': 0.9672362, 'specificity': 0.9672362, 'f1': 0.9671893, 'auroc': 0.9956572, 'binary_precision': 0.9948226, 'binary_recall': 0.93936926, 'binary_specificity': 0.9951032, 'binary_f1_score': 0.966301}
confusion matrix:
        0       1
0  137983     679
1    8421  130469
---- Validation: 
scalar performance:
{'acc': 0.97210824, 'precision': 0.9733927, 'recall': 0.97205997, 'specificity': 0.97205997, 'f1': 0.97208714, 'auroc': 0.9978509, 'binary_precision': 0.9975853, 'binary_recall': 0.9464021, 'binary_specificity': 0.9977178, 'binary_f1_score': 0.97131985}
confusion matrix:
       0      1
0  59456    136
1   3182  56186
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96032107, 'precision': 0.9627003, 'recall': 0.9603479, 'specificity': 0.9603479, 'f1': 0.9602716, 'auroc': 0.99482775, 'binary_precision': 0.99606645, 'binary_recall': 0.9243516, 'binary_specificity': 0.9963442, 'binary_f1_score': 0.95886993}
confusion matrix:
       0      1
0  20713     76
1   1575  19245
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-23 01:32:44.018592,epoch time: 6:16:40.167083,used: 13:13:07.059641,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9771106, 'precision': 0.9771359, 'recall': 0.9771078, 'specificity': 0.9771078, 'f1': 0.97711015, 'auroc': 0.9972278, 'binary_precision': 0.973857, 'binary_recall': 0.98058134, 'binary_specificity': 0.9736343, 'binary_f1_score': 0.9772076}
confusion matrix:
        0       1
0  135009    3656
1    2697  136190
---- Validation: 
scalar performance:
{'acc': 0.98591965, 'precision': 0.9859233, 'recall': 0.9859232, 'specificity': 0.9859232, 'f1': 0.9859196, 'auroc': 0.9987359, 'binary_precision': 0.9840423, 'binary_recall': 0.9878049, 'binary_specificity': 0.98404145, 'binary_f1_score': 0.98592}
confusion matrix:
       0      1
0  58641    951
1    724  58644
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9742604, 'precision': 0.9743049, 'recall': 0.97426414, 'specificity': 0.97426414, 'f1': 0.97425985, 'auroc': 0.9953064, 'binary_precision': 0.97908884, 'binary_recall': 0.96926033, 'binary_specificity': 0.9792679, 'binary_f1_score': 0.97414976}
confusion matrix:
       0      1
0  20358    431
1    640  20180
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-23 06:09:02.218483,epoch time: 4:36:18.199891,used: 17:49:25.259532,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9804613, 'precision': 0.9804847, 'recall': 0.9804586, 'specificity': 0.9804586, 'f1': 0.980461, 'auroc': 0.9980236, 'binary_precision': 0.97732556, 'binary_recall': 0.9837783, 'binary_specificity': 0.977139, 'binary_f1_score': 0.9805413}
confusion matrix:
        0       1
0  135494    3170
1    2253  136635
---- Validation: 
scalar performance:
{'acc': 0.98928213, 'precision': 0.9892819, 'recall': 0.9892837, 'specificity': 0.9892837, 'f1': 0.98928213, 'auroc': 0.99913186, 'binary_precision': 0.98844737, 'binary_recall': 0.9900957, 'binary_specificity': 0.9884716, 'binary_f1_score': 0.98927087}
confusion matrix:
       0      1
0  58905    687
1    588  58780
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97916317, 'precision': 0.9793675, 'recall': 0.979171, 'specificity': 0.979171, 'f1': 0.97916114, 'auroc': 0.99668145, 'binary_precision': 0.989452, 'binary_recall': 0.96868396, 'binary_specificity': 0.989658, 'binary_f1_score': 0.97895783}
confusion matrix:
       0      1
0  20574    215
1    652  20168
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-07-23 12:17:49.066783,epoch time: 6:08:46.848300,used: 23:58:12.107832,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98211145, 'precision': 0.9821372, 'recall': 0.98211455, 'specificity': 0.98211455, 'f1': 0.9821113, 'auroc': 0.9980222, 'binary_precision': 0.98586553, 'binary_recall': 0.97827744, 'binary_specificity': 0.98595166, 'binary_f1_score': 0.9820568}
confusion matrix:
        0       1
0  136716    1948
1    3017  135871
---- Validation: 
scalar performance:
{'acc': 0.98785305, 'precision': 0.9879032, 'recall': 0.9878443, 'specificity': 0.9878443, 'f1': 0.9878525, 'auroc': 0.99898255, 'binary_precision': 0.99240017, 'binary_recall': 0.9831896, 'binary_specificity': 0.992499, 'binary_f1_score': 0.98777336}
confusion matrix:
       0      1
0  59145    447
1    998  58370
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9695258, 'precision': 0.9698769, 'recall': 0.9695361, 'specificity': 0.9695361, 'f1': 0.96952057, 'auroc': 0.99416137, 'binary_precision': 0.9829085, 'binary_recall': 0.95571566, 'binary_specificity': 0.9833566, 'binary_f1_score': 0.96912134}
confusion matrix:
       0      1
0  20443    346
1    922  19898
early stop counter: 1
val acc:0.9878530502319336, best validation acc: 0.9892821311950684, corresponding to test acc:                         0.9791631698608398 / 0.9791631698608398
after epoch: 5,now: 2024-07-23 19:40:30.151506,epoch time: 7:22:41.084723,used: 1 day, 7:20:53.192555,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9822448, 'precision': 0.98225915, 'recall': 0.9822471, 'specificity': 0.9822471, 'f1': 0.98224473, 'auroc': 0.99819005, 'binary_precision': 0.98510206, 'binary_recall': 0.9793285, 'binary_specificity': 0.9851657, 'binary_f1_score': 0.9822068}
confusion matrix:
        0       1
0  136608    2057
1    2871  136016
---- Validation: 
scalar performance:
{'acc': 0.98865163, 'precision': 0.98869133, 'recall': 0.98864394, 'specificity': 0.98864394, 'f1': 0.9886513, 'auroc': 0.9991943, 'binary_precision': 0.9926466, 'binary_recall': 0.984554, 'binary_specificity': 0.9927339, 'binary_f1_score': 0.9885838}
confusion matrix:
       0      1
0  59159    433
1    917  58451
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95988846, 'precision': 0.961702, 'recall': 0.95991194, 'specificity': 0.95991194, 'f1': 0.9598505, 'auroc': 0.9932078, 'binary_precision': 0.99082476, 'binary_recall': 0.9284342, 'binary_specificity': 0.9913897, 'binary_f1_score': 0.95861536}
confusion matrix:
       0      1
0  20610    179
1   1490  19330
early stop counter: 2
val acc:0.9886516332626343, best validation acc: 0.9892821311950684, corresponding to test acc:                         0.9791631698608398 / 0.9791631698608398
after epoch: 6,now: 2024-07-24 03:37:01.948621,epoch time: 7:56:31.797115,used: 1 day, 15:17:24.989670,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_12_19_36_seed_0_22696698
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9855847, 'precision': 0.98565984, 'recall': 0.98559, 'specificity': 0.98559, 'f1': 0.98558426, 'auroc': 0.9987552, 'binary_precision': 0.9919114, 'binary_recall': 0.9791778, 'binary_specificity': 0.9920021, 'binary_f1_score': 0.9855035}
confusion matrix:
        0       1
0  137553    1109
1    2892  135998
---- Validation: 
slurmstepd: error: *** JOB 22696698 ON gpusrv12 CANCELLED AT 2024-07-24T10:29:42 DUE TO TIME LIMIT ***
