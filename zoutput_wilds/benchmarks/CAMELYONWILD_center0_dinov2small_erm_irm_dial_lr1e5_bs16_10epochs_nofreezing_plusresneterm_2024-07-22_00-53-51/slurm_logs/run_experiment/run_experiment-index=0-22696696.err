Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Jul 22 00:54:14 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696

 Experiment start at: 2024-07-22 03:33:25.539136
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.5626667737960815
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9608182, 'precision': 0.9608194, 'recall': 0.960819, 'specificity': 0.960819, 'f1': 0.9608182, 'auroc': 0.99272025, 'binary_precision': 0.9618104, 'binary_recall': 0.95980906, 'binary_specificity': 0.9618289, 'binary_f1_score': 0.96080875}
confusion matrix:
        0       1
0  133372    5293
1    5582  133305
---- Validation: 
scalar performance:
{'acc': 0.97668123, 'precision': 0.97674555, 'recall': 0.976671, 'specificity': 0.976671, 'f1': 0.97668, 'auroc': 0.9971721, 'binary_precision': 0.9818315, 'binary_recall': 0.97124714, 'binary_specificity': 0.9820949, 'binary_f1_score': 0.9765106}
confusion matrix:
       0      1
0  58525   1067
1   1707  57661
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9586628, 'precision': 0.95872945, 'recall': 0.9586674, 'specificity': 0.9586674, 'f1': 0.95866156, 'auroc': 0.9919536, 'binary_precision': 0.964449, 'binary_recall': 0.9524976, 'binary_specificity': 0.9648372, 'binary_f1_score': 0.958436}
confusion matrix:
       0      1
0  20058    731
1    989  19831
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-22 08:39:57.212381,epoch time: 5:06:31.673245,used: 5:06:31.673245,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9770277, 'precision': 0.9772152, 'recall': 0.97703576, 'specificity': 0.97703576, 'f1': 0.97702575, 'auroc': 0.9968407, 'binary_precision': 0.98687565, 'binary_recall': 0.96695155, 'binary_specificity': 0.98712003, 'binary_f1_score': 0.97681206}
confusion matrix:
        0       1
0  136879    1786
1    4590  134297
---- Validation: 
scalar performance:
{'acc': 0.98385173, 'precision': 0.9840758, 'recall': 0.98383224, 'specificity': 0.98383224, 'f1': 0.9838493, 'auroc': 0.99854505, 'binary_precision': 0.9940317, 'binary_recall': 0.9734874, 'binary_specificity': 0.99417704, 'binary_f1_score': 0.98365235}
confusion matrix:
       0      1
0  59245    347
1   1574  57794
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9757985, 'precision': 0.97621816, 'recall': 0.9758097, 'specificity': 0.9758097, 'f1': 0.9757936, 'auroc': 0.99637735, 'binary_precision': 0.99054223, 'binary_recall': 0.9608069, 'binary_specificity': 0.9908124, 'binary_f1_score': 0.975448}
confusion matrix:
       0      1
0  20598    191
1    816  20004
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-22 14:04:02.516832,epoch time: 5:24:05.304451,used: 10:30:36.977696,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97322303, 'precision': 0.97324574, 'recall': 0.97322035, 'specificity': 0.97322035, 'f1': 0.9732226, 'auroc': 0.99646825, 'binary_precision': 0.9701641, 'binary_recall': 0.97652066, 'binary_specificity': 0.9699201, 'binary_f1_score': 0.973332}
confusion matrix:
        0       1
0  134493    4171
1    3261  135627
---- Validation: 
scalar performance:
{'acc': 0.98580194, 'precision': 0.98581195, 'recall': 0.9857984, 'specificity': 0.9857984, 'f1': 0.9858017, 'auroc': 0.99852586, 'binary_precision': 0.98759025, 'binary_recall': 0.9839139, 'binary_specificity': 0.98768294, 'binary_f1_score': 0.9857486}
confusion matrix:
       0      1
0  58858    734
1    955  58413
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9730587, 'precision': 0.97334945, 'recall': 0.97306806, 'specificity': 0.97306806, 'f1': 0.973055, 'auroc': 0.9944342, 'binary_precision': 0.9852688, 'binary_recall': 0.9605187, 'binary_specificity': 0.9856174, 'binary_f1_score': 0.97273636}
confusion matrix:
       0      1
0  20490    299
1    822  19998
better model found
persisted
after epoch: 3,now: 2024-07-22 19:16:03.853315,epoch time: 5:12:01.336483,used: 15:42:38.314179,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97185755, 'precision': 0.97275007, 'recall': 0.9718752, 'specificity': 0.9718752, 'f1': 0.9718449, 'auroc': 0.9971349, 'binary_precision': 0.9934942, 'binary_recall': 0.9499813, 'binary_specificity': 0.9937691, 'binary_f1_score': 0.9712506}
confusion matrix:
        0       1
0  137800     864
1    6947  131941
---- Validation: 
scalar performance:
{'acc': 0.9789005, 'precision': 0.9795205, 'recall': 0.9788674, 'specificity': 0.9788674, 'f1': 0.9788925, 'auroc': 0.99854696, 'binary_precision': 0.996299, 'binary_recall': 0.96129227, 'binary_specificity': 0.9964425, 'binary_f1_score': 0.9784826}
confusion matrix:
       0      1
0  59380    212
1   2298  57070
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9538561, 'precision': 0.95724463, 'recall': 0.9538883, 'specificity': 0.9538883, 'f1': 0.9537728, 'auroc': 0.9947921, 'binary_precision': 0.9967932, 'binary_recall': 0.9107109, 'binary_specificity': 0.9970658, 'binary_f1_score': 0.9518097}
confusion matrix:
       0      1
0  20728     61
1   1859  18961
early stop counter: 1
val acc:0.9789004921913147, best validation acc: 0.9858019351959229, corresponding to test acc:                         0.9730587005615234 / 0.975798487663269
after epoch: 4,now: 2024-07-23 00:55:15.396793,epoch time: 5:39:11.543478,used: 21:21:49.857657,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.978314, 'precision': 0.9783335, 'recall': 0.97831154, 'specificity': 0.97831154, 'f1': 0.9783137, 'auroc': 0.9975827, 'binary_precision': 0.97547275, 'binary_recall': 0.98133737, 'binary_specificity': 0.97528577, 'binary_f1_score': 0.9783963}
confusion matrix:
        0       1
0  135238    3427
1    2592  136295
---- Validation: 
scalar performance:
{'acc': 0.98756725, 'precision': 0.9875706, 'recall': 0.9875654, 'specificity': 0.9875654, 'f1': 0.9875671, 'auroc': 0.99904525, 'binary_precision': 0.9884571, 'binary_recall': 0.9866089, 'binary_specificity': 0.98852193, 'binary_f1_score': 0.98753214}
confusion matrix:
       0      1
0  58908    684
1    795  58573
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97135234, 'precision': 0.97193444, 'recall': 0.9713656, 'specificity': 0.9713656, 'f1': 0.9713441, 'auroc': 0.9950178, 'binary_precision': 0.98869634, 'binary_recall': 0.95365036, 'binary_specificity': 0.9890808, 'binary_f1_score': 0.9708572}
confusion matrix:
       0      1
0  20562    227
1    965  19855
better model found
persisted
after epoch: 5,now: 2024-07-23 04:33:30.725718,epoch time: 3:38:15.328925,used: 1 day, 1:00:05.186582,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.980573, 'precision': 0.98059905, 'recall': 0.9805702, 'specificity': 0.9805702, 'f1': 0.9805727, 'auroc': 0.9980505, 'binary_precision': 0.97725534, 'binary_recall': 0.9840806, 'binary_specificity': 0.97705984, 'binary_f1_score': 0.98065615}
confusion matrix:
        0       1
0  135484    3181
1    2211  136676
---- Validation: 
scalar performance:
{'acc': 0.98904675, 'precision': 0.98904675, 'recall': 0.9890485, 'specificity': 0.9890485, 'f1': 0.9890467, 'auroc': 0.9991329, 'binary_precision': 0.988097, 'binary_recall': 0.9899778, 'binary_specificity': 0.9881192, 'binary_f1_score': 0.9890365}
confusion matrix:
       0      1
0  58884    708
1    595  58773
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9738999, 'precision': 0.9740407, 'recall': 0.9739064, 'specificity': 0.9739064, 'f1': 0.9738982, 'auroc': 0.99528986, 'binary_precision': 0.9823995, 'binary_recall': 0.9651297, 'binary_specificity': 0.9826831, 'binary_f1_score': 0.97368807}
confusion matrix:
       0      1
0  20429    360
1    726  20094
better model found
persisted
after epoch: 6,now: 2024-07-23 08:00:17.657297,epoch time: 3:26:46.931579,used: 1 day, 4:26:52.118161,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9791499, 'precision': 0.97926116, 'recall': 0.9791561, 'specificity': 0.9791561, 'f1': 0.9791488, 'auroc': 0.9976605, 'binary_precision': 0.98676836, 'binary_recall': 0.971358, 'binary_specificity': 0.98695415, 'binary_f1_score': 0.97900254}
confusion matrix:
        0       1
0  136856    1809
1    3978  134909
---- Validation: 
scalar performance:
{'acc': 0.9840703, 'precision': 0.984255, 'recall': 0.98405266, 'specificity': 0.98405266, 'f1': 0.9840683, 'auroc': 0.9987701, 'binary_precision': 0.99325424, 'binary_recall': 0.97470015, 'binary_specificity': 0.99340516, 'binary_f1_score': 0.9838897}
confusion matrix:
       0      1
0  59199    393
1   1502  57866
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9671465, 'precision': 0.9681139, 'recall': 0.96716356, 'specificity': 0.96716356, 'f1': 0.9671303, 'auroc': 0.9937812, 'binary_precision': 0.9895807, 'binary_recall': 0.9442843, 'binary_specificity': 0.9900428, 'binary_f1_score': 0.96640193}
confusion matrix:
       0      1
0  20582    207
1   1160  19660
early stop counter: 1
val acc:0.9840703010559082, best validation acc: 0.9890467524528503, corresponding to test acc:                         0.9738999009132385 / 0.975798487663269
after epoch: 7,now: 2024-07-23 13:15:41.992913,epoch time: 5:15:24.335616,used: 1 day, 9:42:16.453777,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9834626, 'precision': 0.9835957, 'recall': 0.9834695, 'specificity': 0.9834695, 'f1': 0.98346156, 'auroc': 0.99853694, 'binary_precision': 0.99182606, 'binary_recall': 0.9749872, 'binary_specificity': 0.9919517, 'binary_f1_score': 0.9833345}
confusion matrix:
        0       1
0  137547    1116
1    3474  135415
---- Validation: 
scalar performance:
{'acc': 0.9880632, 'precision': 0.9881772, 'recall': 0.9880496, 'specificity': 0.9880496, 'f1': 0.98806226, 'auroc': 0.9992707, 'binary_precision': 0.9951805, 'binary_recall': 0.98083144, 'binary_specificity': 0.9952678, 'binary_f1_score': 0.98795384}
confusion matrix:
       0      1
0  59310    282
1   1138  58230
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9622197, 'precision': 0.9639399, 'recall': 0.9622425, 'specificity': 0.9622425, 'f1': 0.962186, 'auroc': 0.99375653, 'binary_precision': 0.992377, 'binary_recall': 0.93165225, 'binary_specificity': 0.9928327, 'binary_f1_score': 0.96105635}
confusion matrix:
       0      1
0  20640    149
1   1423  19397
early stop counter: 2
val acc:0.9880632162094116, best validation acc: 0.9890467524528503, corresponding to test acc:                         0.9738999009132385 / 0.975798487663269
after epoch: 8,now: 2024-07-23 22:07:02.435634,epoch time: 8:51:20.442721,used: 1 day, 18:33:36.896498,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696696
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
slurmstepd: error: *** JOB 22696696 ON supergpu03 CANCELLED AT 2024-07-24T00:54:39 DUE TO TIME LIMIT ***
