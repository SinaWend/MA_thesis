Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Jul 22 00:54:12 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694

 Experiment start at: 2024-07-22 03:33:25.558723
before training, model accuracy: 0.5626667737960815
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96495074, 'precision': 0.9654046, 'recall': 0.9649633, 'specificity': 0.9649633, 'f1': 0.9649428, 'auroc': 0.9926736, 'binary_precision': 0.9801414, 'binary_recall': 0.9491889, 'binary_specificity': 0.98073775, 'binary_f1_score': 0.96441686}
confusion matrix:
        0       1
0  135994    2671
1    7057  131830
---- Validation: 
scalar performance:
{'acc': 0.9760424, 'precision': 0.97627264, 'recall': 0.97602236, 'specificity': 0.97602236, 'f1': 0.9760387, 'auroc': 0.996387, 'binary_precision': 0.9862851, 'binary_recall': 0.96541905, 'binary_specificity': 0.98662573, 'binary_f1_score': 0.97574055}
confusion matrix:
       0      1
0  58795    797
1   2053  57315
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9681079, 'precision': 0.9681144, 'recall': 0.96810657, 'specificity': 0.96810657, 'f1': 0.9681077, 'auroc': 0.9949256, 'binary_precision': 0.96654063, 'binary_recall': 0.9698367, 'binary_specificity': 0.9663764, 'binary_f1_score': 0.9681859}
confusion matrix:
       0      1
0  20090    699
1    628  20192
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-22 07:08:43.850210,epoch time: 3:35:18.291487,used: 3:35:18.291487,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96919495, 'precision': 0.97008467, 'recall': 0.96921265, 'specificity': 0.96921265, 'f1': 0.9691812, 'auroc': 0.99505615, 'binary_precision': 0.9907378, 'binary_recall': 0.94729567, 'binary_specificity': 0.99112964, 'binary_f1_score': 0.9685298}
confusion matrix:
        0       1
0  137434    1230
1    7320  131568
---- Validation: 
scalar performance:
{'acc': 0.98065734, 'precision': 0.9810194, 'recall': 0.9806323, 'specificity': 0.9806323, 'f1': 0.9806529, 'auroc': 0.99770916, 'binary_precision': 0.99375314, 'binary_recall': 0.96732247, 'binary_specificity': 0.99394214, 'binary_f1_score': 0.98035973}
confusion matrix:
       0      1
0  59231    361
1   1940  57428
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9738518, 'precision': 0.97404927, 'recall': 0.97385955, 'specificity': 0.97385955, 'f1': 0.9738494, 'auroc': 0.99512315, 'binary_precision': 0.9839121, 'binary_recall': 0.9634966, 'binary_specificity': 0.9842224, 'binary_f1_score': 0.9735974}
confusion matrix:
       0      1
0  20461    328
1    760  20060
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-22 10:34:21.014425,epoch time: 3:25:37.164215,used: 7:00:55.455702,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97271144, 'precision': 0.9730662, 'recall': 0.9727226, 'specificity': 0.9727226, 'f1': 0.9727068, 'auroc': 0.99540186, 'binary_precision': 0.98622566, 'binary_recall': 0.9588589, 'binary_specificity': 0.9865863, 'binary_f1_score': 0.9723498}
confusion matrix:
        0       1
0  136804    1860
1    5714  133174
---- Validation: 
scalar performance:
{'acc': 0.9820948, 'precision': 0.98231983, 'recall': 0.9820753, 'specificity': 0.9820753, 'f1': 0.98209214, 'auroc': 0.99793196, 'binary_precision': 0.9922767, 'binary_recall': 0.9716851, 'binary_specificity': 0.99246544, 'binary_f1_score': 0.981873}
confusion matrix:
       0      1
0  59143    449
1   1681  57687
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96844435, 'precision': 0.9689627, 'recall': 0.96845686, 'specificity': 0.96845686, 'f1': 0.96843624, 'auroc': 0.99240017, 'binary_precision': 0.9847423, 'binary_recall': 0.9516811, 'binary_specificity': 0.9852326, 'binary_f1_score': 0.9679295}
confusion matrix:
       0      1
0  20482    307
1   1006  19814
better model found
persisted
after epoch: 3,now: 2024-07-22 14:04:02.570764,epoch time: 3:29:41.556339,used: 10:30:37.012041,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97654134, 'precision': 0.9767178, 'recall': 0.9765491, 'specificity': 0.9765491, 'f1': 0.9765395, 'auroc': 0.9965942, 'binary_precision': 0.9860902, 'binary_recall': 0.9667569, 'binary_specificity': 0.9863413, 'binary_f1_score': 0.9763279}
confusion matrix:
        0       1
0  136772    1894
1    4617  134269
---- Validation: 
scalar performance:
{'acc': 0.9840871, 'precision': 0.98433805, 'recall': 0.9840665, 'specificity': 0.9840665, 'f1': 0.9840845, 'auroc': 0.99868417, 'binary_precision': 0.99490243, 'binary_recall': 0.9731, 'binary_specificity': 0.9950329, 'binary_f1_score': 0.98388046}
confusion matrix:
       0      1
0  59296    296
1   1597  57771
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97337115, 'precision': 0.97408026, 'recall': 0.9733857, 'specificity': 0.9733857, 'f1': 0.97336173, 'auroc': 0.9949808, 'binary_precision': 0.99260294, 'binary_recall': 0.9538905, 'binary_specificity': 0.9928808, 'binary_f1_score': 0.97286177}
confusion matrix:
       0      1
0  20641    148
1    960  19860
better model found
persisted
after epoch: 4,now: 2024-07-22 17:46:24.727303,epoch time: 3:42:22.156539,used: 14:12:59.168580,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9787283, 'precision': 0.9787294, 'recall': 0.9787278, 'specificity': 0.9787278, 'f1': 0.9787283, 'auroc': 0.9973096, 'binary_precision': 0.978181, 'binary_recall': 0.979336, 'binary_specificity': 0.9781196, 'binary_f1_score': 0.97875816}
confusion matrix:
        0       1
0  135629    3034
1    2870  136019
---- Validation: 
scalar performance:
{'acc': 0.98536485, 'precision': 0.985376, 'recall': 0.98536104, 'specificity': 0.98536104, 'f1': 0.98536456, 'auroc': 0.9984319, 'binary_precision': 0.98728245, 'binary_recall': 0.9833412, 'binary_specificity': 0.98738086, 'binary_f1_score': 0.9853078}
confusion matrix:
       0      1
0  58840    752
1    989  58379
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9707275, 'precision': 0.9708352, 'recall': 0.9707332, 'specificity': 0.9707332, 'f1': 0.970726, 'auroc': 0.9927695, 'binary_precision': 0.9781442, 'binary_recall': 0.96301633, 'binary_specificity': 0.9784501, 'binary_f1_score': 0.97052133}
confusion matrix:
       0      1
0  20341    448
1    770  20050
better model found
persisted
after epoch: 5,now: 2024-07-22 21:21:42.109864,epoch time: 3:35:17.382561,used: 17:48:16.551141,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9800218, 'precision': 0.98016214, 'recall': 0.9800288, 'specificity': 0.9800288, 'f1': 0.9800205, 'auroc': 0.99748856, 'binary_precision': 0.9885755, 'binary_recall': 0.9713006, 'binary_specificity': 0.988757, 'binary_f1_score': 0.979862}
confusion matrix:
        0       1
0  137105    1559
1    3986  134902
---- Validation: 
scalar performance:
{'acc': 0.98816407, 'precision': 0.98824346, 'recall': 0.98815286, 'specificity': 0.98815286, 'f1': 0.98816335, 'auroc': 0.9990468, 'binary_precision': 0.9940166, 'binary_recall': 0.9821958, 'binary_specificity': 0.9941099, 'binary_f1_score': 0.98807085}
confusion matrix:
       0      1
0  59241    351
1   1057  58311
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97736067, 'precision': 0.97780514, 'recall': 0.97737217, 'specificity': 0.97737217, 'f1': 0.9773558, 'auroc': 0.9957669, 'binary_precision': 0.99256617, 'binary_recall': 0.96195966, 'binary_specificity': 0.9927846, 'binary_f1_score': 0.97702324}
confusion matrix:
       0      1
0  20639    150
1    792  20028
new oracle model saved
better model found
persisted
after epoch: 6,now: 2024-07-23 00:55:15.984585,epoch time: 3:33:33.874721,used: 21:21:50.425862,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9781951, 'precision': 0.9782504, 'recall': 0.9781996, 'specificity': 0.9781996, 'f1': 0.9781946, 'auroc': 0.9969537, 'binary_precision': 0.983603, 'binary_recall': 0.9726402, 'binary_specificity': 0.98375905, 'binary_f1_score': 0.9780909}
confusion matrix:
        0       1
0  136410    2252
1    3800  135090
---- Validation: 
scalar performance:
{'acc': 0.98593646, 'precision': 0.98598504, 'recall': 0.9859278, 'specificity': 0.9859278, 'f1': 0.98593587, 'auroc': 0.99853253, 'binary_precision': 0.99039525, 'binary_recall': 0.9813368, 'binary_specificity': 0.99051887, 'binary_f1_score': 0.98584515}
confusion matrix:
       0      1
0  59027    565
1   1108  58260
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97776926, 'precision': 0.9781301, 'recall': 0.9777796, 'specificity': 0.9777796, 'f1': 0.9777653, 'auroc': 0.9961756, 'binary_precision': 0.991453, 'binary_recall': 0.9638809, 'binary_specificity': 0.9916783, 'binary_f1_score': 0.9774725}
confusion matrix:
       0      1
0  20616    173
1    752  20068
new oracle model saved
early stop counter: 1
val acc:0.9859364628791809, best validation acc: 0.9881640672683716, corresponding to test acc:                         0.9773606657981873 / 0.9777692556381226
after epoch: 7,now: 2024-07-23 03:49:30.220591,epoch time: 2:54:14.236006,used: 1 day, 0:16:04.661868,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9786743, 'precision': 0.97912717, 'recall': 0.9786869, 'specificity': 0.9786869, 'f1': 0.97866964, 'auroc': 0.9978366, 'binary_precision': 0.9940625, 'binary_recall': 0.963136, 'binary_specificity': 0.99423784, 'binary_f1_score': 0.9783549}
confusion matrix:
        0       1
0  137864     799
1    5120  133769
---- Validation: 
scalar performance:
{'acc': 0.9843141, 'precision': 0.98461944, 'recall': 0.9842912, 'specificity': 0.9842912, 'f1': 0.984311, 'auroc': 0.9988533, 'binary_precision': 0.99632305, 'binary_recall': 0.9721567, 'binary_specificity': 0.9964257, 'binary_f1_score': 0.9840916}
confusion matrix:
       0      1
0  59379    213
1   1653  57715
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9738518, 'precision': 0.9745902, 'recall': 0.9738666, 'specificity': 0.9738666, 'f1': 0.9738422, 'auroc': 0.995199, 'binary_precision': 0.9934974, 'binary_recall': 0.9539865, 'binary_specificity': 0.9937467, 'binary_f1_score': 0.97334117}
confusion matrix:
       0      1
0  20659    130
1    958  19862
early stop counter: 2
val acc:0.9843140840530396, best validation acc: 0.9881640672683716, corresponding to test acc:                         0.9773606657981873 / 0.9777692556381226
after epoch: 8,now: 2024-07-23 06:08:02.026328,epoch time: 2:18:31.805737,used: 1 day, 2:34:36.467605,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98086125, 'precision': 0.98102957, 'recall': 0.9808689, 'specificity': 0.9808689, 'f1': 0.98085976, 'auroc': 0.99770796, 'binary_precision': 0.99023026, 'binary_recall': 0.9713364, 'binary_specificity': 0.9904013, 'binary_f1_score': 0.9806923}
confusion matrix:
        0       1
0  137334    1331
1    3981  134906
---- Validation: 
scalar performance:
{'acc': 0.98699564, 'precision': 0.9870881, 'recall': 0.9869834, 'specificity': 0.9869834, 'f1': 0.98699474, 'auroc': 0.99868166, 'binary_precision': 0.99334484, 'binary_recall': 0.98051137, 'binary_specificity': 0.99345547, 'binary_f1_score': 0.9868864}
confusion matrix:
       0      1
0  59202    390
1   1157  58211
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9723377, 'precision': 0.9732108, 'recall': 0.9723538, 'specificity': 0.9723538, 'f1': 0.97232556, 'auroc': 0.9952854, 'binary_precision': 0.9937246, 'binary_recall': 0.9507205, 'binary_specificity': 0.9939872, 'binary_f1_score': 0.9717469}
confusion matrix:
       0      1
0  20664    125
1   1026  19794
early stop counter: 3
val acc:0.9869956374168396, best validation acc: 0.9881640672683716, corresponding to test acc:                         0.9773606657981873 / 0.9777692556381226
after epoch: 9,now: 2024-07-23 08:00:17.612189,epoch time: 1:52:15.585861,used: 1 day, 4:26:52.053466,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.98028475, 'precision': 0.9803448, 'recall': 0.9802805, 'specificity': 0.9802805, 'f1': 0.980284, 'auroc': 0.99807537, 'binary_precision': 0.9751683, 'binary_recall': 0.9857004, 'binary_specificity': 0.9748606, 'binary_f1_score': 0.98040605}
confusion matrix:
        0       1
0  135181    3486
1    1986  136899
---- Validation: 
scalar performance:
{'acc': 0.9891728, 'precision': 0.9891801, 'recall': 0.9891699, 'specificity': 0.9891699, 'f1': 0.9891727, 'auroc': 0.999089, 'binary_precision': 0.99065655, 'binary_recall': 0.9876196, 'binary_specificity': 0.9907202, 'binary_f1_score': 0.98913574}
confusion matrix:
       0      1
0  59039    553
1    735  58633
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97375566, 'precision': 0.9739439, 'recall': 0.9737632, 'specificity': 0.9737632, 'f1': 0.97375333, 'auroc': 0.9945942, 'binary_precision': 0.98357683, 'binary_recall': 0.96364075, 'binary_specificity': 0.9838857, 'binary_f1_score': 0.97350675}
confusion matrix:
       0      1
0  20454    335
1    757  20063
better model found
persisted
after epoch: 10,now: 2024-07-23 11:04:38.029176,epoch time: 3:04:20.416987,used: 1 day, 7:31:12.470453,model: dset_te_0_erm_b888c1ef2_not_commited_2024md_07md_22_03_33_25_seed_0_22696694
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
Experiment finished at epoch: 10 with time: 1 day, 7:31:12.470453 at 2024-07-23 11:04:38.029176
persisted model performance metric: 

scalar performance:
{'acc': 0.97375566, 'precision': 0.9739439, 'recall': 0.9737632, 'specificity': 0.9737632, 'f1': 0.97375333, 'auroc': 0.9945942, 'binary_precision': 0.98357683, 'binary_recall': 0.96364075, 'binary_specificity': 0.9838857, 'binary_f1_score': 0.97350675}
confusion matrix:
       0      1
0  20454    335
1    757  20063
oracle model performance metric: 

scalar performance:
{'acc': 0.97776926, 'precision': 0.9781301, 'recall': 0.9777796, 'specificity': 0.9777796, 'f1': 0.9777653, 'auroc': 0.9961756, 'binary_precision': 0.991453, 'binary_recall': 0.9638809, 'binary_specificity': 0.9916783, 'binary_f1_score': 0.9774725}
confusion matrix:
       0      1
0  20616    173
1    752  20068
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_10epochs_nofreezing_plusresneterm_2024-07-22_00-53-51/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 463176 KiB |  13222 MiB |   1626 TiB |   1626 TiB |
|       from large pool | 414861 KiB |  13181 MiB |   1604 TiB |   1604 TiB |
|       from small pool |  48314 KiB |     65 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 463176 KiB |  13222 MiB |   1626 TiB |   1626 TiB |
|       from large pool | 414861 KiB |  13181 MiB |   1604 TiB |   1604 TiB |
|       from small pool |  48314 KiB |     65 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 449411 KiB |  13214 MiB |   1612 TiB |   1612 TiB |
|       from large pool | 407075 KiB |  13175 MiB |   1590 TiB |   1590 TiB |
|       from small pool |  42336 KiB |     59 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14484 MiB |  14484 MiB |  14484 MiB |      0 B   |
|       from large pool |  14414 MiB |  14414 MiB |  14414 MiB |      0 B   |
|       from small pool |     70 MiB |     70 MiB |     70 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 448184 KiB |   1253 MiB |   1232 TiB |   1232 TiB |
|       from large pool | 435058 KiB |   1243 MiB |   1210 TiB |   1210 TiB |
|       from small pool |  13125 KiB |     19 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| Allocations           |   16742    |   35699    |  311416 K  |  311399 K  |
|       from large pool |     187    |    1413    |  150087 K  |  150087 K  |
|       from small pool |   16555    |   35510    |  161329 K  |  161312 K  |
|---------------------------------------------------------------------------|
| Active allocs         |   16742    |   35699    |  311416 K  |  311399 K  |
|       from large pool |     187    |    1413    |  150087 K  |  150087 K  |
|       from small pool |   16555    |   35510    |  161329 K  |  161312 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     636    |     636    |     636    |       0    |
|       from large pool |     601    |     601    |     601    |       0    |
|       from small pool |      35    |      35    |      35    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      65    |   17394    |  191375 K  |  191374 K  |
|       from large pool |      37    |     600    |  111060 K  |  111060 K  |
|       from small pool |      28    |   17356    |   80314 K  |   80314 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13222 MiB |   1626 TiB |   1626 TiB |
|       from large pool |  16640 KiB |  13181 MiB |   1604 TiB |   1604 TiB |
|       from small pool |      0 KiB |     65 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13222 MiB |   1626 TiB |   1626 TiB |
|       from large pool |  16640 KiB |  13181 MiB |   1604 TiB |   1604 TiB |
|       from small pool |      0 KiB |     65 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13214 MiB |   1612 TiB |   1612 TiB |
|       from large pool |  16640 KiB |  13175 MiB |   1590 TiB |   1590 TiB |
|       from small pool |      0 KiB |     59 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    890 MiB |  14484 MiB |  14484 MiB |  13594 MiB |
|       from large pool |    830 MiB |  14414 MiB |  14414 MiB |  13584 MiB |
|       from small pool |     60 MiB |     70 MiB |     70 MiB |     10 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   1253 MiB |   1232 TiB |   1232 TiB |
|       from large pool |  24320 KiB |   1243 MiB |   1210 TiB |   1210 TiB |
|       from small pool |      0 KiB |     50 MiB |     22 TiB |     22 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |   35699    |  311416 K  |  311416 K  |
|       from large pool |       2    |    1413    |  150087 K  |  150087 K  |
|       from small pool |       0    |   35510    |  161329 K  |  161329 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |   35699    |  311416 K  |  311416 K  |
|       from large pool |       2    |    1413    |  150087 K  |  150087 K  |
|       from small pool |       0    |   35510    |  161329 K  |  161329 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      67    |     636    |     636    |     569    |
|       from large pool |      37    |     601    |     601    |     564    |
|       from small pool |      30    |      35    |      35    |       5    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |   17394    |  191382 K  |  191382 K  |
|       from large pool |       4    |     600    |  111060 K  |  111060 K  |
|       from small pool |       0    |   17356    |   80322 K  |   80322 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Tue Jul 23 14:02:13 2024]
Finished job 0.
1 of 1 steps (100%) done
