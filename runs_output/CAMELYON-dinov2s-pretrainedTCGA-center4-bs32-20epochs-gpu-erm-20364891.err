Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)



no algorithm conf specified, going to use default



/lustre/groups/aih/sina.wendrich/MA_code/test/domainlab/arg_parser.py:355: UserWarning: no algorithm conf specified, going to use default
  warnings.warn("no algorithm conf specified, going to use default")

overriding args.task None to dset


using device: cuda

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/lustre/groups/aih/sina.wendrich/MA_code/test/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'b976d8c0'
model name: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891

 Experiment start at: 2024-05-05 12:45:05.039570
before training, model accuracy: 0.5281787514686584
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9759365, 'precision': 0.48796824, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49391088, 'auroc': 0.8247931}
confusion matrix:
       0  1
0  38975  0
1    961  0
---- Validation: 
scalar performance:
{'acc': 0.9757961, 'precision': 0.48789805, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4938749, 'auroc': 0.8164278}
confusion matrix:
       0  1
0  16731  0
1    415  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.6084088}
confusion matrix:
      0  1
0  9342  0
1   772  0
new oracle model saved
after epoch: 1,now: 2024-05-05 13:01:22.457575,epoch time: 0:16:17.418005,used: 0:16:17.418005,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9759365, 'precision': 0.48796824, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49391088, 'auroc': 0.8843023}
confusion matrix:
       0  1
0  38975  0
1    961  0
---- Validation: 
scalar performance:
{'acc': 0.9757961, 'precision': 0.48789805, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4938749, 'auroc': 0.87927747}
confusion matrix:
       0  1
0  16731  0
1    415  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.85156584}
confusion matrix:
      0  1
0  9342  0
1   772  0
early stop counter: 1
val acc:0.975796103477478, best validation acc: 0.975796103477478, corresponding to test acc:                         0.9236701726913452 / 0.9236701726913452
after epoch: 2,now: 2024-05-05 13:16:48.195984,epoch time: 0:15:25.738409,used: 0:31:43.156414,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9759365, 'precision': 0.48796824, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49391088, 'auroc': 0.92456204}
confusion matrix:
       0  1
0  38975  0
1    961  0
---- Validation: 
scalar performance:
{'acc': 0.9757961, 'precision': 0.48789805, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4938749, 'auroc': 0.9154824}
confusion matrix:
       0  1
0  16731  0
1    415  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.8911325}
confusion matrix:
      0  1
0  9342  0
1   772  0
early stop counter: 2
val acc:0.975796103477478, best validation acc: 0.975796103477478, corresponding to test acc:                         0.9236701726913452 / 0.9236701726913452
after epoch: 3,now: 2024-05-05 13:32:08.850569,epoch time: 0:15:20.654585,used: 0:47:03.810999,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97616184, 'precision': 0.746595, 'recall': 0.5904438, 'specificity': 0.5904438, 'f1': 0.63002694, 'auroc': 0.92840815}
confusion matrix:
       0    1
0  38806  169
1    783  178
---- Validation: 
scalar performance:
{'acc': 0.97567946, 'precision': 0.7361757, 'recall': 0.5798358, 'specificity': 0.5798358, 'f1': 0.6167858, 'auroc': 0.92105275}
confusion matrix:
       0   1
0  16661  70
1    347  68
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9272296, 'precision': 0.9278977, 'recall': 0.5250985, 'specificity': 0.5250985, 'f1': 0.5289562, 'auroc': 0.87286496}
confusion matrix:
      0   1
0  9339   3
1   733  39
new oracle model saved
early stop counter: 3
val acc:0.9756794571876526, best validation acc: 0.975796103477478, corresponding to test acc:                         0.9236701726913452 / 0.9272295832633972
after epoch: 4,now: 2024-05-05 13:47:29.214139,epoch time: 0:15:20.363570,used: 1:02:24.174569,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98039365, 'precision': 0.80699235, 'recall': 0.7237608, 'specificity': 0.7237608, 'f1': 0.7584388, 'auroc': 0.93356264}
confusion matrix:
       0    1
0  38717  259
1    524  436
---- Validation: 
scalar performance:
{'acc': 0.9780707, 'precision': 0.77900267, 'recall': 0.67975557, 'specificity': 0.67975557, 'f1': 0.71793616, 'auroc': 0.91943204}
confusion matrix:
       0    1
0  16618  113
1    263  152
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91931975, 'precision': 0.7218378, 'recall': 0.7733291, 'specificity': 0.7733291, 'f1': 0.7439819, 'auroc': 0.9026315}
confusion matrix:
      0    1
0  8834  508
1   308  464
better model found, saving less frequently
model persisted
after epoch: 5,now: 2024-05-05 14:02:58.092010,epoch time: 0:15:28.877871,used: 1:17:53.052440,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9809946, 'precision': 0.81216514, 'recall': 0.7410988, 'specificity': 0.7410988, 'f1': 0.7717787, 'auroc': 0.9409493}
confusion matrix:
       0    1
0  38707  268
1    491  470
---- Validation: 
scalar performance:
{'acc': 0.97877055, 'precision': 0.78858924, 'recall': 0.6942134, 'specificity': 0.6942134, 'f1': 0.7315776, 'auroc': 0.9269657}
confusion matrix:
       0    1
0  16618  113
1    251  164
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9233735, 'precision': 0.72187424, 'recall': 0.65431756, 'specificity': 0.65431756, 'f1': 0.68030524, 'auroc': 0.8855815}
confusion matrix:
      0    1
0  9079  263
1   512  260
after epoch: 6,now: 2024-05-05 14:18:20.045867,epoch time: 0:15:21.953857,used: 1:33:15.006297,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.97936696, 'precision': 0.78956234, 'recall': 0.7245336, 'specificity': 0.7245336, 'f1': 0.7526612, 'auroc': 0.9105103}
confusion matrix:
       0    1
0  38673  302
1    522  439
---- Validation: 
scalar performance:
{'acc': 0.97696257, 'precision': 0.7586299, 'recall': 0.69563687, 'specificity': 0.69563687, 'f1': 0.72245157, 'auroc': 0.9011895}
confusion matrix:
       0    1
0  16585  146
1    249  166
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92416453, 'precision': 0.7239475, 'recall': 0.62325597, 'specificity': 0.62325597, 'f1': 0.6551408, 'auroc': 0.8839119}
confusion matrix:
      0    1
0  9140  202
1   565  207
early stop counter: 1
val acc:0.9769625663757324, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 7,now: 2024-05-05 14:33:52.025954,epoch time: 0:15:31.980087,used: 1:48:46.986384,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.97596157, 'precision': 0.48798078, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4939173, 'auroc': 0.94287455}
confusion matrix:
       0  1
0  38976  0
1    960  0
---- Validation: 
scalar performance:
{'acc': 0.9757961, 'precision': 0.48789805, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4938749, 'auroc': 0.9256562}
confusion matrix:
       0  1
0  16731  0
1    415  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.8923056}
confusion matrix:
      0  1
0  9342  0
1   772  0
early stop counter: 2
val acc:0.975796103477478, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 8,now: 2024-05-05 14:49:11.243265,epoch time: 0:15:19.217311,used: 2:04:06.203695,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.981846, 'precision': 0.8328944, 'recall': 0.72879726, 'specificity': 0.72879726, 'f1': 0.77063143, 'auroc': 0.9499078}
confusion matrix:
       0    1
0  38767  210
1    515  444
---- Validation: 
scalar performance:
{'acc': 0.9783623, 'precision': 0.78422594, 'recall': 0.6810799, 'specificity': 0.6810799, 'f1': 0.72047865, 'auroc': 0.93327576}
confusion matrix:
       0    1
0  16622  109
1    262  153
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92416453, 'precision': 0.7226359, 'recall': 0.5573057, 'specificity': 0.5573057, 'f1': 0.5802018, 'auroc': 0.8851733}
confusion matrix:
      0   1
0  9251  91
1   676  96
early stop counter: 3
val acc:0.9783623218536377, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 9,now: 2024-05-05 15:04:28.944949,epoch time: 0:15:17.701684,used: 2:19:23.905379,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9807692, 'precision': 0.7942966, 'recall': 0.800864, 'specificity': 0.800864, 'f1': 0.7975415, 'auroc': 0.9506795}
confusion matrix:
       0    1
0  38580  395
1    373  588
---- Validation: 
scalar performance:
{'acc': 0.97772074, 'precision': 0.7642386, 'recall': 0.7629966, 'specificity': 0.7629966, 'f1': 0.763616, 'auroc': 0.93162525}
confusion matrix:
       0    1
0  16541  190
1    192  223
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9080483, 'precision': 0.70658314, 'recall': 0.821295, 'specificity': 0.821295, 'f1': 0.7464925, 'auroc': 0.8941364}
confusion matrix:
      0    1
0  8629  713
1   217  555
early stop counter: 4
val acc:0.9777207374572754, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 10,now: 2024-05-05 15:20:01.873921,epoch time: 0:15:32.928972,used: 2:34:56.834351,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9816707, 'precision': 0.8152224, 'recall': 0.7650554, 'specificity': 0.7650554, 'f1': 0.7878312, 'auroc': 0.95718306}
confusion matrix:
       0    1
0  38688  288
1    444  516
---- Validation: 
scalar performance:
{'acc': 0.97725415, 'precision': 0.762187, 'recall': 0.7051857, 'specificity': 0.7051857, 'f1': 0.7299608, 'auroc': 0.9317387}
confusion matrix:
       0    1
0  16582  149
1    241  174
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9271307, 'precision': 0.85743344, 'recall': 0.5303923, 'specificity': 0.5303923, 'f1': 0.5386233, 'auroc': 0.81100214}
confusion matrix:
      0   1
0  9329  13
1   724  48
early stop counter: 5
val acc:0.9772541522979736, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 11,now: 2024-05-05 15:35:51.010256,epoch time: 0:15:49.136335,used: 2:50:45.970686,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9803435, 'precision': 0.79315174, 'recall': 0.7755516, 'specificity': 0.7755516, 'f1': 0.78406054, 'auroc': 0.95722675}
confusion matrix:
       0    1
0  38613  363
1    422  538
---- Validation: 
scalar performance:
{'acc': 0.9760294, 'precision': 0.74602747, 'recall': 0.7292318, 'specificity': 0.7292318, 'f1': 0.7373097, 'auroc': 0.930676}
confusion matrix:
       0    1
0  16540  191
1    220  195
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92663634, 'precision': 0.8154948, 'recall': 0.5325013, 'specificity': 0.5325013, 'f1': 0.54232424, 'auroc': 0.83155227}
confusion matrix:
      0   1
0  9320  22
1   720  52
early stop counter: 6
val acc:0.9760293960571289, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 12,now: 2024-05-05 15:51:16.895023,epoch time: 0:15:25.884767,used: 3:06:11.855453,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.9819211, 'precision': 0.8328566, 'recall': 0.7334541, 'specificity': 0.7334541, 'f1': 0.77391374, 'auroc': 0.9574758}
confusion matrix:
       0    1
0  38760  215
1    507  454
---- Validation: 
scalar performance:
{'acc': 0.9773708, 'precision': 0.7691026, 'recall': 0.6617729, 'specificity': 0.6617729, 'f1': 0.70118, 'auroc': 0.93917793}
confusion matrix:
       0    1
0  16621  110
1    278  137
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92189044, 'precision': 0.7248043, 'recall': 0.739666, 'specificity': 0.739666, 'f1': 0.73192036, 'auroc': 0.88767445}
confusion matrix:
      0    1
0  8919  423
1   367  405
early stop counter: 7
val acc:0.9773707985877991, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 13,now: 2024-05-05 16:07:04.134043,epoch time: 0:15:47.239020,used: 3:21:59.094473,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 14
---- Training Domain: 
scalar performance:
{'acc': 0.9836238, 'precision': 0.836722, 'recall': 0.79420704, 'specificity': 0.79420704, 'f1': 0.8139429, 'auroc': 0.9634385}
confusion matrix:
       0    1
0  38710  265
1    389  572
---- Validation: 
scalar performance:
{'acc': 0.9786539, 'precision': 0.78012526, 'recall': 0.72587687, 'specificity': 0.72587687, 'f1': 0.7498921, 'auroc': 0.9368553}
confusion matrix:
       0    1
0  16589  142
1    224  191
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91684794, 'precision': 0.69996905, 'recall': 0.6781159, 'specificity': 0.6781159, 'f1': 0.688202, 'auroc': 0.87145865}
confusion matrix:
      0    1
0  8967  375
1   466  306
early stop counter: 8
val acc:0.9786539077758789, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 14,now: 2024-05-05 16:22:30.133306,epoch time: 0:15:25.999263,used: 3:37:25.093736,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 15
---- Training Domain: 
scalar performance:
{'acc': 0.98389924, 'precision': 0.85390604, 'recall': 0.768975, 'specificity': 0.768975, 'f1': 0.80531293, 'auroc': 0.9674526}
confusion matrix:
       0    1
0  38771  204
1    439  522
---- Validation: 
scalar performance:
{'acc': 0.9780707, 'precision': 0.7792537, 'recall': 0.67858064, 'specificity': 0.67858064, 'f1': 0.717121, 'auroc': 0.9339478}
confusion matrix:
       0    1
0  16619  112
1    264  151
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9250544, 'precision': 0.72974217, 'recall': 0.6326499, 'specificity': 0.6326499, 'f1': 0.66477203, 'auroc': 0.8823424}
confusion matrix:
      0    1
0  9134  208
1   550  222
early stop counter: 9
val acc:0.9780706763267517, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 15,now: 2024-05-05 16:38:35.861035,epoch time: 0:16:05.727729,used: 3:53:30.821465,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
epoch: 16
---- Training Domain: 
scalar performance:
{'acc': 0.9827724, 'precision': 0.8097276, 'recall': 0.84486866, 'specificity': 0.84486866, 'f1': 0.82628936, 'auroc': 0.9608602}
confusion matrix:
       0    1
0  38576  400
1    288  672
---- Validation: 
scalar performance:
{'acc': 0.9770792, 'precision': 0.75729585, 'recall': 0.76031804, 'specificity': 0.76031804, 'f1': 0.75879747, 'auroc': 0.93093836}
confusion matrix:
       0    1
0  16532  199
1    194  221
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92040735, 'precision': 0.7113577, 'recall': 0.6717246, 'specificity': 0.6717246, 'f1': 0.6888579, 'auroc': 0.87300336}
confusion matrix:
      0    1
0  9017  325
1   480  292
early stop counter: 10
val acc:0.9770792126655579, best validation acc: 0.9787705540657043, corresponding to test acc:                         0.9233735203742981 / 0.9272295832633972
after epoch: 16,now: 2024-05-05 16:56:20.874533,epoch time: 0:17:45.013498,used: 4:11:15.834963,model: dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891
working direcotry: /lustre/groups/aih/sina.wendrich/MA_code/test
early stop trigger
Experiment finished at epoch: 16 with time: 4:11:15.834963 at 2024-05-05 16:56:20.874533
persisted model performance metric: 

scalar performance:
{'acc': 0.91931975, 'precision': 0.7218378, 'recall': 0.7733291, 'specificity': 0.7733291, 'f1': 0.7439819, 'auroc': 0.9026315}
confusion matrix:
      0    1
0  8834  508
1   308  464
oracle model performance metric: 

scalar performance:
{'acc': 0.9272296, 'precision': 0.9278977, 'recall': 0.5250985, 'specificity': 0.5250985, 'f1': 0.5289562, 'auroc': 0.87286496}
confusion matrix:
      0   1
0  9339   3
1   733  39
results aggregation path: zoutput/aggrsts/dset_te_center4_exptag.csv
confusion matrix saved in file: zoutput/aggrsts/dset_te_center4_erm_bb976d8c0_not_commited_2024md_05md_05_12_45_05_seed_0_20364891_conf_mat.png
