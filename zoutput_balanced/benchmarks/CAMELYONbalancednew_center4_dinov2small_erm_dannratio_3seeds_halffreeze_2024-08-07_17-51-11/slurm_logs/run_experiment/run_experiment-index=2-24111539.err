Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Aug  7 17:53:02 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111539

 Experiment start at: 2024-08-07 18:03:28.371446
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.28613802790641785
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93136054, 'precision': 0.9372741, 'recall': 0.9313904, 'specificity': 0.9313904, 'f1': 0.9311309, 'auroc': 0.9763993, 'binary_precision': 0.9882537, 'binary_recall': 0.87316996, 'binary_specificity': 0.9896109, 'binary_f1_score': 0.92715424}
confusion matrix:
       0      1
0  25052    263
1   3214  22127
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9615071, 'precision': 0.51541805, 'recall': 0.5103023, 'specificity': 0.5103023, 'f1': 0.5119183, 'auroc': 0.6573093, 'binary_precision': 0.054545455, 'binary_recall': 0.036144577, 'binary_specificity': 0.98446, 'binary_f1_score': 0.043478258}
confusion matrix:
       0    1
0  16471  260
1    400   15
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90864146, 'precision': 0.53153753, 'recall': 0.50909495, 'specificity': 0.50909495, 'f1': 0.5055266, 'auroc': 0.78694266, 'binary_precision': 0.13809524, 'binary_recall': 0.037564766, 'binary_specificity': 0.98062515, 'binary_f1_score': 0.059063137}
confusion matrix:
      0    1
0  9161  181
1   743   29
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 18:46:45.260843,epoch time: 0:43:16.889397,used: 0:43:16.889397,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.94618607, 'precision': 0.94984984, 'recall': 0.94621104, 'specificity': 0.94621104, 'f1': 0.94607836, 'auroc': 0.98321867, 'binary_precision': 0.9905857, 'binary_recall': 0.9009944, 'binary_specificity': 0.99142766, 'binary_f1_score': 0.9436684}
confusion matrix:
       0      1
0  25097    217
1   2509  22833
---- Validation: 
scalar performance:
{'acc': 0.9696139, 'precision': 0.5964715, 'recall': 0.5438296, 'specificity': 0.5438296, 'f1': 0.5588237, 'auroc': 0.74243855, 'binary_precision': 0.21505377, 'binary_recall': 0.09638554, 'binary_specificity': 0.9912737, 'binary_f1_score': 0.13311148}
confusion matrix:
       0    1
0  16585  146
1    375   40
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91536486, 'precision': 0.630354, 'recall': 0.5442242, 'specificity': 0.5442242, 'f1': 0.55810976, 'auroc': 0.84273005, 'binary_precision': 0.33064517, 'binary_recall': 0.106217615, 'binary_specificity': 0.9822308, 'binary_f1_score': 0.1607843}
confusion matrix:
      0    1
0  9176  166
1   690   82
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-07 19:16:57.191734,epoch time: 0:30:11.930891,used: 1:13:28.820288,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.95465493, 'precision': 0.95704013, 'recall': 0.9546778, 'specificity': 0.9546778, 'f1': 0.95459723, 'auroc': 0.98699594, 'binary_precision': 0.99021566, 'binary_recall': 0.91844225, 'binary_specificity': 0.9909134, 'binary_f1_score': 0.95297945}
confusion matrix:
       0      1
0  25082    230
1   2067  23277
---- Validation: 
scalar performance:
{'acc': 0.96838915, 'precision': 0.61994046, 'recall': 0.57727516, 'specificity': 0.57727516, 'f1': 0.593408, 'auroc': 0.76261204, 'binary_precision': 0.26037735, 'binary_recall': 0.16626506, 'binary_specificity': 0.98828524, 'binary_f1_score': 0.20294116}
confusion matrix:
       0    1
0  16535  196
1    346   69
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9162547, 'precision': 0.6784364, 'recall': 0.6082796, 'specificity': 0.6082796, 'f1': 0.6319998, 'auroc': 0.84780073, 'binary_precision': 0.41721854, 'binary_recall': 0.24481866, 'binary_specificity': 0.97174054, 'binary_f1_score': 0.30857143}
confusion matrix:
      0    1
0  9078  264
1   583  189
new oracle model saved
early stop counter: 1
val acc:0.9683891534805298, best validation acc: 0.9696139097213745, corresponding to test acc:                         0.9153648614883423 / 0.9162546992301941
after epoch: 3,now: 2024-08-07 19:46:57.410382,epoch time: 0:30:00.218648,used: 1:43:29.038936,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9505883, 'precision': 0.953354, 'recall': 0.9506115, 'specificity': 0.9506115, 'f1': 0.9505146, 'auroc': 0.9860107, 'binary_precision': 0.98891175, 'binary_recall': 0.91145486, 'binary_specificity': 0.9897681, 'binary_f1_score': 0.9486048}
confusion matrix:
       0      1
0  25054    259
1   2244  23099
---- Validation: 
scalar performance:
{'acc': 0.95479995, 'precision': 0.5647416, 'recall': 0.5797115, 'specificity': 0.5797115, 'f1': 0.5712701, 'auroc': 0.7608344, 'binary_precision': 0.14980544, 'binary_recall': 0.18554217, 'binary_specificity': 0.9738808, 'binary_f1_score': 0.16576964}
confusion matrix:
       0    1
0  16294  437
1    338   77
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90972906, 'precision': 0.65960455, 'recall': 0.62138325, 'specificity': 0.62138325, 'f1': 0.636921, 'auroc': 0.83420193, 'binary_precision': 0.3773913, 'binary_recall': 0.28108808, 'binary_specificity': 0.96167845, 'binary_f1_score': 0.32219747}
confusion matrix:
      0    1
0  8984  358
1   555  217
early stop counter: 2
val acc:0.9547999501228333, best validation acc: 0.9696139097213745, corresponding to test acc:                         0.9153648614883423 / 0.9162546992301941
after epoch: 4,now: 2024-08-07 20:16:23.902066,epoch time: 0:29:26.491684,used: 2:12:55.530620,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9224771, 'precision': 0.92256165, 'recall': 0.9224816, 'specificity': 0.9224816, 'f1': 0.9224737, 'auroc': 0.9690801, 'binary_precision': 0.9287001, 'binary_recall': 0.9153251, 'binary_specificity': 0.9296381, 'binary_f1_score': 0.9219641}
confusion matrix:
       0      1
0  23531   1781
1   2146  23198
---- Validation: 
scalar performance:
{'acc': 0.74454683, 'precision': 0.516054, 'recall': 0.6294186, 'specificity': 0.6294186, 'f1': 0.46967757, 'auroc': 0.6377293, 'binary_precision': 0.04809665, 'binary_recall': 0.50843376, 'binary_specificity': 0.75040346, 'binary_f1_score': 0.08788005}
confusion matrix:
       0     1
0  12555  4176
1    204   211
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.72790194, 'precision': 0.559849, 'recall': 0.6744642, 'specificity': 0.6744642, 'f1': 0.5444731, 'auroc': 0.706119, 'binary_precision': 0.16142271, 'binary_recall': 0.61139894, 'binary_specificity': 0.73752946, 'binary_f1_score': 0.25541127}
confusion matrix:
      0     1
0  6890  2452
1   300   472
early stop counter: 3
val acc:0.7445468306541443, best validation acc: 0.9696139097213745, corresponding to test acc:                         0.9153648614883423 / 0.9162546992301941
after epoch: 5,now: 2024-08-07 20:46:08.857098,epoch time: 0:29:44.955032,used: 2:42:40.485652,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:42:40.485652 at 2024-08-07 20:46:08.857098
persisted model performance metric: 

scalar performance:
{'acc': 0.91536486, 'precision': 0.630354, 'recall': 0.5442242, 'specificity': 0.5442242, 'f1': 0.55810976, 'auroc': 0.84273005, 'binary_precision': 0.33064517, 'binary_recall': 0.106217615, 'binary_specificity': 0.9822308, 'binary_f1_score': 0.1607843}
confusion matrix:
      0    1
0  9176  166
1   690   82
oracle model performance metric: 

scalar performance:
{'acc': 0.9162547, 'precision': 0.6784364, 'recall': 0.6082796, 'specificity': 0.6082796, 'f1': 0.6319998, 'auroc': 0.84780073, 'binary_precision': 0.41721854, 'binary_recall': 0.24481866, 'binary_specificity': 0.97174054, 'binary_f1_score': 0.30857143}
confusion matrix:
      0    1
0  9078  264
1   583  189
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198886 KiB |   2142 MiB | 278335 GiB | 278335 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 274583 GiB | 274583 GiB |
|       from small pool |  18224 KiB |     38 MiB |   3751 GiB |   3751 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198886 KiB |   2142 MiB | 278335 GiB | 278335 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 274583 GiB | 274583 GiB |
|       from small pool |  18224 KiB |     38 MiB |   3751 GiB |   3751 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   2141 MiB | 278310 GiB | 278310 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 274564 GiB | 274564 GiB |
|       from small pool |  16663 KiB |     36 MiB |   3746 GiB |   3746 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  59162 KiB | 225565 KiB | 152994 GiB | 152994 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 149186 GiB | 149186 GiB |
|       from small pool |   8400 KiB |  11202 KiB |   3807 GiB |   3807 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4444    |    6827    |   42228 K  |   42224 K  |
|       from large pool |      79    |     252    |   25556 K  |   25556 K  |
|       from small pool |    4365    |    6747    |   16672 K  |   16668 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4444    |    6827    |   42228 K  |   42224 K  |
|       from large pool |      79    |     252    |   25556 K  |   25556 K  |
|       from small pool |    4365    |    6747    |   16672 K  |   16668 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      38    |    3182    |   27583 K  |   27583 K  |
|       from large pool |      10    |      97    |   19861 K  |   19861 K  |
|       from small pool |      28    |    3172    |    7721 K  |    7721 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 278335 GiB | 278335 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 274583 GiB | 274583 GiB |
|       from small pool |      0 KiB |     38 MiB |   3751 GiB |   3751 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 278335 GiB | 278335 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 274583 GiB | 274583 GiB |
|       from small pool |      0 KiB |     38 MiB |   3751 GiB |   3751 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 278310 GiB | 278310 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 274564 GiB | 274564 GiB |
|       from small pool |      0 KiB |     36 MiB |   3746 GiB |   3746 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 258048 KiB |   2372 MiB |   2372 MiB |   2120 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  26624 KiB |     42 MiB |     42 MiB |     16 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 152994 GiB | 152994 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 149186 GiB | 149186 GiB |
|       from small pool |      0 KiB |  22547 KiB |   3807 GiB |   3807 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   42228 K  |   42228 K  |
|       from large pool |       2    |     252    |   25556 K  |   25556 K  |
|       from small pool |       0    |    6747    |   16672 K  |   16672 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   42228 K  |   42228 K  |
|       from large pool |       2    |     252    |   25556 K  |   25556 K  |
|       from small pool |       0    |    6747    |   16672 K  |   16672 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     118    |      94    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      13    |      21    |      21    |       8    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   27585 K  |   27585 K  |
|       from large pool |       3    |      97    |   19861 K  |   19861 K  |
|       from small pool |       0    |    3172    |    7723 K  |    7723 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 278335 GiB | 278335 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 274583 GiB | 274583 GiB |
|       from small pool |      0 KiB |     38 MiB |   3751 GiB |   3751 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 278335 GiB | 278335 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 274583 GiB | 274583 GiB |
|       from small pool |      0 KiB |     38 MiB |   3751 GiB |   3751 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 278310 GiB | 278310 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 274564 GiB | 274564 GiB |
|       from small pool |      0 KiB |     36 MiB |   3746 GiB |   3746 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 258048 KiB |   2372 MiB |   2372 MiB |   2120 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  26624 KiB |     42 MiB |     42 MiB |     16 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 152994 GiB | 152994 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 149186 GiB | 149186 GiB |
|       from small pool |      0 KiB |  22547 KiB |   3807 GiB |   3807 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   42228 K  |   42228 K  |
|       from large pool |       2    |     252    |   25556 K  |   25556 K  |
|       from small pool |       0    |    6747    |   16672 K  |   16672 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   42228 K  |   42228 K  |
|       from large pool |       2    |     252    |   25556 K  |   25556 K  |
|       from small pool |       0    |    6747    |   16672 K  |   16672 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     118    |      94    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      13    |      21    |      21    |       8    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   27585 K  |   27585 K  |
|       from large pool |       3    |      97    |   19861 K  |   19861 K  |
|       from small pool |       0    |    3172    |    7723 K  |    7723 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539

 Experiment start at: 2024-08-07 21:12:57.373458
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6057873368263245
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93126374, 'precision': 0.9360831, 'recall': 0.93130314, 'specificity': 0.93130314, 'f1': 0.9310776, 'auroc': 0.9752985, 'binary_precision': 0.98211384, 'binary_recall': 0.87863183, 'binary_specificity': 0.98397446, 'binary_f1_score': 0.92749536}
confusion matrix:
       0      1
0  24990    407
1   3087  22348
---- Validation: 
scalar performance:
{'acc': 0.94778955, 'precision': 0.55542845, 'recall': 0.5799326, 'specificity': 0.5799326, 'f1': 0.5648324, 'auroc': 0.79231715, 'binary_precision': 0.13195549, 'binary_recall': 0.19257541, 'binary_specificity': 0.96728975, 'binary_f1_score': 0.15660378}
confusion matrix:
       0    1
0  16146  546
1    348   83
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90228915, 'precision': 0.6527216, 'recall': 0.66010237, 'specificity': 0.66010237, 'f1': 0.6562886, 'auroc': 0.8498405, 'binary_precision': 0.35633627, 'binary_recall': 0.37516513, 'binary_specificity': 0.94503963, 'binary_f1_score': 0.36550838}
confusion matrix:
      0    1
0  8821  513
1   473  284
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 21:57:31.592653,epoch time: 0:44:34.219195,used: 0:44:34.219195,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9525299, 'precision': 0.95401573, 'recall': 0.9525525, 'specificity': 0.9525525, 'f1': 0.9524927, 'auroc': 0.9866277, 'binary_precision': 0.98018605, 'binary_recall': 0.92380875, 'binary_specificity': 0.98129624, 'binary_f1_score': 0.95116276}
confusion matrix:
       0      1
0  24921    475
1   1938  23498
---- Validation: 
scalar performance:
{'acc': 0.9618642, 'precision': 0.6024557, 'recall': 0.5961927, 'specificity': 0.5961927, 'f1': 0.59920985, 'auroc': 0.8270691, 'binary_precision': 0.22524753, 'binary_recall': 0.21113689, 'binary_specificity': 0.9812485, 'binary_f1_score': 0.21796408}
confusion matrix:
       0    1
0  16379  313
1    340   91
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9115053, 'precision': 0.6876343, 'recall': 0.7063557, 'specificity': 0.7063557, 'f1': 0.69638854, 'auroc': 0.8799695, 'binary_precision': 0.41904762, 'binary_recall': 0.4649934, 'binary_specificity': 0.947718, 'binary_f1_score': 0.44082657}
confusion matrix:
      0    1
0  8846  488
1   405  352
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-07 22:28:44.108594,epoch time: 0:31:12.515941,used: 1:15:46.735136,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9596514, 'precision': 0.9608642, 'recall': 0.95967174, 'specificity': 0.95967174, 'f1': 0.9596261, 'auroc': 0.9905739, 'binary_precision': 0.9847034, 'binary_recall': 0.93387324, 'binary_specificity': 0.9854702, 'binary_f1_score': 0.95861495}
confusion matrix:
       0      1
0  25027    369
1   1682  23754
---- Validation: 
scalar performance:
{'acc': 0.9627986, 'precision': 0.61126375, 'recall': 0.6034528, 'specificity': 0.6034528, 'f1': 0.6071952, 'auroc': 0.8340459, 'binary_precision': 0.2425, 'binary_recall': 0.225058, 'binary_specificity': 0.9818476, 'binary_f1_score': 0.23345368}
confusion matrix:
       0    1
0  16389  303
1    334   97
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9135864, 'precision': 0.7015654, 'recall': 0.74935913, 'specificity': 0.74935913, 'f1': 0.72201586, 'auroc': 0.8863908, 'binary_precision': 0.4399164, 'binary_recall': 0.5561427, 'binary_specificity': 0.9425755, 'binary_f1_score': 0.49124858}
confusion matrix:
      0    1
0  8798  536
1   336  421
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-07 22:58:32.455119,epoch time: 0:29:48.346525,used: 1:45:35.081661,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9646286, 'precision': 0.9652989, 'recall': 0.96464366, 'specificity': 0.96464366, 'f1': 0.96461666, 'auroc': 0.99230546, 'binary_precision': 0.9831576, 'binary_recall': 0.9455103, 'binary_specificity': 0.983777, 'binary_f1_score': 0.9639665}
confusion matrix:
       0      1
0  24984    412
1   1386  24050
---- Validation: 
scalar performance:
{'acc': 0.9636162, 'precision': 0.61633945, 'recall': 0.6050023, 'specificity': 0.6050023, 'f1': 0.6103393, 'auroc': 0.85092473, 'binary_precision': 0.2525773, 'binary_recall': 0.22737819, 'binary_specificity': 0.9826264, 'binary_f1_score': 0.23931623}
confusion matrix:
       0    1
0  16402  290
1    333   98
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9123972, 'precision': 0.6991713, 'recall': 0.7505371, 'specificity': 0.7505371, 'f1': 0.7208471, 'auroc': 0.8885653, 'binary_precision': 0.4348718, 'binary_recall': 0.5601057, 'binary_specificity': 0.9409685, 'binary_f1_score': 0.4896074}
confusion matrix:
      0    1
0  8783  551
1   333  424
better model found
persisted
after epoch: 4,now: 2024-08-07 23:29:39.367875,epoch time: 0:31:06.912756,used: 2:16:41.994417,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.96596634, 'precision': 0.9670024, 'recall': 0.965984, 'specificity': 0.965984, 'f1': 0.96594834, 'auroc': 0.99346447, 'binary_precision': 0.9891865, 'binary_recall': 0.9422842, 'binary_specificity': 0.9896838, 'binary_f1_score': 0.9651659}
confusion matrix:
       0      1
0  25135    262
1   1468  23967
---- Validation: 
scalar performance:
{'acc': 0.96145535, 'precision': 0.59155095, 'recall': 0.58242136, 'specificity': 0.58242136, 'f1': 0.5867051, 'auroc': 0.84514403, 'binary_precision': 0.20413436, 'binary_recall': 0.18329467, 'binary_specificity': 0.9815481, 'binary_f1_score': 0.19315404}
confusion matrix:
       0    1
0  16384  308
1    352   79
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9130909, 'precision': 0.69132584, 'recall': 0.705392, 'specificity': 0.705392, 'f1': 0.69802094, 'auroc': 0.8822503, 'binary_precision': 0.42665038, 'binary_recall': 0.4610304, 'binary_specificity': 0.9497536, 'binary_f1_score': 0.4431746}
confusion matrix:
      0    1
0  8865  469
1   408  349
early stop counter: 1
val acc:0.9614553451538086, best validation acc: 0.9636161923408508, corresponding to test acc:                         0.9123972058296204 / 0.9135863780975342
after epoch: 5,now: 2024-08-08 00:00:55.931995,epoch time: 0:31:16.564120,used: 2:47:58.558537,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.96923196, 'precision': 0.9695105, 'recall': 0.9692412, 'specificity': 0.9692412, 'f1': 0.96922785, 'auroc': 0.99441755, 'binary_precision': 0.98113436, 'binary_recall': 0.9569098, 'binary_specificity': 0.9815726, 'binary_f1_score': 0.9688707}
confusion matrix:
       0      1
0  24929    468
1   1096  24339
---- Validation: 
scalar performance:
{'acc': 0.9575425, 'precision': 0.56448305, 'recall': 0.5634623, 'specificity': 0.5634623, 'f1': 0.5639676, 'auroc': 0.85619354, 'binary_precision': 0.1509434, 'binary_recall': 0.14849187, 'binary_specificity': 0.9784328, 'binary_f1_score': 0.14970762}
confusion matrix:
       0    1
0  16332  360
1    367   64
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9128927, 'precision': 0.69052017, 'recall': 0.704071, 'specificity': 0.704071, 'f1': 0.69698, 'auroc': 0.88734245, 'binary_precision': 0.4252451, 'binary_recall': 0.4583884, 'binary_specificity': 0.9497536, 'binary_f1_score': 0.4411952}
confusion matrix:
      0    1
0  8865  469
1   410  347
early stop counter: 2
val acc:0.9575424790382385, best validation acc: 0.9636161923408508, corresponding to test acc:                         0.9123972058296204 / 0.9135863780975342
after epoch: 6,now: 2024-08-08 00:31:10.547878,epoch time: 0:30:14.615883,used: 3:18:13.174420,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.97206485, 'precision': 0.9723121, 'recall': 0.97207487, 'specificity': 0.97207487, 'f1': 0.97206163, 'auroc': 0.9947369, 'binary_precision': 0.98333734, 'binary_recall': 0.96045285, 'binary_specificity': 0.98369694, 'binary_f1_score': 0.9717604}
confusion matrix:
       0      1
0  24980    414
1   1006  24432
---- Validation: 
scalar performance:
{'acc': 0.95608246, 'precision': 0.5959293, 'recall': 0.6226108, 'specificity': 0.6226108, 'f1': 0.60735637, 'auroc': 0.8760004, 'binary_precision': 0.21081081, 'binary_recall': 0.27146173, 'binary_specificity': 0.9737599, 'binary_f1_score': 0.23732252}
confusion matrix:
       0    1
0  16254  438
1    314  117
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9120999, 'precision': 0.6832291, 'recall': 0.68300664, 'specificity': 0.68300664, 'f1': 0.6831178, 'auroc': 0.88569295, 'binary_precision': 0.41402116, 'binary_recall': 0.41347423, 'binary_specificity': 0.9525391, 'binary_f1_score': 0.41374752}
confusion matrix:
      0    1
0  8891  443
1   444  313
early stop counter: 3
val acc:0.9560824632644653, best validation acc: 0.9636161923408508, corresponding to test acc:                         0.9123972058296204 / 0.9135863780975342
after epoch: 7,now: 2024-08-08 01:01:02.484538,epoch time: 0:29:51.936660,used: 3:48:05.111080,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_21_12_57_seed_1_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 3:48:05.111080 at 2024-08-08 01:01:02.484538
persisted model performance metric: 

scalar performance:
{'acc': 0.9123972, 'precision': 0.6991713, 'recall': 0.7505371, 'specificity': 0.7505371, 'f1': 0.7208471, 'auroc': 0.8885653, 'binary_precision': 0.4348718, 'binary_recall': 0.5601057, 'binary_specificity': 0.9409685, 'binary_f1_score': 0.4896074}
confusion matrix:
      0    1
0  8783  551
1   333  424
oracle model performance metric: 

scalar performance:
{'acc': 0.9135864, 'precision': 0.7015654, 'recall': 0.74935913, 'specificity': 0.74935913, 'f1': 0.72201586, 'auroc': 0.8863908, 'binary_precision': 0.4399164, 'binary_recall': 0.5561427, 'binary_specificity': 0.9425755, 'binary_f1_score': 0.49124858}
confusion matrix:
      0    1
0  8798  536
1   336  421
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB | 651774 GiB | 651774 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 643118 GiB | 643118 GiB |
|       from small pool |  18218 KiB |     38 MiB |   8655 GiB |   8655 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB | 651774 GiB | 651774 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 643118 GiB | 643118 GiB |
|       from small pool |  18218 KiB |     38 MiB |   8655 GiB |   8655 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB | 651701 GiB | 651701 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 643057 GiB | 643057 GiB |
|       from small pool |  16662 KiB |     36 MiB |   8643 GiB |   8643 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   4474 MiB |   2120 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   4420 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     54 MiB |     16 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 232507 KiB | 363127 GiB | 363127 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 354328 GiB | 354328 GiB |
|       from small pool |  10454 KiB |  22547 KiB |   8798 GiB |   8798 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6849    |   98887 K  |   98882 K  |
|       from large pool |      79    |     252    |   59763 K  |   59763 K  |
|       from small pool |    4353    |    6769    |   39123 K  |   39119 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6849    |   98887 K  |   98882 K  |
|       from large pool |      79    |     252    |   59763 K  |   59763 K  |
|       from small pool |    4353    |    6769    |   39123 K  |   39119 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     209    |      94    |
|       from large pool |      96    |      97    |     182    |      86    |
|       from small pool |      19    |      21    |      27    |       8    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3195    |   63588 K  |   63588 K  |
|       from large pool |      11    |     100    |   45190 K  |   45190 K  |
|       from small pool |      29    |    3184    |   18397 K  |   18397 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 651774 GiB | 651774 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 643118 GiB | 643118 GiB |
|       from small pool |      0 KiB |     38 MiB |   8655 GiB |   8655 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 651774 GiB | 651774 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 643118 GiB | 643118 GiB |
|       from small pool |      0 KiB |     38 MiB |   8655 GiB |   8655 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 651701 GiB | 651701 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 643057 GiB | 643057 GiB |
|       from small pool |      0 KiB |     36 MiB |   8643 GiB |   8643 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4474 MiB |   4240 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     54 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 232507 KiB | 363127 GiB | 363127 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 354328 GiB | 354328 GiB |
|       from small pool |      0 KiB |  24601 KiB |   8799 GiB |   8799 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   98887 K  |   98887 K  |
|       from large pool |       2    |     252    |   59763 K  |   59763 K  |
|       from small pool |       0    |    6769    |   39123 K  |   39123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   98887 K  |   98887 K  |
|       from large pool |       2    |     252    |   59763 K  |   59763 K  |
|       from small pool |       0    |    6769    |   39123 K  |   39123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     209    |     185    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      27    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3195    |   63590 K  |   63590 K  |
|       from large pool |       3    |     100    |   45190 K  |   45190 K  |
|       from small pool |       0    |    3184    |   18399 K  |   18399 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 651774 GiB | 651774 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 643118 GiB | 643118 GiB |
|       from small pool |      0 KiB |     38 MiB |   8655 GiB |   8655 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 651774 GiB | 651774 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 643118 GiB | 643118 GiB |
|       from small pool |      0 KiB |     38 MiB |   8655 GiB |   8655 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 651701 GiB | 651701 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 643057 GiB | 643057 GiB |
|       from small pool |      0 KiB |     36 MiB |   8643 GiB |   8643 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4474 MiB |   4240 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     54 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 232507 KiB | 363127 GiB | 363127 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 354328 GiB | 354328 GiB |
|       from small pool |      0 KiB |  24601 KiB |   8799 GiB |   8799 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   98887 K  |   98887 K  |
|       from large pool |       2    |     252    |   59763 K  |   59763 K  |
|       from small pool |       0    |    6769    |   39123 K  |   39123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   98887 K  |   98887 K  |
|       from large pool |       2    |     252    |   59763 K  |   59763 K  |
|       from small pool |       0    |    6769    |   39123 K  |   39123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     209    |     185    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      27    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3195    |   63590 K  |   63590 K  |
|       from large pool |       3    |     100    |   45190 K  |   45190 K  |
|       from small pool |       0    |    3184    |   18399 K  |   18399 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_27_10_seed_2_24111539

 Experiment start at: 2024-08-08 01:27:10.731352
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.11296075582504272
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9045187, 'precision': 0.91522217, 'recall': 0.9045343, 'specificity': 0.9045343, 'f1': 0.9039018, 'auroc': 0.9374778, 'binary_precision': 0.98193634, 'binary_recall': 0.82423705, 'binary_specificity': 0.9848315, 'binary_f1_score': 0.8962022}
confusion matrix:
       0      1
0  25451    392
1   4544  21309
---- Validation: 
scalar performance:
{'acc': 0.9632095, 'precision': 0.49460697, 'recall': 0.4971537, 'specificity': 0.4971537, 'f1': 0.49534532, 'auroc': 0.32354182, 'binary_precision': 0.013761468, 'binary_recall': 0.0071770335, 'binary_specificity': 0.98713034, 'binary_f1_score': 0.009433962}
confusion matrix:
       0    1
0  16491  215
1    415    3
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9179548, 'precision': 0.6157634, 'recall': 0.5126715, 'specificity': 0.5126715, 'f1': 0.5070297, 'auroc': 0.41140884, 'binary_precision': 0.30864197, 'binary_recall': 0.03136763, 'binary_specificity': 0.9939753, 'binary_f1_score': 0.05694761}
confusion matrix:
      0   1
0  9239  56
1   772  25
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 02:09:14.802622,epoch time: 0:42:04.071270,used: 0:42:04.071270,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_27_10_seed_2_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9317742, 'precision': 0.93400645, 'recall': 0.93177843, 'specificity': 0.93177843, 'f1': 0.9316869, 'auroc': 0.96555996, 'binary_precision': 0.96516085, 'binary_recall': 0.89590347, 'binary_specificity': 0.96765333, 'binary_f1_score': 0.9292435}
confusion matrix:
       0      1
0  25009    836
1   2691  23160
---- Validation: 
scalar performance:
{'acc': 0.9588881, 'precision': 0.5749479, 'recall': 0.57774216, 'specificity': 0.57774216, 'f1': 0.5763143, 'auroc': 0.47543073, 'binary_precision': 0.17050691, 'binary_recall': 0.1770335, 'binary_specificity': 0.97845083, 'binary_f1_score': 0.17370892}
confusion matrix:
       0    1
0  16346  360
1    344   74
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.905866, 'precision': 0.67577654, 'recall': 0.6741619, 'specificity': 0.6741619, 'f1': 0.674964, 'auroc': 0.68947434, 'binary_precision': 0.40304184, 'binary_recall': 0.39899623, 'binary_specificity': 0.9493276, 'binary_f1_score': 0.4010088}
confusion matrix:
      0    1
0  8824  471
1   479  318
early stop counter: 1
val acc:0.9588881134986877, best validation acc: 0.9632095098495483, corresponding to test acc:                         0.9179548025131226 / 0.9179548025131226
after epoch: 2,now: 2024-08-08 02:38:56.825235,epoch time: 0:29:42.022613,used: 1:11:46.093883,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_27_10_seed_2_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9392796, 'precision': 0.94011974, 'recall': 0.939283, 'specificity': 0.939283, 'f1': 0.93925095, 'auroc': 0.97128385, 'binary_precision': 0.95938677, 'binary_recall': 0.9174145, 'binary_specificity': 0.96115154, 'binary_f1_score': 0.9379313}
confusion matrix:
       0      1
0  24840   1004
1   2135  23717
---- Validation: 
scalar performance:
{'acc': 0.9241415, 'precision': 0.56876403, 'recall': 0.6975509, 'specificity': 0.6975509, 'f1': 0.5941373, 'auroc': 0.6610929, 'binary_precision': 0.15177865, 'binary_recall': 0.45933014, 'binary_specificity': 0.9357716, 'binary_f1_score': 0.228164}
confusion matrix:
       0     1
0  15633  1073
1    226   192
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8950654, 'precision': 0.6759648, 'recall': 0.7508912, 'specificity': 0.7508912, 'f1': 0.7038885, 'auroc': 0.7409872, 'binary_precision': 0.3895447, 'binary_recall': 0.57967377, 'binary_specificity': 0.92210865, 'binary_f1_score': 0.46596065}
confusion matrix:
      0    1
0  8571  724
1   335  462
early stop counter: 2
val acc:0.924141526222229, best validation acc: 0.9632095098495483, corresponding to test acc:                         0.9179548025131226 / 0.9179548025131226
after epoch: 3,now: 2024-08-08 03:08:27.715216,epoch time: 0:29:30.889981,used: 1:41:16.983864,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_27_10_seed_2_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9384865, 'precision': 0.93993187, 'recall': 0.93848765, 'specificity': 0.93848765, 'f1': 0.93843603, 'auroc': 0.97009087, 'binary_precision': 0.9651578, 'binary_recall': 0.9098224, 'binary_specificity': 0.96715283, 'binary_f1_score': 0.9366736}
confusion matrix:
       0      1
0  24998    849
1   2331  23518
---- Validation: 
scalar performance:
{'acc': 0.92244804, 'precision': 0.56884986, 'recall': 0.7036804, 'specificity': 0.7036804, 'f1': 0.5944335, 'auroc': 0.725181, 'binary_precision': 0.15160796, 'binary_recall': 0.47368422, 'binary_specificity': 0.93367654, 'binary_f1_score': 0.22969837}
confusion matrix:
       0     1
0  15598  1108
1    220   198
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9166667, 'precision': 0.6949065, 'recall': 0.6146394, 'specificity': 0.6146394, 'f1': 0.6411231, 'auroc': 0.6099194, 'binary_precision': 0.45132744, 'binary_recall': 0.25595984, 'binary_specificity': 0.973319, 'binary_f1_score': 0.32666132}
confusion matrix:
      0    1
0  9047  248
1   593  204
early stop counter: 3
val acc:0.9224480390548706, best validation acc: 0.9632095098495483, corresponding to test acc:                         0.9179548025131226 / 0.9179548025131226
after epoch: 4,now: 2024-08-08 03:37:26.373109,epoch time: 0:28:58.657893,used: 2:10:15.641757,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_27_10_seed_2_24111539
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:10:15.641757 at 2024-08-08 03:37:26.373109
persisted model performance metric: 

scalar performance:
{'acc': 0.9179548, 'precision': 0.6157634, 'recall': 0.5126715, 'specificity': 0.5126715, 'f1': 0.5070297, 'auroc': 0.41140884, 'binary_precision': 0.30864197, 'binary_recall': 0.03136763, 'binary_specificity': 0.9939753, 'binary_f1_score': 0.05694761}
confusion matrix:
      0   1
0  9239  56
1   772  25
oracle model performance metric: 

scalar performance:
{'acc': 0.9179548, 'precision': 0.6157634, 'recall': 0.5126715, 'specificity': 0.5126715, 'f1': 0.5070297, 'auroc': 0.41140884, 'binary_precision': 0.30864197, 'binary_recall': 0.03136763, 'binary_specificity': 0.9939753, 'binary_f1_score': 0.05694761}
confusion matrix:
      0   1
0  9239  56
1   772  25
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |  18218 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |  18218 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB |    866 TiB |    866 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    854 TiB |    854 TiB |
|       from small pool |  16662 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   6594 MiB |   4240 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   6530 MiB |   4214 MiB |
|       from small pool |     38 MiB |     42 MiB |     64 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 232507 KiB | 496915 GiB | 496915 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 484756 GiB | 484756 GiB |
|       from small pool |  10454 KiB |  24601 KiB |  12159 GiB |  12159 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6957    |  134546 K  |  134542 K  |
|       from large pool |      79    |     252    |   81419 K  |   81418 K  |
|       from small pool |    4353    |    6877    |   53127 K  |   53123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6957    |  134546 K  |  134542 K  |
|       from large pool |      79    |     252    |   81419 K  |   81418 K  |
|       from small pool |    4353    |    6877    |   53127 K  |   53123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     300    |     185    |
|       from large pool |      96    |      97    |     268    |     172    |
|       from small pool |      19    |      21    |      32    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3247    |   87767 K  |   87767 K  |
|       from large pool |      11    |     100    |   61090 K  |   61090 K  |
|       from small pool |      29    |    3236    |   26677 K  |   26677 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |      0 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |      0 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    866 TiB |    866 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    854 TiB |    854 TiB |
|       from small pool |      0 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   6594 MiB |   6360 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6530 MiB |   6324 MiB |
|       from small pool |  28672 KiB |     42 MiB |     64 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 232507 KiB | 496915 GiB | 496915 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 484756 GiB | 484756 GiB |
|       from small pool |      0 KiB |  25469 KiB |  12159 GiB |  12159 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6957    |  134546 K  |  134546 K  |
|       from large pool |       2    |     252    |   81419 K  |   81419 K  |
|       from small pool |       0    |    6877    |   53127 K  |   53127 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6957    |  134546 K  |  134546 K  |
|       from large pool |       2    |     252    |   81419 K  |   81419 K  |
|       from small pool |       0    |    6877    |   53127 K  |   53127 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     300    |     276    |
|       from large pool |      10    |      97    |     268    |     258    |
|       from small pool |      14    |      21    |      32    |      18    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3247    |   87769 K  |   87769 K  |
|       from large pool |       3    |     100    |   61090 K  |   61090 K  |
|       from small pool |       0    |    3236    |   26679 K  |   26679 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  8 03:55:20 2024]
Finished job 0.
1 of 1 steps (100%) done
