Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Aug  7 17:53:00 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/1.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/var/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538

 Experiment start at: 2024-08-07 18:03:28.355411
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.28613802790641785
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9319725, 'precision': 0.9375261, 'recall': 0.9320059, 'specificity': 0.9320059, 'f1': 0.9317596, 'auroc': 0.9769188, 'binary_precision': 0.9869679, 'binary_recall': 0.8755869, 'binary_specificity': 0.9884249, 'binary_f1_score': 0.92794716}
confusion matrix:
       0      1
0  25020    293
1   3153  22190
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.95853263, 'precision': 0.5067745, 'recall': 0.5052534, 'specificity': 0.5052534, 'f1': 0.5057326, 'auroc': 0.59766966, 'binary_precision': 0.0375, 'binary_recall': 0.028915662, 'binary_specificity': 0.98159105, 'binary_f1_score': 0.03265306}
confusion matrix:
       0    1
0  16423  308
1    403   12
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8924263, 'precision': 0.518973, 'recall': 0.5104179, 'specificity': 0.5104179, 'f1': 0.5104236, 'auroc': 0.76250625, 'binary_precision': 0.1127451, 'binary_recall': 0.059585493, 'binary_specificity': 0.96125025, 'binary_f1_score': 0.07796611}
confusion matrix:
      0    1
0  8980  362
1   726   46
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 18:46:21.146719,epoch time: 0:42:52.791308,used: 0:42:52.791308,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9492854, 'precision': 0.9524863, 'recall': 0.9493103, 'specificity': 0.9493103, 'f1': 0.9491975, 'auroc': 0.98476183, 'binary_precision': 0.9906921, 'binary_recall': 0.90715384, 'binary_specificity': 0.9914668, 'binary_f1_score': 0.94708437}
confusion matrix:
       0      1
0  25097    216
1   2353  22990
---- Validation: 
scalar performance:
{'acc': 0.9626735, 'precision': 0.5531945, 'recall': 0.5390984, 'specificity': 0.5390984, 'f1': 0.5447864, 'auroc': 0.7107947, 'binary_precision': 0.12871288, 'binary_recall': 0.0939759, 'binary_specificity': 0.9842209, 'binary_f1_score': 0.1086351}
confusion matrix:
       0    1
0  16467  264
1    376   39
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9045877, 'precision': 0.575372, 'recall': 0.5354196, 'specificity': 0.5354196, 'f1': 0.5435615, 'auroc': 0.79817504, 'binary_precision': 0.22190201, 'binary_recall': 0.09974093, 'binary_specificity': 0.97109824, 'binary_f1_score': 0.13762288}
confusion matrix:
      0    1
0  9072  270
1   695   77
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-07 19:16:48.289145,epoch time: 0:30:27.142426,used: 1:13:19.933734,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9566093, 'precision': 0.95903087, 'recall': 0.9566294, 'specificity': 0.9566294, 'f1': 0.95655334, 'auroc': 0.98800576, 'binary_precision': 0.99250937, 'binary_recall': 0.9202115, 'binary_specificity': 0.9930473, 'binary_f1_score': 0.954994}
confusion matrix:
       0      1
0  25138    176
1   2022  23320
---- Validation: 
scalar performance:
{'acc': 0.9599323, 'precision': 0.5786975, 'recall': 0.57999146, 'specificity': 0.57999146, 'f1': 0.5793382, 'auroc': 0.75035393, 'binary_precision': 0.17772512, 'binary_recall': 0.18072289, 'binary_specificity': 0.97926, 'binary_f1_score': 0.17921147}
confusion matrix:
       0    1
0  16384  347
1    340   75
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9030057, 'precision': 0.6053113, 'recall': 0.56605303, 'specificity': 0.56605303, 'f1': 0.5789207, 'auroc': 0.8187245, 'binary_precision': 0.2771855, 'binary_recall': 0.16839378, 'binary_specificity': 0.9637123, 'binary_f1_score': 0.20950845}
confusion matrix:
      0    1
0  9003  339
1   642  130
early stop counter: 1
val acc:0.9599323272705078, best validation acc: 0.9626734852790833, corresponding to test acc:                         0.9045876860618591 / 0.9045876860618591
after epoch: 3,now: 2024-08-07 19:47:20.317901,epoch time: 0:30:32.028756,used: 1:43:51.962490,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9512595, 'precision': 0.9548611, 'recall': 0.9512876, 'specificity': 0.9512876, 'f1': 0.95116496, 'auroc': 0.9892618, 'binary_precision': 0.99549454, 'binary_recall': 0.90668404, 'binary_specificity': 0.9958913, 'binary_f1_score': 0.9490161}
confusion matrix:
       0      1
0  25208    104
1   2365  22979
---- Validation: 
scalar performance:
{'acc': 0.9645398, 'precision': 0.6094957, 'recall': 0.5976265, 'specificity': 0.5976265, 'f1': 0.6031724, 'auroc': 0.7607, 'binary_precision': 0.23848239, 'binary_recall': 0.21204819, 'binary_specificity': 0.98320484, 'binary_f1_score': 0.2244898}
confusion matrix:
       0    1
0  16450  281
1    327   88
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90844375, 'precision': 0.6253748, 'recall': 0.57077914, 'specificity': 0.57077914, 'f1': 0.5872549, 'auroc': 0.8334962, 'binary_precision': 0.31666666, 'binary_recall': 0.17227979, 'binary_specificity': 0.9692785, 'binary_f1_score': 0.22315437}
confusion matrix:
      0    1
0  9055  287
1   639  133
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-08-07 20:18:01.217840,epoch time: 0:30:40.899939,used: 2:14:32.862429,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.924313, 'precision': 0.92431617, 'recall': 0.9243121, 'specificity': 0.9243121, 'f1': 0.9243127, 'auroc': 0.9717551, 'binary_precision': 0.92333126, 'binary_recall': 0.92558986, 'binary_specificity': 0.92303437, 'binary_f1_score': 0.9244592}
confusion matrix:
       0      1
0  23362   1948
1   1886  23460
---- Validation: 
scalar performance:
{'acc': 0.79995334, 'precision': 0.5159454, 'recall': 0.6061119, 'specificity': 0.6061119, 'f1': 0.48818976, 'auroc': 0.5896262, 'binary_precision': 0.049865633, 'binary_recall': 0.40240964, 'binary_specificity': 0.8098141, 'binary_f1_score': 0.088735394}
confusion matrix:
       0     1
0  13549  3182
1    248   167
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7778327, 'precision': 0.5799185, 'recall': 0.7074342, 'specificity': 0.7074342, 'f1': 0.58408684, 'auroc': 0.7383754, 'binary_precision': 0.19762197, 'binary_recall': 0.62435234, 'binary_specificity': 0.79051596, 'binary_f1_score': 0.30021802}
confusion matrix:
      0     1
0  7385  1957
1   290   482
early stop counter: 1
val acc:0.7999533414840698, best validation acc: 0.9645398259162903, corresponding to test acc:                         0.9084437489509583 / 0.9084437489509583
after epoch: 5,now: 2024-08-07 20:48:45.636758,epoch time: 0:30:44.418918,used: 2:45:17.281347,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9268596, 'precision': 0.92845, 'recall': 0.9268765, 'specificity': 0.9268765, 'f1': 0.92679363, 'auroc': 0.95869184, 'binary_precision': 0.95469254, 'binary_recall': 0.8963381, 'binary_specificity': 0.95741487, 'binary_f1_score': 0.92459553}
confusion matrix:
       0      1
0  24236   1078
1   2627  22715
---- Validation: 
scalar performance:
{'acc': 0.8900035, 'precision': 0.5155608, 'recall': 0.5570841, 'specificity': 0.5570841, 'f1': 0.5125333, 'auroc': 0.46292037, 'binary_precision': 0.052343275, 'binary_recall': 0.20722891, 'binary_specificity': 0.9069392, 'binary_f1_score': 0.08357629}
confusion matrix:
       0     1
0  15174  1557
1    329    86
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8292466, 'precision': 0.5448123, 'recall': 0.57484585, 'specificity': 0.57484585, 'f1': 0.5507909, 'auroc': 0.5428766, 'binary_precision': 0.1537346, 'binary_recall': 0.2746114, 'binary_specificity': 0.8750803, 'binary_f1_score': 0.19711763}
confusion matrix:
      0     1
0  8175  1167
1   560   212
early stop counter: 2
val acc:0.890003502368927, best validation acc: 0.9645398259162903, corresponding to test acc:                         0.9084437489509583 / 0.9084437489509583
after epoch: 6,now: 2024-08-07 21:18:55.189783,epoch time: 0:30:09.553025,used: 3:15:26.834372,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.91744316, 'precision': 0.9190187, 'recall': 0.9174638, 'specificity': 0.9174638, 'f1': 0.9173682, 'auroc': 0.95288885, 'binary_precision': 0.9448812, 'binary_recall': 0.8867232, 'binary_specificity': 0.94820434, 'binary_f1_score': 0.9148789}
confusion matrix:
       0      1
0  24000   1311
1   2871  22474
---- Validation: 
scalar performance:
{'acc': 0.88061357, 'precision': 0.5147955, 'recall': 0.55932224, 'specificity': 0.55932224, 'f1': 0.5093136, 'auroc': 0.49781007, 'binary_precision': 0.050660793, 'binary_recall': 0.22168675, 'binary_specificity': 0.89695776, 'binary_f1_score': 0.082474224}
confusion matrix:
       0     1
0  15007  1724
1    323    92
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82321537, 'precision': 0.5419198, 'recall': 0.5727693, 'specificity': 0.5727693, 'f1': 0.5469368, 'auroc': 0.5830015, 'binary_precision': 0.14819944, 'binary_recall': 0.27720207, 'binary_specificity': 0.86833656, 'binary_f1_score': 0.19314077}
confusion matrix:
      0     1
0  8112  1230
1   558   214
early stop counter: 3
val acc:0.8806135654449463, best validation acc: 0.9645398259162903, corresponding to test acc:                         0.9084437489509583 / 0.9084437489509583
after epoch: 7,now: 2024-08-07 21:49:31.819242,epoch time: 0:30:36.629459,used: 3:46:03.463831,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 3:46:03.463831 at 2024-08-07 21:49:31.819242
persisted model performance metric: 

scalar performance:
{'acc': 0.90844375, 'precision': 0.6253748, 'recall': 0.57077914, 'specificity': 0.57077914, 'f1': 0.5872549, 'auroc': 0.8334962, 'binary_precision': 0.31666666, 'binary_recall': 0.17227979, 'binary_specificity': 0.9692785, 'binary_f1_score': 0.22315437}
confusion matrix:
      0    1
0  9055  287
1   639  133
oracle model performance metric: 

scalar performance:
{'acc': 0.90844375, 'precision': 0.6253748, 'recall': 0.57077914, 'specificity': 0.57077914, 'f1': 0.5872549, 'auroc': 0.8334962, 'binary_precision': 0.31666666, 'binary_recall': 0.17227979, 'binary_specificity': 0.9692785, 'binary_f1_score': 0.22315437}
confusion matrix:
      0    1
0  9055  287
1   639  133
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/1.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198886 KiB |   2142 MiB | 372348 GiB | 372348 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 367455 GiB | 367454 GiB |
|       from small pool |  18224 KiB |     38 MiB |   4893 GiB |   4893 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198886 KiB |   2142 MiB | 372348 GiB | 372348 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 367455 GiB | 367454 GiB |
|       from small pool |  18224 KiB |     38 MiB |   4893 GiB |   4893 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   2141 MiB | 372314 GiB | 372314 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 367428 GiB | 367427 GiB |
|       from small pool |  16663 KiB |     36 MiB |   4886 GiB |   4886 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  61210 KiB | 225565 KiB | 203613 GiB | 203613 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 198664 GiB | 198664 GiB |
|       from small pool |  10448 KiB |  12998 KiB |   4949 GiB |   4949 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4444    |    6827    |   56513 K  |   56509 K  |
|       from large pool |      79    |     252    |   34107 K  |   34107 K  |
|       from small pool |    4365    |    6747    |   22406 K  |   22401 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4444    |    6827    |   56513 K  |   56509 K  |
|       from large pool |      79    |     252    |   34107 K  |   34107 K  |
|       from small pool |    4365    |    6747    |   22406 K  |   22401 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3182    |   36573 K  |   36573 K  |
|       from large pool |      10    |      97    |   26526 K  |   26526 K  |
|       from small pool |      29    |    3172    |   10047 K  |   10047 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 372348 GiB | 372348 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 367455 GiB | 367455 GiB |
|       from small pool |      0 KiB |     38 MiB |   4893 GiB |   4893 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 372348 GiB | 372348 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 367455 GiB | 367455 GiB |
|       from small pool |      0 KiB |     38 MiB |   4893 GiB |   4893 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 372314 GiB | 372314 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 367428 GiB | 367428 GiB |
|       from small pool |      0 KiB |     36 MiB |   4886 GiB |   4886 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 260096 KiB |   2372 MiB |   2372 MiB |   2118 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  28672 KiB |     42 MiB |     42 MiB |     14 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 203613 GiB | 203613 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 198664 GiB | 198664 GiB |
|       from small pool |      0 KiB |  22547 KiB |   4949 GiB |   4949 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   56513 K  |   56513 K  |
|       from large pool |       2    |     252    |   34107 K  |   34107 K  |
|       from small pool |       0    |    6747    |   22406 K  |   22406 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   56513 K  |   56513 K  |
|       from large pool |       2    |     252    |   34107 K  |   34107 K  |
|       from small pool |       0    |    6747    |   22406 K  |   22406 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      25    |     118    |     118    |      93    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      14    |      21    |      21    |       7    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   36575 K  |   36575 K  |
|       from large pool |       3    |      97    |   26526 K  |   26526 K  |
|       from small pool |       0    |    3172    |   10049 K  |   10049 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 372348 GiB | 372348 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 367455 GiB | 367455 GiB |
|       from small pool |      0 KiB |     38 MiB |   4893 GiB |   4893 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 372348 GiB | 372348 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 367455 GiB | 367455 GiB |
|       from small pool |      0 KiB |     38 MiB |   4893 GiB |   4893 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 372314 GiB | 372314 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 367428 GiB | 367428 GiB |
|       from small pool |      0 KiB |     36 MiB |   4886 GiB |   4886 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 260096 KiB |   2372 MiB |   2372 MiB |   2118 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  28672 KiB |     42 MiB |     42 MiB |     14 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 203613 GiB | 203613 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 198664 GiB | 198664 GiB |
|       from small pool |      0 KiB |  22547 KiB |   4949 GiB |   4949 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   56513 K  |   56513 K  |
|       from large pool |       2    |     252    |   34107 K  |   34107 K  |
|       from small pool |       0    |    6747    |   22406 K  |   22406 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   56513 K  |   56513 K  |
|       from large pool |       2    |     252    |   34107 K  |   34107 K  |
|       from small pool |       0    |    6747    |   22406 K  |   22406 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      25    |     118    |     118    |      93    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      14    |      21    |      21    |       7    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   36575 K  |   36575 K  |
|       from large pool |       3    |      97    |   26526 K  |   26526 K  |
|       from small pool |       0    |    3172    |   10049 K  |   10049 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_22_18_01_seed_1_24111538

 Experiment start at: 2024-08-07 22:18:01.435699
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6057873368263245
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93464744, 'precision': 0.93674034, 'recall': 0.9346748, 'specificity': 0.9346748, 'f1': 0.93457186, 'auroc': 0.9773353, 'binary_precision': 0.96717083, 'binary_recall': 0.89994496, 'binary_specificity': 0.96940464, 'binary_f1_score': 0.9323477}
confusion matrix:
       0      1
0  24619    777
1   2545  22891
---- Validation: 
scalar performance:
{'acc': 0.95106, 'precision': 0.549488, 'recall': 0.5612675, 'specificity': 0.5612675, 'f1': 0.55455786, 'auroc': 0.773076, 'binary_precision': 0.12104283, 'binary_recall': 0.15081206, 'binary_specificity': 0.97172296, 'binary_f1_score': 0.13429753}
confusion matrix:
       0    1
0  16220  472
1    366   65
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89882076, 'precision': 0.6388527, 'recall': 0.6430541, 'specificity': 0.6430541, 'f1': 0.6409082, 'auroc': 0.8388094, 'binary_precision': 0.33120206, 'binary_recall': 0.34214002, 'binary_specificity': 0.9439683, 'binary_f1_score': 0.33658218}
confusion matrix:
      0    1
0  8811  523
1   498  259
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 23:02:18.669472,epoch time: 0:44:17.233773,used: 0:44:17.233773,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_22_18_01_seed_1_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95012987, 'precision': 0.9527502, 'recall': 0.95016134, 'specificity': 0.95016134, 'f1': 0.95006, 'auroc': 0.98789805, 'binary_precision': 0.98740107, 'binary_recall': 0.9119786, 'binary_specificity': 0.98834413, 'binary_f1_score': 0.94819236}
confusion matrix:
       0      1
0  25099    296
1   2239  23198
---- Validation: 
scalar performance:
{'acc': 0.9662442, 'precision': 0.6034429, 'recall': 0.56566525, 'specificity': 0.56566525, 'f1': 0.5797035, 'auroc': 0.81931555, 'binary_precision': 0.22878228, 'binary_recall': 0.1438515, 'binary_specificity': 0.98747903, 'binary_f1_score': 0.17663817}
confusion matrix:
       0    1
0  16483  209
1    369   62
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9202259, 'precision': 0.706108, 'recall': 0.6728328, 'specificity': 0.6728328, 'f1': 0.68755525, 'auroc': 0.87953836, 'binary_precision': 0.46166134, 'binary_recall': 0.38177013, 'binary_specificity': 0.96389544, 'binary_f1_score': 0.417932}
confusion matrix:
      0    1
0  8997  337
1   468  289
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-07 23:33:05.815455,epoch time: 0:30:47.145983,used: 1:15:04.379756,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_22_18_01_seed_1_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96006453, 'precision': 0.9607141, 'recall': 0.96008015, 'specificity': 0.96008015, 'f1': 0.9600514, 'auroc': 0.9900538, 'binary_precision': 0.9782209, 'binary_recall': 0.9411487, 'binary_specificity': 0.9790116, 'binary_f1_score': 0.9593268}
confusion matrix:
       0      1
0  24862    533
1   1497  23940
---- Validation: 
scalar performance:
{'acc': 0.9595865, 'precision': 0.6087399, 'recall': 0.62440807, 'specificity': 0.62440807, 'f1': 0.6159657, 'auroc': 0.8448494, 'binary_precision': 0.23636363, 'binary_recall': 0.27146173, 'binary_specificity': 0.9773544, 'binary_f1_score': 0.25269976}
confusion matrix:
       0    1
0  16314  378
1    314  117
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9130909, 'precision': 0.7011011, 'recall': 0.7527329, 'specificity': 0.7527329, 'f1': 0.7229126, 'auroc': 0.88568187, 'binary_precision': 0.43839836, 'binary_recall': 0.5640687, 'binary_specificity': 0.9413971, 'binary_f1_score': 0.49335644}
confusion matrix:
      0    1
0  8787  547
1   330  427
early stop counter: 1
val acc:0.959586501121521, best validation acc: 0.9662442207336426, corresponding to test acc:                         0.9202259182929993 / 0.9202259182929993
after epoch: 3,now: 2024-08-08 00:02:29.347432,epoch time: 0:29:23.531977,used: 1:44:27.911733,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_22_18_01_seed_1_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9646876, 'precision': 0.96574265, 'recall': 0.9647064, 'specificity': 0.9647064, 'f1': 0.96466863, 'auroc': 0.99267733, 'binary_precision': 0.9881075, 'binary_recall': 0.9407533, 'binary_specificity': 0.9886596, 'binary_f1_score': 0.9638491}
confusion matrix:
       0      1
0  25108    288
1   1507  23929
---- Validation: 
scalar performance:
{'acc': 0.9561409, 'precision': 0.59935606, 'recall': 0.6294216, 'specificity': 0.6294216, 'f1': 0.6120765, 'auroc': 0.8509006, 'binary_precision': 0.21731448, 'binary_recall': 0.28538284, 'binary_specificity': 0.9734603, 'binary_f1_score': 0.2467402}
confusion matrix:
       0    1
0  16249  443
1    308  123
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91527104, 'precision': 0.70482963, 'recall': 0.7460212, 'specificity': 0.7460212, 'f1': 0.72288, 'auroc': 0.8855637, 'binary_precision': 0.44708425, 'binary_recall': 0.5468956, 'binary_specificity': 0.9451468, 'binary_f1_score': 0.49197862}
confusion matrix:
      0    1
0  8822  512
1   343  414
early stop counter: 2
val acc:0.9561408758163452, best validation acc: 0.9662442207336426, corresponding to test acc:                         0.9202259182929993 / 0.9202259182929993
after epoch: 4,now: 2024-08-08 00:34:06.662370,epoch time: 0:31:37.314938,used: 2:16:05.226671,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_22_18_01_seed_1_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9653958, 'precision': 0.9654748, 'recall': 0.9654013, 'specificity': 0.9654013, 'f1': 0.96539456, 'auroc': 0.99323666, 'binary_precision': 0.9717485, 'binary_recall': 0.9587215, 'binary_specificity': 0.9720811, 'binary_f1_score': 0.965191}
confusion matrix:
       0      1
0  24686    709
1   1050  24387
---- Validation: 
scalar performance:
{'acc': 0.93862057, 'precision': 0.5619853, 'recall': 0.6215654, 'specificity': 0.6215654, 'f1': 0.5795082, 'auroc': 0.8331782, 'binary_precision': 0.14285715, 'binary_recall': 0.287703, 'binary_specificity': 0.95542777, 'binary_f1_score': 0.19091609}
confusion matrix:
       0    1
0  15948  744
1    307  124
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9068477, 'precision': 0.6873852, 'recall': 0.74814427, 'specificity': 0.74814427, 'f1': 0.71187556, 'auroc': 0.8844187, 'binary_precision': 0.41142303, 'binary_recall': 0.5614267, 'binary_specificity': 0.9348618, 'binary_f1_score': 0.4748603}
confusion matrix:
      0    1
0  8726  608
1   332  425
early stop counter: 3
val acc:0.9386205673217773, best validation acc: 0.9662442207336426, corresponding to test acc:                         0.9202259182929993 / 0.9202259182929993
after epoch: 5,now: 2024-08-08 01:03:23.959563,epoch time: 0:29:17.297193,used: 2:45:22.523864,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_07_22_18_01_seed_1_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:45:22.523864 at 2024-08-08 01:03:23.959563
persisted model performance metric: 

scalar performance:
{'acc': 0.9202259, 'precision': 0.706108, 'recall': 0.6728328, 'specificity': 0.6728328, 'f1': 0.68755525, 'auroc': 0.87953836, 'binary_precision': 0.46166134, 'binary_recall': 0.38177013, 'binary_specificity': 0.96389544, 'binary_f1_score': 0.417932}
confusion matrix:
      0    1
0  8997  337
1   468  289
oracle model performance metric: 

scalar performance:
{'acc': 0.9202259, 'precision': 0.706108, 'recall': 0.6728328, 'specificity': 0.6728328, 'f1': 0.68755525, 'auroc': 0.87953836, 'binary_precision': 0.46166134, 'binary_recall': 0.38177013, 'binary_specificity': 0.96389544, 'binary_f1_score': 0.417932}
confusion matrix:
      0    1
0  8997  337
1   468  289
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB | 651487 GiB | 651487 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 642834 GiB | 642833 GiB |
|       from small pool |  18218 KiB |     38 MiB |   8653 GiB |   8653 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB | 651487 GiB | 651487 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 642834 GiB | 642833 GiB |
|       from small pool |  18218 KiB |     38 MiB |   8653 GiB |   8653 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB | 651417 GiB | 651417 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 642776 GiB | 642776 GiB |
|       from small pool |  16662 KiB |     36 MiB |   8641 GiB |   8641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   4472 MiB |   2118 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   4420 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     52 MiB |     14 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 231558 KiB | 361605 GiB | 361605 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 352741 GiB | 352741 GiB |
|       from small pool |  10454 KiB |  22547 KiB |   8864 GiB |   8864 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6849    |   98848 K  |   98843 K  |
|       from large pool |      79    |     252    |   59737 K  |   59737 K  |
|       from small pool |    4353    |    6769    |   39110 K  |   39106 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6849    |   98848 K  |   98843 K  |
|       from large pool |      79    |     252    |   59737 K  |   59737 K  |
|       from small pool |    4353    |    6769    |   39110 K  |   39106 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     208    |      93    |
|       from large pool |      96    |      97    |     182    |      86    |
|       from small pool |      19    |      21    |      26    |       7    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3194    |   65352 K  |   65352 K  |
|       from large pool |      11    |     100    |   45412 K  |   45412 K  |
|       from small pool |      29    |    3183    |   19940 K  |   19940 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 651487 GiB | 651487 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 642834 GiB | 642834 GiB |
|       from small pool |      0 KiB |     38 MiB |   8653 GiB |   8653 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 651487 GiB | 651487 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 642834 GiB | 642834 GiB |
|       from small pool |      0 KiB |     38 MiB |   8653 GiB |   8653 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 651417 GiB | 651417 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 642776 GiB | 642776 GiB |
|       from small pool |      0 KiB |     36 MiB |   8641 GiB |   8641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4472 MiB |   4238 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     52 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 361605 GiB | 361605 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 352741 GiB | 352741 GiB |
|       from small pool |      0 KiB |  25469 KiB |   8864 GiB |   8864 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   98848 K  |   98848 K  |
|       from large pool |       2    |     252    |   59737 K  |   59737 K  |
|       from small pool |       0    |    6769    |   39110 K  |   39110 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   98848 K  |   98848 K  |
|       from large pool |       2    |     252    |   59737 K  |   59737 K  |
|       from small pool |       0    |    6769    |   39110 K  |   39110 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     208    |     184    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      26    |      12    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3194    |   65354 K  |   65354 K  |
|       from large pool |       3    |     100    |   45412 K  |   45412 K  |
|       from small pool |       0    |    3183    |   19942 K  |   19942 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 651487 GiB | 651487 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 642834 GiB | 642834 GiB |
|       from small pool |      0 KiB |     38 MiB |   8653 GiB |   8653 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 651487 GiB | 651487 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 642834 GiB | 642834 GiB |
|       from small pool |      0 KiB |     38 MiB |   8653 GiB |   8653 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 651417 GiB | 651417 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 642776 GiB | 642776 GiB |
|       from small pool |      0 KiB |     36 MiB |   8641 GiB |   8641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4472 MiB |   4238 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     52 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 361605 GiB | 361605 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 352741 GiB | 352741 GiB |
|       from small pool |      0 KiB |  25469 KiB |   8864 GiB |   8864 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   98848 K  |   98848 K  |
|       from large pool |       2    |     252    |   59737 K  |   59737 K  |
|       from small pool |       0    |    6769    |   39110 K  |   39110 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   98848 K  |   98848 K  |
|       from large pool |       2    |     252    |   59737 K  |   59737 K  |
|       from small pool |       0    |    6769    |   39110 K  |   39110 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     208    |     184    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      26    |      12    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3194    |   65354 K  |   65354 K  |
|       from large pool |       3    |     100    |   45412 K  |   45412 K  |
|       from small pool |       0    |    3183    |   19942 K  |   19942 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_30_26_seed_2_24111538

 Experiment start at: 2024-08-08 01:30:26.660022
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.11296075582504272
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9067239, 'precision': 0.9143099, 'recall': 0.90672654, 'specificity': 0.90672654, 'f1': 0.9062954, 'auroc': 0.94326925, 'binary_precision': 0.9703816, 'binary_recall': 0.8390653, 'binary_specificity': 0.97438776, 'binary_f1_score': 0.8999585}
confusion matrix:
       0      1
0  25185    662
1   4160  21689
---- Validation: 
scalar performance:
{'acc': 0.9619248, 'precision': 0.49998987, 'recall': 0.49999398, 'specificity': 0.49999398, 'f1': 0.49932915, 'auroc': 0.34461167, 'binary_precision': 0.024390243, 'binary_recall': 0.014354067, 'binary_specificity': 0.9856339, 'binary_f1_score': 0.018072288}
confusion matrix:
       0    1
0  16466  240
1    412    6
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9182521, 'precision': 0.6433345, 'recall': 0.51971555, 'specificity': 0.51971555, 'f1': 0.51976717, 'auroc': 0.44518846, 'binary_precision': 0.3627451, 'binary_recall': 0.04642409, 'binary_specificity': 0.993007, 'binary_f1_score': 0.08231368}
confusion matrix:
      0   1
0  9230  65
1   760  37
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 02:13:02.944354,epoch time: 0:42:36.284332,used: 0:42:36.284332,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_30_26_seed_2_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9330896, 'precision': 0.9345111, 'recall': 0.9330963, 'specificity': 0.9330963, 'f1': 0.9330355, 'auroc': 0.967409, 'binary_precision': 0.9594223, 'binary_recall': 0.9044635, 'binary_specificity': 0.961729, 'binary_f1_score': 0.9311326}
confusion matrix:
       0      1
0  24853    989
1   2470  23384
---- Validation: 
scalar performance:
{'acc': 0.93891615, 'precision': 0.5549295, 'recall': 0.6083248, 'specificity': 0.6083248, 'f1': 0.570378, 'auroc': 0.570251, 'binary_precision': 0.12884161, 'binary_recall': 0.26076555, 'binary_specificity': 0.9558841, 'binary_f1_score': 0.17246836}
confusion matrix:
       0    1
0  15969  737
1    309  109
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89456993, 'precision': 0.66644627, 'recall': 0.7185029, 'specificity': 0.7185029, 'f1': 0.6873596, 'auroc': 0.75908923, 'binary_precision': 0.37627432, 'binary_recall': 0.50941026, 'binary_specificity': 0.9275955, 'binary_f1_score': 0.4328358}
confusion matrix:
      0    1
0  8622  673
1   391  406
early stop counter: 1
val acc:0.9389161467552185, best validation acc: 0.9619247913360596, corresponding to test acc:                         0.9182521104812622 / 0.9182521104812622
after epoch: 2,now: 2024-08-08 02:41:31.579525,epoch time: 0:28:28.635171,used: 1:11:04.919503,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_30_26_seed_2_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9420071, 'precision': 0.9443927, 'recall': 0.9420142, 'specificity': 0.9420142, 'f1': 0.9419298, 'auroc': 0.9699658, 'binary_precision': 0.9770005, 'binary_recall': 0.9053495, 'binary_specificity': 0.97867894, 'binary_f1_score': 0.93981135}
confusion matrix:
       0      1
0  25292    551
1   2447  23406
---- Validation: 
scalar performance:
{'acc': 0.9498949, 'precision': 0.57967794, 'recall': 0.6279465, 'specificity': 0.6279465, 'f1': 0.59705806, 'auroc': 0.5562062, 'binary_precision': 0.17741935, 'binary_recall': 0.28947368, 'binary_specificity': 0.9664193, 'binary_f1_score': 0.22000001}
confusion matrix:
       0    1
0  16145  561
1    297  121
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91617125, 'precision': 0.70193994, 'recall': 0.6545197, 'specificity': 0.6545197, 'f1': 0.6740447, 'auroc': 0.65276945, 'binary_precision': 0.4589615, 'binary_recall': 0.34378922, 'binary_specificity': 0.96525013, 'binary_f1_score': 0.39311334}
confusion matrix:
      0    1
0  8972  323
1   523  274
early stop counter: 2
val acc:0.949894905090332, best validation acc: 0.9619247913360596, corresponding to test acc:                         0.9182521104812622 / 0.9182521104812622
after epoch: 3,now: 2024-08-08 03:09:01.949457,epoch time: 0:27:30.369932,used: 1:38:35.289435,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_30_26_seed_2_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9352948, 'precision': 0.93863404, 'recall': 0.93530154, 'specificity': 0.93530154, 'f1': 0.9351721, 'auroc': 0.96632564, 'binary_precision': 0.97694427, 'binary_recall': 0.89165246, 'binary_specificity': 0.9789506, 'binary_f1_score': 0.93235177}
confusion matrix:
       0      1
0  25300    544
1   2801  23051
---- Validation: 
scalar performance:
{'acc': 0.9528732, 'precision': 0.5971092, 'recall': 0.6539639, 'specificity': 0.6539639, 'f1': 0.61798644, 'auroc': 0.621153, 'binary_precision': 0.21099554, 'binary_recall': 0.33971292, 'binary_specificity': 0.968215, 'binary_f1_score': 0.26031163}
confusion matrix:
       0    1
0  16175  531
1    276  142
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91944116, 'precision': 0.70521617, 'recall': 0.58976185, 'specificity': 0.58976185, 'f1': 0.61861384, 'auroc': 0.60008204, 'binary_precision': 0.4759036, 'binary_recall': 0.19824341, 'binary_specificity': 0.98128027, 'binary_f1_score': 0.2798937}
confusion matrix:
      0    1
0  9121  174
1   639  158
new oracle model saved
early stop counter: 3
val acc:0.952873170375824, best validation acc: 0.9619247913360596, corresponding to test acc:                         0.9182521104812622 / 0.9194411635398865
after epoch: 4,now: 2024-08-08 03:37:19.484136,epoch time: 0:28:17.534679,used: 2:06:52.824114,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_01_30_26_seed_2_24111538
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:06:52.824114 at 2024-08-08 03:37:19.484136
persisted model performance metric: 

scalar performance:
{'acc': 0.9182521, 'precision': 0.6433345, 'recall': 0.51971555, 'specificity': 0.51971555, 'f1': 0.51976717, 'auroc': 0.44518846, 'binary_precision': 0.3627451, 'binary_recall': 0.04642409, 'binary_specificity': 0.993007, 'binary_f1_score': 0.08231368}
confusion matrix:
      0   1
0  9230  65
1   760  37
oracle model performance metric: 

scalar performance:
{'acc': 0.91944116, 'precision': 0.70521617, 'recall': 0.58976185, 'specificity': 0.58976185, 'f1': 0.61861384, 'auroc': 0.60008204, 'binary_precision': 0.4759036, 'binary_recall': 0.19824341, 'binary_specificity': 0.98128027, 'binary_f1_score': 0.2798937}
confusion matrix:
      0    1
0  9121  174
1   639  158
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |  18218 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |  18218 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB |    866 TiB |    866 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    854 TiB |    854 TiB |
|       from small pool |  16662 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2362 MiB |   2372 MiB |   6600 MiB |   4238 MiB |
|       from large pool |   2324 MiB |   2330 MiB |   6538 MiB |   4214 MiB |
|       from small pool |     38 MiB |     42 MiB |     62 MiB |     24 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 233721 KiB | 489745 GiB | 489745 GiB |
|       from large pool |  31733 KiB | 231736 KiB | 477520 GiB | 477520 GiB |
|       from small pool |  10454 KiB |  25469 KiB |  12225 GiB |  12225 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6957    |  134507 K  |  134503 K  |
|       from large pool |      79    |     252    |   81393 K  |   81393 K  |
|       from small pool |    4353    |    6877    |   53114 K  |   53110 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6957    |  134507 K  |  134503 K  |
|       from large pool |      79    |     252    |   81393 K  |   81393 K  |
|       from small pool |    4353    |    6877    |   53114 K  |   53110 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     300    |     184    |
|       from large pool |      97    |      97    |     269    |     172    |
|       from small pool |      19    |      21    |      31    |      12    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3247    |   89971 K  |   89971 K  |
|       from large pool |      11    |     101    |   61751 K  |   61751 K  |
|       from small pool |      29    |    3236    |   28220 K  |   28219 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |      0 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    866 TiB |    866 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    854 TiB |    854 TiB |
|       from small pool |      0 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    866 TiB |    866 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    854 TiB |    854 TiB |
|       from small pool |      0 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   6600 MiB |   6366 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6538 MiB |   6332 MiB |
|       from small pool |  28672 KiB |     42 MiB |     62 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 233721 KiB | 489745 GiB | 489745 GiB |
|       from large pool |  30464 KiB | 231736 KiB | 477520 GiB | 477520 GiB |
|       from small pool |      0 KiB |  25469 KiB |  12225 GiB |  12225 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6957    |  134507 K  |  134507 K  |
|       from large pool |       2    |     252    |   81393 K  |   81393 K  |
|       from small pool |       0    |    6877    |   53114 K  |   53114 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6957    |  134507 K  |  134507 K  |
|       from large pool |       2    |     252    |   81393 K  |   81393 K  |
|       from small pool |       0    |    6877    |   53114 K  |   53114 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     300    |     276    |
|       from large pool |      10    |      97    |     269    |     259    |
|       from small pool |      14    |      21    |      31    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3247    |   89973 K  |   89973 K  |
|       from large pool |       3    |     101    |   61751 K  |   61751 K  |
|       from small pool |       0    |    3236    |   28221 K  |   28221 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  8 03:54:16 2024]
Finished job 0.
1 of 1 steps (100%) done
