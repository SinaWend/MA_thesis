Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Aug  7 17:53:02 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540

 Experiment start at: 2024-08-07 18:03:28.377422
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6631401777267456
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9528585, 'precision': 0.9543327, 'recall': 0.95287657, 'specificity': 0.95287657, 'f1': 0.95282155, 'auroc': 0.9860288, 'binary_precision': 0.98037165, 'binary_recall': 0.9242819, 'binary_specificity': 0.98147124, 'binary_f1_score': 0.9515009}
confusion matrix:
       0      1
0  24843    469
1   1919  23425
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.8865041, 'precision': 0.5689544, 'recall': 0.8208262, 'specificity': 0.8208262, 'f1': 0.59072804, 'auroc': 0.8892617, 'binary_precision': 0.14477958, 'binary_recall': 0.7518072, 'binary_specificity': 0.8898452, 'binary_f1_score': 0.24280155}
confusion matrix:
       0     1
0  14888  1843
1    103   312
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.78198534, 'precision': 0.6047704, 'recall': 0.7881094, 'specificity': 0.7881094, 'f1': 0.61320776, 'auroc': 0.857437, 'binary_precision': 0.23074032, 'binary_recall': 0.7953368, 'binary_specificity': 0.78088206, 'binary_f1_score': 0.3577046}
confusion matrix:
      0     1
0  7295  2047
1   158   614
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 18:32:55.437755,epoch time: 0:29:27.060333,used: 0:29:27.060333,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96626264, 'precision': 0.966696, 'recall': 0.96626925, 'specificity': 0.96626925, 'f1': 0.9662551, 'auroc': 0.992133, 'binary_precision': 0.9810276, 'binary_recall': 0.9509452, 'binary_specificity': 0.9815934, 'binary_f1_score': 0.9657522}
confusion matrix:
       0      1
0  24851    466
1   1243  24096
---- Validation: 
scalar performance:
{'acc': 0.8967106, 'precision': 0.57763183, 'recall': 0.8389803, 'specificity': 0.8389803, 'f1': 0.6058563, 'auroc': 0.90632737, 'binary_precision': 0.16133866, 'binary_recall': 0.7783133, 'binary_specificity': 0.89964736, 'binary_f1_score': 0.2672735}
confusion matrix:
       0     1
0  15052  1679
1     92   323
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82351196, 'precision': 0.6246779, 'recall': 0.8022705, 'specificity': 0.8022705, 'f1': 0.6492449, 'auroc': 0.87646556, 'binary_precision': 0.27112517, 'binary_recall': 0.77720207, 'binary_specificity': 0.8273389, 'binary_f1_score': 0.40201005}
confusion matrix:
      0     1
0  7729  1613
1   172   600
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-07 18:59:17.788019,epoch time: 0:26:22.350264,used: 0:55:49.410597,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97036874, 'precision': 0.97084606, 'recall': 0.9703776, 'specificity': 0.9703776, 'f1': 0.9703616, 'auroc': 0.9938297, 'binary_precision': 0.9859758, 'binary_recall': 0.9543446, 'binary_specificity': 0.9864107, 'binary_f1_score': 0.96990234}
confusion matrix:
       0      1
0  24970    344
1   1157  24185
---- Validation: 
scalar performance:
{'acc': 0.9058089, 'precision': 0.58551705, 'recall': 0.849517, 'specificity': 0.849517, 'f1': 0.6192119, 'auroc': 0.9167542, 'binary_precision': 0.17672414, 'binary_recall': 0.79036146, 'binary_specificity': 0.9086725, 'binary_f1_score': 0.28885952}
confusion matrix:
       0     1
0  15203  1528
1     87   328
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8477358, 'precision': 0.63190085, 'recall': 0.77914035, 'specificity': 0.77914035, 'f1': 0.6621572, 'auroc': 0.87332225, 'binary_precision': 0.29198265, 'binary_recall': 0.6981865, 'binary_specificity': 0.8600942, 'binary_f1_score': 0.41176468}
confusion matrix:
      0     1
0  8035  1307
1   233   539
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-07 19:25:48.112388,epoch time: 0:26:30.324369,used: 1:22:19.734966,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9734089, 'precision': 0.97366667, 'recall': 0.9734168, 'specificity': 0.9734168, 'f1': 0.9734056, 'auroc': 0.99503314, 'binary_precision': 0.98488647, 'binary_recall': 0.9616098, 'binary_specificity': 0.9852238, 'binary_f1_score': 0.97310895}
confusion matrix:
       0      1
0  24937    374
1    973  24372
---- Validation: 
scalar performance:
{'acc': 0.89583576, 'precision': 0.5798135, 'recall': 0.8549811, 'specificity': 0.8549811, 'f1': 0.60893834, 'auroc': 0.9190328, 'binary_precision': 0.16479218, 'binary_recall': 0.8120482, 'binary_specificity': 0.89791405, 'binary_f1_score': 0.27398375}
confusion matrix:
       0     1
0  15023  1708
1     78   337
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8434843, 'precision': 0.6361563, 'recall': 0.80416965, 'specificity': 0.80416965, 'f1': 0.6672022, 'auroc': 0.8791095, 'binary_precision': 0.2953054, 'binary_recall': 0.757772, 'binary_specificity': 0.85056734, 'binary_f1_score': 0.42499092}
confusion matrix:
      0     1
0  7946  1396
1   187   585
early stop counter: 1
val acc:0.8958357572555542, best validation acc: 0.9058089256286621, corresponding to test acc:                         0.8477358222007751 / 0.8477358222007751
after epoch: 4,now: 2024-08-07 19:51:37.722875,epoch time: 0:25:49.610487,used: 1:48:09.345453,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97743607, 'precision': 0.9775107, 'recall': 0.9774393, 'specificity': 0.9774393, 'f1': 0.97743523, 'auroc': 0.9963486, 'binary_precision': 0.9836118, 'binary_recall': 0.9710745, 'binary_specificity': 0.98380405, 'binary_f1_score': 0.9773029}
confusion matrix:
       0      1
0  24905    410
1    733  24608
---- Validation: 
scalar performance:
{'acc': 0.90114313, 'precision': 0.58286273, 'recall': 0.8530009, 'specificity': 0.8530009, 'f1': 0.6145003, 'auroc': 0.92017025, 'binary_precision': 0.17112024, 'binary_recall': 0.80240965, 'binary_specificity': 0.9035921, 'binary_f1_score': 0.28208387}
confusion matrix:
       0     1
0  15118  1613
1     82   333
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.85940284, 'precision': 0.6304496, 'recall': 0.7456481, 'specificity': 0.7456481, 'f1': 0.65968764, 'auroc': 0.8642875, 'binary_precision': 0.29611042, 'binary_recall': 0.61139894, 'binary_specificity': 0.87989724, 'binary_f1_score': 0.39898565}
confusion matrix:
      0     1
0  8220  1122
1   300   472
new oracle model saved
early stop counter: 2
val acc:0.9011431336402893, best validation acc: 0.9058089256286621, corresponding to test acc:                         0.8477358222007751 / 0.8594028353691101
after epoch: 5,now: 2024-08-07 20:17:10.202047,epoch time: 0:25:32.479172,used: 2:13:41.824625,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9789166, 'precision': 0.9791306, 'recall': 0.9789225, 'specificity': 0.9789225, 'f1': 0.9789145, 'auroc': 0.9967575, 'binary_precision': 0.98939514, 'binary_recall': 0.96823454, 'binary_specificity': 0.9896105, 'binary_f1_score': 0.9787005}
confusion matrix:
       0      1
0  25051    263
1    805  24537
---- Validation: 
scalar performance:
{'acc': 0.9203313, 'precision': 0.5946173, 'recall': 0.8322846, 'specificity': 0.8322846, 'f1': 0.63391286, 'auroc': 0.919613, 'binary_precision': 0.19616613, 'binary_recall': 0.739759, 'binary_specificity': 0.92481023, 'binary_f1_score': 0.310101}
confusion matrix:
       0     1
0  15473  1258
1    108   307
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8804627, 'precision': 0.64092267, 'recall': 0.7148638, 'specificity': 0.7148638, 'f1': 0.66621995, 'auroc': 0.8587235, 'binary_precision': 0.3236481, 'binary_recall': 0.51943004, 'binary_specificity': 0.9102976, 'binary_f1_score': 0.39880657}
confusion matrix:
      0    1
0  8504  838
1   371  401
new oracle model saved
better model found
persisted
after epoch: 6,now: 2024-08-07 20:43:15.278433,epoch time: 0:26:05.076386,used: 2:39:46.901011,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.97990364, 'precision': 0.98012817, 'recall': 0.9799093, 'specificity': 0.9799093, 'f1': 0.97990155, 'auroc': 0.99717945, 'binary_precision': 0.9906403, 'binary_recall': 0.96898305, 'binary_specificity': 0.9908355, 'binary_f1_score': 0.97969204}
confusion matrix:
       0      1
0  25083    232
1    786  24555
---- Validation: 
scalar performance:
{'acc': 0.93257904, 'precision': 0.60726506, 'recall': 0.82563615, 'specificity': 0.82563615, 'f1': 0.6515758, 'auroc': 0.92104864, 'binary_precision': 0.22205551, 'binary_recall': 0.713253, 'binary_specificity': 0.9380192, 'binary_f1_score': 0.33867276}
confusion matrix:
       0     1
0  15694  1037
1    119   296
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8948982, 'precision': 0.6445923, 'recall': 0.66742235, 'specificity': 0.66742235, 'f1': 0.65478873, 'auroc': 0.85222137, 'binary_precision': 0.33958104, 'binary_recall': 0.39896372, 'binary_specificity': 0.93588096, 'binary_f1_score': 0.36688507}
confusion matrix:
      0    1
0  8743  599
1   464  308
new oracle model saved
better model found
persisted
after epoch: 7,now: 2024-08-07 21:09:08.195375,epoch time: 0:25:52.916942,used: 3:05:39.817953,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.98087096, 'precision': 0.98097205, 'recall': 0.9808756, 'specificity': 0.9808756, 'f1': 0.9808701, 'auroc': 0.9974956, 'binary_precision': 0.98810524, 'binary_recall': 0.9734849, 'binary_specificity': 0.9882664, 'binary_f1_score': 0.98074055}
confusion matrix:
       0      1
0  25015    297
1    672  24672
---- Validation: 
scalar performance:
{'acc': 0.9299545, 'precision': 0.60805017, 'recall': 0.8466151, 'specificity': 0.8466151, 'f1': 0.653538, 'auroc': 0.9251195, 'binary_precision': 0.22245763, 'binary_recall': 0.7590361, 'binary_specificity': 0.934194, 'binary_f1_score': 0.34407425}
confusion matrix:
       0     1
0  15630  1101
1    100   315
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8947993, 'precision': 0.64770883, 'recall': 0.67628103, 'specificity': 0.67628103, 'f1': 0.66016006, 'auroc': 0.8562287, 'binary_precision': 0.34434968, 'binary_recall': 0.4183938, 'binary_specificity': 0.9341683, 'binary_f1_score': 0.37777779}
confusion matrix:
      0    1
0  8727  615
1   449  323
early stop counter: 1
val acc:0.9299545288085938, best validation acc: 0.9325790405273438, corresponding to test acc:                         0.8948981761932373 / 0.8948981761932373
after epoch: 8,now: 2024-08-07 21:34:49.772373,epoch time: 0:25:41.576998,used: 3:31:21.394951,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98308194, 'precision': 0.98309994, 'recall': 0.9830836, 'specificity': 0.9830836, 'f1': 0.9830818, 'auroc': 0.99784434, 'binary_precision': 0.98617953, 'binary_recall': 0.97991395, 'binary_specificity': 0.9862532, 'binary_f1_score': 0.9830367}
confusion matrix:
       0      1
0  24967    348
1    509  24832
---- Validation: 
scalar performance:
{'acc': 0.93112093, 'precision': 0.60964775, 'recall': 0.8472128, 'specificity': 0.8472128, 'f1': 0.6557572, 'auroc': 0.92854726, 'binary_precision': 0.2256447, 'binary_recall': 0.7590361, 'binary_specificity': 0.9353894, 'binary_f1_score': 0.34787408}
confusion matrix:
       0     1
0  15650  1081
1    100   315
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8959858, 'precision': 0.65547097, 'recall': 0.69296527, 'specificity': 0.69296527, 'f1': 0.6713023, 'auroc': 0.8628726, 'binary_precision': 0.35714287, 'binary_recall': 0.4533679, 'binary_specificity': 0.93256265, 'binary_f1_score': 0.39954337}
confusion matrix:
      0    1
0  8712  630
1   422  350
new oracle model saved
early stop counter: 2
val acc:0.9311209321022034, best validation acc: 0.9325790405273438, corresponding to test acc:                         0.8948981761932373 / 0.8959857821464539
after epoch: 9,now: 2024-08-07 22:01:51.396517,epoch time: 0:27:01.624144,used: 3:58:23.019095,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.981858, 'precision': 0.98202276, 'recall': 0.9818632, 'specificity': 0.9818632, 'f1': 0.9818566, 'auroc': 0.997475, 'binary_precision': 0.99107254, 'binary_recall': 0.9724963, 'binary_specificity': 0.99123013, 'binary_f1_score': 0.9816965}
confusion matrix:
       0      1
0  25092    222
1    697  24645
---- Validation: 
scalar performance:
{'acc': 0.9387029, 'precision': 0.61774516, 'recall': 0.83347374, 'specificity': 0.83347374, 'f1': 0.66560864, 'auroc': 0.9275788, 'binary_precision': 0.24271844, 'binary_recall': 0.72289157, 'binary_specificity': 0.9440559, 'binary_f1_score': 0.3634161}
confusion matrix:
       0    1
0  15795  936
1    115  300
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89450264, 'precision': 0.650519, 'recall': 0.6856268, 'specificity': 0.6856268, 'f1': 0.665405, 'auroc': 0.8586744, 'binary_precision': 0.348407, 'binary_recall': 0.43911916, 'binary_specificity': 0.93213445, 'binary_f1_score': 0.3885387}
confusion matrix:
      0    1
0  8708  634
1   433  339
better model found
persisted
after epoch: 10,now: 2024-08-07 22:28:46.535325,epoch time: 0:26:55.138808,used: 4:25:18.157903,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.98347676, 'precision': 0.98352116, 'recall': 0.9834801, 'specificity': 0.9834801, 'f1': 0.9834765, 'auroc': 0.9979875, 'binary_precision': 0.9883239, 'binary_recall': 0.9785362, 'binary_specificity': 0.988424, 'binary_f1_score': 0.98340577}
confusion matrix:
       0      1
0  25018    293
1    544  24801
---- Validation: 
scalar performance:
{'acc': 0.9335705, 'precision': 0.6122364, 'recall': 0.8437682, 'specificity': 0.8437682, 'f1': 0.65909785, 'auroc': 0.927246, 'binary_precision': 0.23105498, 'binary_recall': 0.7493976, 'binary_specificity': 0.9381388, 'binary_f1_score': 0.35320842}
confusion matrix:
       0     1
0  15696  1035
1    104   311
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89064664, 'precision': 0.6449697, 'recall': 0.68710434, 'specificity': 0.68710434, 'f1': 0.6620914, 'auroc': 0.8587663, 'binary_precision': 0.33691406, 'binary_recall': 0.4468912, 'binary_specificity': 0.9273175, 'binary_f1_score': 0.38418707}
confusion matrix:
      0    1
0  8663  679
1   427  345
early stop counter: 1
val acc:0.9335705041885376, best validation acc: 0.9387028813362122, corresponding to test acc:                         0.8945026397705078 / 0.8959857821464539
after epoch: 11,now: 2024-08-07 22:54:38.484307,epoch time: 0:25:51.948982,used: 4:51:10.106885,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.98432565, 'precision': 0.9843873, 'recall': 0.9843295, 'specificity': 0.9843295, 'f1': 0.98432523, 'auroc': 0.9979613, 'binary_precision': 0.99002033, 'binary_recall': 0.9785362, 'binary_specificity': 0.99012285, 'binary_f1_score': 0.98424476}
confusion matrix:
       0      1
0  25061    250
1    544  24801
---- Validation: 
scalar performance:
{'acc': 0.9443602, 'precision': 0.6290507, 'recall': 0.8410723, 'specificity': 0.8410723, 'f1': 0.6800485, 'auroc': 0.929898, 'binary_precision': 0.26503924, 'binary_recall': 0.7325301, 'binary_specificity': 0.94961447, 'binary_f1_score': 0.3892446}
confusion matrix:
       0    1
0  15888  843
1    111  304
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90112716, 'precision': 0.6616629, 'recall': 0.6832713, 'specificity': 0.6832713, 'f1': 0.67150676, 'auroc': 0.8663137, 'binary_precision': 0.37133184, 'binary_recall': 0.4261658, 'binary_specificity': 0.9403768, 'binary_f1_score': 0.3968637}
confusion matrix:
      0    1
0  8785  557
1   443  329
new oracle model saved
better model found
persisted
after epoch: 12,now: 2024-08-07 23:21:32.100016,epoch time: 0:26:53.615709,used: 5:18:03.722594,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.9838716, 'precision': 0.98388416, 'recall': 0.9838729, 'specificity': 0.9838729, 'f1': 0.9838716, 'auroc': 0.9982085, 'binary_precision': 0.98647094, 'binary_recall': 0.9812155, 'binary_specificity': 0.98653024, 'binary_f1_score': 0.98383623}
confusion matrix:
       0      1
0  24975    341
1    476  24864
---- Validation: 
scalar performance:
{'acc': 0.9420856, 'precision': 0.6251558, 'recall': 0.84225667, 'specificity': 0.84225667, 'f1': 0.6754647, 'auroc': 0.93358886, 'binary_precision': 0.25714287, 'binary_recall': 0.7373494, 'binary_specificity': 0.94716394, 'binary_f1_score': 0.3813084}
confusion matrix:
       0    1
0  15847  884
1    109  306
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8976666, 'precision': 0.6594273, 'recall': 0.6962517, 'specificity': 0.6962517, 'f1': 0.6751025, 'auroc': 0.8696176, 'binary_precision': 0.3645726, 'binary_recall': 0.45854923, 'binary_specificity': 0.9339542, 'binary_f1_score': 0.4061962}
confusion matrix:
      0    1
0  8725  617
1   418  354
early stop counter: 1
val acc:0.9420856237411499, best validation acc: 0.9443601965904236, corresponding to test acc:                         0.9011271595954895 / 0.9011271595954895
after epoch: 13,now: 2024-08-07 23:48:49.136924,epoch time: 0:27:17.036908,used: 5:45:20.759502,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 14
---- Training Domain: 
scalar performance:
{'acc': 0.98329914, 'precision': 0.9835253, 'recall': 0.98330647, 'specificity': 0.98330647, 'f1': 0.98329735, 'auroc': 0.9981199, 'binary_precision': 0.99415064, 'binary_recall': 0.97234166, 'binary_specificity': 0.9942713, 'binary_f1_score': 0.9831252}
confusion matrix:
       0      1
0  25166    145
1    701  24644
---- Validation: 
scalar performance:
{'acc': 0.94541, 'precision': 0.6282928, 'recall': 0.827511, 'specificity': 0.827511, 'f1': 0.6778248, 'auroc': 0.9287857, 'binary_precision': 0.2642534, 'binary_recall': 0.7036145, 'binary_specificity': 0.95140755, 'binary_f1_score': 0.38421056}
confusion matrix:
       0    1
0  15918  813
1    123  292
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9008305, 'precision': 0.65421367, 'recall': 0.6635039, 'specificity': 0.6635039, 'f1': 0.6586653, 'auroc': 0.8614688, 'binary_precision': 0.3596598, 'binary_recall': 0.3834197, 'binary_specificity': 0.9435881, 'binary_f1_score': 0.37115988}
confusion matrix:
      0    1
0  8815  527
1   476  296
better model found
persisted
after epoch: 14,now: 2024-08-08 00:15:24.659850,epoch time: 0:26:35.522926,used: 6:11:56.282428,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 15
---- Training Domain: 
scalar performance:
{'acc': 0.98535216, 'precision': 0.98543566, 'recall': 0.98535645, 'specificity': 0.98535645, 'f1': 0.9853516, 'auroc': 0.998354, 'binary_precision': 0.9919613, 'binary_recall': 0.9786537, 'binary_specificity': 0.9920591, 'binary_f1_score': 0.9852626}
confusion matrix:
       0      1
0  25111    201
1    541  24803
---- Validation: 
scalar performance:
{'acc': 0.93671995, 'precision': 0.6173076, 'recall': 0.8465569, 'specificity': 0.8465569, 'f1': 0.6659131, 'auroc': 0.93042934, 'binary_precision': 0.24111283, 'binary_recall': 0.7518072, 'binary_specificity': 0.94130653, 'binary_f1_score': 0.3651258}
confusion matrix:
       0    1
0  15749  982
1    103  312
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9009294, 'precision': 0.65594524, 'recall': 0.66771644, 'specificity': 0.66771644, 'f1': 0.66152626, 'auroc': 0.8552339, 'binary_precision': 0.3624402, 'binary_recall': 0.39248705, 'binary_specificity': 0.94294584, 'binary_f1_score': 0.37686566}
confusion matrix:
      0    1
0  8809  533
1   469  303
early stop counter: 1
val acc:0.9367199540138245, best validation acc: 0.9454100131988525, corresponding to test acc:                         0.9008305072784424 / 0.9011271595954895
after epoch: 15,now: 2024-08-08 00:41:30.984898,epoch time: 0:26:06.325048,used: 6:38:02.607476,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_18_03_28_seed_0_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
Experiment finished at epoch: 15 with time: 6:38:02.607476 at 2024-08-08 00:41:30.984898
persisted model performance metric: 

scalar performance:
{'acc': 0.9008305, 'precision': 0.65421367, 'recall': 0.6635039, 'specificity': 0.6635039, 'f1': 0.6586653, 'auroc': 0.8614688, 'binary_precision': 0.3596598, 'binary_recall': 0.3834197, 'binary_specificity': 0.9435881, 'binary_f1_score': 0.37115988}
confusion matrix:
      0    1
0  8815  527
1   476  296
oracle model performance metric: 

scalar performance:
{'acc': 0.90112716, 'precision': 0.6616629, 'recall': 0.6832713, 'specificity': 0.6832713, 'f1': 0.67150676, 'auroc': 0.8663137, 'binary_precision': 0.37133184, 'binary_recall': 0.4261658, 'binary_specificity': 0.9403768, 'binary_f1_score': 0.3968637}
confusion matrix:
      0    1
0  8785  557
1   443  329
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198334 KiB |   1195 MiB | 468898 GiB | 468898 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 462310 GiB | 462310 GiB |
|       from small pool |  18214 KiB |     38 MiB |   6588 GiB |   6588 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198334 KiB |   1195 MiB | 468898 GiB | 468898 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 462310 GiB | 462310 GiB |
|       from small pool |  18214 KiB |     38 MiB |   6588 GiB |   6588 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   1193 MiB | 468884 GiB | 468884 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 462308 GiB | 462308 GiB |
|       from small pool |  16663 KiB |     36 MiB |   6575 GiB |   6575 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1346 MiB |   1346 MiB |   1346 MiB |      0 B   |
|       from large pool |   1304 MiB |   1304 MiB |   1304 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  63810 KiB | 168489 KiB | 236511 GiB | 236511 GiB |
|       from large pool |  51304 KiB | 166786 KiB | 229909 GiB | 229908 GiB |
|       from small pool |  12506 KiB |  13009 KiB |   6602 GiB |   6602 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4424    |    6807    |   80694 K  |   80690 K  |
|       from large pool |      79    |     167    |   43332 K  |   43332 K  |
|       from small pool |    4345    |    6727    |   37362 K  |   37357 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4424    |    6807    |   80694 K  |   80690 K  |
|       from large pool |      79    |     167    |   43332 K  |   43332 K  |
|       from small pool |    4345    |    6727    |   37362 K  |   37357 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      76    |      76    |      76    |       0    |
|       from large pool |      55    |      55    |      55    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3186    |   45762 K  |   45762 K  |
|       from large pool |       9    |      57    |   30257 K  |   30257 K  |
|       from small pool |      23    |    3177    |   15504 K  |   15504 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 468898 GiB | 468898 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 462310 GiB | 462310 GiB |
|       from small pool |      0 KiB |     38 MiB |   6588 GiB |   6588 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 468898 GiB | 468898 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 462310 GiB | 462310 GiB |
|       from small pool |      0 KiB |     38 MiB |   6588 GiB |   6588 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 468884 GiB | 468884 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 462308 GiB | 462308 GiB |
|       from small pool |      0 KiB |     36 MiB |   6575 GiB |   6575 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   1346 MiB |   1346 MiB |   1090 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 236511 GiB | 236511 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 229909 GiB | 229909 GiB |
|       from small pool |      0 KiB |  23712 KiB |   6602 GiB |   6602 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   80694 K  |   80694 K  |
|       from large pool |       2    |     167    |   43332 K  |   43332 K  |
|       from small pool |       0    |    6727    |   37362 K  |   37362 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   80694 K  |   80694 K  |
|       from large pool |       2    |     167    |   43332 K  |   43332 K  |
|       from small pool |       0    |    6727    |   37362 K  |   37362 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |      76    |      76    |      50    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3186    |   45764 K  |   45764 K  |
|       from large pool |       3    |      57    |   30257 K  |   30257 K  |
|       from small pool |       0    |    3177    |   15506 K  |   15506 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 468898 GiB | 468898 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 462310 GiB | 462310 GiB |
|       from small pool |      0 KiB |     38 MiB |   6588 GiB |   6588 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 468898 GiB | 468898 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 462310 GiB | 462310 GiB |
|       from small pool |      0 KiB |     38 MiB |   6588 GiB |   6588 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 468884 GiB | 468884 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 462308 GiB | 462308 GiB |
|       from small pool |      0 KiB |     36 MiB |   6575 GiB |   6575 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   1346 MiB |   1346 MiB |   1090 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 236511 GiB | 236511 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 229909 GiB | 229909 GiB |
|       from small pool |      0 KiB |  23712 KiB |   6602 GiB |   6602 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   80694 K  |   80694 K  |
|       from large pool |       2    |     167    |   43332 K  |   43332 K  |
|       from small pool |       0    |    6727    |   37362 K  |   37362 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   80694 K  |   80694 K  |
|       from large pool |       2    |     167    |   43332 K  |   43332 K  |
|       from small pool |       0    |    6727    |   37362 K  |   37362 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |      76    |      76    |      50    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3186    |   45764 K  |   45764 K  |
|       from large pool |       3    |      57    |   30257 K  |   30257 K  |
|       from small pool |       0    |    3177    |   15506 K  |   15506 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_01_07_48_seed_1_24111540

 Experiment start at: 2024-08-08 01:07:48.740095
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.5408779978752136
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9455264, 'precision': 0.9478017, 'recall': 0.94555604, 'specificity': 0.94555604, 'f1': 0.9454596, 'auroc': 0.98530555, 'binary_precision': 0.97992885, 'binary_recall': 0.9097771, 'binary_specificity': 0.9813349, 'binary_f1_score': 0.9435508}
confusion matrix:
       0      1
0  24921    474
1   2295  23142
---- Validation: 
scalar performance:
{'acc': 0.94259185, 'precision': 0.59856623, 'recall': 0.7117531, 'specificity': 0.7117531, 'f1': 0.63068026, 'auroc': 0.86330783, 'binary_precision': 0.21129707, 'binary_recall': 0.4686775, 'binary_specificity': 0.9548287, 'binary_f1_score': 0.29127613}
confusion matrix:
       0    1
0  15938  754
1    229  202
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8892082, 'precision': 0.6539278, 'recall': 0.7288983, 'specificity': 0.7288983, 'f1': 0.6806235, 'auroc': 0.8669907, 'binary_precision': 0.34690416, 'binary_recall': 0.5402906, 'binary_specificity': 0.9175059, 'binary_f1_score': 0.42252067}
confusion matrix:
      0    1
0  8564  770
1   348  409
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 01:34:30.812434,epoch time: 0:26:42.072339,used: 0:26:42.072339,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_01_07_48_seed_1_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9608121, 'precision': 0.9622648, 'recall': 0.96083426, 'specificity': 0.96083426, 'f1': 0.9607826, 'auroc': 0.9918556, 'binary_precision': 0.98837596, 'binary_recall': 0.9326545, 'binary_specificity': 0.989014, 'binary_f1_score': 0.9597071}
confusion matrix:
       0      1
0  25117    279
1   1713  23723
---- Validation: 
scalar performance:
{'acc': 0.95106, 'precision': 0.6316788, 'recall': 0.76808286, 'specificity': 0.76808286, 'f1': 0.67317617, 'auroc': 0.8850129, 'binary_precision': 0.27464008, 'binary_recall': 0.575406, 'binary_specificity': 0.96075964, 'binary_f1_score': 0.37181407}
confusion matrix:
       0    1
0  16037  655
1    183  248
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8785056, 'precision': 0.6626716, 'recall': 0.8068699, 'specificity': 0.8068699, 'f1': 0.7014572, 'auroc': 0.8935352, 'binary_precision': 0.34996802, 'binary_recall': 0.7225892, 'binary_specificity': 0.89115065, 'binary_f1_score': 0.47155175}
confusion matrix:
      0     1
0  8318  1016
1   210   547
better model found
persisted
after epoch: 2,now: 2024-08-08 01:59:30.535895,epoch time: 0:24:59.723461,used: 0:51:41.795800,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_01_07_48_seed_1_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9681106, 'precision': 0.96871954, 'recall': 0.9681243, 'specificity': 0.9681243, 'f1': 0.9681009, 'auroc': 0.9941976, 'binary_precision': 0.9858017, 'binary_recall': 0.9499509, 'binary_specificity': 0.9862976, 'binary_f1_score': 0.96754426}
confusion matrix:
       0      1
0  25049    348
1   1273  24162
---- Validation: 
scalar performance:
{'acc': 0.9234363, 'precision': 0.60081404, 'recall': 0.8307638, 'specificity': 0.8307638, 'f1': 0.64234287, 'auroc': 0.8926928, 'binary_precision': 0.20899472, 'binary_recall': 0.7331787, 'binary_specificity': 0.9283489, 'binary_f1_score': 0.32527024}
confusion matrix:
       0     1
0  15496  1196
1    115   316
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84104645, 'precision': 0.6454032, 'recall': 0.8521702, 'specificity': 0.8521702, 'f1': 0.6783327, 'auroc': 0.90541226, 'binary_precision': 0.3036625, 'binary_recall': 0.8652576, 'binary_specificity': 0.8390829, 'binary_f1_score': 0.4495539}
confusion matrix:
      0     1
0  7832  1502
1   102   655
early stop counter: 1
val acc:0.9234362840652466, best validation acc: 0.9510599970817566, corresponding to test acc:                         0.8785055875778198 / 0.889208197593689
after epoch: 3,now: 2024-08-08 02:24:50.903643,epoch time: 0:25:20.367748,used: 1:17:02.163548,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_01_07_48_seed_1_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97298944, 'precision': 0.9732602, 'recall': 0.9729985, 'specificity': 0.9729985, 'f1': 0.9729859, 'auroc': 0.9954841, 'binary_precision': 0.9847691, 'binary_recall': 0.9608807, 'binary_specificity': 0.98511636, 'binary_f1_score': 0.9726782}
confusion matrix:
       0      1
0  25019    378
1    995  24440
---- Validation: 
scalar performance:
{'acc': 0.916545, 'precision': 0.59278107, 'recall': 0.8249689, 'specificity': 0.8249689, 'f1': 0.6304525, 'auroc': 0.89419657, 'binary_precision': 0.19311193, 'binary_recall': 0.7285383, 'binary_specificity': 0.9213995, 'binary_f1_score': 0.30529898}
confusion matrix:
       0     1
0  15380  1312
1    117   314
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84233475, 'precision': 0.6469413, 'recall': 0.85529435, 'specificity': 0.85529435, 'f1': 0.68048376, 'auroc': 0.9067465, 'binary_precision': 0.30622676, 'binary_recall': 0.87054163, 'binary_specificity': 0.8400471, 'binary_f1_score': 0.45307663}
confusion matrix:
      0     1
0  7841  1493
1    98   659
early stop counter: 2
val acc:0.9165449738502502, best validation acc: 0.9510599970817566, corresponding to test acc:                         0.8785055875778198 / 0.889208197593689
after epoch: 4,now: 2024-08-08 02:50:27.639415,epoch time: 0:25:36.735772,used: 1:42:38.899320,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_01_07_48_seed_1_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97617644, 'precision': 0.97631586, 'recall': 0.9761822, 'specificity': 0.9761822, 'f1': 0.97617483, 'auroc': 0.9961443, 'binary_precision': 0.98463386, 'binary_recall': 0.96748316, 'binary_specificity': 0.9848813, 'binary_f1_score': 0.9759832}
confusion matrix:
       0      1
0  25015    384
1    827  24606
---- Validation: 
scalar performance:
{'acc': 0.92454594, 'precision': 0.6010187, 'recall': 0.8256822, 'specificity': 0.8256822, 'f1': 0.6425067, 'auroc': 0.8973838, 'binary_precision': 0.20971005, 'binary_recall': 0.7215777, 'binary_specificity': 0.92978674, 'binary_f1_score': 0.32497388}
confusion matrix:
       0     1
0  15520  1172
1    120   311
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8600733, 'precision': 0.6590814, 'recall': 0.85699284, 'specificity': 0.85699284, 'f1': 0.6985116, 'auroc': 0.9053432, 'binary_precision': 0.3317925, 'binary_recall': 0.8533686, 'binary_specificity': 0.8606171, 'binary_f1_score': 0.47781062}
confusion matrix:
      0     1
0  8033  1301
1   111   646
early stop counter: 3
val acc:0.92454594373703, best validation acc: 0.9510599970817566, corresponding to test acc:                         0.8785055875778198 / 0.889208197593689
after epoch: 5,now: 2024-08-08 03:15:49.728631,epoch time: 0:25:22.089216,used: 2:08:00.988536,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_01_07_48_seed_1_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:08:00.988536 at 2024-08-08 03:15:49.728631
persisted model performance metric: 

scalar performance:
{'acc': 0.8785056, 'precision': 0.6626716, 'recall': 0.8068699, 'specificity': 0.8068699, 'f1': 0.7014572, 'auroc': 0.8935352, 'binary_precision': 0.34996802, 'binary_recall': 0.7225892, 'binary_specificity': 0.89115065, 'binary_f1_score': 0.47155175}
confusion matrix:
      0     1
0  8318  1016
1   210   547
oracle model performance metric: 

scalar performance:
{'acc': 0.8892082, 'precision': 0.6539278, 'recall': 0.7288983, 'specificity': 0.7288983, 'f1': 0.6806235, 'auroc': 0.8669907, 'binary_precision': 0.34690416, 'binary_recall': 0.5402906, 'binary_specificity': 0.9175059, 'binary_f1_score': 0.42252067}
confusion matrix:
      0    1
0  8564  770
1   348  409
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197423 KiB |   1195 MiB | 644326 GiB | 644326 GiB |
|       from large pool | 179215 KiB |   1178 MiB | 635154 GiB | 635153 GiB |
|       from small pool |  18208 KiB |     38 MiB |   9172 GiB |   9172 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197423 KiB |   1195 MiB | 644326 GiB | 644326 GiB |
|       from large pool | 179215 KiB |   1178 MiB | 635154 GiB | 635153 GiB |
|       from small pool |  18208 KiB |     38 MiB |   9172 GiB |   9172 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   1193 MiB | 644306 GiB | 644306 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 635150 GiB | 635150 GiB |
|       from small pool |  16662 KiB |     36 MiB |   9155 GiB |   9155 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   2426 MiB |   1090 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   2376 MiB |   1078 MiB |
|       from small pool |     38 MiB |     42 MiB |     50 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  48336 KiB | 168489 KiB | 333988 GiB | 333988 GiB |
|       from large pool |  37872 KiB | 166786 KiB | 324718 GiB | 324718 GiB |
|       from small pool |  10464 KiB |  23712 KiB |   9270 GiB |   9270 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6829    |  110527 K  |  110523 K  |
|       from large pool |      79    |     167    |   59621 K  |   59621 K  |
|       from small pool |    4333    |    6749    |   50905 K  |   50901 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6829    |  110527 K  |  110523 K  |
|       from large pool |      79    |     167    |   59621 K  |   59621 K  |
|       from small pool |    4333    |    6749    |   50905 K  |   50901 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     124    |      50    |
|       from large pool |      55    |      55    |      99    |      44    |
|       from small pool |      19    |      21    |      25    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3196    |   65306 K  |   65306 K  |
|       from large pool |      11    |      58    |   42156 K  |   42156 K  |
|       from small pool |      21    |    3185    |   23149 K  |   23149 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 644326 GiB | 644326 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 635154 GiB | 635154 GiB |
|       from small pool |      0 KiB |     38 MiB |   9172 GiB |   9172 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 644326 GiB | 644326 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 635154 GiB | 635154 GiB |
|       from small pool |      0 KiB |     38 MiB |   9172 GiB |   9172 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 644306 GiB | 644306 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 635150 GiB | 635150 GiB |
|       from small pool |      0 KiB |     36 MiB |   9155 GiB |   9155 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 245760 KiB |   1346 MiB |   2426 MiB |   2186 MiB |
|       from large pool | 217088 KiB |   1304 MiB |   2376 MiB |   2164 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 333988 GiB | 333988 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 324718 GiB | 324718 GiB |
|       from small pool |      0 KiB |  25471 KiB |   9270 GiB |   9270 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |  110527 K  |  110527 K  |
|       from large pool |       2    |     167    |   59621 K  |   59621 K  |
|       from small pool |       0    |    6749    |   50905 K  |   50905 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |  110527 K  |  110527 K  |
|       from large pool |       2    |     167    |   59621 K  |   59621 K  |
|       from small pool |       0    |    6749    |   50905 K  |   50905 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     124    |     100    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3196    |   65308 K  |   65308 K  |
|       from large pool |       3    |      58    |   42156 K  |   42156 K  |
|       from small pool |       0    |    3185    |   23151 K  |   23151 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 644326 GiB | 644326 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 635154 GiB | 635154 GiB |
|       from small pool |      0 KiB |     38 MiB |   9172 GiB |   9172 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 644326 GiB | 644326 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 635154 GiB | 635154 GiB |
|       from small pool |      0 KiB |     38 MiB |   9172 GiB |   9172 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 644306 GiB | 644306 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 635150 GiB | 635150 GiB |
|       from small pool |      0 KiB |     36 MiB |   9155 GiB |   9155 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 245760 KiB |   1346 MiB |   2426 MiB |   2186 MiB |
|       from large pool | 217088 KiB |   1304 MiB |   2376 MiB |   2164 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 333988 GiB | 333988 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 324718 GiB | 324718 GiB |
|       from small pool |      0 KiB |  25471 KiB |   9270 GiB |   9270 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |  110527 K  |  110527 K  |
|       from large pool |       2    |     167    |   59621 K  |   59621 K  |
|       from small pool |       0    |    6749    |   50905 K  |   50905 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |  110527 K  |  110527 K  |
|       from large pool |       2    |     167    |   59621 K  |   59621 K  |
|       from small pool |       0    |    6749    |   50905 K  |   50905 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     124    |     100    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3196    |   65308 K  |   65308 K  |
|       from large pool |       3    |      58    |   42156 K  |   42156 K  |
|       from small pool |       0    |    3185    |   23151 K  |   23151 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_03_41_21_seed_2_24111540

 Experiment start at: 2024-08-08 03:41:21.900000
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.8581054210662842
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94709456, 'precision': 0.948992, 'recall': 0.94710207, 'specificity': 0.94710207, 'f1': 0.94703925, 'auroc': 0.9855356, 'binary_precision': 0.9782384, 'binary_recall': 0.91455865, 'binary_specificity': 0.97964555, 'binary_f1_score': 0.9453274}
confusion matrix:
       0      1
0  25316    526
1   2209  23645
---- Validation: 
scalar performance:
{'acc': 0.93658024, 'precision': 0.58652055, 'recall': 0.71208954, 'specificity': 0.71208954, 'f1': 0.61752397, 'auroc': 0.8317944, 'binary_precision': 0.18667917, 'binary_recall': 0.47607654, 'binary_specificity': 0.9481025, 'binary_f1_score': 0.26819405}
confusion matrix:
       0    1
0  15839  867
1    219  199
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89724535, 'precision': 0.66723746, 'recall': 0.70561624, 'specificity': 0.70561624, 'f1': 0.683582, 'auroc': 0.8574651, 'binary_precision': 0.38023952, 'binary_recall': 0.47804266, 'binary_specificity': 0.93318987, 'binary_f1_score': 0.42356864}
confusion matrix:
      0    1
0  8674  621
1   416  381
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 04:08:18.342729,epoch time: 0:26:56.442729,used: 0:26:56.442729,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_03_41_21_seed_2_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96042246, 'precision': 0.9618744, 'recall': 0.96042895, 'specificity': 0.96042895, 'f1': 0.96039176, 'auroc': 0.9917118, 'binary_precision': 0.98782885, 'binary_recall': 0.9323509, 'binary_specificity': 0.9885071, 'binary_f1_score': 0.9592884}
confusion matrix:
       0      1
0  25545    297
1   1749  24105
---- Validation: 
scalar performance:
{'acc': 0.9333684, 'precision': 0.5924626, 'recall': 0.7512619, 'specificity': 0.7512619, 'f1': 0.6279529, 'auroc': 0.8473229, 'binary_precision': 0.19647355, 'binary_recall': 0.5598086, 'binary_specificity': 0.94271517, 'binary_f1_score': 0.2908639}
confusion matrix:
       0    1
0  15749  957
1    184  234
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90398335, 'precision': 0.68285584, 'recall': 0.7155833, 'specificity': 0.7155833, 'f1': 0.6973294, 'auroc': 0.8723337, 'binary_precision': 0.41004184, 'binary_recall': 0.49184442, 'binary_specificity': 0.93932223, 'binary_f1_score': 0.44723332}
confusion matrix:
      0    1
0  8731  564
1   405  392
new oracle model saved
early stop counter: 1
val acc:0.9333683848381042, best validation acc: 0.936580240726471, corresponding to test acc:                         0.8972453474998474 / 0.9039833545684814
after epoch: 2,now: 2024-08-08 04:34:27.294327,epoch time: 0:26:08.951598,used: 0:53:05.394327,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_03_41_21_seed_2_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9700944, 'precision': 0.97058046, 'recall': 0.97009873, 'specificity': 0.97009873, 'f1': 0.9700869, 'auroc': 0.99451053, 'binary_precision': 0.98577195, 'binary_recall': 0.95397407, 'binary_specificity': 0.98622346, 'binary_f1_score': 0.9696124}
confusion matrix:
       0      1
0  25485    356
1   1190  24665
---- Validation: 
scalar performance:
{'acc': 0.92250645, 'precision': 0.5833702, 'recall': 0.76435494, 'specificity': 0.76435494, 'f1': 0.61637115, 'auroc': 0.855182, 'binary_precision': 0.17743081, 'binary_recall': 0.5980861, 'binary_specificity': 0.9306237, 'binary_f1_score': 0.2736727}
confusion matrix:
       0     1
0  15547  1159
1    168   250
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90239793, 'precision': 0.683762, 'recall': 0.7319294, 'specificity': 0.7319294, 'f1': 0.7038953, 'auroc': 0.8782073, 'binary_precision': 0.40891472, 'binary_recall': 0.5294856, 'binary_specificity': 0.9343733, 'binary_f1_score': 0.46145436}
confusion matrix:
      0    1
0  8685  610
1   375  422
early stop counter: 2
val acc:0.9225064516067505, best validation acc: 0.936580240726471, corresponding to test acc:                         0.8972453474998474 / 0.9039833545684814
after epoch: 3,now: 2024-08-08 05:00:20.496586,epoch time: 0:25:53.202259,used: 1:18:58.596586,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_03_41_21_seed_2_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9741566, 'precision': 0.9746939, 'recall': 0.97415984, 'specificity': 0.97415984, 'f1': 0.97414947, 'auroc': 0.9957946, 'binary_precision': 0.99071294, 'binary_recall': 0.957297, 'binary_specificity': 0.9910227, 'binary_f1_score': 0.9737184}
confusion matrix:
       0      1
0  25611    232
1   1104  24749
---- Validation: 
scalar performance:
{'acc': 0.9348283, 'precision': 0.59429014, 'recall': 0.7508439, 'specificity': 0.7508439, 'f1': 0.63019997, 'auroc': 0.85815793, 'binary_precision': 0.20017183, 'binary_recall': 0.55741626, 'binary_specificity': 0.9442715, 'binary_f1_score': 0.29456386}
confusion matrix:
       0    1
0  15775  931
1    185  233
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9073524, 'precision': 0.693796, 'recall': 0.73232484, 'specificity': 0.73232484, 'f1': 0.7106352, 'auroc': 0.88248986, 'binary_precision': 0.42915812, 'binary_recall': 0.52446675, 'binary_specificity': 0.94018286, 'binary_f1_score': 0.4720497}
confusion matrix:
      0    1
0  8739  556
1   379  418
new oracle model saved
early stop counter: 3
val acc:0.9348282814025879, best validation acc: 0.936580240726471, corresponding to test acc:                         0.8972453474998474 / 0.9073523879051208
after epoch: 4,now: 2024-08-08 05:26:23.064015,epoch time: 0:26:02.567429,used: 1:45:01.164015,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_03_41_21_seed_2_24111540
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:45:01.164015 at 2024-08-08 05:26:23.064015
persisted model performance metric: 

scalar performance:
{'acc': 0.89724535, 'precision': 0.66723746, 'recall': 0.70561624, 'specificity': 0.70561624, 'f1': 0.683582, 'auroc': 0.8574651, 'binary_precision': 0.38023952, 'binary_recall': 0.47804266, 'binary_specificity': 0.93318987, 'binary_f1_score': 0.42356864}
confusion matrix:
      0    1
0  8674  621
1   416  381
oracle model performance metric: 

scalar performance:
{'acc': 0.9073524, 'precision': 0.693796, 'recall': 0.73232484, 'specificity': 0.73232484, 'f1': 0.7106352, 'auroc': 0.88248986, 'binary_precision': 0.42915812, 'binary_recall': 0.52446675, 'binary_specificity': 0.94018286, 'binary_f1_score': 0.4720497}
confusion matrix:
      0    1
0  8739  556
1   379  418
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_dannratio_3seeds_halffreeze_2024-08-07_17-51-11/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197419 KiB |   1195 MiB |    773 TiB |    773 TiB |
|       from large pool | 179211 KiB |   1178 MiB |    762 TiB |    762 TiB |
|       from small pool |  18208 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197419 KiB |   1195 MiB |    773 TiB |    773 TiB |
|       from large pool | 179211 KiB |   1178 MiB |    762 TiB |    762 TiB |
|       from small pool |  18208 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   1193 MiB |    773 TiB |    773 TiB |
|       from large pool | 178979 KiB |   1176 MiB |    762 TiB |    762 TiB |
|       from small pool |  16662 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1328 MiB |   1346 MiB |   3514 MiB |   2186 MiB |
|       from large pool |   1290 MiB |   1304 MiB |   3454 MiB |   2164 MiB |
|       from small pool |     38 MiB |     42 MiB |     60 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42197 KiB | 168489 KiB | 421843 GiB | 421843 GiB |
|       from large pool |  31733 KiB | 166786 KiB | 410293 GiB | 410293 GiB |
|       from small pool |  10464 KiB |  25471 KiB |  11549 GiB |  11549 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6937    |  135567 K  |  135563 K  |
|       from large pool |      79    |     167    |   73378 K  |   73378 K  |
|       from small pool |    4333    |    6857    |   62189 K  |   62185 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6937    |  135567 K  |  135563 K  |
|       from large pool |      79    |     167    |   73378 K  |   73378 K  |
|       from small pool |    4333    |    6857    |   62189 K  |   62185 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      73    |      76    |     173    |     100    |
|       from large pool |      54    |      55    |     143    |      89    |
|       from small pool |      19    |      21    |      30    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3250    |   80938 K  |   80938 K  |
|       from large pool |      11    |      58    |   51406 K  |   51406 K  |
|       from small pool |      21    |    3239    |   29532 K  |   29532 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB |    773 TiB |    773 TiB |
|       from large pool |  16640 KiB |   1178 MiB |    762 TiB |    762 TiB |
|       from small pool |      0 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB |    773 TiB |    773 TiB |
|       from large pool |  16640 KiB |   1178 MiB |    762 TiB |    762 TiB |
|       from small pool |      0 KiB |     38 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB |    773 TiB |    773 TiB |
|       from large pool |  16640 KiB |   1176 MiB |    762 TiB |    762 TiB |
|       from small pool |      0 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   1346 MiB |   3514 MiB |   3280 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   3454 MiB |   3248 MiB |
|       from small pool |  28672 KiB |     42 MiB |     60 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 421843 GiB | 421843 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 410294 GiB | 410294 GiB |
|       from small pool |      0 KiB |  25471 KiB |  11549 GiB |  11549 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6937    |  135567 K  |  135567 K  |
|       from large pool |       2    |     167    |   73378 K  |   73378 K  |
|       from small pool |       0    |    6857    |   62189 K  |   62189 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6937    |  135567 K  |  135567 K  |
|       from large pool |       2    |     167    |   73378 K  |   73378 K  |
|       from small pool |       0    |    6857    |   62189 K  |   62189 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     173    |     149    |
|       from large pool |      10    |      55    |     143    |     133    |
|       from small pool |      14    |      21    |      30    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3250    |   80940 K  |   80940 K  |
|       from large pool |       3    |      58    |   51406 K  |   51406 K  |
|       from small pool |       0    |    3239    |   29534 K  |   29534 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  8 05:44:19 2024]
Finished job 0.
1 of 1 steps (100%) done
