Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  9 09:11:13 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_09_18_17_seed_0_24132708

 Experiment start at: 2024-08-09 09:18:17.787268
before training, model accuracy: 0.6347637176513672
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9944528, 'precision': 0.9944527, 'recall': 0.9944529, 'specificity': 0.9944529, 'f1': 0.9944528, 'auroc': 0.9997612, 'binary_precision': 0.99467057, 'binary_recall': 0.9942388, 'binary_specificity': 0.994667, 'binary_f1_score': 0.9944546}
confusion matrix:
       0      1
0  25179    135
1    146  25196
---- Validation: 
scalar performance:
{'acc': 0.93590343, 'precision': 0.61151206, 'recall': 0.82381475, 'specificity': 0.82381475, 'f1': 0.65703505, 'auroc': 0.89935505, 'binary_precision': 0.23070866, 'binary_recall': 0.7060241, 'binary_specificity': 0.9416054, 'binary_f1_score': 0.34777448}
confusion matrix:
       0    1
0  15754  977
1    122  293
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9234724, 'precision': 0.46182755, 'recall': 0.49989295, 'specificity': 0.49989295, 'f1': 0.48010692, 'auroc': 0.8635265, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9997859, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9340  2
1   772  0
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-09 09:42:02.581006,epoch time: 0:23:44.793738,used: 0:23:44.793738,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_09_18_17_seed_0_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9968217, 'precision': 0.9968254, 'recall': 0.9968226, 'specificity': 0.9968226, 'f1': 0.99682164, 'auroc': 0.999894, 'binary_precision': 0.9983377, 'binary_recall': 0.9953044, 'binary_specificity': 0.9983408, 'binary_f1_score': 0.9968187}
confusion matrix:
       0      1
0  25271     42
1    119  25224
---- Validation: 
scalar performance:
{'acc': 0.9795287, 'precision': 0.80541456, 'recall': 0.68872726, 'specificity': 0.68872726, 'f1': 0.7324486, 'auroc': 0.92759645, 'binary_precision': 0.62598425, 'binary_recall': 0.38313252, 'binary_specificity': 0.99432194, 'binary_f1_score': 0.4753363}
confusion matrix:
       0    1
0  16636   95
1    256  159
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.8287312, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9342  0
1   772  0
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-09 10:04:53.725419,epoch time: 0:22:51.144413,used: 0:46:35.938151,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_09_18_17_seed_0_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9974929, 'precision': 0.99749464, 'recall': 0.9974936, 'specificity': 0.9974936, 'f1': 0.99749285, 'auroc': 0.9998361, 'binary_precision': 0.9986159, 'binary_recall': 0.9963701, 'binary_specificity': 0.9986172, 'binary_f1_score': 0.9974917}
confusion matrix:
       0      1
0  25276     35
1     92  25253
---- Validation: 
scalar performance:
{'acc': 0.9783623, 'precision': 0.78309673, 'recall': 0.6857797, 'specificity': 0.6857797, 'f1': 0.7236774, 'auroc': 0.9030631, 'binary_precision': 0.58148146, 'binary_recall': 0.37831324, 'binary_specificity': 0.9932461, 'binary_f1_score': 0.45839414}
confusion matrix:
       0    1
0  16618  113
1    258  157
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.85335386, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9342  0
1   772  0
early stop counter: 1
val acc:0.9783623218536377, best validation acc: 0.9795287251472473, corresponding to test acc:                         0.9236701726913452 / 0.9236701726913452
after epoch: 3,now: 2024-08-09 10:28:08.125120,epoch time: 0:23:14.399701,used: 1:09:50.337852,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_09_18_17_seed_0_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.99788773, 'precision': 0.99789304, 'recall': 0.99788857, 'specificity': 0.99788857, 'f1': 0.99788773, 'auroc': 0.99994314, 'binary_precision': 0.99964356, 'binary_recall': 0.9961326, 'binary_specificity': 0.9996445, 'binary_f1_score': 0.997885}
confusion matrix:
       0      1
0  25307      9
1     98  25242
---- Validation: 
scalar performance:
{'acc': 0.9780707, 'precision': 0.77900267, 'recall': 0.67975557, 'specificity': 0.67975557, 'f1': 0.71793616, 'auroc': 0.9227127, 'binary_precision': 0.5735849, 'binary_recall': 0.36626506, 'binary_specificity': 0.9932461, 'binary_f1_score': 0.44705883}
confusion matrix:
       0    1
0  16618  113
1    263  152
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.83834934, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9342  0
1   772  0
early stop counter: 2
val acc:0.9780706763267517, best validation acc: 0.9795287251472473, corresponding to test acc:                         0.9236701726913452 / 0.9236701726913452
after epoch: 4,now: 2024-08-09 10:51:41.643134,epoch time: 0:23:33.518014,used: 1:33:23.855866,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_09_18_17_seed_0_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9985194, 'precision': 0.9985198, 'recall': 0.9985198, 'specificity': 0.9985198, 'f1': 0.9985194, 'auroc': 0.9999409, 'binary_precision': 0.99913085, 'binary_recall': 0.9979087, 'binary_specificity': 0.9991309, 'binary_f1_score': 0.99851936}
confusion matrix:
       0      1
0  25291     22
1     53  25290
---- Validation: 
scalar performance:
{'acc': 0.9766126, 'precision': 0.7527492, 'recall': 0.72953063, 'specificity': 0.72953063, 'f1': 0.7405385, 'auroc': 0.9003159, 'binary_precision': 0.51861703, 'binary_recall': 0.4698795, 'binary_specificity': 0.98918176, 'binary_f1_score': 0.49304676}
confusion matrix:
       0    1
0  16550  181
1    220  195
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.7888038, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9342  0
1   772  0
early stop counter: 3
val acc:0.9766126275062561, best validation acc: 0.9795287251472473, corresponding to test acc:                         0.9236701726913452 / 0.9236701726913452
after epoch: 5,now: 2024-08-09 11:15:02.076139,epoch time: 0:23:20.433005,used: 1:56:44.288871,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_09_18_17_seed_0_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 1:56:44.288871 at 2024-08-09 11:15:02.076139
persisted model performance metric: 

scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.8287312, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9342  0
1   772  0
oracle model performance metric: 

scalar performance:
{'acc': 0.9236702, 'precision': 0.4618351, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48016036, 'auroc': 0.8287312, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9342  0
1   772  0
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 491054 KiB |   1764 MiB | 155904 GiB | 155904 GiB |
|       from large pool | 400512 KiB |   1694 MiB | 155223 GiB | 155223 GiB |
|       from small pool |  90542 KiB |    125 MiB |    680 GiB |    680 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 491054 KiB |   1764 MiB | 155904 GiB | 155904 GiB |
|       from large pool | 400512 KiB |   1694 MiB | 155223 GiB | 155223 GiB |
|       from small pool |  90542 KiB |    125 MiB |    680 GiB |    680 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 476753 KiB |   1739 MiB | 154391 GiB | 154390 GiB |
|       from large pool | 387840 KiB |   1670 MiB | 153714 GiB | 153714 GiB |
|       from small pool |  88913 KiB |    124 MiB |    676 GiB |    676 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2070 MiB |   2070 MiB |   2070 MiB |      0 B   |
|       from large pool |   1942 MiB |   1942 MiB |   1942 MiB |      0 B   |
|       from small pool |    128 MiB |    128 MiB |    128 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 451025 KiB | 475837 KiB |  90411 GiB |  90411 GiB |
|       from large pool | 443264 KiB | 474048 KiB |  89643 GiB |  89643 GiB |
|       from small pool |   7761 KiB |  12383 KiB |    768 GiB |    768 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5175    |    7558    |   25950 K  |   25945 K  |
|       from large pool |      87    |     177    |    9826 K  |    9826 K  |
|       from small pool |    5088    |    7470    |   16124 K  |   16119 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5175    |    7558    |   25950 K  |   25945 K  |
|       from large pool |      87    |     177    |    9826 K  |    9826 K  |
|       from small pool |    5088    |    7470    |   16124 K  |   16119 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     116    |     116    |       0    |
|       from large pool |      52    |      52    |      52    |       0    |
|       from small pool |      64    |      64    |      64    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      51    |    3197    |   11768 K  |   11768 K  |
|       from large pool |      21    |      37    |    5315 K  |    5315 K  |
|       from small pool |      30    |    3176    |    6453 K  |    6453 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1764 MiB | 155904 GiB | 155904 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 155223 GiB | 155223 GiB |
|       from small pool |      0 KiB |    125 MiB |    680 GiB |    680 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1764 MiB | 155904 GiB | 155904 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 155223 GiB | 155223 GiB |
|       from small pool |      0 KiB |    125 MiB |    680 GiB |    680 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1739 MiB | 154391 GiB | 154391 GiB |
|       from large pool |  16640 KiB |   1670 MiB | 153714 GiB | 153714 GiB |
|       from small pool |      0 KiB |    124 MiB |    676 GiB |    676 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    920 MiB |   2070 MiB |   2070 MiB |   1150 MiB |
|       from large pool |    824 MiB |   1942 MiB |   1942 MiB |   1118 MiB |
|       from small pool |     96 MiB |    128 MiB |    128 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 134912 KiB | 479963 KiB |  90412 GiB |  90412 GiB |
|       from large pool | 134912 KiB | 474048 KiB |  89643 GiB |  89643 GiB |
|       from small pool |      0 KiB |  34581 KiB |    768 GiB |    768 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7558    |   25950 K  |   25950 K  |
|       from large pool |       2    |     177    |    9826 K  |    9826 K  |
|       from small pool |       0    |    7470    |   16124 K  |   16124 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7558    |   25950 K  |   25950 K  |
|       from large pool |       2    |     177    |    9826 K  |    9826 K  |
|       from small pool |       0    |    7470    |   16124 K  |   16124 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      71    |     116    |     116    |      45    |
|       from large pool |      23    |      52    |      52    |      29    |
|       from small pool |      48    |      64    |      64    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3197    |   11770 K  |   11770 K  |
|       from large pool |       4    |      37    |    5315 K  |    5315 K  |
|       from small pool |       0    |    3176    |    6455 K  |    6455 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1764 MiB | 155904 GiB | 155904 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 155223 GiB | 155223 GiB |
|       from small pool |      0 KiB |    125 MiB |    680 GiB |    680 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1764 MiB | 155904 GiB | 155904 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 155223 GiB | 155223 GiB |
|       from small pool |      0 KiB |    125 MiB |    680 GiB |    680 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1739 MiB | 154391 GiB | 154391 GiB |
|       from large pool |  16640 KiB |   1670 MiB | 153714 GiB | 153714 GiB |
|       from small pool |      0 KiB |    124 MiB |    676 GiB |    676 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    920 MiB |   2070 MiB |   2070 MiB |   1150 MiB |
|       from large pool |    824 MiB |   1942 MiB |   1942 MiB |   1118 MiB |
|       from small pool |     96 MiB |    128 MiB |    128 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 134912 KiB | 479963 KiB |  90412 GiB |  90412 GiB |
|       from large pool | 134912 KiB | 474048 KiB |  89643 GiB |  89643 GiB |
|       from small pool |      0 KiB |  34581 KiB |    768 GiB |    768 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7558    |   25950 K  |   25950 K  |
|       from large pool |       2    |     177    |    9826 K  |    9826 K  |
|       from small pool |       0    |    7470    |   16124 K  |   16124 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7558    |   25950 K  |   25950 K  |
|       from large pool |       2    |     177    |    9826 K  |    9826 K  |
|       from small pool |       0    |    7470    |   16124 K  |   16124 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      71    |     116    |     116    |      45    |
|       from large pool |      23    |      52    |      52    |      29    |
|       from small pool |      48    |      64    |      64    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3197    |   11770 K  |   11770 K  |
|       from large pool |       4    |      37    |    5315 K  |    5315 K  |
|       from small pool |       0    |    3176    |    6455 K  |    6455 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708

 Experiment start at: 2024-08-09 11:36:03.380805
before training, model accuracy: 0.20374591648578644
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.99338996, 'precision': 0.9934225, 'recall': 0.9933932, 'specificity': 0.9933932, 'f1': 0.99338984, 'auroc': 0.9996412, 'binary_precision': 0.9976208, 'binary_recall': 0.9891488, 'binary_specificity': 0.9976375, 'binary_f1_score': 0.9933667}
confusion matrix:
       0      1
0  25337     60
1    276  25159
---- Validation: 
scalar performance:
{'acc': 0.9788588, 'precision': 0.7891234, 'recall': 0.756348, 'specificity': 0.756348, 'f1': 0.77167994, 'auroc': 0.9047884, 'binary_precision': 0.5905512, 'binary_recall': 0.52204174, 'binary_specificity': 0.99065423, 'binary_f1_score': 0.5541872}
confusion matrix:
       0    1
0  16536  156
1    206  225
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92528, 'precision': 0.81985605, 'recall': 0.50319535, 'specificity': 0.50319535, 'f1': 0.4871295, 'auroc': 0.85124445, 'binary_precision': 0.71428573, 'binary_recall': 0.00660502, 'binary_specificity': 0.9997857, 'binary_f1_score': 0.013089006}
confusion matrix:
      0  1
0  9332  2
1   752  5
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-09 11:59:59.478683,epoch time: 0:23:56.097878,used: 0:23:56.097878,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9965573, 'precision': 0.9965669, 'recall': 0.9965594, 'specificity': 0.9965594, 'f1': 0.99655724, 'auroc': 0.9998535, 'binary_precision': 0.99897295, 'binary_recall': 0.9941426, 'binary_specificity': 0.9989761, 'binary_f1_score': 0.99655193}
confusion matrix:
       0      1
0  25368     26
1    149  25289
---- Validation: 
scalar performance:
{'acc': 0.97920924, 'precision': 0.8004926, 'recall': 0.7294044, 'specificity': 0.7294044, 'f1': 0.7598562, 'auroc': 0.92937493, 'binary_precision': 0.6146789, 'binary_recall': 0.46635732, 'binary_specificity': 0.9924515, 'binary_f1_score': 0.53034306}
confusion matrix:
       0    1
0  16566  126
1    230  201
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92528, 'precision': 0.96262884, 'recall': 0.5019815, 'specificity': 0.5019815, 'f1': 0.4845364, 'auroc': 0.79851127, 'binary_precision': 1.0, 'binary_recall': 0.003963012, 'binary_specificity': 1.0, 'binary_f1_score': 0.007894737}
confusion matrix:
      0  1
0  9334  0
1   754  3
better model found
persisted
after epoch: 2,now: 2024-08-09 12:23:01.416874,epoch time: 0:23:01.938191,used: 0:46:58.036069,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.99767864, 'precision': 0.9976797, 'recall': 0.9976795, 'specificity': 0.9976795, 'f1': 0.99767864, 'auroc': 0.99993515, 'binary_precision': 0.9986608, 'binary_recall': 0.99669784, 'binary_specificity': 0.9986611, 'binary_f1_score': 0.99767834}
confusion matrix:
       0      1
0  25360     34
1     84  25354
---- Validation: 
scalar performance:
{'acc': 0.97950125, 'precision': 0.8253075, 'recall': 0.6832185, 'specificity': 0.6832185, 'f1': 0.73322296, 'auroc': 0.91940105, 'binary_precision': 0.6666667, 'binary_recall': 0.3712297, 'binary_specificity': 0.9952073, 'binary_f1_score': 0.47690016}
confusion matrix:
       0    1
0  16612   80
1    271  160
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92696464, 'precision': 0.8921509, 'recall': 0.51563776, 'specificity': 0.51563776, 'f1': 0.51157546, 'auroc': 0.80791, 'binary_precision': 0.85714287, 'binary_recall': 0.031704094, 'binary_specificity': 0.99957144, 'binary_f1_score': 0.061146498}
confusion matrix:
      0   1
0  9330   4
1   733  24
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-09 12:46:10.981201,epoch time: 0:23:09.564327,used: 1:10:07.600396,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9980721, 'precision': 0.99807465, 'recall': 0.9980731, 'specificity': 0.9980731, 'f1': 0.998072, 'auroc': 0.99993473, 'binary_precision': 0.99940866, 'binary_recall': 0.99673676, 'binary_specificity': 0.9994094, 'binary_f1_score': 0.9980709}
confusion matrix:
       0      1
0  25382     15
1     83  25352
---- Validation: 
scalar performance:
{'acc': 0.9799101, 'precision': 0.83770657, 'recall': 0.68003774, 'specificity': 0.68003774, 'f1': 0.73348093, 'auroc': 0.91684866, 'binary_precision': 0.69162995, 'binary_recall': 0.36426914, 'binary_specificity': 0.9958064, 'binary_f1_score': 0.4772036}
confusion matrix:
       0    1
0  16622   70
1    274  157
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9260727, 'precision': 0.962996, 'recall': 0.5072655, 'specificity': 0.5072655, 'f1': 0.49510998, 'auroc': 0.80632997, 'binary_precision': 1.0, 'binary_recall': 0.014531043, 'binary_specificity': 1.0, 'binary_f1_score': 0.028645834}
confusion matrix:
      0   1
0  9334   0
1   746  11
better model found
persisted
after epoch: 4,now: 2024-08-09 13:09:31.294797,epoch time: 0:23:20.313596,used: 1:33:27.913992,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9988, 'precision': 0.9988011, 'recall': 0.99880064, 'specificity': 0.99880064, 'f1': 0.9988, 'auroc': 0.9999566, 'binary_precision': 0.99976367, 'binary_recall': 0.99783754, 'binary_specificity': 0.9997638, 'binary_f1_score': 0.9987997}
confusion matrix:
       0      1
0  25392      6
1     55  25379
---- Validation: 
scalar performance:
{'acc': 0.9799685, 'precision': 0.85370827, 'recall': 0.6631156, 'specificity': 0.6631156, 'f1': 0.72137403, 'auroc': 0.9252463, 'binary_precision': 0.7244898, 'binary_recall': 0.32946634, 'binary_specificity': 0.9967649, 'binary_f1_score': 0.45295057}
confusion matrix:
       0    1
0  16638   54
1    289  142
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92498267, 'precision': 0.46249133, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4805148, 'auroc': 0.84756315, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9334  0
1   757  0
better model found
persisted
after epoch: 5,now: 2024-08-09 13:32:22.104134,epoch time: 0:22:50.809337,used: 1:56:18.723329,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9986229, 'precision': 0.9986248, 'recall': 0.99862385, 'specificity': 0.99862385, 'f1': 0.9986229, 'auroc': 0.99997634, 'binary_precision': 0.99980295, 'binary_recall': 0.99744457, 'binary_specificity': 0.9998031, 'binary_f1_score': 0.99862236}
confusion matrix:
       0      1
0  25391      5
1     65  25371
---- Validation: 
scalar performance:
{'acc': 0.9824213, 'precision': 0.90464085, 'recall': 0.69036686, 'specificity': 0.69036686, 'f1': 0.7570125, 'auroc': 0.9332577, 'binary_precision': 0.825, 'binary_recall': 0.38283062, 'binary_specificity': 0.99790317, 'binary_f1_score': 0.5229794}
confusion matrix:
       0    1
0  16657   35
1    266  165
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92488354, 'precision': 0.4624876, 'recall': 0.49994645, 'specificity': 0.49994645, 'f1': 0.48048806, 'auroc': 0.8670536, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9998929, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9333  1
1   757  0
better model found
persisted
after epoch: 6,now: 2024-08-09 13:54:58.876017,epoch time: 0:22:36.771883,used: 2:18:55.495212,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.99911475, 'precision': 0.9991154, 'recall': 0.99911547, 'specificity': 0.99911547, 'f1': 0.99911475, 'auroc': 0.99997234, 'binary_precision': 0.9999606, 'binary_recall': 0.99827033, 'binary_specificity': 0.9999606, 'binary_f1_score': 0.99911475}
confusion matrix:
       0      1
0  25393      1
1     44  25394
---- Validation: 
scalar performance:
{'acc': 0.97903407, 'precision': 0.9312715, 'recall': 0.59595823, 'specificity': 0.59595823, 'f1': 0.6527722, 'auroc': 0.9151749, 'binary_precision': 0.88297874, 'binary_recall': 0.19257541, 'binary_specificity': 0.999341, 'binary_f1_score': 0.31619048}
confusion matrix:
       0   1
0  16681  11
1    348  83
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92498267, 'precision': 0.46249133, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4805148, 'auroc': 0.80002034, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9334  0
1   757  0
early stop counter: 1
val acc:0.9790340662002563, best validation acc: 0.9824212789535522, corresponding to test acc:                         0.9248835444450378 / 0.9269646406173706
after epoch: 7,now: 2024-08-09 14:17:52.466073,epoch time: 0:22:53.590056,used: 2:41:49.085268,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.998977, 'precision': 0.9989779, 'recall': 0.9989778, 'specificity': 0.9989778, 'f1': 0.99897707, 'auroc': 0.9999655, 'binary_precision': 0.99988186, 'binary_recall': 0.9980737, 'binary_specificity': 0.99988186, 'binary_f1_score': 0.99897695}
confusion matrix:
       0      1
0  25392      3
1     49  25388
---- Validation: 
scalar performance:
{'acc': 0.9813701, 'precision': 0.9254014, 'recall': 0.6525332, 'specificity': 0.6525332, 'f1': 0.72167695, 'auroc': 0.9304466, 'binary_precision': 0.8684211, 'binary_recall': 0.3062645, 'binary_specificity': 0.9988018, 'binary_f1_score': 0.45283017}
confusion matrix:
       0    1
0  16672   20
1    299  132
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9247845, 'precision': 0.46248388, 'recall': 0.49989286, 'specificity': 0.49989286, 'f1': 0.48046133, 'auroc': 0.85967505, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9997857, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9332  2
1   757  0
early stop counter: 2
val acc:0.9813700914382935, best validation acc: 0.9824212789535522, corresponding to test acc:                         0.9248835444450378 / 0.9269646406173706
after epoch: 8,now: 2024-08-09 14:40:42.809243,epoch time: 0:22:50.343170,used: 3:04:39.428438,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.99893767, 'precision': 0.99893785, 'recall': 0.9989381, 'specificity': 0.9989381, 'f1': 0.9989377, 'auroc': 0.99998367, 'binary_precision': 0.99948835, 'binary_recall': 0.99838805, 'binary_specificity': 0.9994881, 'binary_f1_score': 0.9989379}
confusion matrix:
       0      1
0  25384     13
1     41  25394
---- Validation: 
scalar performance:
{'acc': 0.9771068, 'precision': 0.8000872, 'recall': 0.61531216, 'specificity': 0.61531216, 'f1': 0.66420937, 'auroc': 0.87984836, 'binary_precision': 0.6196319, 'binary_recall': 0.23433875, 'binary_specificity': 0.9962856, 'binary_f1_score': 0.34006733}
confusion matrix:
       0    1
0  16630   62
1    330  101
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92528, 'precision': 0.96262884, 'recall': 0.5019815, 'specificity': 0.5019815, 'f1': 0.4845364, 'auroc': 0.7021349, 'binary_precision': 1.0, 'binary_recall': 0.003963012, 'binary_specificity': 1.0, 'binary_f1_score': 0.007894737}
confusion matrix:
      0  1
0  9334  0
1   754  3
early stop counter: 3
val acc:0.9771068096160889, best validation acc: 0.9824212789535522, corresponding to test acc:                         0.9248835444450378 / 0.9269646406173706
after epoch: 9,now: 2024-08-09 15:03:46.048034,epoch time: 0:23:03.238791,used: 3:27:42.667229,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_11_36_03_seed_1_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 9 with time: 3:27:42.667229 at 2024-08-09 15:03:46.048034
persisted model performance metric: 

scalar performance:
{'acc': 0.92488354, 'precision': 0.4624876, 'recall': 0.49994645, 'specificity': 0.49994645, 'f1': 0.48048806, 'auroc': 0.8670536, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9998929, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9333  1
1   757  0
oracle model performance metric: 

scalar performance:
{'acc': 0.92696464, 'precision': 0.8921509, 'recall': 0.51563776, 'specificity': 0.51563776, 'f1': 0.51157546, 'auroc': 0.80791, 'binary_precision': 0.85714287, 'binary_recall': 0.031704094, 'binary_specificity': 0.99957144, 'binary_f1_score': 0.061146498}
confusion matrix:
      0   1
0  9330   4
1   733  24
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 487720 KiB |   1764 MiB | 426369 GiB | 426369 GiB |
|       from large pool | 397184 KiB |   1694 MiB | 424473 GiB | 424473 GiB |
|       from small pool |  90536 KiB |    125 MiB |   1895 GiB |   1895 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 487720 KiB |   1764 MiB | 426369 GiB | 426369 GiB |
|       from large pool | 397184 KiB |   1694 MiB | 424473 GiB | 424473 GiB |
|       from small pool |  90536 KiB |    125 MiB |   1895 GiB |   1895 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 476752 KiB |   1739 MiB | 423078 GiB | 423078 GiB |
|       from large pool | 387840 KiB |   1670 MiB | 421193 GiB | 421193 GiB |
|       from small pool |  88912 KiB |    124 MiB |   1885 GiB |   1885 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2138 MiB |   2138 MiB |   3288 MiB |   1150 MiB |
|       from large pool |   2012 MiB |   2012 MiB |   3130 MiB |   1118 MiB |
|       from small pool |    126 MiB |    128 MiB |    158 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 679639 KiB | 707230 KiB | 284664 GiB | 284664 GiB |
|       from large pool | 671872 KiB | 699520 KiB | 282573 GiB | 282572 GiB |
|       from small pool |   7767 KiB |  34581 KiB |   2091 GiB |   2091 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5163    |    7580    |   71623 K  |   71618 K  |
|       from large pool |      87    |     177    |   26877 K  |   26877 K  |
|       from small pool |    5076    |    7492    |   44745 K  |   44740 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5163    |    7580    |   71623 K  |   71618 K  |
|       from large pool |      87    |     177    |   26877 K  |   26877 K  |
|       from small pool |    5076    |    7492    |   44745 K  |   44740 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     112    |     116    |     157    |      45    |
|       from large pool |      49    |      52    |      78    |      29    |
|       from small pool |      63    |      64    |      79    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      56    |    3211    |   34337 K  |   34337 K  |
|       from large pool |      24    |      40    |   16193 K  |   16193 K  |
|       from small pool |      32    |    3187    |   18143 K  |   18143 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1764 MiB | 426369 GiB | 426369 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 424473 GiB | 424473 GiB |
|       from small pool |      0 KiB |    125 MiB |   1895 GiB |   1895 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1764 MiB | 426369 GiB | 426369 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 424473 GiB | 424473 GiB |
|       from small pool |      0 KiB |    125 MiB |   1895 GiB |   1895 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1739 MiB | 423078 GiB | 423078 GiB |
|       from large pool |  16640 KiB |   1670 MiB | 421193 GiB | 421193 GiB |
|       from small pool |      0 KiB |    124 MiB |   1885 GiB |   1885 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1140 MiB |   2138 MiB |   3288 MiB |   2148 MiB |
|       from large pool |   1044 MiB |   2012 MiB |   3130 MiB |   2086 MiB |
|       from small pool |     96 MiB |    128 MiB |    158 MiB |     62 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 134912 KiB |    768 MiB | 284665 GiB | 284665 GiB |
|       from large pool | 134912 KiB |    748 MiB | 282573 GiB | 282573 GiB |
|       from small pool |      0 KiB |     33 MiB |   2091 GiB |   2091 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7580    |   71623 K  |   71623 K  |
|       from large pool |       2    |     177    |   26877 K  |   26877 K  |
|       from small pool |       0    |    7492    |   44745 K  |   44745 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7580    |   71623 K  |   71623 K  |
|       from large pool |       2    |     177    |   26877 K  |   26877 K  |
|       from small pool |       0    |    7492    |   44745 K  |   44745 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      72    |     116    |     157    |      85    |
|       from large pool |      24    |      52    |      78    |      54    |
|       from small pool |      48    |      64    |      79    |      31    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3211    |   34339 K  |   34339 K  |
|       from large pool |       4    |      40    |   16193 K  |   16193 K  |
|       from small pool |       0    |    3187    |   18145 K  |   18145 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1764 MiB | 426369 GiB | 426369 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 424473 GiB | 424473 GiB |
|       from small pool |      0 KiB |    125 MiB |   1895 GiB |   1895 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1764 MiB | 426369 GiB | 426369 GiB |
|       from large pool |  16640 KiB |   1694 MiB | 424473 GiB | 424473 GiB |
|       from small pool |      0 KiB |    125 MiB |   1895 GiB |   1895 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1739 MiB | 423078 GiB | 423078 GiB |
|       from large pool |  16640 KiB |   1670 MiB | 421193 GiB | 421193 GiB |
|       from small pool |      0 KiB |    124 MiB |   1885 GiB |   1885 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1140 MiB |   2138 MiB |   3288 MiB |   2148 MiB |
|       from large pool |   1044 MiB |   2012 MiB |   3130 MiB |   2086 MiB |
|       from small pool |     96 MiB |    128 MiB |    158 MiB |     62 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 134912 KiB |    768 MiB | 284665 GiB | 284665 GiB |
|       from large pool | 134912 KiB |    748 MiB | 282573 GiB | 282573 GiB |
|       from small pool |      0 KiB |     33 MiB |   2091 GiB |   2091 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7580    |   71623 K  |   71623 K  |
|       from large pool |       2    |     177    |   26877 K  |   26877 K  |
|       from small pool |       0    |    7492    |   44745 K  |   44745 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7580    |   71623 K  |   71623 K  |
|       from large pool |       2    |     177    |   26877 K  |   26877 K  |
|       from small pool |       0    |    7492    |   44745 K  |   44745 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      72    |     116    |     157    |      85    |
|       from large pool |      24    |      52    |      78    |      54    |
|       from small pool |      48    |      64    |      79    |      31    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3211    |   34339 K  |   34339 K  |
|       from large pool |       4    |      40    |   16193 K  |   16193 K  |
|       from small pool |       0    |    3187    |   18145 K  |   18145 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708

 Experiment start at: 2024-08-09 15:23:39.665002
before training, model accuracy: 0.10721363127231598
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9942936, 'precision': 0.9943036, 'recall': 0.9942944, 'specificity': 0.9942944, 'f1': 0.9942936, 'auroc': 0.99972284, 'binary_precision': 0.9966195, 'binary_recall': 0.99195576, 'binary_specificity': 0.996633, 'binary_f1_score': 0.9942822}
confusion matrix:
       0      1
0  25752     87
1    208  25649
---- Validation: 
scalar performance:
{'acc': 0.96764773, 'precision': 0.6854557, 'recall': 0.7548355, 'specificity': 0.7548355, 'f1': 0.71411407, 'auroc': 0.88853914, 'binary_precision': 0.38275862, 'binary_recall': 0.53110045, 'binary_specificity': 0.9785706, 'binary_f1_score': 0.44488978}
confusion matrix:
       0    1
0  16348  358
1    196  222
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92043203, 'precision': 0.52303153, 'recall': 0.5002508, 'specificity': 0.5002508, 'f1': 0.4805239, 'auroc': 0.8178981, 'binary_precision': 0.125, 'binary_recall': 0.0012547051, 'binary_specificity': 0.9992469, 'binary_f1_score': 0.002484472}
confusion matrix:
      0  1
0  9288  7
1   796  1
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-09 15:51:16.733994,epoch time: 0:27:37.068992,used: 0:27:37.068992,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.99673086, 'precision': 0.99674153, 'recall': 0.99673116, 'specificity': 0.99673116, 'f1': 0.99673086, 'auroc': 0.9998826, 'binary_precision': 0.99906725, 'binary_recall': 0.9943909, 'binary_specificity': 0.99907136, 'binary_f1_score': 0.9967236}
confusion matrix:
       0      1
0  25821     24
1    145  25706
---- Validation: 
scalar performance:
{'acc': 0.9774001, 'precision': 0.7634235, 'recall': 0.7505038, 'specificity': 0.7505038, 'f1': 0.75678897, 'auroc': 0.9036821, 'binary_precision': 0.53904283, 'binary_recall': 0.5119617, 'binary_specificity': 0.98904586, 'binary_f1_score': 0.5251534}
confusion matrix:
       0    1
0  16523  183
1    204  214
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9210265, 'precision': 0.46051326, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.479445, 'auroc': 0.7346073, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9295  0
1   797  0
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-09 16:20:03.500457,epoch time: 0:28:46.766463,used: 0:56:23.835455,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9979302, 'precision': 0.9979344, 'recall': 0.9979304, 'specificity': 0.9979304, 'f1': 0.99793017, 'auroc': 0.99994355, 'binary_precision': 0.999418, 'binary_recall': 0.9964413, 'binary_specificity': 0.99941957, 'binary_f1_score': 0.9979274}
confusion matrix:
       0      1
0  25829     15
1     92  25760
---- Validation: 
scalar performance:
{'acc': 0.9759402, 'precision': 0.74728215, 'recall': 0.7322619, 'specificity': 0.7322619, 'f1': 0.73951834, 'auroc': 0.9141233, 'binary_precision': 0.50765306, 'binary_recall': 0.47607654, 'binary_specificity': 0.98844725, 'binary_f1_score': 0.491358}
confusion matrix:
       0    1
0  16513  193
1    219  199
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.921522, 'precision': 0.78452194, 'recall': 0.50657815, 'specificity': 0.50657815, 'f1': 0.49306953, 'auroc': 0.76401174, 'binary_precision': 0.64705884, 'binary_recall': 0.013801756, 'binary_specificity': 0.9993545, 'binary_f1_score': 0.027027026}
confusion matrix:
      0   1
0  9289   6
1   786  11
new oracle model saved
early stop counter: 1
val acc:0.9759402275085449, best validation acc: 0.9774001240730286, corresponding to test acc:                         0.9210265278816223 / 0.9215220212936401
after epoch: 3,now: 2024-08-09 16:48:59.259621,epoch time: 0:28:55.759164,used: 1:25:19.594619,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9983945, 'precision': 0.9983965, 'recall': 0.9983946, 'specificity': 0.9983946, 'f1': 0.9983945, 'auroc': 0.9999292, 'binary_precision': 0.9994573, 'binary_recall': 0.99733096, 'binary_specificity': 0.9994583, 'binary_f1_score': 0.998393}
confusion matrix:
       0      1
0  25830     14
1     69  25783
---- Validation: 
scalar performance:
{'acc': 0.9779257, 'precision': 0.7745061, 'recall': 0.7087884, 'specificity': 0.7087884, 'f1': 0.73686737, 'auroc': 0.9234153, 'binary_precision': 0.56329113, 'binary_recall': 0.4258373, 'binary_specificity': 0.9917395, 'binary_f1_score': 0.4850136}
confusion matrix:
       0    1
0  16568  138
1    240  178
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9227111, 'precision': 0.9350165, 'recall': 0.5112386, 'specificity': 0.5112386, 'f1': 0.50192255, 'auroc': 0.7213692, 'binary_precision': 0.94736844, 'binary_recall': 0.022584694, 'binary_specificity': 0.9998924, 'binary_f1_score': 0.04411765}
confusion matrix:
      0   1
0  9294   1
1   779  18
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-08-09 17:19:37.577830,epoch time: 0:30:38.318209,used: 1:55:57.912828,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9984138, 'precision': 0.998415, 'recall': 0.99841404, 'specificity': 0.99841404, 'f1': 0.9984138, 'auroc': 0.9998566, 'binary_precision': 0.9992638, 'binary_recall': 0.99756324, 'binary_specificity': 0.9992648, 'binary_f1_score': 0.9984128}
confusion matrix:
       0      1
0  25823     19
1     63  25791
---- Validation: 
scalar performance:
{'acc': 0.97757536, 'precision': 0.7672268, 'recall': 0.728435, 'specificity': 0.728435, 'f1': 0.7462022, 'auroc': 0.9164127, 'binary_precision': 0.5477528, 'binary_recall': 0.46650717, 'binary_specificity': 0.99036276, 'binary_f1_score': 0.503876}
confusion matrix:
       0    1
0  16545  161
1    223  195
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9201348, 'precision': 0.68346846, 'recall': 0.5195905, 'specificity': 0.5195905, 'f1': 0.5190822, 'auroc': 0.8311503, 'binary_precision': 0.443038, 'binary_recall': 0.04391468, 'binary_specificity': 0.99526626, 'binary_f1_score': 0.07990868}
confusion matrix:
      0   1
0  9251  44
1   762  35
early stop counter: 1
val acc:0.9775753617286682, best validation acc: 0.977925717830658, corresponding to test acc:                         0.9227110743522644 / 0.9227110743522644
after epoch: 5,now: 2024-08-09 17:53:12.256011,epoch time: 0:33:34.678181,used: 2:29:32.591009,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.99891675, 'precision': 0.998917, 'recall': 0.99891686, 'specificity': 0.99891686, 'f1': 0.99891675, 'auroc': 0.9999728, 'binary_precision': 0.99934196, 'binary_recall': 0.99849164, 'binary_specificity': 0.9993421, 'binary_f1_score': 0.9989166}
confusion matrix:
       0      1
0  25823     17
1     39  25817
---- Validation: 
scalar performance:
{'acc': 0.9786849, 'precision': 0.7863376, 'recall': 0.7103437, 'specificity': 0.7103437, 'f1': 0.7421358, 'auroc': 0.9325373, 'binary_precision': 0.5868853, 'binary_recall': 0.42822966, 'binary_specificity': 0.9924578, 'binary_f1_score': 0.49515906}
confusion matrix:
       0    1
0  16580  126
1    239  179
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92261195, 'precision': 0.91132843, 'recall': 0.51118475, 'specificity': 0.51118475, 'f1': 0.50186867, 'auroc': 0.86366326, 'binary_precision': 0.9, 'binary_recall': 0.022584694, 'binary_specificity': 0.9997848, 'binary_f1_score': 0.04406365}
confusion matrix:
      0   1
0  9293   2
1   779  18
better model found
persisted
after epoch: 6,now: 2024-08-09 18:24:13.890541,epoch time: 0:31:01.634530,used: 3:00:34.225539,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9988007, 'precision': 0.9988023, 'recall': 0.99880075, 'specificity': 0.99880075, 'f1': 0.9988007, 'auroc': 0.9999896, 'binary_precision': 0.9997287, 'binary_recall': 0.99787235, 'binary_specificity': 0.99972916, 'binary_f1_score': 0.9987997}
confusion matrix:
       0      1
0  25839      7
1     55  25795
---- Validation: 
scalar performance:
{'acc': 0.976641, 'precision': 0.7601916, 'recall': 0.65098405, 'specificity': 0.65098405, 'f1': 0.6900945, 'auroc': 0.92785364, 'binary_precision': 0.5375, 'binary_recall': 0.30861244, 'binary_specificity': 0.9933557, 'binary_f1_score': 0.39209723}
confusion matrix:
       0    1
0  16595  111
1    289  129
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9210265, 'precision': 0.46051326, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.479445, 'auroc': 0.8079293, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9295  0
1   797  0
early stop counter: 1
val acc:0.9766409993171692, best validation acc: 0.9786849021911621, corresponding to test acc:                         0.9226119518280029 / 0.9227110743522644
after epoch: 7,now: 2024-08-09 18:54:51.577272,epoch time: 0:30:37.686731,used: 3:31:11.912270,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.99882, 'precision': 0.99882114, 'recall': 0.99882025, 'specificity': 0.99882025, 'f1': 0.99882007, 'auroc': 0.9999709, 'binary_precision': 0.9996513, 'binary_recall': 0.99798876, 'binary_specificity': 0.99965173, 'binary_f1_score': 0.99881935}
confusion matrix:
       0      1
0  25832      9
1     52  25803
---- Validation: 
scalar performance:
{'acc': 0.9782177, 'precision': 0.7952259, 'recall': 0.64945966, 'specificity': 0.64945966, 'f1': 0.6970047, 'auroc': 0.9102994, 'binary_precision': 0.6076555, 'binary_recall': 0.30382776, 'binary_specificity': 0.99509156, 'binary_f1_score': 0.40510368}
confusion matrix:
       0    1
0  16624   82
1    291  127
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9210265, 'precision': 0.46051326, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.479445, 'auroc': 0.7585536, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9295  0
1   797  0
early stop counter: 2
val acc:0.9782177209854126, best validation acc: 0.9786849021911621, corresponding to test acc:                         0.9226119518280029 / 0.9227110743522644
after epoch: 8,now: 2024-08-09 19:37:02.975584,epoch time: 0:42:11.398312,used: 4:13:23.310582,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.9993423, 'precision': 0.9993427, 'recall': 0.9993423, 'specificity': 0.9993423, 'f1': 0.9993423, 'auroc': 0.9999814, 'binary_precision': 0.9998064, 'binary_recall': 0.9988782, 'binary_specificity': 0.9998065, 'binary_f1_score': 0.9993421}
confusion matrix:
       0      1
0  25840      5
1     29  25822
---- Validation: 
scalar performance:
{'acc': 0.9808456, 'precision': 0.8492204, 'recall': 0.67763007, 'specificity': 0.67763007, 'f1': 0.7339754, 'auroc': 0.92358255, 'binary_precision': 0.71428573, 'binary_recall': 0.35885167, 'binary_specificity': 0.99640846, 'binary_f1_score': 0.477707}
confusion matrix:
       0    1
0  16646   60
1    268  150
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92112565, 'precision': 0.9605589, 'recall': 0.50062734, 'specificity': 0.50062734, 'f1': 0.48072287, 'auroc': 0.7916497, 'binary_precision': 1.0, 'binary_recall': 0.0012547051, 'binary_specificity': 1.0, 'binary_f1_score': 0.0025062656}
confusion matrix:
      0  1
0  9295  0
1   796  1
better model found
persisted
after epoch: 9,now: 2024-08-09 20:08:43.150779,epoch time: 0:31:40.175195,used: 4:45:03.485777,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.99932295, 'precision': 0.9993231, 'recall': 0.999323, 'specificity': 0.999323, 'f1': 0.99932295, 'auroc': 0.9999979, 'binary_precision': 0.9996516, 'binary_recall': 0.9989942, 'binary_specificity': 0.9996518, 'binary_f1_score': 0.9993228}
confusion matrix:
       0      1
0  25837      9
1     26  25824
---- Validation: 
scalar performance:
{'acc': 0.98002803, 'precision': 0.8151356, 'recall': 0.69936967, 'specificity': 0.69936967, 'f1': 0.74343526, 'auroc': 0.9301137, 'binary_precision': 0.6450382, 'binary_recall': 0.40430623, 'binary_specificity': 0.99443316, 'binary_f1_score': 0.49705887}
confusion matrix:
       0    1
0  16613   93
1    249  169
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92132384, 'precision': 0.860692, 'recall': 0.5024556, 'specificity': 0.5024556, 'f1': 0.48450464, 'auroc': 0.8273625, 'binary_precision': 0.8, 'binary_recall': 0.0050188205, 'binary_specificity': 0.9998924, 'binary_f1_score': 0.009975062}
confusion matrix:
      0  1
0  9294  1
1   793  4
early stop counter: 1
val acc:0.9800280332565308, best validation acc: 0.98084557056427, corresponding to test acc:                         0.9211256504058838 / 0.9227110743522644
after epoch: 10,now: 2024-08-09 20:39:32.125843,epoch time: 0:30:48.975064,used: 5:15:52.460841,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9989748, 'precision': 0.99897623, 'recall': 0.99897486, 'specificity': 0.99897486, 'f1': 0.9989748, 'auroc': 0.9999896, 'binary_precision': 0.99984497, 'binary_recall': 0.99810445, 'binary_specificity': 0.99984527, 'binary_f1_score': 0.99897397}
confusion matrix:
       0      1
0  25842      4
1     49  25801
---- Validation: 
scalar performance:
{'acc': 0.9786849, 'precision': 0.79530174, 'recall': 0.67768896, 'specificity': 0.67768896, 'f1': 0.72095215, 'auroc': 0.9219047, 'binary_precision': 0.6064257, 'binary_recall': 0.36124402, 'binary_specificity': 0.99413383, 'binary_f1_score': 0.45277363}
confusion matrix:
       0    1
0  16608   98
1    267  151
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.921522, 'precision': 0.9607415, 'recall': 0.50313675, 'specificity': 0.50313675, 'f1': 0.4858031, 'auroc': 0.8015098, 'binary_precision': 1.0, 'binary_recall': 0.0062735258, 'binary_specificity': 1.0, 'binary_f1_score': 0.012468828}
confusion matrix:
      0  1
0  9295  0
1   792  5
early stop counter: 2
val acc:0.9786849021911621, best validation acc: 0.98084557056427, corresponding to test acc:                         0.9211256504058838 / 0.9227110743522644
after epoch: 11,now: 2024-08-09 21:10:08.379924,epoch time: 0:30:36.254081,used: 5:46:28.714922,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9992069, 'precision': 0.9992074, 'recall': 0.999207, 'specificity': 0.999207, 'f1': 0.99920684, 'auroc': 0.9999902, 'binary_precision': 0.9997289, 'binary_recall': 0.9986848, 'binary_specificity': 0.99972916, 'binary_f1_score': 0.99920654}
confusion matrix:
       0      1
0  25837      7
1     34  25818
---- Validation: 
scalar performance:
{'acc': 0.9799696, 'precision': 0.82612264, 'recall': 0.6760149, 'specificity': 0.6760149, 'f1': 0.7273462, 'auroc': 0.93171906, 'binary_precision': 0.66816145, 'binary_recall': 0.35645932, 'binary_specificity': 0.9955705, 'binary_f1_score': 0.46489862}
confusion matrix:
       0    1
0  16632   74
1    269  149
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9210265, 'precision': 0.46051326, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.479445, 'auroc': 0.7455625, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  9295  0
1   797  0
early stop counter: 3
val acc:0.9799696207046509, best validation acc: 0.98084557056427, corresponding to test acc:                         0.9211256504058838 / 0.9227110743522644
after epoch: 12,now: 2024-08-09 21:40:20.318104,epoch time: 0:30:11.938180,used: 6:16:40.653102,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_15_23_39_seed_2_24132708
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 12 with time: 6:16:40.653102 at 2024-08-09 21:40:20.318104
persisted model performance metric: 

scalar performance:
{'acc': 0.92112565, 'precision': 0.9605589, 'recall': 0.50062734, 'specificity': 0.50062734, 'f1': 0.48072287, 'auroc': 0.7916497, 'binary_precision': 1.0, 'binary_recall': 0.0012547051, 'binary_specificity': 1.0, 'binary_f1_score': 0.0025062656}
confusion matrix:
      0  1
0  9295  0
1   796  1
oracle model performance metric: 

scalar performance:
{'acc': 0.9227111, 'precision': 0.9350165, 'recall': 0.5112386, 'specificity': 0.5112386, 'f1': 0.50192255, 'auroc': 0.7213692, 'binary_precision': 0.94736844, 'binary_recall': 0.022584694, 'binary_specificity': 0.9998924, 'binary_f1_score': 0.04411765}
confusion matrix:
      0   1
0  9294   1
1   779  18
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_erm_irm_resnet_nofreeze_halffreeze_allfreeze_2024-08-09_01-24-07/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 485672 KiB |   1764 MiB |    769 TiB |    769 TiB |
|       from large pool | 395136 KiB |   1694 MiB |    765 TiB |    765 TiB |
|       from small pool |  90536 KiB |    125 MiB |      3 TiB |      3 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 485672 KiB |   1764 MiB |    769 TiB |    769 TiB |
|       from large pool | 395136 KiB |   1694 MiB |    765 TiB |    765 TiB |
|       from small pool |  90536 KiB |    125 MiB |      3 TiB |      3 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 476752 KiB |   1739 MiB | 782443 GiB | 782442 GiB |
|       from large pool | 387840 KiB |   1670 MiB | 778926 GiB | 778926 GiB |
|       from small pool |  88912 KiB |    124 MiB |   3516 GiB |   3516 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2042 MiB |   2138 MiB |   4190 MiB |   2148 MiB |
|       from large pool |   1916 MiB |   2012 MiB |   4002 MiB |   2086 MiB |
|       from small pool |    126 MiB |    128 MiB |    188 MiB |     62 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 638679 KiB |    768 MiB | 563753 GiB | 563752 GiB |
|       from large pool | 630912 KiB |    748 MiB | 559841 GiB | 559841 GiB |
|       from small pool |   7767 KiB |     33 MiB |   3911 GiB |   3911 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5163    |    7688    |  132891 K  |  132886 K  |
|       from large pool |      87    |     177    |   49659 K  |   49659 K  |
|       from small pool |    5076    |    7600    |   83232 K  |   83227 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5163    |    7688    |  132891 K  |  132886 K  |
|       from large pool |      87    |     177    |   49659 K  |   49659 K  |
|       from small pool |    5076    |    7600    |   83232 K  |   83227 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     107    |     116    |     192    |      85    |
|       from large pool |      44    |      52    |      98    |      54    |
|       from small pool |      63    |      64    |      94    |      31    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      60    |    3268    |   63248 K  |   63247 K  |
|       from large pool |      27    |      40    |   29032 K  |   29032 K  |
|       from small pool |      33    |    3241    |   34215 K  |   34215 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1764 MiB |    769 TiB |    769 TiB |
|       from large pool |  16640 KiB |   1694 MiB |    765 TiB |    765 TiB |
|       from small pool |      0 KiB |    125 MiB |      3 TiB |      3 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1764 MiB |    769 TiB |    769 TiB |
|       from large pool |  16640 KiB |   1694 MiB |    765 TiB |    765 TiB |
|       from small pool |      0 KiB |    125 MiB |      3 TiB |      3 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1739 MiB | 782443 GiB | 782443 GiB |
|       from large pool |  16640 KiB |   1670 MiB | 778926 GiB | 778926 GiB |
|       from small pool |      0 KiB |    124 MiB |   3516 GiB |   3516 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1098 MiB |   2138 MiB |   4190 MiB |   3092 MiB |
|       from large pool |   1002 MiB |   2012 MiB |   4002 MiB |   3000 MiB |
|       from small pool |     96 MiB |    128 MiB |    188 MiB |     92 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 134912 KiB |    768 MiB | 563753 GiB | 563753 GiB |
|       from large pool | 134912 KiB |    748 MiB | 559842 GiB | 559841 GiB |
|       from small pool |      0 KiB |     33 MiB |   3911 GiB |   3911 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7688    |  132891 K  |  132891 K  |
|       from large pool |       2    |     177    |   49659 K  |   49659 K  |
|       from small pool |       0    |    7600    |   83232 K  |   83232 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7688    |  132891 K  |  132891 K  |
|       from large pool |       2    |     177    |   49659 K  |   49659 K  |
|       from small pool |       0    |    7600    |   83232 K  |   83232 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |     116    |     192    |     118    |
|       from large pool |      26    |      52    |      98    |      72    |
|       from small pool |      48    |      64    |      94    |      46    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3268    |   63250 K  |   63250 K  |
|       from large pool |       4    |      40    |   29032 K  |   29032 K  |
|       from small pool |       0    |    3241    |   34217 K  |   34217 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  9 21:57:36 2024]
Finished job 0.
1 of 1 steps (100%) done
