Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 13:00:08 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_13_09_51_seed_0_24046583

 Experiment start at: 2024-08-02 13:09:51.536674
before training, model accuracy: 0.22451263666152954
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.938947, 'precision': 0.9425006, 'recall': 0.9389752, 'specificity': 0.9389752, 'f1': 0.93882686, 'auroc': 0.97741365, 'binary_precision': 0.9823124, 'binary_recall': 0.89406925, 'binary_specificity': 0.9838811, 'binary_f1_score': 0.93611586}
confusion matrix:
       0      1
0  28200    462
1   3040  25658
---- Validation: 
scalar performance:
{'acc': 0.9564176, 'precision': 0.55019945, 'recall': 0.519153, 'specificity': 0.519153, 'f1': 0.52508235, 'auroc': 0.7476673, 'binary_precision': 0.13333334, 'binary_recall': 0.04976672, 'binary_specificity': 0.98853934, 'binary_f1_score': 0.07248019}
confusion matrix:
       0    1
0  17941  208
1    611   32
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9405561, 'precision': 0.5330836, 'recall': 0.5182304, 'specificity': 0.5182304, 'f1': 0.5219593, 'auroc': 0.7843314, 'binary_precision': 0.10638298, 'binary_recall': 0.057471264, 'binary_specificity': 0.9789895, 'binary_f1_score': 0.07462687}
confusion matrix:
      0    1
0  5871  126
1   246   15
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 13:47:26.201859,epoch time: 0:37:34.665185,used: 0:37:34.665185,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_13_09_51_seed_0_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9553522, 'precision': 0.9572849, 'recall': 0.95537835, 'specificity': 0.95537835, 'f1': 0.95530677, 'auroc': 0.98621, 'binary_precision': 0.98721486, 'binary_recall': 0.92272586, 'binary_specificity': 0.98803085, 'binary_f1_score': 0.9538816}
confusion matrix:
       0      1
0  28314    343
1   2218  26485
---- Validation: 
scalar performance:
{'acc': 0.9571094, 'precision': 0.6154858, 'recall': 0.5622643, 'specificity': 0.5622643, 'f1': 0.5794362, 'auroc': 0.79766655, 'binary_precision': 0.26099706, 'binary_recall': 0.13841368, 'binary_specificity': 0.9861149, 'binary_f1_score': 0.1808943}
confusion matrix:
       0    1
0  17897  252
1    554   89
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94630873, 'precision': 0.63168836, 'recall': 0.5945252, 'specificity': 0.5945252, 'f1': 0.6093996, 'auroc': 0.8400727, 'binary_precision': 0.2972973, 'binary_recall': 0.21072797, 'binary_specificity': 0.9783225, 'binary_f1_score': 0.24663676}
confusion matrix:
      0    1
0  5867  130
1   206   55
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 14:23:13.654436,epoch time: 0:35:47.452577,used: 1:13:22.117762,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_13_09_51_seed_0_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96434796, 'precision': 0.96481264, 'recall': 0.96436024, 'specificity': 0.96436024, 'f1': 0.96433973, 'auroc': 0.99035764, 'binary_precision': 0.9797013, 'binary_recall': 0.9484008, 'binary_specificity': 0.9803196, 'binary_f1_score': 0.963797}
confusion matrix:
       0      1
0  28094    564
1   1481  27221
---- Validation: 
scalar performance:
{'acc': 0.94226265, 'precision': 0.61973107, 'recall': 0.67008644, 'specificity': 0.67008644, 'f1': 0.6396146, 'auroc': 0.83999217, 'binary_precision': 0.26185346, 'binary_recall': 0.377916, 'binary_specificity': 0.96225685, 'binary_f1_score': 0.3093571}
confusion matrix:
       0    1
0  17464  685
1    400  243
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9397571, 'precision': 0.6686603, 'recall': 0.7560169, 'specificity': 0.7560169, 'f1': 0.7014828, 'auroc': 0.8659164, 'binary_precision': 0.35714287, 'binary_recall': 0.5555556, 'binary_specificity': 0.95647824, 'binary_f1_score': 0.43478262}
confusion matrix:
      0    1
0  5736  261
1   116  145
early stop counter: 1
val acc:0.9422626495361328, best validation acc: 0.9571093916893005, corresponding to test acc:                         0.9463087320327759 / 0.9463087320327759
after epoch: 3,now: 2024-08-02 14:58:52.219506,epoch time: 0:35:38.565070,used: 1:49:00.682832,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_13_09_51_seed_0_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.96858436, 'precision': 0.9691323, 'recall': 0.968597, 'specificity': 0.968597, 'f1': 0.96857584, 'auroc': 0.99244237, 'binary_precision': 0.98534876, 'binary_recall': 0.9513606, 'binary_specificity': 0.9858334, 'binary_f1_score': 0.96805644}
confusion matrix:
       0      1
0  28253    406
1   1396  27305
---- Validation: 
scalar performance:
{'acc': 0.9360898, 'precision': 0.62166816, 'recall': 0.71564424, 'specificity': 0.71564424, 'f1': 0.6527209, 'auroc': 0.85510904, 'binary_precision': 0.26235095, 'binary_recall': 0.47900465, 'binary_specificity': 0.95228386, 'binary_f1_score': 0.33902034}
confusion matrix:
       0    1
0  17283  866
1    335  308
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93144774, 'precision': 0.65816927, 'recall': 0.7919928, 'specificity': 0.7919928, 'f1': 0.7006222, 'auroc': 0.875231, 'binary_precision': 0.33266932, 'binary_recall': 0.63984674, 'binary_specificity': 0.94413877, 'binary_f1_score': 0.43774575}
confusion matrix:
      0    1
0  5662  335
1    94  167
early stop counter: 2
val acc:0.936089813709259, best validation acc: 0.9571093916893005, corresponding to test acc:                         0.9463087320327759 / 0.9463087320327759
after epoch: 4,now: 2024-08-02 15:33:20.944748,epoch time: 0:34:28.725242,used: 2:23:29.408074,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_13_09_51_seed_0_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9705718, 'precision': 0.97079474, 'recall': 0.9705799, 'specificity': 0.9705799, 'f1': 0.9705687, 'auroc': 0.9938811, 'binary_precision': 0.9812235, 'binary_recall': 0.9595485, 'binary_specificity': 0.9816114, 'binary_f1_score': 0.9702649}
confusion matrix:
       0      1
0  28132    527
1   1161  27540
---- Validation: 
scalar performance:
{'acc': 0.926192, 'precision': 0.6110805, 'recall': 0.7360219, 'specificity': 0.7360219, 'f1': 0.64560956, 'auroc': 0.8608377, 'binary_precision': 0.2394958, 'binary_recall': 0.5318818, 'binary_specificity': 0.940162, 'binary_f1_score': 0.3302752}
confusion matrix:
       0     1
0  17063  1086
1    301   342
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91802496, 'precision': 0.6411434, 'recall': 0.81430656, 'specificity': 0.81430656, 'f1': 0.68614936, 'auroc': 0.8839114, 'binary_precision': 0.2961165, 'binary_recall': 0.7011494, 'binary_specificity': 0.9274637, 'binary_f1_score': 0.41638222}
confusion matrix:
      0    1
0  5562  435
1    78  183
early stop counter: 3
val acc:0.9261919856071472, best validation acc: 0.9571093916893005, corresponding to test acc:                         0.9463087320327759 / 0.9463087320327759
after epoch: 5,now: 2024-08-02 16:09:03.976568,epoch time: 0:35:43.031820,used: 2:59:12.439894,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_13_09_51_seed_0_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:59:12.439894 at 2024-08-02 16:09:03.976568
persisted model performance metric: 

scalar performance:
{'acc': 0.94630873, 'precision': 0.63168836, 'recall': 0.5945252, 'specificity': 0.5945252, 'f1': 0.6093996, 'auroc': 0.8400727, 'binary_precision': 0.2972973, 'binary_recall': 0.21072797, 'binary_specificity': 0.9783225, 'binary_f1_score': 0.24663676}
confusion matrix:
      0    1
0  5867  130
1   206   55
oracle model performance metric: 

scalar performance:
{'acc': 0.94630873, 'precision': 0.63168836, 'recall': 0.5945252, 'specificity': 0.5945252, 'f1': 0.6093996, 'auroc': 0.8400727, 'binary_precision': 0.2972973, 'binary_recall': 0.21072797, 'binary_specificity': 0.9783225, 'binary_f1_score': 0.24663676}
confusion matrix:
      0    1
0  5867  130
1   206   55
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198163 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |  17501 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198163 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |  17501 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB | 264555 GiB | 264554 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 261360 GiB | 261360 GiB |
|       from small pool |  16482 KiB |     36 MiB |   3194 GiB |   3194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  57837 KiB | 225565 KiB | 142326 GiB | 142326 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 139103 GiB | 139103 GiB |
|       from small pool |   7075 KiB |   9877 KiB |   3223 GiB |   3223 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2998    |    7665    |   39922 K  |   39919 K  |
|       from large pool |      79    |     252    |   24056 K  |   24056 K  |
|       from small pool |    2919    |    7585    |   15865 K  |   15862 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2998    |    7665    |   39922 K  |   39919 K  |
|       from large pool |      79    |     252    |   24056 K  |   24056 K  |
|       from small pool |    2919    |    7585    |   15865 K  |   15862 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3602    |   25852 K  |   25852 K  |
|       from large pool |      10    |      97    |   18685 K  |   18685 K  |
|       from small pool |      29    |    3592    |    7166 K  |    7166 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 264555 GiB | 264555 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 261360 GiB | 261360 GiB |
|       from small pool |      0 KiB |     36 MiB |   3194 GiB |   3194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   2372 MiB |   2372 MiB |   2122 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 142326 GiB | 142326 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 139103 GiB | 139103 GiB |
|       from small pool |      0 KiB |  19174 KiB |   3223 GiB |   3223 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     118    |      95    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3602    |   25853 K  |   25853 K  |
|       from large pool |       3    |      97    |   18685 K  |   18685 K  |
|       from small pool |       0    |    3592    |    7167 K  |    7167 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 264555 GiB | 264555 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 261360 GiB | 261360 GiB |
|       from small pool |      0 KiB |     36 MiB |   3194 GiB |   3194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   2372 MiB |   2372 MiB |   2122 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 142326 GiB | 142326 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 139103 GiB | 139103 GiB |
|       from small pool |      0 KiB |  19174 KiB |   3223 GiB |   3223 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     118    |      95    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3602    |   25853 K  |   25853 K  |
|       from large pool |       3    |      97    |   18685 K  |   18685 K  |
|       from small pool |       0    |    3592    |    7167 K  |    7167 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583

 Experiment start at: 2024-08-02 16:18:25.155417
before training, model accuracy: 0.6890106797218323
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.938472, 'precision': 0.94202673, 'recall': 0.93850625, 'specificity': 0.93850625, 'f1': 0.9383513, 'auroc': 0.98125774, 'binary_precision': 0.98185766, 'binary_recall': 0.89354837, 'binary_specificity': 0.9834642, 'binary_f1_score': 0.9356239}
confusion matrix:
       0      1
0  28310    476
1   3069  25761
---- Validation: 
scalar performance:
{'acc': 0.9347385, 'precision': 0.60791653, 'recall': 0.6657415, 'specificity': 0.6657415, 'f1': 0.6292229, 'auroc': 0.84320265, 'binary_precision': 0.23958333, 'binary_recall': 0.37592867, 'binary_specificity': 0.9555543, 'binary_f1_score': 0.2926547}
confusion matrix:
       0    1
0  17264  803
1    420  253
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9429584, 'precision': 0.67687774, 'recall': 0.7495537, 'specificity': 0.7495537, 'f1': 0.7057922, 'auroc': 0.87967217, 'binary_precision': 0.37433156, 'binary_recall': 0.53846157, 'binary_specificity': 0.9606458, 'binary_f1_score': 0.4416404}
confusion matrix:
      0    1
0  5712  234
1   120  140
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 16:54:09.107097,epoch time: 0:35:43.951680,used: 0:35:43.951680,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9549604, 'precision': 0.9562255, 'recall': 0.9549806, 'specificity': 0.9549806, 'f1': 0.95493054, 'auroc': 0.98976356, 'binary_precision': 0.9804417, 'binary_recall': 0.928512, 'binary_specificity': 0.9814493, 'binary_f1_score': 0.9537705}
confusion matrix:
       0      1
0  28252    534
1   2061  26769
---- Validation: 
scalar performance:
{'acc': 0.95005333, 'precision': 0.67039263, 'recall': 0.73376656, 'specificity': 0.73376656, 'f1': 0.69626963, 'auroc': 0.88029504, 'binary_precision': 0.35965848, 'binary_recall': 0.5007429, 'binary_specificity': 0.96679026, 'binary_f1_score': 0.41863352}
confusion matrix:
       0    1
0  17467  600
1    336  337
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95681596, 'precision': 0.7369169, 'recall': 0.817472, 'specificity': 0.817472, 'f1': 0.7704011, 'auroc': 0.9155774, 'binary_precision': 0.48870057, 'binary_recall': 0.6653846, 'binary_specificity': 0.9695594, 'binary_f1_score': 0.5635179}
confusion matrix:
      0    1
0  5765  181
1    87  173
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 17:28:59.445342,epoch time: 0:34:50.338245,used: 1:10:34.289925,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9613996, 'precision': 0.96239823, 'recall': 0.9614158, 'specificity': 0.9614158, 'f1': 0.9613797, 'auroc': 0.9926218, 'binary_precision': 0.9840611, 'binary_recall': 0.93804634, 'binary_specificity': 0.9847853, 'binary_f1_score': 0.9605029}
confusion matrix:
       0      1
0  28350    438
1   1786  27042
---- Validation: 
scalar performance:
{'acc': 0.95234793, 'precision': 0.68254536, 'recall': 0.7506925, 'specificity': 0.7506925, 'f1': 0.71039486, 'auroc': 0.88528967, 'binary_precision': 0.3827292, 'binary_recall': 0.53343236, 'binary_specificity': 0.9679526, 'binary_f1_score': 0.4456859}
confusion matrix:
       0    1
0  17488  579
1    314  359
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9558492, 'precision': 0.734313, 'recall': 0.83719635, 'specificity': 0.83719635, 'f1': 0.7749646, 'auroc': 0.92724717, 'binary_precision': 0.4816754, 'binary_recall': 0.7076923, 'binary_specificity': 0.9667003, 'binary_f1_score': 0.5732087}
confusion matrix:
      0    1
0  5748  198
1    76  184
better model found
persisted
after epoch: 3,now: 2024-08-02 18:03:00.682092,epoch time: 0:34:01.236750,used: 1:44:35.526675,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9664156, 'precision': 0.9666493, 'recall': 0.9664242, 'specificity': 0.9664242, 'f1': 0.9664118, 'auroc': 0.99387854, 'binary_precision': 0.97728485, 'binary_recall': 0.9550815, 'binary_specificity': 0.977767, 'binary_f1_score': 0.96605563}
confusion matrix:
       0      1
0  28146    640
1   1295  27535
---- Validation: 
scalar performance:
{'acc': 0.94743866, 'precision': 0.67086905, 'recall': 0.7717502, 'specificity': 0.7717502, 'f1': 0.70780283, 'auroc': 0.8890015, 'binary_precision': 0.35766423, 'binary_recall': 0.58246654, 'binary_specificity': 0.96103394, 'binary_f1_score': 0.44318822}
confusion matrix:
       0    1
0  17363  704
1    281  392
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9476313, 'precision': 0.70640105, 'recall': 0.83658564, 'specificity': 0.83658564, 'f1': 0.7529868, 'auroc': 0.929656, 'binary_precision': 0.4256293, 'binary_recall': 0.7153846, 'binary_specificity': 0.95778674, 'binary_f1_score': 0.5337159}
confusion matrix:
      0    1
0  5695  251
1    74  186
early stop counter: 1
val acc:0.947438657283783, best validation acc: 0.9523479342460632, corresponding to test acc:                         0.9558491706848145 / 0.9568159580230713
after epoch: 4,now: 2024-08-02 18:38:16.864979,epoch time: 0:35:16.182887,used: 2:19:51.709562,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.967995, 'precision': 0.96826184, 'recall': 0.9680042, 'specificity': 0.9680042, 'f1': 0.9679909, 'auroc': 0.99463356, 'binary_precision': 0.9796317, 'binary_recall': 0.95591396, 'binary_specificity': 0.9800945, 'binary_f1_score': 0.9676275}
confusion matrix:
       0      1
0  28213    573
1   1271  27559
---- Validation: 
scalar performance:
{'acc': 0.9520811, 'precision': 0.6815282, 'recall': 0.7505541, 'specificity': 0.7505541, 'f1': 0.70963395, 'auroc': 0.89173627, 'binary_precision': 0.3806999, 'binary_recall': 0.53343236, 'binary_specificity': 0.96767586, 'binary_f1_score': 0.44430694}
confusion matrix:
       0    1
0  17483  584
1    314  359
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95617145, 'precision': 0.7357077, 'recall': 0.8392035, 'specificity': 0.8392035, 'f1': 0.77660716, 'auroc': 0.93118584, 'binary_precision': 0.4842932, 'binary_recall': 0.71153843, 'binary_specificity': 0.96686846, 'binary_f1_score': 0.576324}
confusion matrix:
      0    1
0  5749  197
1    75  185
early stop counter: 2
val acc:0.9520810842514038, best validation acc: 0.9523479342460632, corresponding to test acc:                         0.9558491706848145 / 0.9568159580230713
after epoch: 5,now: 2024-08-02 19:14:05.276762,epoch time: 0:35:48.411783,used: 2:55:40.121345,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9701472, 'precision': 0.9705355, 'recall': 0.9701583, 'specificity': 0.9701583, 'f1': 0.97014153, 'auroc': 0.99508417, 'binary_precision': 0.9842455, 'binary_recall': 0.9556365, 'binary_specificity': 0.98468006, 'binary_f1_score': 0.96973}
confusion matrix:
       0      1
0  28345    441
1   1279  27551
---- Validation: 
scalar performance:
{'acc': 0.94573104, 'precision': 0.6678569, 'recall': 0.7801631, 'specificity': 0.7801631, 'f1': 0.70741236, 'auroc': 0.8872273, 'binary_precision': 0.3509532, 'binary_recall': 0.60178304, 'binary_specificity': 0.9585432, 'binary_f1_score': 0.44334972}
confusion matrix:
       0    1
0  17318  749
1    268  405
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9479536, 'precision': 0.7083737, 'recall': 0.8441098, 'specificity': 0.8441098, 'f1': 0.7564775, 'auroc': 0.9312259, 'binary_precision': 0.4288939, 'binary_recall': 0.7307692, 'binary_specificity': 0.9574504, 'binary_f1_score': 0.5405405}
confusion matrix:
      0    1
0  5693  253
1    70  190
early stop counter: 3
val acc:0.9457310438156128, best validation acc: 0.9523479342460632, corresponding to test acc:                         0.9558491706848145 / 0.9568159580230713
after epoch: 6,now: 2024-08-02 19:50:32.010143,epoch time: 0:36:26.733381,used: 3:32:06.854726,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_16_18_24_seed_1_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 3:32:06.854726 at 2024-08-02 19:50:32.010143
persisted model performance metric: 

scalar performance:
{'acc': 0.9558492, 'precision': 0.734313, 'recall': 0.83719635, 'specificity': 0.83719635, 'f1': 0.7749646, 'auroc': 0.92724717, 'binary_precision': 0.4816754, 'binary_recall': 0.7076923, 'binary_specificity': 0.9667003, 'binary_f1_score': 0.5732087}
confusion matrix:
      0    1
0  5748  198
1    76  184
oracle model performance metric: 

scalar performance:
{'acc': 0.95681596, 'precision': 0.7369169, 'recall': 0.817472, 'specificity': 0.817472, 'f1': 0.7704011, 'auroc': 0.9155774, 'binary_precision': 0.48870057, 'binary_recall': 0.6653846, 'binary_specificity': 0.9695594, 'binary_f1_score': 0.5635179}
confusion matrix:
      0    1
0  5765  181
1    87  173
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196700 KiB |   2142 MiB | 582706 GiB | 582706 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 575668 GiB | 575668 GiB |
|       from small pool |  17489 KiB |     37 MiB |   7038 GiB |   7038 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196700 KiB |   2142 MiB | 582706 GiB | 582706 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 575668 GiB | 575668 GiB |
|       from small pool |  17489 KiB |     37 MiB |   7038 GiB |   7038 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   2141 MiB | 582636 GiB | 582636 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 575609 GiB | 575609 GiB |
|       from small pool |  16480 KiB |     36 MiB |   7027 GiB |   7027 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2356 MiB |   2372 MiB |   4478 MiB |   2122 MiB |
|       from large pool |   2318 MiB |   2330 MiB |   4422 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     56 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  36772 KiB | 234798 KiB | 314906 GiB | 314906 GiB |
|       from large pool |  31733 KiB | 232384 KiB | 307821 GiB | 307821 GiB |
|       from small pool |   5039 KiB |  19174 KiB |   7085 GiB |   7085 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2974    |    7697    |   87852 K  |   87849 K  |
|       from large pool |      79    |     252    |   52976 K  |   52976 K  |
|       from small pool |    2895    |    7617    |   34875 K  |   34872 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2974    |    7697    |   87852 K  |   87849 K  |
|       from large pool |      79    |     252    |   52976 K  |   52976 K  |
|       from small pool |    2895    |    7617    |   34875 K  |   34872 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     211    |      95    |
|       from large pool |      97    |      97    |     183    |      86    |
|       from small pool |      19    |      21    |      28    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3619    |   56130 K  |   56130 K  |
|       from large pool |      11    |     101    |   40566 K  |   40566 K  |
|       from small pool |      28    |    3608    |   15564 K  |   15563 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 582706 GiB | 582706 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 575668 GiB | 575668 GiB |
|       from small pool |      0 KiB |     37 MiB |   7038 GiB |   7038 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 582706 GiB | 582706 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 575668 GiB | 575668 GiB |
|       from small pool |      0 KiB |     37 MiB |   7038 GiB |   7038 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 582636 GiB | 582636 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 575609 GiB | 575609 GiB |
|       from small pool |      0 KiB |     36 MiB |   7027 GiB |   7027 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 233472 KiB |   2372 MiB |   4478 MiB |   4250 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4422 MiB |   4216 MiB |
|       from small pool |  22528 KiB |     42 MiB |     56 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 314906 GiB | 314906 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 307821 GiB | 307821 GiB |
|       from small pool |      0 KiB |  20054 KiB |   7085 GiB |   7085 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   87852 K  |   87852 K  |
|       from large pool |       2    |     252    |   52976 K  |   52976 K  |
|       from small pool |       0    |    7617    |   34875 K  |   34875 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   87852 K  |   87852 K  |
|       from large pool |       2    |     252    |   52976 K  |   52976 K  |
|       from small pool |       0    |    7617    |   34875 K  |   34875 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     118    |     211    |     190    |
|       from large pool |      10    |      97    |     183    |     173    |
|       from small pool |      11    |      21    |      28    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   56132 K  |   56132 K  |
|       from large pool |       3    |     101    |   40566 K  |   40566 K  |
|       from small pool |       0    |    3608    |   15565 K  |   15565 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 582706 GiB | 582706 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 575668 GiB | 575668 GiB |
|       from small pool |      0 KiB |     37 MiB |   7038 GiB |   7038 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 582706 GiB | 582706 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 575668 GiB | 575668 GiB |
|       from small pool |      0 KiB |     37 MiB |   7038 GiB |   7038 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 582636 GiB | 582636 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 575609 GiB | 575609 GiB |
|       from small pool |      0 KiB |     36 MiB |   7027 GiB |   7027 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 233472 KiB |   2372 MiB |   4478 MiB |   4250 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4422 MiB |   4216 MiB |
|       from small pool |  22528 KiB |     42 MiB |     56 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 314906 GiB | 314906 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 307821 GiB | 307821 GiB |
|       from small pool |      0 KiB |  20054 KiB |   7085 GiB |   7085 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   87852 K  |   87852 K  |
|       from large pool |       2    |     252    |   52976 K  |   52976 K  |
|       from small pool |       0    |    7617    |   34875 K  |   34875 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   87852 K  |   87852 K  |
|       from large pool |       2    |     252    |   52976 K  |   52976 K  |
|       from small pool |       0    |    7617    |   34875 K  |   34875 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     118    |     211    |     190    |
|       from large pool |      10    |      97    |     183    |     173    |
|       from small pool |      11    |      21    |      28    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   56132 K  |   56132 K  |
|       from large pool |       3    |     101    |   40566 K  |   40566 K  |
|       from small pool |       0    |    3608    |   15565 K  |   15565 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583

 Experiment start at: 2024-08-02 19:59:43.880152
before training, model accuracy: 0.10803013294935226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.92002267, 'precision': 0.9260625, 'recall': 0.92003286, 'specificity': 0.92003286, 'f1': 0.9197395, 'auroc': 0.9580622, 'binary_precision': 0.9768338, 'binary_recall': 0.8604795, 'binary_specificity': 0.97958624, 'binary_f1_score': 0.9149724}
confusion matrix:
       0      1
0  28552    595
1   4068  25089
---- Validation: 
scalar performance:
{'acc': 0.9561072, 'precision': 0.5191127, 'recall': 0.50834626, 'specificity': 0.50834626, 'f1': 0.50969976, 'auroc': 0.5752473, 'binary_precision': 0.069767445, 'binary_recall': 0.029900333, 'binary_specificity': 0.98679215, 'binary_f1_score': 0.041860465}
confusion matrix:
       0    1
0  17931  240
1    584   18
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9517551, 'precision': 0.48869202, 'recall': 0.4970636, 'specificity': 0.4970636, 'f1': 0.49093893, 'auroc': 0.558869, 'binary_precision': 0.016393442, 'binary_recall': 0.004132231, 'binary_specificity': 0.989995, 'binary_f1_score': 0.00660066}
confusion matrix:
      0   1
0  5937  60
1   241   1
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 20:38:27.601388,epoch time: 0:38:43.721236,used: 0:38:43.721236,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.93998694, 'precision': 0.94394565, 'recall': 0.93999505, 'specificity': 0.93999505, 'f1': 0.93985367, 'auroc': 0.9741154, 'binary_precision': 0.9859102, 'binary_recall': 0.892753, 'binary_specificity': 0.9872371, 'binary_f1_score': 0.9370219}
confusion matrix:
       0      1
0  28775    372
1   3127  26030
---- Validation: 
scalar performance:
{'acc': 0.964417, 'precision': 0.5922953, 'recall': 0.5182601, 'specificity': 0.5182601, 'f1': 0.52574974, 'auroc': 0.680773, 'binary_precision': 0.21551724, 'binary_recall': 0.04152824, 'binary_specificity': 0.994992, 'binary_f1_score': 0.06963789}
confusion matrix:
       0   1
0  18080  91
1    577  25
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95640326, 'precision': 0.5680642, 'recall': 0.5133607, 'specificity': 0.5133607, 'f1': 0.5166211, 'auroc': 0.68873894, 'binary_precision': 0.17391305, 'binary_recall': 0.03305785, 'binary_specificity': 0.9936635, 'binary_f1_score': 0.055555552}
confusion matrix:
      0   1
0  5959  38
1   234   8
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 21:15:02.305205,epoch time: 0:36:34.703817,used: 1:15:18.425053,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9524218, 'precision': 0.95452225, 'recall': 0.9524276, 'specificity': 0.9524276, 'f1': 0.9523672, 'auroc': 0.9831913, 'binary_precision': 0.9854635, 'binary_recall': 0.91840726, 'binary_specificity': 0.986448, 'binary_f1_score': 0.95075446}
confusion matrix:
       0      1
0  28752    395
1   2379  26778
---- Validation: 
scalar performance:
{'acc': 0.96590847, 'precision': 0.65004003, 'recall': 0.52866715, 'specificity': 0.52866715, 'f1': 0.54313266, 'auroc': 0.7447156, 'binary_precision': 0.33035713, 'binary_recall': 0.061461795, 'binary_specificity': 0.99587256, 'binary_f1_score': 0.10364146}
confusion matrix:
       0   1
0  18096  75
1    565  37
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95832664, 'precision': 0.6641606, 'recall': 0.54608506, 'specificity': 0.54608506, 'f1': 0.56724006, 'auroc': 0.79396755, 'binary_precision': 0.36363637, 'binary_recall': 0.09917355, 'binary_specificity': 0.9929965, 'binary_f1_score': 0.15584417}
confusion matrix:
      0   1
0  5955  42
1   218  24
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-02 21:51:43.629132,epoch time: 0:36:41.323927,used: 1:51:59.748980,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9580818, 'precision': 0.95957863, 'recall': 0.95808667, 'specificity': 0.95808667, 'f1': 0.9580479, 'auroc': 0.9869673, 'binary_precision': 0.9858499, 'binary_recall': 0.9295195, 'binary_specificity': 0.98665386, 'binary_f1_score': 0.95685637}
confusion matrix:
       0      1
0  28758    389
1   2055  27102
---- Validation: 
scalar performance:
{'acc': 0.9647366, 'precision': 0.6742288, 'recall': 0.5714264, 'specificity': 0.5714264, 'f1': 0.5988013, 'auroc': 0.8091608, 'binary_precision': 0.37603307, 'binary_recall': 0.15116279, 'binary_specificity': 0.99169004, 'binary_f1_score': 0.2156398}
confusion matrix:
       0    1
0  18020  151
1    511   91
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95832664, 'precision': 0.7094604, 'recall': 0.6472048, 'specificity': 0.6472048, 'f1': 0.67215455, 'auroc': 0.8474954, 'binary_precision': 0.44642857, 'binary_recall': 0.30991736, 'binary_specificity': 0.98449224, 'binary_f1_score': 0.36585367}
confusion matrix:
      0   1
0  5904  93
1   167  75
early stop counter: 1
val acc:0.9647365808486938, best validation acc: 0.9659084677696228, corresponding to test acc:                         0.9583266377449036 / 0.9583266377449036
after epoch: 4,now: 2024-08-02 22:27:51.725005,epoch time: 0:36:08.095873,used: 2:28:07.844853,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.962301, 'precision': 0.9636868, 'recall': 0.9623057, 'specificity': 0.9623057, 'f1': 0.9622731, 'auroc': 0.9889035, 'binary_precision': 0.98907876, 'binary_recall': 0.93493843, 'binary_specificity': 0.989673, 'binary_f1_score': 0.96124685}
confusion matrix:
       0      1
0  28846    301
1   1897  27260
---- Validation: 
scalar performance:
{'acc': 0.96510947, 'precision': 0.68578297, 'recall': 0.58205867, 'specificity': 0.58205867, 'f1': 0.611582, 'auroc': 0.83633757, 'binary_precision': 0.39846742, 'binary_recall': 0.17275748, 'binary_specificity': 0.99135983, 'binary_f1_score': 0.24101968}
confusion matrix:
       0    1
0  18014  157
1    498  104
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96008974, 'precision': 0.72555685, 'recall': 0.6520874, 'specificity': 0.6520874, 'f1': 0.68075645, 'auroc': 0.8609484, 'binary_precision': 0.47826087, 'binary_recall': 0.3181818, 'binary_specificity': 0.98599297, 'binary_f1_score': 0.382134}
confusion matrix:
      0   1
0  5913  84
1   165  77
new oracle model saved
early stop counter: 2
val acc:0.9651094675064087, best validation acc: 0.9659084677696228, corresponding to test acc:                         0.9583266377449036 / 0.9600897431373596
after epoch: 5,now: 2024-08-02 23:03:28.350574,epoch time: 0:35:36.625569,used: 3:03:44.470422,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.96820116, 'precision': 0.9686259, 'recall': 0.9682037, 'specificity': 0.9682037, 'f1': 0.9681941, 'auroc': 0.99190646, 'binary_precision': 0.98277754, 'binary_recall': 0.9531159, 'binary_specificity': 0.98329157, 'binary_f1_score': 0.9677195}
confusion matrix:
       0      1
0  28660    487
1   1367  27790
---- Validation: 
scalar performance:
{'acc': 0.9643637, 'precision': 0.6920811, 'recall': 0.61861366, 'specificity': 0.61861366, 'f1': 0.64565367, 'auroc': 0.847404, 'binary_precision': 0.40871936, 'binary_recall': 0.24916944, 'binary_specificity': 0.9880579, 'binary_f1_score': 0.30959755}
confusion matrix:
       0    1
0  17954  217
1    452  150
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9552813, 'precision': 0.7026125, 'recall': 0.71303385, 'specificity': 0.71303385, 'f1': 0.7076725, 'auroc': 0.8684763, 'binary_precision': 0.42745098, 'binary_recall': 0.45041323, 'binary_specificity': 0.9756545, 'binary_f1_score': 0.43863177}
confusion matrix:
      0    1
0  5851  146
1   133  109
early stop counter: 3
val acc:0.964363694190979, best validation acc: 0.9659084677696228, corresponding to test acc:                         0.9583266377449036 / 0.9600897431373596
after epoch: 6,now: 2024-08-02 23:39:37.959539,epoch time: 0:36:09.608965,used: 3:39:54.079387,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_19_59_43_seed_2_24046583
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 3:39:54.079387 at 2024-08-02 23:39:37.959539
persisted model performance metric: 

scalar performance:
{'acc': 0.95832664, 'precision': 0.6641606, 'recall': 0.54608506, 'specificity': 0.54608506, 'f1': 0.56724006, 'auroc': 0.79396755, 'binary_precision': 0.36363637, 'binary_recall': 0.09917355, 'binary_specificity': 0.9929965, 'binary_f1_score': 0.15584417}
confusion matrix:
      0   1
0  5955  42
1   218  24
oracle model performance metric: 

scalar performance:
{'acc': 0.96008974, 'precision': 0.72555685, 'recall': 0.6520874, 'specificity': 0.6520874, 'f1': 0.68075645, 'auroc': 0.8609484, 'binary_precision': 0.47826087, 'binary_recall': 0.3181818, 'binary_specificity': 0.98599297, 'binary_f1_score': 0.382134}
confusion matrix:
      0   1
0  5913  84
1   165  77
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196706 KiB |   2142 MiB |    883 TiB |    883 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |  17495 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196706 KiB |   2142 MiB |    883 TiB |    883 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |  17495 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB |    883 TiB |    883 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    872 TiB |    872 TiB |
|       from small pool |  16482 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2356 MiB |   2372 MiB |   6606 MiB |   4250 MiB |
|       from large pool |   2318 MiB |   2330 MiB |   6534 MiB |   4216 MiB |
|       from small pool |     38 MiB |     42 MiB |     72 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  36766 KiB | 234798 KiB | 489403 GiB | 489403 GiB |
|       from large pool |  31733 KiB | 232384 KiB | 478413 GiB | 478413 GiB |
|       from small pool |   5033 KiB |  20054 KiB |  10989 GiB |  10989 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2986    |    7783    |  136295 K  |  136292 K  |
|       from large pool |      79    |     252    |   82220 K  |   82219 K  |
|       from small pool |    2907    |    7703    |   54075 K  |   54072 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2986    |    7783    |  136295 K  |  136292 K  |
|       from large pool |      79    |     252    |   82220 K  |   82219 K  |
|       from small pool |    2907    |    7703    |   54075 K  |   54072 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     306    |     190    |
|       from large pool |      97    |      97    |     270    |     173    |
|       from small pool |      19    |      21    |      36    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3660    |   86884 K  |   86884 K  |
|       from large pool |      11    |     101    |   62694 K  |   62694 K  |
|       from small pool |      29    |    3649    |   24189 K  |   24189 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    883 TiB |    883 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |      0 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    883 TiB |    883 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |      0 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    883 TiB |    883 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    872 TiB |    872 TiB |
|       from small pool |      0 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 233472 KiB |   2372 MiB |   6606 MiB |   6378 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6534 MiB |   6328 MiB |
|       from small pool |  22528 KiB |     42 MiB |     72 MiB |     50 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 489403 GiB | 489403 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 478413 GiB | 478413 GiB |
|       from small pool |      0 KiB |  20054 KiB |  10989 GiB |  10989 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7783    |  136295 K  |  136295 K  |
|       from large pool |       2    |     252    |   82220 K  |   82220 K  |
|       from small pool |       0    |    7703    |   54075 K  |   54075 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7783    |  136295 K  |  136295 K  |
|       from large pool |       2    |     252    |   82220 K  |   82220 K  |
|       from small pool |       0    |    7703    |   54075 K  |   54075 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     118    |     306    |     285    |
|       from large pool |      10    |      97    |     270    |     260    |
|       from small pool |      11    |      21    |      36    |      25    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3660    |   86885 K  |   86885 K  |
|       from large pool |       3    |     101    |   62694 K  |   62694 K  |
|       from small pool |       0    |    3649    |   24191 K  |   24191 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 23:41:04 2024]
Finished job 0.
1 of 1 steps (100%) done
