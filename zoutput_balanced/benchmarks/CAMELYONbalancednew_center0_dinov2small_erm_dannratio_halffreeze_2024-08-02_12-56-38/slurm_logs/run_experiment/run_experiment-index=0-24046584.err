Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 13:00:08 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584

 Experiment start at: 2024-08-02 13:09:04.166357
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9472629, 'precision': 0.9485538, 'recall': 0.94728076, 'specificity': 0.94728076, 'f1': 0.9472264, 'auroc': 0.98535204, 'binary_precision': 0.97278285, 'binary_recall': 0.92034566, 'binary_specificity': 0.9742158, 'binary_f1_score': 0.94583803}
confusion matrix:
       0      1
0  27922    739
1   2286  26413
---- Validation: 
scalar performance:
{'acc': 0.903576, 'precision': 0.59542453, 'recall': 0.7723168, 'specificity': 0.7723168, 'f1': 0.6288103, 'auroc': 0.87808084, 'binary_precision': 0.204947, 'binary_recall': 0.63141525, 'binary_specificity': 0.9132184, 'binary_f1_score': 0.30945122}
confusion matrix:
       0     1
0  16574  1575
1    237   406
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8932566, 'precision': 0.6210998, 'recall': 0.84535944, 'specificity': 0.84535944, 'f1': 0.66210127, 'auroc': 0.91502655, 'binary_precision': 0.25213155, 'binary_recall': 0.79310346, 'binary_specificity': 0.8976155, 'binary_f1_score': 0.38262475}
confusion matrix:
      0    1
0  5383  614
1    54  207
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 13:40:16.503590,epoch time: 0:31:12.337233,used: 0:31:12.337233,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9602685, 'precision': 0.96121967, 'recall': 0.9602868, 'specificity': 0.9602868, 'f1': 0.96024907, 'auroc': 0.99154305, 'binary_precision': 0.98236585, 'binary_recall': 0.9374281, 'binary_specificity': 0.9831455, 'binary_f1_score': 0.95937103}
confusion matrix:
       0      1
0  28174    483
1   1796  26907
---- Validation: 
scalar performance:
{'acc': 0.9086313, 'precision': 0.5988128, 'recall': 0.76743346, 'specificity': 0.76743346, 'f1': 0.6333557, 'auroc': 0.87698054, 'binary_precision': 0.21221864, 'binary_recall': 0.61586314, 'binary_specificity': 0.9190038, 'binary_f1_score': 0.3156636}
confusion matrix:
       0     1
0  16679  1470
1    247   396
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88159156, 'precision': 0.6126806, 'recall': 0.84843475, 'specificity': 0.84843475, 'f1': 0.64933395, 'auroc': 0.9185071, 'binary_precision': 0.23451327, 'binary_recall': 0.8122605, 'binary_specificity': 0.884609, 'binary_f1_score': 0.3639485}
confusion matrix:
      0    1
0  5305  692
1    49  212
better model found
persisted
after epoch: 2,now: 2024-08-02 14:07:06.694364,epoch time: 0:26:50.190774,used: 0:58:02.528007,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9683403, 'precision': 0.96862435, 'recall': 0.96834946, 'specificity': 0.96834946, 'f1': 0.96833587, 'auroc': 0.9941554, 'binary_precision': 0.9803466, 'binary_recall': 0.95589006, 'binary_specificity': 0.9808088, 'binary_f1_score': 0.9679639}
confusion matrix:
       0      1
0  28109    550
1   1266  27435
---- Validation: 
scalar performance:
{'acc': 0.89208174, 'precision': 0.5935915, 'recall': 0.80386883, 'specificity': 0.80386883, 'f1': 0.6258329, 'auroc': 0.8862418, 'binary_precision': 0.19851981, 'binary_recall': 0.70917577, 'binary_specificity': 0.8985619, 'binary_f1_score': 0.3102041}
confusion matrix:
       0     1
0  16308  1841
1    187   456
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84595716, 'precision': 0.592595, 'recall': 0.84633315, 'specificity': 0.84633315, 'f1': 0.6137992, 'auroc': 0.9265015, 'binary_precision': 0.1930131, 'binary_recall': 0.8467433, 'binary_specificity': 0.84592295, 'binary_f1_score': 0.314367}
confusion matrix:
      0    1
0  5073  924
1    40  221
early stop counter: 1
val acc:0.8920817375183105, best validation acc: 0.9086313247680664, corresponding to test acc:                         0.8815915584564209 / 0.8932566046714783
after epoch: 3,now: 2024-08-02 14:37:53.399478,epoch time: 0:30:46.705114,used: 1:28:49.233121,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9742155, 'precision': 0.9744152, 'recall': 0.9742235, 'specificity': 0.9742235, 'f1': 0.97421306, 'auroc': 0.9961463, 'binary_precision': 0.9843433, 'binary_recall': 0.96380043, 'binary_specificity': 0.9846465, 'binary_f1_score': 0.97396356}
confusion matrix:
       0      1
0  28218    440
1   1039  27663
---- Validation: 
scalar performance:
{'acc': 0.8999042, 'precision': 0.59123886, 'recall': 0.76741564, 'specificity': 0.76741564, 'f1': 0.6227715, 'auroc': 0.8759984, 'binary_precision': 0.19686581, 'binary_recall': 0.62519443, 'binary_specificity': 0.9096369, 'binary_f1_score': 0.29944134}
confusion matrix:
       0     1
0  16509  1640
1    241   402
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.872643, 'precision': 0.60386074, 'recall': 0.8346041, 'specificity': 0.8346041, 'f1': 0.6356832, 'auroc': 0.91011405, 'binary_precision': 0.21789473, 'binary_recall': 0.79310346, 'binary_specificity': 0.8761047, 'binary_f1_score': 0.34186623}
confusion matrix:
      0    1
0  5254  743
1    54  207
early stop counter: 2
val acc:0.899904191493988, best validation acc: 0.9086313247680664, corresponding to test acc:                         0.8815915584564209 / 0.8932566046714783
after epoch: 4,now: 2024-08-02 15:03:09.571368,epoch time: 0:25:16.171890,used: 1:54:05.405011,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9781206, 'precision': 0.9783145, 'recall': 0.97812927, 'specificity': 0.97812927, 'f1': 0.97811866, 'auroc': 0.9966271, 'binary_precision': 0.9881558, 'binary_recall': 0.96787906, 'binary_specificity': 0.9883794, 'binary_f1_score': 0.9779123}
confusion matrix:
       0      1
0  28323    333
1    922  27782
---- Validation: 
scalar performance:
{'acc': 0.91719884, 'precision': 0.60492504, 'recall': 0.7561178, 'specificity': 0.7561178, 'f1': 0.6405659, 'auroc': 0.8818023, 'binary_precision': 0.2254961, 'binary_recall': 0.58320373, 'binary_specificity': 0.9290319, 'binary_f1_score': 0.32523853}
confusion matrix:
       0     1
0  16861  1288
1    268   375
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9036433, 'precision': 0.6251664, 'recall': 0.8196292, 'specificity': 0.8196292, 'f1': 0.6671435, 'auroc': 0.90506303, 'binary_precision': 0.2631579, 'binary_recall': 0.72796935, 'binary_specificity': 0.911289, 'binary_f1_score': 0.38657174}
confusion matrix:
      0    1
0  5465  532
1    71  190
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-08-02 15:29:10.618797,epoch time: 0:26:01.047429,used: 2:20:06.452440,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.97770226, 'precision': 0.9780321, 'recall': 0.97771335, 'specificity': 0.97771335, 'f1': 0.9776988, 'auroc': 0.9968535, 'binary_precision': 0.9908014, 'binary_recall': 0.9643952, 'binary_specificity': 0.9910315, 'binary_f1_score': 0.97742003}
confusion matrix:
       0      1
0  28399    257
1   1022  27682
---- Validation: 
scalar performance:
{'acc': 0.93736696, 'precision': 0.6290829, 'recall': 0.7320566, 'specificity': 0.7320566, 'f1': 0.6628295, 'auroc': 0.8839411, 'binary_precision': 0.2760067, 'binary_recall': 0.5116641, 'binary_specificity': 0.95244914, 'binary_f1_score': 0.3585831}
confusion matrix:
       0    1
0  17286  863
1    314  329
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93688077, 'precision': 0.6737068, 'recall': 0.8113185, 'specificity': 0.8113185, 'f1': 0.7188277, 'auroc': 0.9060723, 'binary_precision': 0.3621399, 'binary_recall': 0.6743295, 'binary_specificity': 0.9483075, 'binary_f1_score': 0.4712182}
confusion matrix:
      0    1
0  5687  310
1    85  176
new oracle model saved
better model found
persisted
after epoch: 6,now: 2024-08-02 15:54:48.904258,epoch time: 0:25:38.285461,used: 2:45:44.737901,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.98061365, 'precision': 0.9808062, 'recall': 0.98062253, 'specificity': 0.98062253, 'f1': 0.980612, 'auroc': 0.9975351, 'binary_precision': 0.9906469, 'binary_recall': 0.9704233, 'binary_specificity': 0.99082184, 'binary_f1_score': 0.9804308}
confusion matrix:
       0      1
0  28392    263
1    849  27856
---- Validation: 
scalar performance:
{'acc': 0.93497235, 'precision': 0.62490153, 'recall': 0.7338171, 'specificity': 0.7338171, 'f1': 0.6592604, 'auroc': 0.88051337, 'binary_precision': 0.26746988, 'binary_recall': 0.5178849, 'binary_specificity': 0.9497493, 'binary_f1_score': 0.35275424}
confusion matrix:
       0    1
0  17237  912
1    310  333
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93176734, 'precision': 0.6632631, 'recall': 0.81231517, 'specificity': 0.81231517, 'f1': 0.7091343, 'auroc': 0.9061308, 'binary_precision': 0.34099618, 'binary_recall': 0.68199235, 'binary_specificity': 0.942638, 'binary_f1_score': 0.45466158}
confusion matrix:
      0    1
0  5653  344
1    83  178
early stop counter: 1
val acc:0.93497234582901, best validation acc: 0.9373669624328613, corresponding to test acc:                         0.9368807673454285 / 0.9368807673454285
after epoch: 7,now: 2024-08-02 16:19:56.024352,epoch time: 0:25:07.120094,used: 3:10:51.857995,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9820084, 'precision': 0.9820539, 'recall': 0.9820124, 'specificity': 0.9820124, 'f1': 0.98200804, 'auroc': 0.9976468, 'binary_precision': 0.9869426, 'binary_recall': 0.97697103, 'binary_specificity': 0.98705375, 'binary_f1_score': 0.98193145}
confusion matrix:
       0      1
0  28286    371
1    661  28042
---- Validation: 
scalar performance:
{'acc': 0.9104406, 'precision': 0.6035135, 'recall': 0.779621, 'specificity': 0.779621, 'f1': 0.64008313, 'auroc': 0.8841286, 'binary_precision': 0.2207304, 'binary_recall': 0.63919127, 'binary_specificity': 0.9200507, 'binary_f1_score': 0.32814372}
confusion matrix:
       0     1
0  16698  1451
1    232   411
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9092362, 'precision': 0.6306637, 'recall': 0.8170503, 'specificity': 0.8170503, 'f1': 0.67397606, 'auroc': 0.906206, 'binary_precision': 0.27459618, 'binary_recall': 0.71647507, 'binary_specificity': 0.9176255, 'binary_f1_score': 0.3970276}
confusion matrix:
      0    1
0  5503  494
1    74  187
early stop counter: 2
val acc:0.9104406237602234, best validation acc: 0.9373669624328613, corresponding to test acc:                         0.9368807673454285 / 0.9368807673454285
after epoch: 8,now: 2024-08-02 16:45:05.650163,epoch time: 0:25:09.625811,used: 3:36:01.483806,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.9830718, 'precision': 0.98313487, 'recall': 0.9830766, 'specificity': 0.9830766, 'f1': 0.9830714, 'auroc': 0.9978633, 'binary_precision': 0.9888591, 'binary_recall': 0.97718006, 'binary_specificity': 0.988973, 'binary_f1_score': 0.9829849}
confusion matrix:
       0      1
0  28341    316
1    655  28048
---- Validation: 
scalar performance:
{'acc': 0.92480844, 'precision': 0.61222345, 'recall': 0.74730647, 'specificity': 0.74730647, 'f1': 0.64822733, 'auroc': 0.8801856, 'binary_precision': 0.24091521, 'binary_recall': 0.55676514, 'binary_specificity': 0.9378478, 'binary_f1_score': 0.33630812}
confusion matrix:
       0     1
0  17021  1128
1    285   358
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92186004, 'precision': 0.64550185, 'recall': 0.8089782, 'specificity': 0.8089782, 'f1': 0.69038117, 'auroc': 0.90716046, 'binary_precision': 0.30546075, 'binary_recall': 0.68582374, 'binary_specificity': 0.9321327, 'binary_f1_score': 0.42266825}
confusion matrix:
      0    1
0  5590  407
1    82  179
early stop counter: 3
val acc:0.9248084425926208, best validation acc: 0.9373669624328613, corresponding to test acc:                         0.9368807673454285 / 0.9368807673454285
after epoch: 9,now: 2024-08-02 17:10:16.991400,epoch time: 0:25:11.341237,used: 4:01:12.825043,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_13_09_03_seed_0_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 9 with time: 4:01:12.825043 at 2024-08-02 17:10:16.991400
persisted model performance metric: 

scalar performance:
{'acc': 0.93688077, 'precision': 0.6737068, 'recall': 0.8113185, 'specificity': 0.8113185, 'f1': 0.7188277, 'auroc': 0.9060723, 'binary_precision': 0.3621399, 'binary_recall': 0.6743295, 'binary_specificity': 0.9483075, 'binary_f1_score': 0.4712182}
confusion matrix:
      0    1
0  5687  310
1    85  176
oracle model performance metric: 

scalar performance:
{'acc': 0.93688077, 'precision': 0.6737068, 'recall': 0.8113185, 'specificity': 0.8113185, 'f1': 0.7188277, 'auroc': 0.9060723, 'binary_precision': 0.3621399, 'binary_recall': 0.6743295, 'binary_specificity': 0.9483075, 'binary_f1_score': 0.4712182}
confusion matrix:
      0    1
0  5687  310
1    85  176
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197611 KiB |   1195 MiB | 294453 GiB | 294453 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 290473 GiB | 290472 GiB |
|       from small pool |  17491 KiB |     37 MiB |   3980 GiB |   3980 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197611 KiB |   1195 MiB | 294453 GiB | 294453 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 290473 GiB | 290472 GiB |
|       from small pool |  17491 KiB |     37 MiB |   3980 GiB |   3980 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   1193 MiB | 294444 GiB | 294444 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 290471 GiB | 290471 GiB |
|       from small pool |  16482 KiB |     36 MiB |   3972 GiB |   3972 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1346 MiB |   1346 MiB |   1346 MiB |      0 B   |
|       from large pool |   1304 MiB |   1304 MiB |   1304 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  62485 KiB | 161596 KiB | 147968 GiB | 147968 GiB |
|       from large pool |  51304 KiB | 160090 KiB | 143972 GiB | 143972 GiB |
|       from small pool |  11181 KiB |  12282 KiB |   3995 GiB |   3995 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2978    |    7645    |   50461 K  |   50458 K  |
|       from large pool |      79    |     167    |   27112 K  |   27112 K  |
|       from small pool |    2899    |    7565    |   23348 K  |   23346 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2978    |    7645    |   50461 K  |   50458 K  |
|       from large pool |      79    |     167    |   27112 K  |   27112 K  |
|       from small pool |    2899    |    7565    |   23348 K  |   23346 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      76    |      76    |      76    |       0    |
|       from large pool |      55    |      55    |      55    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3604    |   30287 K  |   30287 K  |
|       from large pool |       9    |      57    |   19234 K  |   19234 K  |
|       from small pool |      23    |    3595    |   11053 K  |   11052 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 294453 GiB | 294453 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 290473 GiB | 290473 GiB |
|       from small pool |      0 KiB |     37 MiB |   3980 GiB |   3980 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 294453 GiB | 294453 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 290473 GiB | 290473 GiB |
|       from small pool |      0 KiB |     37 MiB |   3980 GiB |   3980 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 294444 GiB | 294444 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 290471 GiB | 290471 GiB |
|       from small pool |      0 KiB |     36 MiB |   3972 GiB |   3972 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 260096 KiB |   1346 MiB |   1346 MiB |   1092 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  28672 KiB |     42 MiB |     42 MiB |     14 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 147968 GiB | 147968 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 143972 GiB | 143972 GiB |
|       from small pool |      0 KiB |  20339 KiB |   3995 GiB |   3995 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   50461 K  |   50461 K  |
|       from large pool |       2    |     167    |   27112 K  |   27112 K  |
|       from small pool |       0    |    7565    |   23348 K  |   23348 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   50461 K  |   50461 K  |
|       from large pool |       2    |     167    |   27112 K  |   27112 K  |
|       from small pool |       0    |    7565    |   23348 K  |   23348 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      25    |      76    |      76    |      51    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      14    |      21    |      21    |       7    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3604    |   30288 K  |   30288 K  |
|       from large pool |       3    |      57    |   19234 K  |   19234 K  |
|       from small pool |       0    |    3595    |   11054 K  |   11054 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 294453 GiB | 294453 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 290473 GiB | 290473 GiB |
|       from small pool |      0 KiB |     37 MiB |   3980 GiB |   3980 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 294453 GiB | 294453 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 290473 GiB | 290473 GiB |
|       from small pool |      0 KiB |     37 MiB |   3980 GiB |   3980 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 294444 GiB | 294444 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 290471 GiB | 290471 GiB |
|       from small pool |      0 KiB |     36 MiB |   3972 GiB |   3972 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 260096 KiB |   1346 MiB |   1346 MiB |   1092 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  28672 KiB |     42 MiB |     42 MiB |     14 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 147968 GiB | 147968 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 143972 GiB | 143972 GiB |
|       from small pool |      0 KiB |  20339 KiB |   3995 GiB |   3995 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   50461 K  |   50461 K  |
|       from large pool |       2    |     167    |   27112 K  |   27112 K  |
|       from small pool |       0    |    7565    |   23348 K  |   23348 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   50461 K  |   50461 K  |
|       from large pool |       2    |     167    |   27112 K  |   27112 K  |
|       from small pool |       0    |    7565    |   23348 K  |   23348 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      25    |      76    |      76    |      51    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      14    |      21    |      21    |       7    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3604    |   30288 K  |   30288 K  |
|       from large pool |       3    |      57    |   19234 K  |   19234 K  |
|       from small pool |       0    |    3595    |   11054 K  |   11054 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_17_17_57_seed_1_24046584

 Experiment start at: 2024-08-02 17:17:57.645827
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9486775, 'precision': 0.94993603, 'recall': 0.94869685, 'specificity': 0.94869685, 'f1': 0.9486431, 'auroc': 0.986922, 'binary_precision': 0.9739156, 'binary_recall': 0.922127, 'binary_specificity': 0.97526664, 'binary_f1_score': 0.947314}
confusion matrix:
       0      1
0  28075    712
1   2245  26584
---- Validation: 
scalar performance:
{'acc': 0.93479186, 'precision': 0.63914734, 'recall': 0.7659066, 'specificity': 0.7659066, 'f1': 0.6784922, 'auroc': 0.8769657, 'binary_precision': 0.29438204, 'binary_recall': 0.5839524, 'binary_specificity': 0.9478607, 'binary_f1_score': 0.39143425}
confusion matrix:
       0    1
0  17125  942
1    280  393
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93764096, 'precision': 0.6785119, 'recall': 0.82401615, 'specificity': 0.82401615, 'f1': 0.7257498, 'auroc': 0.9213958, 'binary_precision': 0.3706721, 'binary_recall': 0.7, 'binary_specificity': 0.9480323, 'binary_f1_score': 0.4846871}
confusion matrix:
      0    1
0  5637  309
1    78  182
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 17:43:43.939205,epoch time: 0:25:46.293378,used: 0:25:46.293378,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_17_17_57_seed_1_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96225005, 'precision': 0.9625114, 'recall': 0.9622593, 'specificity': 0.9622593, 'f1': 0.9622452, 'auroc': 0.9925969, 'binary_precision': 0.97369826, 'binary_recall': 0.9502255, 'binary_specificity': 0.97429305, 'binary_f1_score': 0.9618187}
confusion matrix:
       0      1
0  28046    740
1   1435  27395
---- Validation: 
scalar performance:
{'acc': 0.9216649, 'precision': 0.6302779, 'recall': 0.8177505, 'specificity': 0.8177505, 'f1': 0.675509, 'auroc': 0.89329135, 'binary_precision': 0.2722063, 'binary_recall': 0.70579493, 'binary_specificity': 0.9297061, 'binary_f1_score': 0.3928867}
confusion matrix:
       0     1
0  16797  1270
1    198   475
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9002578, 'precision': 0.63209486, 'recall': 0.8651938, 'specificity': 0.8651938, 'f1': 0.6777196, 'auroc': 0.93295884, 'binary_precision': 0.27249682, 'binary_recall': 0.8269231, 'binary_specificity': 0.9034645, 'binary_f1_score': 0.40991423}
confusion matrix:
      0    1
0  5372  574
1    45  215
early stop counter: 1
val acc:0.9216648936271667, best validation acc: 0.9347918629646301, corresponding to test acc:                         0.9376409649848938 / 0.9376409649848938
after epoch: 2,now: 2024-08-02 18:08:56.854832,epoch time: 0:25:12.915627,used: 0:50:59.209005,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_17_17_57_seed_1_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96816856, 'precision': 0.96821344, 'recall': 0.96817225, 'specificity': 0.96817225, 'f1': 0.968168, 'auroc': 0.99466205, 'binary_precision': 0.97298247, 'binary_recall': 0.96312743, 'binary_specificity': 0.97321707, 'binary_f1_score': 0.9680299}
confusion matrix:
       0      1
0  28016    771
1   1063  27766
---- Validation: 
scalar performance:
{'acc': 0.91408753, 'precision': 0.6248373, 'recall': 0.835994, 'specificity': 0.835994, 'f1': 0.66988873, 'auroc': 0.89803654, 'binary_precision': 0.2596203, 'binary_recall': 0.75185734, 'binary_specificity': 0.9201306, 'binary_f1_score': 0.38596487}
confusion matrix:
       0     1
0  16624  1443
1    167   506
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87705445, 'precision': 0.6132247, 'recall': 0.86411875, 'specificity': 0.86411875, 'f1': 0.6493613, 'auroc': 0.9354323, 'binary_precision': 0.23386243, 'binary_recall': 0.85, 'binary_specificity': 0.8782375, 'binary_f1_score': 0.366805}
confusion matrix:
      0    1
0  5222  724
1    39  221
early stop counter: 2
val acc:0.9140875339508057, best validation acc: 0.9347918629646301, corresponding to test acc:                         0.9376409649848938 / 0.9376409649848938
after epoch: 3,now: 2024-08-02 18:34:36.658024,epoch time: 0:25:39.803192,used: 1:16:39.012197,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_17_17_57_seed_1_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9701472, 'precision': 0.97016793, 'recall': 0.9701498, 'specificity': 0.9701498, 'f1': 0.97014695, 'auroc': 0.9954449, 'binary_precision': 0.9734875, 'binary_recall': 0.96666664, 'binary_specificity': 0.973633, 'binary_f1_score': 0.9700651}
confusion matrix:
       0      1
0  28027    759
1    961  27869
---- Validation: 
scalar performance:
{'acc': 0.9090715, 'precision': 0.6202029, 'recall': 0.8398299, 'specificity': 0.8398299, 'f1': 0.6638479, 'auroc': 0.89805067, 'binary_precision': 0.2498787, 'binary_recall': 0.7652303, 'binary_specificity': 0.9144296, 'binary_f1_score': 0.37673736}
confusion matrix:
       0     1
0  16521  1546
1    158   515
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8677087, 'precision': 0.6067946, 'recall': 0.8610805, 'specificity': 0.8610805, 'f1': 0.63866806, 'auroc': 0.93477255, 'binary_precision': 0.22089553, 'binary_recall': 0.85384613, 'binary_specificity': 0.86831486, 'binary_f1_score': 0.35098818}
confusion matrix:
      0    1
0  5163  783
1    38  222
early stop counter: 3
val acc:0.9090715050697327, best validation acc: 0.9347918629646301, corresponding to test acc:                         0.9376409649848938 / 0.9376409649848938
after epoch: 4,now: 2024-08-02 19:00:23.967473,epoch time: 0:25:47.309449,used: 1:42:26.321646,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_17_17_57_seed_1_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:42:26.321646 at 2024-08-02 19:00:23.967473
persisted model performance metric: 

scalar performance:
{'acc': 0.93764096, 'precision': 0.6785119, 'recall': 0.82401615, 'specificity': 0.82401615, 'f1': 0.7257498, 'auroc': 0.9213958, 'binary_precision': 0.3706721, 'binary_recall': 0.7, 'binary_specificity': 0.9480323, 'binary_f1_score': 0.4846871}
confusion matrix:
      0    1
0  5637  309
1    78  182
oracle model performance metric: 

scalar performance:
{'acc': 0.93764096, 'precision': 0.6785119, 'recall': 0.82401615, 'specificity': 0.82401615, 'f1': 0.7257498, 'auroc': 0.9213958, 'binary_precision': 0.3706721, 'binary_recall': 0.7, 'binary_specificity': 0.9480323, 'binary_f1_score': 0.4846871}
confusion matrix:
      0    1
0  5637  309
1    78  182
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196690 KiB |   1195 MiB | 427323 GiB | 427322 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 421537 GiB | 421536 GiB |
|       from small pool |  17479 KiB |     37 MiB |   5785 GiB |   5785 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196690 KiB |   1195 MiB | 427323 GiB | 427322 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 421537 GiB | 421536 GiB |
|       from small pool |  17479 KiB |     37 MiB |   5785 GiB |   5785 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   1193 MiB | 427307 GiB | 427306 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 421532 GiB | 421532 GiB |
|       from small pool |  16480 KiB |     36 MiB |   5774 GiB |   5774 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   2428 MiB |   1092 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   2376 MiB |   1078 MiB |
|       from small pool |     38 MiB |     42 MiB |     52 MiB |     14 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40878 KiB | 161596 KiB | 220285 GiB | 220285 GiB |
|       from large pool |  31733 KiB | 160090 KiB | 214422 GiB | 214422 GiB |
|       from small pool |   9145 KiB |  20339 KiB |   5863 GiB |   5863 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7677    |   73296 K  |   73294 K  |
|       from large pool |      79    |     167    |   39352 K  |   39352 K  |
|       from small pool |    2875    |    7597    |   33944 K  |   33941 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7677    |   73296 K  |   73294 K  |
|       from large pool |      79    |     167    |   39352 K  |   39352 K  |
|       from small pool |    2875    |    7597    |   33944 K  |   33941 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     125    |      51    |
|       from large pool |      55    |      55    |      99    |      44    |
|       from small pool |      19    |      21    |      26    |       7    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3619    |   45371 K  |   45371 K  |
|       from large pool |      10    |      59    |   28421 K  |   28421 K  |
|       from small pool |      21    |    3609    |   16949 K  |   16949 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 427323 GiB | 427323 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 421537 GiB | 421537 GiB |
|       from small pool |      0 KiB |     37 MiB |   5785 GiB |   5785 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 427323 GiB | 427323 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 421537 GiB | 421537 GiB |
|       from small pool |      0 KiB |     37 MiB |   5785 GiB |   5785 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 427307 GiB | 427307 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 421532 GiB | 421532 GiB |
|       from small pool |      0 KiB |     36 MiB |   5774 GiB |   5774 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1346 MiB |   2428 MiB |   2196 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   2376 MiB |   2170 MiB |
|       from small pool |  26624 KiB |     42 MiB |     52 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 220286 GiB | 220285 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 214422 GiB | 214422 GiB |
|       from small pool |      0 KiB |  23501 KiB |   5863 GiB |   5863 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |   73296 K  |   73296 K  |
|       from large pool |       2    |     167    |   39352 K  |   39352 K  |
|       from small pool |       0    |    7597    |   33944 K  |   33944 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |   73296 K  |   73296 K  |
|       from large pool |       2    |     167    |   39352 K  |   39352 K  |
|       from small pool |       0    |    7597    |   33944 K  |   33944 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     125    |     102    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      13    |      21    |      26    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   45372 K  |   45372 K  |
|       from large pool |       3    |      59    |   28421 K  |   28421 K  |
|       from small pool |       0    |    3609    |   16951 K  |   16951 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 427323 GiB | 427323 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 421537 GiB | 421537 GiB |
|       from small pool |      0 KiB |     37 MiB |   5785 GiB |   5785 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 427323 GiB | 427323 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 421537 GiB | 421537 GiB |
|       from small pool |      0 KiB |     37 MiB |   5785 GiB |   5785 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 427307 GiB | 427307 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 421532 GiB | 421532 GiB |
|       from small pool |      0 KiB |     36 MiB |   5774 GiB |   5774 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1346 MiB |   2428 MiB |   2196 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   2376 MiB |   2170 MiB |
|       from small pool |  26624 KiB |     42 MiB |     52 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 220286 GiB | 220285 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 214422 GiB | 214422 GiB |
|       from small pool |      0 KiB |  23501 KiB |   5863 GiB |   5863 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |   73296 K  |   73296 K  |
|       from large pool |       2    |     167    |   39352 K  |   39352 K  |
|       from small pool |       0    |    7597    |   33944 K  |   33944 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |   73296 K  |   73296 K  |
|       from large pool |       2    |     167    |   39352 K  |   39352 K  |
|       from small pool |       0    |    7597    |   33944 K  |   33944 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     125    |     102    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      13    |      21    |      26    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   45372 K  |   45372 K  |
|       from large pool |       3    |      59    |   28421 K  |   28421 K  |
|       from small pool |       0    |    3609    |   16951 K  |   16951 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_19_08_08_seed_2_24046584

 Experiment start at: 2024-08-02 19:08:08.603799
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94813395, 'precision': 0.94995344, 'recall': 0.9481394, 'specificity': 0.9481394, 'f1': 0.9480819, 'auroc': 0.9871085, 'binary_precision': 0.97860885, 'binary_recall': 0.91631514, 'binary_specificity': 0.97996366, 'binary_f1_score': 0.9464381}
confusion matrix:
       0      1
0  28563    584
1   2440  26717
---- Validation: 
scalar performance:
{'acc': 0.94055295, 'precision': 0.6281796, 'recall': 0.73399854, 'specificity': 0.73399854, 'f1': 0.6626193, 'auroc': 0.8519943, 'binary_precision': 0.2729682, 'binary_recall': 0.51328903, 'binary_specificity': 0.95470804, 'binary_f1_score': 0.35640135}
confusion matrix:
       0    1
0  17348  823
1    293  309
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9132874, 'precision': 0.62568104, 'recall': 0.8081713, 'specificity': 0.8081713, 'f1': 0.6682452, 'auroc': 0.8799558, 'binary_precision': 0.26456693, 'binary_recall': 0.6942149, 'binary_specificity': 0.9221277, 'binary_f1_score': 0.3831243}
confusion matrix:
      0    1
0  5530  467
1    74  168
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 19:34:24.674858,epoch time: 0:26:16.071059,used: 0:26:16.071059,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_19_08_08_seed_2_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96353596, 'precision': 0.96391904, 'recall': 0.9635384, 'specificity': 0.9635384, 'f1': 0.9635286, 'auroc': 0.99243295, 'binary_precision': 0.9772928, 'binary_recall': 0.94913745, 'binary_specificity': 0.9779394, 'binary_f1_score': 0.96300936}
confusion matrix:
       0      1
0  28504    643
1   1483  27674
---- Validation: 
scalar performance:
{'acc': 0.9254781, 'precision': 0.6130416, 'recall': 0.7727882, 'specificity': 0.7727882, 'f1': 0.65230554, 'auroc': 0.86869466, 'binary_precision': 0.23971261, 'binary_recall': 0.6096346, 'binary_specificity': 0.9359419, 'binary_f1_score': 0.3441163}
confusion matrix:
       0     1
0  17007  1164
1    235   367
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.885238, 'precision': 0.6092901, 'recall': 0.8510802, 'specificity': 0.8510802, 'f1': 0.6459856, 'auroc': 0.91040564, 'binary_precision': 0.22695853, 'binary_recall': 0.8140496, 'binary_specificity': 0.8881107, 'binary_f1_score': 0.354955}
confusion matrix:
      0    1
0  5326  671
1    45  197
early stop counter: 1
val acc:0.9254781007766724, best validation acc: 0.9405529499053955, corresponding to test acc:                         0.9132874011993408 / 0.9132874011993408
after epoch: 2,now: 2024-08-02 19:59:57.742963,epoch time: 0:25:33.068105,used: 0:51:49.139164,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_19_08_08_seed_2_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9699163, 'precision': 0.9702037, 'recall': 0.96991926, 'specificity': 0.96991926, 'f1': 0.9699118, 'auroc': 0.99488294, 'binary_precision': 0.98188853, 'binary_recall': 0.9575088, 'binary_specificity': 0.9823297, 'binary_f1_score': 0.9695454}
confusion matrix:
       0      1
0  28630    515
1   1239  27920
---- Validation: 
scalar performance:
{'acc': 0.93559897, 'precision': 0.6270903, 'recall': 0.7659706, 'specificity': 0.7659706, 'f1': 0.6670396, 'auroc': 0.87596613, 'binary_precision': 0.26849732, 'binary_recall': 0.58471763, 'binary_specificity': 0.9472236, 'binary_f1_score': 0.36800835}
confusion matrix:
       0    1
0  17212  959
1    250  352
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9115243, 'precision': 0.6334087, 'recall': 0.85285723, 'specificity': 0.85285723, 'f1': 0.68058825, 'auroc': 0.91660774, 'binary_precision': 0.27601156, 'binary_recall': 0.7892562, 'binary_specificity': 0.91645825, 'binary_f1_score': 0.40899354}
confusion matrix:
      0    1
0  5496  501
1    51  191
early stop counter: 2
val acc:0.9355989694595337, best validation acc: 0.9405529499053955, corresponding to test acc:                         0.9132874011993408 / 0.9132874011993408
after epoch: 3,now: 2024-08-02 20:25:41.421506,epoch time: 0:25:43.678543,used: 1:17:32.817707,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_19_08_08_seed_2_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.972146, 'precision': 0.9725146, 'recall': 0.97214985, 'specificity': 0.97214985, 'f1': 0.97214067, 'auroc': 0.99589515, 'binary_precision': 0.98578084, 'binary_recall': 0.95812756, 'binary_specificity': 0.98617214, 'binary_f1_score': 0.9717575}
confusion matrix:
       0      1
0  28741    403
1   1221  27939
---- Validation: 
scalar performance:
{'acc': 0.9365578, 'precision': 0.63235766, 'recall': 0.78011775, 'specificity': 0.78011775, 'f1': 0.6745713, 'auroc': 0.88943, 'binary_precision': 0.27807084, 'binary_recall': 0.6129568, 'binary_specificity': 0.9472786, 'binary_f1_score': 0.38258162}
confusion matrix:
       0    1
0  17213  958
1    233  369
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91376823, 'precision': 0.635031, 'recall': 0.8480762, 'specificity': 0.8480762, 'f1': 0.6824274, 'auroc': 0.91938734, 'binary_precision': 0.2797619, 'binary_recall': 0.7768595, 'binary_specificity': 0.919293, 'binary_f1_score': 0.41137856}
confusion matrix:
      0    1
0  5513  484
1    54  188
new oracle model saved
early stop counter: 3
val acc:0.9365578293800354, best validation acc: 0.9405529499053955, corresponding to test acc:                         0.9132874011993408 / 0.9137682318687439
after epoch: 4,now: 2024-08-02 20:51:18.972538,epoch time: 0:25:37.551032,used: 1:43:10.368739,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_02_19_08_08_seed_2_24046584
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:43:10.368739 at 2024-08-02 20:51:18.972538
persisted model performance metric: 

scalar performance:
{'acc': 0.9132874, 'precision': 0.62568104, 'recall': 0.8081713, 'specificity': 0.8081713, 'f1': 0.6682452, 'auroc': 0.8799558, 'binary_precision': 0.26456693, 'binary_recall': 0.6942149, 'binary_specificity': 0.9221277, 'binary_f1_score': 0.3831243}
confusion matrix:
      0    1
0  5530  467
1    74  168
oracle model performance metric: 

scalar performance:
{'acc': 0.91376823, 'precision': 0.635031, 'recall': 0.8480762, 'specificity': 0.8480762, 'f1': 0.6824274, 'auroc': 0.91938734, 'binary_precision': 0.2797619, 'binary_recall': 0.7768595, 'binary_specificity': 0.919293, 'binary_f1_score': 0.41137856}
confusion matrix:
      0    1
0  5513  484
1    54  188
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_halffreeze_2024-08-02_12-56-38/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196696 KiB |   1195 MiB | 561620 GiB | 561620 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 554010 GiB | 554010 GiB |
|       from small pool |  17485 KiB |     37 MiB |   7609 GiB |   7609 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196696 KiB |   1195 MiB | 561620 GiB | 561620 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 554010 GiB | 554010 GiB |
|       from small pool |  17485 KiB |     37 MiB |   7609 GiB |   7609 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195460 KiB |   1193 MiB | 561597 GiB | 561597 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 554002 GiB | 554002 GiB |
|       from small pool |  16481 KiB |     36 MiB |   7594 GiB |   7594 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   3532 MiB |   2196 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   3468 MiB |   2170 MiB |
|       from small pool |     38 MiB |     42 MiB |     64 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40872 KiB | 161596 KiB | 293317 GiB | 293317 GiB |
|       from large pool |  31733 KiB | 160090 KiB | 285616 GiB | 285615 GiB |
|       from small pool |   9139 KiB |  23501 KiB |   7701 GiB |   7701 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7763    |   96364 K  |   96361 K  |
|       from large pool |      79    |     167    |   51723 K  |   51723 K  |
|       from small pool |    2887    |    7683    |   44640 K  |   44637 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7763    |   96364 K  |   96361 K  |
|       from large pool |      79    |     167    |   51723 K  |   51723 K  |
|       from small pool |    2887    |    7683    |   44640 K  |   44637 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     176    |     102    |
|       from large pool |      55    |      55    |     144    |      89    |
|       from small pool |      19    |      21    |      32    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3662    |   59805 K  |   59805 K  |
|       from large pool |      10    |      59    |   37709 K  |   37709 K  |
|       from small pool |      22    |    3652    |   22095 K  |   22095 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 561620 GiB | 561620 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 554010 GiB | 554010 GiB |
|       from small pool |      0 KiB |     37 MiB |   7609 GiB |   7609 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 561620 GiB | 561620 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 554010 GiB | 554010 GiB |
|       from small pool |      0 KiB |     37 MiB |   7609 GiB |   7609 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 561597 GiB | 561597 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 554002 GiB | 554002 GiB |
|       from small pool |      0 KiB |     36 MiB |   7594 GiB |   7594 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1346 MiB |   3532 MiB |   3300 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   3468 MiB |   3262 MiB |
|       from small pool |  26624 KiB |     42 MiB |     64 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 293318 GiB | 293318 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 285616 GiB | 285616 GiB |
|       from small pool |      0 KiB |  23501 KiB |   7701 GiB |   7701 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7763    |   96364 K  |   96364 K  |
|       from large pool |       2    |     167    |   51723 K  |   51723 K  |
|       from small pool |       0    |    7683    |   44640 K  |   44640 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7763    |   96364 K  |   96364 K  |
|       from large pool |       2    |     167    |   51723 K  |   51723 K  |
|       from small pool |       0    |    7683    |   44640 K  |   44640 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     176    |     153    |
|       from large pool |      10    |      55    |     144    |     134    |
|       from small pool |      13    |      21    |      32    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3662    |   59806 K  |   59806 K  |
|       from large pool |       3    |      59    |   37709 K  |   37709 K  |
|       from small pool |       0    |    3652    |   22097 K  |   22097 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 20:52:38 2024]
Finished job 0.
1 of 1 steps (100%) done
