Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  8 19:43:10 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079

 Experiment start at: 2024-08-08 19:53:53.047395
before training, model accuracy: 0.6631401777267456
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.95390475, 'precision': 0.9552138, 'recall': 0.9539207, 'specificity': 0.9539207, 'f1': 0.9538727, 'auroc': 0.9859659, 'binary_precision': 0.9797731, 'binary_recall': 0.92700154, 'binary_specificity': 0.9808399, 'binary_f1_score': 0.95265704}
confusion matrix:
       0      1
0  24828    485
1   1850  23493
---- Validation: 
scalar performance:
{'acc': 0.88790387, 'precision': 0.5691775, 'recall': 0.8180187, 'specificity': 0.8180187, 'f1': 0.5913877, 'auroc': 0.8883629, 'binary_precision': 0.14541176, 'binary_recall': 0.7445783, 'binary_specificity': 0.891459, 'binary_f1_score': 0.24330708}
confusion matrix:
       0     1
0  14915  1816
1    106   309
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7726913, 'precision': 0.601195, 'recall': 0.78486085, 'specificity': 0.78486085, 'f1': 0.6057862, 'auroc': 0.85360336, 'binary_precision': 0.22346976, 'binary_recall': 0.7992228, 'binary_specificity': 0.7704988, 'binary_f1_score': 0.34927824}
confusion matrix:
      0     1
0  7198  2144
1   155   617
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 20:18:16.827506,epoch time: 0:24:23.780111,used: 0:24:23.780111,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.964328, 'precision': 0.96482664, 'recall': 0.9643384, 'specificity': 0.9643384, 'f1': 0.964319, 'auroc': 0.99183625, 'binary_precision': 0.9802097, 'binary_recall': 0.94783777, 'binary_specificity': 0.98083913, 'binary_f1_score': 0.963752}
confusion matrix:
       0      1
0  24827    485
1   1322  24022
---- Validation: 
scalar performance:
{'acc': 0.89082, 'precision': 0.57393456, 'recall': 0.83713686, 'specificity': 0.83713686, 'f1': 0.59911156, 'auroc': 0.9069253, 'binary_precision': 0.15391923, 'binary_recall': 0.7807229, 'binary_specificity': 0.8935509, 'binary_f1_score': 0.25714287}
confusion matrix:
       0     1
0  14950  1781
1     91   324
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8131303, 'precision': 0.6173959, 'recall': 0.7930858, 'specificity': 0.7930858, 'f1': 0.63788044, 'auroc': 0.8669188, 'binary_precision': 0.2575889, 'binary_recall': 0.76943004, 'binary_specificity': 0.8167416, 'binary_f1_score': 0.38596493}
confusion matrix:
      0     1
0  7630  1712
1   178   594
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 20:42:19.570157,epoch time: 0:24:02.742651,used: 0:48:26.522762,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9702503, 'precision': 0.9707233, 'recall': 0.9702585, 'specificity': 0.9702585, 'f1': 0.9702432, 'auroc': 0.9944406, 'binary_precision': 0.9857737, 'binary_recall': 0.9543033, 'binary_specificity': 0.9862137, 'binary_f1_score': 0.96978325}
confusion matrix:
       0      1
0  24966    349
1   1158  24183
---- Validation: 
scalar performance:
{'acc': 0.92208093, 'precision': 0.59676766, 'recall': 0.83435607, 'specificity': 0.83435607, 'f1': 0.6371314, 'auroc': 0.9142188, 'binary_precision': 0.20039037, 'binary_recall': 0.74216866, 'binary_specificity': 0.92654353, 'binary_f1_score': 0.31557378}
confusion matrix:
       0     1
0  15502  1229
1    107   308
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86533517, 'precision': 0.6428115, 'recall': 0.77084285, 'specificity': 0.77084285, 'f1': 0.67571, 'auroc': 0.87417746, 'binary_precision': 0.3165423, 'binary_recall': 0.65932643, 'binary_specificity': 0.88235927, 'binary_f1_score': 0.42773113}
confusion matrix:
      0     1
0  8243  1099
1   263   509
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-08 21:06:32.100364,epoch time: 0:24:12.530207,used: 1:12:39.052969,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9744552, 'precision': 0.97465086, 'recall': 0.9744617, 'specificity': 0.9744617, 'f1': 0.97445273, 'auroc': 0.99521613, 'binary_precision': 0.98444927, 'binary_recall': 0.96417296, 'binary_specificity': 0.98475033, 'binary_f1_score': 0.9742056}
confusion matrix:
       0      1
0  24926    386
1    908  24436
---- Validation: 
scalar performance:
{'acc': 0.8949026, 'precision': 0.5779891, 'recall': 0.84745336, 'specificity': 0.84745336, 'f1': 0.606026, 'auroc': 0.91571087, 'binary_precision': 0.16154222, 'binary_recall': 0.7975904, 'binary_specificity': 0.89731634, 'binary_f1_score': 0.26866883}
confusion matrix:
       0     1
0  15013  1718
1     84   331
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.85821635, 'precision': 0.63710034, 'recall': 0.7711483, 'specificity': 0.7711483, 'f1': 0.6688787, 'auroc': 0.87010276, 'binary_precision': 0.3046045, 'binary_recall': 0.6683938, 'binary_specificity': 0.8739028, 'binary_f1_score': 0.4184915}
confusion matrix:
      0     1
0  8164  1178
1   256   516
early stop counter: 1
val acc:0.8949025869369507, best validation acc: 0.922080934047699, corresponding to test acc:                         0.8653351664543152 / 0.8653351664543152
after epoch: 4,now: 2024-08-08 21:30:45.511101,epoch time: 0:24:13.410737,used: 1:36:52.463706,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97702146, 'precision': 0.9770856, 'recall': 0.9770245, 'specificity': 0.9770245, 'f1': 0.9770208, 'auroc': 0.99626553, 'binary_precision': 0.98274827, 'binary_recall': 0.971114, 'binary_specificity': 0.982935, 'binary_f1_score': 0.9768965}
confusion matrix:
       0      1
0  24883    432
1    732  24609
---- Validation: 
scalar performance:
{'acc': 0.8936195, 'precision': 0.57712704, 'recall': 0.8467959, 'specificity': 0.8467959, 'f1': 0.6044718, 'auroc': 0.91521406, 'binary_precision': 0.15982617, 'binary_recall': 0.7975904, 'binary_specificity': 0.89600146, 'binary_f1_score': 0.26629123}
confusion matrix:
       0     1
0  14991  1740
1     84   331
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8551513, 'precision': 0.63430715, 'recall': 0.7694891, 'specificity': 0.7694891, 'f1': 0.66533613, 'auroc': 0.8675084, 'binary_precision': 0.29913044, 'binary_recall': 0.6683938, 'binary_specificity': 0.8705844, 'binary_f1_score': 0.41329595}
confusion matrix:
      0     1
0  8133  1209
1   256   516
early stop counter: 2
val acc:0.8936194777488708, best validation acc: 0.922080934047699, corresponding to test acc:                         0.8653351664543152 / 0.8653351664543152
after epoch: 5,now: 2024-08-08 21:54:26.761057,epoch time: 0:23:41.249956,used: 2:00:33.713662,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9790351, 'precision': 0.9793305, 'recall': 0.97904253, 'specificity': 0.97904253, 'f1': 0.9790321, 'auroc': 0.99685913, 'binary_precision': 0.99137896, 'binary_recall': 0.9664996, 'binary_specificity': 0.9915854, 'binary_f1_score': 0.9787812}
confusion matrix:
       0      1
0  25100    213
1    849  24494
---- Validation: 
scalar performance:
{'acc': 0.91589874, 'precision': 0.59204185, 'recall': 0.8405878, 'specificity': 0.8405878, 'f1': 0.6299838, 'auroc': 0.9180124, 'binary_precision': 0.1904762, 'binary_recall': 0.76144576, 'binary_specificity': 0.9197298, 'binary_f1_score': 0.30472517}
confusion matrix:
       0     1
0  15388  1343
1     99   316
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8736405, 'precision': 0.6468283, 'recall': 0.7581084, 'specificity': 0.7581084, 'f1': 0.67895746, 'auroc': 0.86533177, 'binary_precision': 0.32742155, 'binary_recall': 0.6217617, 'binary_specificity': 0.89445513, 'binary_f1_score': 0.42895442}
confusion matrix:
      0    1
0  8356  986
1   292  480
new oracle model saved
early stop counter: 3
val acc:0.9158987402915955, best validation acc: 0.922080934047699, corresponding to test acc:                         0.8653351664543152 / 0.8736404776573181
after epoch: 6,now: 2024-08-08 22:17:49.496372,epoch time: 0:23:22.735315,used: 2:23:56.448977,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_19_53_52_seed_0_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 2:23:56.448977 at 2024-08-08 22:17:49.496372
persisted model performance metric: 

scalar performance:
{'acc': 0.86533517, 'precision': 0.6428115, 'recall': 0.77084285, 'specificity': 0.77084285, 'f1': 0.67571, 'auroc': 0.87417746, 'binary_precision': 0.3165423, 'binary_recall': 0.65932643, 'binary_specificity': 0.88235927, 'binary_f1_score': 0.42773113}
confusion matrix:
      0     1
0  8243  1099
1   263   509
oracle model performance metric: 

scalar performance:
{'acc': 0.8736405, 'precision': 0.6468283, 'recall': 0.7581084, 'specificity': 0.7581084, 'f1': 0.67895746, 'auroc': 0.86533177, 'binary_precision': 0.32742155, 'binary_recall': 0.6217617, 'binary_specificity': 0.89445513, 'binary_f1_score': 0.42895442}
confusion matrix:
      0    1
0  8356  986
1   292  480
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198334 KiB |   1195 MiB | 192675 GiB | 192675 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 189935 GiB | 189935 GiB |
|       from small pool |  18214 KiB |     38 MiB |   2740 GiB |   2740 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198334 KiB |   1195 MiB | 192675 GiB | 192675 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 189935 GiB | 189935 GiB |
|       from small pool |  18214 KiB |     38 MiB |   2740 GiB |   2740 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   1193 MiB | 192669 GiB | 192669 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 189934 GiB | 189934 GiB |
|       from small pool |  16663 KiB |     36 MiB |   2735 GiB |   2735 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1346 MiB |   1346 MiB |   1346 MiB |      0 B   |
|       from large pool |   1304 MiB |   1304 MiB |   1304 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  63810 KiB | 168489 KiB |  97480 GiB |  97480 GiB |
|       from large pool |  51304 KiB | 166786 KiB |  94726 GiB |  94726 GiB |
|       from small pool |  12506 KiB |  12756 KiB |   2753 GiB |   2753 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4424    |    6807    |   33222 K  |   33218 K  |
|       from large pool |      79    |     167    |   17827 K  |   17827 K  |
|       from small pool |    4345    |    6727    |   15395 K  |   15390 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4424    |    6807    |   33222 K  |   33218 K  |
|       from large pool |      79    |     167    |   17827 K  |   17827 K  |
|       from small pool |    4345    |    6727    |   15395 K  |   15390 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      76    |      76    |      76    |       0    |
|       from large pool |      55    |      55    |      55    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      34    |    3186    |   18985 K  |   18985 K  |
|       from large pool |       9    |      57    |   12402 K  |   12402 K  |
|       from small pool |      25    |    3177    |    6583 K  |    6583 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 192675 GiB | 192675 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 189935 GiB | 189935 GiB |
|       from small pool |      0 KiB |     38 MiB |   2740 GiB |   2740 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 192675 GiB | 192675 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 189935 GiB | 189935 GiB |
|       from small pool |      0 KiB |     38 MiB |   2740 GiB |   2740 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 192669 GiB | 192669 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 189934 GiB | 189934 GiB |
|       from small pool |      0 KiB |     36 MiB |   2735 GiB |   2735 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   1346 MiB |   1346 MiB |   1090 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB |  97480 GiB |  97480 GiB |
|       from large pool |  30464 KiB | 166786 KiB |  94726 GiB |  94726 GiB |
|       from small pool |      0 KiB |  23712 KiB |   2753 GiB |   2753 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   33222 K  |   33222 K  |
|       from large pool |       2    |     167    |   17827 K  |   17827 K  |
|       from small pool |       0    |    6727    |   15395 K  |   15395 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   33222 K  |   33222 K  |
|       from large pool |       2    |     167    |   17827 K  |   17827 K  |
|       from small pool |       0    |    6727    |   15395 K  |   15395 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |      76    |      76    |      50    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3186    |   18987 K  |   18987 K  |
|       from large pool |       3    |      57    |   12402 K  |   12402 K  |
|       from small pool |       0    |    3177    |    6585 K  |    6585 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 192675 GiB | 192675 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 189935 GiB | 189935 GiB |
|       from small pool |      0 KiB |     38 MiB |   2740 GiB |   2740 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 192675 GiB | 192675 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 189935 GiB | 189935 GiB |
|       from small pool |      0 KiB |     38 MiB |   2740 GiB |   2740 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 192669 GiB | 192669 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 189934 GiB | 189934 GiB |
|       from small pool |      0 KiB |     36 MiB |   2735 GiB |   2735 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   1346 MiB |   1346 MiB |   1090 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB |  97480 GiB |  97480 GiB |
|       from large pool |  30464 KiB | 166786 KiB |  94726 GiB |  94726 GiB |
|       from small pool |      0 KiB |  23712 KiB |   2753 GiB |   2753 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   33222 K  |   33222 K  |
|       from large pool |       2    |     167    |   17827 K  |   17827 K  |
|       from small pool |       0    |    6727    |   15395 K  |   15395 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   33222 K  |   33222 K  |
|       from large pool |       2    |     167    |   17827 K  |   17827 K  |
|       from small pool |       0    |    6727    |   15395 K  |   15395 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |      76    |      76    |      50    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3186    |   18987 K  |   18987 K  |
|       from large pool |       3    |      57    |   12402 K  |   12402 K  |
|       from small pool |       0    |    3177    |    6585 K  |    6585 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_22_37_21_seed_1_24116079

 Experiment start at: 2024-08-08 22:37:21.510649
before training, model accuracy: 0.5408779978752136
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9458215, 'precision': 0.9474653, 'recall': 0.9458419, 'specificity': 0.9458419, 'f1': 0.94577336, 'auroc': 0.9853468, 'binary_precision': 0.97475404, 'binary_recall': 0.9154248, 'binary_specificity': 0.97625893, 'binary_f1_score': 0.94415826}
confusion matrix:
       0      1
0  24796    603
1   2151  23282
---- Validation: 
scalar performance:
{'acc': 0.94434386, 'precision': 0.609974, 'recall': 0.74090517, 'specificity': 0.74090517, 'f1': 0.646826, 'auroc': 0.87548983, 'binary_precision': 0.23258197, 'binary_recall': 0.52668214, 'binary_specificity': 0.9551282, 'binary_f1_score': 0.32267237}
confusion matrix:
       0    1
0  15943  749
1    204  227
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88167673, 'precision': 0.64363694, 'recall': 0.72604096, 'specificity': 0.72604096, 'f1': 0.6710054, 'auroc': 0.865047, 'binary_precision': 0.32644957, 'binary_recall': 0.5429326, 'binary_specificity': 0.90914935, 'binary_f1_score': 0.4077381}
confusion matrix:
      0    1
0  8486  848
1   346  411
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 23:01:54.175219,epoch time: 0:24:32.664570,used: 0:24:32.664570,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_22_37_21_seed_1_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9609498, 'precision': 0.96189505, 'recall': 0.9609677, 'specificity': 0.9609677, 'f1': 0.9609308, 'auroc': 0.991851, 'binary_precision': 0.982988, 'binary_recall': 0.93819785, 'binary_specificity': 0.9837376, 'binary_f1_score': 0.9600708}
confusion matrix:
       0      1
0  24983    413
1   1572  23864
---- Validation: 
scalar performance:
{'acc': 0.9441103, 'precision': 0.6203076, 'recall': 0.7837306, 'specificity': 0.7837306, 'f1': 0.6636045, 'auroc': 0.8861113, 'binary_precision': 0.25094697, 'binary_recall': 0.6148492, 'binary_specificity': 0.95261204, 'binary_f1_score': 0.35642233}
confusion matrix:
       0    1
0  15901  791
1    166  265
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8773164, 'precision': 0.6620822, 'recall': 0.80926174, 'specificity': 0.80926174, 'f1': 0.70099866, 'auroc': 0.89418554, 'binary_precision': 0.348265, 'binary_recall': 0.72919416, 'binary_specificity': 0.8893293, 'binary_f1_score': 0.471392}
confusion matrix:
      0     1
0  8301  1033
1   205   552
early stop counter: 1
val acc:0.9441102743148804, best validation acc: 0.9443438649177551, corresponding to test acc:                         0.8816767334938049 / 0.8816767334938049
after epoch: 2,now: 2024-08-08 23:25:14.679812,epoch time: 0:23:20.504593,used: 0:47:53.169163,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_22_37_21_seed_1_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9678549, 'precision': 0.9684755, 'recall': 0.9678686, 'specificity': 0.9678686, 'f1': 0.96784496, 'auroc': 0.9941645, 'binary_precision': 0.98571485, 'binary_recall': 0.9495184, 'binary_specificity': 0.98621887, 'binary_f1_score': 0.9672781}
confusion matrix:
       0      1
0  25047    350
1   1284  24151
---- Validation: 
scalar performance:
{'acc': 0.93061966, 'precision': 0.6075597, 'recall': 0.82201666, 'specificity': 0.82201666, 'f1': 0.65132666, 'auroc': 0.8873246, 'binary_precision': 0.22311631, 'binary_recall': 0.7076566, 'binary_specificity': 0.9363767, 'binary_f1_score': 0.33926588}
confusion matrix:
       0     1
0  15630  1062
1    126   305
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8519473, 'precision': 0.64973897, 'recall': 0.8422824, 'specificity': 0.8422824, 'f1': 0.6857039, 'auroc': 0.90407395, 'binary_precision': 0.31528822, 'binary_recall': 0.8309115, 'binary_specificity': 0.8536533, 'binary_f1_score': 0.4571221}
confusion matrix:
      0     1
0  7968  1366
1   128   629
early stop counter: 2
val acc:0.9306196570396423, best validation acc: 0.9443438649177551, corresponding to test acc:                         0.8816767334938049 / 0.8816767334938049
after epoch: 3,now: 2024-08-08 23:48:52.742365,epoch time: 0:23:38.062553,used: 1:11:31.231716,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_22_37_21_seed_1_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97399276, 'precision': 0.97418517, 'recall': 0.9740012, 'specificity': 0.9740012, 'f1': 0.97399044, 'auroc': 0.9955931, 'binary_precision': 0.9839454, 'binary_recall': 0.9637536, 'binary_specificity': 0.9842489, 'binary_f1_score': 0.9737448}
confusion matrix:
       0      1
0  24995    400
1    922  24515
---- Validation: 
scalar performance:
{'acc': 0.9216259, 'precision': 0.59690803, 'recall': 0.8207941, 'specificity': 0.8207941, 'f1': 0.6365217, 'auroc': 0.8877314, 'binary_precision': 0.20170268, 'binary_recall': 0.7146172, 'binary_specificity': 0.926971, 'binary_f1_score': 0.31460673}
confusion matrix:
       0     1
0  15473  1219
1    123   308
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8502626, 'precision': 0.6491537, 'recall': 0.8444064, 'specificity': 0.8444064, 'f1': 0.68472755, 'auroc': 0.902336, 'binary_precision': 0.31355095, 'binary_recall': 0.8375165, 'binary_specificity': 0.85129637, 'binary_f1_score': 0.45627922}
confusion matrix:
      0     1
0  7946  1388
1   123   634
early stop counter: 3
val acc:0.9216259121894836, best validation acc: 0.9443438649177551, corresponding to test acc:                         0.8816767334938049 / 0.8816767334938049
after epoch: 4,now: 2024-08-09 00:12:49.409025,epoch time: 0:23:56.666660,used: 1:35:27.898376,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_22_37_21_seed_1_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:35:27.898376 at 2024-08-09 00:12:49.409025
persisted model performance metric: 

scalar performance:
{'acc': 0.88167673, 'precision': 0.64363694, 'recall': 0.72604096, 'specificity': 0.72604096, 'f1': 0.6710054, 'auroc': 0.865047, 'binary_precision': 0.32644957, 'binary_recall': 0.5429326, 'binary_specificity': 0.90914935, 'binary_f1_score': 0.4077381}
confusion matrix:
      0    1
0  8486  848
1   346  411
oracle model performance metric: 

scalar performance:
{'acc': 0.88167673, 'precision': 0.64363694, 'recall': 0.72604096, 'specificity': 0.72604096, 'f1': 0.6710054, 'auroc': 0.865047, 'binary_precision': 0.32644957, 'binary_recall': 0.5429326, 'binary_specificity': 0.90914935, 'binary_f1_score': 0.4077381}
confusion matrix:
      0    1
0  8486  848
1   346  411
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197423 KiB |   1195 MiB | 326903 GiB | 326903 GiB |
|       from large pool | 179215 KiB |   1178 MiB | 322221 GiB | 322221 GiB |
|       from small pool |  18208 KiB |     38 MiB |   4681 GiB |   4681 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197423 KiB |   1195 MiB | 326903 GiB | 326903 GiB |
|       from large pool | 179215 KiB |   1178 MiB | 322221 GiB | 322221 GiB |
|       from small pool |  18208 KiB |     38 MiB |   4681 GiB |   4681 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   1193 MiB | 326893 GiB | 326893 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 322220 GiB | 322219 GiB |
|       from small pool |  16662 KiB |     36 MiB |   4673 GiB |   4673 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   2426 MiB |   1090 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   2376 MiB |   1078 MiB |
|       from small pool |     38 MiB |     42 MiB |     50 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  48336 KiB | 168489 KiB | 171616 GiB | 171616 GiB |
|       from large pool |  37872 KiB | 166786 KiB | 166858 GiB | 166858 GiB |
|       from small pool |  10464 KiB |  23712 KiB |   4758 GiB |   4758 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6829    |   56307 K  |   56302 K  |
|       from large pool |      79    |     167    |   30268 K  |   30268 K  |
|       from small pool |    4333    |    6749    |   26038 K  |   26033 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6829    |   56307 K  |   56302 K  |
|       from large pool |      79    |     167    |   30268 K  |   30268 K  |
|       from small pool |    4333    |    6749    |   26038 K  |   26033 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     124    |      50    |
|       from large pool |      55    |      55    |      99    |      44    |
|       from small pool |      19    |      21    |      25    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3196    |   34056 K  |   34056 K  |
|       from large pool |      11    |      58    |   21534 K  |   21534 K  |
|       from small pool |      21    |    3185    |   12521 K  |   12521 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 326903 GiB | 326903 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 322221 GiB | 322221 GiB |
|       from small pool |      0 KiB |     38 MiB |   4681 GiB |   4681 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 326903 GiB | 326903 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 322221 GiB | 322221 GiB |
|       from small pool |      0 KiB |     38 MiB |   4681 GiB |   4681 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 326893 GiB | 326893 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 322220 GiB | 322220 GiB |
|       from small pool |      0 KiB |     36 MiB |   4673 GiB |   4673 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 245760 KiB |   1346 MiB |   2426 MiB |   2186 MiB |
|       from large pool | 217088 KiB |   1304 MiB |   2376 MiB |   2164 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 171617 GiB | 171617 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 166858 GiB | 166858 GiB |
|       from small pool |      0 KiB |  25471 KiB |   4758 GiB |   4758 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |   56307 K  |   56307 K  |
|       from large pool |       2    |     167    |   30268 K  |   30268 K  |
|       from small pool |       0    |    6749    |   26038 K  |   26038 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |   56307 K  |   56307 K  |
|       from large pool |       2    |     167    |   30268 K  |   30268 K  |
|       from small pool |       0    |    6749    |   26038 K  |   26038 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     124    |     100    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3196    |   34058 K  |   34058 K  |
|       from large pool |       3    |      58    |   21534 K  |   21534 K  |
|       from small pool |       0    |    3185    |   12523 K  |   12523 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 326903 GiB | 326903 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 322221 GiB | 322221 GiB |
|       from small pool |      0 KiB |     38 MiB |   4681 GiB |   4681 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 326903 GiB | 326903 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 322221 GiB | 322221 GiB |
|       from small pool |      0 KiB |     38 MiB |   4681 GiB |   4681 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 326893 GiB | 326893 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 322220 GiB | 322220 GiB |
|       from small pool |      0 KiB |     36 MiB |   4673 GiB |   4673 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 245760 KiB |   1346 MiB |   2426 MiB |   2186 MiB |
|       from large pool | 217088 KiB |   1304 MiB |   2376 MiB |   2164 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 171617 GiB | 171617 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 166858 GiB | 166858 GiB |
|       from small pool |      0 KiB |  25471 KiB |   4758 GiB |   4758 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |   56307 K  |   56307 K  |
|       from large pool |       2    |     167    |   30268 K  |   30268 K  |
|       from small pool |       0    |    6749    |   26038 K  |   26038 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |   56307 K  |   56307 K  |
|       from large pool |       2    |     167    |   30268 K  |   30268 K  |
|       from small pool |       0    |    6749    |   26038 K  |   26038 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     124    |     100    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3196    |   34058 K  |   34058 K  |
|       from large pool |       3    |      58    |   21534 K  |   21534 K  |
|       from small pool |       0    |    3185    |   12523 K  |   12523 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_00_35_13_seed_2_24116079

 Experiment start at: 2024-08-09 00:35:14.024128
before training, model accuracy: 0.8581054210662842
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94810045, 'precision': 0.950506, 'recall': 0.9481075, 'specificity': 0.9481075, 'f1': 0.9480316, 'auroc': 0.9862201, 'binary_precision': 0.98347384, 'binary_recall': 0.9115383, 'binary_specificity': 0.9846767, 'binary_f1_score': 0.9461407}
confusion matrix:
       0      1
0  25447    396
1   2287  23566
---- Validation: 
scalar performance:
{'acc': 0.9450479, 'precision': 0.5992226, 'recall': 0.7094318, 'specificity': 0.7094318, 'f1': 0.63114905, 'auroc': 0.8335763, 'binary_precision': 0.21232124, 'binary_recall': 0.4617225, 'binary_specificity': 0.95714116, 'binary_f1_score': 0.2908817}
confusion matrix:
       0    1
0  15990  716
1    225  193
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89892983, 'precision': 0.67186594, 'recall': 0.71111923, 'specificity': 0.71111923, 'f1': 0.688613, 'auroc': 0.86358094, 'binary_precision': 0.38861138, 'binary_recall': 0.4880803, 'binary_specificity': 0.93415815, 'binary_f1_score': 0.432703}
confusion matrix:
      0    1
0  8683  612
1   408  389
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-09 00:59:43.214076,epoch time: 0:24:29.189948,used: 0:24:29.189948,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_00_35_13_seed_2_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96198934, 'precision': 0.96292055, 'recall': 0.9619963, 'specificity': 0.9619963, 'f1': 0.9619706, 'auroc': 0.99207675, 'binary_precision': 0.9837606, 'binary_recall': 0.9395111, 'binary_specificity': 0.98448145, 'binary_f1_score': 0.96112686}
confusion matrix:
       0      1
0  25439    401
1   1564  24292
---- Validation: 
scalar performance:
{'acc': 0.9300981, 'precision': 0.5891493, 'recall': 0.7542509, 'specificity': 0.7542509, 'f1': 0.62388647, 'auroc': 0.84748185, 'binary_precision': 0.18964143, 'binary_recall': 0.569378, 'binary_specificity': 0.9391237, 'binary_f1_score': 0.28451884}
confusion matrix:
       0     1
0  15689  1017
1    180   238
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8977408, 'precision': 0.6744439, 'recall': 0.7282541, 'specificity': 0.7282541, 'f1': 0.69618076, 'auroc': 0.875852, 'binary_precision': 0.3906977, 'binary_recall': 0.52697617, 'binary_specificity': 0.929532, 'binary_f1_score': 0.44871798}
confusion matrix:
      0    1
0  8640  655
1   377  420
early stop counter: 1
val acc:0.9300981163978577, best validation acc: 0.945047914981842, corresponding to test acc:                         0.8989298343658447 / 0.8989298343658447
after epoch: 2,now: 2024-08-09 01:23:56.520047,epoch time: 0:24:13.305971,used: 0:48:42.495919,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_00_35_13_seed_2_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9704232, 'precision': 0.97077954, 'recall': 0.97042537, 'specificity': 0.97042537, 'f1': 0.97041774, 'auroc': 0.99453735, 'binary_precision': 0.98377025, 'binary_recall': 0.9566378, 'binary_specificity': 0.984213, 'binary_f1_score': 0.97001433}
confusion matrix:
       0      1
0  25436    408
1   1121  24731
---- Validation: 
scalar performance:
{'acc': 0.91392195, 'precision': 0.57368404, 'recall': 0.7541241, 'specificity': 0.7541241, 'f1': 0.6019168, 'auroc': 0.84455943, 'binary_precision': 0.15847348, 'binary_recall': 0.5861244, 'binary_specificity': 0.9221238, 'binary_f1_score': 0.24949083}
confusion matrix:
       0     1
0  15405  1301
1    173   245
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9019025, 'precision': 0.6822006, 'recall': 0.72936624, 'specificity': 0.72936624, 'f1': 0.701952, 'auroc': 0.874395, 'binary_precision': 0.40621963, 'binary_recall': 0.52446675, 'binary_specificity': 0.93426573, 'binary_f1_score': 0.45783135}
confusion matrix:
      0    1
0  8684  611
1   379  418
new oracle model saved
early stop counter: 2
val acc:0.9139219522476196, best validation acc: 0.945047914981842, corresponding to test acc:                         0.8989298343658447 / 0.9019024968147278
after epoch: 3,now: 2024-08-09 01:47:24.678212,epoch time: 0:23:28.158165,used: 1:12:10.654084,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_00_35_13_seed_2_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9728025, 'precision': 0.9733633, 'recall': 0.97280586, 'specificity': 0.97280586, 'f1': 0.9727946, 'auroc': 0.9962323, 'binary_precision': 0.98970395, 'binary_recall': 0.9555564, 'binary_specificity': 0.9900553, 'binary_f1_score': 0.97233045}
confusion matrix:
       0      1
0  25586    257
1   1149  24704
---- Validation: 
scalar performance:
{'acc': 0.93681383, 'precision': 0.59846884, 'recall': 0.75652647, 'specificity': 0.75652647, 'f1': 0.63576525, 'auroc': 0.8558432, 'binary_precision': 0.2082601, 'binary_recall': 0.56698567, 'binary_specificity': 0.9460673, 'binary_f1_score': 0.30462724}
confusion matrix:
       0    1
0  15805  901
1    181  237
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9062624, 'precision': 0.6907353, 'recall': 0.7288653, 'specificity': 0.7288653, 'f1': 0.7073802, 'auroc': 0.8837825, 'binary_precision': 0.42358974, 'binary_recall': 0.51819324, 'binary_specificity': 0.9395374, 'binary_f1_score': 0.46613997}
confusion matrix:
      0    1
0  8733  562
1   384  413
new oracle model saved
early stop counter: 3
val acc:0.9368138313293457, best validation acc: 0.945047914981842, corresponding to test acc:                         0.8989298343658447 / 0.9062623977661133
after epoch: 4,now: 2024-08-09 02:10:56.379740,epoch time: 0:23:31.701528,used: 1:35:42.355612,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_09_00_35_13_seed_2_24116079
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:35:42.355612 at 2024-08-09 02:10:56.379740
persisted model performance metric: 

scalar performance:
{'acc': 0.89892983, 'precision': 0.67186594, 'recall': 0.71111923, 'specificity': 0.71111923, 'f1': 0.688613, 'auroc': 0.86358094, 'binary_precision': 0.38861138, 'binary_recall': 0.4880803, 'binary_specificity': 0.93415815, 'binary_f1_score': 0.432703}
confusion matrix:
      0    1
0  8683  612
1   408  389
oracle model performance metric: 

scalar performance:
{'acc': 0.9062624, 'precision': 0.6907353, 'recall': 0.7288653, 'specificity': 0.7288653, 'f1': 0.7073802, 'auroc': 0.8837825, 'binary_precision': 0.42358974, 'binary_recall': 0.51819324, 'binary_specificity': 0.9395374, 'binary_f1_score': 0.46613997}
confusion matrix:
      0    1
0  8733  562
1   384  413
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_irm_highregularization_2024-08-08_00-44-32/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197419 KiB |   1195 MiB | 462992 GiB | 462992 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 456345 GiB | 456345 GiB |
|       from small pool |  18208 KiB |     38 MiB |   6647 GiB |   6647 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197419 KiB |   1195 MiB | 462992 GiB | 462992 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 456345 GiB | 456345 GiB |
|       from small pool |  18208 KiB |     38 MiB |   6647 GiB |   6647 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   1193 MiB | 462973 GiB | 462973 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 456338 GiB | 456337 GiB |
|       from small pool |  16662 KiB |     36 MiB |   6635 GiB |   6635 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1328 MiB |   1346 MiB |   3514 MiB |   2186 MiB |
|       from large pool |   1290 MiB |   1304 MiB |   3454 MiB |   2164 MiB |
|       from small pool |     38 MiB |     42 MiB |     60 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42197 KiB | 168489 KiB | 251889 GiB | 251889 GiB |
|       from large pool |  31733 KiB | 166786 KiB | 245101 GiB | 245101 GiB |
|       from small pool |  10464 KiB |  25471 KiB |   6788 GiB |   6788 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6937    |   79684 K  |   79680 K  |
|       from large pool |      79    |     167    |   42880 K  |   42880 K  |
|       from small pool |    4333    |    6857    |   36803 K  |   36799 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6937    |   79684 K  |   79680 K  |
|       from large pool |      79    |     167    |   42880 K  |   42880 K  |
|       from small pool |    4333    |    6857    |   36803 K  |   36799 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      73    |      76    |     173    |     100    |
|       from large pool |      54    |      55    |     143    |      89    |
|       from small pool |      19    |      21    |      30    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3250    |   48623 K  |   48623 K  |
|       from large pool |      11    |      58    |   30099 K  |   30099 K  |
|       from small pool |      21    |    3239    |   18524 K  |   18524 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 462992 GiB | 462992 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 456345 GiB | 456345 GiB |
|       from small pool |      0 KiB |     38 MiB |   6647 GiB |   6647 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 462992 GiB | 462992 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 456345 GiB | 456345 GiB |
|       from small pool |      0 KiB |     38 MiB |   6647 GiB |   6647 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 462973 GiB | 462973 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 456338 GiB | 456338 GiB |
|       from small pool |      0 KiB |     36 MiB |   6635 GiB |   6635 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   1346 MiB |   3514 MiB |   3280 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   3454 MiB |   3248 MiB |
|       from small pool |  28672 KiB |     42 MiB |     60 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 251889 GiB | 251889 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 245101 GiB | 245101 GiB |
|       from small pool |      0 KiB |  25471 KiB |   6788 GiB |   6788 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6937    |   79684 K  |   79684 K  |
|       from large pool |       2    |     167    |   42880 K  |   42880 K  |
|       from small pool |       0    |    6857    |   36803 K  |   36803 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6937    |   79684 K  |   79684 K  |
|       from large pool |       2    |     167    |   42880 K  |   42880 K  |
|       from small pool |       0    |    6857    |   36803 K  |   36803 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     173    |     149    |
|       from large pool |      10    |      55    |     143    |     133    |
|       from small pool |      14    |      21    |      30    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3250    |   48625 K  |   48625 K  |
|       from large pool |       3    |      58    |   30099 K  |   30099 K  |
|       from small pool |       0    |    3239    |   18526 K  |   18526 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  9 02:24:16 2024]
Finished job 0.
1 of 1 steps (100%) done
