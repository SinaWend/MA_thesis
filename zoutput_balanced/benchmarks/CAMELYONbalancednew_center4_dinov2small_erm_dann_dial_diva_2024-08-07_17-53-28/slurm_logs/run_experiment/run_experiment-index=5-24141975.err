Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sun Aug 11 00:21:34 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/5.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=5
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_00_28_43_seed_0_24141975

 Experiment start at: 2024-08-11 00:28:45.080191
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.9236701726913452
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.95822805, 'precision': 0.95907456, 'recall': 0.95824, 'specificity': 0.95824, 'f1': 0.9582095, 'auroc': 0.9910313, 'binary_precision': 0.9789261, 'binary_recall': 0.9366664, 'binary_specificity': 0.9798135, 'binary_f1_score': 0.9573301}
confusion matrix:
       0      1
0  24803    511
1   1605  23737
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9568996, 'precision': 0.6322495, 'recall': 0.72765416, 'specificity': 0.72765416, 'f1': 0.6655812, 'auroc': 0.8677118, 'binary_precision': 0.27747253, 'binary_recall': 0.486747, 'binary_specificity': 0.96856135, 'binary_f1_score': 0.35345584}
confusion matrix:
       0    1
0  16205  526
1    213  202
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9009294, 'precision': 0.6925678, 'recall': 0.8067467, 'specificity': 0.8067467, 'f1': 0.7310702, 'auroc': 0.8933297, 'binary_precision': 0.4118098, 'binary_recall': 0.69559586, 'binary_specificity': 0.91789764, 'binary_f1_score': 0.517341}
confusion matrix:
      0    1
0  8575  767
1   235  537
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-11 01:05:10.829352,epoch time: 0:36:25.749161,used: 0:36:25.749161,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_00_28_43_seed_0_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97254026, 'precision': 0.9726995, 'recall': 0.9725465, 'specificity': 0.9725465, 'f1': 0.9725382, 'auroc': 0.9955369, 'binary_precision': 0.9815455, 'binary_recall': 0.96322745, 'binary_specificity': 0.9818656, 'binary_f1_score': 0.9723002}
confusion matrix:
       0      1
0  24852    459
1    932  24413
---- Validation: 
scalar performance:
{'acc': 0.9500175, 'precision': 0.617455, 'recall': 0.74057686, 'specificity': 0.74057686, 'f1': 0.65458804, 'auroc': 0.8747751, 'binary_precision': 0.24713959, 'binary_recall': 0.52048194, 'binary_specificity': 0.9606718, 'binary_f1_score': 0.33514354}
confusion matrix:
       0    1
0  16073  658
1    199  216
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87304723, 'precision': 0.66485345, 'recall': 0.82849073, 'specificity': 0.82849073, 'f1': 0.7051605, 'auroc': 0.8894353, 'binary_precision': 0.35029238, 'binary_recall': 0.77590674, 'binary_specificity': 0.8810747, 'binary_f1_score': 0.48267525}
confusion matrix:
      0     1
0  8231  1111
1   173   599
early stop counter: 1
val acc:0.950017511844635, best validation acc: 0.9568995833396912, corresponding to test acc:                         0.9009293913841248 / 0.9009293913841248
after epoch: 2,now: 2024-08-11 01:40:44.485630,epoch time: 0:35:33.656278,used: 1:11:59.405439,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_00_28_43_seed_0_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97396165, 'precision': 0.974153, 'recall': 0.97396684, 'specificity': 0.97396684, 'f1': 0.9739592, 'auroc': 0.995741, 'binary_precision': 0.9838073, 'binary_recall': 0.9638136, 'binary_specificity': 0.9841201, 'binary_f1_score': 0.9737079}
confusion matrix:
       0      1
0  24913    402
1    917  24424
---- Validation: 
scalar performance:
{'acc': 0.9415607, 'precision': 0.61260253, 'recall': 0.78794074, 'specificity': 0.78794074, 'f1': 0.65553945, 'auroc': 0.8798491, 'binary_precision': 0.23486902, 'binary_recall': 0.62650603, 'binary_specificity': 0.9493754, 'binary_f1_score': 0.3416557}
confusion matrix:
       0    1
0  15884  847
1    155  260
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8583152, 'precision': 0.6569349, 'recall': 0.8454702, 'specificity': 0.8454702, 'f1': 0.6951833, 'auroc': 0.90201986, 'binary_precision': 0.3299022, 'binary_recall': 0.8303109, 'binary_specificity': 0.86062944, 'binary_f1_score': 0.4721915}
confusion matrix:
      0     1
0  8040  1302
1   131   641
early stop counter: 2
val acc:0.941560685634613, best validation acc: 0.9568995833396912, corresponding to test acc:                         0.9009293913841248 / 0.9009293913841248
after epoch: 3,now: 2024-08-11 02:16:19.941781,epoch time: 0:35:35.456151,used: 1:47:34.861590,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_00_28_43_seed_0_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9752843, 'precision': 0.9754406, 'recall': 0.9752908, 'specificity': 0.9752908, 'f1': 0.97528255, 'auroc': 0.99635434, 'binary_precision': 0.9842431, 'binary_recall': 0.9660696, 'binary_specificity': 0.98451203, 'binary_f1_score': 0.9750717}
confusion matrix:
       0      1
0  24918    392
1    860  24486
---- Validation: 
scalar performance:
{'acc': 0.94541, 'precision': 0.6153267, 'recall': 0.7699392, 'specificity': 0.7699392, 'f1': 0.65664816, 'auroc': 0.87822294, 'binary_precision': 0.24131082, 'binary_recall': 0.58554214, 'binary_specificity': 0.9543363, 'binary_f1_score': 0.34177214}
confusion matrix:
       0    1
0  15967  764
1    172  243
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8597983, 'precision': 0.65720713, 'recall': 0.842114, 'specificity': 0.842114, 'f1': 0.6956214, 'auroc': 0.9014206, 'binary_precision': 0.33124346, 'binary_recall': 0.8212435, 'binary_specificity': 0.86298436, 'binary_f1_score': 0.4720774}
confusion matrix:
      0     1
0  8062  1280
1   138   634
early stop counter: 3
val acc:0.9454100131988525, best validation acc: 0.9568995833396912, corresponding to test acc:                         0.9009293913841248 / 0.9009293913841248
after epoch: 4,now: 2024-08-11 02:52:09.132831,epoch time: 0:35:49.191050,used: 2:23:24.052640,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_00_28_43_seed_0_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:23:24.052640 at 2024-08-11 02:52:09.132831
persisted model performance metric: 

scalar performance:
{'acc': 0.9009294, 'precision': 0.6925678, 'recall': 0.8067467, 'specificity': 0.8067467, 'f1': 0.7310702, 'auroc': 0.8933297, 'binary_precision': 0.4118098, 'binary_recall': 0.69559586, 'binary_specificity': 0.91789764, 'binary_f1_score': 0.517341}
confusion matrix:
      0    1
0  8575  767
1   235  537
oracle model performance metric: 

scalar performance:
{'acc': 0.9009294, 'precision': 0.6925678, 'recall': 0.8067467, 'specificity': 0.8067467, 'f1': 0.7310702, 'auroc': 0.8933297, 'binary_precision': 0.4118098, 'binary_recall': 0.69559586, 'binary_specificity': 0.91789764, 'binary_f1_score': 0.517341}
confusion matrix:
      0    1
0  8575  767
1   235  537
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/5.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/5.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/5.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   2294 MiB |   6874 MiB | 342930 GiB | 342928 GiB |
|       from large pool |   2248 MiB |   6829 MiB | 339581 GiB | 339579 GiB |
|       from small pool |     46 MiB |     87 MiB |   3349 GiB |   3349 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   2294 MiB |   6874 MiB | 342930 GiB | 342928 GiB |
|       from large pool |   2248 MiB |   6829 MiB | 339581 GiB | 339579 GiB |
|       from small pool |     46 MiB |     87 MiB |   3349 GiB |   3349 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   2286 MiB |   6863 MiB | 342706 GiB | 342704 GiB |
|       from large pool |   2242 MiB |   6819 MiB | 339362 GiB | 339359 GiB |
|       from small pool |     44 MiB |     85 MiB |   3344 GiB |   3344 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7284 MiB |   7284 MiB |   7284 MiB |      0 B   |
|       from large pool |   7192 MiB |   7192 MiB |   7192 MiB |      0 B   |
|       from small pool |     92 MiB |     92 MiB |     92 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |    819 MiB |    961 MiB | 226454 GiB | 226453 GiB |
|       from large pool |    799 MiB |    958 MiB | 223088 GiB | 223087 GiB |
|       from small pool |     19 MiB |     21 MiB |   3366 GiB |   3366 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5080    |    7463    |   44241 K  |   44236 K  |
|       from large pool |     176    |     456    |   25118 K  |   25118 K  |
|       from small pool |    4904    |    7286    |   19123 K  |   19118 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5080    |    7463    |   44241 K  |   44236 K  |
|       from large pool |     176    |     456    |   25118 K  |   25118 K  |
|       from small pool |    4904    |    7286    |   19123 K  |   19118 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     173    |     173    |     173    |       0    |
|       from large pool |     127    |     127    |     127    |       0    |
|       from small pool |      46    |      46    |      46    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      75    |    3206    |   24629 K  |   24629 K  |
|       from large pool |      31    |     113    |   16084 K  |   16084 K  |
|       from small pool |      44    |    3175    |    8545 K  |    8545 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6874 MiB | 342930 GiB | 342930 GiB |
|       from large pool |  16640 KiB |   6829 MiB | 339581 GiB | 339581 GiB |
|       from small pool |      0 KiB |     87 MiB |   3349 GiB |   3349 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6874 MiB | 342930 GiB | 342930 GiB |
|       from large pool |  16640 KiB |   6829 MiB | 339581 GiB | 339581 GiB |
|       from small pool |      0 KiB |     87 MiB |   3349 GiB |   3349 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6863 MiB | 342706 GiB | 342706 GiB |
|       from large pool |  16640 KiB |   6819 MiB | 339362 GiB | 339362 GiB |
|       from small pool |      0 KiB |     85 MiB |   3344 GiB |   3344 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3114 MiB |   7284 MiB |   7284 MiB |   4170 MiB |
|       from large pool |   3048 MiB |   7192 MiB |   7192 MiB |   4144 MiB |
|       from small pool |     66 MiB |     92 MiB |     92 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |    988 MiB | 226455 GiB | 226454 GiB |
|       from large pool | 204544 KiB |    959 MiB | 223088 GiB | 223088 GiB |
|       from small pool |      0 KiB |     40 MiB |   3366 GiB |   3366 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      73    |     173    |     173    |     100    |
|       from large pool |      40    |     127    |     127    |      87    |
|       from small pool |      33    |      46    |      46    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3206    |   24631 K  |   24631 K  |
|       from large pool |       3    |     113    |   16084 K  |   16084 K  |
|       from small pool |       0    |    3175    |    8547 K  |    8547 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6874 MiB | 342930 GiB | 342930 GiB |
|       from large pool |  16640 KiB |   6829 MiB | 339581 GiB | 339581 GiB |
|       from small pool |      0 KiB |     87 MiB |   3349 GiB |   3349 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6874 MiB | 342930 GiB | 342930 GiB |
|       from large pool |  16640 KiB |   6829 MiB | 339581 GiB | 339581 GiB |
|       from small pool |      0 KiB |     87 MiB |   3349 GiB |   3349 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6863 MiB | 342706 GiB | 342706 GiB |
|       from large pool |  16640 KiB |   6819 MiB | 339362 GiB | 339362 GiB |
|       from small pool |      0 KiB |     85 MiB |   3344 GiB |   3344 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3114 MiB |   7284 MiB |   7284 MiB |   4170 MiB |
|       from large pool |   3048 MiB |   7192 MiB |   7192 MiB |   4144 MiB |
|       from small pool |     66 MiB |     92 MiB |     92 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |    988 MiB | 226455 GiB | 226454 GiB |
|       from large pool | 204544 KiB |    959 MiB | 223088 GiB | 223088 GiB |
|       from small pool |      0 KiB |     40 MiB |   3366 GiB |   3366 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      73    |     173    |     173    |     100    |
|       from large pool |      40    |     127    |     127    |      87    |
|       from small pool |      33    |      46    |      46    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3206    |   24631 K  |   24631 K  |
|       from large pool |       3    |     113    |   16084 K  |   16084 K  |
|       from small pool |       0    |    3175    |    8547 K  |    8547 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975

 Experiment start at: 2024-08-11 03:02:25.398766
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.07590922713279724
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9677762, 'precision': 0.96789217, 'recall': 0.96778286, 'specificity': 0.96778286, 'f1': 0.9677745, 'auroc': 0.9938871, 'binary_precision': 0.9754665, 'binary_recall': 0.9597437, 'binary_specificity': 0.97582203, 'binary_f1_score': 0.9675412}
confusion matrix:
       0      1
0  24781    614
1   1024  24413
---- Validation: 
scalar performance:
{'acc': 0.8862933, 'precision': 0.55861336, 'recall': 0.7506853, 'specificity': 0.7506853, 'f1': 0.57539266, 'auroc': 0.8420243, 'binary_precision': 0.12843138, 'binary_recall': 0.60788864, 'binary_specificity': 0.8934819, 'binary_f1_score': 0.2120599}
confusion matrix:
       0     1
0  14914  1778
1    169   262
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8623526, 'precision': 0.65225434, 'recall': 0.8224157, 'specificity': 0.8224157, 'f1': 0.68961084, 'auroc': 0.88347423, 'binary_precision': 0.32502767, 'binary_recall': 0.7754293, 'binary_specificity': 0.86940217, 'binary_f1_score': 0.45805696}
confusion matrix:
      0     1
0  8115  1219
1   170   587
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-11 03:39:31.994078,epoch time: 0:37:06.595312,used: 0:37:06.595312,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97279274, 'precision': 0.97309923, 'recall': 0.9728013, 'specificity': 0.9728013, 'f1': 0.9727887, 'auroc': 0.9958483, 'binary_precision': 0.98530954, 'binary_recall': 0.95993394, 'binary_specificity': 0.9856687, 'binary_f1_score': 0.9724562}
confusion matrix:
       0      1
0  25035    364
1   1019  24414
---- Validation: 
scalar performance:
{'acc': 0.8496175, 'precision': 0.54581505, 'recall': 0.7476958, 'specificity': 0.7476958, 'f1': 0.5468901, 'auroc': 0.83816123, 'binary_precision': 0.10237389, 'binary_recall': 0.6403712, 'binary_specificity': 0.85502034, 'binary_f1_score': 0.17652702}
confusion matrix:
       0     1
0  14272  2420
1    155   276
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8651273, 'precision': 0.649205, 'recall': 0.802066, 'specificity': 0.802066, 'f1': 0.68530583, 'auroc': 0.8663499, 'binary_precision': 0.32297772, 'binary_recall': 0.7278732, 'binary_specificity': 0.87625885, 'binary_f1_score': 0.44742188}
confusion matrix:
      0     1
0  8179  1155
1   206   551
new oracle model saved
early stop counter: 1
val acc:0.8496174812316895, best validation acc: 0.8862932920455933, corresponding to test acc:                         0.8623526096343994 / 0.8651273250579834
after epoch: 2,now: 2024-08-11 04:15:08.411556,epoch time: 0:35:36.417478,used: 1:12:43.012790,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.977101, 'precision': 0.9772856, 'recall': 0.9771093, 'specificity': 0.9771093, 'f1': 0.97709906, 'auroc': 0.996698, 'binary_precision': 0.9868817, 'binary_recall': 0.9670952, 'binary_specificity': 0.9871234, 'binary_f1_score': 0.97688824}
confusion matrix:
       0      1
0  25068    327
1    837  24600
---- Validation: 
scalar performance:
{'acc': 0.8960463, 'precision': 0.5666237, 'recall': 0.766989, 'specificity': 0.766989, 'f1': 0.58915913, 'auroc': 0.86421925, 'binary_precision': 0.14368726, 'binary_recall': 0.63109046, 'binary_specificity': 0.9028876, 'binary_f1_score': 0.23407917}
confusion matrix:
       0     1
0  15071  1621
1    159   272
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87434345, 'precision': 0.6628896, 'recall': 0.82404196, 'specificity': 0.82404196, 'f1': 0.7029582, 'auroc': 0.8859201, 'binary_precision': 0.34691432, 'binary_recall': 0.7648613, 'binary_specificity': 0.88322264, 'binary_f1_score': 0.47732893}
confusion matrix:
      0     1
0  8244  1090
1   178   579
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-11 04:51:23.667584,epoch time: 0:36:15.256028,used: 1:48:58.268818,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9801306, 'precision': 0.9802218, 'recall': 0.98013616, 'specificity': 0.98013616, 'f1': 0.98012984, 'auroc': 0.9974221, 'binary_precision': 0.9870394, 'binary_recall': 0.97306967, 'binary_specificity': 0.9872027, 'binary_f1_score': 0.9800048}
confusion matrix:
       0      1
0  25071    325
1    685  24751
---- Validation: 
scalar performance:
{'acc': 0.869357, 'precision': 0.5578935, 'recall': 0.7849437, 'specificity': 0.7849437, 'f1': 0.5701347, 'auroc': 0.86771053, 'binary_precision': 0.12468828, 'binary_recall': 0.6960557, 'binary_specificity': 0.87383175, 'binary_f1_score': 0.21149102}
confusion matrix:
       0     1
0  14586  2106
1    131   300
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86314535, 'precision': 0.6525235, 'recall': 0.82102346, 'specificity': 0.82102346, 'f1': 0.68995, 'auroc': 0.87901217, 'binary_precision': 0.32589287, 'binary_recall': 0.7714663, 'binary_specificity': 0.8705807, 'binary_f1_score': 0.45821893}
confusion matrix:
      0     1
0  8126  1208
1   173   584
early stop counter: 1
val acc:0.8693569898605347, best validation acc: 0.8960462808609009, corresponding to test acc:                         0.8743434548377991 / 0.8743434548377991
after epoch: 4,now: 2024-08-11 05:27:58.444409,epoch time: 0:36:34.776825,used: 2:25:33.045643,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9774748, 'precision': 0.977561, 'recall': 0.97748023, 'specificity': 0.97748023, 'f1': 0.977474, 'auroc': 0.9968393, 'binary_precision': 0.98417383, 'binary_recall': 0.97059286, 'binary_specificity': 0.9843676, 'binary_f1_score': 0.9773361}
confusion matrix:
       0      1
0  24999    397
1    748  24688
---- Validation: 
scalar performance:
{'acc': 0.85212874, 'precision': 0.553466, 'recall': 0.7919291, 'specificity': 0.7919291, 'f1': 0.5586413, 'auroc': 0.86877215, 'binary_precision': 0.11506046, 'binary_recall': 0.7285383, 'binary_specificity': 0.8553199, 'binary_f1_score': 0.1987342}
confusion matrix:
       0     1
0  14277  2415
1    117   314
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.85789317, 'precision': 0.649808, 'recall': 0.8260746, 'specificity': 0.8260746, 'f1': 0.6863235, 'auroc': 0.87941945, 'binary_precision': 0.3190807, 'binary_recall': 0.78863937, 'binary_specificity': 0.8635098, 'binary_f1_score': 0.45433787}
confusion matrix:
      0     1
0  8060  1274
1   160   597
early stop counter: 2
val acc:0.8521287441253662, best validation acc: 0.8960462808609009, corresponding to test acc:                         0.8743434548377991 / 0.8743434548377991
after epoch: 5,now: 2024-08-11 06:03:42.240370,epoch time: 0:35:43.795961,used: 3:01:16.841604,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9790486, 'precision': 0.97920513, 'recall': 0.9790559, 'specificity': 0.9790559, 'f1': 0.9790472, 'auroc': 0.99696887, 'binary_precision': 0.9880642, 'binary_recall': 0.9698459, 'binary_specificity': 0.9882659, 'binary_f1_score': 0.97887033}
confusion matrix:
       0      1
0  25098    298
1    767  24669
---- Validation: 
scalar performance:
{'acc': 0.8885709, 'precision': 0.5670483, 'recall': 0.7902782, 'specificity': 0.7902782, 'f1': 0.5883489, 'auroc': 0.87580866, 'binary_precision': 0.14306428, 'binary_recall': 0.68677497, 'binary_specificity': 0.8937814, 'binary_f1_score': 0.2368}
confusion matrix:
       0     1
0  14919  1773
1    135   296
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8681003, 'precision': 0.6574148, 'recall': 0.8243088, 'specificity': 0.8243088, 'f1': 0.6962671, 'auroc': 0.8851262, 'binary_precision': 0.33543578, 'binary_recall': 0.77278733, 'binary_specificity': 0.8758303, 'binary_f1_score': 0.46781287}
confusion matrix:
      0     1
0  8175  1159
1   172   585
early stop counter: 3
val acc:0.8885709047317505, best validation acc: 0.8960462808609009, corresponding to test acc:                         0.8743434548377991 / 0.8743434548377991
after epoch: 6,now: 2024-08-11 06:40:06.892619,epoch time: 0:36:24.652249,used: 3:37:41.493853,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_03_02_24_seed_1_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 3:37:41.493853 at 2024-08-11 06:40:06.892619
persisted model performance metric: 

scalar performance:
{'acc': 0.87434345, 'precision': 0.6628896, 'recall': 0.82404196, 'specificity': 0.82404196, 'f1': 0.7029582, 'auroc': 0.8859201, 'binary_precision': 0.34691432, 'binary_recall': 0.7648613, 'binary_specificity': 0.88322264, 'binary_f1_score': 0.47732893}
confusion matrix:
      0     1
0  8244  1090
1   178   579
oracle model performance metric: 

scalar performance:
{'acc': 0.87434345, 'precision': 0.6628896, 'recall': 0.82404196, 'specificity': 0.82404196, 'f1': 0.7029582, 'auroc': 0.8859201, 'binary_precision': 0.34691432, 'binary_recall': 0.7648613, 'binary_specificity': 0.88322264, 'binary_f1_score': 0.47732893}
confusion matrix:
      0     1
0  8244  1090
1   178   579
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/5.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/5.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   2296 MiB |   6877 MiB |    837 TiB |    837 TiB |
|       from large pool |   2250 MiB |   6832 MiB |    829 TiB |    829 TiB |
|       from small pool |     46 MiB |     87 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   2296 MiB |   6877 MiB |    837 TiB |    837 TiB |
|       from large pool |   2250 MiB |   6832 MiB |    829 TiB |    829 TiB |
|       from small pool |     46 MiB |     87 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   2286 MiB |   6863 MiB |    836 TiB |    836 TiB |
|       from large pool |   2242 MiB |   6819 MiB |    827 TiB |    827 TiB |
|       from small pool |     44 MiB |     85 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7088 MiB |   7284 MiB |  11258 MiB |   4170 MiB |
|       from large pool |   7002 MiB |   7192 MiB |  11146 MiB |   4144 MiB |
|       from small pool |     86 MiB |     92 MiB |    112 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    987 MiB |   1149 MiB | 663771 GiB | 663771 GiB |
|       from large pool |    965 MiB |   1146 MiB | 655390 GiB | 655389 GiB |
|       from small pool |     21 MiB |     40 MiB |   8381 GiB |   8381 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5068    |    7485    |  110266 K  |  110261 K  |
|       from large pool |     176    |     456    |   62690 K  |   62690 K  |
|       from small pool |    4892    |    7308    |   47575 K  |   47570 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5068    |    7485    |  110266 K  |  110261 K  |
|       from large pool |     176    |     456    |   62690 K  |   62690 K  |
|       from small pool |    4892    |    7308    |   47575 K  |   47570 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     122    |     173    |     222    |     100    |
|       from large pool |      79    |     127    |     166    |      87    |
|       from small pool |      43    |      46    |      56    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      75    |    3217    |   60470 K  |   60470 K  |
|       from large pool |      30    |     113    |   39172 K  |   39172 K  |
|       from small pool |      45    |    3187    |   21298 K  |   21298 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6877 MiB |    837 TiB |    837 TiB |
|       from large pool |  16640 KiB |   6832 MiB |    829 TiB |    829 TiB |
|       from small pool |      0 KiB |     87 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6877 MiB |    837 TiB |    837 TiB |
|       from large pool |  16640 KiB |   6832 MiB |    829 TiB |    829 TiB |
|       from small pool |      0 KiB |     87 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6863 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6819 MiB |    827 TiB |    827 TiB |
|       from small pool |      0 KiB |     85 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3284 MiB |   7284 MiB |  11258 MiB |   7974 MiB |
|       from large pool |   3216 MiB |   7192 MiB |  11146 MiB |   7930 MiB |
|       from small pool |     68 MiB |     92 MiB |    112 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |   1149 MiB | 663772 GiB | 663772 GiB |
|       from large pool | 204544 KiB |   1146 MiB | 655390 GiB | 655390 GiB |
|       from small pool |      0 KiB |     45 MiB |   8381 GiB |   8381 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7485    |  110266 K  |  110266 K  |
|       from large pool |       2    |     456    |   62690 K  |   62690 K  |
|       from small pool |       0    |    7308    |   47575 K  |   47575 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7485    |  110266 K  |  110266 K  |
|       from large pool |       2    |     456    |   62690 K  |   62690 K  |
|       from small pool |       0    |    7308    |   47575 K  |   47575 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |     173    |     222    |     148    |
|       from large pool |      40    |     127    |     166    |     126    |
|       from small pool |      34    |      46    |      56    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3217    |   60472 K  |   60472 K  |
|       from large pool |       3    |     113    |   39172 K  |   39172 K  |
|       from small pool |       0    |    3187    |   21300 K  |   21300 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6877 MiB |    837 TiB |    837 TiB |
|       from large pool |  16640 KiB |   6832 MiB |    829 TiB |    829 TiB |
|       from small pool |      0 KiB |     87 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6877 MiB |    837 TiB |    837 TiB |
|       from large pool |  16640 KiB |   6832 MiB |    829 TiB |    829 TiB |
|       from small pool |      0 KiB |     87 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6863 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6819 MiB |    827 TiB |    827 TiB |
|       from small pool |      0 KiB |     85 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3284 MiB |   7284 MiB |  11258 MiB |   7974 MiB |
|       from large pool |   3216 MiB |   7192 MiB |  11146 MiB |   7930 MiB |
|       from small pool |     68 MiB |     92 MiB |    112 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |   1149 MiB | 663772 GiB | 663772 GiB |
|       from large pool | 204544 KiB |   1146 MiB | 655390 GiB | 655390 GiB |
|       from small pool |      0 KiB |     45 MiB |   8381 GiB |   8381 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7485    |  110266 K  |  110266 K  |
|       from large pool |       2    |     456    |   62690 K  |   62690 K  |
|       from small pool |       0    |    7308    |   47575 K  |   47575 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7485    |  110266 K  |  110266 K  |
|       from large pool |       2    |     456    |   62690 K  |   62690 K  |
|       from small pool |       0    |    7308    |   47575 K  |   47575 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |     173    |     222    |     148    |
|       from large pool |      40    |     127    |     166    |     126    |
|       from small pool |      34    |      46    |      56    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3217    |   60472 K  |   60472 K  |
|       from large pool |       3    |     113    |   39172 K  |   39172 K  |
|       from small pool |       0    |    3187    |   21300 K  |   21300 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_06_50_31_seed_2_24141975

 Experiment start at: 2024-08-11 06:50:31.862787
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.07966706156730652
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96558726, 'precision': 0.9656658, 'recall': 0.96558803, 'specificity': 0.96558803, 'f1': 0.9655858, 'auroc': 0.9929707, 'binary_precision': 0.971741, 'binary_recall': 0.9590731, 'binary_specificity': 0.97210294, 'binary_f1_score': 0.9653655}
confusion matrix:
       0      1
0  25124    721
1   1058  24793
---- Validation: 
scalar performance:
{'acc': 0.9145644, 'precision': 0.56720626, 'recall': 0.72296476, 'specificity': 0.72296476, 'f1': 0.59218454, 'auroc': 0.8333218, 'binary_precision': 0.14719784, 'binary_recall': 0.5215311, 'binary_specificity': 0.9243984, 'binary_f1_score': 0.22959454}
confusion matrix:
       0     1
0  15443  1263
1    200   218
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9015061, 'precision': 0.6620769, 'recall': 0.6631917, 'specificity': 0.6631917, 'f1': 0.6626315, 'auroc': 0.83134055, 'binary_precision': 0.37733498, 'binary_recall': 0.38017565, 'binary_specificity': 0.94620764, 'binary_f1_score': 0.37874997}
confusion matrix:
      0    1
0  8795  500
1   494  303
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-11 07:27:44.478390,epoch time: 0:37:12.615603,used: 0:37:12.615603,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_06_50_31_seed_2_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97491103, 'precision': 0.97533965, 'recall': 0.97491455, 'specificity': 0.97491455, 'f1': 0.9749055, 'auroc': 0.9960942, 'binary_precision': 0.989671, 'binary_recall': 0.9598515, 'binary_specificity': 0.98997754, 'binary_f1_score': 0.97453314}
confusion matrix:
       0      1
0  25583    259
1   1038  24816
---- Validation: 
scalar performance:
{'acc': 0.9292805, 'precision': 0.5821051, 'recall': 0.7293407, 'specificity': 0.7293407, 'f1': 0.613343, 'auroc': 0.84320694, 'binary_precision': 0.17685412, 'binary_recall': 0.51913875, 'binary_specificity': 0.93954265, 'binary_f1_score': 0.2638298}
confusion matrix:
       0     1
0  15696  1010
1    201   217
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91270316, 'precision': 0.70103276, 'recall': 0.7054045, 'specificity': 0.7054045, 'f1': 0.70318663, 'auroc': 0.86543226, 'binary_precision': 0.44852942, 'binary_recall': 0.45922208, 'binary_specificity': 0.9515869, 'binary_f1_score': 0.45381278}
confusion matrix:
      0    1
0  8845  450
1   431  366
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-11 08:04:42.457294,epoch time: 0:36:57.978904,used: 1:14:10.594507,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_06_50_31_seed_2_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97889584, 'precision': 0.9791579, 'recall': 0.97889626, 'specificity': 0.97889626, 'f1': 0.978893, 'auroc': 0.9967314, 'binary_precision': 0.99037397, 'binary_recall': 0.9671941, 'binary_specificity': 0.9905985, 'binary_f1_score': 0.97864676}
confusion matrix:
       0      1
0  25604    243
1    848  25001
---- Validation: 
scalar performance:
{'acc': 0.92402476, 'precision': 0.5791198, 'recall': 0.7394757, 'specificity': 0.7394757, 'f1': 0.60974574, 'auroc': 0.84955525, 'binary_precision': 0.17027633, 'binary_recall': 0.54545456, 'binary_specificity': 0.93349695, 'binary_f1_score': 0.2595333}
confusion matrix:
       0     1
0  15595  1111
1    190   228
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91260403, 'precision': 0.707452, 'recall': 0.7420585, 'specificity': 0.7420585, 'f1': 0.7229299, 'auroc': 0.87789345, 'binary_precision': 0.45502645, 'binary_recall': 0.5395232, 'binary_specificity': 0.94459385, 'binary_f1_score': 0.4936854}
confusion matrix:
      0    1
0  8780  515
1   367  430
early stop counter: 1
val acc:0.924024760723114, best validation acc: 0.9292805194854736, corresponding to test acc:                         0.9127031564712524 / 0.9127031564712524
after epoch: 3,now: 2024-08-11 08:40:49.926240,epoch time: 0:36:07.468946,used: 1:50:18.063453,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_06_50_31_seed_2_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9812945, 'precision': 0.9814281, 'recall': 0.98129606, 'specificity': 0.98129606, 'f1': 0.98129326, 'auroc': 0.9975016, 'binary_precision': 0.98949647, 'binary_recall': 0.9729238, 'binary_specificity': 0.98966837, 'binary_f1_score': 0.9811402}
confusion matrix:
       0      1
0  25576    267
1    700  25153
---- Validation: 
scalar performance:
{'acc': 0.90720624, 'precision': 0.56494373, 'recall': 0.7355211, 'specificity': 0.7355211, 'f1': 0.58832765, 'auroc': 0.84031457, 'binary_precision': 0.14189602, 'binary_recall': 0.5550239, 'binary_specificity': 0.9160182, 'binary_f1_score': 0.22601071}
confusion matrix:
       0     1
0  15303  1403
1    186   232
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8959572, 'precision': 0.6864942, 'recall': 0.78980386, 'specificity': 0.78980386, 'f1': 0.72190475, 'auroc': 0.88453037, 'binary_precision': 0.40350878, 'binary_recall': 0.663739, 'binary_specificity': 0.91586876, 'binary_f1_score': 0.5018975}
confusion matrix:
      0    1
0  8513  782
1   268  529
early stop counter: 2
val acc:0.9072062373161316, best validation acc: 0.9292805194854736, corresponding to test acc:                         0.9127031564712524 / 0.9127031564712524
after epoch: 4,now: 2024-08-11 09:17:42.731122,epoch time: 0:36:52.804882,used: 2:27:10.868335,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_06_50_31_seed_2_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9803853, 'precision': 0.98057735, 'recall': 0.98038805, 'specificity': 0.98038805, 'f1': 0.98038346, 'auroc': 0.9972263, 'binary_precision': 0.99025065, 'binary_recall': 0.97033453, 'binary_specificity': 0.99044156, 'binary_f1_score': 0.98019147}
confusion matrix:
       0      1
0  25594    247
1    767  25088
---- Validation: 
scalar performance:
{'acc': 0.91363, 'precision': 0.5746795, 'recall': 0.7598057, 'specificity': 0.7598057, 'f1': 0.6034097, 'auroc': 0.8527943, 'binary_precision': 0.16015375, 'binary_recall': 0.5980861, 'binary_specificity': 0.9215252, 'binary_f1_score': 0.25265285}
confusion matrix:
       0     1
0  15395  1311
1    168   250
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8812921, 'precision': 0.67306006, 'recall': 0.81109416, 'specificity': 0.81109416, 'f1': 0.71236855, 'auroc': 0.89423805, 'binary_precision': 0.3715567, 'binary_recall': 0.72772896, 'binary_specificity': 0.89445937, 'binary_f1_score': 0.49194235}
confusion matrix:
      0    1
0  8314  981
1   217  580
early stop counter: 3
val acc:0.9136300086975098, best validation acc: 0.9292805194854736, corresponding to test acc:                         0.9127031564712524 / 0.9127031564712524
after epoch: 5,now: 2024-08-11 09:54:05.022143,epoch time: 0:36:22.291021,used: 3:03:33.159356,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_11_06_50_31_seed_2_24141975
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:03:33.159356 at 2024-08-11 09:54:05.022143
persisted model performance metric: 

scalar performance:
{'acc': 0.91270316, 'precision': 0.70103276, 'recall': 0.7054045, 'specificity': 0.7054045, 'f1': 0.70318663, 'auroc': 0.86543226, 'binary_precision': 0.44852942, 'binary_recall': 0.45922208, 'binary_specificity': 0.9515869, 'binary_f1_score': 0.45381278}
confusion matrix:
      0    1
0  8845  450
1   431  366
oracle model performance metric: 

scalar performance:
{'acc': 0.91270316, 'precision': 0.70103276, 'recall': 0.7054045, 'specificity': 0.7054045, 'f1': 0.70318663, 'auroc': 0.86543226, 'binary_precision': 0.44852942, 'binary_recall': 0.45922208, 'binary_specificity': 0.9515869, 'binary_f1_score': 0.45381278}
confusion matrix:
      0    1
0  8845  450
1   431  366
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/5.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/5.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   2296 MiB |   6877 MiB |   1262 TiB |   1262 TiB |
|       from large pool |   2250 MiB |   6832 MiB |   1250 TiB |   1250 TiB |
|       from small pool |     46 MiB |     87 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   2296 MiB |   6877 MiB |   1262 TiB |   1262 TiB |
|       from large pool |   2250 MiB |   6832 MiB |   1250 TiB |   1250 TiB |
|       from small pool |     46 MiB |     87 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   2286 MiB |   6863 MiB |   1261 TiB |   1261 TiB |
|       from large pool |   2242 MiB |   6819 MiB |   1249 TiB |   1249 TiB |
|       from small pool |     44 MiB |     85 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7188 MiB |   7284 MiB |  15162 MiB |   7974 MiB |
|       from large pool |   7102 MiB |   7192 MiB |  15032 MiB |   7930 MiB |
|       from small pool |     86 MiB |     92 MiB |    130 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |    983 MiB |   1149 MiB |   1021 TiB |   1021 TiB |
|       from large pool |    965 MiB |   1146 MiB |   1009 TiB |   1009 TiB |
|       from small pool |     17 MiB |     45 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    5068    |    7593    |  166287 K  |  166282 K  |
|       from large pool |     176    |     456    |   94567 K  |   94567 K  |
|       from small pool |    4892    |    7416    |   71720 K  |   71715 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5068    |    7593    |  166287 K  |  166282 K  |
|       from large pool |     176    |     456    |   94567 K  |   94567 K  |
|       from small pool |    4892    |    7416    |   71720 K  |   71715 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     173    |     263    |     148    |
|       from large pool |      72    |     127    |     198    |     126    |
|       from small pool |      43    |      46    |      65    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |    3268    |   89235 K  |   89235 K  |
|       from large pool |      28    |     113    |   57192 K  |   57192 K  |
|       from small pool |      43    |    3240    |   32043 K  |   32042 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6877 MiB |   1262 TiB |   1262 TiB |
|       from large pool |  16640 KiB |   6832 MiB |   1250 TiB |   1250 TiB |
|       from small pool |      0 KiB |     87 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6877 MiB |   1262 TiB |   1262 TiB |
|       from large pool |  16640 KiB |   6832 MiB |   1250 TiB |   1250 TiB |
|       from small pool |      0 KiB |     87 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6863 MiB |   1261 TiB |   1261 TiB |
|       from large pool |  16640 KiB |   6819 MiB |   1249 TiB |   1249 TiB |
|       from small pool |      0 KiB |     85 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3280 MiB |   7284 MiB |  15162 MiB |  11882 MiB |
|       from large pool |   3216 MiB |   7192 MiB |  15032 MiB |  11816 MiB |
|       from small pool |     64 MiB |     92 MiB |    130 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |   1149 MiB |   1021 TiB |   1021 TiB |
|       from large pool | 204544 KiB |   1146 MiB |   1009 TiB |   1009 TiB |
|       from small pool |      0 KiB |     45 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7593    |  166287 K  |  166287 K  |
|       from large pool |       2    |     456    |   94567 K  |   94567 K  |
|       from small pool |       0    |    7416    |   71720 K  |   71720 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7593    |  166287 K  |  166287 K  |
|       from large pool |       2    |     456    |   94567 K  |   94567 K  |
|       from small pool |       0    |    7416    |   71720 K  |   71720 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      72    |     173    |     263    |     191    |
|       from large pool |      40    |     127    |     198    |     158    |
|       from small pool |      32    |      46    |      65    |      33    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3268    |   89237 K  |   89237 K  |
|       from large pool |       3    |     113    |   57192 K  |   57192 K  |
|       from small pool |       0    |    3240    |   32045 K  |   32045 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sun Aug 11 09:56:17 2024]
Finished job 0.
1 of 1 steps (100%) done
