Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Aug  7 19:11:21 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/12.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=12
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_19_19_26_seed_0_24111562

 Experiment start at: 2024-08-07 19:19:27.014273
before training, model accuracy: 0.6631401777267456
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9500355, 'precision': 0.9522015, 'recall': 0.9500602, 'specificity': 0.9500602, 'f1': 0.9499775, 'auroc': 0.9867207, 'binary_precision': 0.9836761, 'binary_recall': 0.9153318, 'binary_specificity': 0.9847886, 'binary_f1_score': 0.94827414}
confusion matrix:
       0      1
0  24925    385
1   2146  23200
---- Validation: 
scalar performance:
{'acc': 0.9159571, 'precision': 0.5810711, 'recall': 0.7842208, 'specificity': 0.7842208, 'f1': 0.6132628, 'auroc': 0.88232076, 'binary_precision': 0.1715749, 'binary_recall': 0.6457831, 'binary_specificity': 0.92265856, 'binary_f1_score': 0.27111787}
confusion matrix:
       0     1
0  15437  1294
1    147   268
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8166897, 'precision': 0.60853803, 'recall': 0.7569872, 'specificity': 0.7569872, 'f1': 0.6283401, 'auroc': 0.84701717, 'binary_precision': 0.2474323, 'binary_recall': 0.6865285, 'binary_specificity': 0.8274459, 'binary_f1_score': 0.36376116}
confusion matrix:
      0     1
0  7730  1612
1   242   530
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 19:50:04.874352,epoch time: 0:30:37.860079,used: 0:30:37.860079,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_19_19_26_seed_0_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96298563, 'precision': 0.9640687, 'recall': 0.96300095, 'specificity': 0.96300095, 'f1': 0.9629649, 'auroc': 0.99159396, 'binary_precision': 0.98664623, 'binary_recall': 0.93872315, 'binary_specificity': 0.98727876, 'binary_f1_score': 0.9620882}
confusion matrix:
       0      1
0  24990    322
1   1553  23791
---- Validation: 
scalar performance:
{'acc': 0.8979937, 'precision': 0.57771903, 'recall': 0.83493805, 'specificity': 0.83493805, 'f1': 0.6062311, 'auroc': 0.9044898, 'binary_precision': 0.16176471, 'binary_recall': 0.7686747, 'binary_specificity': 0.90120137, 'binary_f1_score': 0.26728112}
confusion matrix:
       0     1
0  15078  1653
1     96   319
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8117461, 'precision': 0.6160984, 'recall': 0.79055405, 'specificity': 0.79055405, 'f1': 0.63597393, 'auroc': 0.8675374, 'binary_precision': 0.2554019, 'binary_recall': 0.76554406, 'binary_specificity': 0.8155641, 'binary_f1_score': 0.38302007}
confusion matrix:
      0     1
0  7619  1723
1   181   591
early stop counter: 1
val acc:0.8979936838150024, best validation acc: 0.9159570932388306, corresponding to test acc:                         0.8166897296905518 / 0.8166897296905518
after epoch: 2,now: 2024-08-07 20:19:58.133252,epoch time: 0:29:53.258900,used: 1:00:31.118979,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_19_19_26_seed_0_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96851313, 'precision': 0.969132, 'recall': 0.968524, 'specificity': 0.968524, 'f1': 0.96850324, 'auroc': 0.99368453, 'binary_precision': 0.98632044, 'binary_recall': 0.9502427, 'binary_specificity': 0.9868052, 'binary_f1_score': 0.9679455}
confusion matrix:
       0      1
0  24979    334
1   1261  24082
---- Validation: 
scalar performance:
{'acc': 0.8990435, 'precision': 0.5786725, 'recall': 0.83665085, 'specificity': 0.83665085, 'f1': 0.6078503, 'auroc': 0.9144942, 'binary_precision': 0.16359918, 'binary_recall': 0.7710843, 'binary_specificity': 0.90221745, 'binary_f1_score': 0.26992828}
confusion matrix:
       0     1
0  15095  1636
1     95   320
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8454617, 'precision': 0.6360676, 'recall': 0.79929864, 'specificity': 0.79929864, 'f1': 0.6673236, 'auroc': 0.88141847, 'binary_precision': 0.29623905, 'binary_recall': 0.7448186, 'binary_specificity': 0.85377866, 'binary_f1_score': 0.42388496}
confusion matrix:
      0     1
0  7976  1366
1   197   575
new oracle model saved
early stop counter: 2
val acc:0.8990435004234314, best validation acc: 0.9159570932388306, corresponding to test acc:                         0.8166897296905518 / 0.8454617261886597
after epoch: 3,now: 2024-08-07 20:49:48.372451,epoch time: 0:29:50.239199,used: 1:30:21.358178,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_19_19_26_seed_0_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97309303, 'precision': 0.9734862, 'recall': 0.9731016, 'specificity': 0.9731016, 'f1': 0.9730878, 'auroc': 0.995744, 'binary_precision': 0.98727953, 'binary_recall': 0.95856845, 'binary_specificity': 0.98763484, 'binary_f1_score': 0.97271216}
confusion matrix:
       0      1
0  25000    313
1   1050  24293
---- Validation: 
scalar performance:
{'acc': 0.91059136, 'precision': 0.5853407, 'recall': 0.8284688, 'specificity': 0.8284688, 'f1': 0.6194759, 'auroc': 0.91209185, 'binary_precision': 0.17762399, 'binary_recall': 0.74216866, 'binary_specificity': 0.914769, 'binary_f1_score': 0.28664494}
confusion matrix:
       0     1
0  15305  1426
1    107   308
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84763694, 'precision': 0.6398947, 'recall': 0.8082, 'specificity': 0.8082, 'f1': 0.67241424, 'auroc': 0.88520145, 'binary_precision': 0.30231363, 'binary_recall': 0.761658, 'binary_specificity': 0.85474205, 'binary_f1_score': 0.43283033}
confusion matrix:
      0     1
0  7985  1357
1   184   588
new oracle model saved
early stop counter: 3
val acc:0.9105913639068604, best validation acc: 0.9159570932388306, corresponding to test acc:                         0.8166897296905518 / 0.8476369380950928
after epoch: 4,now: 2024-08-07 21:19:36.092409,epoch time: 0:29:47.719958,used: 2:00:09.078136,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_19_19_26_seed_0_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:00:09.078136 at 2024-08-07 21:19:36.092409
persisted model performance metric: 

scalar performance:
{'acc': 0.8166897, 'precision': 0.60853803, 'recall': 0.7569872, 'specificity': 0.7569872, 'f1': 0.6283401, 'auroc': 0.84701717, 'binary_precision': 0.2474323, 'binary_recall': 0.6865285, 'binary_specificity': 0.8274459, 'binary_f1_score': 0.36376116}
confusion matrix:
      0     1
0  7730  1612
1   242   530
oracle model performance metric: 

scalar performance:
{'acc': 0.84763694, 'precision': 0.6398947, 'recall': 0.8082, 'specificity': 0.8082, 'f1': 0.67241424, 'auroc': 0.88520145, 'binary_precision': 0.30231363, 'binary_recall': 0.761658, 'binary_specificity': 0.85474205, 'binary_f1_score': 0.43283033}
confusion matrix:
      0     1
0  7985  1357
1   184   588
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/12.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198876 KiB |   4047 MiB | 389062 GiB | 389061 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 384366 GiB | 384366 GiB |
|       from small pool |  18214 KiB |     38 MiB |   4695 GiB |   4695 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198876 KiB |   4047 MiB | 389062 GiB | 389061 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 384366 GiB | 384366 GiB |
|       from small pool |  18214 KiB |     38 MiB |   4695 GiB |   4695 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   4045 MiB | 389039 GiB | 389039 GiB |
|       from large pool | 178979 KiB |   4026 MiB | 384348 GiB | 384348 GiB |
|       from small pool |  16663 KiB |     36 MiB |   4690 GiB |   4690 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4432 MiB |   4432 MiB |   4432 MiB |      0 B   |
|       from large pool |   4390 MiB |   4390 MiB |   4390 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  65316 KiB | 398856 KiB | 203864 GiB | 203864 GiB |
|       from large pool |  50762 KiB | 397938 KiB | 199121 GiB | 199121 GiB |
|       from small pool |  14554 KiB |  15057 KiB |   4742 GiB |   4742 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4424    |    6807    |   52364 K  |   52360 K  |
|       from large pool |      79    |     423    |   35374 K  |   35374 K  |
|       from small pool |    4345    |    6727    |   16989 K  |   16985 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4424    |    6807    |   52364 K  |   52360 K  |
|       from large pool |      79    |     423    |   35374 K  |   35374 K  |
|       from small pool |    4345    |    6727    |   16989 K  |   16985 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     203    |     203    |     203    |       0    |
|       from large pool |     182    |     182    |     182    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      35    |    3187    |   35551 K  |   35551 K  |
|       from large pool |      10    |     184    |   28478 K  |   28478 K  |
|       from small pool |      25    |    3177    |    7072 K  |    7072 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 389062 GiB | 389062 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 384366 GiB | 384366 GiB |
|       from small pool |      0 KiB |     38 MiB |   4695 GiB |   4695 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 389062 GiB | 389062 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 384366 GiB | 384366 GiB |
|       from small pool |      0 KiB |     38 MiB |   4695 GiB |   4695 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 389039 GiB | 389039 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 384348 GiB | 384348 GiB |
|       from small pool |      0 KiB |     36 MiB |   4690 GiB |   4690 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 264192 KiB |   4432 MiB |   4432 MiB |   4174 MiB |
|       from large pool | 231424 KiB |   4390 MiB |   4390 MiB |   4164 MiB |
|       from small pool |  32768 KiB |     42 MiB |     42 MiB |     10 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398856 KiB | 203864 GiB | 203864 GiB |
|       from large pool |  30464 KiB | 397938 KiB | 199122 GiB | 199122 GiB |
|       from small pool |      0 KiB |  26063 KiB |   4742 GiB |   4742 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   52364 K  |   52364 K  |
|       from large pool |       2    |     423    |   35374 K  |   35374 K  |
|       from small pool |       0    |    6727    |   16989 K  |   16989 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   52364 K  |   52364 K  |
|       from large pool |       2    |     423    |   35374 K  |   35374 K  |
|       from small pool |       0    |    6727    |   16989 K  |   16989 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      27    |     203    |     203    |     176    |
|       from large pool |      11    |     182    |     182    |     171    |
|       from small pool |      16    |      21    |      21    |       5    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3187    |   35553 K  |   35553 K  |
|       from large pool |       3    |     184    |   28478 K  |   28478 K  |
|       from small pool |       0    |    3177    |    7074 K  |    7074 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 389062 GiB | 389062 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 384366 GiB | 384366 GiB |
|       from small pool |      0 KiB |     38 MiB |   4695 GiB |   4695 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 389062 GiB | 389062 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 384366 GiB | 384366 GiB |
|       from small pool |      0 KiB |     38 MiB |   4695 GiB |   4695 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 389039 GiB | 389039 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 384348 GiB | 384348 GiB |
|       from small pool |      0 KiB |     36 MiB |   4690 GiB |   4690 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 264192 KiB |   4432 MiB |   4432 MiB |   4174 MiB |
|       from large pool | 231424 KiB |   4390 MiB |   4390 MiB |   4164 MiB |
|       from small pool |  32768 KiB |     42 MiB |     42 MiB |     10 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398856 KiB | 203864 GiB | 203864 GiB |
|       from large pool |  30464 KiB | 397938 KiB | 199122 GiB | 199122 GiB |
|       from small pool |      0 KiB |  26063 KiB |   4742 GiB |   4742 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   52364 K  |   52364 K  |
|       from large pool |       2    |     423    |   35374 K  |   35374 K  |
|       from small pool |       0    |    6727    |   16989 K  |   16989 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   52364 K  |   52364 K  |
|       from large pool |       2    |     423    |   35374 K  |   35374 K  |
|       from small pool |       0    |    6727    |   16989 K  |   16989 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      27    |     203    |     203    |     176    |
|       from large pool |      11    |     182    |     182    |     171    |
|       from small pool |      16    |      21    |      21    |       5    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3187    |   35553 K  |   35553 K  |
|       from large pool |       3    |     184    |   28478 K  |   28478 K  |
|       from small pool |       0    |    3177    |    7074 K  |    7074 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_21_41_01_seed_1_24111562

 Experiment start at: 2024-08-07 21:41:02.313257
before training, model accuracy: 0.5408779978752136
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94387394, 'precision': 0.94631636, 'recall': 0.94390315, 'specificity': 0.94390315, 'f1': 0.9437996, 'auroc': 0.9845422, 'binary_precision': 0.9795303, 'binary_recall': 0.90678567, 'binary_specificity': 0.9810206, 'binary_f1_score': 0.9417553}
confusion matrix:
       0      1
0  24914    482
1   2371  23065
---- Validation: 
scalar performance:
{'acc': 0.9411902, 'precision': 0.59362835, 'recall': 0.7031232, 'specificity': 0.7031232, 'f1': 0.62425715, 'auroc': 0.8643517, 'binary_precision': 0.20186335, 'binary_recall': 0.4524362, 'binary_specificity': 0.9538102, 'binary_f1_score': 0.27916965}
confusion matrix:
       0    1
0  15921  771
1    236  195
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8825686, 'precision': 0.6248808, 'recall': 0.66947126, 'specificity': 0.66947126, 'f1': 0.6420056, 'auroc': 0.8487686, 'binary_precision': 0.29849342, 'binary_recall': 0.41875824, 'binary_specificity': 0.92018425, 'binary_f1_score': 0.34854317}
confusion matrix:
      0    1
0  8589  745
1   440  317
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-07 22:12:36.700227,epoch time: 0:31:34.386970,used: 0:31:34.386970,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_21_41_01_seed_1_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95998585, 'precision': 0.9607788, 'recall': 0.96000314, 'specificity': 0.96000314, 'f1': 0.95996964, 'auroc': 0.9913664, 'binary_precision': 0.9801009, 'binary_recall': 0.93910444, 'binary_specificity': 0.9809018, 'binary_f1_score': 0.9591648}
confusion matrix:
       0      1
0  24910    485
1   1549  23888
---- Validation: 
scalar performance:
{'acc': 0.94235826, 'precision': 0.6191938, 'recall': 0.7930032, 'specificity': 0.7930032, 'f1': 0.66341496, 'auroc': 0.89084136, 'binary_precision': 0.2481884, 'binary_recall': 0.63573086, 'binary_specificity': 0.9502756, 'binary_f1_score': 0.35700327}
confusion matrix:
       0    1
0  15862  830
1    157  274
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8643346, 'precision': 0.6545591, 'recall': 0.82530797, 'specificity': 0.82530797, 'f1': 0.69264406, 'auroc': 0.88828814, 'binary_precision': 0.32924107, 'binary_recall': 0.77939236, 'binary_specificity': 0.8712235, 'binary_f1_score': 0.46292666}
confusion matrix:
      0     1
0  8132  1202
1   167   590
better model found
persisted
after epoch: 2,now: 2024-08-07 22:42:34.884835,epoch time: 0:29:58.184608,used: 1:01:32.571578,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_21_41_01_seed_1_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9681303, 'precision': 0.96879506, 'recall': 0.9681445, 'specificity': 0.9681445, 'f1': 0.96811974, 'auroc': 0.9943887, 'binary_precision': 0.98663616, 'binary_recall': 0.9491645, 'binary_specificity': 0.98712444, 'binary_f1_score': 0.9675377}
confusion matrix:
       0      1
0  25070    327
1   1293  24142
---- Validation: 
scalar performance:
{'acc': 0.93681014, 'precision': 0.6148162, 'recall': 0.81502056, 'specificity': 0.81502056, 'f1': 0.66021264, 'auroc': 0.90078104, 'binary_precision': 0.23813355, 'binary_recall': 0.68677497, 'binary_specificity': 0.9432662, 'binary_f1_score': 0.35364398}
confusion matrix:
       0    1
0  15745  947
1    135  296
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.85402834, 'precision': 0.6475977, 'recall': 0.82823396, 'specificity': 0.82823396, 'f1': 0.6832058, 'auroc': 0.89325583, 'binary_precision': 0.31392932, 'binary_recall': 0.7978864, 'binary_specificity': 0.85858154, 'binary_f1_score': 0.45057815}
confusion matrix:
      0     1
0  8014  1320
1   153   604
early stop counter: 1
val acc:0.9368101358413696, best validation acc: 0.9423582553863525, corresponding to test acc:                         0.8643345832824707 / 0.8825685977935791
after epoch: 3,now: 2024-08-07 23:12:29.868815,epoch time: 0:29:54.983980,used: 1:31:27.555558,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_21_41_01_seed_1_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9728911, 'precision': 0.9731605, 'recall': 0.9729006, 'specificity': 0.9729006, 'f1': 0.97288764, 'auroc': 0.9950892, 'binary_precision': 0.9846495, 'binary_recall': 0.96080357, 'binary_specificity': 0.98499763, 'binary_f1_score': 0.97258043}
confusion matrix:
       0      1
0  25015    381
1    997  24439
---- Validation: 
scalar performance:
{'acc': 0.9299188, 'precision': 0.6079762, 'recall': 0.82843804, 'specificity': 0.82843804, 'f1': 0.65218675, 'auroc': 0.91094935, 'binary_precision': 0.22358015, 'binary_recall': 0.7215777, 'binary_specificity': 0.9352983, 'binary_f1_score': 0.34138307}
confusion matrix:
       0     1
0  15612  1080
1    120   311
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83728075, 'precision': 0.6407362, 'recall': 0.84224457, 'specificity': 0.84224457, 'f1': 0.6718345, 'auroc': 0.8985008, 'binary_precision': 0.29598895, 'binary_recall': 0.84808457, 'binary_specificity': 0.83640456, 'binary_f1_score': 0.43882436}
confusion matrix:
      0     1
0  7807  1527
1   115   642
early stop counter: 2
val acc:0.9299188256263733, best validation acc: 0.9423582553863525, corresponding to test acc:                         0.8643345832824707 / 0.8825685977935791
after epoch: 4,now: 2024-08-07 23:42:28.582633,epoch time: 0:29:58.713818,used: 2:01:26.269376,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_21_41_01_seed_1_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97477967, 'precision': 0.9751233, 'recall': 0.97479147, 'specificity': 0.97479147, 'f1': 0.97477555, 'auroc': 0.9960202, 'binary_precision': 0.98811835, 'binary_recall': 0.9611605, 'binary_specificity': 0.98842245, 'binary_f1_score': 0.974453}
confusion matrix:
       0      1
0  25100    294
1    988  24450
---- Validation: 
scalar performance:
{'acc': 0.93908775, 'precision': 0.618925, 'recall': 0.8173189, 'specificity': 0.8173189, 'f1': 0.665437, 'auroc': 0.9115158, 'binary_precision': 0.24626866, 'binary_recall': 0.68909514, 'binary_specificity': 0.94554275, 'binary_f1_score': 0.3628589}
confusion matrix:
       0    1
0  15783  909
1    134  297
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.867803, 'precision': 0.6566663, 'recall': 0.82232726, 'specificity': 0.82232726, 'f1': 0.6952687, 'auroc': 0.8904515, 'binary_precision': 0.33429062, 'binary_recall': 0.7688243, 'binary_specificity': 0.8758303, 'binary_f1_score': 0.4659728}
confusion matrix:
      0     1
0  8175  1159
1   175   582
early stop counter: 3
val acc:0.9390877485275269, best validation acc: 0.9423582553863525, corresponding to test acc:                         0.8643345832824707 / 0.8825685977935791
after epoch: 5,now: 2024-08-08 00:12:24.832114,epoch time: 0:29:56.249481,used: 2:31:22.518857,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_07_21_41_01_seed_1_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:31:22.518857 at 2024-08-08 00:12:24.832114
persisted model performance metric: 

scalar performance:
{'acc': 0.8643346, 'precision': 0.6545591, 'recall': 0.82530797, 'specificity': 0.82530797, 'f1': 0.69264406, 'auroc': 0.88828814, 'binary_precision': 0.32924107, 'binary_recall': 0.77939236, 'binary_specificity': 0.8712235, 'binary_f1_score': 0.46292666}
confusion matrix:
      0     1
0  8132  1202
1   167   590
oracle model performance metric: 

scalar performance:
{'acc': 0.8825686, 'precision': 0.6248808, 'recall': 0.66947126, 'specificity': 0.66947126, 'f1': 0.6420056, 'auroc': 0.8487686, 'binary_precision': 0.29849342, 'binary_recall': 0.41875824, 'binary_specificity': 0.92018425, 'binary_f1_score': 0.34854317}
confusion matrix:
      0    1
0  8589  745
1   440  317
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197419 KiB |   4047 MiB |    849 TiB |    849 TiB |
|       from large pool | 179211 KiB |   4027 MiB |    839 TiB |    839 TiB |
|       from small pool |  18208 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197419 KiB |   4047 MiB |    849 TiB |    849 TiB |
|       from large pool | 179211 KiB |   4027 MiB |    839 TiB |    839 TiB |
|       from small pool |  18208 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   4045 MiB |    849 TiB |    849 TiB |
|       from large pool | 178979 KiB |   4026 MiB |    839 TiB |    839 TiB |
|       from small pool |  16662 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4420 MiB |   4432 MiB |   8594 MiB |   4174 MiB |
|       from large pool |   4382 MiB |   4390 MiB |   8546 MiB |   4164 MiB |
|       from small pool |     38 MiB |     42 MiB |     48 MiB |     10 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42197 KiB | 398856 KiB | 464214 GiB | 464214 GiB |
|       from large pool |  31733 KiB | 397938 KiB | 453529 GiB | 453529 GiB |
|       from small pool |  10464 KiB |  26063 KiB |  10684 GiB |  10684 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6829    |  116924 K  |  116919 K  |
|       from large pool |      79    |     423    |   79051 K  |   79051 K  |
|       from small pool |    4333    |    6749    |   37872 K  |   37868 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6829    |  116924 K  |  116919 K  |
|       from large pool |      79    |     423    |   79051 K  |   79051 K  |
|       from small pool |    4333    |    6749    |   37872 K  |   37868 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     203    |     376    |     176    |
|       from large pool |     181    |     182    |     352    |     171    |
|       from small pool |      19    |      21    |      24    |       5    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3197    |   80545 K  |   80545 K  |
|       from large pool |      11    |     186    |   61541 K  |   61541 K  |
|       from small pool |      21    |    3186    |   19004 K  |   19004 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |    849 TiB |    849 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    839 TiB |    839 TiB |
|       from small pool |      0 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |    849 TiB |    849 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    839 TiB |    839 TiB |
|       from small pool |      0 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |    849 TiB |    849 TiB |
|       from large pool |  16640 KiB |   4026 MiB |    839 TiB |    839 TiB |
|       from small pool |      0 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   4432 MiB |   8594 MiB |   8360 MiB |
|       from large pool | 210944 KiB |   4390 MiB |   8546 MiB |   8340 MiB |
|       from small pool |  28672 KiB |     42 MiB |     48 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398856 KiB | 464214 GiB | 464214 GiB |
|       from large pool |  30464 KiB | 397938 KiB | 453530 GiB | 453530 GiB |
|       from small pool |      0 KiB |  26063 KiB |  10684 GiB |  10684 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |  116924 K  |  116924 K  |
|       from large pool |       2    |     423    |   79051 K  |   79051 K  |
|       from small pool |       0    |    6749    |   37872 K  |   37872 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |  116924 K  |  116924 K  |
|       from large pool |       2    |     423    |   79051 K  |   79051 K  |
|       from small pool |       0    |    6749    |   37872 K  |   37872 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     203    |     376    |     352    |
|       from large pool |      10    |     182    |     352    |     342    |
|       from small pool |      14    |      21    |      24    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3197    |   80547 K  |   80547 K  |
|       from large pool |       3    |     186    |   61541 K  |   61541 K  |
|       from small pool |       0    |    3186    |   19006 K  |   19006 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |    849 TiB |    849 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    839 TiB |    839 TiB |
|       from small pool |      0 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |    849 TiB |    849 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    839 TiB |    839 TiB |
|       from small pool |      0 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |    849 TiB |    849 TiB |
|       from large pool |  16640 KiB |   4026 MiB |    839 TiB |    839 TiB |
|       from small pool |      0 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   4432 MiB |   8594 MiB |   8360 MiB |
|       from large pool | 210944 KiB |   4390 MiB |   8546 MiB |   8340 MiB |
|       from small pool |  28672 KiB |     42 MiB |     48 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398856 KiB | 464214 GiB | 464214 GiB |
|       from large pool |  30464 KiB | 397938 KiB | 453530 GiB | 453530 GiB |
|       from small pool |      0 KiB |  26063 KiB |  10684 GiB |  10684 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |  116924 K  |  116924 K  |
|       from large pool |       2    |     423    |   79051 K  |   79051 K  |
|       from small pool |       0    |    6749    |   37872 K  |   37872 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |  116924 K  |  116924 K  |
|       from large pool |       2    |     423    |   79051 K  |   79051 K  |
|       from small pool |       0    |    6749    |   37872 K  |   37872 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     203    |     376    |     352    |
|       from large pool |      10    |     182    |     352    |     342    |
|       from small pool |      14    |      21    |      24    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3197    |   80547 K  |   80547 K  |
|       from large pool |       3    |     186    |   61541 K  |   61541 K  |
|       from small pool |       0    |    3186    |   19006 K  |   19006 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562

 Experiment start at: 2024-08-08 00:31:48.417661
before training, model accuracy: 0.8581054210662842
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9468818, 'precision': 0.9484035, 'recall': 0.94688743, 'specificity': 0.94688743, 'f1': 0.9468372, 'auroc': 0.98532224, 'binary_precision': 0.97457385, 'binary_recall': 0.9177272, 'binary_specificity': 0.9760477, 'binary_f1_score': 0.94529665}
confusion matrix:
       0      1
0  25224    619
1   2127  23726
---- Validation: 
scalar performance:
{'acc': 0.93149966, 'precision': 0.5887416, 'recall': 0.7456392, 'specificity': 0.7456392, 'f1': 0.6228626, 'auroc': 0.8451812, 'binary_precision': 0.18930042, 'binary_recall': 0.5502392, 'binary_specificity': 0.94103914, 'binary_f1_score': 0.28169015}
confusion matrix:
       0    1
0  15721  985
1    188  230
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.877824, 'precision': 0.650157, 'recall': 0.7398107, 'specificity': 0.7398107, 'f1': 0.6792018, 'auroc': 0.86396646, 'binary_precision': 0.33899558, 'binary_recall': 0.5759097, 'binary_specificity': 0.9037117, 'binary_f1_score': 0.42677823}
confusion matrix:
      0    1
0  8400  895
1   338  459
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 01:03:38.780159,epoch time: 0:31:50.362498,used: 0:31:50.362498,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9585074, 'precision': 0.96010125, 'recall': 0.95851654, 'specificity': 0.95851654, 'f1': 0.958472, 'auroc': 0.99104524, 'binary_precision': 0.98725903, 'binary_recall': 0.92903, 'binary_specificity': 0.9880031, 'binary_f1_score': 0.9572598}
confusion matrix:
       0      1
0  25530    310
1   1835  24021
---- Validation: 
scalar performance:
{'acc': 0.94335437, 'precision': 0.6121837, 'recall': 0.7692085, 'specificity': 0.7692085, 'f1': 0.6530162, 'auroc': 0.8637485, 'binary_precision': 0.23512477, 'binary_recall': 0.5861244, 'binary_specificity': 0.95229256, 'binary_f1_score': 0.33561644}
confusion matrix:
       0    1
0  15909  797
1    173  245
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9029925, 'precision': 0.69472164, 'recall': 0.7764163, 'specificity': 0.7764163, 'f1': 0.72551733, 'auroc': 0.8924617, 'binary_precision': 0.42288136, 'binary_recall': 0.62609786, 'binary_specificity': 0.9267348, 'binary_f1_score': 0.5048052}
confusion matrix:
      0    1
0  8614  681
1   298  499
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 01:33:59.922488,epoch time: 0:30:21.142329,used: 1:02:11.504827,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96657383, 'precision': 0.96760476, 'recall': 0.96657836, 'specificity': 0.96657836, 'f1': 0.9665556, 'auroc': 0.9939617, 'binary_precision': 0.9896091, 'binary_recall': 0.9430627, 'binary_specificity': 0.990094, 'binary_f1_score': 0.96577543}
confusion matrix:
       0      1
0  25587    256
1   1472  24381
---- Validation: 
scalar performance:
{'acc': 0.95071244, 'precision': 0.6269626, 'recall': 0.7671484, 'specificity': 0.7671484, 'f1': 0.6684515, 'auroc': 0.8793427, 'binary_precision': 0.26490065, 'binary_recall': 0.57416266, 'binary_specificity': 0.9601341, 'binary_f1_score': 0.36253777}
confusion matrix:
       0    1
0  16040  666
1    178  240
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90804595, 'precision': 0.7050885, 'recall': 0.78317463, 'specificity': 0.78317463, 'f1': 0.73539174, 'auroc': 0.90074545, 'binary_precision': 0.44269466, 'binary_recall': 0.6348808, 'binary_specificity': 0.93146855, 'binary_f1_score': 0.5216495}
confusion matrix:
      0    1
0  8658  637
1   291  506
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-08 02:04:21.388313,epoch time: 0:30:21.465825,used: 1:32:32.970652,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97245437, 'precision': 0.9728751, 'recall': 0.9724555, 'specificity': 0.9724555, 'f1': 0.9724483, 'auroc': 0.9952363, 'binary_precision': 0.9870006, 'binary_recall': 0.9575242, 'binary_specificity': 0.9873868, 'binary_f1_score': 0.972039}
confusion matrix:
       0      1
0  25520    326
1   1098  24752
---- Validation: 
scalar performance:
{'acc': 0.94633263, 'precision': 0.6188196, 'recall': 0.77306736, 'specificity': 0.77306736, 'f1': 0.6608112, 'auroc': 0.87792075, 'binary_precision': 0.2482412, 'binary_recall': 0.59090906, 'binary_specificity': 0.95522565, 'binary_f1_score': 0.34961075}
confusion matrix:
       0    1
0  15958  748
1    171  247
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9096314, 'precision': 0.70903504, 'recall': 0.7886238, 'specificity': 0.7886238, 'f1': 0.73995394, 'auroc': 0.8981402, 'binary_precision': 0.4496938, 'binary_recall': 0.64491844, 'binary_specificity': 0.93232924, 'binary_f1_score': 0.5298969}
confusion matrix:
      0    1
0  8666  629
1   283  514
new oracle model saved
early stop counter: 1
val acc:0.9463326334953308, best validation acc: 0.9507124423980713, corresponding to test acc:                         0.9080459475517273 / 0.9096313714981079
after epoch: 4,now: 2024-08-08 02:34:44.745870,epoch time: 0:30:23.357557,used: 2:02:56.328209,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9738084, 'precision': 0.9745331, 'recall': 0.9738114, 'specificity': 0.9738114, 'f1': 0.9737985, 'auroc': 0.99619484, 'binary_precision': 0.99311596, 'binary_recall': 0.9542395, 'binary_specificity': 0.99338335, 'binary_f1_score': 0.9732896}
confusion matrix:
       0      1
0  25673    171
1   1183  24669
---- Validation: 
scalar performance:
{'acc': 0.9459822, 'precision': 0.61835647, 'recall': 0.77405405, 'specificity': 0.77405405, 'f1': 0.660436, 'auroc': 0.8832667, 'binary_precision': 0.24725823, 'binary_recall': 0.5933014, 'binary_specificity': 0.9548067, 'binary_f1_score': 0.34904996}
confusion matrix:
       0    1
0  15951  755
1    170  248
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9102259, 'precision': 0.711357, 'recall': 0.7958293, 'specificity': 0.7958293, 'f1': 0.74378693, 'auroc': 0.9017563, 'binary_precision': 0.4530577, 'binary_recall': 0.65997493, 'binary_specificity': 0.9316837, 'binary_f1_score': 0.537283}
confusion matrix:
      0    1
0  8660  635
1   271  526
new oracle model saved
early stop counter: 2
val acc:0.9459822177886963, best validation acc: 0.9507124423980713, corresponding to test acc:                         0.9080459475517273 / 0.9102259278297424
after epoch: 5,now: 2024-08-08 03:05:06.049126,epoch time: 0:30:21.303256,used: 2:33:17.631465,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.97551066, 'precision': 0.9759981, 'recall': 0.9755144, 'specificity': 0.9755144, 'f1': 0.9755045, 'auroc': 0.996498, 'binary_precision': 0.99128836, 'binary_recall': 0.95946467, 'binary_specificity': 0.9915641, 'binary_f1_score': 0.97511697}
confusion matrix:
       0      1
0  25624    218
1   1048  24806
---- Validation: 
scalar performance:
{'acc': 0.9491357, 'precision': 0.6248432, 'recall': 0.7733377, 'specificity': 0.7733377, 'f1': 0.6672411, 'auroc': 0.88588554, 'binary_precision': 0.26031747, 'binary_recall': 0.5885168, 'binary_specificity': 0.95815873, 'binary_f1_score': 0.36096844}
confusion matrix:
       0    1
0  16007  699
1    172  246
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9112168, 'precision': 0.7157327, 'recall': 0.81185335, 'specificity': 0.81185335, 'f1': 0.751584, 'auroc': 0.90388966, 'binary_precision': 0.45892116, 'binary_recall': 0.69385195, 'binary_specificity': 0.92985475, 'binary_f1_score': 0.5524475}
confusion matrix:
      0    1
0  8643  652
1   244  553
new oracle model saved
early stop counter: 3
val acc:0.9491357207298279, best validation acc: 0.9507124423980713, corresponding to test acc:                         0.9080459475517273 / 0.9112167954444885
after epoch: 6,now: 2024-08-08 03:35:28.937762,epoch time: 0:30:22.888636,used: 3:03:40.520101,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_08_00_31_48_seed_2_24111562
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 3:03:40.520101 at 2024-08-08 03:35:28.937762
persisted model performance metric: 

scalar performance:
{'acc': 0.90804595, 'precision': 0.7050885, 'recall': 0.78317463, 'specificity': 0.78317463, 'f1': 0.73539174, 'auroc': 0.90074545, 'binary_precision': 0.44269466, 'binary_recall': 0.6348808, 'binary_specificity': 0.93146855, 'binary_f1_score': 0.5216495}
confusion matrix:
      0    1
0  8658  637
1   291  506
oracle model performance metric: 

scalar performance:
{'acc': 0.9112168, 'precision': 0.7157327, 'recall': 0.81185335, 'specificity': 0.81185335, 'f1': 0.751584, 'auroc': 0.90388966, 'binary_precision': 0.45892116, 'binary_recall': 0.69385195, 'binary_specificity': 0.92985475, 'binary_f1_score': 0.5524475}
confusion matrix:
      0    1
0  8643  652
1   244  553
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197419 KiB |   4047 MiB |   1416 TiB |   1416 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1399 TiB |   1399 TiB |
|       from small pool |  18208 KiB |     38 MiB |     16 TiB |     16 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197419 KiB |   4047 MiB |   1416 TiB |   1416 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1399 TiB |   1399 TiB |
|       from small pool |  18208 KiB |     38 MiB |     16 TiB |     16 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   4045 MiB |   1416 TiB |   1416 TiB |
|       from large pool | 178979 KiB |   4026 MiB |   1399 TiB |   1399 TiB |
|       from small pool |  16662 KiB |     36 MiB |     16 TiB |     16 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4420 MiB |   4432 MiB |  12780 MiB |   8360 MiB |
|       from large pool |   4382 MiB |   4390 MiB |  12722 MiB |   8340 MiB |
|       from small pool |     38 MiB |     42 MiB |     58 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42197 KiB | 398856 KiB | 777941 GiB | 777941 GiB |
|       from large pool |  31733 KiB | 397938 KiB | 760137 GiB | 760137 GiB |
|       from small pool |  10464 KiB |  26063 KiB |  17803 GiB |  17803 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6937    |  194690 K  |  194686 K  |
|       from large pool |      79    |     423    |  131741 K  |  131741 K  |
|       from small pool |    4333    |    6857    |   62949 K  |   62944 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6937    |  194690 K  |  194686 K  |
|       from large pool |      79    |     423    |  131741 K  |  131741 K  |
|       from small pool |    4333    |    6857    |   62949 K  |   62944 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     203    |     552    |     352    |
|       from large pool |     181    |     182    |     523    |     342    |
|       from small pool |      19    |      21    |      29    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3251    |  134788 K  |  134788 K  |
|       from large pool |      11    |     186    |  101486 K  |  101486 K  |
|       from small pool |      21    |    3240    |   33301 K  |   33301 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |   1416 TiB |   1416 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1399 TiB |   1399 TiB |
|       from small pool |      0 KiB |     38 MiB |     16 TiB |     16 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |   1416 TiB |   1416 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1399 TiB |   1399 TiB |
|       from small pool |      0 KiB |     38 MiB |     16 TiB |     16 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |   1416 TiB |   1416 TiB |
|       from large pool |  16640 KiB |   4026 MiB |   1399 TiB |   1399 TiB |
|       from small pool |      0 KiB |     36 MiB |     16 TiB |     16 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   4432 MiB |  12780 MiB |  12546 MiB |
|       from large pool | 210944 KiB |   4390 MiB |  12722 MiB |  12516 MiB |
|       from small pool |  28672 KiB |     42 MiB |     58 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398856 KiB | 777941 GiB | 777941 GiB |
|       from large pool |  30464 KiB | 397938 KiB | 760137 GiB | 760137 GiB |
|       from small pool |      0 KiB |  26063 KiB |  17803 GiB |  17803 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6937    |  194690 K  |  194690 K  |
|       from large pool |       2    |     423    |  131741 K  |  131741 K  |
|       from small pool |       0    |    6857    |   62949 K  |   62949 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6937    |  194690 K  |  194690 K  |
|       from large pool |       2    |     423    |  131741 K  |  131741 K  |
|       from small pool |       0    |    6857    |   62949 K  |   62949 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     203    |     552    |     528    |
|       from large pool |      10    |     182    |     523    |     513    |
|       from small pool |      14    |      21    |      29    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3251    |  134790 K  |  134790 K  |
|       from large pool |       3    |     186    |  101486 K  |  101486 K  |
|       from small pool |       0    |    3240    |   33303 K  |   33303 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  8 03:48:21 2024]
Finished job 0.
1 of 1 steps (100%) done
