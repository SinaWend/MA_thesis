Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  8 08:28:57 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/17.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=17
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/var/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_08_39_51_seed_0_24111575

 Experiment start at: 2024-08-08 08:39:51.913150
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.28613802790641785
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93781585, 'precision': 0.9398604, 'recall': 0.937832, 'specificity': 0.937832, 'f1': 0.9377451, 'auroc': 0.9782865, 'binary_precision': 0.9699678, 'binary_recall': 0.9036701, 'binary_specificity': 0.971994, 'binary_f1_score': 0.935646}
confusion matrix:
       0      1
0  24607    709
1   2441  22899
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9304211, 'precision': 0.5188471, 'recall': 0.5390213, 'specificity': 0.5390213, 'f1': 0.52272105, 'auroc': 0.65382755, 'binary_precision': 0.05995475, 'binary_recall': 0.12771085, 'binary_specificity': 0.95033175, 'binary_f1_score': 0.08160123}
confusion matrix:
       0    1
0  15900  831
1    362   53
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8772988, 'precision': 0.566005, 'recall': 0.5663969, 'specificity': 0.5663969, 'f1': 0.5661999, 'auroc': 0.7895937, 'binary_precision': 0.1981982, 'binary_recall': 0.19948186, 'binary_specificity': 0.93331194, 'binary_f1_score': 0.19883797}
confusion matrix:
      0    1
0  8719  623
1   618  154
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 09:08:04.899592,epoch time: 0:28:12.986442,used: 0:28:12.986442,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_08_39_51_seed_0_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9524637, 'precision': 0.95454454, 'recall': 0.95248246, 'specificity': 0.95248246, 'f1': 0.9524106, 'auroc': 0.9856708, 'binary_precision': 0.98543733, 'binary_recall': 0.9185542, 'binary_specificity': 0.9864107, 'binary_f1_score': 0.95082104}
confusion matrix:
       0      1
0  24970    344
1   2064  23278
---- Validation: 
scalar performance:
{'acc': 0.95684123, 'precision': 0.58325166, 'recall': 0.6030812, 'specificity': 0.6030812, 'f1': 0.59191316, 'auroc': 0.7408121, 'binary_precision': 0.18568665, 'binary_recall': 0.2313253, 'binary_specificity': 0.9748371, 'binary_f1_score': 0.20600858}
confusion matrix:
       0    1
0  16310  421
1    319   96
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90488434, 'precision': 0.64434564, 'recall': 0.61816657, 'specificity': 0.61816657, 'f1': 0.62941086, 'auroc': 0.8389288, 'binary_precision': 0.34726688, 'binary_recall': 0.27979276, 'binary_specificity': 0.95654035, 'binary_f1_score': 0.3098996}
confusion matrix:
      0    1
0  8936  406
1   556  216
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 09:35:27.528591,epoch time: 0:27:22.628999,used: 0:55:35.615441,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_08_39_51_seed_0_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9606167, 'precision': 0.9622508, 'recall': 0.96062964, 'specificity': 0.96062964, 'f1': 0.9605826, 'auroc': 0.99003696, 'binary_precision': 0.9898439, 'binary_recall': 0.9308181, 'binary_specificity': 0.9904412, 'binary_f1_score': 0.959424}
confusion matrix:
       0      1
0  25075    242
1   1753  23586
---- Validation: 
scalar performance:
{'acc': 0.95684123, 'precision': 0.59400403, 'recall': 0.62423, 'specificity': 0.62423, 'f1': 0.6066655, 'auroc': 0.7640928, 'binary_precision': 0.20614828, 'binary_recall': 0.2746988, 'binary_specificity': 0.97376126, 'binary_f1_score': 0.2355372}
confusion matrix:
       0    1
0  16292  439
1    301  114
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9068618, 'precision': 0.65650886, 'recall': 0.6334965, 'specificity': 0.6334965, 'f1': 0.6437311, 'auroc': 0.85506165, 'binary_precision': 0.36923078, 'binary_recall': 0.31088084, 'binary_specificity': 0.9561122, 'binary_f1_score': 0.33755273}
confusion matrix:
      0    1
0  8932  410
1   532  240
new oracle model saved
early stop counter: 1
val acc:0.956841230392456, best validation acc: 0.956841230392456, corresponding to test acc:                         0.9048843383789062 / 0.9068617820739746
after epoch: 3,now: 2024-08-08 10:02:54.466051,epoch time: 0:27:26.937460,used: 1:23:02.552901,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_08_39_51_seed_0_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.96655875, 'precision': 0.96713305, 'recall': 0.9665706, 'specificity': 0.9665706, 'f1': 0.96654904, 'auroc': 0.99194336, 'binary_precision': 0.9836803, 'binary_recall': 0.9489051, 'binary_specificity': 0.9842361, 'binary_f1_score': 0.9659798}
confusion matrix:
       0      1
0  24912    399
1   1295  24050
---- Validation: 
scalar performance:
{'acc': 0.94797623, 'precision': 0.5933842, 'recall': 0.67608446, 'specificity': 0.67608446, 'f1': 0.6197396, 'auroc': 0.7929919, 'binary_precision': 0.20224719, 'binary_recall': 0.39036146, 'binary_specificity': 0.9618074, 'binary_f1_score': 0.26644737}
confusion matrix:
       0    1
0  16092  639
1    253  162
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.906664, 'precision': 0.6743345, 'recall': 0.6862685, 'specificity': 0.6862685, 'f1': 0.68002737, 'auroc': 0.86981285, 'binary_precision': 0.39638555, 'binary_recall': 0.4261658, 'binary_specificity': 0.9463712, 'binary_f1_score': 0.41073656}
confusion matrix:
      0    1
0  8841  501
1   443  329
early stop counter: 2
val acc:0.9479762315750122, best validation acc: 0.956841230392456, corresponding to test acc:                         0.9048843383789062 / 0.9068617820739746
after epoch: 4,now: 2024-08-08 10:30:32.592021,epoch time: 0:27:38.125970,used: 1:50:40.678871,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_08_39_51_seed_0_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9710794, 'precision': 0.9714814, 'recall': 0.9710911, 'specificity': 0.9710911, 'f1': 0.97107375, 'auroc': 0.99392384, 'binary_precision': 0.9854466, 'binary_recall': 0.9563279, 'binary_specificity': 0.98585427, 'binary_f1_score': 0.9706689}
confusion matrix:
       0      1
0  24950    358
1   1107  24241
---- Validation: 
scalar performance:
{'acc': 0.9346203, 'precision': 0.5781379, 'recall': 0.6939145, 'specificity': 0.6939145, 'f1': 0.60598075, 'auroc': 0.7999809, 'binary_precision': 0.17070895, 'binary_recall': 0.44096386, 'binary_specificity': 0.9468651, 'binary_f1_score': 0.24613315}
confusion matrix:
       0    1
0  15842  889
1    232  183
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90003955, 'precision': 0.6759088, 'recall': 0.73972064, 'specificity': 0.73972064, 'f1': 0.70084965, 'auroc': 0.87974477, 'binary_precision': 0.3902663, 'binary_recall': 0.55051816, 'binary_specificity': 0.92892313, 'binary_f1_score': 0.4567437}
confusion matrix:
      0    1
0  8678  664
1   347  425
early stop counter: 3
val acc:0.9346203207969666, best validation acc: 0.956841230392456, corresponding to test acc:                         0.9048843383789062 / 0.9068617820739746
after epoch: 5,now: 2024-08-08 10:57:46.652032,epoch time: 0:27:14.060011,used: 2:17:54.738882,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_08_39_51_seed_0_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:17:54.738882 at 2024-08-08 10:57:46.652032
persisted model performance metric: 

scalar performance:
{'acc': 0.90488434, 'precision': 0.64434564, 'recall': 0.61816657, 'specificity': 0.61816657, 'f1': 0.62941086, 'auroc': 0.8389288, 'binary_precision': 0.34726688, 'binary_recall': 0.27979276, 'binary_specificity': 0.95654035, 'binary_f1_score': 0.3098996}
confusion matrix:
      0    1
0  8936  406
1   556  216
oracle model performance metric: 

scalar performance:
{'acc': 0.9068618, 'precision': 0.65650886, 'recall': 0.6334965, 'specificity': 0.6334965, 'f1': 0.6437311, 'auroc': 0.85506165, 'binary_precision': 0.36923078, 'binary_recall': 0.31088084, 'binary_specificity': 0.9561122, 'binary_f1_score': 0.33755273}
confusion matrix:
      0    1
0  8932  410
1   532  240
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/17.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/17.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/17.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198886 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |  18224 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198886 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |  18224 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   2141 MiB | 251346 GiB | 251346 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 248159 GiB | 248159 GiB |
|       from small pool |  16663 KiB |     36 MiB |   3186 GiB |   3186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  63258 KiB | 225565 KiB | 136364 GiB | 136364 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 133152 GiB | 133152 GiB |
|       from small pool |  12496 KiB |  12998 KiB |   3212 GiB |   3212 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4444    |    6827    |   38387 K  |   38383 K  |
|       from large pool |      79    |     252    |   22954 K  |   22954 K  |
|       from small pool |    4365    |    6747    |   15432 K  |   15428 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4444    |    6827    |   38387 K  |   38383 K  |
|       from large pool |      79    |     252    |   22954 K  |   22954 K  |
|       from small pool |    4365    |    6747    |   15432 K  |   15428 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3182    |   24594 K  |   24594 K  |
|       from large pool |      10    |      97    |   17900 K  |   17900 K  |
|       from small pool |      30    |    3172    |    6693 K  |    6693 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 251346 GiB | 251346 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 248159 GiB | 248159 GiB |
|       from small pool |      0 KiB |     36 MiB |   3186 GiB |   3186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   2372 MiB |   2372 MiB |   2116 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 136365 GiB | 136365 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 133152 GiB | 133152 GiB |
|       from small pool |      0 KiB |  26061 KiB |   3212 GiB |   3212 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |     118    |     118    |      92    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   24596 K  |   24596 K  |
|       from large pool |       3    |      97    |   17900 K  |   17900 K  |
|       from small pool |       0    |    3172    |    6695 K  |    6695 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 251346 GiB | 251346 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 248159 GiB | 248159 GiB |
|       from small pool |      0 KiB |     36 MiB |   3186 GiB |   3186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   2372 MiB |   2372 MiB |   2116 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 136365 GiB | 136365 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 133152 GiB | 133152 GiB |
|       from small pool |      0 KiB |  26061 KiB |   3212 GiB |   3212 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |     118    |     118    |      92    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   24596 K  |   24596 K  |
|       from large pool |       3    |      97    |   17900 K  |   17900 K  |
|       from small pool |       0    |    3172    |    6695 K  |    6695 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575

 Experiment start at: 2024-08-08 11:23:17.097753
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6057873368263245
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9284309, 'precision': 0.9338212, 'recall': 0.92847705, 'specificity': 0.92847705, 'f1': 0.9282131, 'auroc': 0.9750173, 'binary_precision': 0.98238546, 'binary_recall': 0.8726265, 'binary_specificity': 0.9843276, 'binary_f1_score': 0.9242588}
confusion matrix:
       0      1
0  24997    398
1   3240  22197
---- Validation: 
scalar performance:
{'acc': 0.9446943, 'precision': 0.54112786, 'recall': 0.5613929, 'specificity': 0.5613929, 'f1': 0.5485106, 'auroc': 0.78496397, 'binary_precision': 0.10429448, 'binary_recall': 0.15777262, 'binary_specificity': 0.9650132, 'binary_f1_score': 0.1255771}
confusion matrix:
       0    1
0  16108  584
1    363   68
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89237934, 'precision': 0.6265092, 'recall': 0.6407861, 'specificity': 0.6407861, 'f1': 0.633079, 'auroc': 0.82988286, 'binary_precision': 0.306698, 'binary_recall': 0.34478202, 'binary_specificity': 0.9367902, 'binary_f1_score': 0.32462683}
confusion matrix:
      0    1
0  8744  590
1   496  261
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 11:54:23.789461,epoch time: 0:31:06.691708,used: 0:31:06.691708,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95056266, 'precision': 0.9521737, 'recall': 0.9505886, 'specificity': 0.9505886, 'f1': 0.9505205, 'auroc': 0.9860618, 'binary_precision': 0.97938186, 'binary_recall': 0.92059124, 'binary_specificity': 0.980586, 'binary_f1_score': 0.94907695}
confusion matrix:
       0      1
0  24901    493
1   2020  23418
---- Validation: 
scalar performance:
{'acc': 0.96665305, 'precision': 0.6151983, 'recall': 0.5760462, 'specificity': 0.5760462, 'f1': 0.5910652, 'auroc': 0.8334526, 'binary_precision': 0.25177306, 'binary_recall': 0.16473317, 'binary_specificity': 0.9873592, 'binary_f1_score': 0.19915847}
confusion matrix:
       0    1
0  16481  211
1    360   71
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91299176, 'precision': 0.6821512, 'recall': 0.6701362, 'specificity': 0.6701362, 'f1': 0.6758667, 'auroc': 0.8802358, 'binary_precision': 0.41394025, 'binary_recall': 0.38441214, 'binary_specificity': 0.9558603, 'binary_f1_score': 0.39863014}
confusion matrix:
      0    1
0  8922  412
1   466  291
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 12:21:42.038277,epoch time: 0:27:18.248816,used: 0:58:24.940524,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96185476, 'precision': 0.96273696, 'recall': 0.96187204, 'specificity': 0.96187204, 'f1': 0.96183753, 'auroc': 0.9918305, 'binary_precision': 0.9831394, 'binary_recall': 0.93988836, 'binary_specificity': 0.9838557, 'binary_f1_score': 0.9610275}
confusion matrix:
       0      1
0  24986    410
1   1529  23907
---- Validation: 
scalar performance:
{'acc': 0.9668282, 'precision': 0.6296406, 'recall': 0.59421825, 'specificity': 0.59421825, 'f1': 0.60877407, 'auroc': 0.8439822, 'binary_precision': 0.27974278, 'binary_recall': 0.20185615, 'binary_specificity': 0.9865804, 'binary_f1_score': 0.23450136}
confusion matrix:
       0    1
0  16468  224
1    344   87
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9072441, 'precision': 0.68584085, 'recall': 0.7380406, 'specificity': 0.7380406, 'f1': 0.7074833, 'auroc': 0.8847681, 'binary_precision': 0.41005024, 'binary_recall': 0.53896964, 'binary_specificity': 0.9371116, 'binary_f1_score': 0.46575344}
confusion matrix:
      0    1
0  8747  587
1   349  408
better model found
persisted
after epoch: 3,now: 2024-08-08 12:49:02.522152,epoch time: 0:27:20.483875,used: 1:25:45.424399,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.96742207, 'precision': 0.9678477, 'recall': 0.96743405, 'specificity': 0.96743405, 'f1': 0.9674153, 'auroc': 0.99352777, 'binary_precision': 0.98215735, 'binary_recall': 0.95219374, 'binary_specificity': 0.9826744, 'binary_f1_score': 0.9669435}
confusion matrix:
       0      1
0  24956    440
1   1216  24220
---- Validation: 
scalar performance:
{'acc': 0.9653098, 'precision': 0.6479408, 'recall': 0.64994633, 'specificity': 0.64994633, 'f1': 0.64893603, 'auroc': 0.86067116, 'binary_precision': 0.31350115, 'binary_recall': 0.31786543, 'binary_specificity': 0.9820273, 'binary_f1_score': 0.3156682}
confusion matrix:
       0    1
0  16392  300
1    294  137
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90377563, 'precision': 0.68651277, 'recall': 0.7689402, 'specificity': 0.7689402, 'f1': 0.7172506, 'auroc': 0.89009005, 'binary_precision': 0.4059754, 'binary_recall': 0.6103038, 'binary_specificity': 0.9275766, 'binary_f1_score': 0.48759896}
confusion matrix:
      0    1
0  8658  676
1   295  462
early stop counter: 1
val acc:0.9653097987174988, best validation acc: 0.9668282270431519, corresponding to test acc:                         0.907244086265564 / 0.9129917621612549
after epoch: 4,now: 2024-08-08 13:16:38.411054,epoch time: 0:27:35.888902,used: 1:53:21.313301,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97060907, 'precision': 0.9708084, 'recall': 0.9706169, 'specificity': 0.9706169, 'f1': 0.9706063, 'auroc': 0.99433935, 'binary_precision': 0.98068506, 'binary_recall': 0.960173, 'binary_specificity': 0.98106074, 'binary_f1_score': 0.97032064}
confusion matrix:
       0      1
0  24916    481
1   1013  24422
---- Validation: 
scalar performance:
{'acc': 0.9638498, 'precision': 0.6350609, 'recall': 0.6390263, 'specificity': 0.6390263, 'f1': 0.6370112, 'auroc': 0.8526685, 'binary_precision': 0.2882883, 'binary_recall': 0.29698375, 'binary_specificity': 0.9810688, 'binary_f1_score': 0.29257143}
confusion matrix:
       0    1
0  16376  316
1    303  128
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90179366, 'precision': 0.6862421, 'recall': 0.7824353, 'specificity': 0.7824353, 'f1': 0.72038335, 'auroc': 0.88615584, 'binary_precision': 0.40298507, 'binary_recall': 0.64200795, 'binary_specificity': 0.92286265, 'binary_f1_score': 0.49516046}
confusion matrix:
      0    1
0  8614  720
1   271  486
early stop counter: 2
val acc:0.9638497829437256, best validation acc: 0.9668282270431519, corresponding to test acc:                         0.907244086265564 / 0.9129917621612549
after epoch: 5,now: 2024-08-08 13:45:12.746343,epoch time: 0:28:34.335289,used: 2:21:55.648590,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.97550756, 'precision': 0.9755578, 'recall': 0.9755117, 'specificity': 0.9755117, 'f1': 0.975507, 'auroc': 0.9957676, 'binary_precision': 0.98064774, 'binary_recall': 0.9701997, 'binary_specificity': 0.98082376, 'binary_f1_score': 0.97539574}
confusion matrix:
       0      1
0  24909    487
1    758  24678
---- Validation: 
scalar performance:
{'acc': 0.96209776, 'precision': 0.63761836, 'recall': 0.6663811, 'specificity': 0.6663811, 'f1': 0.65046203, 'auroc': 0.8648442, 'binary_precision': 0.29198474, 'binary_recall': 0.3549884, 'binary_specificity': 0.9777738, 'binary_f1_score': 0.32041886}
confusion matrix:
       0    1
0  16321  371
1    278  153
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89109105, 'precision': 0.6780517, 'recall': 0.8124591, 'specificity': 0.8124591, 'f1': 0.7184325, 'auroc': 0.8910129, 'binary_precision': 0.3805866, 'binary_recall': 0.71994716, 'binary_specificity': 0.90497106, 'binary_f1_score': 0.49794427}
confusion matrix:
      0    1
0  8447  887
1   212  545
early stop counter: 3
val acc:0.9620977640151978, best validation acc: 0.9668282270431519, corresponding to test acc:                         0.907244086265564 / 0.9129917621612549
after epoch: 6,now: 2024-08-08 14:13:23.419948,epoch time: 0:28:10.673605,used: 2:50:06.322195,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_23_16_seed_1_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 2:50:06.322195 at 2024-08-08 14:13:23.419948
persisted model performance metric: 

scalar performance:
{'acc': 0.9072441, 'precision': 0.68584085, 'recall': 0.7380406, 'specificity': 0.7380406, 'f1': 0.7074833, 'auroc': 0.8847681, 'binary_precision': 0.41005024, 'binary_recall': 0.53896964, 'binary_specificity': 0.9371116, 'binary_f1_score': 0.46575344}
confusion matrix:
      0    1
0  8747  587
1   349  408
oracle model performance metric: 

scalar performance:
{'acc': 0.91299176, 'precision': 0.6821512, 'recall': 0.6701362, 'specificity': 0.6701362, 'f1': 0.6758667, 'auroc': 0.8802358, 'binary_precision': 0.41394025, 'binary_recall': 0.38441214, 'binary_specificity': 0.9558603, 'binary_f1_score': 0.39863014}
confusion matrix:
      0    1
0  8922  412
1   466  291
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/17.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/17.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |  18218 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |  18218 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB | 550556 GiB | 550555 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 543604 GiB | 543604 GiB |
|       from small pool |  16662 KiB |     36 MiB |   6951 GiB |   6951 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   4470 MiB |   2116 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   4420 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     50 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 231558 KiB | 303491 GiB | 303491 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 296338 GiB | 296338 GiB |
|       from small pool |  10454 KiB |  26061 KiB |   7153 GiB |   7153 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6849    |   84032 K  |   84027 K  |
|       from large pool |      79    |     252    |   50264 K  |   50264 K  |
|       from small pool |    4353    |    6769    |   33767 K  |   33763 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6849    |   84032 K  |   84027 K  |
|       from large pool |      79    |     252    |   50264 K  |   50264 K  |
|       from small pool |    4353    |    6769    |   33767 K  |   33763 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     207    |      92    |
|       from large pool |      96    |      97    |     182    |      86    |
|       from small pool |      19    |      21    |      25    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3194    |   55600 K  |   55600 K  |
|       from large pool |      11    |     100    |   38272 K  |   38272 K  |
|       from small pool |      28    |    3183    |   17328 K  |   17328 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 550556 GiB | 550556 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 543604 GiB | 543604 GiB |
|       from small pool |      0 KiB |     36 MiB |   6951 GiB |   6951 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4470 MiB |   4236 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 303491 GiB | 303491 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 296338 GiB | 296338 GiB |
|       from small pool |      0 KiB |  26061 KiB |   7153 GiB |   7153 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     207    |     183    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3194    |   55602 K  |   55602 K  |
|       from large pool |       3    |     100    |   38272 K  |   38272 K  |
|       from small pool |       0    |    3183    |   17330 K  |   17330 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 550556 GiB | 550556 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 543604 GiB | 543604 GiB |
|       from small pool |      0 KiB |     36 MiB |   6951 GiB |   6951 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4470 MiB |   4236 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 303491 GiB | 303491 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 296338 GiB | 296338 GiB |
|       from small pool |      0 KiB |  26061 KiB |   7153 GiB |   7153 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     207    |     183    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3194    |   55602 K  |   55602 K  |
|       from large pool |       3    |     100    |   38272 K  |   38272 K  |
|       from small pool |       0    |    3183    |   17330 K  |   17330 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_37_09_seed_2_24111575

 Experiment start at: 2024-08-08 14:37:09.324580
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.11296075582504272
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.90660787, 'precision': 0.9174284, 'recall': 0.90661097, 'specificity': 0.90661097, 'f1': 0.9059992, 'auroc': 0.9524416, 'binary_precision': 0.9846452, 'binary_recall': 0.8261055, 'binary_specificity': 0.9871165, 'binary_f1_score': 0.8984348}
confusion matrix:
       0      1
0  25514    333
1   4495  21354
---- Validation: 
scalar performance:
{'acc': 0.97290355, 'precision': 0.48776203, 'recall': 0.49862325, 'specificity': 0.49862325, 'f1': 0.49313286, 'auroc': 0.5110396, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9972465, 'binary_f1_score': 0.0}
confusion matrix:
       0   1
0  16660  46
1    418   0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92092746, 'precision': 0.6977276, 'recall': 0.50510824, 'specificity': 0.50510824, 'f1': 0.49042842, 'auroc': 0.59282124, 'binary_precision': 0.47368422, 'binary_recall': 0.011292347, 'binary_specificity': 0.99892414, 'binary_f1_score': 0.022058824}
confusion matrix:
      0   1
0  9285  10
1   788   9
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 15:05:48.733963,epoch time: 0:28:39.409383,used: 0:28:39.409383,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_37_09_seed_2_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.93924093, 'precision': 0.9430213, 'recall': 0.9392463, 'specificity': 0.9392463, 'f1': 0.9391116, 'auroc': 0.9738923, 'binary_precision': 0.9839741, 'binary_recall': 0.8930409, 'binary_specificity': 0.98545176, 'binary_f1_score': 0.9363048}
confusion matrix:
       0      1
0  25469    376
1   2765  23086
---- Validation: 
scalar performance:
{'acc': 0.9734875, 'precision': 0.638523, 'recall': 0.53041106, 'specificity': 0.53041106, 'f1': 0.54642165, 'auroc': 0.6539335, 'binary_precision': 0.3, 'binary_recall': 0.0645933, 'binary_specificity': 0.9962289, 'binary_f1_score': 0.106299214}
confusion matrix:
       0   1
0  16643  63
1    391  27
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9221165, 'precision': 0.772841, 'recall': 0.5166514, 'specificity': 0.5166514, 'f1': 0.5129357, 'auroc': 0.6854359, 'binary_precision': 0.62222224, 'binary_recall': 0.035131745, 'binary_specificity': 0.99817103, 'binary_f1_score': 0.066508316}
confusion matrix:
      0   1
0  9278  17
1   769  28
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 15:34:33.219721,epoch time: 0:28:44.485758,used: 0:57:23.895141,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_37_09_seed_2_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9533813, 'precision': 0.9550835, 'recall': 0.95338964, 'specificity': 0.95338964, 'f1': 0.95333827, 'auroc': 0.98200965, 'binary_precision': 0.9829838, 'binary_recall': 0.92276156, 'binary_specificity': 0.98401767, 'binary_f1_score': 0.95192116}
confusion matrix:
       0      1
0  25428    413
1   1997  23858
---- Validation: 
scalar performance:
{'acc': 0.96998364, 'precision': 0.64698625, 'recall': 0.59159243, 'specificity': 0.59159243, 'f1': 0.6121673, 'auroc': 0.7683826, 'binary_precision': 0.3139535, 'binary_recall': 0.1937799, 'binary_specificity': 0.989405, 'binary_f1_score': 0.23964496}
confusion matrix:
       0    1
0  16529  177
1    337   81
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9239992, 'precision': 0.75718427, 'recall': 0.56126404, 'specificity': 0.56126404, 'f1': 0.5867021, 'auroc': 0.7742362, 'binary_precision': 0.58426964, 'binary_recall': 0.13048933, 'binary_specificity': 0.9920387, 'binary_f1_score': 0.21333332}
confusion matrix:
      0    1
0  9221   74
1   693  104
new oracle model saved
early stop counter: 1
val acc:0.9699836373329163, best validation acc: 0.9734874963760376, corresponding to test acc:                         0.9221165180206299 / 0.9239991903305054
after epoch: 3,now: 2024-08-08 16:03:09.336124,epoch time: 0:28:36.116403,used: 1:26:00.011544,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_37_09_seed_2_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.95922315, 'precision': 0.9605613, 'recall': 0.95922947, 'specificity': 0.95922947, 'f1': 0.9591939, 'auroc': 0.9862058, 'binary_precision': 0.9854444, 'binary_recall': 0.9322349, 'binary_specificity': 0.986224, 'binary_f1_score': 0.95810145}
confusion matrix:
       0      1
0  25486    356
1   1752  24102
---- Validation: 
scalar performance:
{'acc': 0.9713852, 'precision': 0.67116296, 'recall': 0.6074719, 'specificity': 0.6074719, 'f1': 0.63134485, 'auroc': 0.8000732, 'binary_precision': 0.36153847, 'binary_recall': 0.22488038, 'binary_specificity': 0.9900634, 'binary_f1_score': 0.27728614}
confusion matrix:
       0    1
0  16540  166
1    324   94
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9214229, 'precision': 0.7199294, 'recall': 0.555277, 'specificity': 0.555277, 'f1': 0.5768098, 'auroc': 0.7859895, 'binary_precision': 0.5106383, 'binary_recall': 0.120451696, 'binary_specificity': 0.99010223, 'binary_f1_score': 0.19492386}
confusion matrix:
      0   1
0  9203  92
1   701  96
early stop counter: 2
val acc:0.9713851809501648, best validation acc: 0.9734874963760376, corresponding to test acc:                         0.9221165180206299 / 0.9239991903305054
after epoch: 4,now: 2024-08-08 16:31:54.995218,epoch time: 0:28:45.659094,used: 1:54:45.670638,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_37_09_seed_2_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9628211, 'precision': 0.96433365, 'recall': 0.96282774, 'specificity': 0.96282774, 'f1': 0.9627912, 'auroc': 0.9895017, 'binary_precision': 0.9908927, 'binary_recall': 0.9342461, 'binary_specificity': 0.99140936, 'binary_f1_score': 0.961736}
confusion matrix:
       0      1
0  25620    222
1   1700  24154
---- Validation: 
scalar performance:
{'acc': 0.9734291, 'precision': 0.7107688, 'recall': 0.6528367, 'specificity': 0.6528367, 'f1': 0.6768031, 'auroc': 0.82788527, 'binary_precision': 0.4385382, 'binary_recall': 0.31578946, 'binary_specificity': 0.9898839, 'binary_f1_score': 0.36717662}
confusion matrix:
       0    1
0  16537  169
1    286  132
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9223147, 'precision': 0.7291026, 'recall': 0.5769828, 'specificity': 0.5769828, 'f1': 0.60617954, 'auroc': 0.8168746, 'binary_precision': 0.5256917, 'binary_recall': 0.16687578, 'binary_specificity': 0.9870898, 'binary_f1_score': 0.25333333}
confusion matrix:
      0    1
0  9175  120
1   664  133
early stop counter: 3
val acc:0.9734290838241577, best validation acc: 0.9734874963760376, corresponding to test acc:                         0.9221165180206299 / 0.9239991903305054
after epoch: 5,now: 2024-08-08 17:01:47.920952,epoch time: 0:29:52.925734,used: 2:24:38.596372,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_37_09_seed_2_24111575
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:24:38.596372 at 2024-08-08 17:01:47.920952
persisted model performance metric: 

scalar performance:
{'acc': 0.9221165, 'precision': 0.772841, 'recall': 0.5166514, 'specificity': 0.5166514, 'f1': 0.5129357, 'auroc': 0.6854359, 'binary_precision': 0.62222224, 'binary_recall': 0.035131745, 'binary_specificity': 0.99817103, 'binary_f1_score': 0.066508316}
confusion matrix:
      0   1
0  9278  17
1   769  28
oracle model performance metric: 

scalar performance:
{'acc': 0.9239992, 'precision': 0.75718427, 'recall': 0.56126404, 'specificity': 0.56126404, 'f1': 0.5867021, 'auroc': 0.7742362, 'binary_precision': 0.58426964, 'binary_recall': 0.13048933, 'binary_specificity': 0.9920387, 'binary_f1_score': 0.21333332}
confusion matrix:
      0    1
0  9221   74
1   693  104
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/17.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/17.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB |    787 TiB |    787 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    777 TiB |    777 TiB |
|       from small pool |  18218 KiB |     38 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB |    787 TiB |    787 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    777 TiB |    777 TiB |
|       from small pool |  18218 KiB |     38 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB |    787 TiB |    787 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    777 TiB |    777 TiB |
|       from small pool |  16662 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   6590 MiB |   4236 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   6530 MiB |   4214 MiB |
|       from small pool |     38 MiB |     42 MiB |     60 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 231558 KiB | 446569 GiB | 446569 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 436029 GiB | 436029 GiB |
|       from small pool |  10454 KiB |  26061 KiB |  10539 GiB |  10539 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6957    |  123050 K  |  123045 K  |
|       from large pool |      79    |     252    |   73628 K  |   73628 K  |
|       from small pool |    4353    |    6877    |   49421 K  |   49417 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6957    |  123050 K  |  123045 K  |
|       from large pool |      79    |     252    |   73628 K  |   73628 K  |
|       from small pool |    4353    |    6877    |   49421 K  |   49417 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     298    |     183    |
|       from large pool |      96    |      97    |     268    |     172    |
|       from small pool |      19    |      21    |      30    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3247    |   82085 K  |   82085 K  |
|       from large pool |      11    |     100    |   55682 K  |   55682 K  |
|       from small pool |      28    |    3236    |   26402 K  |   26402 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    787 TiB |    787 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    777 TiB |    777 TiB |
|       from small pool |      0 KiB |     38 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    787 TiB |    787 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    777 TiB |    777 TiB |
|       from small pool |      0 KiB |     38 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    787 TiB |    787 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    777 TiB |    777 TiB |
|       from small pool |      0 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   6590 MiB |   6356 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6530 MiB |   6324 MiB |
|       from small pool |  28672 KiB |     42 MiB |     60 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 446569 GiB | 446569 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 436030 GiB | 436030 GiB |
|       from small pool |      0 KiB |  26061 KiB |  10539 GiB |  10539 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6957    |  123050 K  |  123050 K  |
|       from large pool |       2    |     252    |   73628 K  |   73628 K  |
|       from small pool |       0    |    6877    |   49421 K  |   49421 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6957    |  123050 K  |  123050 K  |
|       from large pool |       2    |     252    |   73628 K  |   73628 K  |
|       from small pool |       0    |    6877    |   49421 K  |   49421 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     298    |     274    |
|       from large pool |      10    |      97    |     268    |     258    |
|       from small pool |      14    |      21    |      30    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3247    |   82087 K  |   82087 K  |
|       from large pool |       3    |     100    |   55682 K  |   55682 K  |
|       from small pool |       0    |    3236    |   26404 K  |   26404 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  8 17:17:06 2024]
Finished job 0.
1 of 1 steps (100%) done
