Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  8 10:49:01 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/18.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=18
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_00_43_seed_0_24111578

 Experiment start at: 2024-08-08 11:00:44.123536
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.28613802790641785
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93276215, 'precision': 0.9380497, 'recall': 0.9327991, 'specificity': 0.9327991, 'f1': 0.9325626, 'auroc': 0.97579217, 'binary_precision': 0.9863445, 'binary_recall': 0.87776685, 'binary_specificity': 0.98783135, 'binary_f1_score': 0.92889357}
confusion matrix:
       0      1
0  25003    308
1   3098  22247
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.96045727, 'precision': 0.5283517, 'recall': 0.5215137, 'specificity': 0.5215137, 'f1': 0.52424055, 'auroc': 0.6650578, 'binary_precision': 0.079872206, 'binary_recall': 0.060240965, 'binary_specificity': 0.9827864, 'binary_f1_score': 0.06868132}
confusion matrix:
       0    1
0  16443  288
1    390   25
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9091359, 'precision': 0.5607941, 'recall': 0.5200572, 'specificity': 0.5200572, 'f1': 0.5224832, 'auroc': 0.80076176, 'binary_precision': 0.19502075, 'binary_recall': 0.06088083, 'binary_specificity': 0.97923356, 'binary_f1_score': 0.09279368}
confusion matrix:
      0    1
0  9148  194
1   725   47
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 11:38:03.253449,epoch time: 0:37:19.129913,used: 0:37:19.129913,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_00_43_seed_0_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9518122, 'precision': 0.9540464, 'recall': 0.9518317, 'specificity': 0.9518317, 'f1': 0.95175433, 'auroc': 0.98503625, 'binary_precision': 0.98603505, 'binary_recall': 0.9166601, 'binary_specificity': 0.98700327, 'binary_f1_score': 0.9500828}
confusion matrix:
       0      1
0  24985    329
1   2112  23230
---- Validation: 
scalar performance:
{'acc': 0.9690307, 'precision': 0.6380724, 'recall': 0.5952279, 'specificity': 0.5952279, 'f1': 0.61226827, 'auroc': 0.750414, 'binary_precision': 0.29577464, 'binary_recall': 0.20240964, 'binary_specificity': 0.98804617, 'binary_f1_score': 0.24034336}
confusion matrix:
       0    1
0  16531  200
1    331   84
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9138817, 'precision': 0.66706747, 'recall': 0.6052126, 'specificity': 0.6052126, 'f1': 0.62669885, 'auroc': 0.85728484, 'binary_precision': 0.39490446, 'binary_recall': 0.24093264, 'binary_specificity': 0.9694926, 'binary_f1_score': 0.29927596}
confusion matrix:
      0    1
0  9057  285
1   586  186
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 12:08:05.926725,epoch time: 0:30:02.673276,used: 1:07:21.803189,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_00_43_seed_0_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9601232, 'precision': 0.9612298, 'recall': 0.96013874, 'specificity': 0.96013874, 'f1': 0.9601002, 'auroc': 0.98841894, 'binary_precision': 0.9839807, 'binary_recall': 0.93552715, 'binary_specificity': 0.98475033, 'binary_f1_score': 0.9591424}
confusion matrix:
       0      1
0  24926    386
1   1634  23710
---- Validation: 
scalar performance:
{'acc': 0.95987403, 'precision': 0.61538345, 'recall': 0.64928275, 'specificity': 0.64928275, 'f1': 0.62984824, 'auroc': 0.7862935, 'binary_precision': 0.24768947, 'binary_recall': 0.32289156, 'binary_specificity': 0.9756739, 'binary_f1_score': 0.28033474}
confusion matrix:
       0    1
0  16324  407
1    281  134
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90864146, 'precision': 0.68152976, 'recall': 0.695657, 'specificity': 0.695657, 'f1': 0.6882288, 'auroc': 0.8718746, 'binary_precision': 0.40930787, 'binary_recall': 0.44430053, 'binary_specificity': 0.9470135, 'binary_f1_score': 0.426087}
confusion matrix:
      0    1
0  8847  495
1   429  343
early stop counter: 1
val acc:0.9598740339279175, best validation acc: 0.9690306782722473, corresponding to test acc:                         0.9138817191123962 / 0.9138817191123962
after epoch: 3,now: 2024-08-08 12:35:55.443119,epoch time: 0:27:49.516394,used: 1:35:11.319583,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_00_43_seed_0_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.96748656, 'precision': 0.9679693, 'recall': 0.9674968, 'specificity': 0.9674968, 'f1': 0.9674787, 'auroc': 0.9919245, 'binary_precision': 0.98315865, 'binary_recall': 0.95131, 'binary_specificity': 0.98368365, 'binary_f1_score': 0.9669721}
confusion matrix:
       0      1
0  24899    413
1   1234  24110
---- Validation: 
scalar performance:
{'acc': 0.9481512, 'precision': 0.596922, 'recall': 0.6855736, 'specificity': 0.6855736, 'f1': 0.62487984, 'auroc': 0.80394137, 'binary_precision': 0.20884521, 'binary_recall': 0.40963855, 'binary_specificity': 0.9615086, 'binary_f1_score': 0.2766477}
confusion matrix:
       0    1
0  16087  644
1    245  170
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90112716, 'precision': 0.6814099, 'recall': 0.75456893, 'specificity': 0.75456893, 'f1': 0.7092871, 'auroc': 0.8834581, 'binary_precision': 0.39875665, 'binary_recall': 0.5816062, 'binary_specificity': 0.9275316, 'binary_f1_score': 0.4731296}
confusion matrix:
      0    1
0  8665  677
1   323  449
early stop counter: 2
val acc:0.948151171207428, best validation acc: 0.9690306782722473, corresponding to test acc:                         0.9138817191123962 / 0.9138817191123962
after epoch: 4,now: 2024-08-08 13:07:25.225213,epoch time: 0:31:29.782094,used: 2:06:41.101677,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_00_43_seed_0_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.96991473, 'precision': 0.97034657, 'recall': 0.9699256, 'specificity': 0.9699256, 'f1': 0.96990824, 'auroc': 0.99327517, 'binary_precision': 0.98477817, 'binary_recall': 0.95462793, 'binary_specificity': 0.98522323, 'binary_f1_score': 0.96946865}
confusion matrix:
       0      1
0  24936    374
1   1150  24196
---- Validation: 
scalar performance:
{'acc': 0.9518255, 'precision': 0.6088016, 'recall': 0.6968558, 'specificity': 0.6968558, 'f1': 0.6381186, 'auroc': 0.8205006, 'binary_precision': 0.23207301, 'binary_recall': 0.42891565, 'binary_specificity': 0.9647959, 'binary_f1_score': 0.30118442}
confusion matrix:
       0    1
0  16142  589
1    237  178
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9055764, 'precision': 0.6887529, 'recall': 0.7522242, 'specificity': 0.7522242, 'f1': 0.7141015, 'auroc': 0.8864286, 'binary_precision': 0.4140845, 'binary_recall': 0.5712435, 'binary_specificity': 0.9332049, 'binary_f1_score': 0.48013064}
confusion matrix:
      0    1
0  8718  624
1   331  441
early stop counter: 3
val acc:0.9518254995346069, best validation acc: 0.9690306782722473, corresponding to test acc:                         0.9138817191123962 / 0.9138817191123962
after epoch: 5,now: 2024-08-08 13:39:18.920023,epoch time: 0:31:53.694810,used: 2:38:34.796487,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_11_00_43_seed_0_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:38:34.796487 at 2024-08-08 13:39:18.920023
persisted model performance metric: 

scalar performance:
{'acc': 0.9138817, 'precision': 0.66706747, 'recall': 0.6052126, 'specificity': 0.6052126, 'f1': 0.62669885, 'auroc': 0.85728484, 'binary_precision': 0.39490446, 'binary_recall': 0.24093264, 'binary_specificity': 0.9694926, 'binary_f1_score': 0.29927596}
confusion matrix:
      0    1
0  9057  285
1   586  186
oracle model performance metric: 

scalar performance:
{'acc': 0.9138817, 'precision': 0.66706747, 'recall': 0.6052126, 'specificity': 0.6052126, 'f1': 0.62669885, 'auroc': 0.85728484, 'binary_precision': 0.39490446, 'binary_recall': 0.24093264, 'binary_specificity': 0.9694926, 'binary_f1_score': 0.29927596}
confusion matrix:
      0    1
0  9057  285
1   586  186
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/18.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/18.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/18.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198886 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |  18224 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198886 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |  18224 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   2141 MiB | 251346 GiB | 251346 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 248159 GiB | 248159 GiB |
|       from small pool |  16663 KiB |     36 MiB |   3186 GiB |   3186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  63258 KiB | 225565 KiB | 136364 GiB | 136364 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 133152 GiB | 133152 GiB |
|       from small pool |  12496 KiB |  12998 KiB |   3212 GiB |   3212 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4444    |    6827    |   38387 K  |   38382 K  |
|       from large pool |      79    |     252    |   22954 K  |   22954 K  |
|       from small pool |    4365    |    6747    |   15432 K  |   15428 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4444    |    6827    |   38387 K  |   38382 K  |
|       from large pool |      79    |     252    |   22954 K  |   22954 K  |
|       from small pool |    4365    |    6747    |   15432 K  |   15428 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3182    |   24594 K  |   24594 K  |
|       from large pool |      10    |      97    |   17900 K  |   17900 K  |
|       from small pool |      30    |    3172    |    6693 K  |    6693 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 251346 GiB | 251346 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 248159 GiB | 248159 GiB |
|       from small pool |      0 KiB |     36 MiB |   3186 GiB |   3186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   2372 MiB |   2372 MiB |   2116 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 136364 GiB | 136364 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 133152 GiB | 133152 GiB |
|       from small pool |      0 KiB |  26061 KiB |   3212 GiB |   3212 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |     118    |     118    |      92    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   24596 K  |   24596 K  |
|       from large pool |       3    |      97    |   17900 K  |   17900 K  |
|       from small pool |       0    |    3172    |    6695 K  |    6695 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 251370 GiB | 251370 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 248178 GiB | 248178 GiB |
|       from small pool |      0 KiB |     38 MiB |   3191 GiB |   3191 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 251346 GiB | 251346 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 248159 GiB | 248159 GiB |
|       from small pool |      0 KiB |     36 MiB |   3186 GiB |   3186 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   2372 MiB |   2372 MiB |   2116 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 136364 GiB | 136364 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 133152 GiB | 133152 GiB |
|       from small pool |      0 KiB |  26061 KiB |   3212 GiB |   3212 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6827    |   38387 K  |   38387 K  |
|       from large pool |       2    |     252    |   22954 K  |   22954 K  |
|       from small pool |       0    |    6747    |   15432 K  |   15432 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |     118    |     118    |      92    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3182    |   24596 K  |   24596 K  |
|       from large pool |       3    |      97    |   17900 K  |   17900 K  |
|       from small pool |       0    |    3172    |    6695 K  |    6695 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578

 Experiment start at: 2024-08-08 14:02:44.187882
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6057873368263245
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9321294, 'precision': 0.9352703, 'recall': 0.93216455, 'specificity': 0.93216455, 'f1': 0.9320104, 'auroc': 0.9759414, 'binary_precision': 0.97245264, 'binary_recall': 0.8895703, 'binary_specificity': 0.9747588, 'binary_f1_score': 0.92916685}
confusion matrix:
       0      1
0  24754    641
1   2809  22628
---- Validation: 
scalar performance:
{'acc': 0.9490159, 'precision': 0.56080663, 'recall': 0.5862123, 'specificity': 0.5862123, 'f1': 0.57074064, 'auroc': 0.7856618, 'binary_precision': 0.14239483, 'binary_recall': 0.20417634, 'binary_specificity': 0.96824825, 'binary_f1_score': 0.16777885}
confusion matrix:
       0    1
0  16162  530
1    343   88
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8965415, 'precision': 0.6335138, 'recall': 0.64060825, 'specificity': 0.64060825, 'f1': 0.6369267, 'auroc': 0.836434, 'binary_precision': 0.32084894, 'binary_recall': 0.339498, 'binary_specificity': 0.94171846, 'binary_f1_score': 0.32991013}
confusion matrix:
      0    1
0  8790  544
1   500  257
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 14:35:23.102932,epoch time: 0:32:38.915050,used: 0:32:38.915050,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9519594, 'precision': 0.95399654, 'recall': 0.9519872, 'specificity': 0.9519872, 'f1': 0.95190746, 'auroc': 0.98722327, 'binary_precision': 0.9846154, 'binary_recall': 0.9183473, 'binary_specificity': 0.9856271, 'binary_f1_score': 0.95032746}
confusion matrix:
       0      1
0  25030    365
1   2077  23360
---- Validation: 
scalar performance:
{'acc': 0.9643754, 'precision': 0.6328019, 'recall': 0.6279945, 'specificity': 0.6279945, 'f1': 0.63034815, 'auroc': 0.8493207, 'binary_precision': 0.28433734, 'binary_recall': 0.2737819, 'binary_specificity': 0.98220706, 'binary_f1_score': 0.2789598}
confusion matrix:
       0    1
0  16395  297
1    313  118
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91041523, 'precision': 0.6872576, 'recall': 0.7154774, 'specificity': 0.7154774, 'f1': 0.70001316, 'auroc': 0.882338, 'binary_precision': 0.41676104, 'binary_recall': 0.48612946, 'binary_specificity': 0.94482535, 'binary_f1_score': 0.4487805}
confusion matrix:
      0    1
0  8819  515
1   389  368
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 15:07:21.944863,epoch time: 0:31:58.841931,used: 1:04:37.756981,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96006453, 'precision': 0.9613931, 'recall': 0.9600879, 'specificity': 0.9600879, 'f1': 0.9600372, 'auroc': 0.9908004, 'binary_precision': 0.98636967, 'binary_recall': 0.93309224, 'binary_specificity': 0.98708355, 'binary_f1_score': 0.9589915}
confusion matrix:
       0      1
0  25066    328
1   1702  23736
---- Validation: 
scalar performance:
{'acc': 0.9685219, 'precision': 0.66590255, 'recall': 0.6391623, 'specificity': 0.6391623, 'f1': 0.6512364, 'auroc': 0.8652945, 'binary_precision': 0.35, 'binary_recall': 0.29234338, 'binary_specificity': 0.9859813, 'binary_f1_score': 0.31858405}
confusion matrix:
       0    1
0  16458  234
1    305  126
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9171539, 'precision': 0.7068205, 'recall': 0.73065174, 'specificity': 0.73065174, 'f1': 0.7178657, 'auroc': 0.8861624, 'binary_precision': 0.45369285, 'binary_recall': 0.51122856, 'binary_specificity': 0.950075, 'binary_f1_score': 0.48074535}
confusion matrix:
      0    1
0  8868  466
1   370  387
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-08 15:37:56.430837,epoch time: 0:30:34.485974,used: 1:35:12.242955,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9676188, 'precision': 0.9682608, 'recall': 0.9676328, 'specificity': 0.9676328, 'f1': 0.96760845, 'auroc': 0.9931996, 'binary_precision': 0.9857872, 'binary_recall': 0.94896793, 'binary_specificity': 0.9862976, 'binary_f1_score': 0.9670273}
confusion matrix:
       0      1
0  25049    348
1   1298  24137
---- Validation: 
scalar performance:
{'acc': 0.96811306, 'precision': 0.6639073, 'recall': 0.64234304, 'specificity': 0.64234304, 'f1': 0.6522844, 'auroc': 0.8685492, 'binary_precision': 0.3458445, 'binary_recall': 0.29930395, 'binary_specificity': 0.9853822, 'binary_f1_score': 0.32089552}
confusion matrix:
       0    1
0  16448  244
1    302  129
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91626203, 'precision': 0.70377356, 'recall': 0.72652805, 'specificity': 0.72652805, 'f1': 0.7143421, 'auroc': 0.878878, 'binary_precision': 0.4482353, 'binary_recall': 0.5033025, 'binary_specificity': 0.9497536, 'binary_f1_score': 0.47417545}
confusion matrix:
      0    1
0  8865  469
1   376  381
early stop counter: 1
val acc:0.9681130647659302, best validation acc: 0.9685218930244446, corresponding to test acc:                         0.9171538949012756 / 0.9171538949012756
after epoch: 4,now: 2024-08-08 16:07:18.954177,epoch time: 0:29:22.523340,used: 2:04:34.766295,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9719665, 'precision': 0.9723783, 'recall': 0.971977, 'specificity': 0.971977, 'f1': 0.9719608, 'auroc': 0.99476653, 'binary_precision': 0.98650455, 'binary_recall': 0.95706534, 'binary_specificity': 0.9868887, 'binary_f1_score': 0.97156197}
confusion matrix:
       0      1
0  25065    333
1   1092  24342
---- Validation: 
scalar performance:
{'acc': 0.96583545, 'precision': 0.6551324, 'recall': 0.6603872, 'specificity': 0.6603872, 'f1': 0.657711, 'auroc': 0.86750126, 'binary_precision': 0.32735425, 'binary_recall': 0.3387471, 'binary_specificity': 0.9820273, 'binary_f1_score': 0.33295327}
confusion matrix:
       0    1
0  16392  300
1    285  146
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9075414, 'precision': 0.68880284, 'recall': 0.7485192, 'specificity': 0.7485192, 'f1': 0.7130077, 'auroc': 0.87524956, 'binary_precision': 0.41423002, 'binary_recall': 0.5614267, 'binary_specificity': 0.9356117, 'binary_f1_score': 0.4767246}
confusion matrix:
      0    1
0  8733  601
1   332  425
early stop counter: 2
val acc:0.965835452079773, best validation acc: 0.9685218930244446, corresponding to test acc:                         0.9171538949012756 / 0.9171538949012756
after epoch: 5,now: 2024-08-08 16:38:25.252216,epoch time: 0:31:06.298039,used: 2:35:41.064334,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9717304, 'precision': 0.972415, 'recall': 0.9717455, 'specificity': 0.9717455, 'f1': 0.9717208, 'auroc': 0.9950594, 'binary_precision': 0.99059653, 'binary_recall': 0.95254755, 'binary_specificity': 0.99094343, 'binary_f1_score': 0.9711995}
confusion matrix:
       0      1
0  25166    230
1   1207  24229
---- Validation: 
scalar performance:
{'acc': 0.96630263, 'precision': 0.660131, 'recall': 0.6662775, 'specificity': 0.6662775, 'f1': 0.6631399, 'auroc': 0.871835, 'binary_precision': 0.33705357, 'binary_recall': 0.35034803, 'binary_specificity': 0.98220706, 'binary_f1_score': 0.34357226}
confusion matrix:
       0    1
0  16395  297
1    280  151
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90258646, 'precision': 0.683402, 'recall': 0.7640489, 'specificity': 0.7640489, 'f1': 0.7134851, 'auroc': 0.8790218, 'binary_precision': 0.40052816, 'binary_recall': 0.6010568, 'binary_specificity': 0.92704093, 'binary_f1_score': 0.4807184}
confusion matrix:
      0    1
0  8653  681
1   302  455
early stop counter: 3
val acc:0.9663026332855225, best validation acc: 0.9685218930244446, corresponding to test acc:                         0.9171538949012756 / 0.9171538949012756
after epoch: 6,now: 2024-08-08 17:09:22.477619,epoch time: 0:30:57.225403,used: 3:06:38.289737,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_14_02_43_seed_1_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 3:06:38.289737 at 2024-08-08 17:09:22.477619
persisted model performance metric: 

scalar performance:
{'acc': 0.9171539, 'precision': 0.7068205, 'recall': 0.73065174, 'specificity': 0.73065174, 'f1': 0.7178657, 'auroc': 0.8861624, 'binary_precision': 0.45369285, 'binary_recall': 0.51122856, 'binary_specificity': 0.950075, 'binary_f1_score': 0.48074535}
confusion matrix:
      0    1
0  8868  466
1   370  387
oracle model performance metric: 

scalar performance:
{'acc': 0.9171539, 'precision': 0.7068205, 'recall': 0.73065174, 'specificity': 0.73065174, 'f1': 0.7178657, 'auroc': 0.8861624, 'binary_precision': 0.45369285, 'binary_recall': 0.51122856, 'binary_specificity': 0.950075, 'binary_f1_score': 0.48074535}
confusion matrix:
      0    1
0  8868  466
1   370  387
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/18.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/18.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |  18218 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |  18218 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB | 550556 GiB | 550555 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 543604 GiB | 543604 GiB |
|       from small pool |  16662 KiB |     36 MiB |   6951 GiB |   6951 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   4470 MiB |   2116 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   4420 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     50 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 231558 KiB | 303491 GiB | 303491 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 296338 GiB | 296338 GiB |
|       from small pool |  10454 KiB |  26061 KiB |   7153 GiB |   7153 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6849    |   84032 K  |   84027 K  |
|       from large pool |      79    |     252    |   50264 K  |   50264 K  |
|       from small pool |    4353    |    6769    |   33767 K  |   33763 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6849    |   84032 K  |   84027 K  |
|       from large pool |      79    |     252    |   50264 K  |   50264 K  |
|       from small pool |    4353    |    6769    |   33767 K  |   33763 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     207    |      92    |
|       from large pool |      96    |      97    |     182    |      86    |
|       from small pool |      19    |      21    |      25    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3194    |   55600 K  |   55600 K  |
|       from large pool |      11    |     100    |   38272 K  |   38272 K  |
|       from small pool |      28    |    3183    |   17328 K  |   17328 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 550556 GiB | 550556 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 543604 GiB | 543604 GiB |
|       from small pool |      0 KiB |     36 MiB |   6951 GiB |   6951 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4470 MiB |   4236 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 303491 GiB | 303491 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 296338 GiB | 296338 GiB |
|       from small pool |      0 KiB |  26061 KiB |   7153 GiB |   7153 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     207    |     183    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3194    |   55602 K  |   55602 K  |
|       from large pool |       3    |     100    |   38272 K  |   38272 K  |
|       from small pool |       0    |    3183    |   17330 K  |   17330 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 550621 GiB | 550621 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 543659 GiB | 543659 GiB |
|       from small pool |      0 KiB |     38 MiB |   6962 GiB |   6962 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 550556 GiB | 550556 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 543604 GiB | 543604 GiB |
|       from small pool |      0 KiB |     36 MiB |   6951 GiB |   6951 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   4470 MiB |   4236 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 303491 GiB | 303491 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 296338 GiB | 296338 GiB |
|       from small pool |      0 KiB |  26061 KiB |   7153 GiB |   7153 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6849    |   84032 K  |   84032 K  |
|       from large pool |       2    |     252    |   50264 K  |   50264 K  |
|       from small pool |       0    |    6769    |   33767 K  |   33767 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     207    |     183    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3194    |   55602 K  |   55602 K  |
|       from large pool |       3    |     100    |   38272 K  |   38272 K  |
|       from small pool |       0    |    3183    |   17330 K  |   17330 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578

 Experiment start at: 2024-08-08 17:36:47.059430
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.11296075582504272
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.90699476, 'precision': 0.91850126, 'recall': 0.9070108, 'specificity': 0.9070108, 'f1': 0.9063534, 'auroc': 0.9568999, 'binary_precision': 0.9879434, 'binary_recall': 0.8240823, 'binary_specificity': 0.9899393, 'binary_f1_score': 0.89860386}
confusion matrix:
       0      1
0  25583    260
1   4548  21305
---- Validation: 
scalar performance:
{'acc': 0.9727867, 'precision': 0.50704706, 'recall': 0.50089586, 'specificity': 0.50089586, 'f1': 0.49735737, 'auroc': 0.5443857, 'binary_precision': 0.03846154, 'binary_recall': 0.004784689, 'binary_specificity': 0.9970071, 'binary_f1_score': 0.008510638}
confusion matrix:
       0   1
0  16656  50
1    416   2
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91934204, 'precision': 0.62064964, 'recall': 0.50768894, 'specificity': 0.50768894, 'f1': 0.49672806, 'auroc': 0.63162374, 'binary_precision': 0.31914893, 'binary_recall': 0.018820576, 'binary_specificity': 0.9965573, 'binary_f1_score': 0.03554502}
confusion matrix:
      0   1
0  9263  32
1   782  15
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-08 18:08:25.752673,epoch time: 0:31:38.693243,used: 0:31:38.693243,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.93875736, 'precision': 0.94298065, 'recall': 0.93876684, 'specificity': 0.93876684, 'f1': 0.938612, 'auroc': 0.9744905, 'binary_precision': 0.986282, 'binary_recall': 0.88991606, 'binary_specificity': 0.98761755, 'binary_f1_score': 0.93562424}
confusion matrix:
       0      1
0  25523    320
1   2846  23007
---- Validation: 
scalar performance:
{'acc': 0.97500587, 'precision': 0.67870945, 'recall': 0.5183606, 'specificity': 0.5183606, 'f1': 0.528449, 'auroc': 0.6565107, 'binary_precision': 0.3809524, 'binary_recall': 0.03827751, 'binary_specificity': 0.99844366, 'binary_f1_score': 0.069565214}
confusion matrix:
       0   1
0  16680  26
1    402  16
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92181927, 'precision': 0.74888206, 'recall': 0.5182107, 'specificity': 0.5182107, 'f1': 0.5160222, 'auroc': 0.71042395, 'binary_precision': 0.5740741, 'binary_recall': 0.03889586, 'binary_specificity': 0.9975256, 'binary_f1_score': 0.072855465}
confusion matrix:
      0   1
0  9272  23
1   766  31
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-08 18:36:42.643136,epoch time: 0:28:16.890463,used: 0:59:55.583706,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.95274293, 'precision': 0.95500946, 'recall': 0.95275116, 'specificity': 0.95275116, 'f1': 0.95268464, 'auroc': 0.98214686, 'binary_precision': 0.98718107, 'binary_recall': 0.9174209, 'binary_specificity': 0.9880814, 'binary_f1_score': 0.9510234}
confusion matrix:
       0      1
0  25534    308
1   2135  23719
---- Validation: 
scalar performance:
{'acc': 0.976349, 'precision': 0.76985496, 'recall': 0.57036364, 'specificity': 0.57036364, 'f1': 0.60828096, 'auroc': 0.7291704, 'binary_precision': 0.5607477, 'binary_recall': 0.14354067, 'binary_specificity': 0.99718666, 'binary_f1_score': 0.22857143}
confusion matrix:
       0   1
0  16659  47
1    358  60
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9212247, 'precision': 0.71759856, 'recall': 0.56549346, 'specificity': 0.56549346, 'f1': 0.5906917, 'auroc': 0.77983856, 'binary_precision': 0.50442475, 'binary_recall': 0.14303638, 'binary_specificity': 0.9879505, 'binary_f1_score': 0.22287388}
confusion matrix:
      0    1
0  9183  112
1   683  114
better model found
persisted
after epoch: 3,now: 2024-08-08 19:06:56.903308,epoch time: 0:30:14.260172,used: 1:30:09.843878,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.95467734, 'precision': 0.9574622, 'recall': 0.9546849, 'specificity': 0.9546849, 'f1': 0.9546088, 'auroc': 0.98600835, 'binary_precision': 0.993203, 'binary_recall': 0.91563845, 'binary_specificity': 0.9937314, 'binary_f1_score': 0.95284486}
confusion matrix:
       0      1
0  25681    162
1   2181  23672
---- Validation: 
scalar performance:
{'acc': 0.9753562, 'precision': 0.73268217, 'recall': 0.58035105, 'specificity': 0.58035105, 'f1': 0.6169509, 'auroc': 0.77232313, 'binary_precision': 0.48591548, 'binary_recall': 0.16507177, 'binary_specificity': 0.9956303, 'binary_f1_score': 0.24642858}
confusion matrix:
       0   1
0  16633  73
1    349  69
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92281014, 'precision': 0.7355722, 'recall': 0.57151616, 'specificity': 0.57151616, 'f1': 0.5996701, 'auroc': 0.8010808, 'binary_precision': 0.5394737, 'binary_recall': 0.15432873, 'binary_specificity': 0.9887036, 'binary_f1_score': 0.24}
confusion matrix:
      0    1
0  9190  105
1   674  123
new oracle model saved
early stop counter: 1
val acc:0.9753562211990356, best validation acc: 0.9763489961624146, corresponding to test acc:                         0.9212247133255005 / 0.9228101372718811
after epoch: 4,now: 2024-08-08 19:35:50.638554,epoch time: 0:28:53.735246,used: 1:59:03.579124,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.96442664, 'precision': 0.9654614, 'recall': 0.9644312, 'specificity': 0.9644312, 'f1': 0.96440715, 'auroc': 0.9900061, 'binary_precision': 0.98745537, 'binary_recall': 0.94081926, 'binary_specificity': 0.9880432, 'binary_f1_score': 0.96357334}
confusion matrix:
       0      1
0  25534    309
1   1530  24323
---- Validation: 
scalar performance:
{'acc': 0.97541463, 'precision': 0.73752487, 'recall': 0.62819695, 'specificity': 0.62819695, 'f1': 0.6653433, 'auroc': 0.8093909, 'binary_precision': 0.49327356, 'binary_recall': 0.2631579, 'binary_specificity': 0.99323595, 'binary_f1_score': 0.3432137}
confusion matrix:
       0    1
0  16593  113
1    308  110
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9223147, 'precision': 0.72764194, 'recall': 0.61082286, 'specificity': 0.61082286, 'f1': 0.6437694, 'auroc': 0.8232541, 'binary_precision': 0.5175202, 'binary_recall': 0.24090339, 'binary_specificity': 0.98074234, 'binary_f1_score': 0.32876712}
confusion matrix:
      0    1
0  9116  179
1   605  192
early stop counter: 2
val acc:0.9754146337509155, best validation acc: 0.9763489961624146, corresponding to test acc:                         0.9212247133255005 / 0.9228101372718811
after epoch: 5,now: 2024-08-08 20:04:04.891039,epoch time: 0:28:14.252485,used: 2:27:17.831609,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9670768, 'precision': 0.9679826, 'recall': 0.9670819, 'specificity': 0.9670819, 'f1': 0.96706116, 'auroc': 0.9912139, 'binary_precision': 0.98862994, 'binary_recall': 0.94503754, 'binary_specificity': 0.9891262, 'binary_f1_score': 0.96634245}
confusion matrix:
       0      1
0  25561    281
1   1421  24433
---- Validation: 
scalar performance:
{'acc': 0.97418827, 'precision': 0.7178209, 'recall': 0.6357321, 'specificity': 0.6357321, 'f1': 0.666494, 'auroc': 0.82058644, 'binary_precision': 0.45348838, 'binary_recall': 0.2799043, 'binary_specificity': 0.9915599, 'binary_f1_score': 0.34615383}
confusion matrix:
       0    1
0  16565  141
1    301  117
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92290926, 'precision': 0.7316195, 'recall': 0.61917543, 'specificity': 0.61917543, 'f1': 0.6526291, 'auroc': 0.82720196, 'binary_precision': 0.524173, 'binary_recall': 0.25846925, 'binary_specificity': 0.97988164, 'binary_f1_score': 0.3462185}
confusion matrix:
      0    1
0  9108  187
1   591  206
new oracle model saved
early stop counter: 3
val acc:0.9741882681846619, best validation acc: 0.9763489961624146, corresponding to test acc:                         0.9212247133255005 / 0.9229092597961426
after epoch: 6,now: 2024-08-08 20:32:08.787535,epoch time: 0:28:03.896496,used: 2:55:21.728105,model: dset_te_center4_dann_b8efecac6_not_commited_2024md_08md_08_17_36_46_seed_2_24111578
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 2:55:21.728105 at 2024-08-08 20:32:08.787535
persisted model performance metric: 

scalar performance:
{'acc': 0.9212247, 'precision': 0.71759856, 'recall': 0.56549346, 'specificity': 0.56549346, 'f1': 0.5906917, 'auroc': 0.77983856, 'binary_precision': 0.50442475, 'binary_recall': 0.14303638, 'binary_specificity': 0.9879505, 'binary_f1_score': 0.22287388}
confusion matrix:
      0    1
0  9183  112
1   683  114
oracle model performance metric: 

scalar performance:
{'acc': 0.92290926, 'precision': 0.7316195, 'recall': 0.61917543, 'specificity': 0.61917543, 'f1': 0.6526291, 'auroc': 0.82720196, 'binary_precision': 0.524173, 'binary_recall': 0.25846925, 'binary_specificity': 0.97988164, 'binary_f1_score': 0.3462185}
confusion matrix:
      0    1
0  9108  187
1   591  206
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/rule_results/18.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-07_17-53-28/confusion_matrix/18.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197429 KiB |   2142 MiB |    834 TiB |    834 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    823 TiB |    823 TiB |
|       from small pool |  18218 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 197429 KiB |   2142 MiB |    834 TiB |    834 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    823 TiB |    823 TiB |
|       from small pool |  18218 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   2141 MiB |    834 TiB |    834 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    823 TiB |    823 TiB |
|       from small pool |  16662 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   6590 MiB |   4236 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   6530 MiB |   4214 MiB |
|       from small pool |     38 MiB |     42 MiB |     60 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42187 KiB | 231558 KiB | 473103 GiB | 473103 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 461954 GiB | 461954 GiB |
|       from small pool |  10454 KiB |  26061 KiB |  11148 GiB |  11148 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4432    |    6957    |  130315 K  |  130311 K  |
|       from large pool |      79    |     252    |   77983 K  |   77983 K  |
|       from small pool |    4353    |    6877    |   52332 K  |   52328 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4432    |    6957    |  130315 K  |  130311 K  |
|       from large pool |      79    |     252    |   77983 K  |   77983 K  |
|       from small pool |    4353    |    6877    |   52332 K  |   52328 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     298    |     183    |
|       from large pool |      96    |      97    |     268    |     172    |
|       from small pool |      19    |      21    |      30    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      40    |    3247    |   86918 K  |   86918 K  |
|       from large pool |      11    |     100    |   58954 K  |   58954 K  |
|       from small pool |      29    |    3236    |   27963 K  |   27963 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    834 TiB |    834 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    823 TiB |    823 TiB |
|       from small pool |      0 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    834 TiB |    834 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    823 TiB |    823 TiB |
|       from small pool |      0 KiB |     38 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    834 TiB |    834 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    823 TiB |    823 TiB |
|       from small pool |      0 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   2372 MiB |   6590 MiB |   6356 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6530 MiB |   6324 MiB |
|       from small pool |  28672 KiB |     42 MiB |     60 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 231558 KiB | 473103 GiB | 473103 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 461954 GiB | 461954 GiB |
|       from small pool |      0 KiB |  26061 KiB |  11148 GiB |  11148 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6957    |  130315 K  |  130315 K  |
|       from large pool |       2    |     252    |   77983 K  |   77983 K  |
|       from small pool |       0    |    6877    |   52332 K  |   52332 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6957    |  130315 K  |  130315 K  |
|       from large pool |       2    |     252    |   77983 K  |   77983 K  |
|       from small pool |       0    |    6877    |   52332 K  |   52332 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |     118    |     298    |     274    |
|       from large pool |      10    |      97    |     268    |     258    |
|       from small pool |      14    |      21    |      30    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3247    |   86920 K  |   86920 K  |
|       from large pool |       3    |     100    |   58954 K  |   58954 K  |
|       from small pool |       0    |    3236    |   27965 K  |   27965 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  8 20:46:22 2024]
Finished job 0.
1 of 1 steps (100%) done
