Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Aug 10 12:09:38 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_12_16_42_seed_0_24141967

 Experiment start at: 2024-08-10 12:16:43.064334
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.8852086067199707
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96371603, 'precision': 0.964716, 'recall': 0.96372616, 'specificity': 0.96372616, 'f1': 0.9636971, 'auroc': 0.9923293, 'binary_precision': 0.9863819, 'binary_recall': 0.9404475, 'binary_specificity': 0.98700476, 'binary_f1_score': 0.9628672}
confusion matrix:
       0      1
0  24988    329
1   1509  23830
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9599323, 'precision': 0.63226014, 'recall': 0.69396013, 'specificity': 0.69396013, 'f1': 0.65650094, 'auroc': 0.8493779, 'binary_precision': 0.2792208, 'binary_recall': 0.41445783, 'binary_specificity': 0.97346246, 'binary_f1_score': 0.33365664}
confusion matrix:
       0    1
0  16287  444
1    243  172
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91754, 'precision': 0.71308917, 'recall': 0.74206424, 'specificity': 0.74206424, 'f1': 0.72633725, 'auroc': 0.89591527, 'binary_precision': 0.4650901, 'binary_recall': 0.5349741, 'binary_specificity': 0.9491544, 'binary_f1_score': 0.4975904}
confusion matrix:
      0    1
0  8867  475
1   359  413
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-10 12:52:38.878477,epoch time: 0:35:55.814143,used: 0:35:55.814143,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_12_16_42_seed_0_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9735076, 'precision': 0.97374785, 'recall': 0.9735148, 'specificity': 0.9735148, 'f1': 0.9735045, 'auroc': 0.99567163, 'binary_precision': 0.9845756, 'binary_recall': 0.9621212, 'binary_specificity': 0.98490834, 'binary_f1_score': 0.9732189}
confusion matrix:
       0      1
0  24930    382
1    960  24384
---- Validation: 
scalar performance:
{'acc': 0.92744666, 'precision': 0.5790908, 'recall': 0.7278366, 'specificity': 0.7278366, 'f1': 0.60936564, 'auroc': 0.84903705, 'binary_precision': 0.17077045, 'binary_recall': 0.5180723, 'binary_specificity': 0.93760085, 'binary_f1_score': 0.25686976}
confusion matrix:
       0     1
0  15687  1044
1    200   215
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91101444, 'precision': 0.6996815, 'recall': 0.7527913, 'specificity': 0.7527913, 'f1': 0.721951, 'auroc': 0.887216, 'binary_precision': 0.43612775, 'binary_recall': 0.56606215, 'binary_specificity': 0.9395204, 'binary_f1_score': 0.49267194}
confusion matrix:
      0    1
0  8777  565
1   335  437
early stop counter: 1
val acc:0.9274466633796692, best validation acc: 0.9599323272705078, corresponding to test acc:                         0.9175400137901306 / 0.9175400137901306
after epoch: 2,now: 2024-08-10 13:27:43.881212,epoch time: 0:35:05.002735,used: 1:11:00.816878,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_12_16_42_seed_0_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97719914, 'precision': 0.97721076, 'recall': 0.9772008, 'specificity': 0.9772008, 'f1': 0.9771991, 'auroc': 0.99677694, 'binary_precision': 0.9797311, 'binary_recall': 0.97458965, 'binary_specificity': 0.97981197, 'binary_f1_score': 0.97715366}
confusion matrix:
       0      1
0  24801    511
1    644  24700
---- Validation: 
scalar performance:
{'acc': 0.85098565, 'precision': 0.5505763, 'recall': 0.7873523, 'specificity': 0.7873523, 'f1': 0.5538046, 'auroc': 0.85788, 'binary_precision': 0.1092038, 'binary_recall': 0.72048193, 'binary_specificity': 0.8542227, 'binary_f1_score': 0.18966065}
confusion matrix:
       0     1
0  14292  2439
1    116   299
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8664228, 'precision': 0.6590588, 'recall': 0.82846963, 'specificity': 0.82846963, 'f1': 0.6980007, 'auroc': 0.8955388, 'binary_precision': 0.33817774, 'binary_recall': 0.78367877, 'binary_specificity': 0.87326056, 'binary_f1_score': 0.4724717}
confusion matrix:
      0     1
0  8158  1184
1   167   605
early stop counter: 2
val acc:0.8509856462478638, best validation acc: 0.9599323272705078, corresponding to test acc:                         0.9175400137901306 / 0.9175400137901306
after epoch: 3,now: 2024-08-10 14:02:53.581787,epoch time: 0:35:09.700575,used: 1:46:10.517453,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_12_16_42_seed_0_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9810289, 'precision': 0.98112726, 'recall': 0.98103297, 'specificity': 0.98103297, 'f1': 0.9810281, 'auroc': 0.9975276, 'binary_precision': 0.9881472, 'binary_recall': 0.973759, 'binary_specificity': 0.9883069, 'binary_f1_score': 0.98090035}
confusion matrix:
       0      1
0  25018    296
1    665  24677
---- Validation: 
scalar performance:
{'acc': 0.9029511, 'precision': 0.5684478, 'recall': 0.7681571, 'specificity': 0.7681571, 'f1': 0.5931351, 'auroc': 0.8743429, 'binary_precision': 0.1469757, 'binary_recall': 0.62650603, 'binary_specificity': 0.90980816, 'binary_f1_score': 0.23809524}
confusion matrix:
       0     1
0  15222  1509
1    155   260
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8933162, 'precision': 0.6824385, 'recall': 0.8091612, 'specificity': 0.8091612, 'f1': 0.72206974, 'auroc': 0.89403105, 'binary_precision': 0.3905916, 'binary_recall': 0.7098446, 'binary_specificity': 0.90847784, 'binary_f1_score': 0.50390804}
confusion matrix:
      0    1
0  8487  855
1   224  548
early stop counter: 3
val acc:0.9029511213302612, best validation acc: 0.9599323272705078, corresponding to test acc:                         0.9175400137901306 / 0.9175400137901306
after epoch: 4,now: 2024-08-10 14:38:07.309880,epoch time: 0:35:13.728093,used: 2:21:24.245546,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_12_16_42_seed_0_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:21:24.245546 at 2024-08-10 14:38:07.309880
persisted model performance metric: 

scalar performance:
{'acc': 0.91754, 'precision': 0.71308917, 'recall': 0.74206424, 'specificity': 0.74206424, 'f1': 0.72633725, 'auroc': 0.89591527, 'binary_precision': 0.4650901, 'binary_recall': 0.5349741, 'binary_specificity': 0.9491544, 'binary_f1_score': 0.4975904}
confusion matrix:
      0    1
0  8867  475
1   359  413
oracle model performance metric: 

scalar performance:
{'acc': 0.91754, 'precision': 0.71308917, 'recall': 0.74206424, 'specificity': 0.74206424, 'f1': 0.72633725, 'auroc': 0.89591527, 'binary_precision': 0.4650901, 'binary_recall': 0.5349741, 'binary_specificity': 0.9491544, 'binary_f1_score': 0.4975904}
confusion matrix:
      0    1
0  8867  475
1   359  413
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1885 MiB |   6545 MiB | 340916 GiB | 340914 GiB |
|       from large pool |   1839 MiB |   6500 MiB | 337568 GiB | 337566 GiB |
|       from small pool |     46 MiB |     87 MiB |   3347 GiB |   3347 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1885 MiB |   6545 MiB | 340916 GiB | 340914 GiB |
|       from large pool |   1839 MiB |   6500 MiB | 337568 GiB | 337566 GiB |
|       from small pool |     46 MiB |     87 MiB |   3347 GiB |   3347 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1883 MiB |   6541 MiB | 340709 GiB | 340708 GiB |
|       from large pool |   1839 MiB |   6496 MiB | 337366 GiB | 337364 GiB |
|       from small pool |     44 MiB |     85 MiB |   3343 GiB |   3343 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6878 MiB |   6878 MiB |   6878 MiB |      0 B   |
|       from large pool |   6786 MiB |   6786 MiB |   6786 MiB |      0 B   |
|       from small pool |     92 MiB |     92 MiB |     92 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 491976 KiB |    945 MiB | 220267 GiB | 220267 GiB |
|       from large pool | 471605 KiB |    943 MiB | 216903 GiB | 216903 GiB |
|       from small pool |  20371 KiB |     21 MiB |   3363 GiB |   3363 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5080    |    7463    |   44241 K  |   44236 K  |
|       from large pool |     176    |     456    |   25118 K  |   25118 K  |
|       from small pool |    4904    |    7286    |   19123 K  |   19118 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5080    |    7463    |   44241 K  |   44236 K  |
|       from large pool |     176    |     456    |   25118 K  |   25118 K  |
|       from small pool |    4904    |    7286    |   19123 K  |   19118 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     174    |     174    |     174    |       0    |
|       from large pool |     128    |     128    |     128    |       0    |
|       from small pool |      46    |      46    |      46    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      77    |    3208    |   23324 K  |   23324 K  |
|       from large pool |      33    |     121    |   14741 K  |   14741 K  |
|       from small pool |      44    |    3175    |    8582 K  |    8582 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6545 MiB | 340916 GiB | 340916 GiB |
|       from large pool |  16640 KiB |   6500 MiB | 337568 GiB | 337568 GiB |
|       from small pool |      0 KiB |     87 MiB |   3347 GiB |   3347 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6545 MiB | 340916 GiB | 340916 GiB |
|       from large pool |  16640 KiB |   6500 MiB | 337568 GiB | 337568 GiB |
|       from small pool |      0 KiB |     87 MiB |   3347 GiB |   3347 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6541 MiB | 340709 GiB | 340709 GiB |
|       from large pool |  16640 KiB |   6496 MiB | 337366 GiB | 337366 GiB |
|       from small pool |      0 KiB |     85 MiB |   3343 GiB |   3343 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2366 MiB |   6878 MiB |   6878 MiB |   4512 MiB |
|       from large pool |   2300 MiB |   6786 MiB |   6786 MiB |   4486 MiB |
|       from small pool |     66 MiB |     92 MiB |     92 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |    945 MiB | 220268 GiB | 220268 GiB |
|       from large pool | 204544 KiB |    943 MiB | 216904 GiB | 216904 GiB |
|       from small pool |      0 KiB |     40 MiB |   3364 GiB |   3364 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      70    |     174    |     174    |     104    |
|       from large pool |      37    |     128    |     128    |      91    |
|       from small pool |      33    |      46    |      46    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3208    |   23326 K  |   23326 K  |
|       from large pool |       3    |     121    |   14741 K  |   14741 K  |
|       from small pool |       0    |    3175    |    8584 K  |    8584 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6545 MiB | 340916 GiB | 340916 GiB |
|       from large pool |  16640 KiB |   6500 MiB | 337568 GiB | 337568 GiB |
|       from small pool |      0 KiB |     87 MiB |   3347 GiB |   3347 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6545 MiB | 340916 GiB | 340916 GiB |
|       from large pool |  16640 KiB |   6500 MiB | 337568 GiB | 337568 GiB |
|       from small pool |      0 KiB |     87 MiB |   3347 GiB |   3347 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6541 MiB | 340709 GiB | 340709 GiB |
|       from large pool |  16640 KiB |   6496 MiB | 337366 GiB | 337366 GiB |
|       from small pool |      0 KiB |     85 MiB |   3343 GiB |   3343 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2366 MiB |   6878 MiB |   6878 MiB |   4512 MiB |
|       from large pool |   2300 MiB |   6786 MiB |   6786 MiB |   4486 MiB |
|       from small pool |     66 MiB |     92 MiB |     92 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |    945 MiB | 220268 GiB | 220268 GiB |
|       from large pool | 204544 KiB |    943 MiB | 216904 GiB | 216904 GiB |
|       from small pool |      0 KiB |     40 MiB |   3364 GiB |   3364 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7463    |   44241 K  |   44241 K  |
|       from large pool |       2    |     456    |   25118 K  |   25118 K  |
|       from small pool |       0    |    7286    |   19123 K  |   19123 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      70    |     174    |     174    |     104    |
|       from large pool |      37    |     128    |     128    |      91    |
|       from small pool |      33    |      46    |      46    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3208    |   23326 K  |   23326 K  |
|       from large pool |       3    |     121    |   14741 K  |   14741 K  |
|       from small pool |       0    |    3175    |    8584 K  |    8584 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_14_48_32_seed_1_24141967

 Experiment start at: 2024-08-10 14:48:32.882620
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.3990684747695923
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.960458, 'precision': 0.96143866, 'recall': 0.9604744, 'specificity': 0.9604744, 'f1': 0.9604379, 'auroc': 0.9919956, 'binary_precision': 0.9828894, 'binary_recall': 0.93728864, 'binary_specificity': 0.9836601, 'binary_f1_score': 0.9595475}
confusion matrix:
       0      1
0  24983    415
1   1595  23839
---- Validation: 
scalar performance:
{'acc': 0.9384454, 'precision': 0.6045355, 'recall': 0.75935245, 'specificity': 0.75935245, 'f1': 0.6430041, 'auroc': 0.8729907, 'binary_precision': 0.2206278, 'binary_recall': 0.5707657, 'binary_specificity': 0.94793916, 'binary_f1_score': 0.31824064}
confusion matrix:
       0    1
0  15823  869
1    185  246
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89743334, 'precision': 0.6789315, 'recall': 0.7794714, 'specificity': 0.7794714, 'f1': 0.7134252, 'auroc': 0.888261, 'binary_precision': 0.3886218, 'binary_recall': 0.6406869, 'binary_specificity': 0.91825587, 'binary_f1_score': 0.48379052}
confusion matrix:
      0    1
0  8571  763
1   272  485
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-10 15:27:25.184359,epoch time: 0:38:52.301739,used: 0:38:52.301739,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_14_48_32_seed_1_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9729501, 'precision': 0.97316957, 'recall': 0.972957, 'specificity': 0.972957, 'f1': 0.97294724, 'auroc': 0.9953706, 'binary_precision': 0.9835189, 'binary_recall': 0.9620557, 'binary_specificity': 0.9838583, 'binary_f1_score': 0.97266895}
confusion matrix:
       0      1
0  24990    410
1    965  24467
---- Validation: 
scalar performance:
{'acc': 0.9239035, 'precision': 0.58846664, 'recall': 0.76997596, 'specificity': 0.76997596, 'f1': 0.62330824, 'auroc': 0.8748504, 'binary_precision': 0.18767908, 'binary_recall': 0.60788864, 'binary_specificity': 0.9320633, 'binary_f1_score': 0.28680897}
confusion matrix:
       0     1
0  15558  1134
1    169   262
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8845506, 'precision': 0.67470443, 'recall': 0.8307733, 'specificity': 0.8307733, 'f1': 0.7170538, 'auroc': 0.89443696, 'binary_precision': 0.3700637, 'binary_recall': 0.7675033, 'binary_specificity': 0.89404327, 'binary_f1_score': 0.49935538}
confusion matrix:
      0    1
0  8345  989
1   176  581
early stop counter: 1
val acc:0.9239035248756409, best validation acc: 0.9384453892707825, corresponding to test acc:                         0.897433340549469 / 0.897433340549469
after epoch: 2,now: 2024-08-10 16:02:55.637119,epoch time: 0:35:30.452760,used: 1:14:22.754499,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_14_48_32_seed_1_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9774158, 'precision': 0.97745115, 'recall': 0.97741914, 'specificity': 0.97741914, 'f1': 0.97741556, 'auroc': 0.99675345, 'binary_precision': 0.9817511, 'binary_recall': 0.97295064, 'binary_specificity': 0.98188764, 'binary_f1_score': 0.9773311}
confusion matrix:
       0      1
0  24937    460
1    688  24747
---- Validation: 
scalar performance:
{'acc': 0.8757811, 'precision': 0.5614941, 'recall': 0.79162914, 'specificity': 0.79162914, 'f1': 0.5771192, 'auroc': 0.88083506, 'binary_precision': 0.13162467, 'binary_recall': 0.7030162, 'binary_specificity': 0.88024205, 'binary_f1_score': 0.22173434}
confusion matrix:
       0     1
0  14693  1999
1    128   303
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84996533, 'precision': 0.6464603, 'recall': 0.83453476, 'specificity': 0.83453476, 'f1': 0.6813014, 'auroc': 0.8987885, 'binary_precision': 0.3100853, 'binary_recall': 0.81638044, 'binary_specificity': 0.8526891, 'binary_f1_score': 0.44945452}
confusion matrix:
      0     1
0  7959  1375
1   139   618
early stop counter: 2
val acc:0.8757811188697815, best validation acc: 0.9384453892707825, corresponding to test acc:                         0.897433340549469 / 0.897433340549469
after epoch: 3,now: 2024-08-10 16:38:31.672909,epoch time: 0:35:36.035790,used: 1:49:58.790289,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_14_48_32_seed_1_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9798946, 'precision': 0.9800892, 'recall': 0.979903, 'specificity': 0.979903, 'f1': 0.97989273, 'auroc': 0.99739516, 'binary_precision': 0.98996586, 'binary_recall': 0.9696505, 'binary_specificity': 0.9901555, 'binary_f1_score': 0.97970283}
confusion matrix:
       0      1
0  25145    250
1    772  24665
---- Validation: 
scalar performance:
{'acc': 0.93202126, 'precision': 0.59403837, 'recall': 0.7537971, 'specificity': 0.7537971, 'f1': 0.6298437, 'auroc': 0.87926614, 'binary_precision': 0.1998362, 'binary_recall': 0.5661253, 'binary_specificity': 0.94146895, 'binary_f1_score': 0.29539952}
confusion matrix:
       0    1
0  15715  977
1    187  244
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8965415, 'precision': 0.6872791, 'recall': 0.8226886, 'specificity': 0.8226886, 'f1': 0.72914803, 'auroc': 0.89877224, 'binary_precision': 0.39757317, 'binary_recall': 0.7357992, 'binary_specificity': 0.9095779, 'binary_f1_score': 0.5162188}
confusion matrix:
      0    1
0  8490  844
1   200  557
early stop counter: 3
val acc:0.9320212602615356, best validation acc: 0.9384453892707825, corresponding to test acc:                         0.897433340549469 / 0.897433340549469
after epoch: 4,now: 2024-08-10 17:13:33.318568,epoch time: 0:35:01.645659,used: 2:25:00.435948,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_14_48_32_seed_1_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:25:00.435948 at 2024-08-10 17:13:33.318568
persisted model performance metric: 

scalar performance:
{'acc': 0.89743334, 'precision': 0.6789315, 'recall': 0.7794714, 'specificity': 0.7794714, 'f1': 0.7134252, 'auroc': 0.888261, 'binary_precision': 0.3886218, 'binary_recall': 0.6406869, 'binary_specificity': 0.91825587, 'binary_f1_score': 0.48379052}
confusion matrix:
      0    1
0  8571  763
1   272  485
oracle model performance metric: 

scalar performance:
{'acc': 0.89743334, 'precision': 0.6789315, 'recall': 0.7794714, 'specificity': 0.7794714, 'f1': 0.7134252, 'auroc': 0.888261, 'binary_precision': 0.3886218, 'binary_recall': 0.6406869, 'binary_specificity': 0.91825587, 'binary_f1_score': 0.48379052}
confusion matrix:
      0    1
0  8571  763
1   272  485
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1886 MiB |   6547 MiB | 682863 GiB | 682861 GiB |
|       from large pool |   1840 MiB |   6502 MiB | 676159 GiB | 676157 GiB |
|       from small pool |     46 MiB |     87 MiB |   6703 GiB |   6703 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1886 MiB |   6547 MiB | 682863 GiB | 682861 GiB |
|       from large pool |   1840 MiB |   6502 MiB | 676159 GiB | 676157 GiB |
|       from small pool |     46 MiB |     87 MiB |   6703 GiB |   6703 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1883 MiB |   6541 MiB | 682492 GiB | 682490 GiB |
|       from large pool |   1839 MiB |   6496 MiB | 675797 GiB | 675795 GiB |
|       from small pool |     44 MiB |     85 MiB |   6694 GiB |   6694 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6894 MiB |   6894 MiB |  11406 MiB |   4512 MiB |
|       from large pool |   6808 MiB |   6808 MiB |  11294 MiB |   4486 MiB |
|       from small pool |     86 MiB |     92 MiB |    112 MiB |     26 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 671263 KiB |   1199 MiB | 485149 GiB | 485148 GiB |
|       from large pool | 654982 KiB |   1197 MiB | 478413 GiB | 478412 GiB |
|       from small pool |  16281 KiB |     40 MiB |   6735 GiB |   6735 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    5068    |    7485    |   88607 K  |   88602 K  |
|       from large pool |     176    |     456    |   50314 K  |   50313 K  |
|       from small pool |    4892    |    7308    |   38293 K  |   38288 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5068    |    7485    |   88607 K  |   88602 K  |
|       from large pool |     176    |     456    |   50314 K  |   50313 K  |
|       from small pool |    4892    |    7308    |   38293 K  |   38288 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     142    |     174    |     246    |     104    |
|       from large pool |      99    |     128    |     190    |      91    |
|       from small pool |      43    |      46    |      56    |      13    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      70    |    3214    |   47255 K  |   47255 K  |
|       from large pool |      28    |     121    |   30165 K  |   30165 K  |
|       from small pool |      42    |    3186    |   17089 K  |   17089 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6547 MiB | 682863 GiB | 682863 GiB |
|       from large pool |  16640 KiB |   6502 MiB | 676159 GiB | 676159 GiB |
|       from small pool |      0 KiB |     87 MiB |   6703 GiB |   6703 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6547 MiB | 682863 GiB | 682863 GiB |
|       from large pool |  16640 KiB |   6502 MiB | 676159 GiB | 676159 GiB |
|       from small pool |      0 KiB |     87 MiB |   6703 GiB |   6703 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6541 MiB | 682492 GiB | 682491 GiB |
|       from large pool |  16640 KiB |   6496 MiB | 675797 GiB | 675797 GiB |
|       from small pool |      0 KiB |     85 MiB |   6694 GiB |   6694 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2542 MiB |   6894 MiB |  11406 MiB |   8864 MiB |
|       from large pool |   2480 MiB |   6808 MiB |  11294 MiB |   8814 MiB |
|       from small pool |     62 MiB |     92 MiB |    112 MiB |     50 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |   1199 MiB | 485149 GiB | 485149 GiB |
|       from large pool | 204544 KiB |   1197 MiB | 478413 GiB | 478413 GiB |
|       from small pool |      0 KiB |     40 MiB |   6735 GiB |   6735 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7485    |   88607 K  |   88607 K  |
|       from large pool |       2    |     456    |   50314 K  |   50314 K  |
|       from small pool |       0    |    7308    |   38293 K  |   38293 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7485    |   88607 K  |   88607 K  |
|       from large pool |       2    |     456    |   50314 K  |   50314 K  |
|       from small pool |       0    |    7308    |   38293 K  |   38293 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      68    |     174    |     246    |     178    |
|       from large pool |      37    |     128    |     190    |     153    |
|       from small pool |      31    |      46    |      56    |      25    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3214    |   47257 K  |   47257 K  |
|       from large pool |       3    |     121    |   30166 K  |   30166 K  |
|       from small pool |       0    |    3186    |   17091 K  |   17091 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6547 MiB | 682863 GiB | 682863 GiB |
|       from large pool |  16640 KiB |   6502 MiB | 676159 GiB | 676159 GiB |
|       from small pool |      0 KiB |     87 MiB |   6703 GiB |   6703 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6547 MiB | 682863 GiB | 682863 GiB |
|       from large pool |  16640 KiB |   6502 MiB | 676159 GiB | 676159 GiB |
|       from small pool |      0 KiB |     87 MiB |   6703 GiB |   6703 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6541 MiB | 682492 GiB | 682491 GiB |
|       from large pool |  16640 KiB |   6496 MiB | 675797 GiB | 675797 GiB |
|       from small pool |      0 KiB |     85 MiB |   6694 GiB |   6694 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2542 MiB |   6894 MiB |  11406 MiB |   8864 MiB |
|       from large pool |   2480 MiB |   6808 MiB |  11294 MiB |   8814 MiB |
|       from small pool |     62 MiB |     92 MiB |    112 MiB |     50 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |   1199 MiB | 485149 GiB | 485149 GiB |
|       from large pool | 204544 KiB |   1197 MiB | 478413 GiB | 478413 GiB |
|       from small pool |      0 KiB |     40 MiB |   6735 GiB |   6735 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7485    |   88607 K  |   88607 K  |
|       from large pool |       2    |     456    |   50314 K  |   50314 K  |
|       from small pool |       0    |    7308    |   38293 K  |   38293 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7485    |   88607 K  |   88607 K  |
|       from large pool |       2    |     456    |   50314 K  |   50314 K  |
|       from small pool |       0    |    7308    |   38293 K  |   38293 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      68    |     174    |     246    |     178    |
|       from large pool |      37    |     128    |     190    |     153    |
|       from small pool |      31    |      46    |      56    |      25    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3214    |   47257 K  |   47257 K  |
|       from large pool |       3    |     121    |   30166 K  |   30166 K  |
|       from small pool |       0    |    3186    |   17091 K  |   17091 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_17_23_52_seed_2_24141967

 Experiment start at: 2024-08-10 17:23:52.858021
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.44262781739234924
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9645814, 'precision': 0.9646314, 'recall': 0.9645818, 'specificity': 0.9645818, 'f1': 0.9645805, 'auroc': 0.9929116, 'binary_precision': 0.96946955, 'binary_recall': 0.95938104, 'binary_specificity': 0.96978253, 'binary_f1_score': 0.9643989}
confusion matrix:
       0      1
0  25065    781
1   1050  24800
---- Validation: 
scalar performance:
{'acc': 0.8754964, 'precision': 0.561802, 'recall': 0.80440515, 'specificity': 0.80440515, 'f1': 0.5773978, 'auroc': 0.878875, 'binary_precision': 0.13123924, 'binary_recall': 0.7296651, 'binary_specificity': 0.8791452, 'binary_f1_score': 0.22246534}
confusion matrix:
       0     1
0  14687  2019
1    113   305
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8121284, 'precision': 0.62144405, 'recall': 0.7976366, 'specificity': 0.7976366, 'f1': 0.64246845, 'auroc': 0.8621853, 'binary_precision': 0.2654716, 'binary_recall': 0.7804266, 'binary_specificity': 0.8148467, 'binary_f1_score': 0.39617833}
confusion matrix:
      0     1
0  7574  1721
1   175   622
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-10 18:01:38.699504,epoch time: 0:37:45.841483,used: 0:37:45.841483,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_17_23_52_seed_2_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96959144, 'precision': 0.9703293, 'recall': 0.9695984, 'specificity': 0.9695984, 'f1': 0.9695798, 'auroc': 0.9956733, 'binary_precision': 0.9890451, 'binary_recall': 0.9497235, 'binary_specificity': 0.9894733, 'binary_f1_score': 0.9689855}
confusion matrix:
       0      1
0  25567    272
1   1300  24557
---- Validation: 
scalar performance:
{'acc': 0.94119364, 'precision': 0.60671103, 'recall': 0.76226985, 'specificity': 0.76226985, 'f1': 0.6460299, 'auroc': 0.8759239, 'binary_precision': 0.22450888, 'binary_recall': 0.57416266, 'binary_specificity': 0.9503771, 'binary_f1_score': 0.32279757}
confusion matrix:
       0    1
0  15877  829
1    178  240
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8847602, 'precision': 0.6707173, 'recall': 0.78544605, 'specificity': 0.78544605, 'f1': 0.70650345, 'auroc': 0.87082464, 'binary_precision': 0.37202796, 'binary_recall': 0.6675031, 'binary_specificity': 0.9033889, 'binary_f1_score': 0.47777277}
confusion matrix:
      0    1
0  8397  898
1   265  532
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-10 18:38:14.276332,epoch time: 0:36:35.576828,used: 1:14:21.418311,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_17_23_52_seed_2_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9762264, 'precision': 0.976328, 'recall': 0.9762273, 'specificity': 0.9762273, 'f1': 0.97622514, 'auroc': 0.99675584, 'binary_precision': 0.983315, 'binary_recall': 0.9688987, 'binary_specificity': 0.9835558, 'binary_f1_score': 0.9760536}
confusion matrix:
       0      1
0  25420    425
1    804  25047
---- Validation: 
scalar performance:
{'acc': 0.92647743, 'precision': 0.5960299, 'recall': 0.80370986, 'specificity': 0.80370986, 'f1': 0.6352761, 'auroc': 0.8865024, 'binary_precision': 0.20071174, 'binary_recall': 0.67464113, 'binary_specificity': 0.93277866, 'binary_f1_score': 0.30938014}
confusion matrix:
       0     1
0  15583  1123
1    136   282
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8589972, 'precision': 0.652074, 'recall': 0.80931497, 'specificity': 0.80931497, 'f1': 0.6878247, 'auroc': 0.8764619, 'binary_precision': 0.32821077, 'binary_recall': 0.7503137, 'binary_specificity': 0.8683163, 'binary_f1_score': 0.45666286}
confusion matrix:
      0     1
0  8071  1224
1   199   598
early stop counter: 1
val acc:0.9264774322509766, best validation acc: 0.9411936402320862, corresponding to test acc:                         0.8847602009773254 / 0.8847602009773254
after epoch: 3,now: 2024-08-10 19:15:39.235028,epoch time: 0:37:24.958696,used: 1:51:46.377007,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_17_23_52_seed_2_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97866374, 'precision': 0.9788854, 'recall': 0.9786662, 'specificity': 0.9786662, 'f1': 0.9786613, 'auroc': 0.9969659, 'binary_precision': 0.9892469, 'binary_recall': 0.96785796, 'binary_specificity': 0.9894745, 'binary_f1_score': 0.9784355}
confusion matrix:
       0      1
0  25570    272
1    831  25023
---- Validation: 
scalar performance:
{'acc': 0.93856573, 'precision': 0.61215854, 'recall': 0.80407405, 'specificity': 0.80407405, 'f1': 0.656364, 'auroc': 0.89290977, 'binary_precision': 0.23316498, 'binary_recall': 0.66267943, 'binary_specificity': 0.94546866, 'binary_f1_score': 0.34495643}
confusion matrix:
       0    1
0  15795  911
1    141  277
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87504953, 'precision': 0.6683202, 'recall': 0.8180294, 'specificity': 0.8180294, 'f1': 0.70781904, 'auroc': 0.8821361, 'binary_precision': 0.36024097, 'binary_recall': 0.7503137, 'binary_specificity': 0.88574505, 'binary_f1_score': 0.4867725}
confusion matrix:
      0     1
0  8233  1062
1   199   598
early stop counter: 2
val acc:0.938565731048584, best validation acc: 0.9411936402320862, corresponding to test acc:                         0.8847602009773254 / 0.8847602009773254
after epoch: 4,now: 2024-08-10 19:52:55.832996,epoch time: 0:37:16.597968,used: 2:29:02.974975,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_17_23_52_seed_2_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97941816, 'precision': 0.979491, 'recall': 0.9794189, 'specificity': 0.9794189, 'f1': 0.97941744, 'auroc': 0.9972403, 'binary_precision': 0.98542947, 'binary_recall': 0.9732312, 'binary_specificity': 0.9856065, 'binary_f1_score': 0.9792924}
confusion matrix:
       0      1
0  25473    372
1    692  25159
---- Validation: 
scalar performance:
{'acc': 0.92601025, 'precision': 0.59618855, 'recall': 0.80696917, 'specificity': 0.80696917, 'f1': 0.6355984, 'auroc': 0.8918072, 'binary_precision': 0.20084566, 'binary_recall': 0.6818182, 'binary_specificity': 0.9321202, 'binary_f1_score': 0.31028852}
confusion matrix:
       0     1
0  15572  1134
1    133   285
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8702933, 'precision': 0.6654813, 'recall': 0.8246243, 'specificity': 0.8246243, 'f1': 0.7049297, 'auroc': 0.88761556, 'binary_precision': 0.35287356, 'binary_recall': 0.77038896, 'binary_specificity': 0.8788596, 'binary_f1_score': 0.48403627}
confusion matrix:
      0     1
0  8169  1126
1   183   614
early stop counter: 3
val acc:0.926010251045227, best validation acc: 0.9411936402320862, corresponding to test acc:                         0.8847602009773254 / 0.8847602009773254
after epoch: 5,now: 2024-08-10 20:28:37.016463,epoch time: 0:35:41.183467,used: 3:04:44.158442,model: dset_te_center4_diva_b8efecac6_not_commited_2024md_08md_10_17_23_52_seed_2_24141967
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:04:44.158442 at 2024-08-10 20:28:37.016463
persisted model performance metric: 

scalar performance:
{'acc': 0.8847602, 'precision': 0.6707173, 'recall': 0.78544605, 'specificity': 0.78544605, 'f1': 0.70650345, 'auroc': 0.87082464, 'binary_precision': 0.37202796, 'binary_recall': 0.6675031, 'binary_specificity': 0.9033889, 'binary_f1_score': 0.47777277}
confusion matrix:
      0    1
0  8397  898
1   265  532
oracle model performance metric: 

scalar performance:
{'acc': 0.8847602, 'precision': 0.6707173, 'recall': 0.78544605, 'specificity': 0.78544605, 'f1': 0.70650345, 'auroc': 0.87082464, 'binary_precision': 0.37202796, 'binary_recall': 0.6675031, 'binary_specificity': 0.9033889, 'binary_f1_score': 0.47777277}
confusion matrix:
      0    1
0  8397  898
1   265  532
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1886 MiB |   6547 MiB |   1089 TiB |   1089 TiB |
|       from large pool |   1840 MiB |   6502 MiB |   1079 TiB |   1079 TiB |
|       from small pool |     46 MiB |     87 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   1886 MiB |   6547 MiB |   1089 TiB |   1089 TiB |
|       from large pool |   1840 MiB |   6502 MiB |   1079 TiB |   1079 TiB |
|       from small pool |     46 MiB |     87 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1883 MiB |   6541 MiB |   1089 TiB |   1089 TiB |
|       from large pool |   1839 MiB |   6496 MiB |   1078 TiB |   1078 TiB |
|       from small pool |     44 MiB |     85 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6884 MiB |   6894 MiB |  15748 MiB |   8864 MiB |
|       from large pool |   6796 MiB |   6808 MiB |  15610 MiB |   8814 MiB |
|       from small pool |     88 MiB |     92 MiB |    138 MiB |     50 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 675415 KiB |   1199 MiB |    809 TiB |    809 TiB |
|       from large pool | 659134 KiB |   1197 MiB |    798 TiB |    798 TiB |
|       from small pool |  16281 KiB |     40 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    5068    |    7593    |  144629 K  |  144624 K  |
|       from large pool |     176    |     456    |   82190 K  |   82190 K  |
|       from small pool |    4892    |    7416    |   62438 K  |   62434 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    5068    |    7593    |  144629 K  |  144624 K  |
|       from large pool |     176    |     456    |   82190 K  |   82190 K  |
|       from small pool |    4892    |    7416    |   62438 K  |   62434 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     137    |     174    |     315    |     178    |
|       from large pool |      93    |     128    |     246    |     153    |
|       from small pool |      44    |      46    |      69    |      25    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      72    |    3270    |   77620 K  |   77620 K  |
|       from large pool |      30    |     121    |   49610 K  |   49610 K  |
|       from small pool |      42    |    3240    |   28009 K  |   28009 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6547 MiB |   1089 TiB |   1089 TiB |
|       from large pool |  16640 KiB |   6502 MiB |   1079 TiB |   1079 TiB |
|       from small pool |      0 KiB |     87 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6547 MiB |   1089 TiB |   1089 TiB |
|       from large pool |  16640 KiB |   6502 MiB |   1079 TiB |   1079 TiB |
|       from small pool |      0 KiB |     87 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6541 MiB |   1089 TiB |   1089 TiB |
|       from large pool |  16640 KiB |   6496 MiB |   1078 TiB |   1078 TiB |
|       from small pool |      0 KiB |     85 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2546 MiB |   6894 MiB |  15748 MiB |  13202 MiB |
|       from large pool |   2484 MiB |   6808 MiB |  15610 MiB |  13126 MiB |
|       from small pool |     62 MiB |     92 MiB |    138 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 204544 KiB |   1199 MiB |    809 TiB |    809 TiB |
|       from large pool | 204544 KiB |   1197 MiB |    798 TiB |    798 TiB |
|       from small pool |      0 KiB |     40 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7593    |  144629 K  |  144629 K  |
|       from large pool |       2    |     456    |   82190 K  |   82190 K  |
|       from small pool |       0    |    7416    |   62438 K  |   62438 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7593    |  144629 K  |  144629 K  |
|       from large pool |       2    |     456    |   82190 K  |   82190 K  |
|       from small pool |       0    |    7416    |   62438 K  |   62438 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      68    |     174    |     315    |     247    |
|       from large pool |      37    |     128    |     246    |     209    |
|       from small pool |      31    |      46    |      69    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3270    |   77622 K  |   77622 K  |
|       from large pool |       3    |     121    |   49610 K  |   49610 K  |
|       from small pool |       0    |    3240    |   28011 K  |   28011 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Aug 10 20:30:47 2024]
Finished job 0.
1 of 1 steps (100%) done
