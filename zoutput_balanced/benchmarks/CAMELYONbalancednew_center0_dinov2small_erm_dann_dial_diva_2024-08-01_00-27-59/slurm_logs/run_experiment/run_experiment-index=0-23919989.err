Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 19:40:49 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_49_42_seed_0_23919989

 Experiment start at: 2024-08-01 19:49:42.834479
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94738495, 'precision': 0.94908637, 'recall': 0.9474108, 'specificity': 0.9474108, 'f1': 0.94733715, 'auroc': 0.9852467, 'binary_precision': 0.9769385, 'binary_recall': 0.91649246, 'binary_specificity': 0.9783291, 'binary_f1_score': 0.94575065}
confusion matrix:
       0      1
0  28035    621
1   2397  26307
---- Validation: 
scalar performance:
{'acc': 0.92118984, 'precision': 0.6157522, 'recall': 0.77993566, 'specificity': 0.77993566, 'f1': 0.655516, 'auroc': 0.8908543, 'binary_precision': 0.2454435, 'binary_recall': 0.62830484, 'binary_specificity': 0.9315665, 'binary_f1_score': 0.3529926}
confusion matrix:
       0     1
0  16907  1242
1    239   404
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9197827, 'precision': 0.65133345, 'recall': 0.85003805, 'specificity': 0.85003805, 'f1': 0.70133877, 'auroc': 0.91457224, 'binary_precision': 0.3131783, 'binary_recall': 0.77394634, 'binary_specificity': 0.92612976, 'binary_f1_score': 0.44591615}
confusion matrix:
      0    1
0  5554  443
1    59  202
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 20:15:49.447503,epoch time: 0:26:06.613024,used: 0:26:06.613024,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_49_42_seed_0_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96122736, 'precision': 0.96147525, 'recall': 0.9612355, 'specificity': 0.9612355, 'f1': 0.9612225, 'auroc': 0.9903172, 'binary_precision': 0.9723471, 'binary_recall': 0.9495122, 'binary_specificity': 0.9729588, 'binary_f1_score': 0.960794}
confusion matrix:
       0      1
0  27885    775
1   1449  27251
---- Validation: 
scalar performance:
{'acc': 0.8911239, 'precision': 0.5945665, 'recall': 0.8116236, 'specificity': 0.8116236, 'f1': 0.6271484, 'auroc': 0.8960825, 'binary_precision': 0.19982883, 'binary_recall': 0.7262831, 'binary_specificity': 0.896964, 'binary_f1_score': 0.3134228}
confusion matrix:
       0     1
0  16279  1870
1    176   467
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8592202, 'precision': 0.6001998, 'recall': 0.85325325, 'specificity': 0.85325325, 'f1': 0.6276896, 'auroc': 0.924307, 'binary_precision': 0.20809793, 'binary_recall': 0.8467433, 'binary_specificity': 0.8597632, 'binary_f1_score': 0.3340892}
confusion matrix:
      0    1
0  5156  841
1    40  221
early stop counter: 1
val acc:0.89112389087677, best validation acc: 0.9211898446083069, corresponding to test acc:                         0.9197826981544495 / 0.9197826981544495
after epoch: 2,now: 2024-08-01 20:41:20.552589,epoch time: 0:25:31.105086,used: 0:51:37.718110,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_49_42_seed_0_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96649235, 'precision': 0.966972, 'recall': 0.9665053, 'specificity': 0.9665053, 'f1': 0.96648437, 'auroc': 0.99330986, 'binary_precision': 0.9821409, 'binary_recall': 0.95031875, 'binary_specificity': 0.9826918, 'binary_f1_score': 0.96596783}
confusion matrix:
       0      1
0  28161    496
1   1426  27277
---- Validation: 
scalar performance:
{'acc': 0.90825886, 'precision': 0.60965717, 'recall': 0.8159942, 'specificity': 0.8159942, 'f1': 0.64955294, 'auroc': 0.90282893, 'binary_precision': 0.23015477, 'binary_recall': 0.7169518, 'binary_specificity': 0.9150366, 'binary_f1_score': 0.34845048}
confusion matrix:
       0     1
0  16607  1542
1    182   461
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87615854, 'precision': 0.61106324, 'recall': 0.85842633, 'specificity': 0.85842633, 'f1': 0.6462612, 'auroc': 0.92871726, 'binary_precision': 0.23004201, 'binary_recall': 0.83908045, 'binary_specificity': 0.8777722, 'binary_f1_score': 0.36108822}
confusion matrix:
      0    1
0  5264  733
1    42  219
early stop counter: 2
val acc:0.908258855342865, best validation acc: 0.9211898446083069, corresponding to test acc:                         0.9197826981544495 / 0.9197826981544495
after epoch: 3,now: 2024-08-01 21:06:58.572177,epoch time: 0:25:38.019588,used: 1:17:15.737698,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_49_42_seed_0_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9715307, 'precision': 0.97163594, 'recall': 0.9715365, 'specificity': 0.9715365, 'f1': 0.97152936, 'auroc': 0.99487066, 'binary_precision': 0.97887695, 'binary_recall': 0.963905, 'binary_specificity': 0.9791681, 'binary_f1_score': 0.9713333}
confusion matrix:
       0      1
0  28061    597
1   1036  27666
---- Validation: 
scalar performance:
{'acc': 0.8901128, 'precision': 0.59717757, 'recall': 0.8276013, 'specificity': 0.8276013, 'f1': 0.63080466, 'auroc': 0.9019246, 'binary_precision': 0.20375, 'binary_recall': 0.7604977, 'binary_specificity': 0.89470494, 'binary_f1_score': 0.32139337}
confusion matrix:
       0     1
0  16238  1911
1    154   489
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84116334, 'precision': 0.5915504, 'recall': 0.85116124, 'specificity': 0.85116124, 'f1': 0.61092913, 'auroc': 0.9293906, 'binary_precision': 0.19019443, 'binary_recall': 0.86206895, 'binary_specificity': 0.8402535, 'binary_f1_score': 0.31163436}
confusion matrix:
      0    1
0  5039  958
1    36  225
early stop counter: 3
val acc:0.8901128172874451, best validation acc: 0.9211898446083069, corresponding to test acc:                         0.9197826981544495 / 0.9197826981544495
after epoch: 4,now: 2024-08-01 21:32:33.408439,epoch time: 0:25:34.836262,used: 1:42:50.573960,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_49_42_seed_0_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:42:50.573960 at 2024-08-01 21:32:33.408439
persisted model performance metric: 

scalar performance:
{'acc': 0.9197827, 'precision': 0.65133345, 'recall': 0.85003805, 'specificity': 0.85003805, 'f1': 0.70133877, 'auroc': 0.91457224, 'binary_precision': 0.3131783, 'binary_recall': 0.77394634, 'binary_specificity': 0.92612976, 'binary_f1_score': 0.44591615}
confusion matrix:
      0    1
0  5554  443
1    59  202
oracle model performance metric: 

scalar performance:
{'acc': 0.9197827, 'precision': 0.65133345, 'recall': 0.85003805, 'specificity': 0.85003805, 'f1': 0.70133877, 'auroc': 0.91457224, 'binary_precision': 0.3131783, 'binary_recall': 0.77394634, 'binary_specificity': 0.92612976, 'binary_f1_score': 0.44591615}
confusion matrix:
      0    1
0  5554  443
1    59  202
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197611 KiB |   1195 MiB | 132441 GiB | 132441 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 130640 GiB | 130640 GiB |
|       from small pool |  17491 KiB |     37 MiB |   1801 GiB |   1801 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197611 KiB |   1195 MiB | 132441 GiB | 132441 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 130640 GiB | 130640 GiB |
|       from small pool |  17491 KiB |     37 MiB |   1801 GiB |   1801 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   1193 MiB | 132437 GiB | 132437 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 130639 GiB | 130639 GiB |
|       from small pool |  16482 KiB |     36 MiB |   1798 GiB |   1798 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1346 MiB |   1346 MiB |   1346 MiB |      0 B   |
|       from large pool |   1304 MiB |   1304 MiB |   1304 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  56341 KiB | 161596 KiB |  66693 GiB |  66693 GiB |
|       from large pool |  51304 KiB | 160090 KiB |  64877 GiB |  64877 GiB |
|       from small pool |   5037 KiB |   9269 KiB |   1816 GiB |   1816 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2978    |    7645    |   22778 K  |   22775 K  |
|       from large pool |      79    |     167    |   12201 K  |   12201 K  |
|       from small pool |    2899    |    7565    |   10576 K  |   10573 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2978    |    7645    |   22778 K  |   22775 K  |
|       from large pool |      79    |     167    |   12201 K  |   12201 K  |
|       from small pool |    2899    |    7565    |   10576 K  |   10573 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      76    |      76    |      76    |       0    |
|       from large pool |      55    |      55    |      55    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      29    |    3604    |   13742 K  |   13742 K  |
|       from large pool |       9    |      57    |    8646 K  |    8646 K  |
|       from small pool |      20    |    3595    |    5096 K  |    5096 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 132441 GiB | 132441 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 130640 GiB | 130640 GiB |
|       from small pool |      0 KiB |     37 MiB |   1801 GiB |   1801 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 132441 GiB | 132441 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 130640 GiB | 130640 GiB |
|       from small pool |      0 KiB |     37 MiB |   1801 GiB |   1801 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 132437 GiB | 132437 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 130639 GiB | 130639 GiB |
|       from small pool |      0 KiB |     36 MiB |   1798 GiB |   1798 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   1346 MiB |   1346 MiB |   1098 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB |  66693 GiB |  66693 GiB |
|       from large pool |  30464 KiB | 160090 KiB |  64877 GiB |  64877 GiB |
|       from small pool |      0 KiB |  16546 KiB |   1816 GiB |   1816 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   22778 K  |   22778 K  |
|       from large pool |       2    |     167    |   12201 K  |   12201 K  |
|       from small pool |       0    |    7565    |   10576 K  |   10576 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   22778 K  |   22778 K  |
|       from large pool |       2    |     167    |   12201 K  |   12201 K  |
|       from small pool |       0    |    7565    |   10576 K  |   10576 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |      76    |      76    |      54    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3604    |   13743 K  |   13743 K  |
|       from large pool |       3    |      57    |    8646 K  |    8646 K  |
|       from small pool |       0    |    3595    |    5097 K  |    5097 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 132441 GiB | 132441 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 130640 GiB | 130640 GiB |
|       from small pool |      0 KiB |     37 MiB |   1801 GiB |   1801 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 132441 GiB | 132441 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 130640 GiB | 130640 GiB |
|       from small pool |      0 KiB |     37 MiB |   1801 GiB |   1801 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 132437 GiB | 132437 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 130639 GiB | 130639 GiB |
|       from small pool |      0 KiB |     36 MiB |   1798 GiB |   1798 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   1346 MiB |   1346 MiB |   1098 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB |  66693 GiB |  66693 GiB |
|       from large pool |  30464 KiB | 160090 KiB |  64877 GiB |  64877 GiB |
|       from small pool |      0 KiB |  16546 KiB |   1816 GiB |   1816 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   22778 K  |   22778 K  |
|       from large pool |       2    |     167    |   12201 K  |   12201 K  |
|       from small pool |       0    |    7565    |   10576 K  |   10576 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   22778 K  |   22778 K  |
|       from large pool |       2    |     167    |   12201 K  |   12201 K  |
|       from small pool |       0    |    7565    |   10576 K  |   10576 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |      76    |      76    |      54    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3604    |   13743 K  |   13743 K  |
|       from large pool |       3    |      57    |    8646 K  |    8646 K  |
|       from small pool |       0    |    3595    |    5097 K  |    5097 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_40_10_seed_1_23919989

 Experiment start at: 2024-08-01 21:40:12.581536
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9484865, 'precision': 0.9500512, 'recall': 0.94850814, 'specificity': 0.94850814, 'f1': 0.9484434, 'auroc': 0.9865779, 'binary_precision': 0.97677076, 'binary_recall': 0.9189011, 'binary_specificity': 0.97811514, 'binary_f1_score': 0.94695264}
confusion matrix:
       0      1
0  28157    630
1   2338  26491
---- Validation: 
scalar performance:
{'acc': 0.92966914, 'precision': 0.62791944, 'recall': 0.75824296, 'specificity': 0.75824296, 'f1': 0.6660679, 'auroc': 0.8753718, 'binary_precision': 0.2724065, 'binary_recall': 0.57355124, 'binary_specificity': 0.94293463, 'binary_f1_score': 0.36937797}
confusion matrix:
       0     1
0  17036  1031
1    287   386
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9344183, 'precision': 0.67086613, 'recall': 0.82049537, 'specificity': 0.82049537, 'f1': 0.7178923, 'auroc': 0.9189882, 'binary_precision': 0.35559922, 'binary_recall': 0.6961538, 'binary_specificity': 0.94483685, 'binary_f1_score': 0.4707412}
confusion matrix:
      0    1
0  5618  328
1    79  181
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 22:06:35.853765,epoch time: 0:26:23.272229,used: 0:26:23.272229,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_40_10_seed_1_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96113926, 'precision': 0.9619894, 'recall': 0.9611542, 'specificity': 0.9611542, 'f1': 0.9611223, 'auroc': 0.9925029, 'binary_precision': 0.98198164, 'binary_recall': 0.93957263, 'binary_specificity': 0.9827359, 'binary_f1_score': 0.9603091}
confusion matrix:
       0      1
0  28291    497
1   1742  27086
---- Validation: 
scalar performance:
{'acc': 0.93313766, 'precision': 0.6449217, 'recall': 0.80295783, 'specificity': 0.80295783, 'f1': 0.69019514, 'auroc': 0.8955474, 'binary_precision': 0.30298913, 'binary_recall': 0.6627043, 'binary_specificity': 0.9432114, 'binary_f1_score': 0.41585082}
confusion matrix:
       0     1
0  17041  1026
1    227   446
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91475993, 'precision': 0.6493401, 'recall': 0.8709229, 'specificity': 0.8709229, 'f1': 0.70052516, 'auroc': 0.9337498, 'binary_precision': 0.30703014, 'binary_recall': 0.8230769, 'binary_specificity': 0.91876894, 'binary_f1_score': 0.44723094}
confusion matrix:
      0    1
0  5463  483
1    46  214
better model found
persisted
after epoch: 2,now: 2024-08-01 22:32:07.863331,epoch time: 0:25:32.009566,used: 0:51:55.281795,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_40_10_seed_1_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96764785, 'precision': 0.9679464, 'recall': 0.9676576, 'specificity': 0.9676576, 'f1': 0.96764314, 'auroc': 0.99444675, 'binary_precision': 0.9799587, 'binary_recall': 0.9548734, 'binary_specificity': 0.98044187, 'binary_f1_score': 0.9672534}
confusion matrix:
       0      1
0  28223    563
1   1301  27529
---- Validation: 
scalar performance:
{'acc': 0.92267877, 'precision': 0.63304484, 'recall': 0.82399845, 'specificity': 0.82399845, 'f1': 0.67933834, 'auroc': 0.8981272, 'binary_precision': 0.27726752, 'binary_recall': 0.717682, 'binary_specificity': 0.93031496, 'binary_f1_score': 0.4}
confusion matrix:
       0     1
0  16808  1259
1    190   483
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89284563, 'precision': 0.6268217, 'recall': 0.8723596, 'specificity': 0.8723596, 'f1': 0.6702269, 'auroc': 0.9344168, 'binary_precision': 0.2609209, 'binary_recall': 0.85, 'binary_specificity': 0.8947191, 'binary_f1_score': 0.39927736}
confusion matrix:
      0    1
0  5320  626
1    39  221
early stop counter: 1
val acc:0.9226787686347961, best validation acc: 0.9331376552581787, corresponding to test acc:                         0.9147599339485168 / 0.9344183206558228
after epoch: 3,now: 2024-08-01 22:57:38.410863,epoch time: 0:25:30.547532,used: 1:17:25.829327,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_40_10_seed_1_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9707373, 'precision': 0.97085845, 'recall': 0.97074324, 'specificity': 0.97074324, 'f1': 0.97073567, 'auroc': 0.9956018, 'binary_precision': 0.97859436, 'binary_recall': 0.9625724, 'binary_specificity': 0.9789141, 'binary_f1_score': 0.9705172}
confusion matrix:
       0      1
0  28180    607
1   1079  27750
---- Validation: 
scalar performance:
{'acc': 0.9103522, 'precision': 0.6193946, 'recall': 0.82976514, 'specificity': 0.82976514, 'f1': 0.6624292, 'auroc': 0.8986429, 'binary_precision': 0.24912806, 'binary_recall': 0.74294204, 'binary_specificity': 0.91658825, 'binary_f1_score': 0.37313434}
confusion matrix:
       0     1
0  16560  1507
1    173   500
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87753785, 'precision': 0.61509156, 'recall': 0.871727, 'specificity': 0.871727, 'f1': 0.6520279, 'auroc': 0.9309529, 'binary_precision': 0.23684211, 'binary_recall': 0.86538464, 'binary_specificity': 0.8780693, 'binary_f1_score': 0.37190086}
confusion matrix:
      0    1
0  5221  725
1    35  225
early stop counter: 2
val acc:0.9103521704673767, best validation acc: 0.9331376552581787, corresponding to test acc:                         0.9147599339485168 / 0.9344183206558228
after epoch: 4,now: 2024-08-01 23:23:31.629679,epoch time: 0:25:53.218816,used: 1:43:19.048143,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_40_10_seed_1_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97389615, 'precision': 0.97401565, 'recall': 0.97390234, 'specificity': 0.97390234, 'f1': 0.9738947, 'auroc': 0.9961802, 'binary_precision': 0.9817361, 'binary_recall': 0.9657995, 'binary_specificity': 0.9820051, 'binary_f1_score': 0.9737026}
confusion matrix:
       0      1
0  28268    518
1    986  27844
---- Validation: 
scalar performance:
{'acc': 0.9167023, 'precision': 0.6262007, 'recall': 0.82805157, 'specificity': 0.82805157, 'f1': 0.6712183, 'auroc': 0.8981148, 'binary_precision': 0.26307365, 'binary_recall': 0.73254085, 'binary_specificity': 0.9235623, 'binary_f1_score': 0.38712212}
confusion matrix:
       0     1
0  16686  1381
1    180   493
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88495004, 'precision': 0.6196536, 'recall': 0.86823916, 'specificity': 0.86823916, 'f1': 0.65946007, 'auroc': 0.9287491, 'binary_precision': 0.24665178, 'binary_recall': 0.85, 'binary_specificity': 0.8864783, 'binary_f1_score': 0.38235295}
confusion matrix:
      0    1
0  5271  675
1    39  221
early stop counter: 3
val acc:0.9167022705078125, best validation acc: 0.9331376552581787, corresponding to test acc:                         0.9147599339485168 / 0.9344183206558228
after epoch: 5,now: 2024-08-01 23:49:09.281764,epoch time: 0:25:37.652085,used: 2:08:56.700228,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_40_10_seed_1_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:08:56.700228 at 2024-08-01 23:49:09.281764
persisted model performance metric: 

scalar performance:
{'acc': 0.91475993, 'precision': 0.6493401, 'recall': 0.8709229, 'specificity': 0.8709229, 'f1': 0.70052516, 'auroc': 0.9337498, 'binary_precision': 0.30703014, 'binary_recall': 0.8230769, 'binary_specificity': 0.91876894, 'binary_f1_score': 0.44723094}
confusion matrix:
      0    1
0  5463  483
1    46  214
oracle model performance metric: 

scalar performance:
{'acc': 0.9344183, 'precision': 0.67086613, 'recall': 0.82049537, 'specificity': 0.82049537, 'f1': 0.7178923, 'auroc': 0.9189882, 'binary_precision': 0.35559922, 'binary_recall': 0.6961538, 'binary_specificity': 0.94483685, 'binary_f1_score': 0.4707412}
confusion matrix:
      0    1
0  5618  328
1    79  181
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196690 KiB |   1195 MiB | 297825 GiB | 297825 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 293781 GiB | 293781 GiB |
|       from small pool |  17479 KiB |     37 MiB |   4043 GiB |   4043 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196690 KiB |   1195 MiB | 297825 GiB | 297825 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 293781 GiB | 293781 GiB |
|       from small pool |  17479 KiB |     37 MiB |   4043 GiB |   4043 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   1193 MiB | 297813 GiB | 297813 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 293777 GiB | 293777 GiB |
|       from small pool |  16480 KiB |     36 MiB |   4036 GiB |   4036 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   2434 MiB |   1098 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   2376 MiB |   1078 MiB |
|       from small pool |     38 MiB |     42 MiB |     58 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42926 KiB | 161596 KiB | 156583 GiB | 156583 GiB |
|       from large pool |  31733 KiB | 160090 KiB | 152510 GiB | 152510 GiB |
|       from small pool |  11193 KiB |  16546 KiB |   4073 GiB |   4073 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7677    |   51166 K  |   51163 K  |
|       from large pool |      79    |     167    |   27434 K  |   27434 K  |
|       from small pool |    2875    |    7597    |   23732 K  |   23729 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7677    |   51166 K  |   51163 K  |
|       from large pool |      79    |     167    |   27434 K  |   27434 K  |
|       from small pool |    2875    |    7597    |   23732 K  |   23729 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     128    |      54    |
|       from large pool |      55    |      55    |      99    |      44    |
|       from small pool |      19    |      21    |      29    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      33    |    3619    |   31391 K  |   31391 K  |
|       from large pool |      10    |      59    |   20084 K  |   20084 K  |
|       from small pool |      23    |    3609    |   11306 K  |   11306 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 297825 GiB | 297825 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 293781 GiB | 293781 GiB |
|       from small pool |      0 KiB |     37 MiB |   4043 GiB |   4043 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 297825 GiB | 297825 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 293781 GiB | 293781 GiB |
|       from small pool |      0 KiB |     37 MiB |   4043 GiB |   4043 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 297813 GiB | 297813 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 293777 GiB | 293777 GiB |
|       from small pool |      0 KiB |     36 MiB |   4036 GiB |   4036 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   1346 MiB |   2434 MiB |   2200 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   2376 MiB |   2170 MiB |
|       from small pool |  28672 KiB |     42 MiB |     58 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 156583 GiB | 156583 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 152510 GiB | 152510 GiB |
|       from small pool |      0 KiB |  21453 KiB |   4073 GiB |   4073 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |   51166 K  |   51166 K  |
|       from large pool |       2    |     167    |   27434 K  |   27434 K  |
|       from small pool |       0    |    7597    |   23732 K  |   23732 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |   51166 K  |   51166 K  |
|       from large pool |       2    |     167    |   27434 K  |   27434 K  |
|       from small pool |       0    |    7597    |   23732 K  |   23732 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     128    |     104    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      29    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   31392 K  |   31392 K  |
|       from large pool |       3    |      59    |   20084 K  |   20084 K  |
|       from small pool |       0    |    3609    |   11307 K  |   11307 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 297825 GiB | 297825 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 293781 GiB | 293781 GiB |
|       from small pool |      0 KiB |     37 MiB |   4043 GiB |   4043 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 297825 GiB | 297825 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 293781 GiB | 293781 GiB |
|       from small pool |      0 KiB |     37 MiB |   4043 GiB |   4043 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 297813 GiB | 297813 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 293777 GiB | 293777 GiB |
|       from small pool |      0 KiB |     36 MiB |   4036 GiB |   4036 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   1346 MiB |   2434 MiB |   2200 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   2376 MiB |   2170 MiB |
|       from small pool |  28672 KiB |     42 MiB |     58 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 156583 GiB | 156583 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 152510 GiB | 152510 GiB |
|       from small pool |      0 KiB |  21453 KiB |   4073 GiB |   4073 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |   51166 K  |   51166 K  |
|       from large pool |       2    |     167    |   27434 K  |   27434 K  |
|       from small pool |       0    |    7597    |   23732 K  |   23732 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |   51166 K  |   51166 K  |
|       from large pool |       2    |     167    |   27434 K  |   27434 K  |
|       from small pool |       0    |    7597    |   23732 K  |   23732 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     128    |     104    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      29    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   31392 K  |   31392 K  |
|       from large pool |       3    |      59    |   20084 K  |   20084 K  |
|       from small pool |       0    |    3609    |   11307 K  |   11307 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_23_56_54_seed_2_23919989

 Experiment start at: 2024-08-01 23:56:54.953253
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9465217, 'precision': 0.9483517, 'recall': 0.94653046, 'specificity': 0.94653046, 'f1': 0.94646776, 'auroc': 0.9867878, 'binary_precision': 0.97706455, 'binary_recall': 0.91454047, 'binary_specificity': 0.97852045, 'binary_f1_score': 0.9447692}
confusion matrix:
       0      1
0  28518    626
1   2492  26668
---- Validation: 
scalar performance:
{'acc': 0.94177806, 'precision': 0.6253585, 'recall': 0.71535826, 'specificity': 0.71535826, 'f1': 0.65614694, 'auroc': 0.84778374, 'binary_precision': 0.2686145, 'binary_recall': 0.47342193, 'binary_specificity': 0.9572946, 'binary_f1_score': 0.34275404}
confusion matrix:
       0    1
0  17395  776
1    317  285
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91713417, 'precision': 0.6262355, 'recall': 0.79034495, 'specificity': 0.79034495, 'f1': 0.6674775, 'auroc': 0.87475693, 'binary_precision': 0.2673435, 'binary_recall': 0.6528926, 'binary_specificity': 0.92779726, 'binary_f1_score': 0.37935174}
confusion matrix:
      0    1
0  5564  433
1    84  158
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 00:23:22.611147,epoch time: 0:26:27.657894,used: 0:26:27.657894,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_23_56_54_seed_2_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96391326, 'precision': 0.9641783, 'recall': 0.9639145, 'specificity': 0.9639145, 'f1': 0.9639082, 'auroc': 0.99254906, 'binary_precision': 0.9752961, 'binary_recall': 0.9519465, 'binary_specificity': 0.97588253, 'binary_f1_score': 0.9634799}
confusion matrix:
       0      1
0  28446    703
1   1401  27754
---- Validation: 
scalar performance:
{'acc': 0.9401268, 'precision': 0.6322901, 'recall': 0.7522485, 'specificity': 0.7522485, 'f1': 0.66996557, 'auroc': 0.8654935, 'binary_precision': 0.27993256, 'binary_recall': 0.551495, 'binary_specificity': 0.95300204, 'binary_f1_score': 0.37136465}
confusion matrix:
       0    1
0  17317  854
1    270  332
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9200192, 'precision': 0.64119786, 'recall': 0.8394314, 'specificity': 0.8394314, 'f1': 0.6894114, 'auroc': 0.90679705, 'binary_precision': 0.29307568, 'binary_recall': 0.75206614, 'binary_specificity': 0.92679673, 'binary_f1_score': 0.4217845}
confusion matrix:
      0    1
0  5558  439
1    60  182
new oracle model saved
early stop counter: 1
val acc:0.9401267766952515, best validation acc: 0.9417780637741089, corresponding to test acc:                         0.917134165763855 / 0.9200192093849182
after epoch: 2,now: 2024-08-02 00:49:36.558978,epoch time: 0:26:13.947831,used: 0:52:41.605725,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_23_56_54_seed_2_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96887004, 'precision': 0.9695052, 'recall': 0.96887386, 'specificity': 0.96887386, 'f1': 0.96885973, 'auroc': 0.99485993, 'binary_precision': 0.98682475, 'binary_recall': 0.95044243, 'binary_specificity': 0.9873053, 'binary_f1_score': 0.96829194}
confusion matrix:
       0      1
0  28776    370
1   1445  27713
---- Validation: 
scalar performance:
{'acc': 0.9336281, 'precision': 0.6256151, 'recall': 0.77378607, 'specificity': 0.77378607, 'f1': 0.6665643, 'auroc': 0.87512314, 'binary_precision': 0.2649635, 'binary_recall': 0.60299003, 'binary_specificity': 0.94458205, 'binary_f1_score': 0.36815417}
confusion matrix:
       0     1
0  17164  1007
1    239   363
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9185767, 'precision': 0.64159346, 'recall': 0.8505775, 'specificity': 0.8505775, 'f1': 0.6907618, 'auroc': 0.91516024, 'binary_precision': 0.29283488, 'binary_recall': 0.7768595, 'binary_specificity': 0.9242955, 'binary_f1_score': 0.42533934}
confusion matrix:
      0    1
0  5543  454
1    54  188
early stop counter: 2
val acc:0.9336280822753906, best validation acc: 0.9417780637741089, corresponding to test acc:                         0.917134165763855 / 0.9200192093849182
after epoch: 3,now: 2024-08-02 01:15:50.813799,epoch time: 0:26:14.254821,used: 1:18:55.860546,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_23_56_54_seed_2_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97200876, 'precision': 0.97246027, 'recall': 0.972012, 'specificity': 0.972012, 'f1': 0.97200215, 'auroc': 0.99581885, 'binary_precision': 0.9871169, 'binary_recall': 0.9565128, 'binary_specificity': 0.98751116, 'binary_f1_score': 0.9715738}
confusion matrix:
       0      1
0  28782    364
1   1268  27890
---- Validation: 
scalar performance:
{'acc': 0.9337346, 'precision': 0.6268008, 'recall': 0.77785635, 'specificity': 0.77785635, 'f1': 0.66836995, 'auroc': 0.8801162, 'binary_precision': 0.2670537, 'binary_recall': 0.6112957, 'binary_specificity': 0.94441694, 'binary_f1_score': 0.37171715}
confusion matrix:
       0     1
0  17161  1010
1    234   368
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92258376, 'precision': 0.64714277, 'recall': 0.85067916, 'specificity': 0.85067916, 'f1': 0.6974217, 'auroc': 0.9225054, 'binary_precision': 0.30406505, 'binary_recall': 0.77272725, 'binary_specificity': 0.928631, 'binary_f1_score': 0.4364061}
confusion matrix:
      0    1
0  5569  428
1    55  187
new oracle model saved
early stop counter: 3
val acc:0.9337345957756042, best validation acc: 0.9417780637741089, corresponding to test acc:                         0.917134165763855 / 0.9225837588310242
after epoch: 4,now: 2024-08-02 01:42:46.943197,epoch time: 0:26:56.129398,used: 1:45:51.989944,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_23_56_54_seed_2_23919989
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:45:51.989944 at 2024-08-02 01:42:46.943197
persisted model performance metric: 

scalar performance:
{'acc': 0.91713417, 'precision': 0.6262355, 'recall': 0.79034495, 'specificity': 0.79034495, 'f1': 0.6674775, 'auroc': 0.87475693, 'binary_precision': 0.2673435, 'binary_recall': 0.6528926, 'binary_specificity': 0.92779726, 'binary_f1_score': 0.37935174}
confusion matrix:
      0    1
0  5564  433
1    84  158
oracle model performance metric: 

scalar performance:
{'acc': 0.92258376, 'precision': 0.64714277, 'recall': 0.85067916, 'specificity': 0.85067916, 'f1': 0.6974217, 'auroc': 0.9225054, 'binary_precision': 0.30406505, 'binary_recall': 0.77272725, 'binary_specificity': 0.928631, 'binary_f1_score': 0.4364061}
confusion matrix:
      0    1
0  5569  428
1    55  187
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196696 KiB |   1195 MiB | 432123 GiB | 432122 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 426255 GiB | 426255 GiB |
|       from small pool |  17485 KiB |     37 MiB |   5867 GiB |   5867 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196696 KiB |   1195 MiB | 432123 GiB | 432122 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 426255 GiB | 426255 GiB |
|       from small pool |  17485 KiB |     37 MiB |   5867 GiB |   5867 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195460 KiB |   1193 MiB | 432104 GiB | 432103 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 426247 GiB | 426247 GiB |
|       from small pool |  16481 KiB |     36 MiB |   5856 GiB |   5856 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   3536 MiB |   2200 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   3468 MiB |   2170 MiB |
|       from small pool |     38 MiB |     42 MiB |     68 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40872 KiB | 161596 KiB | 229663 GiB | 229663 GiB |
|       from large pool |  31733 KiB | 160090 KiB | 223704 GiB | 223704 GiB |
|       from small pool |   9139 KiB |  21453 KiB |   5959 GiB |   5959 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7763    |   74234 K  |   74231 K  |
|       from large pool |      79    |     167    |   39805 K  |   39805 K  |
|       from small pool |    2887    |    7683    |   34428 K  |   34426 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7763    |   74234 K  |   74231 K  |
|       from large pool |      79    |     167    |   39805 K  |   39805 K  |
|       from small pool |    2887    |    7683    |   34428 K  |   34426 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     178    |     104    |
|       from large pool |      55    |      55    |     144    |      89    |
|       from small pool |      19    |      21    |      34    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3663    |   46640 K  |   46640 K  |
|       from large pool |      10    |      59    |   29371 K  |   29371 K  |
|       from small pool |      21    |    3653    |   17269 K  |   17269 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 432123 GiB | 432123 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 426255 GiB | 426255 GiB |
|       from small pool |      0 KiB |     37 MiB |   5867 GiB |   5867 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 432123 GiB | 432123 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 426255 GiB | 426255 GiB |
|       from small pool |      0 KiB |     37 MiB |   5867 GiB |   5867 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 432104 GiB | 432104 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 426247 GiB | 426247 GiB |
|       from small pool |      0 KiB |     36 MiB |   5856 GiB |   5856 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1346 MiB |   3536 MiB |   3304 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   3468 MiB |   3262 MiB |
|       from small pool |  26624 KiB |     42 MiB |     68 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 161596 KiB | 229664 GiB | 229663 GiB |
|       from large pool |  30464 KiB | 160090 KiB | 223704 GiB | 223704 GiB |
|       from small pool |      0 KiB |  23495 KiB |   5959 GiB |   5959 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7763    |   74234 K  |   74234 K  |
|       from large pool |       2    |     167    |   39805 K  |   39805 K  |
|       from small pool |       0    |    7683    |   34428 K  |   34428 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7763    |   74234 K  |   74234 K  |
|       from large pool |       2    |     167    |   39805 K  |   39805 K  |
|       from small pool |       0    |    7683    |   34428 K  |   34428 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     178    |     155    |
|       from large pool |      10    |      55    |     144    |     134    |
|       from small pool |      13    |      21    |      34    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3663    |   46641 K  |   46641 K  |
|       from large pool |       3    |      59    |   29371 K  |   29371 K  |
|       from small pool |       0    |    3653    |   17270 K  |   17270 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 01:44:11 2024]
Finished job 0.
1 of 1 steps (100%) done
