Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 08:22:59 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/18.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=18
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_34_07_seed_0_23919999

 Experiment start at: 2024-08-02 08:34:07.339438
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.22451263666152954
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9387901, 'precision': 0.94239634, 'recall': 0.93882483, 'specificity': 0.93882483, 'f1': 0.9386685, 'auroc': 0.9774535, 'binary_precision': 0.9825308, 'binary_recall': 0.8935614, 'binary_specificity': 0.98408824, 'binary_f1_score': 0.93593657}
confusion matrix:
       0      1
0  28202    456
1   3055  25647
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.95508724, 'precision': 0.5495455, 'recall': 0.5214645, 'specificity': 0.5214645, 'f1': 0.5277927, 'auroc': 0.75529575, 'binary_precision': 0.13186814, 'binary_recall': 0.05598756, 'binary_specificity': 0.98694146, 'binary_f1_score': 0.07860263}
confusion matrix:
       0    1
0  17912  237
1    607   36
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9400767, 'precision': 0.5611453, 'recall': 0.53996825, 'specificity': 0.53996825, 'f1': 0.54742455, 'auroc': 0.82229817, 'binary_precision': 0.16071428, 'binary_recall': 0.10344828, 'binary_specificity': 0.97648823, 'binary_f1_score': 0.12587413}
confusion matrix:
      0    1
0  5856  141
1   234   27
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 09:06:47.275411,epoch time: 0:32:39.935973,used: 0:32:39.935973,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_34_07_seed_0_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.954341, 'precision': 0.9568702, 'recall': 0.95436704, 'specificity': 0.95436704, 'f1': 0.95427954, 'auroc': 0.98705316, 'binary_precision': 0.99103814, 'binary_recall': 0.9170383, 'binary_specificity': 0.99169576, 'binary_f1_score': 0.9526033}
confusion matrix:
       0      1
0  28422    238
1   2381  26319
---- Validation: 
scalar performance:
{'acc': 0.962218, 'precision': 0.67004204, 'recall': 0.56940943, 'specificity': 0.56940943, 'f1': 0.5958783, 'auroc': 0.8138969, 'binary_precision': 0.3696498, 'binary_recall': 0.14774494, 'binary_specificity': 0.9910739, 'binary_f1_score': 0.21111111}
confusion matrix:
       0    1
0  17987  162
1    548   95
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9547779, 'precision': 0.7044724, 'recall': 0.64292014, 'specificity': 0.64292014, 'f1': 0.6674199, 'auroc': 0.85767853, 'binary_precision': 0.43888888, 'binary_recall': 0.30268198, 'binary_specificity': 0.98315823, 'binary_f1_score': 0.35827667}
confusion matrix:
      0    1
0  5896  101
1   182   79
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 09:39:05.548291,epoch time: 0:32:18.272880,used: 1:04:58.208853,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_34_07_seed_0_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96274406, 'precision': 0.963153, 'recall': 0.962754, 'specificity': 0.962754, 'f1': 0.96273637, 'auroc': 0.990401, 'binary_precision': 0.9770817, 'binary_recall': 0.9477682, 'binary_specificity': 0.9777398, 'binary_f1_score': 0.9622017}
confusion matrix:
       0      1
0  28023    638
1   1499  27200
---- Validation: 
scalar performance:
{'acc': 0.95157516, 'precision': 0.6530756, 'recall': 0.6831583, 'specificity': 0.6831583, 'f1': 0.6665447, 'auroc': 0.85224044, 'binary_precision': 0.32774192, 'binary_recall': 0.39502332, 'binary_specificity': 0.9712932, 'binary_f1_score': 0.35825107}
confusion matrix:
       0    1
0  17628  521
1    389  254
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9448706, 'precision': 0.6897318, 'recall': 0.78800225, 'specificity': 0.78800225, 'f1': 0.7268211, 'auroc': 0.8738233, 'binary_precision': 0.39655173, 'binary_recall': 0.61685824, 'binary_specificity': 0.95914626, 'binary_f1_score': 0.4827586}
confusion matrix:
      0    1
0  5752  245
1   100  161
early stop counter: 1
val acc:0.9515751600265503, best validation acc: 0.9622179865837097, corresponding to test acc:                         0.9547778964042664 / 0.9547778964042664
after epoch: 3,now: 2024-08-02 10:12:44.314967,epoch time: 0:33:38.766676,used: 1:38:36.975529,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_34_07_seed_0_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9664226, 'precision': 0.9670259, 'recall': 0.96643776, 'specificity': 0.96643776, 'f1': 0.96641254, 'auroc': 0.9922565, 'binary_precision': 0.9840214, 'binary_recall': 0.9482999, 'binary_specificity': 0.9845756, 'binary_f1_score': 0.9658305}
confusion matrix:
       0      1
0  28214    442
1   1484  27220
---- Validation: 
scalar performance:
{'acc': 0.94678587, 'precision': 0.6450938, 'recall': 0.7084308, 'specificity': 0.7084308, 'f1': 0.6700563, 'auroc': 0.86301225, 'binary_precision': 0.30990416, 'binary_recall': 0.4525661, 'binary_specificity': 0.96429557, 'binary_f1_score': 0.36788875}
confusion matrix:
       0    1
0  17501  648
1    352  291
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9341643, 'precision': 0.667947, 'recall': 0.8117335, 'specificity': 0.8117335, 'f1': 0.7135386, 'auroc': 0.879652, 'binary_precision': 0.35049504, 'binary_recall': 0.6781609, 'binary_specificity': 0.945306, 'binary_f1_score': 0.46214095}
confusion matrix:
      0    1
0  5669  328
1    84  177
early stop counter: 2
val acc:0.9467858672142029, best validation acc: 0.9622179865837097, corresponding to test acc:                         0.9547778964042664 / 0.9547778964042664
after epoch: 4,now: 2024-08-02 10:46:22.582160,epoch time: 0:33:38.267193,used: 2:12:15.242722,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_34_07_seed_0_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9704847, 'precision': 0.9710236, 'recall': 0.9704983, 'specificity': 0.9704983, 'f1': 0.97047687, 'auroc': 0.9938909, 'binary_precision': 0.98715824, 'binary_recall': 0.9534195, 'binary_specificity': 0.9875772, 'binary_f1_score': 0.9699956}
confusion matrix:
       0      1
0  28301    356
1   1337  27366
---- Validation: 
scalar performance:
{'acc': 0.93135375, 'precision': 0.6217262, 'recall': 0.7454447, 'specificity': 0.7454447, 'f1': 0.6580828, 'auroc': 0.8695152, 'binary_precision': 0.26019272, 'binary_recall': 0.5458787, 'binary_specificity': 0.9450107, 'binary_f1_score': 0.35240963}
confusion matrix:
       0    1
0  17151  998
1    292  351
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.900767, 'precision': 0.6206862, 'recall': 0.81263137, 'specificity': 0.81263137, 'f1': 0.66098887, 'auroc': 0.8813021, 'binary_precision': 0.2547684, 'binary_recall': 0.71647507, 'binary_specificity': 0.9087877, 'binary_f1_score': 0.37587938}
confusion matrix:
      0    1
0  5450  547
1    74  187
early stop counter: 3
val acc:0.931353747844696, best validation acc: 0.9622179865837097, corresponding to test acc:                         0.9547778964042664 / 0.9547778964042664
after epoch: 5,now: 2024-08-02 11:19:01.784821,epoch time: 0:32:39.202661,used: 2:44:54.445383,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_34_07_seed_0_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:44:54.445383 at 2024-08-02 11:19:01.784821
persisted model performance metric: 

scalar performance:
{'acc': 0.9547779, 'precision': 0.7044724, 'recall': 0.64292014, 'specificity': 0.64292014, 'f1': 0.6674199, 'auroc': 0.85767853, 'binary_precision': 0.43888888, 'binary_recall': 0.30268198, 'binary_specificity': 0.98315823, 'binary_f1_score': 0.35827667}
confusion matrix:
      0    1
0  5896  101
1   182   79
oracle model performance metric: 

scalar performance:
{'acc': 0.9547779, 'precision': 0.7044724, 'recall': 0.64292014, 'specificity': 0.64292014, 'f1': 0.6674199, 'auroc': 0.85767853, 'binary_precision': 0.43888888, 'binary_recall': 0.30268198, 'binary_specificity': 0.98315823, 'binary_f1_score': 0.35827667}
confusion matrix:
      0    1
0  5896  101
1   182   79
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/18.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/18.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/18.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198163 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |  17501 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198163 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |  17501 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB | 264554 GiB | 264554 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 261360 GiB | 261360 GiB |
|       from small pool |  16482 KiB |     36 MiB |   3194 GiB |   3194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  57837 KiB | 225565 KiB | 142326 GiB | 142326 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 139103 GiB | 139102 GiB |
|       from small pool |   7075 KiB |   9877 KiB |   3223 GiB |   3223 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2998    |    7665    |   39922 K  |   39919 K  |
|       from large pool |      79    |     252    |   24056 K  |   24056 K  |
|       from small pool |    2919    |    7585    |   15865 K  |   15862 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2998    |    7665    |   39922 K  |   39919 K  |
|       from large pool |      79    |     252    |   24056 K  |   24056 K  |
|       from small pool |    2919    |    7585    |   15865 K  |   15862 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3602    |   25852 K  |   25852 K  |
|       from large pool |      10    |      97    |   18685 K  |   18685 K  |
|       from small pool |      29    |    3592    |    7166 K  |    7166 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 264554 GiB | 264554 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 261360 GiB | 261360 GiB |
|       from small pool |      0 KiB |     36 MiB |   3194 GiB |   3194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   2372 MiB |   2372 MiB |   2122 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 142326 GiB | 142326 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 139103 GiB | 139103 GiB |
|       from small pool |      0 KiB |  20640 KiB |   3223 GiB |   3223 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     118    |      95    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3602    |   25853 K  |   25853 K  |
|       from large pool |       3    |      97    |   18685 K  |   18685 K  |
|       from small pool |       0    |    3592    |    7167 K  |    7167 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 264581 GiB | 264581 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 261381 GiB | 261381 GiB |
|       from small pool |      0 KiB |     37 MiB |   3199 GiB |   3199 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 264554 GiB | 264554 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 261360 GiB | 261360 GiB |
|       from small pool |      0 KiB |     36 MiB |   3194 GiB |   3194 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   2372 MiB |   2372 MiB |   2122 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 142326 GiB | 142326 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 139103 GiB | 139103 GiB |
|       from small pool |      0 KiB |  20640 KiB |   3223 GiB |   3223 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   39922 K  |   39922 K  |
|       from large pool |       2    |     252    |   24056 K  |   24056 K  |
|       from small pool |       0    |    7585    |   15865 K  |   15865 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     118    |      95    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3602    |   25853 K  |   25853 K  |
|       from large pool |       3    |      97    |   18685 K  |   18685 K  |
|       from small pool |       0    |    3592    |    7167 K  |    7167 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_11_30_46_seed_1_23919999

 Experiment start at: 2024-08-02 11:30:46.837928
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6890106797218323
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93664956, 'precision': 0.9408587, 'recall': 0.9366852, 'specificity': 0.9366852, 'f1': 0.9365015, 'auroc': 0.981678, 'binary_precision': 0.98411846, 'binary_recall': 0.88771725, 'binary_specificity': 0.9856532, 'binary_f1_score': 0.9334355}
confusion matrix:
       0      1
0  28374    413
1   3237  25592
---- Validation: 
scalar performance:
{'acc': 0.94530416, 'precision': 0.6149373, 'recall': 0.62329817, 'specificity': 0.62329817, 'f1': 0.6189391, 'auroc': 0.8406065, 'binary_precision': 0.2569061, 'binary_recall': 0.27637443, 'binary_specificity': 0.97022194, 'binary_f1_score': 0.2662849}
confusion matrix:
       0    1
0  17529  538
1    487  186
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9465034, 'precision': 0.6817624, 'recall': 0.7201409, 'specificity': 0.7201409, 'f1': 0.6987754, 'auroc': 0.8874134, 'binary_precision': 0.38679245, 'binary_recall': 0.4730769, 'binary_specificity': 0.96720487, 'binary_f1_score': 0.42560554}
confusion matrix:
      0    1
0  5751  195
1   137  123
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 12:03:53.555762,epoch time: 0:33:06.717834,used: 0:33:06.717834,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_11_30_46_seed_1_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95228755, 'precision': 0.9544628, 'recall': 0.9523141, 'specificity': 0.9523141, 'f1': 0.95223236, 'auroc': 0.98893297, 'binary_precision': 0.9860961, 'binary_recall': 0.91758585, 'binary_specificity': 0.9870423, 'binary_f1_score': 0.9506082}
confusion matrix:
       0      1
0  28413    373
1   2376  26454
---- Validation: 
scalar performance:
{'acc': 0.9543757, 'precision': 0.67309904, 'recall': 0.6787869, 'specificity': 0.6787869, 'f1': 0.6758898, 'auroc': 0.86859125, 'binary_precision': 0.36925286, 'binary_recall': 0.3818722, 'binary_specificity': 0.9757016, 'binary_f1_score': 0.3754565}
confusion matrix:
       0    1
0  17628  439
1    416  257
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.959233, 'precision': 0.74697006, 'recall': 0.7893095, 'specificity': 0.7893095, 'f1': 0.7662163, 'auroc': 0.9089931, 'binary_precision': 0.51140064, 'binary_recall': 0.60384613, 'binary_specificity': 0.97477293, 'binary_f1_score': 0.5537919}
confusion matrix:
      0    1
0  5796  150
1   103  157
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 12:36:31.070939,epoch time: 0:32:37.515177,used: 1:05:44.233011,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_11_30_46_seed_1_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96117395, 'precision': 0.96142006, 'recall': 0.9611825, 'specificity': 0.9611825, 'f1': 0.96116924, 'auroc': 0.9920321, 'binary_precision': 0.9722597, 'binary_recall': 0.9494953, 'binary_specificity': 0.9728697, 'binary_f1_score': 0.96074265}
confusion matrix:
       0      1
0  28006    781
1   1456  27373
---- Validation: 
scalar performance:
{'acc': 0.95037353, 'precision': 0.6739485, 'recall': 0.7439464, 'specificity': 0.7439464, 'f1': 0.70210207, 'auroc': 0.8753532, 'binary_precision': 0.36600626, 'binary_recall': 0.5215453, 'binary_specificity': 0.96634746, 'binary_f1_score': 0.43014705}
confusion matrix:
       0    1
0  17459  608
1    322  351
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9498872, 'precision': 0.7134601, 'recall': 0.83776295, 'specificity': 0.83776295, 'f1': 0.7590702, 'auroc': 0.92319334, 'binary_precision': 0.4397163, 'binary_recall': 0.7153846, 'binary_specificity': 0.9601413, 'binary_f1_score': 0.5446559}
confusion matrix:
      0    1
0  5709  237
1    74  186
early stop counter: 1
val acc:0.9503735303878784, best validation acc: 0.954375684261322, corresponding to test acc:                         0.9592329859733582 / 0.9592329859733582
after epoch: 3,now: 2024-08-02 13:12:16.609912,epoch time: 0:35:45.538973,used: 1:41:29.771984,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_11_30_46_seed_1_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9643849, 'precision': 0.96447635, 'recall': 0.9643901, 'specificity': 0.9643901, 'f1': 0.9643834, 'auroc': 0.9935311, 'binary_precision': 0.9711772, 'binary_recall': 0.95723057, 'binary_specificity': 0.97154963, 'binary_f1_score': 0.96415347}
confusion matrix:
       0      1
0  27968    819
1   1233  27596
---- Validation: 
scalar performance:
{'acc': 0.9517076, 'precision': 0.6796528, 'recall': 0.7482146, 'specificity': 0.7482146, 'f1': 0.7075434, 'auroc': 0.878065, 'binary_precision': 0.37711865, 'binary_recall': 0.5289747, 'binary_specificity': 0.9674545, 'binary_f1_score': 0.44032156}
confusion matrix:
       0    1
0  17479  588
1    317  356
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95391554, 'precision': 0.7262877, 'recall': 0.8288313, 'specificity': 0.8288313, 'f1': 0.76648414, 'auroc': 0.9293145, 'binary_precision': 0.46632123, 'binary_recall': 0.6923077, 'binary_specificity': 0.96535486, 'binary_f1_score': 0.55727553}
confusion matrix:
      0    1
0  5740  206
1    80  180
early stop counter: 2
val acc:0.9517076015472412, best validation acc: 0.954375684261322, corresponding to test acc:                         0.9592329859733582 / 0.9592329859733582
after epoch: 4,now: 2024-08-02 13:48:16.982278,epoch time: 0:36:00.372366,used: 2:17:30.144350,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_11_30_46_seed_1_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9691405, 'precision': 0.9692146, 'recall': 0.9691452, 'specificity': 0.9691452, 'f1': 0.9691396, 'auroc': 0.9947306, 'binary_precision': 0.9752961, 'binary_recall': 0.96271116, 'binary_specificity': 0.97557926, 'binary_f1_score': 0.9689628}
confusion matrix:
       0      1
0  28084    703
1   1075  27754
---- Validation: 
scalar performance:
{'acc': 0.94215584, 'precision': 0.655319, 'recall': 0.7661494, 'specificity': 0.7661494, 'f1': 0.69338596, 'auroc': 0.8774482, 'binary_precision': 0.32687446, 'binary_recall': 0.576523, 'binary_specificity': 0.95577574, 'binary_f1_score': 0.4172043}
confusion matrix:
       0    1
0  17268  799
1    285  388
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9429584, 'precision': 0.6946093, 'recall': 0.843342, 'specificity': 0.843342, 'f1': 0.7443516, 'auroc': 0.93262047, 'binary_precision': 0.4012605, 'binary_recall': 0.7346154, 'binary_specificity': 0.9520686, 'binary_f1_score': 0.51902175}
confusion matrix:
      0    1
0  5661  285
1    69  191
early stop counter: 3
val acc:0.9421558380126953, best validation acc: 0.954375684261322, corresponding to test acc:                         0.9592329859733582 / 0.9592329859733582
after epoch: 5,now: 2024-08-02 14:23:37.271670,epoch time: 0:35:20.289392,used: 2:52:50.433742,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_11_30_46_seed_1_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:52:50.433742 at 2024-08-02 14:23:37.271670
persisted model performance metric: 

scalar performance:
{'acc': 0.959233, 'precision': 0.74697006, 'recall': 0.7893095, 'specificity': 0.7893095, 'f1': 0.7662163, 'auroc': 0.9089931, 'binary_precision': 0.51140064, 'binary_recall': 0.60384613, 'binary_specificity': 0.97477293, 'binary_f1_score': 0.5537919}
confusion matrix:
      0    1
0  5796  150
1   103  157
oracle model performance metric: 

scalar performance:
{'acc': 0.959233, 'precision': 0.74697006, 'recall': 0.7893095, 'specificity': 0.7893095, 'f1': 0.7662163, 'auroc': 0.9089931, 'binary_precision': 0.51140064, 'binary_recall': 0.60384613, 'binary_specificity': 0.97477293, 'binary_f1_score': 0.5537919}
confusion matrix:
      0    1
0  5796  150
1   103  157
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/18.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/18.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196700 KiB |   2142 MiB | 530154 GiB | 530154 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 523746 GiB | 523746 GiB |
|       from small pool |  17489 KiB |     37 MiB |   6408 GiB |   6408 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196700 KiB |   2142 MiB | 530154 GiB | 530154 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 523746 GiB | 523746 GiB |
|       from small pool |  17489 KiB |     37 MiB |   6408 GiB |   6408 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   2141 MiB | 530091 GiB | 530091 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 523693 GiB | 523693 GiB |
|       from small pool |  16480 KiB |     36 MiB |   6398 GiB |   6398 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   4476 MiB |   2122 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   4420 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     56 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40868 KiB | 232750 KiB | 289271 GiB | 289271 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 282816 GiB | 282816 GiB |
|       from small pool |   9135 KiB |  20640 KiB |   6455 GiB |   6455 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2974    |    7697    |   79969 K  |   79966 K  |
|       from large pool |      79    |     252    |   48202 K  |   48202 K  |
|       from small pool |    2895    |    7617    |   31766 K  |   31764 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2974    |    7697    |   79969 K  |   79966 K  |
|       from large pool |      79    |     252    |   48202 K  |   48202 K  |
|       from small pool |    2895    |    7617    |   31766 K  |   31764 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     210    |      95    |
|       from large pool |      96    |      97    |     182    |      86    |
|       from small pool |      19    |      21    |      28    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      42    |    3619    |   51148 K  |   51148 K  |
|       from large pool |      11    |     100    |   36842 K  |   36842 K  |
|       from small pool |      31    |    3608    |   14306 K  |   14306 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 530154 GiB | 530154 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 523746 GiB | 523746 GiB |
|       from small pool |      0 KiB |     37 MiB |   6408 GiB |   6408 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 530154 GiB | 530154 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 523746 GiB | 523746 GiB |
|       from small pool |      0 KiB |     37 MiB |   6408 GiB |   6408 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 530091 GiB | 530091 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 523693 GiB | 523693 GiB |
|       from small pool |      0 KiB |     36 MiB |   6398 GiB |   6398 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   4476 MiB |   4244 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  26624 KiB |     42 MiB |     56 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 232750 KiB | 289272 GiB | 289271 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 282816 GiB | 282816 GiB |
|       from small pool |      0 KiB |  23492 KiB |   6455 GiB |   6455 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   79969 K  |   79969 K  |
|       from large pool |       2    |     252    |   48202 K  |   48202 K  |
|       from small pool |       0    |    7617    |   31766 K  |   31766 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   79969 K  |   79969 K  |
|       from large pool |       2    |     252    |   48202 K  |   48202 K  |
|       from small pool |       0    |    7617    |   31766 K  |   31766 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     210    |     187    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      13    |      21    |      28    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   51150 K  |   51150 K  |
|       from large pool |       3    |     100    |   36842 K  |   36842 K  |
|       from small pool |       0    |    3608    |   14307 K  |   14307 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 530154 GiB | 530154 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 523746 GiB | 523746 GiB |
|       from small pool |      0 KiB |     37 MiB |   6408 GiB |   6408 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 530154 GiB | 530154 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 523746 GiB | 523746 GiB |
|       from small pool |      0 KiB |     37 MiB |   6408 GiB |   6408 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 530091 GiB | 530091 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 523693 GiB | 523693 GiB |
|       from small pool |      0 KiB |     36 MiB |   6398 GiB |   6398 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   4476 MiB |   4244 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4420 MiB |   4214 MiB |
|       from small pool |  26624 KiB |     42 MiB |     56 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 232750 KiB | 289272 GiB | 289271 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 282816 GiB | 282816 GiB |
|       from small pool |      0 KiB |  23492 KiB |   6455 GiB |   6455 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   79969 K  |   79969 K  |
|       from large pool |       2    |     252    |   48202 K  |   48202 K  |
|       from small pool |       0    |    7617    |   31766 K  |   31766 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   79969 K  |   79969 K  |
|       from large pool |       2    |     252    |   48202 K  |   48202 K  |
|       from small pool |       0    |    7617    |   31766 K  |   31766 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     210    |     187    |
|       from large pool |      10    |      97    |     182    |     172    |
|       from small pool |      13    |      21    |      28    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   51150 K  |   51150 K  |
|       from large pool |       3    |     100    |   36842 K  |   36842 K  |
|       from small pool |       0    |    3608    |   14307 K  |   14307 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_14_37_44_seed_2_23919999

 Experiment start at: 2024-08-02 14:37:44.529299
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.10803013294935226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.91660947, 'precision': 0.9248978, 'recall': 0.91662383, 'specificity': 0.91662383, 'f1': 0.9162028, 'auroc': 0.9571883, 'binary_precision': 0.9842928, 'binary_recall': 0.8467659, 'binary_specificity': 0.98648185, 'binary_f1_score': 0.9103646}
confusion matrix:
       0      1
0  28752    394
1   4468  24690
---- Validation: 
scalar performance:
{'acc': 0.9612209, 'precision': 0.5398659, 'recall': 0.5109878, 'specificity': 0.5109878, 'f1': 0.51366407, 'auroc': 0.57909715, 'binary_precision': 0.11111111, 'binary_recall': 0.029900333, 'binary_specificity': 0.99207526, 'binary_f1_score': 0.04712042}
confusion matrix:
       0    1
0  18027  144
1    584   18
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9548004, 'precision': 0.5224452, 'recall': 0.504596, 'specificity': 0.504596, 'f1': 0.5022244, 'auroc': 0.5569538, 'binary_precision': 0.083333336, 'binary_recall': 0.016528925, 'binary_specificity': 0.992663, 'binary_f1_score': 0.027586207}
confusion matrix:
      0   1
0  5953  44
1   238   4
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 15:13:28.294980,epoch time: 0:35:43.765681,used: 0:35:43.765681,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_14_37_44_seed_2_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9400727, 'precision': 0.94377565, 'recall': 0.9400837, 'specificity': 0.9400837, 'f1': 0.93994844, 'auroc': 0.97434735, 'binary_precision': 0.9843732, 'binary_recall': 0.8943722, 'binary_specificity': 0.98579514, 'binary_f1_score': 0.937217}
confusion matrix:
       0      1
0  28731    414
1   3080  26079
---- Validation: 
scalar performance:
{'acc': 0.9645235, 'precision': 0.60349137, 'recall': 0.52152735, 'specificity': 0.52152735, 'f1': 0.53101176, 'auroc': 0.70843744, 'binary_precision': 0.23770492, 'binary_recall': 0.048172757, 'binary_specificity': 0.9948819, 'binary_f1_score': 0.0801105}
confusion matrix:
       0   1
0  18078  93
1    573  29
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95656353, 'precision': 0.56999964, 'recall': 0.51344407, 'specificity': 0.51344407, 'f1': 0.5167598, 'auroc': 0.7018192, 'binary_precision': 0.17777778, 'binary_recall': 0.03305785, 'binary_specificity': 0.99383026, 'binary_f1_score': 0.05574913}
confusion matrix:
      0   1
0  5960  37
1   234   8
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 15:46:04.661218,epoch time: 0:32:36.366238,used: 1:08:20.131919,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_14_37_44_seed_2_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.95345086, 'precision': 0.9553369, 'recall': 0.9534553, 'specificity': 0.9534553, 'f1': 0.953403, 'auroc': 0.98371625, 'binary_precision': 0.9846763, 'binary_recall': 0.9212512, 'binary_specificity': 0.9856594, 'binary_f1_score': 0.9519084}
confusion matrix:
       0      1
0  28730    418
1   2296  26860
---- Validation: 
scalar performance:
{'acc': 0.96415067, 'precision': 0.6453905, 'recall': 0.5486384, 'specificity': 0.5486384, 'f1': 0.5696913, 'auroc': 0.77183235, 'binary_precision': 0.31979695, 'binary_recall': 0.10465116, 'binary_specificity': 0.9926256, 'binary_f1_score': 0.15769711}
confusion matrix:
       0    1
0  18037  134
1    539   63
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9578458, 'precision': 0.6767895, 'recall': 0.5696278, 'specificity': 0.5696278, 'f1': 0.5966334, 'auroc': 0.8078729, 'binary_precision': 0.38709676, 'binary_recall': 0.14876033, 'binary_specificity': 0.99049526, 'binary_f1_score': 0.21492538}
confusion matrix:
      0   1
0  5940  57
1   206  36
new oracle model saved
early stop counter: 1
val acc:0.9641506671905518, best validation acc: 0.9645234942436218, corresponding to test acc:                         0.9565635323524475 / 0.9578458070755005
after epoch: 3,now: 2024-08-02 16:18:36.838224,epoch time: 0:32:32.177006,used: 1:40:52.308925,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_14_37_44_seed_2_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9591623, 'precision': 0.9605034, 'recall': 0.95916605, 'specificity': 0.95916605, 'f1': 0.9591328, 'auroc': 0.9870034, 'binary_precision': 0.9853885, 'binary_recall': 0.93215805, 'binary_specificity': 0.986174, 'binary_f1_score': 0.9580345}
confusion matrix:
       0      1
0  28745    403
1   1978  27178
---- Validation: 
scalar performance:
{'acc': 0.9627657, 'precision': 0.67824847, 'recall': 0.6218034, 'specificity': 0.6218034, 'f1': 0.6440518, 'auroc': 0.82440674, 'binary_precision': 0.38083538, 'binary_recall': 0.25747508, 'binary_specificity': 0.9861317, 'binary_f1_score': 0.3072349}
confusion matrix:
       0    1
0  17919  252
1    447  155
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9570444, 'precision': 0.7090952, 'recall': 0.69412357, 'specificity': 0.69412357, 'f1': 0.70129085, 'auroc': 0.8582997, 'binary_precision': 0.4419643, 'binary_recall': 0.4090909, 'binary_specificity': 0.97915626, 'binary_f1_score': 0.42489272}
confusion matrix:
      0    1
0  5872  125
1   143   99
early stop counter: 2
val acc:0.9627656936645508, best validation acc: 0.9645234942436218, corresponding to test acc:                         0.9565635323524475 / 0.9578458070755005
after epoch: 4,now: 2024-08-02 16:51:44.576647,epoch time: 0:33:07.738423,used: 2:14:00.047348,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_14_37_44_seed_2_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.96470225, 'precision': 0.9648909, 'recall': 0.96470433, 'specificity': 0.96470433, 'f1': 0.9646988, 'auroc': 0.9901291, 'binary_precision': 0.97430694, 'binary_recall': 0.9545922, 'binary_specificity': 0.97481644, 'binary_f1_score': 0.9643488}
confusion matrix:
       0      1
0  28412    734
1   1324  27834
---- Validation: 
scalar performance:
{'acc': 0.9639376, 'precision': 0.69424623, 'recall': 0.63846976, 'specificity': 0.63846976, 'f1': 0.6611301, 'auroc': 0.8479754, 'binary_precision': 0.4117647, 'binary_recall': 0.29069766, 'binary_specificity': 0.9862418, 'binary_f1_score': 0.34079844}
confusion matrix:
       0    1
0  17921  250
1    427  175
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96105146, 'precision': 0.73905796, 'recall': 0.7437937, 'specificity': 0.7437937, 'f1': 0.7413995, 'auroc': 0.8754842, 'binary_precision': 0.4979757, 'binary_recall': 0.5082645, 'binary_specificity': 0.97932297, 'binary_f1_score': 0.50306755}
confusion matrix:
      0    1
0  5873  124
1   119  123
new oracle model saved
early stop counter: 3
val acc:0.9639375805854797, best validation acc: 0.9645234942436218, corresponding to test acc:                         0.9565635323524475 / 0.9610514640808105
after epoch: 5,now: 2024-08-02 17:24:26.290296,epoch time: 0:32:41.713649,used: 2:46:41.760997,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_14_37_44_seed_2_23919999
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:46:41.760997 at 2024-08-02 17:24:26.290296
persisted model performance metric: 

scalar performance:
{'acc': 0.95656353, 'precision': 0.56999964, 'recall': 0.51344407, 'specificity': 0.51344407, 'f1': 0.5167598, 'auroc': 0.7018192, 'binary_precision': 0.17777778, 'binary_recall': 0.03305785, 'binary_specificity': 0.99383026, 'binary_f1_score': 0.05574913}
confusion matrix:
      0   1
0  5960  37
1   234   8
oracle model performance metric: 

scalar performance:
{'acc': 0.96105146, 'precision': 0.73905796, 'recall': 0.7437937, 'specificity': 0.7437937, 'f1': 0.7413995, 'auroc': 0.8754842, 'binary_precision': 0.4979757, 'binary_recall': 0.5082645, 'binary_specificity': 0.97932297, 'binary_f1_score': 0.50306755}
confusion matrix:
      0    1
0  5873  124
1   119  123
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/18.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/18.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196706 KiB |   2142 MiB |    779 TiB |    779 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    770 TiB |    770 TiB |
|       from small pool |  17495 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196706 KiB |   2142 MiB |    779 TiB |    779 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    770 TiB |    770 TiB |
|       from small pool |  17495 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB |    779 TiB |    779 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    770 TiB |    770 TiB |
|       from small pool |  16482 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2354 MiB |   2372 MiB |   6598 MiB |   4244 MiB |
|       from large pool |   2316 MiB |   2330 MiB |   6530 MiB |   4214 MiB |
|       from small pool |     38 MiB |     42 MiB |     68 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40862 KiB | 232750 KiB | 437849 GiB | 437849 GiB |
|       from large pool |  31733 KiB | 230336 KiB | 428127 GiB | 428127 GiB |
|       from small pool |   9129 KiB |  23492 KiB |   9721 GiB |   9721 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2986    |    7783    |  120443 K  |  120440 K  |
|       from large pool |      79    |     252    |   72616 K  |   72616 K  |
|       from small pool |    2907    |    7703    |   47827 K  |   47824 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2986    |    7783    |  120443 K  |  120440 K  |
|       from large pool |      79    |     252    |   72616 K  |   72616 K  |
|       from small pool |    2907    |    7703    |   47827 K  |   47824 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     115    |     118    |     302    |     187    |
|       from large pool |      96    |      97    |     268    |     172    |
|       from small pool |      19    |      21    |      34    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      42    |    3660    |   76793 K  |   76793 K  |
|       from large pool |      11    |     100    |   55202 K  |   55202 K  |
|       from small pool |      31    |    3649    |   21590 K  |   21590 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    779 TiB |    779 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    770 TiB |    770 TiB |
|       from small pool |      0 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    779 TiB |    779 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    770 TiB |    770 TiB |
|       from small pool |      0 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    779 TiB |    779 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    770 TiB |    770 TiB |
|       from small pool |      0 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   6598 MiB |   6366 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6530 MiB |   6324 MiB |
|       from small pool |  26624 KiB |     42 MiB |     68 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 232750 KiB | 437849 GiB | 437849 GiB |
|       from large pool |  30464 KiB | 230336 KiB | 428127 GiB | 428127 GiB |
|       from small pool |      0 KiB |  23492 KiB |   9722 GiB |   9722 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7783    |  120443 K  |  120443 K  |
|       from large pool |       2    |     252    |   72616 K  |   72616 K  |
|       from small pool |       0    |    7703    |   47827 K  |   47827 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7783    |  120443 K  |  120443 K  |
|       from large pool |       2    |     252    |   72616 K  |   72616 K  |
|       from small pool |       0    |    7703    |   47827 K  |   47827 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     302    |     279    |
|       from large pool |      10    |      97    |     268    |     258    |
|       from small pool |      13    |      21    |      34    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3660    |   76794 K  |   76794 K  |
|       from large pool |       3    |     100    |   55202 K  |   55202 K  |
|       from small pool |       0    |    3649    |   21591 K  |   21591 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 17:25:55 2024]
Finished job 0.
1 of 1 steps (100%) done
