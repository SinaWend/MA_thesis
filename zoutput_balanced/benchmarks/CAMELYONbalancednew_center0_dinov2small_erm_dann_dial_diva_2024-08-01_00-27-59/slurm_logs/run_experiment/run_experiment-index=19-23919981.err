Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 08:34:42 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/19.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=19
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_08_45_13_seed_0_23919981

 Experiment start at: 2024-08-01 08:45:13.588504
before training, model accuracy: 0.22451263666152954
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9362622, 'precision': 0.9400591, 'recall': 0.93629956, 'specificity': 0.93629956, 'f1': 0.93612814, 'auroc': 0.97581553, 'binary_precision': 0.98113644, 'binary_recall': 0.8897328, 'binary_specificity': 0.9828663, 'binary_f1_score': 0.9332018}
confusion matrix:
       0      1
0  28166    491
1   3165  25538
---- Validation: 
scalar performance:
{'acc': 0.95391655, 'precision': 0.52910197, 'recall': 0.5126078, 'specificity': 0.5126078, 'f1': 0.5154839, 'auroc': 0.70231366, 'binary_precision': 0.09157509, 'binary_recall': 0.038880248, 'binary_specificity': 0.98633534, 'binary_f1_score': 0.05458515}
confusion matrix:
       0    1
0  17901  248
1    618   25
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94087565, 'precision': 0.52789664, 'recall': 0.5147325, 'specificity': 0.5147325, 'f1': 0.5175643, 'auroc': 0.75094634, 'binary_precision': 0.096296296, 'binary_recall': 0.049808428, 'binary_specificity': 0.9796565, 'binary_f1_score': 0.065656565}
confusion matrix:
      0    1
0  5875  122
1   248   13
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 09:21:06.999969,epoch time: 0:35:53.411465,used: 0:35:53.411465,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_08_45_13_seed_0_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95507324, 'precision': 0.95637375, 'recall': 0.9550938, 'specificity': 0.9550938, 'f1': 0.9550426, 'auroc': 0.9862913, 'binary_precision': 0.98092854, 'binary_recall': 0.9282628, 'binary_specificity': 0.9819248, 'binary_f1_score': 0.9538693}
confusion matrix:
       0      1
0  28140    518
1   2059  26643
---- Validation: 
scalar performance:
{'acc': 0.94902086, 'precision': 0.6151403, 'recall': 0.615831, 'specificity': 0.615831, 'f1': 0.6154844, 'auroc': 0.7965512, 'binary_precision': 0.2565688, 'binary_recall': 0.25816485, 'binary_specificity': 0.97349715, 'binary_f1_score': 0.25736433}
confusion matrix:
       0    1
0  17668  481
1    477  166
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94566953, 'precision': 0.6588208, 'recall': 0.6564911, 'specificity': 0.6564911, 'f1': 0.65764564, 'auroc': 0.8400222, 'binary_precision': 0.3463035, 'binary_recall': 0.34099618, 'binary_specificity': 0.971986, 'binary_f1_score': 0.34362933}
confusion matrix:
      0    1
0  5829  168
1   172   89
new oracle model saved
early stop counter: 1
val acc:0.9490208625793457, best validation acc: 0.9539165496826172, corresponding to test acc:                         0.9408756494522095 / 0.9456695318222046
after epoch: 2,now: 2024-08-01 09:56:16.579738,epoch time: 0:35:09.579769,used: 1:11:02.991234,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_08_45_13_seed_0_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96424335, 'precision': 0.9649352, 'recall': 0.96425897, 'specificity': 0.96425897, 'f1': 0.9642309, 'auroc': 0.9904896, 'binary_precision': 0.98307115, 'binary_recall': 0.94481415, 'binary_specificity': 0.9837038, 'binary_f1_score': 0.9635631}
confusion matrix:
       0      1
0  28190    467
1   1584  27119
---- Validation: 
scalar performance:
{'acc': 0.94226265, 'precision': 0.6180108, 'recall': 0.6655861, 'specificity': 0.6655861, 'f1': 0.6369616, 'auroc': 0.82989085, 'binary_precision': 0.25873363, 'binary_recall': 0.36858475, 'binary_specificity': 0.9625875, 'binary_f1_score': 0.30404106}
confusion matrix:
       0    1
0  17470  679
1    406  237
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9447108, 'precision': 0.6838567, 'recall': 0.76043385, 'specificity': 0.76043385, 'f1': 0.71427536, 'auroc': 0.87515855, 'binary_precision': 0.38726792, 'binary_recall': 0.55938697, 'binary_specificity': 0.96148074, 'binary_f1_score': 0.45768023}
confusion matrix:
      0    1
0  5766  231
1   115  146
early stop counter: 2
val acc:0.9422626495361328, best validation acc: 0.9539165496826172, corresponding to test acc:                         0.9408756494522095 / 0.9456695318222046
after epoch: 3,now: 2024-08-01 10:31:45.786141,epoch time: 0:35:29.206403,used: 1:46:32.197637,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_08_45_13_seed_0_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9680439, 'precision': 0.96856797, 'recall': 0.9680563, 'specificity': 0.9680563, 'f1': 0.9680356, 'auroc': 0.9922025, 'binary_precision': 0.9844223, 'binary_recall': 0.95118636, 'binary_specificity': 0.9849262, 'binary_f1_score': 0.967519}
confusion matrix:
       0      1
0  28227    432
1   1401  27300
---- Validation: 
scalar performance:
{'acc': 0.93928266, 'precision': 0.61825156, 'recall': 0.6850449, 'specificity': 0.6850449, 'f1': 0.6427021, 'auroc': 0.8481108, 'binary_precision': 0.2577821, 'binary_recall': 0.41213062, 'binary_specificity': 0.9579591, 'binary_f1_score': 0.31717536}
confusion matrix:
       0    1
0  17386  763
1    378  265
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94215405, 'precision': 0.6810031, 'recall': 0.78292024, 'specificity': 0.78292024, 'f1': 0.7185312, 'auroc': 0.8836062, 'binary_precision': 0.37947494, 'binary_recall': 0.6091954, 'binary_specificity': 0.956645, 'binary_f1_score': 0.46764708}
confusion matrix:
      0    1
0  5737  260
1   102  159
early stop counter: 3
val acc:0.9392826557159424, best validation acc: 0.9539165496826172, corresponding to test acc:                         0.9408756494522095 / 0.9456695318222046
after epoch: 4,now: 2024-08-01 11:07:29.728223,epoch time: 0:35:43.942082,used: 2:22:16.139719,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_08_45_13_seed_0_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:22:16.139719 at 2024-08-01 11:07:29.728223
persisted model performance metric: 

scalar performance:
{'acc': 0.94087565, 'precision': 0.52789664, 'recall': 0.5147325, 'specificity': 0.5147325, 'f1': 0.5175643, 'auroc': 0.75094634, 'binary_precision': 0.096296296, 'binary_recall': 0.049808428, 'binary_specificity': 0.9796565, 'binary_f1_score': 0.065656565}
confusion matrix:
      0    1
0  5875  122
1   248   13
oracle model performance metric: 

scalar performance:
{'acc': 0.94566953, 'precision': 0.6588208, 'recall': 0.6564911, 'specificity': 0.6564911, 'f1': 0.65764564, 'auroc': 0.8400222, 'binary_precision': 0.3463035, 'binary_recall': 0.34099618, 'binary_specificity': 0.971986, 'binary_f1_score': 0.34362933}
confusion matrix:
      0    1
0  5829  168
1   172   89
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/19.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/19.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/19.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198163 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |  17501 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198163 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |  17501 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB | 212210 GiB | 212210 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 209643 GiB | 209642 GiB |
|       from small pool |  16482 KiB |     36 MiB |   2567 GiB |   2567 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55789 KiB | 225565 KiB | 114197 GiB | 114197 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 111602 GiB | 111602 GiB |
|       from small pool |   5027 KiB |   9264 KiB |   2595 GiB |   2595 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2998    |    7665    |   32065 K  |   32062 K  |
|       from large pool |      79    |     252    |   19300 K  |   19300 K  |
|       from small pool |    2919    |    7585    |   12764 K  |   12762 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2998    |    7665    |   32065 K  |   32062 K  |
|       from large pool |      79    |     252    |   19300 K  |   19300 K  |
|       from small pool |    2919    |    7585    |   12764 K  |   12762 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      37    |    3601    |   20815 K  |   20815 K  |
|       from large pool |      10    |      97    |   14983 K  |   14983 K  |
|       from small pool |      27    |    3591    |    5831 K  |    5831 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 212210 GiB | 212210 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 209643 GiB | 209643 GiB |
|       from small pool |      0 KiB |     36 MiB |   2567 GiB |   2567 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   2372 MiB |   2372 MiB |   2124 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 114197 GiB | 114197 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 111602 GiB | 111602 GiB |
|       from small pool |      0 KiB |  18592 KiB |   2595 GiB |   2595 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12764 K  |   12764 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12764 K  |   12764 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     118    |     118    |      96    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3601    |   20817 K  |   20817 K  |
|       from large pool |       3    |      97    |   14983 K  |   14983 K  |
|       from small pool |       0    |    3591    |    5833 K  |    5833 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 212210 GiB | 212210 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 209643 GiB | 209643 GiB |
|       from small pool |      0 KiB |     36 MiB |   2567 GiB |   2567 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   2372 MiB |   2372 MiB |   2124 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 114197 GiB | 114197 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 111602 GiB | 111602 GiB |
|       from small pool |      0 KiB |  18592 KiB |   2595 GiB |   2595 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12764 K  |   12764 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12764 K  |   12764 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     118    |     118    |      96    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3601    |   20817 K  |   20817 K  |
|       from large pool |       3    |      97    |   14983 K  |   14983 K  |
|       from small pool |       0    |    3591    |    5833 K  |    5833 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_11_16_18_seed_1_23919981

 Experiment start at: 2024-08-01 11:16:18.877405
before training, model accuracy: 0.6890106797218323
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.93699664, 'precision': 0.94056016, 'recall': 0.9370295, 'specificity': 0.9370295, 'f1': 0.93687224, 'auroc': 0.98110056, 'binary_precision': 0.9803652, 'binary_recall': 0.89194906, 'binary_specificity': 0.98210996, 'binary_f1_score': 0.9340695}
confusion matrix:
       0      1
0  28272    515
1   3115  25714
---- Validation: 
scalar performance:
{'acc': 0.9384739, 'precision': 0.6183596, 'recall': 0.6726856, 'specificity': 0.6726856, 'f1': 0.6393092, 'auroc': 0.8513347, 'binary_precision': 0.26, 'binary_recall': 0.38632986, 'binary_specificity': 0.95904136, 'binary_f1_score': 0.31081888}
confusion matrix:
       0    1
0  17327  740
1    413  260
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94634223, 'precision': 0.6898837, 'recall': 0.7605145, 'specificity': 0.7605145, 'f1': 0.71862143, 'auroc': 0.8994916, 'binary_precision': 0.39944905, 'binary_recall': 0.5576923, 'binary_specificity': 0.9633367, 'binary_f1_score': 0.4654896}
confusion matrix:
      0    1
0  5728  218
1   115  145
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 11:52:58.597578,epoch time: 0:36:39.720173,used: 0:36:39.720173,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_11_16_18_seed_1_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9511594, 'precision': 0.95272505, 'recall': 0.95118195, 'specificity': 0.95118195, 'f1': 0.9511188, 'auroc': 0.9888621, 'binary_precision': 0.97953993, 'binary_recall': 0.9216441, 'binary_specificity': 0.9807198, 'binary_f1_score': 0.9497105}
confusion matrix:
       0      1
0  28231    555
1   2259  26571
---- Validation: 
scalar performance:
{'acc': 0.9495731, 'precision': 0.66867703, 'recall': 0.7335175, 'specificity': 0.7335175, 'f1': 0.69497734, 'auroc': 0.8859194, 'binary_precision': 0.3562368, 'binary_recall': 0.5007429, 'binary_specificity': 0.96629214, 'binary_f1_score': 0.41630635}
confusion matrix:
       0    1
0  17458  609
1    336  337
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9582662, 'precision': 0.7433813, 'recall': 0.82006776, 'specificity': 0.82006776, 'f1': 0.7756858, 'auroc': 0.9203893, 'binary_precision': 0.50144094, 'binary_recall': 0.66923076, 'binary_specificity': 0.9709048, 'binary_f1_score': 0.5733114}
confusion matrix:
      0    1
0  5773  173
1    86  174
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-01 12:27:39.734326,epoch time: 0:34:41.136748,used: 1:11:20.856921,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_11_16_18_seed_1_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96098304, 'precision': 0.96156657, 'recall': 0.96099615, 'specificity': 0.96099615, 'f1': 0.9609715, 'auroc': 0.9917809, 'binary_precision': 0.9781615, 'binary_recall': 0.94307816, 'binary_specificity': 0.9789141, 'binary_f1_score': 0.96029955}
confusion matrix:
       0      1
0  28180    607
1   1641  27188
---- Validation: 
scalar performance:
{'acc': 0.9487193, 'precision': 0.67074925, 'recall': 0.75381744, 'specificity': 0.75381744, 'f1': 0.7027576, 'auroc': 0.8915955, 'binary_precision': 0.35882354, 'binary_recall': 0.54383355, 'binary_specificity': 0.9638014, 'binary_f1_score': 0.43236855}
confusion matrix:
       0    1
0  17413  654
1    307  366
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9531099, 'precision': 0.72421336, 'recall': 0.8376057, 'specificity': 0.8376057, 'f1': 0.767497, 'auroc': 0.92587805, 'binary_precision': 0.46134663, 'binary_recall': 0.71153843, 'binary_specificity': 0.96367306, 'binary_f1_score': 0.5597579}
confusion matrix:
      0    1
0  5730  216
1    75  185
early stop counter: 1
val acc:0.948719322681427, best validation acc: 0.9495730996131897, corresponding to test acc:                         0.9582661986351013 / 0.9582661986351013
after epoch: 3,now: 2024-08-01 13:02:22.132170,epoch time: 0:34:42.397844,used: 1:46:03.254765,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_11_16_18_seed_1_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.966485, 'precision': 0.96701086, 'recall': 0.9664979, 'specificity': 0.9664979, 'f1': 0.96647626, 'auroc': 0.99363434, 'binary_precision': 0.9828744, 'binary_recall': 0.9495664, 'binary_specificity': 0.98342943, 'binary_f1_score': 0.96593344}
confusion matrix:
       0      1
0  28309    477
1   1454  27376
---- Validation: 
scalar performance:
{'acc': 0.9464781, 'precision': 0.66617763, 'recall': 0.76338416, 'specificity': 0.76338416, 'f1': 0.7018223, 'auroc': 0.8916894, 'binary_precision': 0.3489011, 'binary_recall': 0.5661218, 'binary_specificity': 0.9606465, 'binary_f1_score': 0.43172804}
confusion matrix:
       0    1
0  17356  711
1    292  381
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9473091, 'precision': 0.70594287, 'recall': 0.8400955, 'specificity': 0.8400955, 'f1': 0.7534617, 'auroc': 0.9267639, 'binary_precision': 0.42437923, 'binary_recall': 0.72307694, 'binary_specificity': 0.95711404, 'binary_f1_score': 0.53485066}
confusion matrix:
      0    1
0  5691  255
1    72  188
early stop counter: 2
val acc:0.9464781284332275, best validation acc: 0.9495730996131897, corresponding to test acc:                         0.9582661986351013 / 0.9582661986351013
after epoch: 4,now: 2024-08-01 13:36:53.099549,epoch time: 0:34:30.967379,used: 2:20:34.222144,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_11_16_18_seed_1_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9673181, 'precision': 0.96732426, 'recall': 0.96731955, 'specificity': 0.96731955, 'f1': 0.96731806, 'auroc': 0.99445415, 'binary_precision': 0.9692136, 'binary_recall': 0.9653474, 'binary_specificity': 0.9692917, 'binary_f1_score': 0.96727663}
confusion matrix:
       0      1
0  27903    884
1    999  27830
---- Validation: 
scalar performance:
{'acc': 0.94050163, 'precision': 0.658321, 'recall': 0.7960479, 'specificity': 0.7960479, 'f1': 0.70230424, 'auroc': 0.89355433, 'binary_precision': 0.33052146, 'binary_recall': 0.640416, 'binary_specificity': 0.9516799, 'binary_f1_score': 0.43601418}
confusion matrix:
       0    1
0  17194  873
1    242  431
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9353851, 'precision': 0.6795472, 'recall': 0.85594064, 'specificity': 0.85594064, 'f1': 0.73241985, 'auroc': 0.92389035, 'binary_precision': 0.36968577, 'binary_recall': 0.7692308, 'binary_specificity': 0.9426505, 'binary_f1_score': 0.49937582}
confusion matrix:
      0    1
0  5605  341
1    60  200
early stop counter: 3
val acc:0.9405016303062439, best validation acc: 0.9495730996131897, corresponding to test acc:                         0.9582661986351013 / 0.9582661986351013
after epoch: 5,now: 2024-08-01 14:12:00.149089,epoch time: 0:35:07.049540,used: 2:55:41.271684,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_11_16_18_seed_1_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:55:41.271684 at 2024-08-01 14:12:00.149089
persisted model performance metric: 

scalar performance:
{'acc': 0.9582662, 'precision': 0.7433813, 'recall': 0.82006776, 'specificity': 0.82006776, 'f1': 0.7756858, 'auroc': 0.9203893, 'binary_precision': 0.50144094, 'binary_recall': 0.66923076, 'binary_specificity': 0.9709048, 'binary_f1_score': 0.5733114}
confusion matrix:
      0    1
0  5773  173
1    86  174
oracle model performance metric: 

scalar performance:
{'acc': 0.9582662, 'precision': 0.7433813, 'recall': 0.82006776, 'specificity': 0.82006776, 'f1': 0.7756858, 'auroc': 0.9203893, 'binary_precision': 0.50144094, 'binary_recall': 0.66923076, 'binary_specificity': 0.9709048, 'binary_f1_score': 0.5733114}
confusion matrix:
      0    1
0  5773  173
1    86  174
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/19.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/19.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196700 KiB |   2142 MiB | 477805 GiB | 477805 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 472024 GiB | 472024 GiB |
|       from small pool |  17489 KiB |     37 MiB |   5780 GiB |   5780 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196700 KiB |   2142 MiB | 477805 GiB | 477805 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 472024 GiB | 472024 GiB |
|       from small pool |  17489 KiB |     37 MiB |   5780 GiB |   5780 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   2141 MiB | 477747 GiB | 477747 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 471975 GiB | 471975 GiB |
|       from small pool |  16480 KiB |     36 MiB |   5771 GiB |   5771 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2356 MiB |   2372 MiB |   4480 MiB |   2124 MiB |
|       from large pool |   2318 MiB |   2330 MiB |   4422 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     58 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40868 KiB | 234798 KiB | 258315 GiB | 258315 GiB |
|       from large pool |  31733 KiB | 232384 KiB | 252488 GiB | 252488 GiB |
|       from small pool |   9135 KiB |  18592 KiB |   5827 GiB |   5827 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2974    |    7697    |   72111 K  |   72108 K  |
|       from large pool |      79    |     252    |   43445 K  |   43445 K  |
|       from small pool |    2895    |    7617    |   28666 K  |   28663 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2974    |    7697    |   72111 K  |   72108 K  |
|       from large pool |      79    |     252    |   43445 K  |   43445 K  |
|       from small pool |    2895    |    7617    |   28666 K  |   28663 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     212    |      96    |
|       from large pool |      97    |      97    |     183    |      86    |
|       from small pool |      19    |      21    |      29    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      42    |    3619    |   46220 K  |   46220 K  |
|       from large pool |      11    |     101    |   33248 K  |   33248 K  |
|       from small pool |      31    |    3608    |   12971 K  |   12971 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 477805 GiB | 477805 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 472024 GiB | 472024 GiB |
|       from small pool |      0 KiB |     37 MiB |   5780 GiB |   5780 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 477805 GiB | 477805 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 472024 GiB | 472024 GiB |
|       from small pool |      0 KiB |     37 MiB |   5780 GiB |   5780 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 477747 GiB | 477747 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 471975 GiB | 471975 GiB |
|       from small pool |      0 KiB |     36 MiB |   5771 GiB |   5771 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   4480 MiB |   4248 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4422 MiB |   4216 MiB |
|       from small pool |  26624 KiB |     42 MiB |     58 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 258316 GiB | 258316 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 252488 GiB | 252488 GiB |
|       from small pool |      0 KiB |  23492 KiB |   5827 GiB |   5827 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   72111 K  |   72111 K  |
|       from large pool |       2    |     252    |   43445 K  |   43445 K  |
|       from small pool |       0    |    7617    |   28666 K  |   28666 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   72111 K  |   72111 K  |
|       from large pool |       2    |     252    |   43445 K  |   43445 K  |
|       from small pool |       0    |    7617    |   28666 K  |   28666 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     212    |     189    |
|       from large pool |      10    |      97    |     183    |     173    |
|       from small pool |      13    |      21    |      29    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   46221 K  |   46221 K  |
|       from large pool |       3    |     101    |   33248 K  |   33248 K  |
|       from small pool |       0    |    3608    |   12972 K  |   12972 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 477805 GiB | 477805 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 472024 GiB | 472024 GiB |
|       from small pool |      0 KiB |     37 MiB |   5780 GiB |   5780 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 477805 GiB | 477805 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 472024 GiB | 472024 GiB |
|       from small pool |      0 KiB |     37 MiB |   5780 GiB |   5780 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 477747 GiB | 477747 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 471975 GiB | 471975 GiB |
|       from small pool |      0 KiB |     36 MiB |   5771 GiB |   5771 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   4480 MiB |   4248 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4422 MiB |   4216 MiB |
|       from small pool |  26624 KiB |     42 MiB |     58 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 258316 GiB | 258316 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 252488 GiB | 252488 GiB |
|       from small pool |      0 KiB |  23492 KiB |   5827 GiB |   5827 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   72111 K  |   72111 K  |
|       from large pool |       2    |     252    |   43445 K  |   43445 K  |
|       from small pool |       0    |    7617    |   28666 K  |   28666 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   72111 K  |   72111 K  |
|       from large pool |       2    |     252    |   43445 K  |   43445 K  |
|       from small pool |       0    |    7617    |   28666 K  |   28666 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     212    |     189    |
|       from large pool |      10    |      97    |     183    |     173    |
|       from small pool |      13    |      21    |      29    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   46221 K  |   46221 K  |
|       from large pool |       3    |     101    |   33248 K  |   33248 K  |
|       from small pool |       0    |    3608    |   12972 K  |   12972 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_14_20_31_seed_2_23919981

 Experiment start at: 2024-08-01 14:20:32.169101
before training, model accuracy: 0.10803013294935226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9153403, 'precision': 0.92409265, 'recall': 0.9153526, 'specificity': 0.9153526, 'f1': 0.91490287, 'auroc': 0.9572433, 'binary_precision': 0.9850603, 'binary_recall': 0.8435024, 'binary_specificity': 0.9872028, 'binary_f1_score': 0.908802}
confusion matrix:
       0      1
0  28774    373
1   4563  24594
---- Validation: 
scalar performance:
{'acc': 0.9637778, 'precision': 0.54302365, 'recall': 0.5074903, 'specificity': 0.5074903, 'f1': 0.50781685, 'auroc': 0.57910657, 'binary_precision': 0.11764706, 'binary_recall': 0.019933555, 'binary_specificity': 0.99504703, 'binary_f1_score': 0.03409091}
confusion matrix:
       0   1
0  18081  90
1    590  12
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9544799, 'precision': 0.51194775, 'recall': 0.5024465, 'specificity': 0.5024465, 'f1': 0.49869403, 'auroc': 0.57601357, 'binary_precision': 0.0625, 'binary_recall': 0.012396694, 'binary_specificity': 0.99249625, 'binary_f1_score': 0.020689655}
confusion matrix:
      0   1
0  5952  45
1   239   3
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 14:57:00.337715,epoch time: 0:36:28.168614,used: 0:36:28.168614,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_14_20_31_seed_2_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9421995, 'precision': 0.94570196, 'recall': 0.9422056, 'specificity': 0.9422056, 'f1': 0.94208634, 'auroc': 0.97668254, 'binary_precision': 0.98524654, 'binary_recall': 0.8978598, 'binary_specificity': 0.9865514, 'binary_f1_score': 0.93952554}
confusion matrix:
       0      1
0  28756    392
1   2978  26178
---- Validation: 
scalar performance:
{'acc': 0.96484315, 'precision': 0.65757054, 'recall': 0.54979914, 'specificity': 0.54979914, 'f1': 0.5722406, 'auroc': 0.6994622, 'binary_precision': 0.34408602, 'binary_recall': 0.10631229, 'binary_specificity': 0.993286, 'binary_f1_score': 0.16243654}
confusion matrix:
       0    1
0  18049  122
1    538   64
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9586472, 'precision': 0.6314486, 'recall': 0.5224589, 'specificity': 0.5224589, 'f1': 0.5319759, 'auroc': 0.69265866, 'binary_precision': 0.3, 'binary_recall': 0.049586777, 'binary_specificity': 0.995331, 'binary_f1_score': 0.08510638}
confusion matrix:
      0   1
0  5969  28
1   230  12
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-01 15:32:45.330265,epoch time: 0:35:44.992550,used: 1:12:13.161164,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_14_20_31_seed_2_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9554061, 'precision': 0.95637226, 'recall': 0.95541084, 'specificity': 0.95541084, 'f1': 0.9553828, 'auroc': 0.98407286, 'binary_precision': 0.97742146, 'binary_recall': 0.93236846, 'binary_specificity': 0.9784533, 'binary_f1_score': 0.9543635}
confusion matrix:
       0      1
0  28518    628
1   1972  27186
---- Validation: 
scalar performance:
{'acc': 0.9629255, 'precision': 0.6637944, 'recall': 0.58896095, 'specificity': 0.58896095, 'f1': 0.61387414, 'auroc': 0.76988006, 'binary_precision': 0.35403726, 'binary_recall': 0.18936877, 'binary_specificity': 0.98855317, 'binary_f1_score': 0.24675326}
confusion matrix:
       0    1
0  17963  208
1    488  114
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9570444, 'precision': 0.6844492, 'recall': 0.60093474, 'specificity': 0.60093474, 'f1': 0.62871605, 'auroc': 0.81004345, 'binary_precision': 0.4, 'binary_recall': 0.21487603, 'binary_specificity': 0.9869935, 'binary_f1_score': 0.2795699}
confusion matrix:
      0   1
0  5919  78
1   190  52
early stop counter: 1
val acc:0.9629254937171936, best validation acc: 0.9648431539535522, corresponding to test acc:                         0.9586471915245056 / 0.9586471915245056
after epoch: 3,now: 2024-08-01 16:07:53.443808,epoch time: 0:35:08.113543,used: 1:47:21.274707,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_14_20_31_seed_2_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9617522, 'precision': 0.96274865, 'recall': 0.9617578, 'specificity': 0.9617578, 'f1': 0.9617319, 'auroc': 0.98829675, 'binary_precision': 0.98428226, 'binary_recall': 0.9385095, 'binary_specificity': 0.985006, 'binary_f1_score': 0.9608511}
confusion matrix:
       0      1
0  28708    437
1   1793  27366
---- Validation: 
scalar performance:
{'acc': 0.964417, 'precision': 0.69317913, 'recall': 0.62024724, 'specificity': 0.62024724, 'f1': 0.6472464, 'auroc': 0.8180914, 'binary_precision': 0.4108108, 'binary_recall': 0.25249168, 'binary_specificity': 0.98800284, 'binary_f1_score': 0.3127572}
confusion matrix:
       0    1
0  17953  218
1    450  152
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9589678, 'precision': 0.7201635, 'recall': 0.68322766, 'specificity': 0.68322766, 'f1': 0.6997725, 'auroc': 0.8531518, 'binary_precision': 0.465, 'binary_recall': 0.38429752, 'binary_specificity': 0.98215777, 'binary_f1_score': 0.42081448}
confusion matrix:
      0    1
0  5890  107
1   149   93
new oracle model saved
early stop counter: 2
val acc:0.9644169807434082, best validation acc: 0.9648431539535522, corresponding to test acc:                         0.9586471915245056 / 0.9589678049087524
after epoch: 4,now: 2024-08-01 16:42:12.683923,epoch time: 0:34:19.240115,used: 2:21:40.514822,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_14_20_31_seed_2_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9657313, 'precision': 0.9662515, 'recall': 0.96573424, 'specificity': 0.96573424, 'f1': 0.96572196, 'auroc': 0.9903803, 'binary_precision': 0.9818672, 'binary_recall': 0.94900024, 'binary_specificity': 0.9824682, 'binary_f1_score': 0.965154}
confusion matrix:
       0      1
0  28636    511
1   1487  27670
---- Validation: 
scalar performance:
{'acc': 0.9646833, 'precision': 0.7024766, 'recall': 0.64367324, 'specificity': 0.64367324, 'f1': 0.66750836, 'auroc': 0.8408048, 'binary_precision': 0.427896, 'binary_recall': 0.30066445, 'binary_specificity': 0.98668206, 'binary_f1_score': 0.35317072}
confusion matrix:
       0    1
0  17929  242
1    421  181
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9559224, 'precision': 0.7035271, 'recall': 0.69948816, 'specificity': 0.69948816, 'f1': 0.7014844, 'auroc': 0.86421657, 'binary_precision': 0.43037975, 'binary_recall': 0.4214876, 'binary_specificity': 0.97748876, 'binary_f1_score': 0.4258873}
confusion matrix:
      0    1
0  5862  135
1   140  102
early stop counter: 3
val acc:0.9646832942962646, best validation acc: 0.9648431539535522, corresponding to test acc:                         0.9586471915245056 / 0.9589678049087524
after epoch: 5,now: 2024-08-01 17:17:21.618938,epoch time: 0:35:08.935015,used: 2:56:49.449837,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_14_20_31_seed_2_23919981
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:56:49.449837 at 2024-08-01 17:17:21.618938
persisted model performance metric: 

scalar performance:
{'acc': 0.9586472, 'precision': 0.6314486, 'recall': 0.5224589, 'specificity': 0.5224589, 'f1': 0.5319759, 'auroc': 0.69265866, 'binary_precision': 0.3, 'binary_recall': 0.049586777, 'binary_specificity': 0.995331, 'binary_f1_score': 0.08510638}
confusion matrix:
      0   1
0  5969  28
1   230  12
oracle model performance metric: 

scalar performance:
{'acc': 0.9589678, 'precision': 0.7201635, 'recall': 0.68322766, 'specificity': 0.68322766, 'f1': 0.6997725, 'auroc': 0.8531518, 'binary_precision': 0.465, 'binary_recall': 0.38429752, 'binary_specificity': 0.98215777, 'binary_f1_score': 0.42081448}
confusion matrix:
      0    1
0  5890  107
1   149   93
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/19.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/19.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196706 KiB |   2142 MiB | 746356 GiB | 746356 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 737333 GiB | 737332 GiB |
|       from small pool |  17495 KiB |     37 MiB |   9023 GiB |   9023 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196706 KiB |   2142 MiB | 746356 GiB | 746356 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 737333 GiB | 737332 GiB |
|       from small pool |  17495 KiB |     37 MiB |   9023 GiB |   9023 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB | 746260 GiB | 746260 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 737251 GiB | 737251 GiB |
|       from small pool |  16482 KiB |     36 MiB |   9008 GiB |   9008 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2356 MiB |   2372 MiB |   6604 MiB |   4248 MiB |
|       from large pool |   2318 MiB |   2330 MiB |   6534 MiB |   4216 MiB |
|       from small pool |     38 MiB |     42 MiB |     70 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40862 KiB | 234798 KiB | 404032 GiB | 404032 GiB |
|       from large pool |  31733 KiB | 232384 KiB | 394938 GiB | 394938 GiB |
|       from small pool |   9129 KiB |  23492 KiB |   9093 GiB |   9093 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2986    |    7783    |  112586 K  |  112583 K  |
|       from large pool |      79    |     252    |   67860 K  |   67860 K  |
|       from small pool |    2907    |    7703    |   44726 K  |   44723 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2986    |    7783    |  112586 K  |  112583 K  |
|       from large pool |      79    |     252    |   67860 K  |   67860 K  |
|       from small pool |    2907    |    7703    |   44726 K  |   44723 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     305    |     189    |
|       from large pool |      97    |      97    |     270    |     173    |
|       from small pool |      19    |      21    |      35    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      43    |    3660    |   71973 K  |   71973 K  |
|       from large pool |      11    |     101    |   51718 K  |   51718 K  |
|       from small pool |      32    |    3649    |   20255 K  |   20255 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 746356 GiB | 746356 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 737333 GiB | 737333 GiB |
|       from small pool |      0 KiB |     37 MiB |   9023 GiB |   9023 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 746356 GiB | 746356 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 737333 GiB | 737333 GiB |
|       from small pool |      0 KiB |     37 MiB |   9023 GiB |   9023 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 746260 GiB | 746260 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 737251 GiB | 737251 GiB |
|       from small pool |      0 KiB |     36 MiB |   9008 GiB |   9008 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   6604 MiB |   6372 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6534 MiB |   6328 MiB |
|       from small pool |  26624 KiB |     42 MiB |     70 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 404032 GiB | 404032 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 394938 GiB | 394938 GiB |
|       from small pool |      0 KiB |  23492 KiB |   9093 GiB |   9093 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7783    |  112586 K  |  112586 K  |
|       from large pool |       2    |     252    |   67860 K  |   67860 K  |
|       from small pool |       0    |    7703    |   44726 K  |   44726 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7783    |  112586 K  |  112586 K  |
|       from large pool |       2    |     252    |   67860 K  |   67860 K  |
|       from small pool |       0    |    7703    |   44726 K  |   44726 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     305    |     282    |
|       from large pool |      10    |      97    |     270    |     260    |
|       from small pool |      13    |      21    |      35    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3660    |   71974 K  |   71974 K  |
|       from large pool |       3    |     101    |   51718 K  |   51718 K  |
|       from small pool |       0    |    3649    |   20256 K  |   20256 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  1 17:18:52 2024]
Finished job 0.
1 of 1 steps (100%) done
