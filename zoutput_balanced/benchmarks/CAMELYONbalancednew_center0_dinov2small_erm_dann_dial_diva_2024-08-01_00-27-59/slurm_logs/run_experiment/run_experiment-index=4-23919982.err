Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 08:56:57 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/4.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=4
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_09_03_06_seed_0_23919982

 Experiment start at: 2024-08-01 09:03:07.025736
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
before training, model accuracy: 0.7286673188209534
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9466353, 'precision': 0.9486933, 'recall': 0.94666374, 'specificity': 0.94666374, 'f1': 0.9465764, 'auroc': 0.9879044, 'binary_precision': 0.9792905, 'binary_recall': 0.91266024, 'binary_specificity': 0.98066723, 'binary_f1_score': 0.9448021}
confusion matrix:
       0      1
0  28102    554
1   2507  26197
---- Validation: 
scalar performance:
{'acc': 0.9214559, 'precision': 0.61520845, 'recall': 0.7763231, 'specificity': 0.7763231, 'f1': 0.65456116, 'auroc': 0.8699926, 'binary_precision': 0.2446352, 'binary_recall': 0.62052876, 'binary_specificity': 0.93211746, 'binary_f1_score': 0.3509235}
confusion matrix:
       0     1
0  16917  1232
1    244   399
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94662833, 'precision': 0.70280504, 'recall': 0.83656, 'specificity': 0.83656, 'f1': 0.74998134, 'auroc': 0.9081156, 'binary_precision': 0.41834453, 'binary_recall': 0.71647507, 'binary_specificity': 0.956645, 'binary_f1_score': 0.5282486}
confusion matrix:
      0    1
0  5737  260
1    74  187
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 09:47:42.089905,epoch time: 0:44:35.064169,used: 0:44:35.064169,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_09_03_06_seed_0_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95883894, 'precision': 0.95975757, 'recall': 0.9588578, 'specificity': 0.9588578, 'f1': 0.95881945, 'auroc': 0.9925925, 'binary_precision': 0.98051876, 'binary_recall': 0.93635035, 'binary_specificity': 0.98136514, 'binary_f1_score': 0.9579256}
confusion matrix:
       0      1
0  28122    534
1   1827  26877
---- Validation: 
scalar performance:
{'acc': 0.9007024, 'precision': 0.59478235, 'recall': 0.77982974, 'specificity': 0.77982974, 'f1': 0.6279529, 'auroc': 0.87275124, 'binary_precision': 0.20301117, 'binary_recall': 0.65007776, 'binary_specificity': 0.9095818, 'binary_f1_score': 0.30940044}
confusion matrix:
       0     1
0  16508  1641
1    225   418
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92138064, 'precision': 0.65565485, 'recall': 0.8600335, 'specificity': 0.8600335, 'f1': 0.70728827, 'auroc': 0.9086996, 'binary_precision': 0.32093024, 'binary_recall': 0.79310346, 'binary_specificity': 0.9269635, 'binary_f1_score': 0.45695364}
confusion matrix:
      0    1
0  5559  438
1    54  207
early stop counter: 1
val acc:0.9007024168968201, best validation acc: 0.9214559197425842, corresponding to test acc:                         0.9466283321380615 / 0.9466283321380615
after epoch: 2,now: 2024-08-01 10:31:44.942566,epoch time: 0:44:02.852661,used: 1:28:37.916830,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_09_03_06_seed_0_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96504533, 'precision': 0.9652957, 'recall': 0.9650539, 'specificity': 0.9650539, 'f1': 0.96504104, 'auroc': 0.9934299, 'binary_precision': 0.97627205, 'binary_recall': 0.95331174, 'binary_specificity': 0.9767961, 'binary_f1_score': 0.9646553}
confusion matrix:
       0      1
0  27994    665
1   1340  27361
---- Validation: 
scalar performance:
{'acc': 0.90538526, 'precision': 0.5965116, 'recall': 0.7702533, 'specificity': 0.7702533, 'f1': 0.63029474, 'auroc': 0.86679363, 'binary_precision': 0.20732336, 'binary_recall': 0.62519443, 'binary_specificity': 0.9153121, 'binary_f1_score': 0.31138653}
confusion matrix:
       0     1
0  16612  1537
1    241   402
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.923458, 'precision': 0.65751296, 'recall': 0.853788, 'specificity': 0.853788, 'f1': 0.708787, 'auroc': 0.9088558, 'binary_precision': 0.3253205, 'binary_recall': 0.7777778, 'binary_specificity': 0.92979825, 'binary_f1_score': 0.4587571}
confusion matrix:
      0    1
0  5576  421
1    58  203
early stop counter: 2
val acc:0.9053852558135986, best validation acc: 0.9214559197425842, corresponding to test acc:                         0.9466283321380615 / 0.9466283321380615
after epoch: 3,now: 2024-08-01 11:15:44.078795,epoch time: 0:43:59.136229,used: 2:12:37.053059,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_09_03_06_seed_0_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9704847, 'precision': 0.970842, 'recall': 0.9704958, 'specificity': 0.9704958, 'f1': 0.9704795, 'auroc': 0.9951418, 'binary_precision': 0.98401546, 'binary_recall': 0.95655507, 'binary_specificity': 0.98443663, 'binary_f1_score': 0.9700909}
confusion matrix:
       0      1
0  28211    446
1   1247  27456
---- Validation: 
scalar performance:
{'acc': 0.90150064, 'precision': 0.5979373, 'recall': 0.7907438, 'specificity': 0.7907438, 'f1': 0.63257384, 'auroc': 0.8787215, 'binary_precision': 0.2084942, 'binary_recall': 0.6718507, 'binary_specificity': 0.9096369, 'binary_f1_score': 0.31823203}
confusion matrix:
       0     1
0  16509  1640
1    211   432
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9151486, 'precision': 0.64418304, 'recall': 0.8457879, 'specificity': 0.8457879, 'f1': 0.6925125, 'auroc': 0.90738285, 'binary_precision': 0.29910713, 'binary_recall': 0.77011496, 'binary_specificity': 0.92146075, 'binary_f1_score': 0.43086815}
confusion matrix:
      0    1
0  5526  471
1    60  201
early stop counter: 3
val acc:0.9015006422996521, best validation acc: 0.9214559197425842, corresponding to test acc:                         0.9466283321380615 / 0.9466283321380615
after epoch: 4,now: 2024-08-01 12:00:27.916104,epoch time: 0:44:43.837309,used: 2:57:20.890368,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_09_03_06_seed_0_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:57:20.890368 at 2024-08-01 12:00:27.916104
persisted model performance metric: 

scalar performance:
{'acc': 0.94662833, 'precision': 0.70280504, 'recall': 0.83656, 'specificity': 0.83656, 'f1': 0.74998134, 'auroc': 0.9081156, 'binary_precision': 0.41834453, 'binary_recall': 0.71647507, 'binary_specificity': 0.956645, 'binary_f1_score': 0.5282486}
confusion matrix:
      0    1
0  5737  260
1    74  187
oracle model performance metric: 

scalar performance:
{'acc': 0.94662833, 'precision': 0.70280504, 'recall': 0.83656, 'specificity': 0.83656, 'f1': 0.74998134, 'auroc': 0.9081156, 'binary_precision': 0.41834453, 'binary_recall': 0.71647507, 'binary_specificity': 0.956645, 'binary_f1_score': 0.5282486}
confusion matrix:
      0    1
0  5737  260
1    74  187
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/4.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/4.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/4.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 761287 KiB |   5709 MiB | 410373 GiB | 410372 GiB |
|       from large pool | 718018 KiB |   5667 MiB | 406785 GiB | 406785 GiB |
|       from small pool |  43269 KiB |     82 MiB |   3587 GiB |   3587 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 761287 KiB |   5709 MiB | 410373 GiB | 410372 GiB |
|       from large pool | 718018 KiB |   5667 MiB | 406785 GiB | 406785 GiB |
|       from small pool |  43269 KiB |     82 MiB |   3587 GiB |   3587 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 759836 KiB |   5708 MiB | 410288 GiB | 410288 GiB |
|       from large pool | 717638 KiB |   5667 MiB | 406706 GiB | 406705 GiB |
|       from small pool |  42198 KiB |     81 MiB |   3582 GiB |   3582 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6576 MiB |   6576 MiB |   6576 MiB |      0 B   |
|       from large pool |   6488 MiB |   6488 MiB |   6488 MiB |      0 B   |
|       from small pool |     88 MiB |     88 MiB |     88 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 137784 KiB | 613857 KiB | 185377 GiB | 185377 GiB |
|       from large pool | 125758 KiB | 611362 KiB | 181746 GiB | 181746 GiB |
|       from small pool |  12026 KiB |  13820 KiB |   3630 GiB |   3630 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3614    |    8281    |   47581 K  |   47577 K  |
|       from large pool |     166    |     448    |   27947 K  |   27947 K  |
|       from small pool |    3448    |    8114    |   19633 K  |   19630 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3614    |    8281    |   47581 K  |   47577 K  |
|       from large pool |     166    |     448    |   27947 K  |   27947 K  |
|       from small pool |    3448    |    8114    |   19633 K  |   19630 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     212    |     212    |     212    |       0    |
|       from large pool |     168    |     168    |     168    |       0    |
|       from small pool |      44    |      44    |      44    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      67    |    3623    |   27705 K  |   27705 K  |
|       from large pool |      29    |     167    |   18740 K  |   18740 K  |
|       from small pool |      38    |    3594    |    8965 K  |    8965 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   5709 MiB | 410373 GiB | 410373 GiB |
|       from large pool |  16640 KiB |   5667 MiB | 406785 GiB | 406785 GiB |
|       from small pool |      0 KiB |     82 MiB |   3587 GiB |   3587 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   5709 MiB | 410373 GiB | 410373 GiB |
|       from large pool |  16640 KiB |   5667 MiB | 406785 GiB | 406785 GiB |
|       from small pool |      0 KiB |     82 MiB |   3587 GiB |   3587 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   5708 MiB | 410288 GiB | 410288 GiB |
|       from large pool |  16640 KiB |   5667 MiB | 406706 GiB | 406706 GiB |
|       from small pool |      0 KiB |     81 MiB |   3582 GiB |   3582 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    878 MiB |   6576 MiB |   6576 MiB |   5698 MiB |
|       from large pool |    824 MiB |   6488 MiB |   6488 MiB |   5664 MiB |
|       from small pool |     54 MiB |     88 MiB |     88 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 613857 KiB | 185377 GiB | 185377 GiB |
|       from large pool |  24320 KiB | 611362 KiB | 181747 GiB | 181747 GiB |
|       from small pool |      0 KiB |  35053 KiB |   3630 GiB |   3630 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8281    |   47581 K  |   47581 K  |
|       from large pool |       2    |     448    |   27947 K  |   27947 K  |
|       from small pool |       0    |    8114    |   19633 K  |   19633 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8281    |   47581 K  |   47581 K  |
|       from large pool |       2    |     448    |   27947 K  |   27947 K  |
|       from small pool |       0    |    8114    |   19633 K  |   19633 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      55    |     212    |     212    |     157    |
|       from large pool |      28    |     168    |     168    |     140    |
|       from small pool |      27    |      44    |      44    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3623    |   27706 K  |   27706 K  |
|       from large pool |       3    |     167    |   18740 K  |   18740 K  |
|       from small pool |       0    |    3594    |    8966 K  |    8966 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   5709 MiB | 410373 GiB | 410373 GiB |
|       from large pool |  16640 KiB |   5667 MiB | 406785 GiB | 406785 GiB |
|       from small pool |      0 KiB |     82 MiB |   3587 GiB |   3587 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   5709 MiB | 410373 GiB | 410373 GiB |
|       from large pool |  16640 KiB |   5667 MiB | 406785 GiB | 406785 GiB |
|       from small pool |      0 KiB |     82 MiB |   3587 GiB |   3587 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   5708 MiB | 410288 GiB | 410288 GiB |
|       from large pool |  16640 KiB |   5667 MiB | 406706 GiB | 406706 GiB |
|       from small pool |      0 KiB |     81 MiB |   3582 GiB |   3582 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    878 MiB |   6576 MiB |   6576 MiB |   5698 MiB |
|       from large pool |    824 MiB |   6488 MiB |   6488 MiB |   5664 MiB |
|       from small pool |     54 MiB |     88 MiB |     88 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 613857 KiB | 185377 GiB | 185377 GiB |
|       from large pool |  24320 KiB | 611362 KiB | 181747 GiB | 181747 GiB |
|       from small pool |      0 KiB |  35053 KiB |   3630 GiB |   3630 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8281    |   47581 K  |   47581 K  |
|       from large pool |       2    |     448    |   27947 K  |   27947 K  |
|       from small pool |       0    |    8114    |   19633 K  |   19633 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8281    |   47581 K  |   47581 K  |
|       from large pool |       2    |     448    |   27947 K  |   27947 K  |
|       from small pool |       0    |    8114    |   19633 K  |   19633 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      55    |     212    |     212    |     157    |
|       from large pool |      28    |     168    |     168    |     140    |
|       from small pool |      27    |      44    |      44    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3623    |   27706 K  |   27706 K  |
|       from large pool |       3    |     167    |   18740 K  |   18740 K  |
|       from small pool |       0    |    3594    |    8966 K  |    8966 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_12_08_19_seed_1_23919982

 Experiment start at: 2024-08-01 12:08:19.957995
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
before training, model accuracy: 0.2818240523338318
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.95150656, 'precision': 0.95281494, 'recall': 0.95152617, 'specificity': 0.95152617, 'f1': 0.9514729, 'auroc': 0.98733926, 'binary_precision': 0.97733855, 'binary_recall': 0.92452043, 'binary_specificity': 0.97853196, 'binary_f1_score': 0.950196}
confusion matrix:
       0      1
0  28169    618
1   2176  26653
---- Validation: 
scalar performance:
{'acc': 0.91739595, 'precision': 0.5940441, 'recall': 0.7003785, 'specificity': 0.7003785, 'f1': 0.62237763, 'auroc': 0.8265943, 'binary_precision': 0.2089155, 'binary_recall': 0.4665676, 'binary_specificity': 0.9341894, 'binary_f1_score': 0.28860295}
confusion matrix:
       0     1
0  16878  1189
1    359   314
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9394135, 'precision': 0.6771053, 'recall': 0.7955173, 'specificity': 0.7955173, 'f1': 0.71840036, 'auroc': 0.8921078, 'binary_precision': 0.3705357, 'binary_recall': 0.63846153, 'binary_specificity': 0.9525732, 'binary_f1_score': 0.46892655}
confusion matrix:
      0    1
0  5664  282
1    94  166
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 12:52:41.558382,epoch time: 0:44:21.600387,used: 0:44:21.600387,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_12_08_19_seed_1_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95777214, 'precision': 0.95969033, 'recall': 0.95779693, 'specificity': 0.95779693, 'f1': 0.95772964, 'auroc': 0.9920892, 'binary_precision': 0.98957676, 'binary_recall': 0.92535555, 'binary_specificity': 0.9902383, 'binary_f1_score': 0.95638925}
confusion matrix:
       0      1
0  28505    281
1   2152  26678
---- Validation: 
scalar performance:
{'acc': 0.93479186, 'precision': 0.59501266, 'recall': 0.63429743, 'specificity': 0.63429743, 'f1': 0.610391, 'auroc': 0.81616294, 'binary_precision': 0.21613237, 'binary_recall': 0.31054977, 'binary_specificity': 0.95804507, 'binary_f1_score': 0.25487804}
confusion matrix:
       0    1
0  17309  758
1    464  209
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9437641, 'precision': 0.683347, 'recall': 0.76836395, 'specificity': 0.76836395, 'f1': 0.7162901, 'auroc': 0.8947954, 'binary_precision': 0.3856041, 'binary_recall': 0.5769231, 'binary_specificity': 0.9598049, 'binary_f1_score': 0.4622496}
confusion matrix:
      0    1
0  5707  239
1   110  150
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-01 13:36:32.363829,epoch time: 0:43:50.805447,used: 1:28:12.405834,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_12_08_19_seed_1_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9677173, 'precision': 0.96821225, 'recall': 0.9677287, 'specificity': 0.9677287, 'f1': 0.9677093, 'auroc': 0.9942907, 'binary_precision': 0.9836095, 'binary_recall': 0.95133203, 'binary_specificity': 0.9841253, 'binary_f1_score': 0.96720153}
confusion matrix:
       0      1
0  28331    457
1   1403  27425
---- Validation: 
scalar performance:
{'acc': 0.9177695, 'precision': 0.59409267, 'recall': 0.6991417, 'specificity': 0.6991417, 'f1': 0.6222929, 'auroc': 0.84158874, 'binary_precision': 0.20911528, 'binary_recall': 0.46359584, 'binary_specificity': 0.93468755, 'binary_f1_score': 0.2882217}
confusion matrix:
       0     1
0  16887  1180
1    361   312
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91540444, 'precision': 0.63423675, 'recall': 0.7976998, 'specificity': 0.7976998, 'f1': 0.6765638, 'auroc': 0.8944735, 'binary_precision': 0.28384992, 'binary_recall': 0.66923076, 'binary_specificity': 0.92616886, 'binary_f1_score': 0.39862546}
confusion matrix:
      0    1
0  5507  439
1    86  174
early stop counter: 1
val acc:0.9177694916725159, best validation acc: 0.9347918629646301, corresponding to test acc:                         0.9437640905380249 / 0.9437640905380249
after epoch: 3,now: 2024-08-01 14:20:23.262682,epoch time: 0:43:50.898853,used: 2:12:03.304687,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_12_08_19_seed_1_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9708588, 'precision': 0.9712074, 'recall': 0.97086835, 'specificity': 0.97086835, 'f1': 0.9708538, 'auroc': 0.99531806, 'binary_precision': 0.98419833, 'binary_recall': 0.957125, 'binary_specificity': 0.98461163, 'binary_f1_score': 0.97047293}
confusion matrix:
       0      1
0  28345    443
1   1236  27592
---- Validation: 
scalar performance:
{'acc': 0.90901816, 'precision': 0.5962413, 'recall': 0.7389496, 'specificity': 0.7389496, 'f1': 0.62812793, 'auroc': 0.8589897, 'binary_precision': 0.21011236, 'binary_recall': 0.5557206, 'binary_specificity': 0.92217857, 'binary_f1_score': 0.3049327}
confusion matrix:
       0     1
0  16661  1406
1    299   374
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9015469, 'precision': 0.62103003, 'recall': 0.8088579, 'specificity': 0.8088579, 'f1': 0.66122603, 'auroc': 0.8940587, 'binary_precision': 0.255911, 'binary_recall': 0.7076923, 'binary_specificity': 0.91002357, 'binary_f1_score': 0.37589377}
confusion matrix:
      0    1
0  5411  535
1    76  184
early stop counter: 2
val acc:0.9090181589126587, best validation acc: 0.9347918629646301, corresponding to test acc:                         0.9437640905380249 / 0.9437640905380249
after epoch: 4,now: 2024-08-01 15:04:30.516603,epoch time: 0:44:07.253921,used: 2:56:10.558608,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_12_08_19_seed_1_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9740176, 'precision': 0.97430325, 'recall': 0.9740267, 'specificity': 0.9740267, 'f1': 0.97401404, 'auroc': 0.9958495, 'binary_precision': 0.9861269, 'binary_recall': 0.96160114, 'binary_specificity': 0.9864522, 'binary_f1_score': 0.9737096}
confusion matrix:
       0      1
0  28397    390
1   1107  27722
---- Validation: 
scalar performance:
{'acc': 0.90720385, 'precision': 0.59252596, 'recall': 0.73157126, 'specificity': 0.73157126, 'f1': 0.62299806, 'auroc': 0.85536325, 'binary_precision': 0.2032294, 'binary_recall': 0.54234767, 'binary_specificity': 0.92079484, 'binary_f1_score': 0.29566625}
confusion matrix:
       0     1
0  16636  1431
1    308   365
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9015469, 'precision': 0.62017024, 'recall': 0.80517995, 'specificity': 0.80517995, 'f1': 0.65995514, 'auroc': 0.8899046, 'binary_precision': 0.25454545, 'binary_recall': 0.7, 'binary_specificity': 0.9103599, 'binary_f1_score': 0.37333333}
confusion matrix:
      0    1
0  5413  533
1    78  182
early stop counter: 3
val acc:0.9072038531303406, best validation acc: 0.9347918629646301, corresponding to test acc:                         0.9437640905380249 / 0.9437640905380249
after epoch: 5,now: 2024-08-01 15:48:33.322738,epoch time: 0:44:02.806135,used: 3:40:13.364743,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_12_08_19_seed_1_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:40:13.364743 at 2024-08-01 15:48:33.322738
persisted model performance metric: 

scalar performance:
{'acc': 0.9437641, 'precision': 0.683347, 'recall': 0.76836395, 'specificity': 0.76836395, 'f1': 0.7162901, 'auroc': 0.8947954, 'binary_precision': 0.3856041, 'binary_recall': 0.5769231, 'binary_specificity': 0.9598049, 'binary_f1_score': 0.4622496}
confusion matrix:
      0    1
0  5707  239
1   110  150
oracle model performance metric: 

scalar performance:
{'acc': 0.9437641, 'precision': 0.683347, 'recall': 0.76836395, 'specificity': 0.76836395, 'f1': 0.7162901, 'auroc': 0.8947954, 'binary_precision': 0.3856041, 'binary_recall': 0.5769231, 'binary_specificity': 0.9598049, 'binary_f1_score': 0.4622496}
confusion matrix:
      0    1
0  5707  239
1   110  150
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/4.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/4.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 762433 KiB |   5712 MiB |    903 TiB |    903 TiB |
|       from large pool | 719175 KiB |   5670 MiB |    895 TiB |    895 TiB |
|       from small pool |  43257 KiB |     82 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 762433 KiB |   5712 MiB |    903 TiB |    903 TiB |
|       from large pool | 719175 KiB |   5670 MiB |    895 TiB |    895 TiB |
|       from small pool |  43257 KiB |     82 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 759834 KiB |   5708 MiB |    902 TiB |    902 TiB |
|       from large pool | 717638 KiB |   5667 MiB |    894 TiB |    894 TiB |
|       from small pool |  42196 KiB |     81 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6554 MiB |   6576 MiB |  12252 MiB |   5698 MiB |
|       from large pool |   6470 MiB |   6488 MiB |  12134 MiB |   5664 MiB |
|       from small pool |     84 MiB |     88 MiB |    118 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 187839 KiB | 613857 KiB | 431025 GiB | 431025 GiB |
|       from large pool | 177848 KiB | 611362 KiB | 422857 GiB | 422857 GiB |
|       from small pool |   9990 KiB |  35053 KiB |   8167 GiB |   8167 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3590    |    8313    |  107105 K  |  107102 K  |
|       from large pool |     166    |     448    |   62950 K  |   62950 K  |
|       from small pool |    3424    |    8146    |   44155 K  |   44151 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3590    |    8313    |  107105 K  |  107102 K  |
|       from large pool |     166    |     448    |   62950 K  |   62950 K  |
|       from small pool |    3424    |    8146    |   44155 K  |   44151 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     201    |     212    |     358    |     157    |
|       from large pool |     159    |     168    |     299    |     140    |
|       from small pool |      42    |      44    |      59    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      72    |    3643    |   60411 K  |   60411 K  |
|       from large pool |      30    |     167    |   40153 K  |   40153 K  |
|       from small pool |      42    |    3613    |   20257 K  |   20257 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   5712 MiB |    903 TiB |    903 TiB |
|       from large pool |  16640 KiB |   5670 MiB |    895 TiB |    895 TiB |
|       from small pool |      0 KiB |     82 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   5712 MiB |    903 TiB |    903 TiB |
|       from large pool |  16640 KiB |   5670 MiB |    895 TiB |    895 TiB |
|       from small pool |      0 KiB |     82 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   5708 MiB |    902 TiB |    902 TiB |
|       from large pool |  16640 KiB |   5667 MiB |    894 TiB |    894 TiB |
|       from small pool |      0 KiB |     81 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    928 MiB |   6576 MiB |  12252 MiB |  11324 MiB |
|       from large pool |    876 MiB |   6488 MiB |  12134 MiB |  11258 MiB |
|       from small pool |     52 MiB |     88 MiB |    118 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 613857 KiB | 431025 GiB | 431025 GiB |
|       from large pool |  24320 KiB | 611362 KiB | 422857 GiB | 422857 GiB |
|       from small pool |      0 KiB |  35053 KiB |   8167 GiB |   8167 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8313    |  107105 K  |  107105 K  |
|       from large pool |       2    |     448    |   62950 K  |   62950 K  |
|       from small pool |       0    |    8146    |   44155 K  |   44155 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8313    |  107105 K  |  107105 K  |
|       from large pool |       2    |     448    |   62950 K  |   62950 K  |
|       from small pool |       0    |    8146    |   44155 K  |   44155 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      56    |     212    |     358    |     302    |
|       from large pool |      30    |     168    |     299    |     269    |
|       from small pool |      26    |      44    |      59    |      33    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3643    |   60412 K  |   60412 K  |
|       from large pool |       3    |     167    |   40153 K  |   40153 K  |
|       from small pool |       0    |    3613    |   20258 K  |   20258 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   5712 MiB |    903 TiB |    903 TiB |
|       from large pool |  16640 KiB |   5670 MiB |    895 TiB |    895 TiB |
|       from small pool |      0 KiB |     82 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   5712 MiB |    903 TiB |    903 TiB |
|       from large pool |  16640 KiB |   5670 MiB |    895 TiB |    895 TiB |
|       from small pool |      0 KiB |     82 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   5708 MiB |    902 TiB |    902 TiB |
|       from large pool |  16640 KiB |   5667 MiB |    894 TiB |    894 TiB |
|       from small pool |      0 KiB |     81 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    928 MiB |   6576 MiB |  12252 MiB |  11324 MiB |
|       from large pool |    876 MiB |   6488 MiB |  12134 MiB |  11258 MiB |
|       from small pool |     52 MiB |     88 MiB |    118 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 613857 KiB | 431025 GiB | 431025 GiB |
|       from large pool |  24320 KiB | 611362 KiB | 422857 GiB | 422857 GiB |
|       from small pool |      0 KiB |  35053 KiB |   8167 GiB |   8167 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8313    |  107105 K  |  107105 K  |
|       from large pool |       2    |     448    |   62950 K  |   62950 K  |
|       from small pool |       0    |    8146    |   44155 K  |   44155 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8313    |  107105 K  |  107105 K  |
|       from large pool |       2    |     448    |   62950 K  |   62950 K  |
|       from small pool |       0    |    8146    |   44155 K  |   44155 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      56    |     212    |     358    |     302    |
|       from large pool |      30    |     168    |     299    |     269    |
|       from small pool |      26    |      44    |      59    |      33    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3643    |   60412 K  |   60412 K  |
|       from large pool |       3    |     167    |   40153 K  |   40153 K  |
|       from small pool |       0    |    3613    |   20258 K  |   20258 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_15_56_15_seed_2_23919982

 Experiment start at: 2024-08-01 15:56:15.937267
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
before training, model accuracy: 0.045199550688266754
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9465903, 'precision': 0.9483752, 'recall': 0.94659674, 'specificity': 0.94659674, 'f1': 0.9465376, 'auroc': 0.9867375, 'binary_precision': 0.97671694, 'binary_recall': 0.91501474, 'binary_specificity': 0.9781788, 'binary_f1_score': 0.9448595}
confusion matrix:
       0      1
0  28510    636
1   2478  26680
---- Validation: 
scalar performance:
{'acc': 0.9048101, 'precision': 0.5753591, 'recall': 0.7091107, 'specificity': 0.7091107, 'f1': 0.60057956, 'auroc': 0.8358157, 'binary_precision': 0.16843872, 'binary_recall': 0.5, 'binary_specificity': 0.91822135, 'binary_f1_score': 0.25198826}
confusion matrix:
       0     1
0  16685  1486
1    301   301
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.931239, 'precision': 0.6570671, 'recall': 0.8313885, 'specificity': 0.8313885, 'f1': 0.70631206, 'auroc': 0.8918433, 'binary_precision': 0.32588455, 'binary_recall': 0.7231405, 'binary_specificity': 0.93963647, 'binary_f1_score': 0.44929397}
confusion matrix:
      0    1
0  5635  362
1    67  175
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 16:40:59.267647,epoch time: 0:44:43.330380,used: 0:44:43.330380,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_15_56_15_seed_2_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.956521, 'precision': 0.95754147, 'recall': 0.9565251, 'specificity': 0.9565251, 'f1': 0.95649695, 'auroc': 0.9906148, 'binary_precision': 0.97919214, 'binary_recall': 0.93288064, 'binary_specificity': 0.9801695, 'binary_f1_score': 0.9554755}
confusion matrix:
       0      1
0  28569    578
1   1957  27200
---- Validation: 
scalar performance:
{'acc': 0.9129068, 'precision': 0.5759351, 'recall': 0.6875956, 'specificity': 0.6875956, 'f1': 0.6006811, 'auroc': 0.8397846, 'binary_precision': 0.17122851, 'binary_recall': 0.44684386, 'binary_specificity': 0.92834735, 'binary_f1_score': 0.24758399}
confusion matrix:
       0     1
0  16869  1302
1    333   269
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9273922, 'precision': 0.64662516, 'recall': 0.81352556, 'specificity': 0.81352556, 'f1': 0.69282436, 'auroc': 0.8915043, 'binary_precision': 0.30642202, 'binary_recall': 0.69008267, 'binary_specificity': 0.9369685, 'binary_f1_score': 0.42439646}
confusion matrix:
      0    1
0  5619  378
1    75  167
better model found
persisted
after epoch: 2,now: 2024-08-01 17:25:18.834696,epoch time: 0:44:19.567049,used: 1:29:02.897429,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_15_56_15_seed_2_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9640162, 'precision': 0.9645473, 'recall': 0.96401906, 'specificity': 0.96401906, 'f1': 0.96400607, 'auroc': 0.9925171, 'binary_precision': 0.9802975, 'binary_recall': 0.9470796, 'binary_specificity': 0.9809586, 'binary_f1_score': 0.9634023}
confusion matrix:
       0      1
0  28592    555
1   1543  27614
---- Validation: 
scalar performance:
{'acc': 0.8762052, 'precision': 0.56888676, 'recall': 0.75376, 'specificity': 0.75376, 'f1': 0.5882824, 'auroc': 0.85000193, 'binary_precision': 0.15169904, 'binary_recall': 0.6229236, 'binary_specificity': 0.88459635, 'binary_f1_score': 0.2439818}
confusion matrix:
       0     1
0  16074  2097
1    227   375
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88491744, 'precision': 0.60277677, 'recall': 0.8211723, 'specificity': 0.8211723, 'f1': 0.6367047, 'auroc': 0.8884511, 'binary_precision': 0.21666667, 'binary_recall': 0.75206614, 'binary_specificity': 0.89027846, 'binary_f1_score': 0.33641404}
confusion matrix:
      0    1
0  5339  658
1    60  182
early stop counter: 1
val acc:0.8762052059173584, best validation acc: 0.91290682554245, corresponding to test acc:                         0.9273921847343445 / 0.9312390089035034
after epoch: 3,now: 2024-08-01 18:09:48.784908,epoch time: 0:44:29.950212,used: 2:13:32.847641,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_15_56_15_seed_2_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9690416, 'precision': 0.9694146, 'recall': 0.9690449, 'specificity': 0.9690449, 'f1': 0.9690356, 'auroc': 0.99431133, 'binary_precision': 0.9827063, 'binary_recall': 0.9549024, 'binary_specificity': 0.9831875, 'binary_f1_score': 0.9686049}
confusion matrix:
       0      1
0  28655    490
1   1315  27844
---- Validation: 
scalar performance:
{'acc': 0.887498, 'precision': 0.57591385, 'recall': 0.7587904, 'specificity': 0.7587904, 'f1': 0.60032463, 'auroc': 0.8650477, 'binary_precision': 0.1656333, 'binary_recall': 0.62126243, 'binary_specificity': 0.8963183, 'binary_f1_score': 0.26153845}
confusion matrix:
       0     1
0  16287  1884
1    228   374
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8979003, 'precision': 0.6117958, 'recall': 0.81602925, 'specificity': 0.81602925, 'f1': 0.65023535, 'auroc': 0.8930321, 'binary_precision': 0.2356091, 'binary_recall': 0.72727275, 'binary_specificity': 0.90478575, 'binary_f1_score': 0.35591504}
confusion matrix:
      0    1
0  5426  571
1    66  176
early stop counter: 2
val acc:0.8874980211257935, best validation acc: 0.91290682554245, corresponding to test acc:                         0.9273921847343445 / 0.9312390089035034
after epoch: 4,now: 2024-08-01 18:53:55.175454,epoch time: 0:44:06.390546,used: 2:57:39.238187,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_15_56_15_seed_2_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9699506, 'precision': 0.97020435, 'recall': 0.969953, 'specificity': 0.969953, 'f1': 0.9699466, 'auroc': 0.99462074, 'binary_precision': 0.98117846, 'binary_recall': 0.9582962, 'binary_specificity': 0.9816098, 'binary_f1_score': 0.96960235}
confusion matrix:
       0      1
0  28610    536
1   1216  27942
---- Validation: 
scalar performance:
{'acc': 0.9014542, 'precision': 0.58195966, 'recall': 0.7451204, 'specificity': 0.7451204, 'f1': 0.61025643, 'auroc': 0.8611043, 'binary_precision': 0.17901234, 'binary_recall': 0.5780731, 'binary_specificity': 0.9121677, 'binary_f1_score': 0.27336997}
confusion matrix:
       0     1
0  16575  1596
1    254   348
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9033499, 'precision': 0.6161115, 'recall': 0.8129158, 'specificity': 0.8129158, 'f1': 0.6561457, 'auroc': 0.8896611, 'binary_precision': 0.2446959, 'binary_recall': 0.71487606, 'binary_specificity': 0.9109555, 'binary_f1_score': 0.3645943}
confusion matrix:
      0    1
0  5463  534
1    69  173
early stop counter: 3
val acc:0.9014542102813721, best validation acc: 0.91290682554245, corresponding to test acc:                         0.9273921847343445 / 0.9312390089035034
after epoch: 5,now: 2024-08-01 19:38:26.184762,epoch time: 0:44:31.009308,used: 3:42:10.247495,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_01_15_56_15_seed_2_23919982
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:42:10.247495 at 2024-08-01 19:38:26.184762
persisted model performance metric: 

scalar performance:
{'acc': 0.9273922, 'precision': 0.64662516, 'recall': 0.81352556, 'specificity': 0.81352556, 'f1': 0.69282436, 'auroc': 0.8915043, 'binary_precision': 0.30642202, 'binary_recall': 0.69008267, 'binary_specificity': 0.9369685, 'binary_f1_score': 0.42439646}
confusion matrix:
      0    1
0  5619  378
1    75  167
oracle model performance metric: 

scalar performance:
{'acc': 0.931239, 'precision': 0.6570671, 'recall': 0.8313885, 'specificity': 0.8313885, 'f1': 0.70631206, 'auroc': 0.8918433, 'binary_precision': 0.32588455, 'binary_recall': 0.7231405, 'binary_specificity': 0.93963647, 'binary_f1_score': 0.44929397}
confusion matrix:
      0    1
0  5635  362
1    67  175
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/4.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/4.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 762439 KiB |   5712 MiB |   1411 TiB |   1411 TiB |
|       from large pool | 719175 KiB |   5670 MiB |   1398 TiB |   1398 TiB |
|       from small pool |  43263 KiB |     82 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 762439 KiB |   5712 MiB |   1411 TiB |   1411 TiB |
|       from large pool | 719175 KiB |   5670 MiB |   1398 TiB |   1398 TiB |
|       from small pool |  43263 KiB |     82 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 759835 KiB |   5708 MiB |   1410 TiB |   1410 TiB |
|       from large pool | 717638 KiB |   5667 MiB |   1398 TiB |   1398 TiB |
|       from small pool |  42197 KiB |     81 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6554 MiB |   6576 MiB |  17878 MiB |  11324 MiB |
|       from large pool |   6470 MiB |   6488 MiB |  17728 MiB |  11258 MiB |
|       from small pool |     84 MiB |     88 MiB |    150 MiB |     66 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 189881 KiB | 613857 KiB | 679153 GiB | 679153 GiB |
|       from large pool | 177848 KiB | 611362 KiB | 666398 GiB | 666398 GiB |
|       from small pool |  12032 KiB |  35053 KiB |  12754 GiB |  12754 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3602    |    8399    |  167288 K  |  167284 K  |
|       from large pool |     166    |     448    |   98352 K  |   98352 K  |
|       from small pool |    3436    |    8232    |   68936 K  |   68932 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3602    |    8399    |  167288 K  |  167284 K  |
|       from large pool |     166    |     448    |   98352 K  |   98352 K  |
|       from small pool |    3436    |    8232    |   68936 K  |   68932 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     201    |     212    |     503    |     302    |
|       from large pool |     159    |     168    |     428    |     269    |
|       from small pool |      42    |      44    |      75    |      33    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |    3685    |   93232 K  |   93232 K  |
|       from large pool |      30    |     167    |   61825 K  |   61825 K  |
|       from small pool |      41    |    3655    |   31406 K  |   31406 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   5712 MiB |   1411 TiB |   1411 TiB |
|       from large pool |  16640 KiB |   5670 MiB |   1398 TiB |   1398 TiB |
|       from small pool |      0 KiB |     82 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   5712 MiB |   1411 TiB |   1411 TiB |
|       from large pool |  16640 KiB |   5670 MiB |   1398 TiB |   1398 TiB |
|       from small pool |      0 KiB |     82 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   5708 MiB |   1410 TiB |   1410 TiB |
|       from large pool |  16640 KiB |   5667 MiB |   1398 TiB |   1398 TiB |
|       from small pool |      0 KiB |     81 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    930 MiB |   6576 MiB |  17878 MiB |  16948 MiB |
|       from large pool |    876 MiB |   6488 MiB |  17728 MiB |  16852 MiB |
|       from small pool |     54 MiB |     88 MiB |    150 MiB |     96 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 613857 KiB | 679153 GiB | 679153 GiB |
|       from large pool |  24320 KiB | 611362 KiB | 666398 GiB | 666398 GiB |
|       from small pool |      0 KiB |  35053 KiB |  12755 GiB |  12755 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8399    |  167288 K  |  167288 K  |
|       from large pool |       2    |     448    |   98352 K  |   98352 K  |
|       from small pool |       0    |    8232    |   68936 K  |   68936 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8399    |  167288 K  |  167288 K  |
|       from large pool |       2    |     448    |   98352 K  |   98352 K  |
|       from small pool |       0    |    8232    |   68936 K  |   68936 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     212    |     503    |     446    |
|       from large pool |      30    |     168    |     428    |     398    |
|       from small pool |      27    |      44    |      75    |      48    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3685    |   93233 K  |   93233 K  |
|       from large pool |       3    |     167    |   61825 K  |   61825 K  |
|       from small pool |       0    |    3655    |   31408 K  |   31408 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  1 19:39:50 2024]
Finished job 0.
1 of 1 steps (100%) done
