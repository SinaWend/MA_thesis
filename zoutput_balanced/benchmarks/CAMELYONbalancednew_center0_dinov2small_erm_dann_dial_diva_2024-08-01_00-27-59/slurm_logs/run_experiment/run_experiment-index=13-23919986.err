Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 14:36:50 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/13.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=13
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/var/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_14_48_05_seed_0_23919986

 Experiment start at: 2024-08-01 14:48:05.411141
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9476639, 'precision': 0.94897485, 'recall': 0.94768566, 'specificity': 0.94768566, 'f1': 0.9476274, 'auroc': 0.98535913, 'binary_precision': 0.973437, 'binary_recall': 0.920531, 'binary_specificity': 0.97484034, 'binary_f1_score': 0.9462451}
confusion matrix:
       0      1
0  27936    721
1   2281  26422
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9184759, 'precision': 0.6034358, 'recall': 0.74477816, 'specificity': 0.74477816, 'f1': 0.63787675, 'auroc': 0.8725022, 'binary_precision': 0.22339764, 'binary_recall': 0.55832034, 'binary_specificity': 0.9312359, 'binary_f1_score': 0.3191111}
confusion matrix:
       0     1
0  16901  1248
1    284   359
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9141898, 'precision': 0.6451509, 'recall': 0.8562816, 'specificity': 0.8562816, 'f1': 0.694449, 'auroc': 0.91061556, 'binary_precision': 0.3, 'binary_recall': 0.79310346, 'binary_specificity': 0.9194597, 'binary_f1_score': 0.43533126}
confusion matrix:
      0    1
0  5514  483
1    54  207
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 15:32:52.525302,epoch time: 0:44:47.114161,used: 0:44:47.114161,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_14_48_05_seed_0_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9640865, 'precision': 0.9644159, 'recall': 0.9640987, 'specificity': 0.9640987, 'f1': 0.9640808, 'auroc': 0.99273205, 'binary_precision': 0.97701395, 'binary_recall': 0.95060265, 'binary_specificity': 0.97759473, 'binary_f1_score': 0.9636274}
confusion matrix:
       0      1
0  28012    642
1   1418  27288
---- Validation: 
scalar performance:
{'acc': 0.8784589, 'precision': 0.58602047, 'recall': 0.80881697, 'specificity': 0.80881697, 'f1': 0.61298037, 'auroc': 0.88648856, 'binary_precision': 0.18259187, 'binary_recall': 0.7340591, 'binary_specificity': 0.88357484, 'binary_f1_score': 0.29244113}
confusion matrix:
       0     1
0  16036  2113
1    171   472
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8379674, 'precision': 0.5888788, 'recall': 0.84399676, 'specificity': 0.84399676, 'f1': 0.6064142, 'auroc': 0.92202044, 'binary_precision': 0.18546365, 'binary_recall': 0.85057473, 'binary_specificity': 0.83741874, 'binary_f1_score': 0.30452675}
confusion matrix:
      0    1
0  5022  975
1    39  222
early stop counter: 1
val acc:0.8784589171409607, best validation acc: 0.9184759259223938, corresponding to test acc:                         0.9141898155212402 / 0.9141898155212402
after epoch: 2,now: 2024-08-01 16:16:23.964429,epoch time: 0:43:31.439127,used: 1:28:18.553288,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_14_48_05_seed_0_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9701534, 'precision': 0.9706134, 'recall': 0.9701666, 'specificity': 0.9701666, 'f1': 0.97014666, 'auroc': 0.99525064, 'binary_precision': 0.98553747, 'binary_recall': 0.95436174, 'binary_specificity': 0.9859715, 'binary_f1_score': 0.9696991}
confusion matrix:
       0      1
0  28254    402
1   1310  27394
---- Validation: 
scalar performance:
{'acc': 0.912782, 'precision': 0.6056629, 'recall': 0.77858305, 'specificity': 0.77858305, 'f1': 0.64286315, 'auroc': 0.88194454, 'binary_precision': 0.22516556, 'binary_recall': 0.63452566, 'binary_specificity': 0.9226404, 'binary_f1_score': 0.33238292}
confusion matrix:
       0     1
0  16745  1404
1    235   408
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8892617, 'precision': 0.6165641, 'recall': 0.83961046, 'specificity': 0.83961046, 'f1': 0.6554966, 'auroc': 0.9194374, 'binary_precision': 0.24346793, 'binary_recall': 0.7854406, 'binary_specificity': 0.89378023, 'binary_f1_score': 0.37171352}
confusion matrix:
      0    1
0  5360  637
1    56  205
early stop counter: 2
val acc:0.9127820134162903, best validation acc: 0.9184759259223938, corresponding to test acc:                         0.9141898155212402 / 0.9141898155212402
after epoch: 3,now: 2024-08-01 16:59:36.698834,epoch time: 0:43:12.734405,used: 2:11:31.287693,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_14_48_05_seed_0_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9752615, 'precision': 0.9754745, 'recall': 0.9752693, 'specificity': 0.9752693, 'f1': 0.97525907, 'auroc': 0.9963924, 'binary_precision': 0.9857214, 'binary_recall': 0.9645308, 'binary_specificity': 0.98600787, 'binary_f1_score': 0.975011}
confusion matrix:
       0      1
0  28258    401
1   1018  27683
---- Validation: 
scalar performance:
{'acc': 0.90671563, 'precision': 0.6041729, 'recall': 0.797944, 'specificity': 0.797944, 'f1': 0.6415282, 'auroc': 0.8856343, 'binary_precision': 0.2205438, 'binary_recall': 0.68118197, 'binary_specificity': 0.91470605, 'binary_f1_score': 0.33320656}
confusion matrix:
       0     1
0  16601  1548
1    205   438
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8897411, 'precision': 0.61739665, 'recall': 0.84169286, 'specificity': 0.84169286, 'f1': 0.6567068, 'auroc': 0.9203944, 'binary_precision': 0.2449465, 'binary_recall': 0.789272, 'binary_specificity': 0.8941137, 'binary_f1_score': 0.37386566}
confusion matrix:
      0    1
0  5362  635
1    55  206
early stop counter: 3
val acc:0.9067156314849854, best validation acc: 0.9184759259223938, corresponding to test acc:                         0.9141898155212402 / 0.9141898155212402
after epoch: 4,now: 2024-08-01 17:42:16.936709,epoch time: 0:42:40.237875,used: 2:54:11.525568,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_14_48_05_seed_0_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:54:11.525568 at 2024-08-01 17:42:16.936709
persisted model performance metric: 

scalar performance:
{'acc': 0.9141898, 'precision': 0.6451509, 'recall': 0.8562816, 'specificity': 0.8562816, 'f1': 0.694449, 'auroc': 0.91061556, 'binary_precision': 0.3, 'binary_recall': 0.79310346, 'binary_specificity': 0.9194597, 'binary_f1_score': 0.43533126}
confusion matrix:
      0    1
0  5514  483
1    54  207
oracle model performance metric: 

scalar performance:
{'acc': 0.9141898, 'precision': 0.6451509, 'recall': 0.8562816, 'specificity': 0.8562816, 'f1': 0.694449, 'auroc': 0.91061556, 'binary_precision': 0.3, 'binary_recall': 0.79310346, 'binary_specificity': 0.9194597, 'binary_f1_score': 0.43533126}
confusion matrix:
      0    1
0  5514  483
1    54  207
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/13.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/13.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/13.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198153 KiB |   4047 MiB | 422398 GiB | 422398 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 417748 GiB | 417747 GiB |
|       from small pool |  17491 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198153 KiB |   4047 MiB | 422398 GiB | 422398 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 417748 GiB | 417747 GiB |
|       from small pool |  17491 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   4045 MiB | 422374 GiB | 422374 GiB |
|       from large pool | 178979 KiB |   4026 MiB | 417728 GiB | 417728 GiB |
|       from small pool |  16482 KiB |     36 MiB |   4645 GiB |   4645 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4966 MiB |   4966 MiB |   4966 MiB |      0 B   |
|       from large pool |   4924 MiB |   4924 MiB |   4924 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55799 KiB | 392988 KiB | 212035 GiB | 212035 GiB |
|       from large pool |  50762 KiB | 392048 KiB | 207345 GiB | 207345 GiB |
|       from small pool |   5037 KiB |   9269 KiB |   4689 GiB |   4689 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2978    |    7645    |   54125 K  |   54123 K  |
|       from large pool |      79    |     423    |   36924 K  |   36923 K  |
|       from small pool |    2899    |    7565    |   17201 K  |   17199 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2978    |    7645    |   54125 K  |   54123 K  |
|       from large pool |      79    |     423    |   36924 K  |   36923 K  |
|       from small pool |    2899    |    7565    |   17201 K  |   17199 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     204    |     204    |     204    |       0    |
|       from large pool |     183    |     183    |     183    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      30    |    3606    |   37243 K  |   37243 K  |
|       from large pool |      10    |     183    |   28836 K  |   28836 K  |
|       from small pool |      20    |    3596    |    8407 K  |    8407 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 422398 GiB | 422398 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 417748 GiB | 417748 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 422398 GiB | 422398 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 417748 GiB | 417748 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 422374 GiB | 422374 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 417728 GiB | 417728 GiB |
|       from small pool |      0 KiB |     36 MiB |   4645 GiB |   4645 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   4966 MiB |   4966 MiB |   4718 MiB |
|       from large pool | 231424 KiB |   4924 MiB |   4924 MiB |   4698 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 392988 KiB | 212035 GiB | 212035 GiB |
|       from large pool |  30464 KiB | 392048 KiB | 207345 GiB | 207345 GiB |
|       from small pool |      0 KiB |  16546 KiB |   4689 GiB |   4689 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     204    |     204    |     182    |
|       from large pool |      11    |     183    |     183    |     172    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3606    |   37244 K  |   37244 K  |
|       from large pool |       3    |     183    |   28836 K  |   28836 K  |
|       from small pool |       0    |    3596    |    8408 K  |    8408 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 422398 GiB | 422398 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 417748 GiB | 417748 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 422398 GiB | 422398 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 417748 GiB | 417748 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 422374 GiB | 422374 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 417728 GiB | 417728 GiB |
|       from small pool |      0 KiB |     36 MiB |   4645 GiB |   4645 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   4966 MiB |   4966 MiB |   4718 MiB |
|       from large pool | 231424 KiB |   4924 MiB |   4924 MiB |   4698 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 392988 KiB | 212035 GiB | 212035 GiB |
|       from large pool |  30464 KiB | 392048 KiB | 207345 GiB | 207345 GiB |
|       from small pool |      0 KiB |  16546 KiB |   4689 GiB |   4689 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     204    |     204    |     182    |
|       from large pool |      11    |     183    |     183    |     172    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3606    |   37244 K  |   37244 K  |
|       from large pool |       3    |     183    |   28836 K  |   28836 K  |
|       from small pool |       0    |    3596    |    8408 K  |    8408 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_52_16_seed_1_23919986

 Experiment start at: 2024-08-01 17:52:16.965567
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.950118, 'precision': 0.9516086, 'recall': 0.9501381, 'specificity': 0.9501381, 'f1': 0.95007837, 'auroc': 0.98829055, 'binary_precision': 0.9777279, 'binary_recall': 0.9212918, 'binary_specificity': 0.9789843, 'binary_f1_score': 0.9486712}
confusion matrix:
       0      1
0  28183    605
1   2269  26559
---- Validation: 
scalar performance:
{'acc': 0.93078977, 'precision': 0.6224898, 'recall': 0.7316439, 'specificity': 0.7316439, 'f1': 0.6563368, 'auroc': 0.8673416, 'binary_precision': 0.26363635, 'binary_recall': 0.51708764, 'binary_specificity': 0.94620025, 'binary_f1_score': 0.34922224}
confusion matrix:
       0    1
0  17095  972
1    325  348
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9395746, 'precision': 0.6800637, 'recall': 0.8084743, 'specificity': 0.8084743, 'f1': 0.7239065, 'auroc': 0.91486454, 'binary_precision': 0.37527114, 'binary_recall': 0.6653846, 'binary_specificity': 0.9515641, 'binary_f1_score': 0.47988904}
confusion matrix:
      0    1
0  5658  288
1    87  173
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 18:36:34.806480,epoch time: 0:44:17.840913,used: 0:44:17.840913,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_52_16_seed_1_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9617988, 'precision': 0.9625095, 'recall': 0.9618132, 'specificity': 0.9618132, 'f1': 0.96178496, 'auroc': 0.99287397, 'binary_precision': 0.9808234, 'binary_recall': 0.9420722, 'binary_specificity': 0.98155415, 'binary_f1_score': 0.9610573}
confusion matrix:
       0      1
0  28256    531
1   1670  27159
---- Validation: 
scalar performance:
{'acc': 0.926254, 'precision': 0.6360936, 'recall': 0.8144084, 'specificity': 0.8144084, 'f1': 0.68198997, 'auroc': 0.88323855, 'binary_precision': 0.28423616, 'binary_recall': 0.69390786, 'binary_specificity': 0.9349089, 'binary_f1_score': 0.4032815}
confusion matrix:
       0     1
0  16891  1176
1    206   467
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8970351, 'precision': 0.62717754, 'recall': 0.85615605, 'specificity': 0.85615605, 'f1': 0.6707217, 'auroc': 0.92339134, 'binary_precision': 0.26342073, 'binary_recall': 0.81153846, 'binary_specificity': 0.90077364, 'binary_f1_score': 0.397738}
confusion matrix:
      0    1
0  5356  590
1    49  211
early stop counter: 1
val acc:0.9262539744377136, best validation acc: 0.9307897686958313, corresponding to test acc:                         0.9395745992660522 / 0.9395745992660522
after epoch: 2,now: 2024-08-01 19:21:10.774854,epoch time: 0:44:35.968374,used: 1:28:53.809287,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_52_16_seed_1_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9696265, 'precision': 0.9698355, 'recall': 0.96963465, 'specificity': 0.96963465, 'f1': 0.96962345, 'auroc': 0.9950563, 'binary_precision': 0.9799376, 'binary_recall': 0.9589317, 'binary_specificity': 0.9803377, 'binary_f1_score': 0.9693209}
confusion matrix:
       0      1
0  28220    566
1   1184  27646
---- Validation: 
scalar performance:
{'acc': 0.9062967, 'precision': 0.6143626, 'recall': 0.8255161, 'specificity': 0.8255161, 'f1': 0.6554465, 'auroc': 0.89072347, 'binary_precision': 0.23928744, 'binary_recall': 0.7384844, 'binary_specificity': 0.91254777, 'binary_f1_score': 0.36145455}
confusion matrix:
       0     1
0  16487  1580
1    176   497
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8659362, 'precision': 0.6052186, 'recall': 0.85831654, 'specificity': 0.85831654, 'f1': 0.6361197, 'auroc': 0.9246584, 'binary_precision': 0.21794872, 'binary_recall': 0.85, 'binary_specificity': 0.86663306, 'binary_f1_score': 0.3469388}
confusion matrix:
      0    1
0  5153  793
1    39  221
early stop counter: 2
val acc:0.9062966704368591, best validation acc: 0.9307897686958313, corresponding to test acc:                         0.9395745992660522 / 0.9395745992660522
after epoch: 3,now: 2024-08-01 20:06:19.846579,epoch time: 0:45:09.071725,used: 2:14:02.881012,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_52_16_seed_1_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97212577, 'precision': 0.97246826, 'recall': 0.9721362, 'specificity': 0.9721362, 'f1': 0.9721211, 'auroc': 0.9959364, 'binary_precision': 0.9853801, 'binary_recall': 0.9585154, 'binary_specificity': 0.985757, 'binary_f1_score': 0.97176206}
confusion matrix:
       0      1
0  28376    410
1   1196  27634
---- Validation: 
scalar performance:
{'acc': 0.91696906, 'precision': 0.6249868, 'recall': 0.8210373, 'specificity': 0.8210373, 'f1': 0.6692594, 'auroc': 0.89313686, 'binary_precision': 0.26122227, 'binary_recall': 0.717682, 'binary_specificity': 0.9243925, 'binary_f1_score': 0.38302934}
confusion matrix:
       0     1
0  16701  1366
1    190   483
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8889784, 'precision': 0.6201697, 'recall': 0.85562956, 'specificity': 0.85562956, 'f1': 0.6605366, 'auroc': 0.9224941, 'binary_precision': 0.24912281, 'binary_recall': 0.8192308, 'binary_specificity': 0.8920283, 'binary_f1_score': 0.38206276}
confusion matrix:
      0    1
0  5304  642
1    47  213
early stop counter: 3
val acc:0.9169690608978271, best validation acc: 0.9307897686958313, corresponding to test acc:                         0.9395745992660522 / 0.9395745992660522
after epoch: 4,now: 2024-08-01 20:52:01.584117,epoch time: 0:45:41.737538,used: 2:59:44.618550,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_52_16_seed_1_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:59:44.618550 at 2024-08-01 20:52:01.584117
persisted model performance metric: 

scalar performance:
{'acc': 0.9395746, 'precision': 0.6800637, 'recall': 0.8084743, 'specificity': 0.8084743, 'f1': 0.7239065, 'auroc': 0.91486454, 'binary_precision': 0.37527114, 'binary_recall': 0.6653846, 'binary_specificity': 0.9515641, 'binary_f1_score': 0.47988904}
confusion matrix:
      0    1
0  5658  288
1    87  173
oracle model performance metric: 

scalar performance:
{'acc': 0.9395746, 'precision': 0.6800637, 'recall': 0.8084743, 'specificity': 0.8084743, 'f1': 0.7239065, 'auroc': 0.91486454, 'binary_precision': 0.37527114, 'binary_recall': 0.6653846, 'binary_specificity': 0.9515641, 'binary_f1_score': 0.47988904}
confusion matrix:
      0    1
0  5658  288
1    87  173
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/13.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/13.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196690 KiB |   4047 MiB |    826 TiB |    826 TiB |
|       from large pool | 179211 KiB |   4027 MiB |    817 TiB |    817 TiB |
|       from small pool |  17479 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196690 KiB |   4047 MiB |    826 TiB |    826 TiB |
|       from large pool | 179211 KiB |   4027 MiB |    817 TiB |    817 TiB |
|       from small pool |  17479 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   4045 MiB |    826 TiB |    826 TiB |
|       from large pool | 178979 KiB |   4026 MiB |    817 TiB |    817 TiB |
|       from small pool |  16480 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4946 MiB |   4966 MiB |   9664 MiB |   4718 MiB |
|       from large pool |   4908 MiB |   4924 MiB |   9606 MiB |   4698 MiB |
|       from small pool |     38 MiB |     42 MiB |     58 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  38830 KiB | 396512 KiB | 432885 GiB | 432885 GiB |
|       from large pool |  31733 KiB | 395396 KiB | 423489 GiB | 423489 GiB |
|       from small pool |   7097 KiB |  16546 KiB |   9395 GiB |   9395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7677    |  108448 K  |  108445 K  |
|       from large pool |      79    |     423    |   73996 K  |   73996 K  |
|       from small pool |    2875    |    7597    |   34451 K  |   34449 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7677    |  108448 K  |  108445 K  |
|       from large pool |      79    |     423    |   73996 K  |   73996 K  |
|       from small pool |    2875    |    7597    |   34451 K  |   34449 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     204    |     382    |     182    |
|       from large pool |     181    |     183    |     353    |     172    |
|       from small pool |      19    |      21    |      29    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      33    |    3621    |   73470 K  |   73470 K  |
|       from large pool |      11    |     185    |   56649 K  |   56649 K  |
|       from small pool |      22    |    3610    |   16820 K  |   16820 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |    826 TiB |    826 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    817 TiB |    817 TiB |
|       from small pool |      0 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |    826 TiB |    826 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    817 TiB |    817 TiB |
|       from small pool |      0 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |    826 TiB |    826 TiB |
|       from large pool |  16640 KiB |   4026 MiB |    817 TiB |    817 TiB |
|       from small pool |      0 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB |   4966 MiB |   9664 MiB |   9434 MiB |
|       from large pool | 210944 KiB |   4924 MiB |   9606 MiB |   9400 MiB |
|       from small pool |  24576 KiB |     42 MiB |     58 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 396512 KiB | 432885 GiB | 432885 GiB |
|       from large pool |  30464 KiB | 395396 KiB | 423489 GiB | 423489 GiB |
|       from small pool |      0 KiB |  21453 KiB |   9395 GiB |   9395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |  108448 K  |  108448 K  |
|       from large pool |       2    |     423    |   73996 K  |   73996 K  |
|       from small pool |       0    |    7597    |   34451 K  |   34451 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |  108448 K  |  108448 K  |
|       from large pool |       2    |     423    |   73996 K  |   73996 K  |
|       from small pool |       0    |    7597    |   34451 K  |   34451 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     204    |     382    |     360    |
|       from large pool |      10    |     183    |     353    |     343    |
|       from small pool |      12    |      21    |      29    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3621    |   73471 K  |   73471 K  |
|       from large pool |       3    |     185    |   56649 K  |   56649 K  |
|       from small pool |       0    |    3610    |   16822 K  |   16822 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |    826 TiB |    826 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    817 TiB |    817 TiB |
|       from small pool |      0 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |    826 TiB |    826 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    817 TiB |    817 TiB |
|       from small pool |      0 KiB |     37 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |    826 TiB |    826 TiB |
|       from large pool |  16640 KiB |   4026 MiB |    817 TiB |    817 TiB |
|       from small pool |      0 KiB |     36 MiB |      9 TiB |      9 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB |   4966 MiB |   9664 MiB |   9434 MiB |
|       from large pool | 210944 KiB |   4924 MiB |   9606 MiB |   9400 MiB |
|       from small pool |  24576 KiB |     42 MiB |     58 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 396512 KiB | 432885 GiB | 432885 GiB |
|       from large pool |  30464 KiB | 395396 KiB | 423489 GiB | 423489 GiB |
|       from small pool |      0 KiB |  21453 KiB |   9395 GiB |   9395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |  108448 K  |  108448 K  |
|       from large pool |       2    |     423    |   73996 K  |   73996 K  |
|       from small pool |       0    |    7597    |   34451 K  |   34451 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |  108448 K  |  108448 K  |
|       from large pool |       2    |     423    |   73996 K  |   73996 K  |
|       from small pool |       0    |    7597    |   34451 K  |   34451 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     204    |     382    |     360    |
|       from large pool |      10    |     183    |     353    |     343    |
|       from small pool |      12    |      21    |      29    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3621    |   73471 K  |   73471 K  |
|       from large pool |       3    |     185    |   56649 K  |   56649 K  |
|       from small pool |       0    |    3610    |   16822 K  |   16822 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_03_39_seed_2_23919986

 Experiment start at: 2024-08-01 21:03:40.036750
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9495232, 'precision': 0.9507345, 'recall': 0.9495268, 'specificity': 0.9495268, 'f1': 0.9494896, 'auroc': 0.98725057, 'binary_precision': 0.9741345, 'binary_recall': 0.9235835, 'binary_specificity': 0.97547, 'binary_f1_score': 0.94818574}
confusion matrix:
       0      1
0  28433    715
1   2228  26928
---- Validation: 
scalar performance:
{'acc': 0.9390082, 'precision': 0.6183143, 'recall': 0.7115183, 'specificity': 0.7115183, 'f1': 0.64903367, 'auroc': 0.8428496, 'binary_precision': 0.25474253, 'binary_recall': 0.46843854, 'binary_specificity': 0.954598, 'binary_f1_score': 0.33001754}
confusion matrix:
       0    1
0  17346  825
1    320  282
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92098093, 'precision': 0.63048506, 'recall': 0.7863977, 'specificity': 0.7863977, 'f1': 0.67191267, 'auroc': 0.8730626, 'binary_precision': 0.27629232, 'binary_recall': 0.6404959, 'binary_specificity': 0.9322995, 'binary_f1_score': 0.3860523}
confusion matrix:
      0    1
0  5591  406
1    87  155
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 21:49:17.417390,epoch time: 0:45:37.380640,used: 0:45:37.380640,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_03_39_seed_2_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96240395, 'precision': 0.96327174, 'recall': 0.96240765, 'specificity': 0.96240765, 'f1': 0.9623865, 'auroc': 0.99260557, 'binary_precision': 0.983365, 'binary_recall': 0.9407346, 'binary_specificity': 0.9840807, 'binary_f1_score': 0.9615775}
confusion matrix:
       0      1
0  28683    464
1   1728  27429
---- Validation: 
scalar performance:
{'acc': 0.943749, 'precision': 0.636518, 'recall': 0.7380587, 'specificity': 0.7380587, 'f1': 0.67099285, 'auroc': 0.86683184, 'binary_precision': 0.28942487, 'binary_recall': 0.5182724, 'binary_specificity': 0.9578449, 'binary_f1_score': 0.37142855}
confusion matrix:
       0    1
0  17405  766
1    290  312
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92995673, 'precision': 0.65256715, 'recall': 0.8208078, 'specificity': 0.8208078, 'f1': 0.7001166, 'auroc': 0.9039975, 'binary_precision': 0.317757, 'binary_recall': 0.70247936, 'binary_specificity': 0.9391362, 'binary_f1_score': 0.43758044}
confusion matrix:
      0    1
0  5632  365
1    72  170
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-01 22:34:07.454474,epoch time: 0:44:50.037084,used: 1:30:27.417724,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_03_39_seed_2_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96871567, 'precision': 0.9691385, 'recall': 0.96871877, 'specificity': 0.96871877, 'f1': 0.96870875, 'auroc': 0.99444914, 'binary_precision': 0.9832744, 'binary_recall': 0.9536662, 'binary_specificity': 0.9837714, 'binary_f1_score': 0.968244}
confusion matrix:
       0      1
0  28673    473
1   1351  27807
---- Validation: 
scalar performance:
{'acc': 0.93629146, 'precision': 0.6280309, 'recall': 0.7647222, 'specificity': 0.7647222, 'f1': 0.667825, 'auroc': 0.8796788, 'binary_precision': 0.27047914, 'binary_recall': 0.5813953, 'binary_specificity': 0.94804907, 'binary_f1_score': 0.36919832}
confusion matrix:
       0    1
0  17227  944
1    252  350
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92707163, 'precision': 0.6540221, 'recall': 0.8510309, 'specificity': 0.8510309, 'f1': 0.70538306, 'auroc': 0.91667235, 'binary_precision': 0.31794873, 'binary_recall': 0.76859504, 'binary_specificity': 0.93346673, 'binary_f1_score': 0.4498186}
confusion matrix:
      0    1
0  5598  399
1    56  186
early stop counter: 1
val acc:0.9362914562225342, best validation acc: 0.9437490105628967, corresponding to test acc:                         0.9299567341804504 / 0.9299567341804504
after epoch: 3,now: 2024-08-01 23:20:39.735327,epoch time: 0:46:32.280853,used: 2:16:59.698577,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_03_39_seed_2_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9723518, 'precision': 0.972589, 'recall': 0.9723541, 'specificity': 0.9723541, 'f1': 0.97234845, 'auroc': 0.9958135, 'binary_precision': 0.9832292, 'binary_recall': 0.96110845, 'binary_specificity': 0.9835998, 'binary_f1_score': 0.97204304}
confusion matrix:
       0      1
0  28668    478
1   1134  28024
---- Validation: 
scalar performance:
{'acc': 0.92968625, 'precision': 0.62174815, 'recall': 0.78379554, 'specificity': 0.78379554, 'f1': 0.6634736, 'auroc': 0.88205373, 'binary_precision': 0.25644505, 'binary_recall': 0.627907, 'binary_specificity': 0.9396841, 'binary_f1_score': 0.36416185}
confusion matrix:
       0     1
0  17075  1096
1    224   378
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9211412, 'precision': 0.6445328, 'recall': 0.84794605, 'specificity': 0.84794605, 'f1': 0.69409645, 'auroc': 0.92052156, 'binary_precision': 0.29903537, 'binary_recall': 0.76859504, 'binary_specificity': 0.927297, 'binary_f1_score': 0.43055555}
confusion matrix:
      0    1
0  5561  436
1    56  186
early stop counter: 2
val acc:0.9296862483024597, best validation acc: 0.9437490105628967, corresponding to test acc:                         0.9299567341804504 / 0.9299567341804504
after epoch: 4,now: 2024-08-02 00:07:14.924238,epoch time: 0:46:35.188911,used: 3:03:34.887488,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_03_39_seed_2_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97588503, 'precision': 0.97615266, 'recall': 0.9758875, 'specificity': 0.9758875, 'f1': 0.9758817, 'auroc': 0.9964222, 'binary_precision': 0.987493, 'binary_recall': 0.9639893, 'binary_specificity': 0.98778564, 'binary_f1_score': 0.9755996}
confusion matrix:
       0      1
0  28790    356
1   1050  28108
---- Validation: 
scalar performance:
{'acc': 0.93021894, 'precision': 0.6202755, 'recall': 0.7744341, 'specificity': 0.7744341, 'f1': 0.66078746, 'auroc': 0.88103884, 'binary_precision': 0.25416666, 'binary_recall': 0.6079734, 'binary_specificity': 0.94089484, 'binary_f1_score': 0.3584721}
confusion matrix:
       0     1
0  17097  1074
1    236   366
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9219426, 'precision': 0.6440967, 'recall': 0.8404319, 'specificity': 0.8404319, 'f1': 0.6929234, 'auroc': 0.9164229, 'binary_precision': 0.29885057, 'binary_recall': 0.75206614, 'binary_specificity': 0.9287977, 'binary_f1_score': 0.42773208}
confusion matrix:
      0    1
0  5570  427
1    60  182
early stop counter: 3
val acc:0.9302189350128174, best validation acc: 0.9437490105628967, corresponding to test acc:                         0.9299567341804504 / 0.9299567341804504
after epoch: 5,now: 2024-08-02 00:53:38.471912,epoch time: 0:46:23.547674,used: 3:49:58.435162,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_21_03_39_seed_2_23919986
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:49:58.435162 at 2024-08-02 00:53:38.471912
persisted model performance metric: 

scalar performance:
{'acc': 0.92995673, 'precision': 0.65256715, 'recall': 0.8208078, 'specificity': 0.8208078, 'f1': 0.7001166, 'auroc': 0.9039975, 'binary_precision': 0.317757, 'binary_recall': 0.70247936, 'binary_specificity': 0.9391362, 'binary_f1_score': 0.43758044}
confusion matrix:
      0    1
0  5632  365
1    72  170
oracle model performance metric: 

scalar performance:
{'acc': 0.92995673, 'precision': 0.65256715, 'recall': 0.8208078, 'specificity': 0.8208078, 'f1': 0.7001166, 'auroc': 0.9039975, 'binary_precision': 0.317757, 'binary_recall': 0.70247936, 'binary_specificity': 0.9391362, 'binary_f1_score': 0.43758044}
confusion matrix:
      0    1
0  5632  365
1    72  170
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/13.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/13.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196696 KiB |   4047 MiB |   1349 TiB |   1349 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1334 TiB |   1334 TiB |
|       from small pool |  17485 KiB |     37 MiB |     14 TiB |     14 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196696 KiB |   4047 MiB |   1349 TiB |   1349 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1334 TiB |   1334 TiB |
|       from small pool |  17485 KiB |     37 MiB |     14 TiB |     14 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195460 KiB |   4045 MiB |   1349 TiB |   1349 TiB |
|       from large pool | 178979 KiB |   4026 MiB |   1334 TiB |   1334 TiB |
|       from small pool |  16481 KiB |     36 MiB |     14 TiB |     14 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4944 MiB |   4966 MiB |  14378 MiB |   9434 MiB |
|       from large pool |   4906 MiB |   4924 MiB |  14306 MiB |   9400 MiB |
|       from small pool |     38 MiB |     42 MiB |     72 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40872 KiB | 396512 KiB | 713310 GiB | 713310 GiB |
|       from large pool |  31733 KiB | 395396 KiB | 697990 GiB | 697990 GiB |
|       from small pool |   9139 KiB |  21453 KiB |  15320 GiB |  15320 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7763    |  176954 K  |  176951 K  |
|       from large pool |      79    |     423    |  120804 K  |  120803 K  |
|       from small pool |    2887    |    7683    |   56150 K  |   56147 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7763    |  176954 K  |  176951 K  |
|       from large pool |      79    |     423    |  120804 K  |  120803 K  |
|       from small pool |    2887    |    7683    |   56150 K  |   56147 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     199    |     204    |     559    |     360    |
|       from large pool |     180    |     183    |     523    |     343    |
|       from small pool |      19    |      21    |      36    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      34    |    3663    |  118369 K  |  118369 K  |
|       from large pool |      11    |     185    |   91316 K  |   91316 K  |
|       from small pool |      23    |    3652    |   27052 K  |   27052 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |   1349 TiB |   1349 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1334 TiB |   1334 TiB |
|       from small pool |      0 KiB |     37 MiB |     14 TiB |     14 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |   1349 TiB |   1349 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1334 TiB |   1334 TiB |
|       from small pool |      0 KiB |     37 MiB |     14 TiB |     14 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |   1349 TiB |   1349 TiB |
|       from large pool |  16640 KiB |   4026 MiB |   1334 TiB |   1334 TiB |
|       from small pool |      0 KiB |     36 MiB |     14 TiB |     14 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   4966 MiB |  14378 MiB |  14146 MiB |
|       from large pool | 210944 KiB |   4924 MiB |  14306 MiB |  14100 MiB |
|       from small pool |  26624 KiB |     42 MiB |     72 MiB |     46 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 396512 KiB | 713310 GiB | 713310 GiB |
|       from large pool |  30464 KiB | 395396 KiB | 697990 GiB | 697990 GiB |
|       from small pool |      0 KiB |  23495 KiB |  15320 GiB |  15320 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7763    |  176954 K  |  176954 K  |
|       from large pool |       2    |     423    |  120804 K  |  120804 K  |
|       from small pool |       0    |    7683    |   56150 K  |   56150 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7763    |  176954 K  |  176954 K  |
|       from large pool |       2    |     423    |  120804 K  |  120804 K  |
|       from small pool |       0    |    7683    |   56150 K  |   56150 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     204    |     559    |     536    |
|       from large pool |      10    |     183    |     523    |     513    |
|       from small pool |      13    |      21    |      36    |      23    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3663    |  118370 K  |  118370 K  |
|       from large pool |       3    |     185    |   91316 K  |   91316 K  |
|       from small pool |       0    |    3652    |   27054 K  |   27054 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 00:55:11 2024]
Finished job 0.
1 of 1 steps (100%) done
