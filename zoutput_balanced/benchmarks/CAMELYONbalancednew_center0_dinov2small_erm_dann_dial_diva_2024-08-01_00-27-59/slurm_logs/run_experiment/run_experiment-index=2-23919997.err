Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 02:20:40 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_02_28_40_seed_0_23919997

 Experiment start at: 2024-08-02 02:28:40.918919
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
before training, model accuracy: 0.9303292036056519
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9585251, 'precision': 0.9592266, 'recall': 0.9585402, 'specificity': 0.9585402, 'f1': 0.9585102, 'auroc': 0.992167, 'binary_precision': 0.9773675, 'binary_recall': 0.93885446, 'binary_specificity': 0.97822595, 'binary_f1_score': 0.957724}
confusion matrix:
       0      1
0  28034    624
1   1755  26947
---- Validation: 
scalar performance:
{'acc': 0.9389634, 'precision': 0.6304888, 'recall': 0.72538257, 'specificity': 0.72538257, 'f1': 0.6626915, 'auroc': 0.8660449, 'binary_precision': 0.27933452, 'binary_recall': 0.496112, 'binary_specificity': 0.95465314, 'binary_f1_score': 0.35742298}
confusion matrix:
       0    1
0  17326  823
1    324  319
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95589644, 'precision': 0.73201066, 'recall': 0.81391084, 'specificity': 0.81391084, 'f1': 0.76581883, 'auroc': 0.9126656, 'binary_precision': 0.47910863, 'binary_recall': 0.65900385, 'binary_specificity': 0.9688178, 'binary_f1_score': 0.5548387}
confusion matrix:
      0    1
0  5810  187
1    89  172
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 03:13:47.880996,epoch time: 0:45:06.962077,used: 0:45:06.962077,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_02_28_40_seed_0_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96929914, 'precision': 0.9695762, 'recall': 0.9693086, 'specificity': 0.9693086, 'f1': 0.969295, 'auroc': 0.9948896, 'binary_precision': 0.9811752, 'binary_recall': 0.95700645, 'binary_specificity': 0.9816107, 'binary_f1_score': 0.96894014}
confusion matrix:
       0      1
0  28131    527
1   1234  27468
---- Validation: 
scalar performance:
{'acc': 0.9240102, 'precision': 0.6130117, 'recall': 0.7543938, 'specificity': 0.7543938, 'f1': 0.64989734, 'auroc': 0.8638152, 'binary_precision': 0.24194609, 'binary_recall': 0.57231724, 'binary_specificity': 0.9364703, 'binary_f1_score': 0.3401109}
confusion matrix:
       0     1
0  16996  1153
1    275   368
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9239374, 'precision': 0.6526117, 'recall': 0.8265531, 'specificity': 0.8265531, 'f1': 0.7002526, 'auroc': 0.9075819, 'binary_precision': 0.3181049, 'binary_recall': 0.7203065, 'binary_specificity': 0.93279976, 'binary_f1_score': 0.44131455}
confusion matrix:
      0    1
0  5594  403
1    73  188
early stop counter: 1
val acc:0.9240102171897888, best validation acc: 0.9389634132385254, corresponding to test acc:                         0.9558964371681213 / 0.9558964371681213
after epoch: 2,now: 2024-08-02 03:58:19.831265,epoch time: 0:44:31.950269,used: 1:29:38.912346,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_02_28_40_seed_0_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.972507, 'precision': 0.9730135, 'recall': 0.97251964, 'specificity': 0.97251964, 'f1': 0.97250015, 'auroc': 0.9962839, 'binary_precision': 0.9886859, 'binary_recall': 0.9559961, 'binary_specificity': 0.9890432, 'binary_f1_score': 0.9720663}
confusion matrix:
       0      1
0  28344    314
1   1263  27439
---- Validation: 
scalar performance:
{'acc': 0.8975628, 'precision': 0.5905459, 'recall': 0.7722039, 'specificity': 0.7722039, 'f1': 0.62173533, 'auroc': 0.85734445, 'binary_precision': 0.19505233, 'binary_recall': 0.63763607, 'binary_specificity': 0.9067717, 'binary_f1_score': 0.29872495}
confusion matrix:
       0     1
0  16457  1692
1    233   410
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8884628, 'precision': 0.6118198, 'recall': 0.8208702, 'specificity': 0.8208702, 'f1': 0.6486889, 'auroc': 0.8954624, 'binary_precision': 0.23579203, 'binary_recall': 0.74712646, 'binary_specificity': 0.894614, 'binary_f1_score': 0.3584559}
confusion matrix:
      0    1
0  5365  632
1    66  195
early stop counter: 2
val acc:0.8975628018379211, best validation acc: 0.9389634132385254, corresponding to test acc:                         0.9558964371681213 / 0.9558964371681213
after epoch: 3,now: 2024-08-02 04:43:07.998340,epoch time: 0:44:48.167075,used: 2:14:27.079421,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_02_28_40_seed_0_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9755753, 'precision': 0.97593826, 'recall': 0.97558653, 'specificity': 0.97558653, 'f1': 0.97557104, 'auroc': 0.99699783, 'binary_precision': 0.98928314, 'binary_recall': 0.9616068, 'binary_specificity': 0.98956627, 'binary_f1_score': 0.97524863}
confusion matrix:
       0      1
0  28358    299
1   1102  27601
---- Validation: 
scalar performance:
{'acc': 0.8969242, 'precision': 0.5920553, 'recall': 0.78087395, 'specificity': 0.78087395, 'f1': 0.6239159, 'auroc': 0.8709575, 'binary_precision': 0.19738074, 'binary_recall': 0.6562986, 'binary_specificity': 0.90544933, 'binary_f1_score': 0.30348796}
confusion matrix:
       0     1
0  16433  1716
1    221   422
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89565355, 'precision': 0.62028, 'recall': 0.83195144, 'specificity': 0.83195144, 'f1': 0.66086555, 'auroc': 0.9023546, 'binary_precision': 0.25189874, 'binary_recall': 0.7624521, 'binary_specificity': 0.90145075, 'binary_f1_score': 0.37868696}
confusion matrix:
      0    1
0  5406  591
1    62  199
early stop counter: 3
val acc:0.8969241976737976, best validation acc: 0.9389634132385254, corresponding to test acc:                         0.9558964371681213 / 0.9558964371681213
after epoch: 4,now: 2024-08-02 05:27:51.125477,epoch time: 0:44:43.127137,used: 2:59:10.206558,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_02_28_40_seed_0_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:59:10.206558 at 2024-08-02 05:27:51.125477
persisted model performance metric: 

scalar performance:
{'acc': 0.95589644, 'precision': 0.73201066, 'recall': 0.81391084, 'specificity': 0.81391084, 'f1': 0.76581883, 'auroc': 0.9126656, 'binary_precision': 0.47910863, 'binary_recall': 0.65900385, 'binary_specificity': 0.9688178, 'binary_f1_score': 0.5548387}
confusion matrix:
      0    1
0  5810  187
1    89  172
oracle model performance metric: 

scalar performance:
{'acc': 0.95589644, 'precision': 0.73201066, 'recall': 0.81391084, 'specificity': 0.81391084, 'f1': 0.76581883, 'auroc': 0.9126656, 'binary_precision': 0.47910863, 'binary_recall': 0.65900385, 'binary_specificity': 0.9688178, 'binary_f1_score': 0.5548387}
confusion matrix:
      0    1
0  5810  187
1    89  172
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1885 MiB |   6623 MiB | 416870 GiB | 416869 GiB |
|       from large pool |   1839 MiB |   6578 MiB | 413219 GiB | 413217 GiB |
|       from small pool |     45 MiB |     86 MiB |   3651 GiB |   3651 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1885 MiB |   6623 MiB | 416870 GiB | 416869 GiB |
|       from large pool |   1839 MiB |   6578 MiB | 413219 GiB | 413217 GiB |
|       from small pool |     45 MiB |     86 MiB |   3651 GiB |   3651 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1883 MiB |   6622 MiB | 416731 GiB | 416729 GiB |
|       from large pool |   1839 MiB |   6577 MiB | 413084 GiB | 413083 GiB |
|       from small pool |     44 MiB |     85 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7240 MiB |   7240 MiB |   7240 MiB |      0 B   |
|       from large pool |   7148 MiB |   7148 MiB |   7148 MiB |      0 B   |
|       from small pool |     92 MiB |     92 MiB |     92 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 437051 KiB | 713010 KiB | 196749 GiB | 196749 GiB |
|       from large pool | 420053 KiB | 708610 KiB | 193083 GiB | 193082 GiB |
|       from small pool |  16998 KiB |  18405 KiB |   3666 GiB |   3666 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3634    |    8301    |   48613 K  |   48610 K  |
|       from large pool |     176    |     456    |   28005 K  |   28004 K  |
|       from small pool |    3458    |    8124    |   20608 K  |   20605 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3634    |    8301    |   48613 K  |   48610 K  |
|       from large pool |     176    |     456    |   28005 K  |   28004 K  |
|       from small pool |    3458    |    8124    |   20608 K  |   20605 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     212    |     212    |     212    |       0    |
|       from large pool |     166    |     166    |     166    |       0    |
|       from small pool |      46    |      46    |      46    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      80    |    3630    |   28987 K  |   28987 K  |
|       from large pool |      36    |     159    |   19785 K  |   19785 K  |
|       from small pool |      44    |    3594    |    9202 K  |    9202 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6623 MiB | 416870 GiB | 416870 GiB |
|       from large pool |  16640 KiB |   6578 MiB | 413219 GiB | 413219 GiB |
|       from small pool |      0 KiB |     86 MiB |   3651 GiB |   3651 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6623 MiB | 416870 GiB | 416870 GiB |
|       from large pool |  16640 KiB |   6578 MiB | 413219 GiB | 413219 GiB |
|       from small pool |      0 KiB |     86 MiB |   3651 GiB |   3651 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6622 MiB | 416731 GiB | 416731 GiB |
|       from large pool |  16640 KiB |   6577 MiB | 413084 GiB | 413084 GiB |
|       from small pool |      0 KiB |     85 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2312 MiB |   7240 MiB |   7240 MiB |   4928 MiB |
|       from large pool |   2250 MiB |   7148 MiB |   7148 MiB |   4898 MiB |
|       from small pool |     62 MiB |     92 MiB |     92 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 713010 KiB | 196750 GiB | 196750 GiB |
|       from large pool |  24320 KiB | 708610 KiB | 193083 GiB | 193083 GiB |
|       from small pool |      0 KiB |  41628 KiB |   3666 GiB |   3666 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   28005 K  |   28005 K  |
|       from small pool |       0    |    8124    |   20608 K  |   20608 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   28005 K  |   28005 K  |
|       from small pool |       0    |    8124    |   20608 K  |   20608 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      72    |     212    |     212    |     140    |
|       from large pool |      41    |     166    |     166    |     125    |
|       from small pool |      31    |      46    |      46    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3630    |   28989 K  |   28989 K  |
|       from large pool |       3    |     159    |   19785 K  |   19785 K  |
|       from small pool |       0    |    3594    |    9204 K  |    9204 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6623 MiB | 416870 GiB | 416870 GiB |
|       from large pool |  16640 KiB |   6578 MiB | 413219 GiB | 413219 GiB |
|       from small pool |      0 KiB |     86 MiB |   3651 GiB |   3651 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6623 MiB | 416870 GiB | 416870 GiB |
|       from large pool |  16640 KiB |   6578 MiB | 413219 GiB | 413219 GiB |
|       from small pool |      0 KiB |     86 MiB |   3651 GiB |   3651 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6622 MiB | 416731 GiB | 416731 GiB |
|       from large pool |  16640 KiB |   6577 MiB | 413084 GiB | 413084 GiB |
|       from small pool |      0 KiB |     85 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2312 MiB |   7240 MiB |   7240 MiB |   4928 MiB |
|       from large pool |   2250 MiB |   7148 MiB |   7148 MiB |   4898 MiB |
|       from small pool |     62 MiB |     92 MiB |     92 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 713010 KiB | 196750 GiB | 196750 GiB |
|       from large pool |  24320 KiB | 708610 KiB | 193083 GiB | 193083 GiB |
|       from small pool |      0 KiB |  41628 KiB |   3666 GiB |   3666 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   28005 K  |   28005 K  |
|       from small pool |       0    |    8124    |   20608 K  |   20608 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   28005 K  |   28005 K  |
|       from small pool |       0    |    8124    |   20608 K  |   20608 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      72    |     212    |     212    |     140    |
|       from large pool |      41    |     166    |     166    |     125    |
|       from small pool |      31    |      46    |      46    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3630    |   28989 K  |   28989 K  |
|       from large pool |       3    |     159    |   19785 K  |   19785 K  |
|       from small pool |       0    |    3594    |    9204 K  |    9204 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_05_35_45_seed_1_23919997

 Experiment start at: 2024-08-02 05:35:46.689081
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
before training, model accuracy: 0.3665807247161865
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9588829, 'precision': 0.9592974, 'recall': 0.958894, 'specificity': 0.958894, 'f1': 0.95887434, 'auroc': 0.99144065, 'binary_precision': 0.9732775, 'binary_recall': 0.9437372, 'binary_specificity': 0.97405076, 'binary_f1_score': 0.9582797}
confusion matrix:
       0      1
0  28040    747
1   1622  27207
---- Validation: 
scalar performance:
{'acc': 0.9322839, 'precision': 0.63575715, 'recall': 0.7710433, 'specificity': 0.7710433, 'f1': 0.67600167, 'auroc': 0.86987865, 'binary_precision': 0.28714284, 'binary_recall': 0.5973254, 'binary_specificity': 0.94476116, 'binary_f1_score': 0.3878437}
confusion matrix:
       0    1
0  17069  998
1    271  402
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9469868, 'precision': 0.7067632, 'recall': 0.8528002, 'specificity': 0.8528002, 'f1': 0.75714177, 'auroc': 0.92232466, 'binary_precision': 0.4248366, 'binary_recall': 0.75, 'binary_specificity': 0.9556004, 'binary_f1_score': 0.54242}
confusion matrix:
      0    1
0  5682  264
1    65  195
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 06:21:06.398104,epoch time: 0:45:19.709023,used: 0:45:19.709023,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_05_35_45_seed_1_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9680471, 'precision': 0.96859896, 'recall': 0.96806026, 'specificity': 0.96806026, 'f1': 0.96803826, 'auroc': 0.9951874, 'binary_precision': 0.984873, 'binary_recall': 0.95074576, 'binary_specificity': 0.9853748, 'binary_f1_score': 0.9675085}
confusion matrix:
       0      1
0  28365    421
1   1420  27410
---- Validation: 
scalar performance:
{'acc': 0.90240127, 'precision': 0.6004044, 'recall': 0.7798645, 'specificity': 0.7798645, 'f1': 0.63512707, 'auroc': 0.8746278, 'binary_precision': 0.21499014, 'binary_recall': 0.64784545, 'binary_specificity': 0.91188353, 'binary_f1_score': 0.32284337}
confusion matrix:
       0     1
0  16475  1592
1    237   436
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9142765, 'precision': 0.64181626, 'recall': 0.8375689, 'specificity': 0.8375689, 'f1': 0.6889666, 'auroc': 0.9132539, 'binary_precision': 0.2951807, 'binary_recall': 0.75384617, 'binary_specificity': 0.92129165, 'binary_f1_score': 0.4242424}
confusion matrix:
      0    1
0  5478  468
1    64  196
early stop counter: 1
val acc:0.9024012684822083, best validation acc: 0.932283878326416, corresponding to test acc:                         0.9469867944717407 / 0.9469867944717407
after epoch: 2,now: 2024-08-02 07:05:48.061285,epoch time: 0:44:41.663181,used: 1:30:01.372204,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_05_35_45_seed_1_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9730457, 'precision': 0.9733602, 'recall': 0.97305566, 'specificity': 0.97305566, 'f1': 0.9730416, 'auroc': 0.99614614, 'binary_precision': 0.9857535, 'binary_recall': 0.96000695, 'binary_specificity': 0.98610437, 'binary_f1_score': 0.97270983}
confusion matrix:
       0      1
0  28386    400
1   1153  27677
---- Validation: 
scalar performance:
{'acc': 0.8860726, 'precision': 0.5927135, 'recall': 0.800722, 'specificity': 0.800722, 'f1': 0.6233788, 'auroc': 0.8801712, 'binary_precision': 0.19743377, 'binary_recall': 0.7087667, 'binary_specificity': 0.89267725, 'binary_f1_score': 0.3088378}
confusion matrix:
       0     1
0  16128  1939
1    196   477
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88108283, 'precision': 0.6090654, 'recall': 0.83128023, 'specificity': 0.83128023, 'f1': 0.64414084, 'auroc': 0.89993465, 'binary_precision': 0.22902495, 'binary_recall': 0.77692306, 'binary_specificity': 0.8856374, 'binary_f1_score': 0.3537653}
confusion matrix:
      0    1
0  5266  680
1    58  202
early stop counter: 2
val acc:0.88607257604599, best validation acc: 0.932283878326416, corresponding to test acc:                         0.9469867944717407 / 0.9469867944717407
after epoch: 3,now: 2024-08-02 07:50:40.010390,epoch time: 0:44:51.949105,used: 2:14:53.321309,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_05_35_45_seed_1_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97580534, 'precision': 0.9759062, 'recall': 0.975811, 'specificity': 0.975811, 'f1': 0.9758042, 'auroc': 0.99665284, 'binary_precision': 0.9830282, 'binary_recall': 0.96836627, 'binary_specificity': 0.98325574, 'binary_f1_score': 0.9756421}
confusion matrix:
       0      1
0  28304    482
1    912  27918
---- Validation: 
scalar performance:
{'acc': 0.87550694, 'precision': 0.5896356, 'recall': 0.8167004, 'specificity': 0.8167004, 'f1': 0.6173038, 'auroc': 0.89317167, 'binary_precision': 0.1896036, 'binary_recall': 0.7533432, 'binary_specificity': 0.8800576, 'binary_f1_score': 0.3029579}
confusion matrix:
       0     1
0  15900  2167
1    166   507
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86513054, 'precision': 0.5974059, 'recall': 0.8229553, 'specificity': 0.8229553, 'f1': 0.6253089, 'auroc': 0.90013456, 'binary_precision': 0.20591234, 'binary_recall': 0.77692306, 'binary_specificity': 0.86898756, 'binary_f1_score': 0.3255439}
confusion matrix:
      0    1
0  5167  779
1    58  202
early stop counter: 3
val acc:0.8755069375038147, best validation acc: 0.932283878326416, corresponding to test acc:                         0.9469867944717407 / 0.9469867944717407
after epoch: 4,now: 2024-08-02 08:35:43.568928,epoch time: 0:45:03.558538,used: 2:59:56.879847,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_05_35_45_seed_1_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:59:56.879847 at 2024-08-02 08:35:43.568928
persisted model performance metric: 

scalar performance:
{'acc': 0.9469868, 'precision': 0.7067632, 'recall': 0.8528002, 'specificity': 0.8528002, 'f1': 0.75714177, 'auroc': 0.92232466, 'binary_precision': 0.4248366, 'binary_recall': 0.75, 'binary_specificity': 0.9556004, 'binary_f1_score': 0.54242}
confusion matrix:
      0    1
0  5682  264
1    65  195
oracle model performance metric: 

scalar performance:
{'acc': 0.9469868, 'precision': 0.7067632, 'recall': 0.8528002, 'specificity': 0.8528002, 'f1': 0.75714177, 'auroc': 0.92232466, 'binary_precision': 0.4248366, 'binary_recall': 0.75, 'binary_specificity': 0.9556004, 'binary_f1_score': 0.54242}
confusion matrix:
      0    1
0  5682  264
1    65  195
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1886 MiB |   6626 MiB |    816 TiB |    816 TiB |
|       from large pool |   1840 MiB |   6581 MiB |    809 TiB |    809 TiB |
|       from small pool |     45 MiB |     86 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   1886 MiB |   6626 MiB |    816 TiB |    816 TiB |
|       from large pool |   1840 MiB |   6581 MiB |    809 TiB |    809 TiB |
|       from small pool |     45 MiB |     86 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1883 MiB |   6622 MiB |    815 TiB |    815 TiB |
|       from large pool |   1839 MiB |   6577 MiB |    808 TiB |    808 TiB |
|       from small pool |     44 MiB |     85 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7560 MiB |   7560 MiB |  12488 MiB |   4928 MiB |
|       from large pool |   7474 MiB |   7474 MiB |  12372 MiB |   4898 MiB |
|       from small pool |     86 MiB |     92 MiB |    116 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 444383 KiB | 767045 KiB | 462460 GiB | 462460 GiB |
|       from large pool | 429421 KiB | 764228 KiB | 455111 GiB | 455111 GiB |
|       from small pool |  14962 KiB |  41628 KiB |   7349 GiB |   7349 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3610    |    8333    |   97399 K  |   97395 K  |
|       from large pool |     176    |     456    |   56119 K  |   56118 K  |
|       from small pool |    3434    |    8156    |   41279 K  |   41276 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3610    |    8333    |   97399 K  |   97395 K  |
|       from large pool |     176    |     456    |   56119 K  |   56118 K  |
|       from small pool |    3434    |    8156    |   41279 K  |   41276 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     175    |     212    |     315    |     140    |
|       from large pool |     132    |     166    |     257    |     125    |
|       from small pool |      43    |      46    |      58    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |    3640    |   57224 K  |   57224 K  |
|       from large pool |      30    |     159    |   38634 K  |   38634 K  |
|       from small pool |      41    |    3610    |   18590 K  |   18590 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6626 MiB |    816 TiB |    816 TiB |
|       from large pool |  16640 KiB |   6581 MiB |    809 TiB |    809 TiB |
|       from small pool |      0 KiB |     86 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6626 MiB |    816 TiB |    816 TiB |
|       from large pool |  16640 KiB |   6581 MiB |    809 TiB |    809 TiB |
|       from small pool |      0 KiB |     86 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6622 MiB |    815 TiB |    815 TiB |
|       from large pool |  16640 KiB |   6577 MiB |    808 TiB |    808 TiB |
|       from small pool |      0 KiB |     85 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2320 MiB |   7560 MiB |  12488 MiB |  10168 MiB |
|       from large pool |   2260 MiB |   7474 MiB |  12372 MiB |  10112 MiB |
|       from small pool |     60 MiB |     92 MiB |    116 MiB |     56 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 767045 KiB | 462460 GiB | 462460 GiB |
|       from large pool |  24320 KiB | 764228 KiB | 455111 GiB | 455111 GiB |
|       from small pool |      0 KiB |  41628 KiB |   7349 GiB |   7349 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   56119 K  |   56119 K  |
|       from small pool |       0    |    8156    |   41279 K  |   41279 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   56119 K  |   56119 K  |
|       from small pool |       0    |    8156    |   41279 K  |   41279 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      68    |     212    |     315    |     247    |
|       from large pool |      38    |     166    |     257    |     219    |
|       from small pool |      30    |      46    |      58    |      28    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3640    |   57226 K  |   57226 K  |
|       from large pool |       3    |     159    |   38634 K  |   38634 K  |
|       from small pool |       0    |    3610    |   18591 K  |   18591 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6626 MiB |    816 TiB |    816 TiB |
|       from large pool |  16640 KiB |   6581 MiB |    809 TiB |    809 TiB |
|       from small pool |      0 KiB |     86 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6626 MiB |    816 TiB |    816 TiB |
|       from large pool |  16640 KiB |   6581 MiB |    809 TiB |    809 TiB |
|       from small pool |      0 KiB |     86 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6622 MiB |    815 TiB |    815 TiB |
|       from large pool |  16640 KiB |   6577 MiB |    808 TiB |    808 TiB |
|       from small pool |      0 KiB |     85 MiB |      7 TiB |      7 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2320 MiB |   7560 MiB |  12488 MiB |  10168 MiB |
|       from large pool |   2260 MiB |   7474 MiB |  12372 MiB |  10112 MiB |
|       from small pool |     60 MiB |     92 MiB |    116 MiB |     56 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 767045 KiB | 462460 GiB | 462460 GiB |
|       from large pool |  24320 KiB | 764228 KiB | 455111 GiB | 455111 GiB |
|       from small pool |      0 KiB |  41628 KiB |   7349 GiB |   7349 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   56119 K  |   56119 K  |
|       from small pool |       0    |    8156    |   41279 K  |   41279 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   56119 K  |   56119 K  |
|       from small pool |       0    |    8156    |   41279 K  |   41279 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      68    |     212    |     315    |     247    |
|       from large pool |      38    |     166    |     257    |     219    |
|       from small pool |      30    |      46    |      58    |      28    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3640    |   57226 K  |   57226 K  |
|       from large pool |       3    |     159    |   38634 K  |   38634 K  |
|       from small pool |       0    |    3610    |   18591 K  |   18591 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_08_43_56_seed_2_23919997

 Experiment start at: 2024-08-02 08:43:56.970676
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
before training, model accuracy: 0.3599936068058014
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9525247, 'precision': 0.95392454, 'recall': 0.9525314, 'specificity': 0.9525314, 'f1': 0.95248866, 'auroc': 0.990692, 'binary_precision': 0.97919166, 'binary_recall': 0.9247231, 'binary_specificity': 0.9803397, 'binary_f1_score': 0.9511783}
confusion matrix:
       0      1
0  28572    573
1   2195  26964
---- Validation: 
scalar performance:
{'acc': 0.9388483, 'precision': 0.61746925, 'recall': 0.7098296, 'specificity': 0.7098296, 'f1': 0.6479179, 'auroc': 0.86620206, 'binary_precision': 0.25316456, 'binary_recall': 0.4651163, 'binary_specificity': 0.95454293, 'binary_f1_score': 0.32786885}
confusion matrix:
       0    1
0  17345  826
1    322  280
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96105146, 'precision': 0.7434241, 'recall': 0.8429308, 'specificity': 0.8429308, 'f1': 0.78349864, 'auroc': 0.9234673, 'binary_precision': 0.4985591, 'binary_recall': 0.71487606, 'binary_specificity': 0.9709855, 'binary_f1_score': 0.5874363}
confusion matrix:
      0    1
0  5823  174
1    69  173
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 09:30:06.115712,epoch time: 0:46:09.145036,used: 0:46:09.145036,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_08_43_56_seed_2_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9670349, 'precision': 0.9672376, 'recall': 0.967037, 'specificity': 0.967037, 'f1': 0.9670314, 'auroc': 0.9942796, 'binary_precision': 0.97702116, 'binary_recall': 0.9565814, 'binary_specificity': 0.97749263, 'binary_f1_score': 0.9666933}
confusion matrix:
       0      1
0  28490    656
1   1266  27892
---- Validation: 
scalar performance:
{'acc': 0.92121667, 'precision': 0.60901046, 'recall': 0.7786174, 'specificity': 0.7786174, 'f1': 0.64788985, 'auroc': 0.88188523, 'binary_precision': 0.23114653, 'binary_recall': 0.62624586, 'binary_specificity': 0.93098897, 'binary_f1_score': 0.33766234}
confusion matrix:
       0     1
0  16917  1254
1    225   377
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94438213, 'precision': 0.6881795, 'recall': 0.8481389, 'specificity': 0.8481389, 'f1': 0.73985726, 'auroc': 0.91890574, 'binary_precision': 0.38709676, 'binary_recall': 0.74380165, 'binary_specificity': 0.95247626, 'binary_f1_score': 0.5091937}
confusion matrix:
      0    1
0  5712  285
1    62  180
early stop counter: 1
val acc:0.9212166666984558, best validation acc: 0.9388483166694641, corresponding to test acc:                         0.9610514640808105 / 0.9610514640808105
after epoch: 2,now: 2024-08-02 10:15:42.708891,epoch time: 0:45:36.593179,used: 1:31:45.738215,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_08_43_56_seed_2_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9705509, 'precision': 0.97055286, 'recall': 0.9705508, 'specificity': 0.9705508, 'f1': 0.9705509, 'auroc': 0.99593425, 'binary_precision': 0.9696379, 'binary_recall': 0.9715334, 'binary_specificity': 0.9695681, 'binary_f1_score': 0.97058475}
confusion matrix:
       0      1
0  28260    887
1    830  28327
---- Validation: 
scalar performance:
{'acc': 0.89895064, 'precision': 0.5915113, 'recall': 0.7952222, 'specificity': 0.7952222, 'f1': 0.6241787, 'auroc': 0.88625336, 'binary_precision': 0.19443133, 'binary_recall': 0.68438536, 'binary_specificity': 0.9060591, 'binary_f1_score': 0.30282983}
confusion matrix:
       0     1
0  16464  1707
1    190   412
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92883474, 'precision': 0.65747035, 'recall': 0.8539307, 'specificity': 0.8539307, 'f1': 0.7095669, 'auroc': 0.915096, 'binary_precision': 0.3246528, 'binary_recall': 0.77272725, 'binary_specificity': 0.93513423, 'binary_f1_score': 0.45721272}
confusion matrix:
      0    1
0  5608  389
1    55  187
early stop counter: 2
val acc:0.8989506363868713, best validation acc: 0.9388483166694641, corresponding to test acc:                         0.9610514640808105 / 0.9610514640808105
after epoch: 3,now: 2024-08-02 11:01:14.301810,epoch time: 0:45:31.592919,used: 2:17:17.331134,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_08_43_56_seed_2_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9745129, 'precision': 0.9746698, 'recall': 0.9745141, 'specificity': 0.9745141, 'f1': 0.9745108, 'auroc': 0.9966993, 'binary_precision': 0.9833357, 'binary_recall': 0.96539307, 'binary_specificity': 0.98363525, 'binary_f1_score': 0.9742817}
confusion matrix:
       0      1
0  28671    477
1   1009  28147
---- Validation: 
scalar performance:
{'acc': 0.9044905, 'precision': 0.59638834, 'recall': 0.7972809, 'specificity': 0.7972809, 'f1': 0.63150525, 'auroc': 0.8890135, 'binary_precision': 0.20417288, 'binary_recall': 0.68272424, 'binary_specificity': 0.9118375, 'binary_f1_score': 0.31434035}
confusion matrix:
       0     1
0  16569  1602
1    191   411
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9264305, 'precision': 0.65009075, 'recall': 0.8368182, 'specificity': 0.8368182, 'f1': 0.69941324, 'auroc': 0.9126828, 'binary_precision': 0.31130436, 'binary_recall': 0.73966944, 'binary_specificity': 0.933967, 'binary_f1_score': 0.43818852}
confusion matrix:
      0    1
0  5601  396
1    63  179
early stop counter: 3
val acc:0.9044904708862305, best validation acc: 0.9388483166694641, corresponding to test acc:                         0.9610514640808105 / 0.9610514640808105
after epoch: 4,now: 2024-08-02 11:46:49.135173,epoch time: 0:45:34.833363,used: 3:02:52.164497,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_08_43_56_seed_2_23919997
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 3:02:52.164497 at 2024-08-02 11:46:49.135173
persisted model performance metric: 

scalar performance:
{'acc': 0.96105146, 'precision': 0.7434241, 'recall': 0.8429308, 'specificity': 0.8429308, 'f1': 0.78349864, 'auroc': 0.9234673, 'binary_precision': 0.4985591, 'binary_recall': 0.71487606, 'binary_specificity': 0.9709855, 'binary_f1_score': 0.5874363}
confusion matrix:
      0    1
0  5823  174
1    69  173
oracle model performance metric: 

scalar performance:
{'acc': 0.96105146, 'precision': 0.7434241, 'recall': 0.8429308, 'specificity': 0.8429308, 'f1': 0.78349864, 'auroc': 0.9234673, 'binary_precision': 0.4985591, 'binary_recall': 0.71487606, 'binary_specificity': 0.9709855, 'binary_f1_score': 0.5874363}
confusion matrix:
      0    1
0  5823  174
1    69  173
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1886 MiB |   6626 MiB |   1229 TiB |   1229 TiB |
|       from large pool |   1840 MiB |   6581 MiB |   1219 TiB |   1219 TiB |
|       from small pool |     45 MiB |     86 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   1886 MiB |   6626 MiB |   1229 TiB |   1229 TiB |
|       from large pool |   1840 MiB |   6581 MiB |   1219 TiB |   1219 TiB |
|       from small pool |     45 MiB |     86 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1883 MiB |   6622 MiB |   1228 TiB |   1228 TiB |
|       from large pool |   1839 MiB |   6577 MiB |   1218 TiB |   1218 TiB |
|       from small pool |     44 MiB |     85 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   7564 MiB |   7564 MiB |  17732 MiB |  10168 MiB |
|       from large pool |   7478 MiB |   7478 MiB |  17590 MiB |  10112 MiB |
|       from small pool |     86 MiB |     92 MiB |    142 MiB |     56 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 432040 KiB | 769211 KiB | 733765 GiB | 733764 GiB |
|       from large pool | 421180 KiB | 766840 KiB | 722693 GiB | 722693 GiB |
|       from small pool |  10860 KiB |  41628 KiB |  11071 GiB |  11071 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3622    |    8419    |  146724 K  |  146720 K  |
|       from large pool |     176    |     456    |   84553 K  |   84553 K  |
|       from small pool |    3446    |    8242    |   62170 K  |   62167 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3622    |    8419    |  146724 K  |  146720 K  |
|       from large pool |     176    |     456    |   84553 K  |   84553 K  |
|       from small pool |    3446    |    8242    |   62170 K  |   62167 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     172    |     212    |     419    |     247    |
|       from large pool |     129    |     166    |     348    |     219    |
|       from small pool |      43    |      46    |      71    |      28    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |    3683    |   84155 K  |   84155 K  |
|       from large pool |      30    |     159    |   56113 K  |   56113 K  |
|       from small pool |      41    |    3653    |   28042 K  |   28041 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6626 MiB |   1229 TiB |   1229 TiB |
|       from large pool |  16640 KiB |   6581 MiB |   1219 TiB |   1219 TiB |
|       from small pool |      0 KiB |     86 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6626 MiB |   1229 TiB |   1229 TiB |
|       from large pool |  16640 KiB |   6581 MiB |   1219 TiB |   1219 TiB |
|       from small pool |      0 KiB |     86 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6622 MiB |   1228 TiB |   1228 TiB |
|       from large pool |  16640 KiB |   6577 MiB |   1218 TiB |   1218 TiB |
|       from small pool |      0 KiB |     85 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2308 MiB |   7564 MiB |  17732 MiB |  15424 MiB |
|       from large pool |   2252 MiB |   7478 MiB |  17590 MiB |  15338 MiB |
|       from small pool |     56 MiB |     92 MiB |    142 MiB |     86 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 769211 KiB | 733765 GiB | 733765 GiB |
|       from large pool |  24320 KiB | 766840 KiB | 722693 GiB | 722693 GiB |
|       from small pool |      0 KiB |  41628 KiB |  11071 GiB |  11071 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8419    |  146724 K  |  146724 K  |
|       from large pool |       2    |     456    |   84553 K  |   84553 K  |
|       from small pool |       0    |    8242    |   62170 K  |   62170 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8419    |  146724 K  |  146724 K  |
|       from large pool |       2    |     456    |   84553 K  |   84553 K  |
|       from small pool |       0    |    8242    |   62170 K  |   62170 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      67    |     212    |     419    |     352    |
|       from large pool |      39    |     166    |     348    |     309    |
|       from small pool |      28    |      46    |      71    |      43    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3683    |   84157 K  |   84157 K  |
|       from large pool |       3    |     159    |   56113 K  |   56113 K  |
|       from small pool |       0    |    3653    |   28043 K  |   28043 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 11:48:18 2024]
Finished job 0.
1 of 1 steps (100%) done
