Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 01:44:33 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/17.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=17
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_01_51_42_seed_0_23919996

 Experiment start at: 2024-08-02 01:51:43.110044
before training, model accuracy: 0.22451263666152954
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9378487, 'precision': 0.94005024, 'recall': 0.9378784, 'specificity': 0.9378784, 'f1': 0.9377737, 'auroc': 0.97668505, 'binary_precision': 0.9713857, 'binary_recall': 0.90238297, 'binary_specificity': 0.97337383, 'binary_f1_score': 0.9356138}
confusion matrix:
       0      1
0  27893    763
1   2802  25902
---- Validation: 
scalar performance:
{'acc': 0.9538633, 'precision': 0.5674306, 'recall': 0.535832, 'specificity': 0.535832, 'f1': 0.54535854, 'auroc': 0.7586919, 'binary_precision': 0.16666667, 'binary_recall': 0.08709176, 'binary_specificity': 0.9845722, 'binary_f1_score': 0.11440246}
confusion matrix:
       0    1
0  17869  280
1    587   56
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9365612, 'precision': 0.5392519, 'recall': 0.52714, 'specificity': 0.52714, 'f1': 0.5313998, 'auroc': 0.7905912, 'binary_precision': 0.11797753, 'binary_recall': 0.08045977, 'binary_specificity': 0.97382027, 'binary_f1_score': 0.09567199}
confusion matrix:
      0    1
0  5840  157
1   240   21
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 02:24:51.239049,epoch time: 0:33:08.129005,used: 0:33:08.129005,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_01_51_42_seed_0_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9545328, 'precision': 0.95617175, 'recall': 0.954558, 'specificity': 0.954558, 'f1': 0.95449364, 'auroc': 0.9868142, 'binary_precision': 0.9837251, 'binary_recall': 0.9244356, 'binary_specificity': 0.98468035, 'binary_f1_score': 0.9531593}
confusion matrix:
       0      1
0  28217    439
1   2169  26535
---- Validation: 
scalar performance:
{'acc': 0.9536505, 'precision': 0.6374243, 'recall': 0.62272817, 'specificity': 0.62272817, 'f1': 0.6295893, 'auroc': 0.823351, 'binary_precision': 0.3006993, 'binary_recall': 0.2674961, 'binary_specificity': 0.9779602, 'binary_f1_score': 0.28312758}
confusion matrix:
       0    1
0  17749  400
1    471  172
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.943752, 'precision': 0.6558038, 'recall': 0.66831696, 'specificity': 0.66831696, 'f1': 0.6617696, 'auroc': 0.84962463, 'binary_precision': 0.3392226, 'binary_recall': 0.3678161, 'binary_specificity': 0.9688178, 'binary_f1_score': 0.3529412}
confusion matrix:
      0    1
0  5810  187
1   165   96
new oracle model saved
early stop counter: 1
val acc:0.9536504745483398, best validation acc: 0.9538633227348328, corresponding to test acc:                         0.9365612268447876 / 0.9437519907951355
after epoch: 2,now: 2024-08-02 02:57:56.470130,epoch time: 0:33:05.231081,used: 1:06:13.360086,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_01_51_42_seed_0_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96253484, 'precision': 0.96337914, 'recall': 0.9625491, 'specificity': 0.9625491, 'f1': 0.9625186, 'auroc': 0.9904417, 'binary_precision': 0.9833248, 'binary_recall': 0.94107807, 'binary_specificity': 0.9840201, 'binary_f1_score': 0.9617377}
confusion matrix:
       0      1
0  28203    458
1   1691  27008
---- Validation: 
scalar performance:
{'acc': 0.9517348, 'precision': 0.64247066, 'recall': 0.65248865, 'specificity': 0.65248865, 'f1': 0.6472799, 'auroc': 0.84156597, 'binary_precision': 0.30869564, 'binary_recall': 0.33125973, 'binary_specificity': 0.9737176, 'binary_f1_score': 0.31957987}
confusion matrix:
       0    1
0  17672  477
1    430  213
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9485459, 'precision': 0.69365567, 'recall': 0.74411154, 'specificity': 0.74411154, 'f1': 0.7154518, 'auroc': 0.8621935, 'binary_precision': 0.4084084, 'binary_recall': 0.5210728, 'binary_specificity': 0.9671503, 'binary_f1_score': 0.45791247}
confusion matrix:
      0    1
0  5800  197
1   125  136
new oracle model saved
early stop counter: 2
val acc:0.9517347812652588, best validation acc: 0.9538633227348328, corresponding to test acc:                         0.9365612268447876 / 0.9485458731651306
after epoch: 3,now: 2024-08-02 03:30:46.707118,epoch time: 0:32:50.236988,used: 1:39:03.597074,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_01_51_42_seed_0_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9676081, 'precision': 0.9679085, 'recall': 0.9676188, 'specificity': 0.9676188, 'f1': 0.96760345, 'auroc': 0.9924792, 'binary_precision': 0.9799757, 'binary_recall': 0.9547798, 'binary_specificity': 0.98045784, 'binary_f1_score': 0.9672137}
confusion matrix:
       0      1
0  28096    560
1   1298  27406
---- Validation: 
scalar performance:
{'acc': 0.9399745, 'precision': 0.63459665, 'recall': 0.7319065, 'specificity': 0.7319065, 'f1': 0.6677484, 'auroc': 0.8572004, 'binary_precision': 0.28709394, 'binary_recall': 0.5085537, 'binary_specificity': 0.95525926, 'binary_f1_score': 0.36700338}
confusion matrix:
       0    1
0  17337  812
1    316  327
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9346437, 'precision': 0.66668814, 'recall': 0.80098957, 'specificity': 0.80098957, 'f1': 0.71031433, 'auroc': 0.87228, 'binary_precision': 0.3489796, 'binary_recall': 0.6551724, 'binary_specificity': 0.9468067, 'binary_f1_score': 0.45539278}
confusion matrix:
      0    1
0  5678  319
1    90  171
early stop counter: 3
val acc:0.9399744868278503, best validation acc: 0.9538633227348328, corresponding to test acc:                         0.9365612268447876 / 0.9485458731651306
after epoch: 4,now: 2024-08-02 04:03:38.114300,epoch time: 0:32:51.407182,used: 2:11:55.004256,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_01_51_42_seed_0_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:11:55.004256 at 2024-08-02 04:03:38.114300
persisted model performance metric: 

scalar performance:
{'acc': 0.9365612, 'precision': 0.5392519, 'recall': 0.52714, 'specificity': 0.52714, 'f1': 0.5313998, 'auroc': 0.7905912, 'binary_precision': 0.11797753, 'binary_recall': 0.08045977, 'binary_specificity': 0.97382027, 'binary_f1_score': 0.09567199}
confusion matrix:
      0    1
0  5840  157
1   240   21
oracle model performance metric: 

scalar performance:
{'acc': 0.9485459, 'precision': 0.69365567, 'recall': 0.74411154, 'specificity': 0.74411154, 'f1': 0.7154518, 'auroc': 0.8621935, 'binary_precision': 0.4084084, 'binary_recall': 0.5210728, 'binary_specificity': 0.9671503, 'binary_f1_score': 0.45791247}
confusion matrix:
      0    1
0  5800  197
1   125  136
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/17.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/17.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/17.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198163 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |  17501 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198163 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool | 180662 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |  17501 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB | 212210 GiB | 212210 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 209643 GiB | 209642 GiB |
|       from small pool |  16482 KiB |     36 MiB |   2567 GiB |   2567 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from large pool |   2330 MiB |   2330 MiB |   2330 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  55789 KiB | 225565 KiB | 114197 GiB | 114197 GiB |
|       from large pool |  50762 KiB | 224940 KiB | 111602 GiB | 111602 GiB |
|       from small pool |   5027 KiB |   9264 KiB |   2595 GiB |   2595 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2998    |    7665    |   32065 K  |   32062 K  |
|       from large pool |      79    |     252    |   19300 K  |   19300 K  |
|       from small pool |    2919    |    7585    |   12765 K  |   12762 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2998    |    7665    |   32065 K  |   32062 K  |
|       from large pool |      79    |     252    |   19300 K  |   19300 K  |
|       from small pool |    2919    |    7585    |   12765 K  |   12762 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     118    |     118    |     118    |       0    |
|       from large pool |      97    |      97    |      97    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      37    |    3601    |   20816 K  |   20816 K  |
|       from large pool |      10    |      97    |   14983 K  |   14983 K  |
|       from small pool |      27    |    3591    |    5832 K  |    5832 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 212210 GiB | 212210 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 209643 GiB | 209643 GiB |
|       from small pool |      0 KiB |     36 MiB |   2567 GiB |   2567 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   2372 MiB |   2372 MiB |   2124 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 114198 GiB | 114198 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 111602 GiB | 111602 GiB |
|       from small pool |      0 KiB |  18592 KiB |   2595 GiB |   2595 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12765 K  |   12765 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12765 K  |   12765 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     118    |     118    |      96    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3601    |   20817 K  |   20817 K  |
|       from large pool |       3    |      97    |   14983 K  |   14983 K  |
|       from small pool |       0    |    3591    |    5833 K  |    5833 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 212231 GiB | 212231 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 209660 GiB | 209660 GiB |
|       from small pool |      0 KiB |     37 MiB |   2571 GiB |   2571 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 212210 GiB | 212210 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 209643 GiB | 209643 GiB |
|       from small pool |      0 KiB |     36 MiB |   2567 GiB |   2567 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 253952 KiB |   2372 MiB |   2372 MiB |   2124 MiB |
|       from large pool | 231424 KiB |   2330 MiB |   2330 MiB |   2104 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 225565 KiB | 114198 GiB | 114198 GiB |
|       from large pool |  30464 KiB | 224940 KiB | 111602 GiB | 111602 GiB |
|       from small pool |      0 KiB |  18592 KiB |   2595 GiB |   2595 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12765 K  |   12765 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   32065 K  |   32065 K  |
|       from large pool |       2    |     252    |   19300 K  |   19300 K  |
|       from small pool |       0    |    7585    |   12765 K  |   12765 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     118    |     118    |      96    |
|       from large pool |      11    |      97    |      97    |      86    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3601    |   20817 K  |   20817 K  |
|       from large pool |       3    |      97    |   14983 K  |   14983 K  |
|       from small pool |       0    |    3591    |    5833 K  |    5833 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996

 Experiment start at: 2024-08-02 04:11:39.649605
before training, model accuracy: 0.6890106797218323
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9424639, 'precision': 0.9443649, 'recall': 0.94248664, 'specificity': 0.94248664, 'f1': 0.9424044, 'auroc': 0.983001, 'binary_precision': 0.9736031, 'binary_recall': 0.9096711, 'binary_specificity': 0.9753022, 'binary_f1_score': 0.940552}
confusion matrix:
       0      1
0  28077    711
1   2604  26224
---- Validation: 
scalar performance:
{'acc': 0.93404484, 'precision': 0.59961605, 'recall': 0.6482153, 'specificity': 0.6482153, 'f1': 0.61791366, 'auroc': 0.8360932, 'binary_precision': 0.22428991, 'binary_recall': 0.34026745, 'binary_specificity': 0.95616317, 'binary_f1_score': 0.27036598}
confusion matrix:
       0    1
0  17275  792
1    444  229
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9427973, 'precision': 0.6710638, 'recall': 0.72740173, 'specificity': 0.72740173, 'f1': 0.6944516, 'auroc': 0.8800622, 'binary_precision': 0.36467236, 'binary_recall': 0.4923077, 'binary_specificity': 0.9624958, 'binary_f1_score': 0.41898525}
confusion matrix:
      0    1
0  5723  223
1   132  128
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 04:44:46.370578,epoch time: 0:33:06.720973,used: 0:33:06.720973,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9558803, 'precision': 0.9569757, 'recall': 0.9558983, 'specificity': 0.9558983, 'f1': 0.955855, 'auroc': 0.9903592, 'binary_precision': 0.97953224, 'binary_recall': 0.9312845, 'binary_specificity': 0.980512, 'binary_f1_score': 0.95479923}
confusion matrix:
       0      1
0  28226    561
1   1981  26848
---- Validation: 
scalar performance:
{'acc': 0.9450907, 'precision': 0.6477326, 'recall': 0.70901954, 'specificity': 0.70901954, 'f1': 0.6721158, 'auroc': 0.87150633, 'binary_precision': 0.3161157, 'binary_recall': 0.45468053, 'binary_specificity': 0.9633586, 'binary_f1_score': 0.3729433}
confusion matrix:
       0    1
0  17405  662
1    367  306
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95246536, 'precision': 0.7189493, 'recall': 0.80968463, 'specificity': 0.80968463, 'f1': 0.75519216, 'auroc': 0.9121268, 'binary_precision': 0.45333335, 'binary_recall': 0.65384614, 'binary_specificity': 0.96552306, 'binary_f1_score': 0.53543305}
confusion matrix:
      0    1
0  5741  205
1    90  170
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 05:17:24.882594,epoch time: 0:32:38.512016,used: 1:05:45.232989,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96337825, 'precision': 0.9637761, 'recall': 0.9633895, 'specificity': 0.9633895, 'f1': 0.96337104, 'auroc': 0.99276817, 'binary_precision': 0.9775522, 'binary_recall': 0.9485952, 'binary_specificity': 0.97818387, 'binary_f1_score': 0.96285605}
confusion matrix:
       0      1
0  28158    628
1   1482  27348
---- Validation: 
scalar performance:
{'acc': 0.9506403, 'precision': 0.6721855, 'recall': 0.7326405, 'specificity': 0.7326405, 'f1': 0.69714296, 'auroc': 0.8793369, 'binary_precision': 0.36334056, 'binary_recall': 0.49777117, 'binary_specificity': 0.9675098, 'binary_f1_score': 0.4200627}
confusion matrix:
       0    1
0  17480  587
1    338  335
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9540767, 'precision': 0.72706205, 'recall': 0.83075434, 'specificity': 0.83075434, 'f1': 0.7676405, 'auroc': 0.9268811, 'binary_precision': 0.46770027, 'binary_recall': 0.6961538, 'binary_specificity': 0.96535486, 'binary_f1_score': 0.5595054}
confusion matrix:
      0    1
0  5740  206
1    79  181
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-02 05:50:00.588222,epoch time: 0:32:35.705628,used: 1:38:20.938617,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9670404, 'precision': 0.9674146, 'recall': 0.96705085, 'specificity': 0.96705085, 'f1': 0.96703434, 'auroc': 0.9939587, 'binary_precision': 0.9808242, 'binary_recall': 0.9527559, 'binary_specificity': 0.9813458, 'binary_f1_score': 0.9665863}
confusion matrix:
       0      1
0  28250    537
1   1362  27467
---- Validation: 
scalar performance:
{'acc': 0.9504803, 'precision': 0.6761274, 'recall': 0.7518697, 'specificity': 0.7518697, 'f1': 0.7061776, 'auroc': 0.88461864, 'binary_precision': 0.36976507, 'binary_recall': 0.53789, 'binary_specificity': 0.96584934, 'binary_f1_score': 0.43825662}
confusion matrix:
       0    1
0  17450  617
1    311  362
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95230424, 'precision': 0.7207828, 'recall': 0.8316684, 'specificity': 0.8316684, 'f1': 0.76316404, 'auroc': 0.92635703, 'binary_precision': 0.455, 'binary_recall': 0.7, 'binary_specificity': 0.9633367, 'binary_f1_score': 0.55151516}
confusion matrix:
      0    1
0  5728  218
1    78  182
early stop counter: 1
val acc:0.9504802823066711, best validation acc: 0.9506403207778931, corresponding to test acc:                         0.9540767073631287 / 0.9540767073631287
after epoch: 4,now: 2024-08-02 06:22:41.573681,epoch time: 0:32:40.985459,used: 2:11:01.924076,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.96792555, 'precision': 0.96815205, 'recall': 0.96793413, 'specificity': 0.96793413, 'f1': 0.9679221, 'auroc': 0.9946052, 'binary_precision': 0.97864187, 'binary_recall': 0.95678115, 'binary_specificity': 0.97908705, 'binary_f1_score': 0.96758807}
confusion matrix:
       0      1
0  28184    602
1   1246  27584
---- Validation: 
scalar performance:
{'acc': 0.9527748, 'precision': 0.6841955, 'recall': 0.75091386, 'specificity': 0.75091386, 'f1': 0.7116213, 'auroc': 0.8846729, 'binary_precision': 0.3860215, 'binary_recall': 0.53343236, 'binary_specificity': 0.9683954, 'binary_f1_score': 0.44791016}
confusion matrix:
       0    1
0  17496  571
1    314  359
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9547212, 'precision': 0.72935355, 'recall': 0.82925177, 'specificity': 0.82925177, 'f1': 0.7688751, 'auroc': 0.92795193, 'binary_precision': 0.47244096, 'binary_recall': 0.6923077, 'binary_specificity': 0.96619576, 'binary_f1_score': 0.5616225}
confusion matrix:
      0    1
0  5745  201
1    80  180
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-08-02 06:55:23.909415,epoch time: 0:32:42.335734,used: 2:43:44.259810,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.971501, 'precision': 0.97176814, 'recall': 0.9715102, 'specificity': 0.9715102, 'f1': 0.9714973, 'auroc': 0.99569404, 'binary_precision': 0.9831876, 'binary_recall': 0.959452, 'binary_specificity': 0.98356843, 'binary_f1_score': 0.9711748}
confusion matrix:
       0      1
0  28313    473
1   1169  27661
---- Validation: 
scalar performance:
{'acc': 0.94951975, 'precision': 0.6721182, 'recall': 0.7485105, 'specificity': 0.7485105, 'f1': 0.70219743, 'auroc': 0.8797467, 'binary_precision': 0.3619818, 'binary_recall': 0.5319465, 'binary_specificity': 0.9650744, 'binary_f1_score': 0.43080625}
confusion matrix:
       0    1
0  17436  631
1    315  358
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95246536, 'precision': 0.72154737, 'recall': 0.83359146, 'specificity': 0.83359146, 'f1': 0.7643012, 'auroc': 0.9302298, 'binary_precision': 0.4563591, 'binary_recall': 0.70384616, 'binary_specificity': 0.9633367, 'binary_f1_score': 0.5537065}
confusion matrix:
      0    1
0  5728  218
1    77  183
early stop counter: 1
val acc:0.9495197534561157, best validation acc: 0.9527748227119446, corresponding to test acc:                         0.954721212387085 / 0.954721212387085
after epoch: 6,now: 2024-08-02 07:28:04.456538,epoch time: 0:32:40.547123,used: 3:16:24.806933,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9728027, 'precision': 0.9729348, 'recall': 0.9728086, 'specificity': 0.9728086, 'f1': 0.9728011, 'auroc': 0.9956268, 'binary_precision': 0.9810142, 'binary_recall': 0.9643055, 'binary_specificity': 0.9813117, 'binary_f1_score': 0.9725881}
confusion matrix:
       0      1
0  28250    538
1   1029  27799
---- Validation: 
scalar performance:
{'acc': 0.9368196, 'precision': 0.6462937, 'recall': 0.7784025, 'specificity': 0.7784025, 'f1': 0.6876093, 'auroc': 0.88390815, 'binary_precision': 0.3077502, 'binary_recall': 0.6077266, 'binary_specificity': 0.94907844, 'binary_f1_score': 0.40859142}
confusion matrix:
       0    1
0  17147  920
1    264  409
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9347406, 'precision': 0.6754854, 'recall': 0.84089243, 'specificity': 0.84089243, 'f1': 0.72592366, 'auroc': 0.9286579, 'binary_precision': 0.36294895, 'binary_recall': 0.73846155, 'binary_specificity': 0.94332325, 'binary_f1_score': 0.486692}
confusion matrix:
      0    1
0  5609  337
1    68  192
early stop counter: 2
val acc:0.9368196129798889, best validation acc: 0.9527748227119446, corresponding to test acc:                         0.954721212387085 / 0.954721212387085
after epoch: 7,now: 2024-08-02 08:00:34.567801,epoch time: 0:32:30.111263,used: 3:48:54.918196,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.97361845, 'precision': 0.97386265, 'recall': 0.97362685, 'specificity': 0.97362685, 'f1': 0.97361535, 'auroc': 0.9957379, 'binary_precision': 0.98480386, 'binary_recall': 0.9621215, 'binary_specificity': 0.98513216, 'binary_f1_score': 0.9733305}
confusion matrix:
       0      1
0  28359    428
1   1092  27737
---- Validation: 
scalar performance:
{'acc': 0.94066167, 'precision': 0.65710783, 'recall': 0.7889783, 'specificity': 0.7889783, 'f1': 0.6998049, 'auroc': 0.8964654, 'binary_precision': 0.3286495, 'binary_recall': 0.6255572, 'binary_specificity': 0.9523994, 'binary_f1_score': 0.43091094}
confusion matrix:
       0    1
0  17207  860
1    252  421
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9349017, 'precision': 0.675485, 'recall': 0.8391375, 'specificity': 0.8391375, 'f1': 0.7256277, 'auroc': 0.9270823, 'binary_precision': 0.36311787, 'binary_recall': 0.7346154, 'binary_specificity': 0.9436596, 'binary_f1_score': 0.4860051}
confusion matrix:
      0    1
0  5611  335
1    69  191
early stop counter: 3
val acc:0.9406616687774658, best validation acc: 0.9527748227119446, corresponding to test acc:                         0.954721212387085 / 0.954721212387085
after epoch: 8,now: 2024-08-02 08:33:21.932311,epoch time: 0:32:47.364510,used: 4:21:42.282706,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_04_11_39_seed_1_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 4:21:42.282706 at 2024-08-02 08:33:21.932311
persisted model performance metric: 

scalar performance:
{'acc': 0.9547212, 'precision': 0.72935355, 'recall': 0.82925177, 'specificity': 0.82925177, 'f1': 0.7688751, 'auroc': 0.92795193, 'binary_precision': 0.47244096, 'binary_recall': 0.6923077, 'binary_specificity': 0.96619576, 'binary_f1_score': 0.5616225}
confusion matrix:
      0    1
0  5745  201
1    80  180
oracle model performance metric: 

scalar performance:
{'acc': 0.9547212, 'precision': 0.72935355, 'recall': 0.82925177, 'specificity': 0.82925177, 'f1': 0.7688751, 'auroc': 0.92795193, 'binary_precision': 0.47244096, 'binary_recall': 0.6923077, 'binary_specificity': 0.96619576, 'binary_f1_score': 0.5616225}
confusion matrix:
      0    1
0  5745  201
1    80  180
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/17.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/17.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196700 KiB |   2142 MiB | 635461 GiB | 635461 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 627791 GiB | 627791 GiB |
|       from small pool |  17489 KiB |     37 MiB |   7670 GiB |   7670 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 196700 KiB |   2142 MiB | 635461 GiB | 635461 GiB |
|       from large pool | 179211 KiB |   2124 MiB | 627791 GiB | 627791 GiB |
|       from small pool |  17489 KiB |     37 MiB |   7670 GiB |   7670 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   2141 MiB | 635383 GiB | 635383 GiB |
|       from large pool | 178979 KiB |   2123 MiB | 627725 GiB | 627724 GiB |
|       from small pool |  16480 KiB |     36 MiB |   7658 GiB |   7658 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2356 MiB |   2372 MiB |   4480 MiB |   2124 MiB |
|       from large pool |   2318 MiB |   2330 MiB |   4422 MiB |   2104 MiB |
|       from small pool |     38 MiB |     42 MiB |     58 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  36772 KiB | 234798 KiB | 343702 GiB | 343702 GiB |
|       from large pool |  31733 KiB | 232384 KiB | 335984 GiB | 335984 GiB |
|       from small pool |   5039 KiB |  18592 KiB |   7717 GiB |   7717 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2974    |    7697    |   95762 K  |   95759 K  |
|       from large pool |      79    |     252    |   57769 K  |   57769 K  |
|       from small pool |    2895    |    7617    |   37992 K  |   37989 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2974    |    7697    |   95762 K  |   95759 K  |
|       from large pool |      79    |     252    |   57769 K  |   57769 K  |
|       from small pool |    2895    |    7617    |   37992 K  |   37989 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     212    |      96    |
|       from large pool |      97    |      97    |     183    |      86    |
|       from small pool |      19    |      21    |      29    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    3619    |   60907 K  |   60907 K  |
|       from large pool |      11    |     101    |   44097 K  |   44097 K  |
|       from small pool |      28    |    3608    |   16809 K  |   16809 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 635461 GiB | 635461 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 627791 GiB | 627791 GiB |
|       from small pool |      0 KiB |     37 MiB |   7670 GiB |   7670 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 635461 GiB | 635461 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 627791 GiB | 627791 GiB |
|       from small pool |      0 KiB |     37 MiB |   7670 GiB |   7670 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 635383 GiB | 635383 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 627725 GiB | 627725 GiB |
|       from small pool |      0 KiB |     36 MiB |   7658 GiB |   7658 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 233472 KiB |   2372 MiB |   4480 MiB |   4252 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4422 MiB |   4216 MiB |
|       from small pool |  22528 KiB |     42 MiB |     58 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 343702 GiB | 343702 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 335984 GiB | 335984 GiB |
|       from small pool |      0 KiB |  19186 KiB |   7717 GiB |   7717 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   95762 K  |   95762 K  |
|       from large pool |       2    |     252    |   57769 K  |   57769 K  |
|       from small pool |       0    |    7617    |   37992 K  |   37992 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   95762 K  |   95762 K  |
|       from large pool |       2    |     252    |   57769 K  |   57769 K  |
|       from small pool |       0    |    7617    |   37992 K  |   37992 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     118    |     212    |     191    |
|       from large pool |      10    |      97    |     183    |     173    |
|       from small pool |      11    |      21    |      29    |      18    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   60908 K  |   60908 K  |
|       from large pool |       3    |     101    |   44097 K  |   44097 K  |
|       from small pool |       0    |    3608    |   16810 K  |   16810 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB | 635461 GiB | 635461 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 627791 GiB | 627791 GiB |
|       from small pool |      0 KiB |     37 MiB |   7670 GiB |   7670 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB | 635461 GiB | 635461 GiB |
|       from large pool |  16640 KiB |   2124 MiB | 627791 GiB | 627791 GiB |
|       from small pool |      0 KiB |     37 MiB |   7670 GiB |   7670 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB | 635383 GiB | 635383 GiB |
|       from large pool |  16640 KiB |   2123 MiB | 627725 GiB | 627725 GiB |
|       from small pool |      0 KiB |     36 MiB |   7658 GiB |   7658 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 233472 KiB |   2372 MiB |   4480 MiB |   4252 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   4422 MiB |   4216 MiB |
|       from small pool |  22528 KiB |     42 MiB |     58 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 343702 GiB | 343702 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 335984 GiB | 335984 GiB |
|       from small pool |      0 KiB |  19186 KiB |   7717 GiB |   7717 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7697    |   95762 K  |   95762 K  |
|       from large pool |       2    |     252    |   57769 K  |   57769 K  |
|       from small pool |       0    |    7617    |   37992 K  |   37992 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7697    |   95762 K  |   95762 K  |
|       from large pool |       2    |     252    |   57769 K  |   57769 K  |
|       from small pool |       0    |    7617    |   37992 K  |   37992 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     118    |     212    |     191    |
|       from large pool |      10    |      97    |     183    |     173    |
|       from small pool |      11    |      21    |      29    |      18    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3619    |   60908 K  |   60908 K  |
|       from large pool |       3    |     101    |   44097 K  |   44097 K  |
|       from small pool |       0    |    3608    |   16810 K  |   16810 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_41_18_seed_2_23919996

 Experiment start at: 2024-08-02 08:41:18.553458
before training, model accuracy: 0.10803013294935226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.91624933, 'precision': 0.92350036, 'recall': 0.91626275, 'specificity': 0.91626275, 'f1': 0.91589105, 'auroc': 0.9567597, 'binary_precision': 0.9789669, 'binary_recall': 0.8508128, 'binary_specificity': 0.98171276, 'binary_f1_score': 0.91040206}
confusion matrix:
       0      1
0  28613    533
1   4350  24808
---- Validation: 
scalar performance:
{'acc': 0.96580195, 'precision': 0.61543524, 'recall': 0.5165664, 'specificity': 0.5165664, 'f1': 0.5233613, 'auroc': 0.58757603, 'binary_precision': 0.26190478, 'binary_recall': 0.036544852, 'binary_specificity': 0.996588, 'binary_f1_score': 0.06413994}
confusion matrix:
       0   1
0  18109  62
1    580  22
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95688415, 'precision': 0.5129281, 'recall': 0.50171435, 'specificity': 0.50171435, 'f1': 0.4963059, 'auroc': 0.5541755, 'binary_precision': 0.06451613, 'binary_recall': 0.008264462, 'binary_specificity': 0.9951643, 'binary_f1_score': 0.014652016}
confusion matrix:
      0   1
0  5968  29
1   240   2
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 09:14:32.972492,epoch time: 0:33:14.419034,used: 0:33:14.419034,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_41_18_seed_2_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.94298846, 'precision': 0.9449221, 'recall': 0.9429941, 'specificity': 0.9429941, 'f1': 0.942927, 'auroc': 0.97573626, 'binary_precision': 0.9742959, 'binary_recall': 0.91000444, 'binary_specificity': 0.9759838, 'binary_f1_score': 0.9410534}
confusion matrix:
       0      1
0  28447    700
1   2624  26533
---- Validation: 
scalar performance:
{'acc': 0.96649444, 'precision': 0.670635, 'recall': 0.53057593, 'specificity': 0.53057593, 'f1': 0.5466255, 'auroc': 0.7033173, 'binary_precision': 0.37142858, 'binary_recall': 0.06478405, 'binary_specificity': 0.9963678, 'binary_f1_score': 0.110325314}
confusion matrix:
       0   1
0  18105  66
1    563  39
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9586472, 'precision': 0.6484144, 'recall': 0.53038985, 'specificity': 0.53038985, 'f1': 0.5445882, 'auroc': 0.709682, 'binary_precision': 0.33333334, 'binary_recall': 0.0661157, 'binary_specificity': 0.994664, 'binary_f1_score': 0.11034483}
confusion matrix:
      0   1
0  5965  32
1   226  16
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 09:47:27.961236,epoch time: 0:32:54.988744,used: 1:06:09.407778,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_41_18_seed_2_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.95080954, 'precision': 0.9531856, 'recall': 0.95081824, 'specificity': 0.95081824, 'f1': 0.95074564, 'auroc': 0.98248285, 'binary_precision': 0.98606026, 'binary_recall': 0.9145718, 'binary_specificity': 0.98706466, 'binary_f1_score': 0.94897157}
confusion matrix:
       0      1
0  28768    377
1   2491  26668
---- Validation: 
scalar performance:
{'acc': 0.96516275, 'precision': 0.6672379, 'recall': 0.5539795, 'specificity': 0.5539795, 'f1': 0.5782242, 'auroc': 0.77294695, 'binary_precision': 0.3631579, 'binary_recall': 0.114617944, 'binary_specificity': 0.993341, 'binary_f1_score': 0.17424244}
confusion matrix:
       0    1
0  18050  121
1    533   69
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96057063, 'precision': 0.7266315, 'recall': 0.61466545, 'specificity': 0.61466545, 'f1': 0.6500692, 'auroc': 0.8171159, 'binary_precision': 0.48333332, 'binary_recall': 0.23966943, 'binary_specificity': 0.9896615, 'binary_f1_score': 0.320442}
confusion matrix:
      0   1
0  5935  62
1   184  58
new oracle model saved
early stop counter: 1
val acc:0.9651627540588379, best validation acc: 0.9664944410324097, corresponding to test acc:                         0.9586471915245056 / 0.9605706334114075
after epoch: 3,now: 2024-08-02 10:20:26.506305,epoch time: 0:32:58.545069,used: 1:39:07.952847,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_41_18_seed_2_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.96152925, 'precision': 0.96247137, 'recall': 0.9615346, 'specificity': 0.9615346, 'f1': 0.96150994, 'auroc': 0.98710465, 'binary_precision': 0.9834052, 'binary_recall': 0.9389211, 'binary_specificity': 0.9841482, 'binary_f1_score': 0.9606484}
confusion matrix:
       0      1
0  28683    462
1   1781  27378
---- Validation: 
scalar performance:
{'acc': 0.9653758, 'precision': 0.7008909, 'recall': 0.611106, 'specificity': 0.611106, 'f1': 0.64166176, 'auroc': 0.81800795, 'binary_precision': 0.42682928, 'binary_recall': 0.23255815, 'binary_specificity': 0.9896538, 'binary_f1_score': 0.30107528}
confusion matrix:
       0    1
0  17983  188
1    462  140
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.738322, 'recall': 0.7002568, 'specificity': 0.7002568, 'f1': 0.7174226, 'auroc': 0.8624933, 'binary_precision': 0.5, 'binary_recall': 0.41735536, 'binary_specificity': 0.98315823, 'binary_f1_score': 0.45495495}
confusion matrix:
      0    1
0  5896  101
1   141  101
new oracle model saved
early stop counter: 2
val acc:0.9653757810592651, best validation acc: 0.9664944410324097, corresponding to test acc:                         0.9586471915245056 / 0.9612117409706116
after epoch: 4,now: 2024-08-02 10:53:34.739811,epoch time: 0:33:08.233506,used: 2:12:16.186353,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_41_18_seed_2_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9640848, 'precision': 0.9648147, 'recall': 0.9640889, 'specificity': 0.9640889, 'f1': 0.964071, 'auroc': 0.9898405, 'binary_precision': 0.9832857, 'binary_recall': 0.94423485, 'binary_specificity': 0.9839429, 'binary_f1_score': 0.9633648}
confusion matrix:
       0      1
0  28678    468
1   1626  27532
---- Validation: 
scalar performance:
{'acc': 0.9632984, 'precision': 0.69656503, 'recall': 0.6670493, 'specificity': 0.6670493, 'f1': 0.68046373, 'auroc': 0.85281885, 'binary_precision': 0.41453832, 'binary_recall': 0.35049835, 'binary_specificity': 0.98360026, 'binary_f1_score': 0.37983796}
confusion matrix:
       0    1
0  17873  298
1    391  211
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9584869, 'precision': 0.7252642, 'recall': 0.75633895, 'specificity': 0.75633895, 'f1': 0.73965305, 'auroc': 0.88581717, 'binary_precision': 0.46931407, 'binary_recall': 0.5371901, 'binary_specificity': 0.97548777, 'binary_f1_score': 0.5009634}
confusion matrix:
      0    1
0  5850  147
1   112  130
early stop counter: 3
val acc:0.9632983803749084, best validation acc: 0.9664944410324097, corresponding to test acc:                         0.9586471915245056 / 0.9612117409706116
after epoch: 5,now: 2024-08-02 11:27:24.155776,epoch time: 0:33:49.415965,used: 2:46:05.602318,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_02_08_41_18_seed_2_23919996
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:46:05.602318 at 2024-08-02 11:27:24.155776
persisted model performance metric: 

scalar performance:
{'acc': 0.9586472, 'precision': 0.6484144, 'recall': 0.53038985, 'specificity': 0.53038985, 'f1': 0.5445882, 'auroc': 0.709682, 'binary_precision': 0.33333334, 'binary_recall': 0.0661157, 'binary_specificity': 0.994664, 'binary_f1_score': 0.11034483}
confusion matrix:
      0   1
0  5965  32
1   226  16
oracle model performance metric: 

scalar performance:
{'acc': 0.96121174, 'precision': 0.738322, 'recall': 0.7002568, 'specificity': 0.7002568, 'f1': 0.7174226, 'auroc': 0.8624933, 'binary_precision': 0.5, 'binary_recall': 0.41735536, 'binary_specificity': 0.98315823, 'binary_f1_score': 0.45495495}
confusion matrix:
      0    1
0  5896  101
1   141  101
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/17.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/17.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196706 KiB |   2142 MiB |    882 TiB |    882 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |  17495 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196706 KiB |   2142 MiB |    882 TiB |    882 TiB |
|       from large pool | 179211 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |  17495 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   2141 MiB |    882 TiB |    882 TiB |
|       from large pool | 178979 KiB |   2123 MiB |    872 TiB |    872 TiB |
|       from small pool |  16482 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2356 MiB |   2372 MiB |   6608 MiB |   4252 MiB |
|       from large pool |   2318 MiB |   2330 MiB |   6534 MiB |   4216 MiB |
|       from small pool |     38 MiB |     42 MiB |     74 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40862 KiB | 234798 KiB | 489418 GiB | 489418 GiB |
|       from large pool |  31733 KiB | 232384 KiB | 478434 GiB | 478434 GiB |
|       from small pool |   9129 KiB |  19186 KiB |  10984 GiB |  10984 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2986    |    7783    |  136237 K  |  136234 K  |
|       from large pool |      79    |     252    |   82184 K  |   82184 K  |
|       from small pool |    2907    |    7703    |   54052 K  |   54049 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2986    |    7783    |  136237 K  |  136234 K  |
|       from large pool |      79    |     252    |   82184 K  |   82184 K  |
|       from small pool |    2907    |    7703    |   54052 K  |   54049 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     116    |     118    |     307    |     191    |
|       from large pool |      97    |      97    |     270    |     173    |
|       from small pool |      19    |      21    |      37    |      18    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      43    |    3660    |   86661 K  |   86660 K  |
|       from large pool |      11    |     101    |   62567 K  |   62567 K  |
|       from small pool |      32    |    3649    |   24093 K  |   24093 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2142 MiB |    882 TiB |    882 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |      0 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2142 MiB |    882 TiB |    882 TiB |
|       from large pool |  16640 KiB |   2124 MiB |    872 TiB |    872 TiB |
|       from small pool |      0 KiB |     37 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   2141 MiB |    882 TiB |    882 TiB |
|       from large pool |  16640 KiB |   2123 MiB |    872 TiB |    872 TiB |
|       from small pool |      0 KiB |     36 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   2372 MiB |   6608 MiB |   6376 MiB |
|       from large pool | 210944 KiB |   2330 MiB |   6534 MiB |   6328 MiB |
|       from small pool |  26624 KiB |     42 MiB |     74 MiB |     48 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 234798 KiB | 489418 GiB | 489418 GiB |
|       from large pool |  30464 KiB | 232384 KiB | 478434 GiB | 478434 GiB |
|       from small pool |      0 KiB |  23486 KiB |  10984 GiB |  10984 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7783    |  136237 K  |  136237 K  |
|       from large pool |       2    |     252    |   82184 K  |   82184 K  |
|       from small pool |       0    |    7703    |   54052 K  |   54052 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7783    |  136237 K  |  136237 K  |
|       from large pool |       2    |     252    |   82184 K  |   82184 K  |
|       from small pool |       0    |    7703    |   54052 K  |   54052 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     118    |     307    |     284    |
|       from large pool |      10    |      97    |     270    |     260    |
|       from small pool |      13    |      21    |      37    |      24    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3660    |   86662 K  |   86662 K  |
|       from large pool |       3    |     101    |   62567 K  |   62567 K  |
|       from small pool |       0    |    3649    |   24094 K  |   24094 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 11:28:48 2024]
Finished job 0.
1 of 1 steps (100%) done
