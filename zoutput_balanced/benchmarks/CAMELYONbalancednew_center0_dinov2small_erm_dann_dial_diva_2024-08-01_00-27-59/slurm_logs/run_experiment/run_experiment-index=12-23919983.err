Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 09:36:18 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/12.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=12
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983

 Experiment start at: 2024-08-01 09:46:34.431768
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9484833, 'precision': 0.95027506, 'recall': 0.94850755, 'specificity': 0.94850755, 'f1': 0.9484339, 'auroc': 0.9863997, 'binary_precision': 0.9788714, 'binary_recall': 0.91683507, 'binary_specificity': 0.98018, 'binary_f1_score': 0.9468382}
confusion matrix:
       0      1
0  28090    568
1   2387  26315
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9145381, 'precision': 0.6016112, 'recall': 0.75474036, 'specificity': 0.75474036, 'f1': 0.6363737, 'auroc': 0.8754183, 'binary_precision': 0.21891418, 'binary_recall': 0.58320373, 'binary_specificity': 0.9262769, 'binary_f1_score': 0.31833616}
confusion matrix:
       0     1
0  16811  1338
1    268   375
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9125919, 'precision': 0.6433785, 'recall': 0.85728014, 'specificity': 0.85728014, 'f1': 0.69231814, 'auroc': 0.91359985, 'binary_precision': 0.2962963, 'binary_recall': 0.79693484, 'binary_specificity': 0.9176255, 'binary_f1_score': 0.43198335}
confusion matrix:
      0    1
0  5503  494
1    53  208
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 10:32:33.815569,epoch time: 0:45:59.383801,used: 0:45:59.383801,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96185493, 'precision': 0.9627234, 'recall': 0.961874, 'specificity': 0.961874, 'f1': 0.9618381, 'auroc': 0.99206674, 'binary_precision': 0.9829879, 'binary_recall': 0.9400453, 'binary_specificity': 0.98370266, 'binary_f1_score': 0.9610371}
confusion matrix:
       0      1
0  28188    467
1   1721  26984
---- Validation: 
scalar performance:
{'acc': 0.9194338, 'precision': 0.61369175, 'recall': 0.78052664, 'specificity': 0.78052664, 'f1': 0.65307826, 'auroc': 0.8889519, 'binary_precision': 0.24123588, 'binary_recall': 0.63141525, 'binary_specificity': 0.92963797, 'binary_f1_score': 0.34909716}
confusion matrix:
       0     1
0  16872  1277
1    237   406
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89693195, 'precision': 0.62630785, 'recall': 0.8546064, 'specificity': 0.8546064, 'f1': 0.66958237, 'auroc': 0.9224862, 'binary_precision': 0.2617866, 'binary_recall': 0.8084291, 'binary_specificity': 0.9007837, 'binary_f1_score': 0.39550143}
confusion matrix:
      0    1
0  5402  595
1    50  211
better model found
persisted
after epoch: 2,now: 2024-08-01 11:17:59.481016,epoch time: 0:45:25.665447,used: 1:31:25.049248,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97038007, 'precision': 0.97082245, 'recall': 0.97039354, 'specificity': 0.97039354, 'f1': 0.9703737, 'auroc': 0.99477684, 'binary_precision': 0.98547494, 'binary_recall': 0.9548859, 'binary_specificity': 0.98590124, 'binary_f1_score': 0.96993935}
confusion matrix:
       0      1
0  28251    404
1   1295  27410
---- Validation: 
scalar performance:
{'acc': 0.9231056, 'precision': 0.6194211, 'recall': 0.78467774, 'specificity': 0.78467774, 'f1': 0.6602783, 'auroc': 0.88746285, 'binary_precision': 0.25246912, 'binary_recall': 0.63608086, 'binary_specificity': 0.93327457, 'binary_f1_score': 0.36146706}
confusion matrix:
       0     1
0  16938  1211
1    234   409
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9002876, 'precision': 0.6294421, 'recall': 0.85452497, 'specificity': 0.85452497, 'f1': 0.67395276, 'auroc': 0.9252321, 'binary_precision': 0.26819924, 'binary_recall': 0.8045977, 'binary_specificity': 0.9044522, 'binary_f1_score': 0.40229884}
confusion matrix:
      0    1
0  5424  573
1    51  210
better model found
persisted
after epoch: 3,now: 2024-08-01 12:02:39.616835,epoch time: 0:44:40.135819,used: 2:16:05.185067,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9747385, 'precision': 0.97501826, 'recall': 0.9747484, 'specificity': 0.9747484, 'f1': 0.97473514, 'auroc': 0.99585545, 'binary_precision': 0.9867481, 'binary_recall': 0.96244293, 'binary_specificity': 0.98705375, 'binary_f1_score': 0.974444}
confusion matrix:
       0      1
0  28286    371
1   1078  27625
---- Validation: 
scalar performance:
{'acc': 0.93002343, 'precision': 0.6223766, 'recall': 0.75600684, 'specificity': 0.75600684, 'f1': 0.66029644, 'auroc': 0.8807096, 'binary_precision': 0.26068377, 'binary_recall': 0.56920683, 'binary_specificity': 0.9428068, 'binary_f1_score': 0.35759652}
confusion matrix:
       0     1
0  17111  1038
1    277   366
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9146692, 'precision': 0.64351547, 'recall': 0.8455377, 'specificity': 0.8455377, 'f1': 0.69168663, 'auroc': 0.91825986, 'binary_precision': 0.29777777, 'binary_recall': 0.77011496, 'binary_specificity': 0.9209605, 'binary_f1_score': 0.42948717}
confusion matrix:
      0    1
0  5523  474
1    60  201
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-08-01 12:47:50.862170,epoch time: 0:45:11.245335,used: 3:01:16.430402,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9778243, 'precision': 0.97792935, 'recall': 0.97783005, 'specificity': 0.97783005, 'f1': 0.9778232, 'auroc': 0.9965831, 'binary_precision': 0.9852119, 'binary_recall': 0.97024596, 'binary_specificity': 0.9854142, 'binary_f1_score': 0.9776716}
confusion matrix:
       0      1
0  28240    418
1    854  27848
---- Validation: 
scalar performance:
{'acc': 0.9111856, 'precision': 0.60804385, 'recall': 0.79575783, 'specificity': 0.79575783, 'f1': 0.6467406, 'auroc': 0.8908079, 'binary_precision': 0.22857143, 'binary_recall': 0.6718507, 'binary_specificity': 0.919665, 'binary_f1_score': 0.3410975}
confusion matrix:
       0     1
0  16691  1458
1    211   432
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90651965, 'precision': 0.6341868, 'recall': 0.84678257, 'specificity': 0.84678257, 'f1': 0.680054, 'auroc': 0.9219488, 'binary_precision': 0.27868852, 'binary_recall': 0.7816092, 'binary_specificity': 0.91195595, 'binary_f1_score': 0.4108761}
confusion matrix:
      0    1
0  5469  528
1    57  204
early stop counter: 1
val acc:0.911185622215271, best validation acc: 0.9300234317779541, corresponding to test acc:                         0.9146692156791687 / 0.9146692156791687
after epoch: 5,now: 2024-08-01 13:33:41.931082,epoch time: 0:45:51.068912,used: 3:47:07.499314,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9794979, 'precision': 0.9796729, 'recall': 0.9795064, 'specificity': 0.9795064, 'f1': 0.97949636, 'auroc': 0.99708074, 'binary_precision': 0.98905665, 'binary_recall': 0.9697614, 'binary_specificity': 0.98925143, 'binary_f1_score': 0.979314}
confusion matrix:
       0      1
0  28347    308
1    868  27837
---- Validation: 
scalar performance:
{'acc': 0.9281609, 'precision': 0.6177885, 'recall': 0.74979216, 'specificity': 0.74979216, 'f1': 0.65459216, 'auroc': 0.8782863, 'binary_precision': 0.25192982, 'binary_recall': 0.55832034, 'binary_specificity': 0.941264, 'binary_f1_score': 0.34719536}
confusion matrix:
       0     1
0  17083  1066
1    284   359
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9303292, 'precision': 0.66712874, 'recall': 0.8445468, 'specificity': 0.8445468, 'f1': 0.71806335, 'auroc': 0.92051697, 'binary_precision': 0.34567901, 'binary_recall': 0.75095785, 'binary_specificity': 0.93813574, 'binary_f1_score': 0.47342992}
confusion matrix:
      0    1
0  5626  371
1    65  196
new oracle model saved
early stop counter: 2
val acc:0.9281609058380127, best validation acc: 0.9300234317779541, corresponding to test acc:                         0.9146692156791687 / 0.9303292036056519
after epoch: 6,now: 2024-08-01 14:22:20.192385,epoch time: 0:48:38.261303,used: 4:35:45.760617,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.98096234, 'precision': 0.98102194, 'recall': 0.98096675, 'specificity': 0.98096675, 'f1': 0.9809619, 'auroc': 0.9973265, 'binary_precision': 0.98657125, 'binary_recall': 0.9752282, 'binary_specificity': 0.9867053, 'binary_f1_score': 0.98086697}
confusion matrix:
       0      1
0  28277    381
1    711  27991
---- Validation: 
scalar performance:
{'acc': 0.9059174, 'precision': 0.60231864, 'recall': 0.7930304, 'specificity': 0.7930304, 'f1': 0.6388419, 'auroc': 0.891207, 'binary_precision': 0.21719457, 'binary_recall': 0.6718507, 'binary_specificity': 0.91421014, 'binary_f1_score': 0.32826748}
confusion matrix:
       0     1
0  16592  1557
1    211   432
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9092362, 'precision': 0.63673526, 'recall': 0.8445353, 'specificity': 0.8445353, 'f1': 0.6832174, 'auroc': 0.9193716, 'binary_precision': 0.28410688, 'binary_recall': 0.77394634, 'binary_specificity': 0.91512424, 'binary_f1_score': 0.41563785}
confusion matrix:
      0    1
0  5488  509
1    59  202
early stop counter: 3
val acc:0.9059174060821533, best validation acc: 0.9300234317779541, corresponding to test acc:                         0.9146692156791687 / 0.9303292036056519
after epoch: 7,now: 2024-08-01 15:08:43.743599,epoch time: 0:46:23.551214,used: 5:22:09.311831,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_09_46_34_seed_0_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 5:22:09.311831 at 2024-08-01 15:08:43.743599
persisted model performance metric: 

scalar performance:
{'acc': 0.9146692, 'precision': 0.64351547, 'recall': 0.8455377, 'specificity': 0.8455377, 'f1': 0.69168663, 'auroc': 0.91825986, 'binary_precision': 0.29777777, 'binary_recall': 0.77011496, 'binary_specificity': 0.9209605, 'binary_f1_score': 0.42948717}
confusion matrix:
      0    1
0  5523  474
1    60  201
oracle model performance metric: 

scalar performance:
{'acc': 0.9303292, 'precision': 0.66712874, 'recall': 0.8445468, 'specificity': 0.8445468, 'f1': 0.71806335, 'auroc': 0.92051697, 'binary_precision': 0.34567901, 'binary_recall': 0.75095785, 'binary_specificity': 0.93813574, 'binary_f1_score': 0.47342992}
confusion matrix:
      0    1
0  5626  371
1    65  196
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/12.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198153 KiB |   4047 MiB | 737073 GiB | 737073 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 728978 GiB | 728978 GiB |
|       from small pool |  17491 KiB |     37 MiB |   8094 GiB |   8094 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198153 KiB |   4047 MiB | 737073 GiB | 737073 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 728978 GiB | 728978 GiB |
|       from small pool |  17491 KiB |     37 MiB |   8094 GiB |   8094 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   4045 MiB | 737030 GiB | 737030 GiB |
|       from large pool | 178979 KiB |   4026 MiB | 728944 GiB | 728944 GiB |
|       from small pool |  16482 KiB |     36 MiB |   8086 GiB |   8086 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4966 MiB |   4966 MiB |   4966 MiB |      0 B   |
|       from large pool |   4924 MiB |   4924 MiB |   4924 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  57847 KiB | 392988 KiB | 369788 GiB | 369788 GiB |
|       from large pool |  50762 KiB | 392048 KiB | 361654 GiB | 361654 GiB |
|       from small pool |   7085 KiB |  10234 KiB |   8134 GiB |   8134 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2978    |    7645    |   94246 K  |   94243 K  |
|       from large pool |      79    |     423    |   64411 K  |   64411 K  |
|       from small pool |    2899    |    7565    |   29834 K  |   29831 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2978    |    7645    |   94246 K  |   94243 K  |
|       from large pool |      79    |     423    |   64411 K  |   64411 K  |
|       from small pool |    2899    |    7565    |   29834 K  |   29831 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     204    |     204    |     204    |       0    |
|       from large pool |     183    |     183    |     183    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3605    |   64608 K  |   64608 K  |
|       from large pool |      10    |     183    |   50331 K  |   50331 K  |
|       from small pool |      21    |    3595    |   14277 K  |   14277 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 737073 GiB | 737073 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 728978 GiB | 728978 GiB |
|       from small pool |      0 KiB |     37 MiB |   8094 GiB |   8094 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 737073 GiB | 737073 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 728978 GiB | 728978 GiB |
|       from small pool |      0 KiB |     37 MiB |   8094 GiB |   8094 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 737030 GiB | 737030 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 728944 GiB | 728944 GiB |
|       from small pool |      0 KiB |     36 MiB |   8086 GiB |   8086 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   4966 MiB |   4966 MiB |   4716 MiB |
|       from large pool | 231424 KiB |   4924 MiB |   4924 MiB |   4698 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 392988 KiB | 369788 GiB | 369788 GiB |
|       from large pool |  30464 KiB | 392048 KiB | 361654 GiB | 361654 GiB |
|       from small pool |      0 KiB |  18594 KiB |   8134 GiB |   8134 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   94246 K  |   94246 K  |
|       from large pool |       2    |     423    |   64411 K  |   64411 K  |
|       from small pool |       0    |    7565    |   29834 K  |   29834 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   94246 K  |   94246 K  |
|       from large pool |       2    |     423    |   64411 K  |   64411 K  |
|       from small pool |       0    |    7565    |   29834 K  |   29834 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     204    |     204    |     181    |
|       from large pool |      11    |     183    |     183    |     172    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3605    |   64609 K  |   64609 K  |
|       from large pool |       3    |     183    |   50331 K  |   50331 K  |
|       from small pool |       0    |    3595    |   14278 K  |   14278 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 737073 GiB | 737073 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 728978 GiB | 728978 GiB |
|       from small pool |      0 KiB |     37 MiB |   8094 GiB |   8094 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 737073 GiB | 737073 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 728978 GiB | 728978 GiB |
|       from small pool |      0 KiB |     37 MiB |   8094 GiB |   8094 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 737030 GiB | 737030 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 728944 GiB | 728944 GiB |
|       from small pool |      0 KiB |     36 MiB |   8086 GiB |   8086 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   4966 MiB |   4966 MiB |   4716 MiB |
|       from large pool | 231424 KiB |   4924 MiB |   4924 MiB |   4698 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 392988 KiB | 369788 GiB | 369788 GiB |
|       from large pool |  30464 KiB | 392048 KiB | 361654 GiB | 361654 GiB |
|       from small pool |      0 KiB |  18594 KiB |   8134 GiB |   8134 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   94246 K  |   94246 K  |
|       from large pool |       2    |     423    |   64411 K  |   64411 K  |
|       from small pool |       0    |    7565    |   29834 K  |   29834 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   94246 K  |   94246 K  |
|       from large pool |       2    |     423    |   64411 K  |   64411 K  |
|       from small pool |       0    |    7565    |   29834 K  |   29834 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     204    |     204    |     181    |
|       from large pool |      11    |     183    |     183    |     172    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3605    |   64609 K  |   64609 K  |
|       from large pool |       3    |     183    |   50331 K  |   50331 K  |
|       from small pool |       0    |    3595    |   14278 K  |   14278 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_15_19_33_seed_1_23919983

 Experiment start at: 2024-08-01 15:19:34.078631
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9502569, 'precision': 0.9509663, 'recall': 0.9502714, 'specificity': 0.9502714, 'f1': 0.95023847, 'auroc': 0.98726594, 'binary_precision': 0.9690357, 'binary_recall': 0.9303132, 'binary_specificity': 0.9702296, 'binary_f1_score': 0.9492797}
confusion matrix:
       0      1
0  27930    857
1   2009  26820
---- Validation: 
scalar performance:
{'acc': 0.9321772, 'precision': 0.61457705, 'recall': 0.69803065, 'specificity': 0.69803065, 'f1': 0.64249545, 'auroc': 0.8627869, 'binary_precision': 0.25041735, 'binary_recall': 0.44576523, 'binary_specificity': 0.9502961, 'binary_f1_score': 0.3206841}
confusion matrix:
       0    1
0  17169  898
1    373  300
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9466645, 'precision': 0.6950488, 'recall': 0.7827505, 'specificity': 0.7827505, 'f1': 0.72934604, 'auroc': 0.9109291, 'binary_precision': 0.4077922, 'binary_recall': 0.60384613, 'binary_specificity': 0.9616549, 'binary_f1_score': 0.48682165}
confusion matrix:
      0    1
0  5718  228
1   103  157
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 16:04:53.276367,epoch time: 0:45:19.197736,used: 0:45:19.197736,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_15_19_33_seed_1_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9623195, 'precision': 0.96311945, 'recall': 0.96233475, 'specificity': 0.96233475, 'f1': 0.9623041, 'auroc': 0.9934511, 'binary_precision': 0.98255014, 'binary_recall': 0.94141316, 'binary_specificity': 0.98325634, 'binary_f1_score': 0.9615419}
confusion matrix:
       0      1
0  28305    482
1   1689  27140
---- Validation: 
scalar performance:
{'acc': 0.93884736, 'precision': 0.64609295, 'recall': 0.76014197, 'specificity': 0.76014197, 'f1': 0.68389094, 'auroc': 0.8836157, 'binary_precision': 0.30881163, 'binary_recall': 0.5676077, 'binary_specificity': 0.9526762, 'binary_f1_score': 0.4}
confusion matrix:
       0    1
0  17212  855
1    291  382
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9442475, 'precision': 0.6969086, 'recall': 0.8366588, 'specificity': 0.8366588, 'f1': 0.7449258, 'auroc': 0.9270382, 'binary_precision': 0.40652174, 'binary_recall': 0.7192308, 'binary_specificity': 0.9540868, 'binary_f1_score': 0.51944447}
confusion matrix:
      0    1
0  5673  273
1    73  187
better model found
persisted
after epoch: 2,now: 2024-08-01 16:49:26.928754,epoch time: 0:44:33.652387,used: 1:29:52.850123,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_15_19_33_seed_1_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96816856, 'precision': 0.9686952, 'recall': 0.9681815, 'specificity': 0.9681815, 'f1': 0.9681603, 'auroc': 0.9951217, 'binary_precision': 0.9845983, 'binary_recall': 0.95126605, 'binary_specificity': 0.98509693, 'binary_f1_score': 0.9676452}
confusion matrix:
       0      1
0  28357    429
1   1405  27425
---- Validation: 
scalar performance:
{'acc': 0.9367129, 'precision': 0.6475982, 'recall': 0.78478456, 'specificity': 0.78478456, 'f1': 0.69000196, 'auroc': 0.88881797, 'binary_precision': 0.30985916, 'binary_recall': 0.62109953, 'binary_specificity': 0.9484696, 'binary_f1_score': 0.41345203}
confusion matrix:
       0    1
0  17136  931
1    255  418
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9395746, 'precision': 0.6882944, 'recall': 0.85444903, 'specificity': 0.85444903, 'f1': 0.7407025, 'auroc': 0.93462706, 'binary_precision': 0.38747555, 'binary_recall': 0.76153845, 'binary_specificity': 0.94735956, 'binary_f1_score': 0.5136187}
confusion matrix:
      0    1
0  5633  313
1    62  198
early stop counter: 1
val acc:0.936712920665741, best validation acc: 0.9388473629951477, corresponding to test acc:                         0.9442474842071533 / 0.9466645121574402
after epoch: 3,now: 2024-08-01 17:35:03.698762,epoch time: 0:45:36.770008,used: 2:15:29.620131,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_15_19_33_seed_1_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9732192, 'precision': 0.973336, 'recall': 0.97322536, 'specificity': 0.97322536, 'f1': 0.97321784, 'auroc': 0.9959291, 'binary_precision': 0.98096377, 'binary_recall': 0.96520984, 'binary_specificity': 0.98124087, 'binary_f1_score': 0.973023}
confusion matrix:
       0      1
0  28246    540
1   1003  27827
---- Validation: 
scalar performance:
{'acc': 0.9110459, 'precision': 0.6157936, 'recall': 0.81009746, 'specificity': 0.81009746, 'f1': 0.6568699, 'auroc': 0.8910136, 'binary_precision': 0.24355005, 'binary_recall': 0.7013373, 'binary_specificity': 0.9188576, 'binary_f1_score': 0.3615473}
confusion matrix:
       0     1
0  16601  1466
1    201   472
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9089591, 'precision': 0.64139855, 'recall': 0.8660567, 'specificity': 0.8660567, 'f1': 0.69019926, 'auroc': 0.9345604, 'binary_precision': 0.29138166, 'binary_recall': 0.8192308, 'binary_specificity': 0.9128826, 'binary_f1_score': 0.42986882}
confusion matrix:
      0    1
0  5428  518
1    47  213
early stop counter: 2
val acc:0.9110459089279175, best validation acc: 0.9388473629951477, corresponding to test acc:                         0.9442474842071533 / 0.9466645121574402
after epoch: 4,now: 2024-08-01 18:19:37.873782,epoch time: 0:44:34.175020,used: 3:00:03.795151,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_15_19_33_seed_1_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9723688, 'precision': 0.97278476, 'recall': 0.9723792, 'specificity': 0.9723792, 'f1': 0.9723631, 'auroc': 0.9960811, 'binary_precision': 0.98698324, 'binary_recall': 0.9574025, 'binary_specificity': 0.9873558, 'binary_f1_score': 0.9719679}
confusion matrix:
       0      1
0  28424    364
1   1228  27600
---- Validation: 
scalar performance:
{'acc': 0.9242262, 'precision': 0.6317345, 'recall': 0.80834985, 'specificity': 0.80834985, 'f1': 0.6763763, 'auroc': 0.8961699, 'binary_precision': 0.2759448, 'binary_recall': 0.68350667, 'binary_specificity': 0.9331931, 'binary_f1_score': 0.39316237}
confusion matrix:
       0     1
0  16860  1207
1    213   460
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.924428, 'precision': 0.65994316, 'recall': 0.8557395, 'specificity': 0.8557395, 'f1': 0.7116741, 'auroc': 0.9317104, 'binary_precision': 0.3300813, 'binary_recall': 0.7807692, 'binary_specificity': 0.9307097, 'binary_f1_score': 0.46400002}
confusion matrix:
      0    1
0  5534  412
1    57  203
early stop counter: 3
val acc:0.9242262244224548, best validation acc: 0.9388473629951477, corresponding to test acc:                         0.9442474842071533 / 0.9466645121574402
after epoch: 5,now: 2024-08-01 19:04:12.621294,epoch time: 0:44:34.747512,used: 3:44:38.542663,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_15_19_33_seed_1_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:44:38.542663 at 2024-08-01 19:04:12.621294
persisted model performance metric: 

scalar performance:
{'acc': 0.9442475, 'precision': 0.6969086, 'recall': 0.8366588, 'specificity': 0.8366588, 'f1': 0.7449258, 'auroc': 0.9270382, 'binary_precision': 0.40652174, 'binary_recall': 0.7192308, 'binary_specificity': 0.9540868, 'binary_f1_score': 0.51944447}
confusion matrix:
      0    1
0  5673  273
1    73  187
oracle model performance metric: 

scalar performance:
{'acc': 0.9466645, 'precision': 0.6950488, 'recall': 0.7827505, 'specificity': 0.7827505, 'f1': 0.72934604, 'auroc': 0.9109291, 'binary_precision': 0.4077922, 'binary_recall': 0.60384613, 'binary_specificity': 0.9616549, 'binary_f1_score': 0.48682165}
confusion matrix:
      0    1
0  5718  228
1   103  157
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196690 KiB |   4047 MiB |   1236 TiB |   1236 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1223 TiB |   1223 TiB |
|       from small pool |  17479 KiB |     37 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196690 KiB |   4047 MiB |   1236 TiB |   1236 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1223 TiB |   1223 TiB |
|       from small pool |  17479 KiB |     37 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   4045 MiB |   1236 TiB |   1236 TiB |
|       from large pool | 178979 KiB |   4026 MiB |   1223 TiB |   1223 TiB |
|       from small pool |  16480 KiB |     36 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4946 MiB |   4966 MiB |   9662 MiB |   4716 MiB |
|       from large pool |   4908 MiB |   4924 MiB |   9606 MiB |   4698 MiB |
|       from small pool |     38 MiB |     42 MiB |     56 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40878 KiB | 396512 KiB | 645395 GiB | 645395 GiB |
|       from large pool |  31733 KiB | 395396 KiB | 631402 GiB | 631402 GiB |
|       from small pool |   9145 KiB |  18594 KiB |  13992 GiB |  13992 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7677    |  161993 K  |  161990 K  |
|       from large pool |      79    |     423    |  110685 K  |  110685 K  |
|       from small pool |    2875    |    7597    |   51308 K  |   51305 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7677    |  161993 K  |  161990 K  |
|       from large pool |      79    |     423    |  110685 K  |  110685 K  |
|       from small pool |    2875    |    7597    |   51308 K  |   51305 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     204    |     381    |     181    |
|       from large pool |     181    |     183    |     353    |     172    |
|       from small pool |      19    |      21    |      28    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3621    |  109474 K  |  109474 K  |
|       from large pool |      11    |     185    |   85052 K  |   85052 K  |
|       from small pool |      20    |    3610    |   24422 K  |   24422 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |   1236 TiB |   1236 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1223 TiB |   1223 TiB |
|       from small pool |      0 KiB |     37 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |   1236 TiB |   1236 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1223 TiB |   1223 TiB |
|       from small pool |      0 KiB |     37 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |   1236 TiB |   1236 TiB |
|       from large pool |  16640 KiB |   4026 MiB |   1223 TiB |   1223 TiB |
|       from small pool |      0 KiB |     36 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   4966 MiB |   9662 MiB |   9430 MiB |
|       from large pool | 210944 KiB |   4924 MiB |   9606 MiB |   9400 MiB |
|       from small pool |  26624 KiB |     42 MiB |     56 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 396512 KiB | 645395 GiB | 645395 GiB |
|       from large pool |  30464 KiB | 395396 KiB | 631402 GiB | 631402 GiB |
|       from small pool |      0 KiB |  23501 KiB |  13992 GiB |  13992 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |  161993 K  |  161993 K  |
|       from large pool |       2    |     423    |  110685 K  |  110685 K  |
|       from small pool |       0    |    7597    |   51308 K  |   51308 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |  161993 K  |  161993 K  |
|       from large pool |       2    |     423    |  110685 K  |  110685 K  |
|       from small pool |       0    |    7597    |   51308 K  |   51308 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     204    |     381    |     358    |
|       from large pool |      10    |     183    |     353    |     343    |
|       from small pool |      13    |      21    |      28    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3621    |  109476 K  |  109476 K  |
|       from large pool |       3    |     185    |   85052 K  |   85052 K  |
|       from small pool |       0    |    3610    |   24423 K  |   24423 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |   1236 TiB |   1236 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1223 TiB |   1223 TiB |
|       from small pool |      0 KiB |     37 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |   1236 TiB |   1236 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1223 TiB |   1223 TiB |
|       from small pool |      0 KiB |     37 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |   1236 TiB |   1236 TiB |
|       from large pool |  16640 KiB |   4026 MiB |   1223 TiB |   1223 TiB |
|       from small pool |      0 KiB |     36 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   4966 MiB |   9662 MiB |   9430 MiB |
|       from large pool | 210944 KiB |   4924 MiB |   9606 MiB |   9400 MiB |
|       from small pool |  26624 KiB |     42 MiB |     56 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 396512 KiB | 645395 GiB | 645395 GiB |
|       from large pool |  30464 KiB | 395396 KiB | 631402 GiB | 631402 GiB |
|       from small pool |      0 KiB |  23501 KiB |  13992 GiB |  13992 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |  161993 K  |  161993 K  |
|       from large pool |       2    |     423    |  110685 K  |  110685 K  |
|       from small pool |       0    |    7597    |   51308 K  |   51308 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |  161993 K  |  161993 K  |
|       from large pool |       2    |     423    |  110685 K  |  110685 K  |
|       from small pool |       0    |    7597    |   51308 K  |   51308 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     204    |     381    |     358    |
|       from large pool |      10    |     183    |     353    |     343    |
|       from small pool |      13    |      21    |      28    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3621    |  109476 K  |  109476 K  |
|       from large pool |       3    |     185    |   85052 K  |   85052 K  |
|       from small pool |       0    |    3610    |   24423 K  |   24423 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_14_34_seed_2_23919983

 Experiment start at: 2024-08-01 19:14:34.552081
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94779086, 'precision': 0.94948137, 'recall': 0.9477961, 'specificity': 0.9477961, 'f1': 0.94774216, 'auroc': 0.9871748, 'binary_precision': 0.97708917, 'binary_recall': 0.91710395, 'binary_specificity': 0.9784883, 'binary_f1_score': 0.9461467}
confusion matrix:
       0      1
0  28520    627
1   2417  26740
---- Validation: 
scalar performance:
{'acc': 0.9443349, 'precision': 0.6315033, 'recall': 0.715876, 'specificity': 0.715876, 'f1': 0.66152847, 'auroc': 0.8467039, 'binary_precision': 0.28091, 'binary_recall': 0.4717608, 'binary_specificity': 0.9599912, 'binary_f1_score': 0.35213888}
confusion matrix:
       0    1
0  17444  727
1    318  284
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9283539, 'precision': 0.6419376, 'recall': 0.78626746, 'specificity': 0.78626746, 'f1': 0.6841254, 'auroc': 0.8786542, 'binary_precision': 0.2994129, 'binary_recall': 0.6322314, 'binary_specificity': 0.9403035, 'binary_f1_score': 0.40637448}
confusion matrix:
      0    1
0  5639  358
1    89  153
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 20:00:10.416227,epoch time: 0:45:35.864146,used: 0:45:35.864146,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_14_34_seed_2_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96183795, 'precision': 0.9626869, 'recall': 0.9618416, 'specificity': 0.9618416, 'f1': 0.96182066, 'auroc': 0.99255216, 'binary_precision': 0.98254853, 'binary_recall': 0.94039166, 'binary_specificity': 0.98329157, 'binary_f1_score': 0.961008}
confusion matrix:
       0      1
0  28660    487
1   1738  27419
---- Validation: 
scalar performance:
{'acc': 0.94167155, 'precision': 0.63789654, 'recall': 0.761077, 'specificity': 0.761077, 'f1': 0.67693543, 'auroc': 0.8709818, 'binary_precision': 0.29056925, 'binary_recall': 0.5681063, 'binary_specificity': 0.9540477, 'binary_f1_score': 0.38448566}
confusion matrix:
       0    1
0  17336  835
1    260  342
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92931557, 'precision': 0.65674776, 'recall': 0.84624994, 'specificity': 0.84624994, 'f1': 0.7078728, 'auroc': 0.9113165, 'binary_precision': 0.32389382, 'binary_recall': 0.75619835, 'binary_specificity': 0.93630147, 'binary_f1_score': 0.4535316}
confusion matrix:
      0    1
0  5615  382
1    59  183
new oracle model saved
early stop counter: 1
val acc:0.9416715502738953, best validation acc: 0.9443349242210388, corresponding to test acc:                         0.9283539056777954 / 0.9293155670166016
after epoch: 2,now: 2024-08-01 20:44:58.509208,epoch time: 0:44:48.092981,used: 1:30:23.957127,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_14_34_seed_2_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96856135, 'precision': 0.96914494, 'recall': 0.968565, 'specificity': 0.968565, 'f1': 0.96855175, 'auroc': 0.9948828, 'binary_precision': 0.9857432, 'binary_recall': 0.9508883, 'binary_specificity': 0.9862417, 'binary_f1_score': 0.96800214}
confusion matrix:
       0      1
0  28745    401
1   1432  27726
---- Validation: 
scalar performance:
{'acc': 0.9410856, 'precision': 0.64228654, 'recall': 0.78406274, 'specificity': 0.78406274, 'f1': 0.6852665, 'auroc': 0.8845358, 'binary_precision': 0.2977528, 'binary_recall': 0.61627907, 'binary_specificity': 0.95184636, 'binary_f1_score': 0.40151513}
confusion matrix:
       0    1
0  17296  875
1    231  371
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92867446, 'precision': 0.6556056, 'recall': 0.8459164, 'specificity': 0.8459164, 'f1': 0.70657647, 'auroc': 0.9176055, 'binary_precision': 0.32161686, 'binary_recall': 0.75619835, 'binary_specificity': 0.9356345, 'binary_f1_score': 0.45129472}
confusion matrix:
      0    1
0  5611  386
1    59  183
early stop counter: 2
val acc:0.9410855770111084, best validation acc: 0.9443349242210388, corresponding to test acc:                         0.9283539056777954 / 0.9293155670166016
after epoch: 3,now: 2024-08-01 21:30:03.027835,epoch time: 0:45:04.518627,used: 2:15:28.475754,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_14_34_seed_2_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9726777, 'precision': 0.9729909, 'recall': 0.97268033, 'specificity': 0.97268033, 'f1': 0.9726733, 'auroc': 0.99582016, 'binary_precision': 0.9852139, 'binary_recall': 0.9597709, 'binary_specificity': 0.9855898, 'binary_f1_score': 0.972326}
confusion matrix:
       0      1
0  28726    420
1   1173  27985
---- Validation: 
scalar performance:
{'acc': 0.9399137, 'precision': 0.63074374, 'recall': 0.74812317, 'specificity': 0.74812317, 'f1': 0.66773164, 'auroc': 0.878708, 'binary_precision': 0.27711865, 'binary_recall': 0.54318935, 'binary_specificity': 0.95305705, 'binary_f1_score': 0.36700338}
confusion matrix:
       0    1
0  17318  853
1    275  327
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93476516, 'precision': 0.6632529, 'recall': 0.82925725, 'specificity': 0.82925725, 'f1': 0.7123916, 'auroc': 0.91668904, 'binary_precision': 0.33855185, 'binary_recall': 0.71487606, 'binary_specificity': 0.9436385, 'binary_f1_score': 0.45949534}
confusion matrix:
      0    1
0  5659  338
1    69  173
new oracle model saved
early stop counter: 3
val acc:0.9399136900901794, best validation acc: 0.9443349242210388, corresponding to test acc:                         0.9283539056777954 / 0.9347651600837708
after epoch: 4,now: 2024-08-01 22:14:54.105586,epoch time: 0:44:51.077751,used: 3:00:19.553505,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_14_34_seed_2_23919983
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 3:00:19.553505 at 2024-08-01 22:14:54.105586
persisted model performance metric: 

scalar performance:
{'acc': 0.9283539, 'precision': 0.6419376, 'recall': 0.78626746, 'specificity': 0.78626746, 'f1': 0.6841254, 'auroc': 0.8786542, 'binary_precision': 0.2994129, 'binary_recall': 0.6322314, 'binary_specificity': 0.9403035, 'binary_f1_score': 0.40637448}
confusion matrix:
      0    1
0  5639  358
1    89  153
oracle model performance metric: 

scalar performance:
{'acc': 0.93476516, 'precision': 0.6632529, 'recall': 0.82925725, 'specificity': 0.82925725, 'f1': 0.7123916, 'auroc': 0.91668904, 'binary_precision': 0.33855185, 'binary_recall': 0.71487606, 'binary_specificity': 0.9436385, 'binary_f1_score': 0.45949534}
confusion matrix:
      0    1
0  5659  338
1    69  173
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196696 KiB |   4047 MiB |   1655 TiB |   1655 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1637 TiB |   1637 TiB |
|       from small pool |  17485 KiB |     37 MiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196696 KiB |   4047 MiB |   1655 TiB |   1655 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1637 TiB |   1637 TiB |
|       from small pool |  17485 KiB |     37 MiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195460 KiB |   4045 MiB |   1655 TiB |   1655 TiB |
|       from large pool | 178979 KiB |   4026 MiB |   1637 TiB |   1637 TiB |
|       from small pool |  16481 KiB |     36 MiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4944 MiB |   4966 MiB |  14374 MiB |   9430 MiB |
|       from large pool |   4906 MiB |   4924 MiB |  14306 MiB |   9400 MiB |
|       from small pool |     38 MiB |     42 MiB |     68 MiB |     30 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  38824 KiB | 396512 KiB |    849 TiB |    849 TiB |
|       from large pool |  31733 KiB | 395396 KiB |    831 TiB |    831 TiB |
|       from small pool |   7091 KiB |  23501 KiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7763    |  216924 K  |  216921 K  |
|       from large pool |      79    |     423    |  148185 K  |  148185 K  |
|       from small pool |    2887    |    7683    |   68739 K  |   68736 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7763    |  216924 K  |  216921 K  |
|       from large pool |      79    |     423    |  148185 K  |  148185 K  |
|       from small pool |    2887    |    7683    |   68739 K  |   68736 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     199    |     204    |     557    |     358    |
|       from large pool |     180    |     183    |     523    |     343    |
|       from small pool |      19    |      21    |      34    |      15    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      33    |    3663    |  145746 K  |  145746 K  |
|       from large pool |      11    |     185    |  112822 K  |  112822 K  |
|       from small pool |      22    |    3652    |   32924 K  |   32923 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |   1655 TiB |   1655 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1637 TiB |   1637 TiB |
|       from small pool |      0 KiB |     37 MiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |   1655 TiB |   1655 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1637 TiB |   1637 TiB |
|       from small pool |      0 KiB |     37 MiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |   1655 TiB |   1655 TiB |
|       from large pool |  16640 KiB |   4026 MiB |   1637 TiB |   1637 TiB |
|       from small pool |      0 KiB |     36 MiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB |   4966 MiB |  14374 MiB |  14144 MiB |
|       from large pool | 210944 KiB |   4924 MiB |  14306 MiB |  14100 MiB |
|       from small pool |  24576 KiB |     42 MiB |     68 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 396512 KiB |    849 TiB |    849 TiB |
|       from large pool |  30464 KiB | 395396 KiB |    831 TiB |    831 TiB |
|       from small pool |      0 KiB |  23501 KiB |     18 TiB |     18 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7763    |  216924 K  |  216924 K  |
|       from large pool |       2    |     423    |  148185 K  |  148185 K  |
|       from small pool |       0    |    7683    |   68739 K  |   68739 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7763    |  216924 K  |  216924 K  |
|       from large pool |       2    |     423    |  148185 K  |  148185 K  |
|       from small pool |       0    |    7683    |   68739 K  |   68739 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     204    |     557    |     535    |
|       from large pool |      10    |     183    |     523    |     513    |
|       from small pool |      12    |      21    |      34    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3663    |  145747 K  |  145747 K  |
|       from large pool |       3    |     185    |  112822 K  |  112822 K  |
|       from small pool |       0    |    3652    |   32925 K  |   32925 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  1 22:16:20 2024]
Finished job 0.
1 of 1 steps (100%) done
