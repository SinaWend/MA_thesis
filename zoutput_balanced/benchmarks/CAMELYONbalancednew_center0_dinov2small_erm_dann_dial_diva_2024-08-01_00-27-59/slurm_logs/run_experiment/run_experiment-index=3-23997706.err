Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 09:38:03 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/3.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=3
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/var/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_09_47_58_seed_0_23997706

 Experiment start at: 2024-08-02 09:47:58.905144
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.08405241370201111
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.95507324, 'precision': 0.9556898, 'recall': 0.9550874, 'specificity': 0.9550874, 'f1': 0.95505893, 'auroc': 0.98960614, 'binary_precision': 0.97264534, 'binary_recall': 0.93655497, 'binary_specificity': 0.97361994, 'binary_f1_score': 0.95425904}
confusion matrix:
       0      1
0  27902    756
1   1821  26881
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.9448702, 'precision': 0.6292719, 'recall': 0.6774368, 'specificity': 0.6774368, 'f1': 0.6488284, 'auroc': 0.84702086, 'binary_precision': 0.28044692, 'binary_recall': 0.3903577, 'binary_specificity': 0.9645159, 'binary_f1_score': 0.32639793}
confusion matrix:
       0    1
0  17505  644
1    392  251
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9597315, 'precision': 0.7490804, 'recall': 0.8104148, 'specificity': 0.8104148, 'f1': 0.77587557, 'auroc': 0.9126019, 'binary_precision': 0.51367784, 'binary_recall': 0.6475096, 'binary_specificity': 0.97332, 'binary_f1_score': 0.5728814}
confusion matrix:
      0    1
0  5837  160
1    92  169
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 10:30:18.454973,epoch time: 0:42:19.549829,used: 0:42:19.549829,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_09_47_58_seed_0_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.967765, 'precision': 0.9679264, 'recall': 0.96777225, 'specificity': 0.96777225, 'f1': 0.9677626, 'auroc': 0.99455994, 'binary_precision': 0.9768103, 'binary_recall': 0.95833045, 'binary_specificity': 0.97721404, 'binary_f1_score': 0.96748215}
confusion matrix:
       0      1
0  28005    653
1   1196  27506
---- Validation: 
scalar performance:
{'acc': 0.9175713, 'precision': 0.600442, 'recall': 0.7375593, 'specificity': 0.7375593, 'f1': 0.6337059, 'auroc': 0.85035694, 'binary_precision': 0.21793275, 'binary_recall': 0.5443235, 'binary_specificity': 0.9307951, 'binary_f1_score': 0.31124943}
confusion matrix:
       0     1
0  16893  1256
1    293   350
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9253755, 'precision': 0.6577623, 'recall': 0.84012985, 'specificity': 0.84012985, 'f1': 0.7075105, 'auroc': 0.9105038, 'binary_precision': 0.32718122, 'binary_recall': 0.74712646, 'binary_specificity': 0.93313324, 'binary_f1_score': 0.45507586}
confusion matrix:
      0    1
0  5596  401
1    66  195
early stop counter: 1
val acc:0.9175713062286377, best validation acc: 0.9448701739311218, corresponding to test acc:                         0.9597315192222595 / 0.9597315192222595
after epoch: 2,now: 2024-08-02 11:13:04.152057,epoch time: 0:42:45.697084,used: 1:25:05.246913,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_09_47_58_seed_0_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97259414, 'precision': 0.9730072, 'recall': 0.9726056, 'specificity': 0.9726056, 'f1': 0.9725886, 'auroc': 0.9959923, 'binary_precision': 0.98717856, 'binary_recall': 0.9576685, 'binary_specificity': 0.98754275, 'binary_f1_score': 0.9721996}
confusion matrix:
       0      1
0  28301    357
1   1215  27487
---- Validation: 
scalar performance:
{'acc': 0.905811, 'precision': 0.58556014, 'recall': 0.72547036, 'specificity': 0.72547036, 'f1': 0.61417216, 'auroc': 0.8467419, 'binary_precision': 0.18884595, 'binary_recall': 0.5318818, 'binary_specificity': 0.9190589, 'binary_f1_score': 0.2787286}
confusion matrix:
       0     1
0  16680  1469
1    301   342
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9084372, 'precision': 0.63415486, 'recall': 0.8367891, 'specificity': 0.8367891, 'f1': 0.67952275, 'auroc': 0.90752655, 'binary_precision': 0.27966103, 'binary_recall': 0.7586207, 'binary_specificity': 0.91495746, 'binary_f1_score': 0.40866876}
confusion matrix:
      0    1
0  5487  510
1    63  198
early stop counter: 2
val acc:0.9058110117912292, best validation acc: 0.9448701739311218, corresponding to test acc:                         0.9597315192222595 / 0.9597315192222595
after epoch: 3,now: 2024-08-02 11:57:29.492100,epoch time: 0:44:25.340043,used: 2:09:30.586956,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_09_47_58_seed_0_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9765342, 'precision': 0.97673625, 'recall': 0.97654295, 'specificity': 0.97654295, 'f1': 0.976532, 'auroc': 0.99683845, 'binary_precision': 0.9867625, 'binary_recall': 0.96606743, 'binary_specificity': 0.9870184, 'binary_f1_score': 0.9763053}
confusion matrix:
       0      1
0  28284    372
1    974  27730
---- Validation: 
scalar performance:
{'acc': 0.9054917, 'precision': 0.5876188, 'recall': 0.73430574, 'specificity': 0.73430574, 'f1': 0.61721295, 'auroc': 0.8569197, 'binary_precision': 0.1922868, 'binary_recall': 0.5505443, 'binary_specificity': 0.9180671, 'binary_f1_score': 0.28502417}
confusion matrix:
       0     1
0  16662  1487
1    289   354
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91099393, 'precision': 0.63499147, 'recall': 0.82712907, 'specificity': 0.82712907, 'f1': 0.6799778, 'auroc': 0.90667427, 'binary_precision': 0.28235295, 'binary_recall': 0.7356322, 'binary_specificity': 0.91862595, 'binary_f1_score': 0.40807655}
confusion matrix:
      0    1
0  5509  488
1    69  192
early stop counter: 3
val acc:0.9054917097091675, best validation acc: 0.9448701739311218, corresponding to test acc:                         0.9597315192222595 / 0.9597315192222595
after epoch: 4,now: 2024-08-02 12:40:03.418628,epoch time: 0:42:33.926528,used: 2:52:04.513484,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_09_47_58_seed_0_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:52:04.513484 at 2024-08-02 12:40:03.418628
persisted model performance metric: 

scalar performance:
{'acc': 0.9597315, 'precision': 0.7490804, 'recall': 0.8104148, 'specificity': 0.8104148, 'f1': 0.77587557, 'auroc': 0.9126019, 'binary_precision': 0.51367784, 'binary_recall': 0.6475096, 'binary_specificity': 0.97332, 'binary_f1_score': 0.5728814}
confusion matrix:
      0    1
0  5837  160
1    92  169
oracle model performance metric: 

scalar performance:
{'acc': 0.9597315, 'precision': 0.7490804, 'recall': 0.8104148, 'specificity': 0.8104148, 'f1': 0.77587557, 'auroc': 0.9126019, 'binary_precision': 0.51367784, 'binary_recall': 0.6475096, 'binary_specificity': 0.97332, 'binary_f1_score': 0.5728814}
confusion matrix:
      0    1
0  5837  160
1    92  169
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/3.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/3.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/3.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1920 MiB |   6571 MiB | 380170 GiB | 380168 GiB |
|       from large pool |   1876 MiB |   6527 MiB | 376524 GiB | 376522 GiB |
|       from small pool |     43 MiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1920 MiB |   6571 MiB | 380170 GiB | 380168 GiB |
|       from large pool |   1876 MiB |   6527 MiB | 376524 GiB | 376522 GiB |
|       from small pool |     43 MiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1917 MiB |   6568 MiB | 380104 GiB | 380102 GiB |
|       from large pool |   1874 MiB |   6525 MiB | 376462 GiB | 376460 GiB |
|       from small pool |     42 MiB |     83 MiB |   3641 GiB |   3641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6994 MiB |   6994 MiB |   6994 MiB |      0 B   |
|       from large pool |   6904 MiB |   6904 MiB |   6904 MiB |      0 B   |
|       from small pool |     90 MiB |     90 MiB |     90 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 448116 KiB | 763056 KiB | 180545 GiB | 180544 GiB |
|       from large pool | 439588 KiB | 760912 KiB | 176864 GiB | 176863 GiB |
|       from small pool |   8528 KiB |  13715 KiB |   3680 GiB |   3680 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3634    |    8301    |   48613 K  |   48610 K  |
|       from large pool |     176    |     456    |   27875 K  |   27875 K  |
|       from small pool |    3458    |    8124    |   20738 K  |   20734 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3634    |    8301    |   48613 K  |   48610 K  |
|       from large pool |     176    |     456    |   27875 K  |   27875 K  |
|       from small pool |    3458    |    8124    |   20738 K  |   20734 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     209    |     209    |     209    |       0    |
|       from large pool |     164    |     164    |     164    |       0    |
|       from small pool |      45    |      45    |      45    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      69    |    3623    |   30612 K  |   30612 K  |
|       from large pool |      29    |     155    |   18747 K  |   18747 K  |
|       from small pool |      40    |    3594    |   11865 K  |   11865 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB | 380104 GiB | 380104 GiB |
|       from large pool |  16640 KiB |   6525 MiB | 376462 GiB | 376462 GiB |
|       from small pool |      0 KiB |     83 MiB |   3641 GiB |   3641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2358 MiB |   6994 MiB |   6994 MiB |   4636 MiB |
|       from large pool |   2306 MiB |   6904 MiB |   6904 MiB |   4598 MiB |
|       from small pool |     52 MiB |     90 MiB |     90 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 763056 KiB | 180545 GiB | 180545 GiB |
|       from large pool |  30464 KiB | 760912 KiB | 176864 GiB | 176864 GiB |
|       from small pool |      0 KiB |  31429 KiB |   3680 GiB |   3680 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     209    |     145    |
|       from large pool |      38    |     164    |     164    |     126    |
|       from small pool |      26    |      45    |      45    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3623    |   30614 K  |   30614 K  |
|       from large pool |       4    |     155    |   18747 K  |   18747 K  |
|       from small pool |       0    |    3594    |   11866 K  |   11866 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB | 380104 GiB | 380104 GiB |
|       from large pool |  16640 KiB |   6525 MiB | 376462 GiB | 376462 GiB |
|       from small pool |      0 KiB |     83 MiB |   3641 GiB |   3641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2358 MiB |   6994 MiB |   6994 MiB |   4636 MiB |
|       from large pool |   2306 MiB |   6904 MiB |   6904 MiB |   4598 MiB |
|       from small pool |     52 MiB |     90 MiB |     90 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 763056 KiB | 180545 GiB | 180545 GiB |
|       from large pool |  30464 KiB | 760912 KiB | 176864 GiB | 176864 GiB |
|       from small pool |      0 KiB |  31429 KiB |   3680 GiB |   3680 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     209    |     145    |
|       from large pool |      38    |     164    |     164    |     126    |
|       from small pool |      26    |      45    |      45    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3623    |   30614 K  |   30614 K  |
|       from large pool |       4    |     155    |   18747 K  |   18747 K  |
|       from small pool |       0    |    3594    |   11866 K  |   11866 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_12_50_44_seed_1_23997706

 Experiment start at: 2024-08-02 12:50:45.516837
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.048501450568437576
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96301377, 'precision': 0.9638392, 'recall': 0.9630292, 'specificity': 0.9630292, 'f1': 0.96299815, 'auroc': 0.9924812, 'binary_precision': 0.98358935, 'binary_recall': 0.9417947, 'binary_specificity': 0.9842637, 'binary_f1_score': 0.9622384}
confusion matrix:
       0      1
0  28334    453
1   1678  27151
---- Validation: 
scalar performance:
{'acc': 0.9315368, 'precision': 0.617462, 'recall': 0.7105734, 'specificity': 0.7105734, 'f1': 0.6476719, 'auroc': 0.84478796, 'binary_precision': 0.2552167, 'binary_recall': 0.47251114, 'binary_specificity': 0.94863564, 'binary_f1_score': 0.3314226}
confusion matrix:
       0    1
0  17139  928
1    355  318
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94102484, 'precision': 0.68649215, 'recall': 0.823943, 'specificity': 0.823943, 'f1': 0.7329639, 'auroc': 0.9045266, 'binary_precision': 0.38675213, 'binary_recall': 0.6961538, 'binary_specificity': 0.9517323, 'binary_f1_score': 0.49725273}
confusion matrix:
      0    1
0  5659  287
1    79  181
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 13:39:04.268665,epoch time: 0:48:18.751828,used: 0:48:18.751828,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_12_50_44_seed_1_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96813387, 'precision': 0.96922016, 'recall': 0.9681515, 'specificity': 0.9681515, 'f1': 0.9681163, 'auroc': 0.99569833, 'binary_precision': 0.99198043, 'binary_recall': 0.94394535, 'binary_specificity': 0.9923577, 'binary_f1_score': 0.967367}
confusion matrix:
       0      1
0  28567    220
1   1616  27213
---- Validation: 
scalar performance:
{'acc': 0.94034153, 'precision': 0.64145553, 'recall': 0.73016036, 'specificity': 0.73016036, 'f1': 0.6730875, 'auroc': 0.8592683, 'binary_precision': 0.30187, 'binary_recall': 0.5037147, 'binary_specificity': 0.956606, 'binary_f1_score': 0.37750557}
confusion matrix:
       0    1
0  17283  784
1    334  339
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.950854, 'precision': 0.71420527, 'recall': 0.81803864, 'specificity': 0.81803864, 'f1': 0.75420463, 'auroc': 0.9049151, 'binary_precision': 0.443038, 'binary_recall': 0.6730769, 'binary_specificity': 0.96300036, 'binary_f1_score': 0.53435117}
confusion matrix:
      0    1
0  5726  220
1    85  175
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 14:23:39.097963,epoch time: 0:44:34.829298,used: 1:32:53.581126,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_12_50_44_seed_1_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9718655, 'precision': 0.9725856, 'recall': 0.97188044, 'specificity': 0.97188044, 'f1': 0.9718554, 'auroc': 0.9963527, 'binary_precision': 0.99122584, 'binary_recall': 0.95220256, 'binary_specificity': 0.9915584, 'binary_f1_score': 0.9713224}
confusion matrix:
       0      1
0  28543    243
1   1378  27452
---- Validation: 
scalar performance:
{'acc': 0.9281217, 'precision': 0.62364674, 'recall': 0.7517182, 'specificity': 0.7517182, 'f1': 0.66070545, 'auroc': 0.86723214, 'binary_precision': 0.26433566, 'binary_recall': 0.56166416, 'binary_specificity': 0.9417723, 'binary_f1_score': 0.35948643}
confusion matrix:
       0     1
0  17015  1052
1    295   378
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9310345, 'precision': 0.6637956, 'recall': 0.81872946, 'specificity': 0.81872946, 'f1': 0.7107006, 'auroc': 0.90632355, 'binary_precision': 0.34150943, 'binary_recall': 0.6961538, 'binary_specificity': 0.9413051, 'binary_f1_score': 0.45822784}
confusion matrix:
      0    1
0  5597  349
1    79  181
early stop counter: 1
val acc:0.9281216859817505, best validation acc: 0.9403415322303772, corresponding to test acc:                         0.9508540034294128 / 0.9508540034294128
after epoch: 3,now: 2024-08-02 15:06:54.842752,epoch time: 0:43:15.744789,used: 2:16:09.325915,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_12_50_44_seed_1_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97766244, 'precision': 0.9777839, 'recall': 0.9776681, 'specificity': 0.9776681, 'f1': 0.9776612, 'auroc': 0.9972213, 'binary_precision': 0.98557776, 'binary_recall': 0.9695435, 'binary_specificity': 0.9857927, 'binary_f1_score': 0.97749484}
confusion matrix:
       0      1
0  28379    409
1    878  27950
---- Validation: 
scalar performance:
{'acc': 0.90853786, 'precision': 0.6112681, 'recall': 0.8016441, 'specificity': 0.8016441, 'f1': 0.65053594, 'auroc': 0.88074386, 'binary_precision': 0.2351145, 'binary_recall': 0.68647844, 'binary_specificity': 0.9168097, 'binary_f1_score': 0.35026532}
confusion matrix:
       0     1
0  16564  1503
1    211   462
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.913632, 'precision': 0.639324, 'recall': 0.8298766, 'specificity': 0.8298766, 'f1': 0.6853751, 'auroc': 0.9085705, 'binary_precision': 0.29090908, 'binary_recall': 0.73846155, 'binary_specificity': 0.92129165, 'binary_f1_score': 0.41739127}
confusion matrix:
      0    1
0  5478  468
1    68  192
early stop counter: 2
val acc:0.9085378646850586, best validation acc: 0.9403415322303772, corresponding to test acc:                         0.9508540034294128 / 0.9508540034294128
after epoch: 4,now: 2024-08-02 15:49:57.884519,epoch time: 0:43:03.041767,used: 2:59:12.367682,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_12_50_44_seed_1_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9797799, 'precision': 0.9798379, 'recall': 0.9797841, 'specificity': 0.9797841, 'f1': 0.9797794, 'auroc': 0.9976877, 'binary_precision': 0.9852993, 'binary_recall': 0.9741233, 'binary_specificity': 0.98544484, 'binary_f1_score': 0.9796794}
confusion matrix:
       0      1
0  28368    419
1    746  28083
---- Validation: 
scalar performance:
{'acc': 0.90192103, 'precision': 0.60243785, 'recall': 0.7903445, 'specificity': 0.7903445, 'f1': 0.6381449, 'auroc': 0.8773823, 'binary_precision': 0.21819061, 'binary_recall': 0.6701337, 'binary_specificity': 0.9105552, 'binary_f1_score': 0.32919708}
confusion matrix:
       0     1
0  16451  1616
1    222   451
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9092813, 'precision': 0.6352006, 'recall': 0.8349621, 'specificity': 0.8349621, 'f1': 0.6806655, 'auroc': 0.90767825, 'binary_precision': 0.2820144, 'binary_recall': 0.75384617, 'binary_specificity': 0.91607803, 'binary_f1_score': 0.41047123}
confusion matrix:
      0    1
0  5447  499
1    64  196
early stop counter: 3
val acc:0.9019210338592529, best validation acc: 0.9403415322303772, corresponding to test acc:                         0.9508540034294128 / 0.9508540034294128
after epoch: 5,now: 2024-08-02 16:32:07.791558,epoch time: 0:42:09.907039,used: 3:41:22.274721,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_12_50_44_seed_1_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:41:22.274721 at 2024-08-02 16:32:07.791558
persisted model performance metric: 

scalar performance:
{'acc': 0.950854, 'precision': 0.71420527, 'recall': 0.81803864, 'specificity': 0.81803864, 'f1': 0.75420463, 'auroc': 0.9049151, 'binary_precision': 0.443038, 'binary_recall': 0.6730769, 'binary_specificity': 0.96300036, 'binary_f1_score': 0.53435117}
confusion matrix:
      0    1
0  5726  220
1    85  175
oracle model performance metric: 

scalar performance:
{'acc': 0.950854, 'precision': 0.71420527, 'recall': 0.81803864, 'specificity': 0.81803864, 'f1': 0.75420463, 'auroc': 0.9049151, 'binary_precision': 0.443038, 'binary_recall': 0.6730769, 'binary_specificity': 0.96300036, 'binary_f1_score': 0.53435117}
confusion matrix:
      0    1
0  5726  220
1    85  175
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/3.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/3.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1921 MiB |   6572 MiB |    836 TiB |    836 TiB |
|       from large pool |   1877 MiB |   6528 MiB |    828 TiB |    828 TiB |
|       from small pool |     43 MiB |     84 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   1921 MiB |   6572 MiB |    836 TiB |    836 TiB |
|       from large pool |   1877 MiB |   6528 MiB |    828 TiB |    828 TiB |
|       from small pool |     43 MiB |     84 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1917 MiB |   6568 MiB |    836 TiB |    836 TiB |
|       from large pool |   1874 MiB |   6525 MiB |    828 TiB |    828 TiB |
|       from small pool |     42 MiB |     83 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6996 MiB |   6996 MiB |  11632 MiB |   4636 MiB |
|       from large pool |   6912 MiB |   6912 MiB |  11510 MiB |   4598 MiB |
|       from small pool |     84 MiB |     90 MiB |    122 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 461549 KiB |    819 MiB | 484675 GiB | 484674 GiB |
|       from large pool | 450961 KiB |    817 MiB | 476393 GiB | 476392 GiB |
|       from small pool |  10588 KiB |     30 MiB |   8281 GiB |   8281 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3610    |    8333    |  109434 K  |  109431 K  |
|       from large pool |     176    |     456    |   62788 K  |   62788 K  |
|       from small pool |    3434    |    8156    |   46646 K  |   46642 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3610    |    8333    |  109434 K  |  109431 K  |
|       from large pool |     176    |     456    |   62788 K  |   62788 K  |
|       from small pool |    3434    |    8156    |   46646 K  |   46642 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     170    |     209    |     315    |     145    |
|       from large pool |     128    |     164    |     254    |     126    |
|       from small pool |      42    |      45    |      61    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      70    |    3638    |   67676 K  |   67675 K  |
|       from large pool |      28    |     155    |   41188 K  |   41188 K  |
|       from small pool |      42    |    3610    |   26487 K  |   26487 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6572 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6528 MiB |    828 TiB |    828 TiB |
|       from small pool |      0 KiB |     84 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6572 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6528 MiB |    828 TiB |    828 TiB |
|       from small pool |      0 KiB |     84 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6525 MiB |    828 TiB |    828 TiB |
|       from small pool |      0 KiB |     83 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   6996 MiB |  11632 MiB |   9260 MiB |
|       from large pool |   2318 MiB |   6912 MiB |  11510 MiB |   9192 MiB |
|       from small pool |     54 MiB |     90 MiB |    122 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB |    819 MiB | 484675 GiB | 484675 GiB |
|       from large pool |  30464 KiB |    817 MiB | 476393 GiB | 476393 GiB |
|       from small pool |      0 KiB |     32 MiB |   8281 GiB |   8281 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8333    |  109434 K  |  109434 K  |
|       from large pool |       2    |     456    |   62788 K  |   62788 K  |
|       from small pool |       0    |    8156    |   46646 K  |   46646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8333    |  109434 K  |  109434 K  |
|       from large pool |       2    |     456    |   62788 K  |   62788 K  |
|       from small pool |       0    |    8156    |   46646 K  |   46646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     315    |     251    |
|       from large pool |      37    |     164    |     254    |     217    |
|       from small pool |      27    |      45    |      61    |      34    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3638    |   67677 K  |   67677 K  |
|       from large pool |       4    |     155    |   41188 K  |   41188 K  |
|       from small pool |       0    |    3610    |   26488 K  |   26488 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6572 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6528 MiB |    828 TiB |    828 TiB |
|       from small pool |      0 KiB |     84 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6572 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6528 MiB |    828 TiB |    828 TiB |
|       from small pool |      0 KiB |     84 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB |    836 TiB |    836 TiB |
|       from large pool |  16640 KiB |   6525 MiB |    828 TiB |    828 TiB |
|       from small pool |      0 KiB |     83 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   6996 MiB |  11632 MiB |   9260 MiB |
|       from large pool |   2318 MiB |   6912 MiB |  11510 MiB |   9192 MiB |
|       from small pool |     54 MiB |     90 MiB |    122 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB |    819 MiB | 484675 GiB | 484675 GiB |
|       from large pool |  30464 KiB |    817 MiB | 476393 GiB | 476393 GiB |
|       from small pool |      0 KiB |     32 MiB |   8281 GiB |   8281 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8333    |  109434 K  |  109434 K  |
|       from large pool |       2    |     456    |   62788 K  |   62788 K  |
|       from small pool |       0    |    8156    |   46646 K  |   46646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8333    |  109434 K  |  109434 K  |
|       from large pool |       2    |     456    |   62788 K  |   62788 K  |
|       from small pool |       0    |    8156    |   46646 K  |   46646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     315    |     251    |
|       from large pool |      37    |     164    |     254    |     217    |
|       from small pool |      27    |      45    |      61    |      34    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3638    |   67677 K  |   67677 K  |
|       from large pool |       4    |     155    |   41188 K  |   41188 K  |
|       from small pool |       0    |    3610    |   26488 K  |   26488 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_16_42_25_seed_2_23997706

 Experiment start at: 2024-08-02 16:42:26.023451
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.03910883143544197
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.95710415, 'precision': 0.95739347, 'recall': 0.9571059, 'specificity': 0.9571059, 'f1': 0.9570974, 'auroc': 0.9899535, 'binary_precision': 0.96893144, 'binary_recall': 0.9445054, 'binary_specificity': 0.9697063, 'binary_f1_score': 0.95656246}
confusion matrix:
       0      1
0  28265    883
1   1618  27538
---- Validation: 
scalar performance:
{'acc': 0.9041709, 'precision': 0.5957304, 'recall': 0.7955097, 'specificity': 0.7955097, 'f1': 0.6305336, 'auroc': 0.8772427, 'binary_precision': 0.20297767, 'binary_recall': 0.679402, 'binary_specificity': 0.9116174, 'binary_f1_score': 0.31257167}
confusion matrix:
       0     1
0  16565  1606
1    193   409
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93043756, 'precision': 0.66262716, 'recall': 0.86666095, 'specificity': 0.86666095, 'f1': 0.716752, 'auroc': 0.9132155, 'binary_precision': 0.33391005, 'binary_recall': 0.79752064, 'binary_specificity': 0.9358012, 'binary_f1_score': 0.4707317}
confusion matrix:
      0    1
0  5612  385
1    49  193
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 17:24:49.600584,epoch time: 0:42:23.577133,used: 0:42:23.577133,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_16_42_25_seed_2_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9697791, 'precision': 0.9702365, 'recall': 0.96978235, 'specificity': 0.96978235, 'f1': 0.9697719, 'auroc': 0.9947829, 'binary_precision': 0.98495364, 'binary_recall': 0.9541464, 'binary_specificity': 0.98541826, 'binary_f1_score': 0.9693053}
confusion matrix:
       0      1
0  28721    425
1   1337  27821
---- Validation: 
scalar performance:
{'acc': 0.91237414, 'precision': 0.60273516, 'recall': 0.7933228, 'specificity': 0.7933228, 'f1': 0.6404404, 'auroc': 0.8796947, 'binary_precision': 0.21734418, 'binary_recall': 0.66611296, 'binary_specificity': 0.9205327, 'binary_f1_score': 0.32774827}
confusion matrix:
       0     1
0  16727  1444
1    201   401
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9241866, 'precision': 0.6476258, 'recall': 0.8415992, 'specificity': 0.8415992, 'f1': 0.6971271, 'auroc': 0.89944905, 'binary_precision': 0.30588236, 'binary_recall': 0.75206614, 'binary_specificity': 0.93113226, 'binary_f1_score': 0.43488652}
confusion matrix:
      0    1
0  5584  413
1    60  182
better model found
persisted
after epoch: 2,now: 2024-08-02 18:06:26.243127,epoch time: 0:41:36.642543,used: 1:24:00.219676,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_16_42_25_seed_2_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9752161, 'precision': 0.9753715, 'recall': 0.97521734, 'specificity': 0.97521734, 'f1': 0.9752141, 'auroc': 0.9964497, 'binary_precision': 0.9840011, 'binary_recall': 0.9661476, 'binary_specificity': 0.9842871, 'binary_f1_score': 0.97499263}
confusion matrix:
       0      1
0  28690    458
1    987  28169
---- Validation: 
scalar performance:
{'acc': 0.9065147, 'precision': 0.59440154, 'recall': 0.78065944, 'specificity': 0.78065944, 'f1': 0.6285107, 'auroc': 0.868286, 'binary_precision': 0.20145002, 'binary_recall': 0.6461794, 'binary_specificity': 0.9151395, 'binary_f1_score': 0.30714566}
confusion matrix:
       0     1
0  16629  1542
1    213   389
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9105626, 'precision': 0.6244785, 'recall': 0.8166677, 'specificity': 0.8166677, 'f1': 0.66726595, 'auroc': 0.88694346, 'binary_precision': 0.2613293, 'binary_recall': 0.71487606, 'binary_specificity': 0.91845924, 'binary_f1_score': 0.38274333}
confusion matrix:
      0    1
0  5508  489
1    69  173
early stop counter: 1
val acc:0.9065147042274475, best validation acc: 0.9123741388320923, corresponding to test acc:                         0.9241865873336792 / 0.9304375648498535
after epoch: 3,now: 2024-08-02 18:48:06.733419,epoch time: 0:41:40.490292,used: 2:05:40.709968,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_16_42_25_seed_2_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97796035, 'precision': 0.978004, 'recall': 0.9779612, 'specificity': 0.9779612, 'f1': 0.9779599, 'auroc': 0.99731195, 'binary_precision': 0.9826153, 'binary_recall': 0.97314537, 'binary_specificity': 0.98277694, 'binary_f1_score': 0.9778574}
confusion matrix:
       0      1
0  28645    502
1    783  28374
---- Validation: 
scalar performance:
{'acc': 0.8529803, 'precision': 0.56976396, 'recall': 0.8076128, 'specificity': 0.8076128, 'f1': 0.58364594, 'auroc': 0.86986005, 'binary_precision': 0.14876302, 'binary_recall': 0.7591362, 'binary_specificity': 0.85608935, 'binary_f1_score': 0.24877518}
confusion matrix:
       0     1
0  15556  2615
1    145   457
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8592723, 'precision': 0.58609384, 'recall': 0.81179774, 'specificity': 0.81179774, 'f1': 0.6085878, 'auroc': 0.8807045, 'binary_precision': 0.18326694, 'binary_recall': 0.76033056, 'binary_specificity': 0.863265, 'binary_f1_score': 0.29534513}
confusion matrix:
      0    1
0  5177  820
1    58  184
early stop counter: 2
val acc:0.8529803156852722, best validation acc: 0.9123741388320923, corresponding to test acc:                         0.9241865873336792 / 0.9304375648498535
after epoch: 4,now: 2024-08-02 19:29:47.635706,epoch time: 0:41:40.902287,used: 2:47:21.612255,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_16_42_25_seed_2_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9804988, 'precision': 0.98055494, 'recall': 0.9804995, 'specificity': 0.9804995, 'f1': 0.9804982, 'auroc': 0.9975107, 'binary_precision': 0.98578316, 'binary_recall': 0.9750652, 'binary_specificity': 0.98593384, 'binary_f1_score': 0.98039484}
confusion matrix:
       0      1
0  28738    410
1    727  28429
---- Validation: 
scalar performance:
{'acc': 0.89772546, 'precision': 0.5926869, 'recall': 0.80502903, 'specificity': 0.80502903, 'f1': 0.62582433, 'auroc': 0.88157713, 'binary_precision': 0.19603321, 'binary_recall': 0.70598006, 'binary_specificity': 0.90407795, 'binary_f1_score': 0.3068592}
confusion matrix:
       0     1
0  16428  1743
1    177   425
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89565635, 'precision': 0.6069273, 'recall': 0.8029655, 'specificity': 0.8029655, 'f1': 0.6432075, 'auroc': 0.8805314, 'binary_precision': 0.22696929, 'binary_recall': 0.70247936, 'binary_specificity': 0.90345174, 'binary_f1_score': 0.34308776}
confusion matrix:
      0    1
0  5418  579
1    72  170
early stop counter: 3
val acc:0.8977254629135132, best validation acc: 0.9123741388320923, corresponding to test acc:                         0.9241865873336792 / 0.9304375648498535
after epoch: 5,now: 2024-08-02 20:11:27.152779,epoch time: 0:41:39.517073,used: 3:29:01.129328,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_16_42_25_seed_2_23997706
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 3:29:01.129328 at 2024-08-02 20:11:27.152779
persisted model performance metric: 

scalar performance:
{'acc': 0.9241866, 'precision': 0.6476258, 'recall': 0.8415992, 'specificity': 0.8415992, 'f1': 0.6971271, 'auroc': 0.89944905, 'binary_precision': 0.30588236, 'binary_recall': 0.75206614, 'binary_specificity': 0.93113226, 'binary_f1_score': 0.43488652}
confusion matrix:
      0    1
0  5584  413
1    60  182
oracle model performance metric: 

scalar performance:
{'acc': 0.93043756, 'precision': 0.66262716, 'recall': 0.86666095, 'specificity': 0.86666095, 'f1': 0.716752, 'auroc': 0.9132155, 'binary_precision': 0.33391005, 'binary_recall': 0.79752064, 'binary_specificity': 0.9358012, 'binary_f1_score': 0.4707317}
confusion matrix:
      0    1
0  5612  385
1    49  193
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/3.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/3.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1921 MiB |   6572 MiB |   1307 TiB |   1307 TiB |
|       from large pool |   1878 MiB |   6529 MiB |   1294 TiB |   1294 TiB |
|       from small pool |     43 MiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   1921 MiB |   6572 MiB |   1307 TiB |   1307 TiB |
|       from large pool |   1878 MiB |   6529 MiB |   1294 TiB |   1294 TiB |
|       from small pool |     43 MiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1917 MiB |   6568 MiB |   1306 TiB |   1306 TiB |
|       from large pool |   1874 MiB |   6525 MiB |   1294 TiB |   1294 TiB |
|       from small pool |     42 MiB |     83 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6988 MiB |   6996 MiB |  16248 MiB |   9260 MiB |
|       from large pool |   6904 MiB |   6912 MiB |  16096 MiB |   9192 MiB |
|       from small pool |     84 MiB |     90 MiB |    152 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 501955 KiB |    819 MiB |    787 TiB |    787 TiB |
|       from large pool | 491373 KiB |    817 MiB |    774 TiB |    774 TiB |
|       from small pool |  10582 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    3622    |    8419    |  170929 K  |  170925 K  |
|       from large pool |     176    |     456    |   98099 K  |   98099 K  |
|       from small pool |    3446    |    8242    |   72829 K  |   72826 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3622    |    8419    |  170929 K  |  170925 K  |
|       from large pool |     176    |     456    |   98099 K  |   98099 K  |
|       from small pool |    3446    |    8242    |   72829 K  |   72826 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     168    |     209    |     419    |     251    |
|       from large pool |     126    |     164    |     343    |     217    |
|       from small pool |      42    |      45    |      76    |      34    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      72    |    3681    |  106139 K  |  106139 K  |
|       from large pool |      29    |     155    |   64742 K  |   64742 K  |
|       from small pool |      43    |    3652    |   41396 K  |   41396 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6572 MiB |   1307 TiB |   1307 TiB |
|       from large pool |  16640 KiB |   6529 MiB |   1294 TiB |   1294 TiB |
|       from small pool |      0 KiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6572 MiB |   1307 TiB |   1307 TiB |
|       from large pool |  16640 KiB |   6529 MiB |   1294 TiB |   1294 TiB |
|       from small pool |      0 KiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB |   1306 TiB |   1306 TiB |
|       from large pool |  16640 KiB |   6525 MiB |   1294 TiB |   1294 TiB |
|       from small pool |      0 KiB |     83 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2412 MiB |   6996 MiB |  16248 MiB |  13836 MiB |
|       from large pool |   2358 MiB |   6912 MiB |  16096 MiB |  13738 MiB |
|       from small pool |     54 MiB |     90 MiB |    152 MiB |     98 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB |    819 MiB |    787 TiB |    787 TiB |
|       from large pool |  30464 KiB |    817 MiB |    774 TiB |    774 TiB |
|       from small pool |      0 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8419    |  170929 K  |  170929 K  |
|       from large pool |       2    |     456    |   98099 K  |   98099 K  |
|       from small pool |       0    |    8242    |   72829 K  |   72829 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8419    |  170929 K  |  170929 K  |
|       from large pool |       2    |     456    |   98099 K  |   98099 K  |
|       from small pool |       0    |    8242    |   72829 K  |   72829 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     419    |     355    |
|       from large pool |      37    |     164    |     343    |     306    |
|       from small pool |      27    |      45    |      76    |      49    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3681    |  106140 K  |  106140 K  |
|       from large pool |       4    |     155    |   64742 K  |   64742 K  |
|       from small pool |       0    |    3652    |   41397 K  |   41397 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 20:12:56 2024]
Finished job 0.
1 of 1 steps (100%) done
