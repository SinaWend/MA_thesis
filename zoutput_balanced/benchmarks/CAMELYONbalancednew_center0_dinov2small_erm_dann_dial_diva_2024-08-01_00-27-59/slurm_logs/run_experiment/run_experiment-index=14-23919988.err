Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 16:52:32 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/14.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=14
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_01_15_seed_0_23919988

 Experiment start at: 2024-08-01 17:01:15.751823
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.948152, 'precision': 0.9499653, 'recall': 0.9481753, 'specificity': 0.9481753, 'f1': 0.9481016, 'auroc': 0.98601055, 'binary_precision': 0.9787131, 'binary_recall': 0.91630954, 'binary_specificity': 0.98004115, 'binary_f1_score': 0.94648385}
confusion matrix:
       0      1
0  28087    572
1   2402  26299
---- Validation: 
scalar performance:
{'acc': 0.90868455, 'precision': 0.6022884, 'recall': 0.78171206, 'specificity': 0.78171206, 'f1': 0.6385131, 'auroc': 0.8874661, 'binary_precision': 0.21807672, 'binary_recall': 0.64541215, 'binary_specificity': 0.918012, 'binary_f1_score': 0.32600158}
confusion matrix:
       0     1
0  16661  1488
1    228   415
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9044423, 'precision': 0.6329134, 'recall': 0.8511957, 'specificity': 0.8511957, 'f1': 0.67855453, 'auroc': 0.91464317, 'binary_precision': 0.2756325, 'binary_recall': 0.79310346, 'binary_specificity': 0.909288, 'binary_f1_score': 0.4090909}
confusion matrix:
      0    1
0  5453  544
1    54  207
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 17:35:54.613124,epoch time: 0:34:38.861301,used: 0:34:38.861301,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_01_15_seed_0_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9620816, 'precision': 0.9627218, 'recall': 0.962096, 'specificity': 0.962096, 'f1': 0.9620693, 'auroc': 0.9919667, 'binary_precision': 0.9801267, 'binary_recall': 0.9433489, 'binary_specificity': 0.98084307, 'binary_f1_score': 0.96138626}
confusion matrix:
       0      1
0  28109    549
1   1626  27076
---- Validation: 
scalar performance:
{'acc': 0.9077267, 'precision': 0.60809493, 'recall': 0.8112184, 'specificity': 0.8112184, 'f1': 0.6472738, 'auroc': 0.9014007, 'binary_precision': 0.22738631, 'binary_recall': 0.7076205, 'binary_specificity': 0.91481626, 'binary_f1_score': 0.3441755}
confusion matrix:
       0     1
0  16603  1546
1    188   455
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87200385, 'precision': 0.6079859, 'recall': 0.8562586, 'specificity': 0.8562586, 'f1': 0.6412407, 'auroc': 0.92438936, 'binary_precision': 0.22392638, 'binary_recall': 0.83908045, 'binary_specificity': 0.8734367, 'binary_f1_score': 0.35351086}
confusion matrix:
      0    1
0  5238  759
1    42  219
early stop counter: 1
val acc:0.9077267050743103, best validation acc: 0.9086845517158508, corresponding to test acc:                         0.904442310333252 / 0.904442310333252
after epoch: 2,now: 2024-08-01 18:09:40.831009,epoch time: 0:33:46.217885,used: 1:08:25.079186,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_01_15_seed_0_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.969735, 'precision': 0.9702132, 'recall': 0.96974623, 'specificity': 0.96974623, 'f1': 0.9697279, 'auroc': 0.9950799, 'binary_precision': 0.9853831, 'binary_recall': 0.9536585, 'binary_specificity': 0.98583394, 'binary_f1_score': 0.9692613}
confusion matrix:
       0      1
0  28254    406
1   1330  27370
---- Validation: 
scalar performance:
{'acc': 0.89612603, 'precision': 0.59136176, 'recall': 0.7804607, 'specificity': 0.7804607, 'f1': 0.62287426, 'auroc': 0.88611805, 'binary_precision': 0.19600557, 'binary_recall': 0.6562986, 'binary_specificity': 0.90462285, 'binary_f1_score': 0.3018598}
confusion matrix:
       0     1
0  16418  1731
1    221   422
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86561203, 'precision': 0.6028067, 'recall': 0.8492589, 'specificity': 0.8492589, 'f1': 0.6327884, 'auroc': 0.9183089, 'binary_precision': 0.21400395, 'binary_recall': 0.8314176, 'binary_specificity': 0.86710024, 'binary_f1_score': 0.34039217}
confusion matrix:
      0    1
0  5200  797
1    44  217
early stop counter: 2
val acc:0.8961260318756104, best validation acc: 0.9086845517158508, corresponding to test acc:                         0.904442310333252 / 0.904442310333252
after epoch: 3,now: 2024-08-01 18:42:43.736999,epoch time: 0:33:02.905990,used: 1:41:27.985176,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_01_15_seed_0_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9743898, 'precision': 0.9745796, 'recall': 0.9743983, 'specificity': 0.9743983, 'f1': 0.9743876, 'auroc': 0.9957552, 'binary_precision': 0.98428106, 'binary_recall': 0.964221, 'binary_specificity': 0.9845756, 'binary_f1_score': 0.9741478}
confusion matrix:
       0      1
0  28214    442
1   1027  27677
---- Validation: 
scalar performance:
{'acc': 0.90341634, 'precision': 0.59859425, 'recall': 0.7864852, 'specificity': 0.7864852, 'f1': 0.6334859, 'auroc': 0.88607025, 'binary_precision': 0.21018793, 'binary_recall': 0.66096425, 'binary_specificity': 0.9120062, 'binary_f1_score': 0.31894934}
confusion matrix:
       0     1
0  16552  1597
1    218   425
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87631834, 'precision': 0.6085226, 'recall': 0.84568334, 'specificity': 0.84568334, 'f1': 0.64276826, 'auroc': 0.9206563, 'binary_precision': 0.226254, 'binary_recall': 0.8122605, 'binary_specificity': 0.8791062, 'binary_f1_score': 0.3539232}
confusion matrix:
      0    1
0  5272  725
1    49  212
early stop counter: 3
val acc:0.9034163355827332, best validation acc: 0.9086845517158508, corresponding to test acc:                         0.904442310333252 / 0.904442310333252
after epoch: 4,now: 2024-08-01 19:15:47.316857,epoch time: 0:33:03.579858,used: 2:14:31.565034,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_17_01_15_seed_0_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:14:31.565034 at 2024-08-01 19:15:47.316857
persisted model performance metric: 

scalar performance:
{'acc': 0.9044423, 'precision': 0.6329134, 'recall': 0.8511957, 'specificity': 0.8511957, 'f1': 0.67855453, 'auroc': 0.91464317, 'binary_precision': 0.2756325, 'binary_recall': 0.79310346, 'binary_specificity': 0.909288, 'binary_f1_score': 0.4090909}
confusion matrix:
      0    1
0  5453  544
1    54  207
oracle model performance metric: 

scalar performance:
{'acc': 0.9044423, 'precision': 0.6329134, 'recall': 0.8511957, 'specificity': 0.8511957, 'f1': 0.67855453, 'auroc': 0.91464317, 'binary_precision': 0.2756325, 'binary_recall': 0.79310346, 'binary_specificity': 0.909288, 'binary_f1_score': 0.4090909}
confusion matrix:
      0    1
0  5453  544
1    54  207
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/14.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/14.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/14.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198153 KiB |   4047 MiB | 408101 GiB | 408101 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 403450 GiB | 403450 GiB |
|       from small pool |  17491 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198153 KiB |   4047 MiB | 408101 GiB | 408101 GiB |
|       from large pool | 180662 KiB |   4027 MiB | 403450 GiB | 403450 GiB |
|       from small pool |  17491 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195461 KiB |   4045 MiB | 408076 GiB | 408076 GiB |
|       from large pool | 178979 KiB |   4026 MiB | 403430 GiB | 403430 GiB |
|       from small pool |  16482 KiB |     36 MiB |   4645 GiB |   4645 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4438 MiB |   4438 MiB |   4438 MiB |      0 B   |
|       from large pool |   4396 MiB |   4396 MiB |   4396 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  57847 KiB | 392988 KiB | 212274 GiB | 212274 GiB |
|       from large pool |  50762 KiB | 392048 KiB | 207584 GiB | 207584 GiB |
|       from small pool |   7085 KiB |   9888 KiB |   4689 GiB |   4689 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2978    |    7645    |   54125 K  |   54123 K  |
|       from large pool |      79    |     423    |   36924 K  |   36923 K  |
|       from small pool |    2899    |    7565    |   17201 K  |   17199 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2978    |    7645    |   54125 K  |   54123 K  |
|       from large pool |      79    |     423    |   36924 K  |   36923 K  |
|       from small pool |    2899    |    7565    |   17201 K  |   17199 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     203    |     203    |     203    |       0    |
|       from large pool |     182    |     182    |     182    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3605    |   37235 K  |   37235 K  |
|       from large pool |      10    |     183    |   28821 K  |   28821 K  |
|       from small pool |      22    |    3595    |    8413 K  |    8413 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 408101 GiB | 408101 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 403450 GiB | 403450 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 408101 GiB | 408101 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 403450 GiB | 403450 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 408076 GiB | 408076 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 403430 GiB | 403430 GiB |
|       from small pool |      0 KiB |     36 MiB |   4645 GiB |   4645 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   4438 MiB |   4438 MiB |   4188 MiB |
|       from large pool | 231424 KiB |   4396 MiB |   4396 MiB |   4170 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 392988 KiB | 212274 GiB | 212274 GiB |
|       from large pool |  30464 KiB | 392048 KiB | 207584 GiB | 207584 GiB |
|       from small pool |      0 KiB |  18594 KiB |   4689 GiB |   4689 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     203    |     203    |     180    |
|       from large pool |      11    |     182    |     182    |     171    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3605    |   37237 K  |   37237 K  |
|       from large pool |       3    |     183    |   28821 K  |   28821 K  |
|       from small pool |       0    |    3595    |    8415 K  |    8415 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB | 408101 GiB | 408101 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 403450 GiB | 403450 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB | 408101 GiB | 408101 GiB |
|       from large pool |  16640 KiB |   4027 MiB | 403450 GiB | 403450 GiB |
|       from small pool |      0 KiB |     37 MiB |   4650 GiB |   4650 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB | 408076 GiB | 408076 GiB |
|       from large pool |  16640 KiB |   4026 MiB | 403430 GiB | 403430 GiB |
|       from small pool |      0 KiB |     36 MiB |   4645 GiB |   4645 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 256000 KiB |   4438 MiB |   4438 MiB |   4188 MiB |
|       from large pool | 231424 KiB |   4396 MiB |   4396 MiB |   4170 MiB |
|       from small pool |  24576 KiB |     42 MiB |     42 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 392988 KiB | 212274 GiB | 212274 GiB |
|       from large pool |  30464 KiB | 392048 KiB | 207584 GiB | 207584 GiB |
|       from small pool |      0 KiB |  18594 KiB |   4689 GiB |   4689 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7645    |   54125 K  |   54125 K  |
|       from large pool |       2    |     423    |   36924 K  |   36924 K  |
|       from small pool |       0    |    7565    |   17201 K  |   17201 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     203    |     203    |     180    |
|       from large pool |      11    |     182    |     182    |     171    |
|       from small pool |      12    |      21    |      21    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3605    |   37237 K  |   37237 K  |
|       from large pool |       3    |     183    |   28821 K  |   28821 K  |
|       from small pool |       0    |    3595    |    8415 K  |    8415 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988

 Experiment start at: 2024-08-01 19:22:55.411647
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94916344, 'precision': 0.9498087, 'recall': 0.949178, 'specificity': 0.949178, 'f1': 0.9491463, 'auroc': 0.98718125, 'binary_precision': 0.9670381, 'binary_recall': 0.93010753, 'binary_specificity': 0.9682484, 'binary_f1_score': 0.94821334}
confusion matrix:
       0      1
0  27872    914
1   2015  26815
---- Validation: 
scalar performance:
{'acc': 0.9248132, 'precision': 0.61107713, 'recall': 0.7249681, 'specificity': 0.7249681, 'f1': 0.6438136, 'auroc': 0.86010456, 'binary_precision': 0.24120957, 'binary_recall': 0.5096582, 'binary_specificity': 0.9402779, 'binary_f1_score': 0.3274463}
confusion matrix:
       0     1
0  16988  1079
1    330   343
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.94166934, 'precision': 0.68484455, 'recall': 0.80588955, 'specificity': 0.80588955, 'f1': 0.7274382, 'auroc': 0.91186774, 'binary_precision': 0.38513514, 'binary_recall': 0.6576923, 'binary_specificity': 0.9540868, 'binary_f1_score': 0.48579547}
confusion matrix:
      0    1
0  5673  273
1    89  171
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 19:57:08.210622,epoch time: 0:34:12.798975,used: 0:34:12.798975,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9606012, 'precision': 0.96180165, 'recall': 0.960619, 'specificity': 0.960619, 'f1': 0.96057665, 'auroc': 0.9928428, 'binary_precision': 0.985521, 'binary_recall': 0.93499374, 'binary_specificity': 0.98624426, 'binary_f1_score': 0.9595927}
confusion matrix:
       0      1
0  28392    396
1   1874  26954
---- Validation: 
scalar performance:
{'acc': 0.93313766, 'precision': 0.6402391, 'recall': 0.7829304, 'specificity': 0.7829304, 'f1': 0.6823935, 'auroc': 0.8819196, 'binary_precision': 0.29519773, 'binary_recall': 0.62109953, 'binary_specificity': 0.94476116, 'binary_f1_score': 0.40019146}
confusion matrix:
       0    1
0  17069  998
1    255  418
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9270061, 'precision': 0.6629268, 'recall': 0.84972894, 'specificity': 0.84972894, 'f1': 0.7142508, 'auroc': 0.9253739, 'binary_precision': 0.33671743, 'binary_recall': 0.7653846, 'binary_specificity': 0.9340733, 'binary_f1_score': 0.46768504}
confusion matrix:
      0    1
0  5554  392
1    61  199
better model found
persisted
after epoch: 2,now: 2024-08-01 20:30:36.143007,epoch time: 0:33:27.932385,used: 1:07:40.731360,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.96527004, 'precision': 0.9661544, 'recall': 0.9652868, 'specificity': 0.9652868, 'f1': 0.9652544, 'auroc': 0.994704, 'binary_precision': 0.98664975, 'binary_recall': 0.9433576, 'binary_specificity': 0.987216, 'binary_f1_score': 0.96451813}
confusion matrix:
       0      1
0  28418    368
1   1633  27197
---- Validation: 
scalar performance:
{'acc': 0.9350053, 'precision': 0.6474952, 'recall': 0.79891956, 'specificity': 0.79891956, 'f1': 0.69223535, 'auroc': 0.89226484, 'binary_precision': 0.30850315, 'binary_recall': 0.6523031, 'binary_specificity': 0.9455361, 'binary_f1_score': 0.4188931}
confusion matrix:
       0    1
0  17083  984
1    234  439
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9318402, 'precision': 0.6716123, 'recall': 0.85041267, 'specificity': 0.85041267, 'f1': 0.72351444, 'auroc': 0.9273345, 'binary_precision': 0.35420394, 'binary_recall': 0.76153845, 'binary_specificity': 0.9392869, 'binary_f1_score': 0.48351648}
confusion matrix:
      0    1
0  5585  361
1    62  198
better model found
persisted
after epoch: 3,now: 2024-08-01 21:03:50.456350,epoch time: 0:33:14.313343,used: 1:40:55.044703,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9728895, 'precision': 0.9731884, 'recall': 0.9728987, 'specificity': 0.9728987, 'f1': 0.9728856, 'auroc': 0.99618375, 'binary_precision': 0.9852643, 'binary_recall': 0.960179, 'binary_specificity': 0.98561853, 'binary_f1_score': 0.9725599}
confusion matrix:
       0      1
0  28373    414
1   1148  27681
---- Validation: 
scalar performance:
{'acc': 0.92187834, 'precision': 0.6260153, 'recall': 0.79783374, 'specificity': 0.79783374, 'f1': 0.66872585, 'auroc': 0.8876312, 'binary_precision': 0.2652819, 'binary_recall': 0.6641902, 'binary_specificity': 0.9314773, 'binary_f1_score': 0.37913483}
confusion matrix:
       0     1
0  16829  1238
1    226   447
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9034805, 'precision': 0.63220084, 'recall': 0.85032475, 'specificity': 0.85032475, 'f1': 0.67748904, 'auroc': 0.9255816, 'binary_precision': 0.27430093, 'binary_recall': 0.7923077, 'binary_specificity': 0.90834177, 'binary_f1_score': 0.40751728}
confusion matrix:
      0    1
0  5401  545
1    54  206
early stop counter: 1
val acc:0.9218783378601074, best validation acc: 0.9350053071975708, corresponding to test acc:                         0.931840181350708 / 0.9416693449020386
after epoch: 4,now: 2024-08-01 21:37:46.070755,epoch time: 0:33:55.614405,used: 2:14:50.659108,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9748681, 'precision': 0.97517484, 'recall': 0.9748775, 'specificity': 0.9748775, 'f1': 0.97486436, 'auroc': 0.99644554, 'binary_precision': 0.9874319, 'binary_recall': 0.9620174, 'binary_specificity': 0.98773754, 'binary_f1_score': 0.974559}
confusion matrix:
       0      1
0  28434    353
1   1095  27734
---- Validation: 
scalar performance:
{'acc': 0.9272145, 'precision': 0.6344225, 'recall': 0.80060124, 'specificity': 0.80060124, 'f1': 0.6785999, 'auroc': 0.8928267, 'binary_precision': 0.28201893, 'binary_recall': 0.6641902, 'binary_specificity': 0.93701226, 'binary_f1_score': 0.3959256}
confusion matrix:
       0     1
0  16929  1138
1    226   447
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91959393, 'precision': 0.65148526, 'recall': 0.8495388, 'specificity': 0.8495388, 'f1': 0.70141053, 'auroc': 0.92738795, 'binary_precision': 0.31357256, 'binary_recall': 0.77307695, 'binary_specificity': 0.92600065, 'binary_f1_score': 0.44617093}
confusion matrix:
      0    1
0  5506  440
1    59  201
early stop counter: 2
val acc:0.927214503288269, best validation acc: 0.9350053071975708, corresponding to test acc:                         0.931840181350708 / 0.9416693449020386
after epoch: 5,now: 2024-08-01 22:10:43.077131,epoch time: 0:32:57.006376,used: 2:47:47.665484,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.97632605, 'precision': 0.97636735, 'recall': 0.9763293, 'specificity': 0.9763293, 'f1': 0.97632563, 'auroc': 0.9970966, 'binary_precision': 0.98098075, 'binary_recall': 0.9715207, 'binary_specificity': 0.981138, 'binary_f1_score': 0.97622776}
confusion matrix:
       0      1
0  28245    543
1    821  28007
---- Validation: 
scalar performance:
{'acc': 0.9188367, 'precision': 0.6241436, 'recall': 0.80698526, 'specificity': 0.80698526, 'f1': 0.66725016, 'auroc': 0.8955449, 'binary_precision': 0.26072234, 'binary_recall': 0.68647844, 'binary_specificity': 0.92749214, 'binary_f1_score': 0.3779141}
confusion matrix:
       0     1
0  16757  1310
1    211   462
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9165324, 'precision': 0.6477189, 'recall': 0.85161906, 'specificity': 0.85161906, 'f1': 0.6971517, 'auroc': 0.9289677, 'binary_precision': 0.3057229, 'binary_recall': 0.7807692, 'binary_specificity': 0.9224689, 'binary_f1_score': 0.43939397}
confusion matrix:
      0    1
0  5485  461
1    57  203
early stop counter: 3
val acc:0.9188367128372192, best validation acc: 0.9350053071975708, corresponding to test acc:                         0.931840181350708 / 0.9416693449020386
after epoch: 6,now: 2024-08-01 22:43:39.642669,epoch time: 0:32:56.565538,used: 3:20:44.231022,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_19_22_55_seed_1_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 3:20:44.231022 at 2024-08-01 22:43:39.642669
persisted model performance metric: 

scalar performance:
{'acc': 0.9318402, 'precision': 0.6716123, 'recall': 0.85041267, 'specificity': 0.85041267, 'f1': 0.72351444, 'auroc': 0.9273345, 'binary_precision': 0.35420394, 'binary_recall': 0.76153845, 'binary_specificity': 0.9392869, 'binary_f1_score': 0.48351648}
confusion matrix:
      0    1
0  5585  361
1    62  198
oracle model performance metric: 

scalar performance:
{'acc': 0.94166934, 'precision': 0.68484455, 'recall': 0.80588955, 'specificity': 0.80588955, 'f1': 0.7274382, 'auroc': 0.91186774, 'binary_precision': 0.38513514, 'binary_recall': 0.6576923, 'binary_specificity': 0.9540868, 'binary_f1_score': 0.48579547}
confusion matrix:
      0    1
0  5673  273
1    89  171
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/14.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/14.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196690 KiB |   4047 MiB |    997 TiB |    997 TiB |
|       from large pool | 179211 KiB |   4027 MiB |    986 TiB |    986 TiB |
|       from small pool |  17479 KiB |     37 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196690 KiB |   4047 MiB |    997 TiB |    997 TiB |
|       from large pool | 179211 KiB |   4027 MiB |    986 TiB |    986 TiB |
|       from small pool |  17479 KiB |     37 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   4045 MiB |    997 TiB |    997 TiB |
|       from large pool | 178979 KiB |   4026 MiB |    985 TiB |    985 TiB |
|       from small pool |  16480 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4420 MiB |   4438 MiB |   8608 MiB |   4188 MiB |
|       from large pool |   4382 MiB |   4396 MiB |   8552 MiB |   4170 MiB |
|       from small pool |     38 MiB |     42 MiB |     56 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  38830 KiB | 398560 KiB | 540484 GiB | 540484 GiB |
|       from large pool |  31733 KiB | 397444 KiB | 528784 GiB | 528784 GiB |
|       from small pool |   7097 KiB |  18594 KiB |  11700 GiB |  11700 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7677    |  135297 K  |  135294 K  |
|       from large pool |      79    |     423    |   92397 K  |   92397 K  |
|       from small pool |    2875    |    7597    |   42899 K  |   42896 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7677    |  135297 K  |  135294 K  |
|       from large pool |      79    |     423    |   92397 K  |   92397 K  |
|       from small pool |    2875    |    7597    |   42899 K  |   42896 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     203    |     380    |     180    |
|       from large pool |     181    |     182    |     352    |     171    |
|       from small pool |      19    |      21    |      28    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3620    |   92190 K  |   92190 K  |
|       from large pool |      11    |     186    |   71206 K  |   71206 K  |
|       from small pool |      21    |    3609    |   20983 K  |   20983 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |    997 TiB |    997 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    986 TiB |    986 TiB |
|       from small pool |      0 KiB |     37 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |    997 TiB |    997 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    986 TiB |    986 TiB |
|       from small pool |      0 KiB |     37 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |    997 TiB |    997 TiB |
|       from large pool |  16640 KiB |   4026 MiB |    985 TiB |    985 TiB |
|       from small pool |      0 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB |   4438 MiB |   8608 MiB |   8378 MiB |
|       from large pool | 210944 KiB |   4396 MiB |   8552 MiB |   8346 MiB |
|       from small pool |  24576 KiB |     42 MiB |     56 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398560 KiB | 540485 GiB | 540484 GiB |
|       from large pool |  30464 KiB | 397444 KiB | 528784 GiB | 528784 GiB |
|       from small pool |      0 KiB |  19405 KiB |  11700 GiB |  11700 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |  135297 K  |  135297 K  |
|       from large pool |       2    |     423    |   92397 K  |   92397 K  |
|       from small pool |       0    |    7597    |   42899 K  |   42899 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |  135297 K  |  135297 K  |
|       from large pool |       2    |     423    |   92397 K  |   92397 K  |
|       from small pool |       0    |    7597    |   42899 K  |   42899 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     203    |     380    |     358    |
|       from large pool |      10    |     182    |     352    |     342    |
|       from small pool |      12    |      21    |      28    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3620    |   92191 K  |   92191 K  |
|       from large pool |       3    |     186    |   71206 K  |   71206 K  |
|       from small pool |       0    |    3609    |   20984 K  |   20984 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |    997 TiB |    997 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    986 TiB |    986 TiB |
|       from small pool |      0 KiB |     37 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |    997 TiB |    997 TiB |
|       from large pool |  16640 KiB |   4027 MiB |    986 TiB |    986 TiB |
|       from small pool |      0 KiB |     37 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |    997 TiB |    997 TiB |
|       from large pool |  16640 KiB |   4026 MiB |    985 TiB |    985 TiB |
|       from small pool |      0 KiB |     36 MiB |     11 TiB |     11 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB |   4438 MiB |   8608 MiB |   8378 MiB |
|       from large pool | 210944 KiB |   4396 MiB |   8552 MiB |   8346 MiB |
|       from small pool |  24576 KiB |     42 MiB |     56 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 398560 KiB | 540485 GiB | 540484 GiB |
|       from large pool |  30464 KiB | 397444 KiB | 528784 GiB | 528784 GiB |
|       from small pool |      0 KiB |  19405 KiB |  11700 GiB |  11700 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |  135297 K  |  135297 K  |
|       from large pool |       2    |     423    |   92397 K  |   92397 K  |
|       from small pool |       0    |    7597    |   42899 K  |   42899 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |  135297 K  |  135297 K  |
|       from large pool |       2    |     423    |   92397 K  |   92397 K  |
|       from small pool |       0    |    7597    |   42899 K  |   42899 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     203    |     380    |     358    |
|       from large pool |      10    |     182    |     352    |     342    |
|       from small pool |      12    |      21    |      28    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3620    |   92191 K  |   92191 K  |
|       from large pool |       3    |     186    |   71206 K  |   71206 K  |
|       from small pool |       0    |    3609    |   20984 K  |   20984 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_22_50_50_seed_2_23919988

 Experiment start at: 2024-08-01 22:50:51.169199
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9487514, 'precision': 0.9500948, 'recall': 0.9487542, 'specificity': 0.9487542, 'f1': 0.9487133, 'auroc': 0.98679936, 'binary_precision': 0.97471064, 'binary_recall': 0.92142, 'binary_specificity': 0.97608835, 'binary_f1_score': 0.94731647}
confusion matrix:
       0      1
0  28452    697
1   2291  26864
---- Validation: 
scalar performance:
{'acc': 0.92872745, 'precision': 0.60883826, 'recall': 0.7391326, 'specificity': 0.7391326, 'f1': 0.6439902, 'auroc': 0.8517413, 'binary_precision': 0.23371924, 'binary_recall': 0.53654486, 'binary_specificity': 0.9417203, 'binary_f1_score': 0.32560483}
confusion matrix:
       0     1
0  17112  1059
1    279   323
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90383077, 'precision': 0.61482316, 'recall': 0.8052349, 'specificity': 0.8052349, 'f1': 0.65417403, 'auroc': 0.8819589, 'binary_precision': 0.24281609, 'binary_recall': 0.6983471, 'binary_specificity': 0.9121227, 'binary_f1_score': 0.36034113}
confusion matrix:
      0    1
0  5470  527
1    73  169
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 23:24:47.668476,epoch time: 0:33:56.499277,used: 0:33:56.499277,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_22_50_50_seed_2_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9618208, 'precision': 0.96274126, 'recall': 0.9618239, 'specificity': 0.9618239, 'f1': 0.961802, 'auroc': 0.99257827, 'binary_precision': 0.9834135, 'binary_recall': 0.9394979, 'binary_specificity': 0.9841499, 'binary_f1_score': 0.9609542}
confusion matrix:
       0      1
0  28686    462
1   1764  27392
---- Validation: 
scalar performance:
{'acc': 0.94252384, 'precision': 0.636982, 'recall': 0.75027454, 'specificity': 0.75027454, 'f1': 0.6739838, 'auroc': 0.87145305, 'binary_precision': 0.2894969, 'binary_recall': 0.54485047, 'binary_specificity': 0.95569867, 'binary_f1_score': 0.37809795}
confusion matrix:
       0    1
0  17366  805
1    274  328
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9342843, 'precision': 0.66346055, 'recall': 0.83495533, 'specificity': 0.83495533, 'f1': 0.7134737, 'auroc': 0.91055787, 'binary_precision': 0.33846155, 'binary_recall': 0.72727275, 'binary_specificity': 0.942638, 'binary_f1_score': 0.4619423}
confusion matrix:
      0    1
0  5653  344
1    66  176
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-01 23:58:02.169734,epoch time: 0:33:14.501258,used: 1:07:11.000535,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_22_50_50_seed_2_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9702765, 'precision': 0.97066045, 'recall': 0.9702789, 'specificity': 0.9702789, 'f1': 0.9702705, 'auroc': 0.99521756, 'binary_precision': 0.9841466, 'binary_recall': 0.95596254, 'binary_specificity': 0.9845953, 'binary_f1_score': 0.9698499}
confusion matrix:
       0      1
0  28698    449
1   1284  27873
---- Validation: 
scalar performance:
{'acc': 0.9378362, 'precision': 0.63155067, 'recall': 0.7671263, 'specificity': 0.7671263, 'f1': 0.6717787, 'auroc': 0.8784467, 'binary_precision': 0.27738377, 'binary_recall': 0.58471763, 'binary_specificity': 0.94953495, 'binary_f1_score': 0.37626937}
confusion matrix:
       0    1
0  17254  917
1    250  352
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9326815, 'precision': 0.66263074, 'recall': 0.8460181, 'specificity': 0.8460181, 'f1': 0.71418494, 'auroc': 0.91737056, 'binary_precision': 0.33579335, 'binary_recall': 0.75206614, 'binary_specificity': 0.93996996, 'binary_f1_score': 0.4642857}
confusion matrix:
      0    1
0  5637  360
1    60  182
early stop counter: 1
val acc:0.937836229801178, best validation acc: 0.9425238370895386, corresponding to test acc:                         0.9342843294143677 / 0.9342843294143677
after epoch: 3,now: 2024-08-02 00:31:25.471995,epoch time: 0:33:23.302261,used: 1:40:34.302796,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_22_50_50_seed_2_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9733294, 'precision': 0.97367567, 'recall': 0.9733323, 'specificity': 0.9733323, 'f1': 0.9733247, 'auroc': 0.9959576, 'binary_precision': 0.98653364, 'binary_recall': 0.9597709, 'binary_specificity': 0.9868936, 'binary_f1_score': 0.9729683}
confusion matrix:
       0      1
0  28764    382
1   1173  27985
---- Validation: 
scalar performance:
{'acc': 0.92281467, 'precision': 0.6134817, 'recall': 0.7890794, 'specificity': 0.7890794, 'f1': 0.65416145, 'auroc': 0.88877, 'binary_precision': 0.23938462, 'binary_recall': 0.6461794, 'binary_specificity': 0.93197954, 'binary_f1_score': 0.34934893}
confusion matrix:
       0     1
0  16935  1236
1    213   389
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9203398, 'precision': 0.6453695, 'recall': 0.85744286, 'specificity': 0.85744286, 'f1': 0.69586813, 'auroc': 0.9194232, 'binary_precision': 0.299843, 'binary_recall': 0.7892562, 'binary_specificity': 0.9256295, 'binary_f1_score': 0.43458477}
confusion matrix:
      0    1
0  5551  446
1    51  191
early stop counter: 2
val acc:0.922814667224884, best validation acc: 0.9425238370895386, corresponding to test acc:                         0.9342843294143677 / 0.9342843294143677
after epoch: 4,now: 2024-08-02 01:04:45.966032,epoch time: 0:33:20.494037,used: 2:13:54.796833,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_22_50_50_seed_2_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9756277, 'precision': 0.97568655, 'recall': 0.97562885, 'specificity': 0.97562885, 'f1': 0.975627, 'auroc': 0.9963563, 'binary_precision': 0.98102736, 'binary_recall': 0.97002536, 'binary_specificity': 0.9812324, 'binary_f1_score': 0.97549534}
confusion matrix:
       0      1
0  28599    547
1    874  28284
---- Validation: 
scalar performance:
{'acc': 0.9196719, 'precision': 0.6103897, 'recall': 0.7922743, 'specificity': 0.7922743, 'f1': 0.6504973, 'auroc': 0.8879186, 'binary_precision': 0.23290095, 'binary_recall': 0.65614617, 'binary_specificity': 0.9284024, 'binary_f1_score': 0.3437772}
confusion matrix:
       0     1
0  16870  1301
1    207   395
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91120374, 'precision': 0.6309244, 'recall': 0.8427768, 'specificity': 0.8427768, 'f1': 0.67688537, 'auroc': 0.9171845, 'binary_precision': 0.27192983, 'binary_recall': 0.76859504, 'binary_specificity': 0.91695845, 'binary_f1_score': 0.40172789}
confusion matrix:
      0    1
0  5499  498
1    56  186
early stop counter: 3
val acc:0.919671893119812, best validation acc: 0.9425238370895386, corresponding to test acc:                         0.9342843294143677 / 0.9342843294143677
after epoch: 5,now: 2024-08-02 01:38:05.487344,epoch time: 0:33:19.521312,used: 2:47:14.318145,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_08md_01_22_50_50_seed_2_23919988
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 5 with time: 2:47:14.318145 at 2024-08-02 01:38:05.487344
persisted model performance metric: 

scalar performance:
{'acc': 0.9342843, 'precision': 0.66346055, 'recall': 0.83495533, 'specificity': 0.83495533, 'f1': 0.7134737, 'auroc': 0.91055787, 'binary_precision': 0.33846155, 'binary_recall': 0.72727275, 'binary_specificity': 0.942638, 'binary_f1_score': 0.4619423}
confusion matrix:
      0    1
0  5653  344
1    66  176
oracle model performance metric: 

scalar performance:
{'acc': 0.9342843, 'precision': 0.66346055, 'recall': 0.83495533, 'specificity': 0.83495533, 'f1': 0.7134737, 'auroc': 0.91055787, 'binary_precision': 0.33846155, 'binary_recall': 0.72727275, 'binary_specificity': 0.942638, 'binary_f1_score': 0.4619423}
confusion matrix:
      0    1
0  5653  344
1    66  176
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/14.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/14.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 196696 KiB |   4047 MiB |   1502 TiB |   1502 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1485 TiB |   1485 TiB |
|       from small pool |  17485 KiB |     37 MiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 196696 KiB |   4047 MiB |   1502 TiB |   1502 TiB |
|       from large pool | 179211 KiB |   4027 MiB |   1485 TiB |   1485 TiB |
|       from small pool |  17485 KiB |     37 MiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195460 KiB |   4045 MiB |   1502 TiB |   1502 TiB |
|       from large pool | 178979 KiB |   4026 MiB |   1485 TiB |   1485 TiB |
|       from small pool |  16481 KiB |     36 MiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4422 MiB |   4438 MiB |  12800 MiB |   8378 MiB |
|       from large pool |   4384 MiB |   4396 MiB |  12730 MiB |   8346 MiB |
|       from small pool |     38 MiB |     42 MiB |     70 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40872 KiB | 400608 KiB |    798 TiB |    798 TiB |
|       from large pool |  31733 KiB | 399492 KiB |    780 TiB |    780 TiB |
|       from small pool |   9139 KiB |  19405 KiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7763    |  203803 K  |  203800 K  |
|       from large pool |      79    |     423    |  139204 K  |  139204 K  |
|       from small pool |    2887    |    7683    |   64598 K  |   64595 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7763    |  203803 K  |  203800 K  |
|       from large pool |      79    |     423    |  139204 K  |  139204 K  |
|       from small pool |    2887    |    7683    |   64598 K  |   64595 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     201    |     203    |     559    |     358    |
|       from large pool |     182    |     182    |     524    |     342    |
|       from small pool |      19    |      21    |      35    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      34    |    3663    |  138201 K  |  138201 K  |
|       from large pool |      11    |     187    |  106985 K  |  106985 K  |
|       from small pool |      23    |    3652    |   31215 K  |   31215 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   4047 MiB |   1502 TiB |   1502 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1485 TiB |   1485 TiB |
|       from small pool |      0 KiB |     37 MiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   4047 MiB |   1502 TiB |   1502 TiB |
|       from large pool |  16640 KiB |   4027 MiB |   1485 TiB |   1485 TiB |
|       from small pool |      0 KiB |     37 MiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   4045 MiB |   1502 TiB |   1502 TiB |
|       from large pool |  16640 KiB |   4026 MiB |   1485 TiB |   1485 TiB |
|       from small pool |      0 KiB |     36 MiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   4438 MiB |  12800 MiB |  12568 MiB |
|       from large pool | 210944 KiB |   4396 MiB |  12730 MiB |  12524 MiB |
|       from small pool |  26624 KiB |     42 MiB |     70 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 400608 KiB |    798 TiB |    798 TiB |
|       from large pool |  30464 KiB | 399492 KiB |    780 TiB |    780 TiB |
|       from small pool |      0 KiB |  23495 KiB |     17 TiB |     17 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7763    |  203803 K  |  203803 K  |
|       from large pool |       2    |     423    |  139204 K  |  139204 K  |
|       from small pool |       0    |    7683    |   64598 K  |   64598 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7763    |  203803 K  |  203803 K  |
|       from large pool |       2    |     423    |  139204 K  |  139204 K  |
|       from small pool |       0    |    7683    |   64598 K  |   64598 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |     203    |     559    |     536    |
|       from large pool |      10    |     182    |     524    |     514    |
|       from small pool |      13    |      21    |      35    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3663    |  138202 K  |  138202 K  |
|       from large pool |       3    |     187    |  106985 K  |  106985 K  |
|       from small pool |       0    |    3652    |   31216 K  |   31216 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 01:39:06 2024]
Finished job 0.
1 of 1 steps (100%) done
