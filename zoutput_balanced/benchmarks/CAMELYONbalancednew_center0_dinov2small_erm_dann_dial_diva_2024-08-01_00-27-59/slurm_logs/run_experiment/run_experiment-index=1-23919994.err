Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Aug  2 00:55:58 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/1.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/var/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_01_06_58_seed_0_23919994

 Experiment start at: 2024-08-02 01:06:59.387933
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.08405241370201111
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9551081, 'precision': 0.9555211, 'recall': 0.95512134, 'specificity': 0.95512134, 'f1': 0.9550988, 'auroc': 0.9896058, 'binary_precision': 0.96945745, 'binary_recall': 0.93990594, 'binary_specificity': 0.97033674, 'binary_f1_score': 0.954453}
confusion matrix:
       0      1
0  27805    850
1   1725  26980
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.93406767, 'precision': 0.6193557, 'recall': 0.7205978, 'specificity': 0.7205978, 'f1': 0.651547, 'auroc': 0.85889184, 'binary_precision': 0.257329, 'binary_recall': 0.49144635, 'binary_specificity': 0.9497493, 'binary_f1_score': 0.33778724}
confusion matrix:
       0    1
0  17237  912
1    327  316
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9480665, 'precision': 0.70584154, 'recall': 0.8281487, 'specificity': 0.8281487, 'f1': 0.7504112, 'auroc': 0.9086753, 'binary_precision': 0.42523363, 'binary_recall': 0.697318, 'binary_specificity': 0.9589795, 'binary_f1_score': 0.52830184}
confusion matrix:
      0    1
0  5751  246
1    79  182
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 01:51:28.895956,epoch time: 0:44:29.508023,used: 0:44:29.508023,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_01_06_58_seed_0_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96609133, 'precision': 0.966208, 'recall': 0.9660981, 'specificity': 0.9660981, 'f1': 0.9660895, 'auroc': 0.99394333, 'binary_precision': 0.9737951, 'binary_recall': 0.9580198, 'binary_specificity': 0.97417647, 'binary_f1_score': 0.965843}
confusion matrix:
       0      1
0  27916    740
1   1205  27499
---- Validation: 
scalar performance:
{'acc': 0.91400594, 'precision': 0.59863704, 'recall': 0.7454642, 'specificity': 0.7454642, 'f1': 0.6320685, 'auroc': 0.855585, 'binary_precision': 0.21365508, 'binary_recall': 0.5645412, 'binary_specificity': 0.92638713, 'binary_f1_score': 0.30999145}
confusion matrix:
       0     1
0  16813  1336
1    280   363
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9199425, 'precision': 0.64889836, 'recall': 0.83729506, 'specificity': 0.83729506, 'f1': 0.6973068, 'auroc': 0.90484947, 'binary_precision': 0.30952382, 'binary_recall': 0.74712646, 'binary_specificity': 0.9274637, 'binary_f1_score': 0.43771043}
confusion matrix:
      0    1
0  5562  435
1    66  195
early stop counter: 1
val acc:0.9140059351921082, best validation acc: 0.9340676665306091, corresponding to test acc:                         0.9480664730072021 / 0.9480664730072021
after epoch: 2,now: 2024-08-02 02:35:02.210638,epoch time: 0:43:33.314682,used: 1:28:02.822705,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_01_06_58_seed_0_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97203624, 'precision': 0.9722752, 'recall': 0.9720454, 'specificity': 0.9720454, 'f1': 0.97203314, 'auroc': 0.9956647, 'binary_precision': 0.9830998, 'binary_recall': 0.9606313, 'binary_specificity': 0.98345953, 'binary_f1_score': 0.9717358}
confusion matrix:
       0      1
0  28183    474
1   1130  27573
---- Validation: 
scalar performance:
{'acc': 0.92416984, 'precision': 0.6116563, 'recall': 0.748476, 'specificity': 0.748476, 'f1': 0.6477272, 'auroc': 0.8620906, 'binary_precision': 0.23968042, 'binary_recall': 0.5598756, 'binary_specificity': 0.93707645, 'binary_f1_score': 0.33566436}
confusion matrix:
       0     1
0  17007  1142
1    283   360
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9250559, 'precision': 0.65452605, 'recall': 0.82713675, 'specificity': 0.82713675, 'f1': 0.70239264, 'auroc': 0.90378636, 'binary_precision': 0.3219178, 'binary_recall': 0.7203065, 'binary_specificity': 0.933967, 'binary_f1_score': 0.44497043}
confusion matrix:
      0    1
0  5601  396
1    73  188
early stop counter: 2
val acc:0.9241698384284973, best validation acc: 0.9340676665306091, corresponding to test acc:                         0.9480664730072021 / 0.9480664730072021
after epoch: 3,now: 2024-08-02 03:19:47.514493,epoch time: 0:44:45.303855,used: 2:12:48.126560,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_01_06_58_seed_0_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97398883, 'precision': 0.973997, 'recall': 0.9739872, 'specificity': 0.9739872, 'f1': 0.97398865, 'auroc': 0.9965404, 'binary_precision': 0.9722347, 'binary_recall': 0.9758927, 'binary_specificity': 0.97208166, 'binary_f1_score': 0.9740603}
confusion matrix:
       0      1
0  27855    800
1    692  28013
---- Validation: 
scalar performance:
{'acc': 0.8873457, 'precision': 0.5828095, 'recall': 0.76916456, 'specificity': 0.76916456, 'f1': 0.60977674, 'auroc': 0.8591064, 'binary_precision': 0.17956522, 'binary_recall': 0.64230174, 'binary_specificity': 0.8960273, 'binary_f1_score': 0.280666}
confusion matrix:
       0     1
0  16262  1887
1    230   413
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88638544, 'precision': 0.61200726, 'recall': 0.828948, 'specificity': 0.828948, 'f1': 0.64884746, 'auroc': 0.9054612, 'binary_precision': 0.23529412, 'binary_recall': 0.7662835, 'binary_specificity': 0.89161247, 'binary_f1_score': 0.36003602}
confusion matrix:
      0    1
0  5347  650
1    61  200
early stop counter: 3
val acc:0.8873456716537476, best validation acc: 0.9340676665306091, corresponding to test acc:                         0.9480664730072021 / 0.9480664730072021
after epoch: 4,now: 2024-08-02 04:03:45.852265,epoch time: 0:43:58.337772,used: 2:56:46.464332,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_01_06_58_seed_0_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:56:46.464332 at 2024-08-02 04:03:45.852265
persisted model performance metric: 

scalar performance:
{'acc': 0.9480665, 'precision': 0.70584154, 'recall': 0.8281487, 'specificity': 0.8281487, 'f1': 0.7504112, 'auroc': 0.9086753, 'binary_precision': 0.42523363, 'binary_recall': 0.697318, 'binary_specificity': 0.9589795, 'binary_f1_score': 0.52830184}
confusion matrix:
      0    1
0  5751  246
1    79  182
oracle model performance metric: 

scalar performance:
{'acc': 0.9480665, 'precision': 0.70584154, 'recall': 0.8281487, 'specificity': 0.8281487, 'f1': 0.7504112, 'auroc': 0.9086753, 'binary_precision': 0.42523363, 'binary_recall': 0.697318, 'binary_specificity': 0.9589795, 'binary_f1_score': 0.52830184}
confusion matrix:
      0    1
0  5751  246
1    79  182
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/1.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1920 MiB |   6571 MiB | 380170 GiB | 380168 GiB |
|       from large pool |   1876 MiB |   6527 MiB | 376524 GiB | 376522 GiB |
|       from small pool |     43 MiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1920 MiB |   6571 MiB | 380170 GiB | 380168 GiB |
|       from large pool |   1876 MiB |   6527 MiB | 376524 GiB | 376522 GiB |
|       from small pool |     43 MiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1917 MiB |   6568 MiB | 380104 GiB | 380102 GiB |
|       from large pool |   1874 MiB |   6525 MiB | 376462 GiB | 376460 GiB |
|       from small pool |     42 MiB |     83 MiB |   3641 GiB |   3641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6994 MiB |   6994 MiB |   6994 MiB |      0 B   |
|       from large pool |   6904 MiB |   6904 MiB |   6904 MiB |      0 B   |
|       from small pool |     90 MiB |     90 MiB |     90 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 448116 KiB | 763056 KiB | 180545 GiB | 180544 GiB |
|       from large pool | 439588 KiB | 760912 KiB | 176864 GiB | 176863 GiB |
|       from small pool |   8528 KiB |  13715 KiB |   3680 GiB |   3680 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3634    |    8301    |   48613 K  |   48610 K  |
|       from large pool |     176    |     456    |   27875 K  |   27875 K  |
|       from small pool |    3458    |    8124    |   20738 K  |   20734 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3634    |    8301    |   48613 K  |   48610 K  |
|       from large pool |     176    |     456    |   27875 K  |   27875 K  |
|       from small pool |    3458    |    8124    |   20738 K  |   20734 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     209    |     209    |     209    |       0    |
|       from large pool |     164    |     164    |     164    |       0    |
|       from small pool |      45    |      45    |      45    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      69    |    3623    |   30612 K  |   30612 K  |
|       from large pool |      29    |     155    |   18747 K  |   18747 K  |
|       from small pool |      40    |    3594    |   11865 K  |   11865 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB | 380104 GiB | 380104 GiB |
|       from large pool |  16640 KiB |   6525 MiB | 376462 GiB | 376462 GiB |
|       from small pool |      0 KiB |     83 MiB |   3641 GiB |   3641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2358 MiB |   6994 MiB |   6994 MiB |   4636 MiB |
|       from large pool |   2306 MiB |   6904 MiB |   6904 MiB |   4598 MiB |
|       from small pool |     52 MiB |     90 MiB |     90 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 763056 KiB | 180545 GiB | 180545 GiB |
|       from large pool |  30464 KiB | 760912 KiB | 176864 GiB | 176864 GiB |
|       from small pool |      0 KiB |  31429 KiB |   3680 GiB |   3680 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     209    |     145    |
|       from large pool |      38    |     164    |     164    |     126    |
|       from small pool |      26    |      45    |      45    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3623    |   30614 K  |   30614 K  |
|       from large pool |       4    |     155    |   18747 K  |   18747 K  |
|       from small pool |       0    |    3594    |   11866 K  |   11866 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6571 MiB | 380170 GiB | 380170 GiB |
|       from large pool |  16640 KiB |   6527 MiB | 376524 GiB | 376524 GiB |
|       from small pool |      0 KiB |     84 MiB |   3646 GiB |   3646 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB | 380104 GiB | 380104 GiB |
|       from large pool |  16640 KiB |   6525 MiB | 376462 GiB | 376462 GiB |
|       from small pool |      0 KiB |     83 MiB |   3641 GiB |   3641 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2358 MiB |   6994 MiB |   6994 MiB |   4636 MiB |
|       from large pool |   2306 MiB |   6904 MiB |   6904 MiB |   4598 MiB |
|       from small pool |     52 MiB |     90 MiB |     90 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 763056 KiB | 180545 GiB | 180545 GiB |
|       from large pool |  30464 KiB | 760912 KiB | 176864 GiB | 176864 GiB |
|       from small pool |      0 KiB |  31429 KiB |   3680 GiB |   3680 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8301    |   48613 K  |   48613 K  |
|       from large pool |       2    |     456    |   27875 K  |   27875 K  |
|       from small pool |       0    |    8124    |   20738 K  |   20738 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     209    |     145    |
|       from large pool |      38    |     164    |     164    |     126    |
|       from small pool |      26    |      45    |      45    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3623    |   30614 K  |   30614 K  |
|       from large pool |       4    |     155    |   18747 K  |   18747 K  |
|       from small pool |       0    |    3594    |   11866 K  |   11866 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_04_15_49_seed_1_23919994

 Experiment start at: 2024-08-02 04:15:49.842856
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.048501450568437576
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96282285, 'precision': 0.96302956, 'recall': 0.9628303, 'specificity': 0.9628303, 'f1': 0.9628191, 'auroc': 0.9928124, 'binary_precision': 0.9729883, 'binary_recall': 0.9521299, 'binary_specificity': 0.97353065, 'binary_f1_score': 0.9624461}
confusion matrix:
       0      1
0  28026    762
1   1380  27448
---- Validation: 
scalar performance:
{'acc': 0.8859125, 'precision': 0.58273804, 'recall': 0.75700766, 'specificity': 0.75700766, 'f1': 0.6090908, 'auroc': 0.8410108, 'binary_precision': 0.18110579, 'binary_recall': 0.61812776, 'binary_specificity': 0.89588755, 'binary_f1_score': 0.28013468}
confusion matrix:
       0     1
0  16186  1881
1    257   416
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9046084, 'precision': 0.63032997, 'recall': 0.8362014, 'specificity': 0.8362014, 'f1': 0.6744945, 'auroc': 0.90245414, 'binary_precision': 0.27197802, 'binary_recall': 0.76153845, 'binary_specificity': 0.9108645, 'binary_f1_score': 0.40080974}
confusion matrix:
      0    1
0  5416  530
1    62  198
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 04:59:43.069139,epoch time: 0:43:53.226283,used: 0:43:53.226283,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_04_15_49_seed_1_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9713274, 'precision': 0.9713652, 'recall': 0.97133076, 'specificity': 0.97133076, 'f1': 0.97132695, 'auroc': 0.9953245, 'binary_precision': 0.9757711, 'binary_recall': 0.9667002, 'binary_specificity': 0.9759614, 'binary_f1_score': 0.97121453}
confusion matrix:
       0      1
0  28095    692
1    960  27869
---- Validation: 
scalar performance:
{'acc': 0.8829242, 'precision': 0.58122206, 'recall': 0.7583189, 'specificity': 0.7583189, 'f1': 0.60658413, 'auroc': 0.84138584, 'binary_precision': 0.17789072, 'binary_recall': 0.6240713, 'binary_specificity': 0.89256656, 'binary_f1_score': 0.2768622}
confusion matrix:
       0     1
0  16126  1941
1    253   420
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88398325, 'precision': 0.6098598, 'recall': 0.8254379, 'specificity': 0.8254379, 'f1': 0.64554965, 'auroc': 0.8943194, 'binary_precision': 0.23130842, 'binary_recall': 0.76153845, 'binary_specificity': 0.88933736, 'binary_f1_score': 0.3548387}
confusion matrix:
      0    1
0  5288  658
1    62  198
early stop counter: 1
val acc:0.8829241991043091, best validation acc: 0.8859124779701233, corresponding to test acc:                         0.904608428478241 / 0.904608428478241
after epoch: 2,now: 2024-08-02 05:41:20.007249,epoch time: 0:41:36.938110,used: 1:25:30.164393,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_04_15_49_seed_1_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9752326, 'precision': 0.9753293, 'recall': 0.97523785, 'specificity': 0.97523785, 'f1': 0.9752315, 'auroc': 0.9965359, 'binary_precision': 0.9822937, 'binary_recall': 0.9679489, 'binary_specificity': 0.98252684, 'binary_f1_score': 0.97506857}
confusion matrix:
       0      1
0  28284    503
1    924  27905
---- Validation: 
scalar performance:
{'acc': 0.8607257, 'precision': 0.57469165, 'recall': 0.7797085, 'specificity': 0.7797085, 'f1': 0.59311163, 'auroc': 0.85054165, 'binary_precision': 0.16242594, 'binary_recall': 0.692422, 'binary_specificity': 0.8669951, 'binary_f1_score': 0.2631282}
confusion matrix:
       0     1
0  15664  2403
1    207   466
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8604576, 'precision': 0.59324044, 'recall': 0.8149997, 'specificity': 0.8149997, 'f1': 0.61859566, 'auroc': 0.89238465, 'binary_precision': 0.19820717, 'binary_recall': 0.7653846, 'binary_specificity': 0.86461484, 'binary_f1_score': 0.3148734}
confusion matrix:
      0    1
0  5141  805
1    61  199
early stop counter: 2
val acc:0.8607257008552551, best validation acc: 0.8859124779701233, corresponding to test acc:                         0.904608428478241 / 0.904608428478241
after epoch: 3,now: 2024-08-02 06:22:04.831935,epoch time: 0:40:44.824686,used: 2:06:14.989079,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_04_15_49_seed_1_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97691613, 'precision': 0.97693455, 'recall': 0.97691864, 'specificity': 0.97691864, 'f1': 0.97691596, 'auroc': 0.9969816, 'binary_precision': 0.9800978, 'binary_recall': 0.9736386, 'binary_specificity': 0.9801987, 'binary_f1_score': 0.97685754}
confusion matrix:
       0      1
0  28216    570
1    760  28070
---- Validation: 
scalar performance:
{'acc': 0.8660085, 'precision': 0.5780847, 'recall': 0.7845941, 'specificity': 0.7845941, 'f1': 0.5990886, 'auroc': 0.85926294, 'binary_precision': 0.16894813, 'binary_recall': 0.6968796, 'binary_specificity': 0.8723086, 'binary_f1_score': 0.2719629}
confusion matrix:
       0     1
0  15760  2307
1    204   469
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86513054, 'precision': 0.5966169, 'recall': 0.81927735, 'specificity': 0.81927735, 'f1': 0.6242318, 'auroc': 0.8939216, 'binary_precision': 0.2047083, 'binary_recall': 0.7692308, 'binary_specificity': 0.8693239, 'binary_f1_score': 0.32336298}
confusion matrix:
      0    1
0  5169  777
1    60  200
early stop counter: 3
val acc:0.8660085201263428, best validation acc: 0.8859124779701233, corresponding to test acc:                         0.904608428478241 / 0.904608428478241
after epoch: 4,now: 2024-08-02 07:02:55.683837,epoch time: 0:40:50.851902,used: 2:47:05.840981,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_04_15_49_seed_1_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:47:05.840981 at 2024-08-02 07:02:55.683837
persisted model performance metric: 

scalar performance:
{'acc': 0.9046084, 'precision': 0.63032997, 'recall': 0.8362014, 'specificity': 0.8362014, 'f1': 0.6744945, 'auroc': 0.90245414, 'binary_precision': 0.27197802, 'binary_recall': 0.76153845, 'binary_specificity': 0.9108645, 'binary_f1_score': 0.40080974}
confusion matrix:
      0    1
0  5416  530
1    62  198
oracle model performance metric: 

scalar performance:
{'acc': 0.9046084, 'precision': 0.63032997, 'recall': 0.8362014, 'specificity': 0.8362014, 'f1': 0.6744945, 'auroc': 0.90245414, 'binary_precision': 0.27197802, 'binary_recall': 0.76153845, 'binary_specificity': 0.9108645, 'binary_f1_score': 0.40080974}
confusion matrix:
      0    1
0  5416  530
1    62  198
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1921 MiB |   6572 MiB | 761896 GiB | 761894 GiB |
|       from large pool |   1877 MiB |   6528 MiB | 754591 GiB | 754590 GiB |
|       from small pool |     43 MiB |     84 MiB |   7304 GiB |   7304 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1921 MiB |   6572 MiB | 761896 GiB | 761894 GiB |
|       from large pool |   1877 MiB |   6528 MiB | 754591 GiB | 754590 GiB |
|       from small pool |     43 MiB |     84 MiB |   7304 GiB |   7304 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1917 MiB |   6568 MiB | 761737 GiB | 761735 GiB |
|       from large pool |   1874 MiB |   6525 MiB | 754443 GiB | 754441 GiB |
|       from small pool |     42 MiB |     83 MiB |   7294 GiB |   7294 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6996 MiB |   6996 MiB |  11632 MiB |   4636 MiB |
|       from large pool |   6912 MiB |   6912 MiB |  11510 MiB |   4598 MiB |
|       from small pool |     84 MiB |     90 MiB |    122 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 461549 KiB |    819 MiB | 424295 GiB | 424294 GiB |
|       from large pool | 450961 KiB |    817 MiB | 416916 GiB | 416916 GiB |
|       from small pool |  10588 KiB |     30 MiB |   7378 GiB |   7378 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3610    |    8333    |   97399 K  |   97395 K  |
|       from large pool |     176    |     456    |   55860 K  |   55860 K  |
|       from small pool |    3434    |    8156    |   41538 K  |   41535 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3610    |    8333    |   97399 K  |   97395 K  |
|       from large pool |     176    |     456    |   55860 K  |   55860 K  |
|       from small pool |    3434    |    8156    |   41538 K  |   41535 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     170    |     209    |     315    |     145    |
|       from large pool |     128    |     164    |     254    |     126    |
|       from small pool |      42    |      45    |      61    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      73    |    3638    |   60200 K  |   60200 K  |
|       from large pool |      28    |     155    |   36731 K  |   36731 K  |
|       from small pool |      45    |    3610    |   23468 K  |   23468 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6572 MiB | 761896 GiB | 761896 GiB |
|       from large pool |  16640 KiB |   6528 MiB | 754591 GiB | 754591 GiB |
|       from small pool |      0 KiB |     84 MiB |   7304 GiB |   7304 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6572 MiB | 761896 GiB | 761896 GiB |
|       from large pool |  16640 KiB |   6528 MiB | 754591 GiB | 754591 GiB |
|       from small pool |      0 KiB |     84 MiB |   7304 GiB |   7304 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB | 761737 GiB | 761737 GiB |
|       from large pool |  16640 KiB |   6525 MiB | 754443 GiB | 754443 GiB |
|       from small pool |      0 KiB |     83 MiB |   7294 GiB |   7294 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   6996 MiB |  11632 MiB |   9260 MiB |
|       from large pool |   2318 MiB |   6912 MiB |  11510 MiB |   9192 MiB |
|       from small pool |     54 MiB |     90 MiB |    122 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB |    819 MiB | 424295 GiB | 424295 GiB |
|       from large pool |  30464 KiB |    817 MiB | 416916 GiB | 416916 GiB |
|       from small pool |      0 KiB |     34 MiB |   7378 GiB |   7378 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   55860 K  |   55860 K  |
|       from small pool |       0    |    8156    |   41538 K  |   41538 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   55860 K  |   55860 K  |
|       from small pool |       0    |    8156    |   41538 K  |   41538 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     315    |     251    |
|       from large pool |      37    |     164    |     254    |     217    |
|       from small pool |      27    |      45    |      61    |      34    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3638    |   60201 K  |   60201 K  |
|       from large pool |       4    |     155    |   36731 K  |   36731 K  |
|       from small pool |       0    |    3610    |   23469 K  |   23469 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6572 MiB | 761896 GiB | 761896 GiB |
|       from large pool |  16640 KiB |   6528 MiB | 754591 GiB | 754591 GiB |
|       from small pool |      0 KiB |     84 MiB |   7304 GiB |   7304 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6572 MiB | 761896 GiB | 761896 GiB |
|       from large pool |  16640 KiB |   6528 MiB | 754591 GiB | 754591 GiB |
|       from small pool |      0 KiB |     84 MiB |   7304 GiB |   7304 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB | 761737 GiB | 761737 GiB |
|       from large pool |  16640 KiB |   6525 MiB | 754443 GiB | 754443 GiB |
|       from small pool |      0 KiB |     83 MiB |   7294 GiB |   7294 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2372 MiB |   6996 MiB |  11632 MiB |   9260 MiB |
|       from large pool |   2318 MiB |   6912 MiB |  11510 MiB |   9192 MiB |
|       from small pool |     54 MiB |     90 MiB |    122 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB |    819 MiB | 424295 GiB | 424295 GiB |
|       from large pool |  30464 KiB |    817 MiB | 416916 GiB | 416916 GiB |
|       from small pool |      0 KiB |     34 MiB |   7378 GiB |   7378 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   55860 K  |   55860 K  |
|       from small pool |       0    |    8156    |   41538 K  |   41538 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8333    |   97399 K  |   97399 K  |
|       from large pool |       2    |     456    |   55860 K  |   55860 K  |
|       from small pool |       0    |    8156    |   41538 K  |   41538 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     315    |     251    |
|       from large pool |      37    |     164    |     254    |     217    |
|       from small pool |      27    |      45    |      61    |      34    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3638    |   60201 K  |   60201 K  |
|       from large pool |       4    |     155    |   36731 K  |   36731 K  |
|       from small pool |       0    |    3610    |   23469 K  |   23469 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994

 Experiment start at: 2024-08-02 07:13:46.298527
hyper-parameter scheduler not set,going to use default Warmpup and epoch update
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.03910883143544197
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96032864, 'precision': 0.9607724, 'recall': 0.9603313, 'specificity': 0.9603313, 'f1': 0.9603193, 'auroc': 0.99123955, 'binary_precision': 0.97511506, 'binary_recall': 0.9447817, 'binary_specificity': 0.97588086, 'binary_f1_score': 0.95970875}
confusion matrix:
       0      1
0  28444    703
1   1610  27547
---- Validation: 
scalar performance:
{'acc': 0.9129601, 'precision': 0.6022915, 'recall': 0.7888072, 'specificity': 0.7888072, 'f1': 0.639692, 'auroc': 0.87126607, 'binary_precision': 0.21679473, 'binary_recall': 0.65614617, 'binary_specificity': 0.92146826, 'binary_f1_score': 0.3259076}
confusion matrix:
       0     1
0  16744  1427
1    207   395
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9339638, 'precision': 0.6677888, 'recall': 0.86056423, 'specificity': 0.86056423, 'f1': 0.72161555, 'auroc': 0.91312397, 'binary_precision': 0.3448905, 'binary_recall': 0.78099173, 'binary_specificity': 0.94013673, 'binary_f1_score': 0.478481}
confusion matrix:
      0    1
0  5638  359
1    53  189
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-02 07:54:48.782006,epoch time: 0:41:02.483479,used: 0:41:02.483479,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.970448, 'precision': 0.97070843, 'recall': 0.9704509, 'specificity': 0.9704509, 'f1': 0.97044396, 'auroc': 0.9951594, 'binary_precision': 0.98184055, 'binary_recall': 0.9586406, 'binary_specificity': 0.9822611, 'binary_f1_score': 0.97010183}
confusion matrix:
       0      1
0  28628    517
1   1206  27953
---- Validation: 
scalar performance:
{'acc': 0.9189794, 'precision': 0.6064774, 'recall': 0.77906775, 'specificity': 0.77906775, 'f1': 0.6447369, 'auroc': 0.8745384, 'binary_precision': 0.2259988, 'binary_recall': 0.6295681, 'binary_specificity': 0.92856747, 'binary_f1_score': 0.332602}
confusion matrix:
       0     1
0  16873  1298
1    223   379
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9362077, 'precision': 0.66550314, 'recall': 0.8260422, 'specificity': 0.8260422, 'f1': 0.7141276, 'auroc': 0.90084505, 'binary_precision': 0.3433735, 'binary_recall': 0.7066116, 'binary_specificity': 0.9454727, 'binary_f1_score': 0.46216217}
confusion matrix:
      0    1
0  5670  327
1    71  171
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-02 08:35:05.033476,epoch time: 0:40:16.251470,used: 1:21:18.734949,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97286636, 'precision': 0.9733477, 'recall': 0.9728691, 'specificity': 0.9728691, 'f1': 0.9728596, 'auroc': 0.99637544, 'binary_precision': 0.9884854, 'binary_recall': 0.95688856, 'binary_specificity': 0.98884964, 'binary_f1_score': 0.97243035}
confusion matrix:
       0      1
0  28822    325
1   1257  27900
---- Validation: 
scalar performance:
{'acc': 0.926064, 'precision': 0.6148993, 'recall': 0.77710617, 'specificity': 0.77710617, 'f1': 0.65488726, 'auroc': 0.88029265, 'binary_precision': 0.24313726, 'binary_recall': 0.6179402, 'binary_specificity': 0.9362721, 'binary_f1_score': 0.34896812}
confusion matrix:
       0     1
0  17013  1158
1    230   372
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93668854, 'precision': 0.6645299, 'recall': 0.8163786, 'specificity': 0.8163786, 'f1': 0.71152854, 'auroc': 0.8971524, 'binary_precision': 0.34226805, 'binary_recall': 0.6859504, 'binary_specificity': 0.9468067, 'binary_f1_score': 0.45667124}
confusion matrix:
      0    1
0  5678  319
1    76  166
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-02 09:16:01.921679,epoch time: 0:40:56.888203,used: 2:02:15.623152,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9779946, 'precision': 0.97800714, 'recall': 0.9779954, 'specificity': 0.9779954, 'f1': 0.97799444, 'auroc': 0.9972862, 'binary_precision': 0.9805219, 'binary_recall': 0.9753772, 'binary_specificity': 0.9806135, 'binary_f1_score': 0.97794276}
confusion matrix:
       0      1
0  28579    565
1    718  28442
---- Validation: 
scalar performance:
{'acc': 0.8899483, 'precision': 0.58908933, 'recall': 0.8138604, 'specificity': 0.8138604, 'f1': 0.6197358, 'auroc': 0.88354534, 'binary_precision': 0.18797953, 'binary_recall': 0.73255813, 'binary_specificity': 0.89516264, 'binary_f1_score': 0.2991859}
confusion matrix:
       0     1
0  16266  1905
1    161   441
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90206766, 'precision': 0.61783063, 'recall': 0.82612795, 'specificity': 0.82612795, 'f1': 0.6588268, 'auroc': 0.89511013, 'binary_precision': 0.24691358, 'binary_recall': 0.74380165, 'binary_specificity': 0.90845424, 'binary_f1_score': 0.37075177}
confusion matrix:
      0    1
0  5448  549
1    62  180
early stop counter: 1
val acc:0.889948308467865, best validation acc: 0.9260640144348145, corresponding to test acc:                         0.9366885423660278 / 0.9366885423660278
after epoch: 4,now: 2024-08-02 09:56:50.049461,epoch time: 0:40:48.127782,used: 2:43:03.750934,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98019004, 'precision': 0.98027325, 'recall': 0.98019165, 'specificity': 0.98019165, 'f1': 0.9801893, 'auroc': 0.9975283, 'binary_precision': 0.9866537, 'binary_recall': 0.9735588, 'binary_specificity': 0.9868245, 'binary_f1_score': 0.98006254}
confusion matrix:
       0      1
0  28761    384
1    771  28388
---- Validation: 
scalar performance:
{'acc': 0.90544933, 'precision': 0.5994128, 'recall': 0.80741274, 'specificity': 0.80741274, 'f1': 0.63597715, 'auroc': 0.88489735, 'binary_precision': 0.20950966, 'binary_recall': 0.7026578, 'binary_specificity': 0.9121677, 'binary_f1_score': 0.32277754}
confusion matrix:
       0     1
0  16575  1596
1    179   423
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9240263, 'precision': 0.64268816, 'recall': 0.81970567, 'specificity': 0.81970567, 'f1': 0.6892364, 'auroc': 0.8964344, 'binary_precision': 0.2979094, 'binary_recall': 0.7066116, 'binary_specificity': 0.93279976, 'binary_f1_score': 0.41911763}
confusion matrix:
      0    1
0  5594  403
1    71  171
early stop counter: 2
val acc:0.9054493308067322, best validation acc: 0.9260640144348145, corresponding to test acc:                         0.9366885423660278 / 0.9366885423660278
after epoch: 5,now: 2024-08-02 10:37:38.802269,epoch time: 0:40:48.752808,used: 3:23:52.503742,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98132205, 'precision': 0.9814861, 'recall': 0.98132396, 'specificity': 0.98132396, 'f1': 0.9813205, 'auroc': 0.9978485, 'binary_precision': 0.9904253, 'binary_recall': 0.9720488, 'binary_specificity': 0.99059904, 'binary_f1_score': 0.98115104}
confusion matrix:
       0      1
0  28872    274
1    815  28343
---- Validation: 
scalar performance:
{'acc': 0.9058222, 'precision': 0.59960616, 'recall': 0.8068024, 'specificity': 0.8068024, 'f1': 0.6362572, 'auroc': 0.8857931, 'binary_precision': 0.20995025, 'binary_recall': 0.7009967, 'binary_specificity': 0.912608, 'binary_f1_score': 0.32312405}
confusion matrix:
       0     1
0  16583  1588
1    180   422
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92146176, 'precision': 0.6377412, 'recall': 0.81440616, 'specificity': 0.81440616, 'f1': 0.6830762, 'auroc': 0.89229584, 'binary_precision': 0.2883959, 'binary_recall': 0.6983471, 'binary_specificity': 0.9304652, 'binary_f1_score': 0.40821257}
confusion matrix:
      0    1
0  5580  417
1    73  169
early stop counter: 3
val acc:0.905822217464447, best validation acc: 0.9260640144348145, corresponding to test acc:                         0.9366885423660278 / 0.9366885423660278
after epoch: 6,now: 2024-08-02 11:17:47.851576,epoch time: 0:40:09.049307,used: 4:04:01.553049,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_08md_02_07_13_45_seed_2_23919994
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 4:04:01.553049 at 2024-08-02 11:17:47.851576
persisted model performance metric: 

scalar performance:
{'acc': 0.93668854, 'precision': 0.6645299, 'recall': 0.8163786, 'specificity': 0.8163786, 'f1': 0.71152854, 'auroc': 0.8971524, 'binary_precision': 0.34226805, 'binary_recall': 0.6859504, 'binary_specificity': 0.9468067, 'binary_f1_score': 0.45667124}
confusion matrix:
      0    1
0  5678  319
1    76  166
oracle model performance metric: 

scalar performance:
{'acc': 0.93668854, 'precision': 0.6645299, 'recall': 0.8163786, 'specificity': 0.8163786, 'f1': 0.71152854, 'auroc': 0.8971524, 'binary_precision': 0.34226805, 'binary_recall': 0.6859504, 'binary_specificity': 0.9468067, 'binary_f1_score': 0.45667124}
confusion matrix:
      0    1
0  5678  319
1    76  166
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_2024-08-01_00-27-59/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1921 MiB |   6572 MiB |   1308 TiB |   1308 TiB |
|       from large pool |   1878 MiB |   6529 MiB |   1295 TiB |   1295 TiB |
|       from small pool |     43 MiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |   1921 MiB |   6572 MiB |   1308 TiB |   1308 TiB |
|       from large pool |   1878 MiB |   6529 MiB |   1295 TiB |   1295 TiB |
|       from small pool |     43 MiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1917 MiB |   6568 MiB |   1307 TiB |   1307 TiB |
|       from large pool |   1874 MiB |   6525 MiB |   1295 TiB |   1295 TiB |
|       from small pool |     42 MiB |     83 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   6988 MiB |   6996 MiB |  16248 MiB |   9260 MiB |
|       from large pool |   6904 MiB |   6912 MiB |  16096 MiB |   9192 MiB |
|       from small pool |     84 MiB |     90 MiB |    152 MiB |     68 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 501955 KiB |    819 MiB |    791 TiB |    791 TiB |
|       from large pool | 491373 KiB |    817 MiB |    778 TiB |    778 TiB |
|       from small pool |  10582 KiB |     34 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    3622    |    8419    |  171064 K  |  171060 K  |
|       from large pool |     176    |     456    |   98178 K  |   98178 K  |
|       from small pool |    3446    |    8242    |   72885 K  |   72881 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3622    |    8419    |  171064 K  |  171060 K  |
|       from large pool |     176    |     456    |   98178 K  |   98178 K  |
|       from small pool |    3446    |    8242    |   72885 K  |   72881 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     168    |     209    |     419    |     251    |
|       from large pool |     126    |     164    |     343    |     217    |
|       from small pool |      42    |      45    |      76    |      34    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      73    |    3681    |  106448 K  |  106448 K  |
|       from large pool |      29    |     155    |   64968 K  |   64968 K  |
|       from small pool |      44    |    3652    |   41479 K  |   41479 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   6572 MiB |   1308 TiB |   1308 TiB |
|       from large pool |  16640 KiB |   6529 MiB |   1295 TiB |   1295 TiB |
|       from small pool |      0 KiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   6572 MiB |   1308 TiB |   1308 TiB |
|       from large pool |  16640 KiB |   6529 MiB |   1295 TiB |   1295 TiB |
|       from small pool |      0 KiB |     84 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   6568 MiB |   1307 TiB |   1307 TiB |
|       from large pool |  16640 KiB |   6525 MiB |   1295 TiB |   1295 TiB |
|       from small pool |      0 KiB |     83 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2412 MiB |   6996 MiB |  16248 MiB |  13836 MiB |
|       from large pool |   2358 MiB |   6912 MiB |  16096 MiB |  13738 MiB |
|       from small pool |     54 MiB |     90 MiB |    152 MiB |     98 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB |    819 MiB |    791 TiB |    791 TiB |
|       from large pool |  30464 KiB |    817 MiB |    778 TiB |    778 TiB |
|       from small pool |      0 KiB |     34 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8419    |  171064 K  |  171064 K  |
|       from large pool |       2    |     456    |   98178 K  |   98178 K  |
|       from small pool |       0    |    8242    |   72885 K  |   72885 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8419    |  171064 K  |  171064 K  |
|       from large pool |       2    |     456    |   98178 K  |   98178 K  |
|       from small pool |       0    |    8242    |   72885 K  |   72885 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      64    |     209    |     419    |     355    |
|       from large pool |      37    |     164    |     343    |     306    |
|       from small pool |      27    |      45    |      76    |      49    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       4    |    3681    |  106449 K  |  106449 K  |
|       from large pool |       4    |     155    |   64968 K  |   64968 K  |
|       from small pool |       0    |    3652    |   41481 K  |   41481 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Aug  2 11:19:18 2024]
Finished job 0.
1 of 1 steps (100%) done
