Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 31 03:10:51 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/7.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=7
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: libtorch_cuda_cu.so: cannot open shared object file: No such file or directory
  warn(f"Failed to load image Python extension: {e}")
Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



warning: Not a git repository. Use --no-index to compare two paths outside a working tree
usage: git diff --no-index [<options>] <path> <path>

Diff output format options
    -p, --patch           generate patch
    -s, --no-patch        suppress diff output
    -u                    generate patch
    -U, --unified[=<n>]   generate diffs with <n> lines context
    -W, --function-context
                          generate diffs with <n> lines context
    --raw                 generate the diff in raw format
    --patch-with-raw      synonym for '-p --raw'
    --patch-with-stat     synonym for '-p --stat'
    --numstat             machine friendly --stat
    --shortstat           output only the last line of --stat
    -X, --dirstat[=<param1,param2>...]
                          output the distribution of relative amount of changes for each sub-directory
    --cumulative          synonym for --dirstat=cumulative
    --dirstat-by-file[=<param1,param2>...]
                          synonym for --dirstat=files,param1,param2...
    --check               warn if changes introduce conflict markers or whitespace errors
    --summary             condensed summary such as creations, renames and mode changes
    --name-only           show only names of changed files
    --name-status         show only names and status of changed files
    --stat[=<width>[,<name-width>[,<count>]]]
                          generate diffstat
    --stat-width <width>  generate diffstat with a given width
    --stat-name-width <width>
                          generate diffstat with a given name width
    --stat-graph-width <width>
                          generate diffstat with a given graph width
    --stat-count <count>  generate diffstat with limited lines
    --compact-summary     generate compact summary in diffstat
    --binary              output a binary diff that can be applied
    --full-index          show full pre- and post-image object names on the "index" lines
    --color[=<when>]      show colored diff
    --ws-error-highlight <kind>
                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff
    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat
    --abbrev[=<n>]        use <n> digits to display object names
    --src-prefix <prefix>
                          show the given source prefix instead of "a/"
    --dst-prefix <prefix>
                          show the given destination prefix instead of "b/"
    --line-prefix <prefix>
                          prepend an additional prefix to every line of output
    --no-prefix           do not show any source or destination prefix
    --inter-hunk-context <n>
                          show context between diff hunks up to the specified number of lines
    --output-indicator-new <char>
                          specify the character to indicate a new line instead of '+'
    --output-indicator-old <char>
                          specify the character to indicate an old line instead of '-'
    --output-indicator-context <char>
                          specify the character to indicate a context instead of ' '

Diff rename options
    -B, --break-rewrites[=<n>[/<m>]]
                          break complete rewrite changes into pairs of delete and create
    -M, --find-renames[=<n>]
                          detect renames
    -D, --irreversible-delete
                          omit the preimage for deletes
    -C, --find-copies[=<n>]
                          detect copies
    --find-copies-harder  use unmodified files as source to find copies
    --no-renames          disable rename detection
    --rename-empty        use empty blobs as rename source
    --follow              continue listing the history of a file beyond renames
    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit

Diff algorithm options
    --minimal             produce the smallest possible diff
    -w, --ignore-all-space
                          ignore whitespace when comparing lines
    -b, --ignore-space-change
                          ignore changes in amount of whitespace
    --ignore-space-at-eol
                          ignore changes in whitespace at EOL
    --ignore-cr-at-eol    ignore carrier-return at the end of line
    --ignore-blank-lines  ignore changes whose lines are all blank
    -I, --ignore-matching-lines <regex>
                          ignore changes whose all lines match <regex>
    --indent-heuristic    heuristic to shift diff hunk boundaries for easy reading
    --patience            generate diff using the "patience diff" algorithm
    --histogram           generate diff using the "histogram diff" algorithm
    --diff-algorithm <algorithm>
                          choose a diff algorithm
    --anchored <text>     generate diff using the "anchored diff" algorithm
    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words
    --word-diff-regex <regex>
                          use <regex> to decide what a word is
    --color-words[=<regex>]
                          equivalent to --word-diff=color --word-diff-regex=<regex>
    --color-moved[=<mode>]
                          moved lines of code are colored differently
    --color-moved-ws <mode>
                          how white spaces are ignored in --color-moved

Other diff options
    --relative[=<prefix>]
                          when run from subdir, exclude changes outside and show relative paths
    -a, --text            treat all files as text
    -R                    swap two inputs, reverse the diff
    --exit-code           exit with 1 if there were differences, 0 otherwise
    --quiet               disable all output of the program
    --ext-diff            allow an external diff helper to be executed
    --textconv            run external text conversion filters when comparing binary files
    --ignore-submodules[=<when>]
                          ignore changes to submodules in the diff generation
    --submodule[=<format>]
                          specify how differences in submodules are shown
    --ita-invisible-in-index
                          hide 'git add -N' entries from the index
    --ita-visible-in-index
                          treat 'git add -N' entries as real in the index
    -S <string>           look for differences that change the number of occurrences of the specified string
    -G <regex>            look for differences that change the number of occurrences of the specified regex
    --pickaxe-all         show all changes in the changeset with -S or -G
    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression
    -O <file>             control the order in which files appear in the output
    --rotate-to <path>    show the change in the specified path first
    --skip-to <path>      skip the output to the specified path
    --find-object <object-id>
                          look for differences that change the number of occurrences of the specified object
    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]
                          select files by diff type
    --output <file>       output to a specific file

not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:26: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:38: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
model name: dset_te_center0_erm_no_git_version_2024md_07md_31_03_20_46_seed_0_23775383

 Experiment start at: 2024-07-31 03:20:47.151919
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.8589006662368774
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9594665, 'precision': 0.9595722, 'recall': 0.9594724, 'specificity': 0.9594724, 'f1': 0.95946455, 'auroc': 0.9906782, 'binary_precision': 0.96673393, 'binary_recall': 0.9517455, 'binary_specificity': 0.9671994, 'binary_f1_score': 0.95918113}
confusion matrix:
       0      1
0  27718    940
1   1385  27317
---- Validation: 
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.91288847, 'precision': 0.6032307, 'recall': 0.76813734, 'specificity': 0.76813734, 'f1': 0.63919425, 'auroc': 0.8555916, 'binary_precision': 0.22109988, 'binary_recall': 0.61275274, 'binary_specificity': 0.92352194, 'binary_f1_score': 0.32494843}
confusion matrix:
       0     1
0  16761  1388
1    249   394
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9245765, 'precision': 0.65677357, 'recall': 0.8415453, 'specificity': 0.8415453, 'f1': 0.7065978, 'auroc': 0.9130766, 'binary_precision': 0.32504147, 'binary_recall': 0.75095785, 'binary_specificity': 0.9321327, 'binary_f1_score': 0.45370376}
confusion matrix:
      0    1
0  5590  407
1    65  196
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-31 03:48:33.739940,epoch time: 0:27:46.588021,used: 0:27:46.588021,model: dset_te_center0_erm_no_git_version_2024md_07md_31_03_20_46_seed_0_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9688459, 'precision': 0.96892285, 'recall': 0.9688505, 'specificity': 0.9688505, 'f1': 0.96884483, 'auroc': 0.99463797, 'binary_precision': 0.97510856, 'binary_recall': 0.96229964, 'binary_specificity': 0.9754013, 'binary_f1_score': 0.9686618}
confusion matrix:
       0      1
0  27955    705
1   1082  27618
---- Validation: 
scalar performance:
{'acc': 0.8962324, 'precision': 0.59314597, 'recall': 0.7880164, 'specificity': 0.7880164, 'f1': 0.6254767, 'auroc': 0.8651825, 'binary_precision': 0.19898665, 'binary_recall': 0.6718507, 'binary_specificity': 0.9041821, 'binary_f1_score': 0.30703625}
confusion matrix:
       0     1
0  16410  1739
1    211   432
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89213806, 'precision': 0.61844766, 'recall': 0.8374465, 'specificity': 0.8374465, 'f1': 0.6582744, 'auroc': 0.9089481, 'binary_precision': 0.24756098, 'binary_recall': 0.7777778, 'binary_specificity': 0.89711523, 'binary_f1_score': 0.37557817}
confusion matrix:
      0    1
0  5380  617
1    58  203
early stop counter: 1
val acc:0.8962324261665344, best validation acc: 0.9128884673118591, corresponding to test acc:                         0.9245765209197998 / 0.9245765209197998
after epoch: 2,now: 2024-07-31 04:16:00.643230,epoch time: 0:27:26.903290,used: 0:55:13.491311,model: dset_te_center0_erm_no_git_version_2024md_07md_31_03_20_46_seed_0_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9742504, 'precision': 0.97425056, 'recall': 0.9742508, 'specificity': 0.9742508, 'f1': 0.9742503, 'auroc': 0.9962375, 'binary_precision': 0.97481775, 'binary_recall': 0.97369707, 'binary_specificity': 0.9748046, 'binary_f1_score': 0.9742571}
confusion matrix:
       0      1
0  27934    722
1    755  27949
---- Validation: 
scalar performance:
{'acc': 0.8843657, 'precision': 0.5873307, 'recall': 0.798374, 'specificity': 0.798374, 'f1': 0.61586475, 'auroc': 0.86984766, 'binary_precision': 0.18621822, 'binary_recall': 0.7060653, 'binary_specificity': 0.8906827, 'binary_f1_score': 0.2947095}
confusion matrix:
       0     1
0  16165  1984
1    189   454
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87072545, 'precision': 0.6005327, 'recall': 0.8244419, 'specificity': 0.8244419, 'f1': 0.6307423, 'auroc': 0.90366125, 'binary_precision': 0.21218488, 'binary_recall': 0.77394634, 'binary_specificity': 0.8749375, 'binary_f1_score': 0.33305854}
confusion matrix:
      0    1
0  5247  750
1    59  202
early stop counter: 2
val acc:0.8843656778335571, best validation acc: 0.9128884673118591, corresponding to test acc:                         0.9245765209197998 / 0.9245765209197998
after epoch: 3,now: 2024-07-31 04:42:57.121613,epoch time: 0:26:56.478383,used: 1:22:09.969694,model: dset_te_center0_erm_no_git_version_2024md_07md_31_03_20_46_seed_0_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9767608, 'precision': 0.97691303, 'recall': 0.9767678, 'specificity': 0.9767678, 'f1': 0.9767592, 'auroc': 0.9967056, 'binary_precision': 0.9856276, 'binary_recall': 0.96766776, 'binary_specificity': 0.9858678, 'binary_f1_score': 0.9765651}
confusion matrix:
       0      1
0  28253    405
1    928  27774
---- Validation: 
scalar performance:
{'acc': 0.8971371, 'precision': 0.59410584, 'recall': 0.78923476, 'specificity': 0.78923476, 'f1': 0.6269132, 'auroc': 0.8693967, 'binary_precision': 0.20083489, 'binary_recall': 0.6734059, 'binary_specificity': 0.9050636, 'binary_f1_score': 0.30939624}
confusion matrix:
       0     1
0  16426  1723
1    210   433
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8801534, 'precision': 0.60519296, 'recall': 0.818367, 'specificity': 0.818367, 'f1': 0.63865876, 'auroc': 0.9010955, 'binary_precision': 0.22247446, 'binary_recall': 0.75095785, 'binary_specificity': 0.8857762, 'binary_f1_score': 0.34325746}
confusion matrix:
      0    1
0  5312  685
1    65  196
early stop counter: 3
val acc:0.8971371054649353, best validation acc: 0.9128884673118591, corresponding to test acc:                         0.9245765209197998 / 0.9245765209197998
after epoch: 4,now: 2024-07-31 05:10:09.092922,epoch time: 0:27:11.971309,used: 1:49:21.941003,model: dset_te_center0_erm_no_git_version_2024md_07md_31_03_20_46_seed_0_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:49:21.941003 at 2024-07-31 05:10:09.092922
persisted model performance metric: 

scalar performance:
{'acc': 0.9245765, 'precision': 0.65677357, 'recall': 0.8415453, 'specificity': 0.8415453, 'f1': 0.7065978, 'auroc': 0.9130766, 'binary_precision': 0.32504147, 'binary_recall': 0.75095785, 'binary_specificity': 0.9321327, 'binary_f1_score': 0.45370376}
confusion matrix:
      0    1
0  5590  407
1    65  196
oracle model performance metric: 

scalar performance:
{'acc': 0.9245765, 'precision': 0.65677357, 'recall': 0.8415453, 'specificity': 0.8415453, 'f1': 0.7065978, 'auroc': 0.9130766, 'binary_precision': 0.32504147, 'binary_recall': 0.75095785, 'binary_specificity': 0.9321327, 'binary_f1_score': 0.45370376}
confusion matrix:
      0    1
0  5590  407
1    65  196
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/7.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/7.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/confusion_matrix/7.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 205600 KiB |   1203 MiB | 133103 GiB | 133103 GiB |
|       from large pool | 188109 KiB |   1186 MiB | 131260 GiB | 131260 GiB |
|       from small pool |  17491 KiB |     37 MiB |   1842 GiB |   1842 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 205600 KiB |   1203 MiB | 133103 GiB | 133103 GiB |
|       from large pool | 188109 KiB |   1186 MiB | 131260 GiB | 131260 GiB |
|       from small pool |  17491 KiB |     37 MiB |   1842 GiB |   1842 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 203141 KiB |   1201 MiB | 132520 GiB | 132520 GiB |
|       from large pool | 186659 KiB |   1184 MiB | 130681 GiB | 130681 GiB |
|       from small pool |  16482 KiB |     36 MiB |   1839 GiB |   1839 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1346 MiB |   1346 MiB |   1346 MiB |      0 B   |
|       from large pool |   1304 MiB |   1304 MiB |   1304 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  74975 KiB | 173957 KiB |  78879 GiB |  78879 GiB |
|       from large pool |  69938 KiB | 172419 KiB |  77022 GiB |  77022 GiB |
|       from small pool |   5037 KiB |   9269 KiB |   1857 GiB |   1857 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2988    |    7655    |   23059 K  |   23056 K  |
|       from large pool |      84    |     172    |   12230 K  |   12230 K  |
|       from small pool |    2904    |    7570    |   10828 K  |   10825 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2988    |    7655    |   23059 K  |   23056 K  |
|       from large pool |      84    |     172    |   12230 K  |   12230 K  |
|       from small pool |    2904    |    7570    |   10828 K  |   10825 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      76    |      76    |      76    |       0    |
|       from large pool |      55    |      55    |      55    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3606    |   14428 K  |   14428 K  |
|       from large pool |      11    |      56    |    9245 K  |    9245 K  |
|       from small pool |      20    |    3595    |    5182 K  |    5182 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1203 MiB | 133103 GiB | 133103 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 131260 GiB | 131260 GiB |
|       from small pool |      0 KiB |     37 MiB |   1842 GiB |   1842 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1203 MiB | 133103 GiB | 133103 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 131260 GiB | 131260 GiB |
|       from small pool |      0 KiB |     37 MiB |   1842 GiB |   1842 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1201 MiB | 132520 GiB | 132520 GiB |
|       from large pool |  16640 KiB |   1184 MiB | 130681 GiB | 130681 GiB |
|       from small pool |      0 KiB |     36 MiB |   1839 GiB |   1839 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 280576 KiB |   1346 MiB |   1346 MiB |   1072 MiB |
|       from large pool | 258048 KiB |   1304 MiB |   1304 MiB |   1052 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 173957 KiB |  78879 GiB |  78879 GiB |
|       from large pool |  30464 KiB | 172419 KiB |  77022 GiB |  77022 GiB |
|       from small pool |      0 KiB |  16243 KiB |   1857 GiB |   1857 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7655    |   23059 K  |   23059 K  |
|       from large pool |       2    |     172    |   12230 K  |   12230 K  |
|       from small pool |       0    |    7570    |   10828 K  |   10828 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7655    |   23059 K  |   23059 K  |
|       from large pool |       2    |     172    |   12230 K  |   12230 K  |
|       from small pool |       0    |    7570    |   10828 K  |   10828 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |      76    |      53    |
|       from large pool |      12    |      55    |      55    |      43    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |    3606    |   14429 K  |   14429 K  |
|       from large pool |       2    |      56    |    9245 K  |    9245 K  |
|       from small pool |       0    |    3595    |    5183 K  |    5183 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1203 MiB | 133103 GiB | 133103 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 131260 GiB | 131260 GiB |
|       from small pool |      0 KiB |     37 MiB |   1842 GiB |   1842 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1203 MiB | 133103 GiB | 133103 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 131260 GiB | 131260 GiB |
|       from small pool |      0 KiB |     37 MiB |   1842 GiB |   1842 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1201 MiB | 132520 GiB | 132520 GiB |
|       from large pool |  16640 KiB |   1184 MiB | 130681 GiB | 130681 GiB |
|       from small pool |      0 KiB |     36 MiB |   1839 GiB |   1839 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 280576 KiB |   1346 MiB |   1346 MiB |   1072 MiB |
|       from large pool | 258048 KiB |   1304 MiB |   1304 MiB |   1052 MiB |
|       from small pool |  22528 KiB |     42 MiB |     42 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 173957 KiB |  78879 GiB |  78879 GiB |
|       from large pool |  30464 KiB | 172419 KiB |  77022 GiB |  77022 GiB |
|       from small pool |      0 KiB |  16243 KiB |   1857 GiB |   1857 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7655    |   23059 K  |   23059 K  |
|       from large pool |       2    |     172    |   12230 K  |   12230 K  |
|       from small pool |       0    |    7570    |   10828 K  |   10828 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7655    |   23059 K  |   23059 K  |
|       from large pool |       2    |     172    |   12230 K  |   12230 K  |
|       from small pool |       0    |    7570    |   10828 K  |   10828 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |      76    |      53    |
|       from large pool |      12    |      55    |      55    |      43    |
|       from small pool |      11    |      21    |      21    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |    3606    |   14429 K  |   14429 K  |
|       from large pool |       2    |      56    |    9245 K  |    9245 K  |
|       from small pool |       0    |    3595    |    5183 K  |    5183 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



warning: Not a git repository. Use --no-index to compare two paths outside a working tree
usage: git diff --no-index [<options>] <path> <path>

Diff output format options
    -p, --patch           generate patch
    -s, --no-patch        suppress diff output
    -u                    generate patch
    -U, --unified[=<n>]   generate diffs with <n> lines context
    -W, --function-context
                          generate diffs with <n> lines context
    --raw                 generate the diff in raw format
    --patch-with-raw      synonym for '-p --raw'
    --patch-with-stat     synonym for '-p --stat'
    --numstat             machine friendly --stat
    --shortstat           output only the last line of --stat
    -X, --dirstat[=<param1,param2>...]
                          output the distribution of relative amount of changes for each sub-directory
    --cumulative          synonym for --dirstat=cumulative
    --dirstat-by-file[=<param1,param2>...]
                          synonym for --dirstat=files,param1,param2...
    --check               warn if changes introduce conflict markers or whitespace errors
    --summary             condensed summary such as creations, renames and mode changes
    --name-only           show only names of changed files
    --name-status         show only names and status of changed files
    --stat[=<width>[,<name-width>[,<count>]]]
                          generate diffstat
    --stat-width <width>  generate diffstat with a given width
    --stat-name-width <width>
                          generate diffstat with a given name width
    --stat-graph-width <width>
                          generate diffstat with a given graph width
    --stat-count <count>  generate diffstat with limited lines
    --compact-summary     generate compact summary in diffstat
    --binary              output a binary diff that can be applied
    --full-index          show full pre- and post-image object names on the "index" lines
    --color[=<when>]      show colored diff
    --ws-error-highlight <kind>
                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff
    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat
    --abbrev[=<n>]        use <n> digits to display object names
    --src-prefix <prefix>
                          show the given source prefix instead of "a/"
    --dst-prefix <prefix>
                          show the given destination prefix instead of "b/"
    --line-prefix <prefix>
                          prepend an additional prefix to every line of output
    --no-prefix           do not show any source or destination prefix
    --inter-hunk-context <n>
                          show context between diff hunks up to the specified number of lines
    --output-indicator-new <char>
                          specify the character to indicate a new line instead of '+'
    --output-indicator-old <char>
                          specify the character to indicate an old line instead of '-'
    --output-indicator-context <char>
                          specify the character to indicate a context instead of ' '

Diff rename options
    -B, --break-rewrites[=<n>[/<m>]]
                          break complete rewrite changes into pairs of delete and create
    -M, --find-renames[=<n>]
                          detect renames
    -D, --irreversible-delete
                          omit the preimage for deletes
    -C, --find-copies[=<n>]
                          detect copies
    --find-copies-harder  use unmodified files as source to find copies
    --no-renames          disable rename detection
    --rename-empty        use empty blobs as rename source
    --follow              continue listing the history of a file beyond renames
    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit

Diff algorithm options
    --minimal             produce the smallest possible diff
    -w, --ignore-all-space
                          ignore whitespace when comparing lines
    -b, --ignore-space-change
                          ignore changes in amount of whitespace
    --ignore-space-at-eol
                          ignore changes in whitespace at EOL
    --ignore-cr-at-eol    ignore carrier-return at the end of line
    --ignore-blank-lines  ignore changes whose lines are all blank
    -I, --ignore-matching-lines <regex>
                          ignore changes whose all lines match <regex>
    --indent-heuristic    heuristic to shift diff hunk boundaries for easy reading
    --patience            generate diff using the "patience diff" algorithm
    --histogram           generate diff using the "histogram diff" algorithm
    --diff-algorithm <algorithm>
                          choose a diff algorithm
    --anchored <text>     generate diff using the "anchored diff" algorithm
    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words
    --word-diff-regex <regex>
                          use <regex> to decide what a word is
    --color-words[=<regex>]
                          equivalent to --word-diff=color --word-diff-regex=<regex>
    --color-moved[=<mode>]
                          moved lines of code are colored differently
    --color-moved-ws <mode>
                          how white spaces are ignored in --color-moved

Other diff options
    --relative[=<prefix>]
                          when run from subdir, exclude changes outside and show relative paths
    -a, --text            treat all files as text
    -R                    swap two inputs, reverse the diff
    --exit-code           exit with 1 if there were differences, 0 otherwise
    --quiet               disable all output of the program
    --ext-diff            allow an external diff helper to be executed
    --textconv            run external text conversion filters when comparing binary files
    --ignore-submodules[=<when>]
                          ignore changes to submodules in the diff generation
    --submodule[=<format>]
                          specify how differences in submodules are shown
    --ita-invisible-in-index
                          hide 'git add -N' entries from the index
    --ita-visible-in-index
                          treat 'git add -N' entries as real in the index
    -S <string>           look for differences that change the number of occurrences of the specified string
    -G <regex>            look for differences that change the number of occurrences of the specified regex
    --pickaxe-all         show all changes in the changeset with -S or -G
    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression
    -O <file>             control the order in which files appear in the output
    --rotate-to <path>    show the change in the specified path first
    --skip-to <path>      skip the output to the specified path
    --find-object <object-id>
                          look for differences that change the number of occurrences of the specified object
    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]
                          select files by diff type
    --output <file>       output to a specific file

not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:26: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:38: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
model name: dset_te_center0_erm_no_git_version_2024md_07md_31_05_20_30_seed_1_23775383

 Experiment start at: 2024-07-31 05:20:30.365125
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94999653, 'precision': 0.9508778, 'recall': 0.95001274, 'specificity': 0.95001274, 'f1': 0.94997334, 'auroc': 0.9874135, 'binary_precision': 0.970994, 'binary_recall': 0.92778105, 'binary_specificity': 0.97224444, 'binary_f1_score': 0.9488958}
confusion matrix:
       0      1
0  27988    799
1   2082  26747
---- Validation: 
scalar performance:
{'acc': 0.92726785, 'precision': 0.62594736, 'recall': 0.7655808, 'specificity': 0.7655808, 'f1': 0.66505015, 'auroc': 0.8771548, 'binary_precision': 0.2678331, 'binary_recall': 0.59138185, 'binary_specificity': 0.9397797, 'binary_f1_score': 0.3686892}
confusion matrix:
       0     1
0  16979  1088
1    275   398
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9323236, 'precision': 0.6675499, 'recall': 0.82491916, 'specificity': 0.82491916, 'f1': 0.71543646, 'auroc': 0.9175923, 'binary_precision': 0.34848484, 'binary_recall': 0.7076923, 'binary_specificity': 0.942146, 'binary_f1_score': 0.46700507}
confusion matrix:
      0    1
0  5602  344
1    76  184
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-31 05:48:34.481402,epoch time: 0:28:04.116277,used: 0:28:04.116277,model: dset_te_center0_erm_no_git_version_2024md_07md_31_05_20_30_seed_1_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96119136, 'precision': 0.96148306, 'recall': 0.9612006, 'specificity': 0.9612006, 'f1': 0.96118575, 'auroc': 0.9923805, 'binary_precision': 0.9732693, 'binary_recall': 0.94848937, 'binary_specificity': 0.9739118, 'binary_f1_score': 0.9607196}
confusion matrix:
       0      1
0  28036    751
1   1485  27344
---- Validation: 
scalar performance:
{'acc': 0.9210779, 'precision': 0.6279746, 'recall': 0.8110087, 'specificity': 0.8110087, 'f1': 0.6721938, 'auroc': 0.88888156, 'binary_precision': 0.26812428, 'binary_recall': 0.692422, 'binary_specificity': 0.9295954, 'binary_f1_score': 0.3865616}
confusion matrix:
       0     1
0  16795  1272
1    207   466
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9020303, 'precision': 0.6332707, 'recall': 0.8624408, 'specificity': 0.8624408, 'f1': 0.6792779, 'auroc': 0.9302045, 'binary_precision': 0.2751938, 'binary_recall': 0.8192308, 'binary_specificity': 0.90565085, 'binary_f1_score': 0.41199228}
confusion matrix:
      0    1
0  5385  561
1    47  213
early stop counter: 1
val acc:0.9210779070854187, best validation acc: 0.927267849445343, corresponding to test acc:                         0.9323235750198364 / 0.9323235750198364
after epoch: 2,now: 2024-07-31 06:15:44.787992,epoch time: 0:27:10.306590,used: 0:55:14.422867,model: dset_te_center0_erm_no_git_version_2024md_07md_31_05_20_30_seed_1_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97007775, 'precision': 0.97017395, 'recall': 0.9700831, 'specificity': 0.9700831, 'f1': 0.97007644, 'auroc': 0.99501455, 'binary_precision': 0.9770831, 'binary_recall': 0.96278054, 'binary_specificity': 0.97738564, 'binary_f1_score': 0.96987903}
confusion matrix:
       0      1
0  28136    651
1   1073  27756
---- Validation: 
scalar performance:
{'acc': 0.89503735, 'precision': 0.60747474, 'recall': 0.83970416, 'specificity': 0.83970416, 'f1': 0.64547604, 'auroc': 0.89525425, 'binary_precision': 0.2239761, 'binary_recall': 0.78008914, 'binary_specificity': 0.8993192, 'binary_f1_score': 0.34802783}
confusion matrix:
       0     1
0  16248  1819
1    148   525
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.85014504, 'precision': 0.5970056, 'recall': 0.85743165, 'specificity': 0.85743165, 'f1': 0.62089336, 'auroc': 0.92827237, 'binary_precision': 0.20089285, 'binary_recall': 0.86538464, 'binary_specificity': 0.84947866, 'binary_f1_score': 0.32608694}
confusion matrix:
      0    1
0  5051  895
1    35  225
early stop counter: 2
val acc:0.8950373530387878, best validation acc: 0.927267849445343, corresponding to test acc:                         0.9323235750198364 / 0.9323235750198364
after epoch: 3,now: 2024-07-31 06:43:03.195078,epoch time: 0:27:18.407086,used: 1:22:32.829953,model: dset_te_center0_erm_no_git_version_2024md_07md_31_05_20_30_seed_1_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.970529, 'precision': 0.97091067, 'recall': 0.9705395, 'specificity': 0.9705395, 'f1': 0.9705235, 'auroc': 0.99543905, 'binary_precision': 0.98449945, 'binary_recall': 0.95615524, 'binary_specificity': 0.9849238, 'binary_f1_score': 0.9701203}
confusion matrix:
       0      1
0  28353    434
1   1264  27565
---- Validation: 
scalar performance:
{'acc': 0.9083778, 'precision': 0.61865926, 'recall': 0.83589387, 'specificity': 0.83589387, 'f1': 0.6616254, 'auroc': 0.8982104, 'binary_precision': 0.24709302, 'binary_recall': 0.7578009, 'binary_specificity': 0.9139868, 'binary_f1_score': 0.3726708}
confusion matrix:
       0     1
0  16513  1554
1    163   510
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.863358, 'precision': 0.60499525, 'recall': 0.8643271, 'specificity': 0.8643271, 'f1': 0.6351935, 'auroc': 0.93021035, 'binary_precision': 0.216763, 'binary_recall': 0.86538464, 'binary_specificity': 0.86326945, 'binary_f1_score': 0.34668723}
confusion matrix:
      0    1
0  5133  813
1    35  225
early stop counter: 3
val acc:0.9083778262138367, best validation acc: 0.927267849445343, corresponding to test acc:                         0.9323235750198364 / 0.9323235750198364
after epoch: 4,now: 2024-07-31 07:10:15.284392,epoch time: 0:27:12.089314,used: 1:49:44.919267,model: dset_te_center0_erm_no_git_version_2024md_07md_31_05_20_30_seed_1_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:49:44.919267 at 2024-07-31 07:10:15.284392
persisted model performance metric: 

scalar performance:
{'acc': 0.9323236, 'precision': 0.6675499, 'recall': 0.82491916, 'specificity': 0.82491916, 'f1': 0.71543646, 'auroc': 0.9175923, 'binary_precision': 0.34848484, 'binary_recall': 0.7076923, 'binary_specificity': 0.942146, 'binary_f1_score': 0.46700507}
confusion matrix:
      0    1
0  5602  344
1    76  184
oracle model performance metric: 

scalar performance:
{'acc': 0.9323236, 'precision': 0.6675499, 'recall': 0.82491916, 'specificity': 0.82491916, 'f1': 0.71543646, 'auroc': 0.9175923, 'binary_precision': 0.34848484, 'binary_recall': 0.7076923, 'binary_specificity': 0.942146, 'binary_f1_score': 0.46700507}
confusion matrix:
      0    1
0  5602  344
1    76  184
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/7.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/confusion_matrix/7.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197546 KiB |   1203 MiB | 266376 GiB | 266376 GiB |
|       from large pool | 180067 KiB |   1186 MiB | 262728 GiB | 262728 GiB |
|       from small pool |  17479 KiB |     37 MiB |   3647 GiB |   3647 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197546 KiB |   1203 MiB | 266376 GiB | 266376 GiB |
|       from large pool | 180067 KiB |   1186 MiB | 262728 GiB | 262728 GiB |
|       from small pool |  17479 KiB |     37 MiB |   3647 GiB |   3647 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195459 KiB |   1201 MiB | 265382 GiB | 265382 GiB |
|       from large pool | 178979 KiB |   1184 MiB | 261742 GiB | 261741 GiB |
|       from small pool |  16480 KiB |     36 MiB |   3640 GiB |   3640 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1354 MiB |   1354 MiB |   2426 MiB |   1072 MiB |
|       from large pool |   1316 MiB |   1316 MiB |   2368 MiB |   1052 MiB |
|       from small pool |     38 MiB |     42 MiB |     58 MiB |     20 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40022 KiB | 173957 KiB | 156031 GiB | 156031 GiB |
|       from large pool |  30877 KiB | 172419 KiB | 152354 GiB | 152354 GiB |
|       from small pool |   9145 KiB |  16243 KiB |   3677 GiB |   3677 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7677    |   45895 K  |   45892 K  |
|       from large pool |      79    |     172    |   24471 K  |   24470 K  |
|       from small pool |    2875    |    7597    |   21424 K  |   21421 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7677    |   45895 K  |   45892 K  |
|       from large pool |      79    |     172    |   24471 K  |   24470 K  |
|       from small pool |    2875    |    7597    |   21424 K  |   21421 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     127    |      53    |
|       from large pool |      55    |      55    |      98    |      43    |
|       from small pool |      19    |      21    |      29    |      10    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3618    |   28805 K  |   28805 K  |
|       from large pool |       9    |      57    |   18537 K  |   18537 K  |
|       from small pool |      22    |    3609    |   10268 K  |   10268 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1203 MiB | 266376 GiB | 266376 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 262728 GiB | 262728 GiB |
|       from small pool |      0 KiB |     37 MiB |   3647 GiB |   3647 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1203 MiB | 266376 GiB | 266376 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 262728 GiB | 262728 GiB |
|       from small pool |      0 KiB |     37 MiB |   3647 GiB |   3647 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1201 MiB | 265382 GiB | 265382 GiB |
|       from large pool |  16640 KiB |   1184 MiB | 261742 GiB | 261742 GiB |
|       from small pool |      0 KiB |     36 MiB |   3640 GiB |   3640 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1354 MiB |   2426 MiB |   2194 MiB |
|       from large pool | 210944 KiB |   1316 MiB |   2368 MiB |   2162 MiB |
|       from small pool |  26624 KiB |     42 MiB |     58 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 173957 KiB | 156031 GiB | 156031 GiB |
|       from large pool |  30464 KiB | 172419 KiB | 152354 GiB | 152354 GiB |
|       from small pool |      0 KiB |  21453 KiB |   3677 GiB |   3677 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |   45895 K  |   45895 K  |
|       from large pool |       2    |     172    |   24471 K  |   24471 K  |
|       from small pool |       0    |    7597    |   21424 K  |   21424 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |   45895 K  |   45895 K  |
|       from large pool |       2    |     172    |   24471 K  |   24471 K  |
|       from small pool |       0    |    7597    |   21424 K  |   21424 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     127    |     104    |
|       from large pool |      10    |      55    |      98    |      88    |
|       from small pool |      13    |      21    |      29    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |    3618    |   28806 K  |   28806 K  |
|       from large pool |       2    |      57    |   18537 K  |   18537 K  |
|       from small pool |       0    |    3609    |   10269 K  |   10269 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1203 MiB | 266376 GiB | 266376 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 262728 GiB | 262728 GiB |
|       from small pool |      0 KiB |     37 MiB |   3647 GiB |   3647 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1203 MiB | 266376 GiB | 266376 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 262728 GiB | 262728 GiB |
|       from small pool |      0 KiB |     37 MiB |   3647 GiB |   3647 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1201 MiB | 265382 GiB | 265382 GiB |
|       from large pool |  16640 KiB |   1184 MiB | 261742 GiB | 261742 GiB |
|       from small pool |      0 KiB |     36 MiB |   3640 GiB |   3640 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1354 MiB |   2426 MiB |   2194 MiB |
|       from large pool | 210944 KiB |   1316 MiB |   2368 MiB |   2162 MiB |
|       from small pool |  26624 KiB |     42 MiB |     58 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 173957 KiB | 156031 GiB | 156031 GiB |
|       from large pool |  30464 KiB | 172419 KiB | 152354 GiB | 152354 GiB |
|       from small pool |      0 KiB |  21453 KiB |   3677 GiB |   3677 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7677    |   45895 K  |   45895 K  |
|       from large pool |       2    |     172    |   24471 K  |   24471 K  |
|       from small pool |       0    |    7597    |   21424 K  |   21424 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7677    |   45895 K  |   45895 K  |
|       from large pool |       2    |     172    |   24471 K  |   24471 K  |
|       from small pool |       0    |    7597    |   21424 K  |   21424 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     127    |     104    |
|       from large pool |      10    |      55    |      98    |      88    |
|       from small pool |      13    |      21    |      29    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |    3618    |   28806 K  |   28806 K  |
|       from large pool |       2    |      57    |   18537 K  |   18537 K  |
|       from small pool |       0    |    3609    |   10269 K  |   10269 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



warning: Not a git repository. Use --no-index to compare two paths outside a working tree
usage: git diff --no-index [<options>] <path> <path>

Diff output format options
    -p, --patch           generate patch
    -s, --no-patch        suppress diff output
    -u                    generate patch
    -U, --unified[=<n>]   generate diffs with <n> lines context
    -W, --function-context
                          generate diffs with <n> lines context
    --raw                 generate the diff in raw format
    --patch-with-raw      synonym for '-p --raw'
    --patch-with-stat     synonym for '-p --stat'
    --numstat             machine friendly --stat
    --shortstat           output only the last line of --stat
    -X, --dirstat[=<param1,param2>...]
                          output the distribution of relative amount of changes for each sub-directory
    --cumulative          synonym for --dirstat=cumulative
    --dirstat-by-file[=<param1,param2>...]
                          synonym for --dirstat=files,param1,param2...
    --check               warn if changes introduce conflict markers or whitespace errors
    --summary             condensed summary such as creations, renames and mode changes
    --name-only           show only names of changed files
    --name-status         show only names and status of changed files
    --stat[=<width>[,<name-width>[,<count>]]]
                          generate diffstat
    --stat-width <width>  generate diffstat with a given width
    --stat-name-width <width>
                          generate diffstat with a given name width
    --stat-graph-width <width>
                          generate diffstat with a given graph width
    --stat-count <count>  generate diffstat with limited lines
    --compact-summary     generate compact summary in diffstat
    --binary              output a binary diff that can be applied
    --full-index          show full pre- and post-image object names on the "index" lines
    --color[=<when>]      show colored diff
    --ws-error-highlight <kind>
                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff
    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat
    --abbrev[=<n>]        use <n> digits to display object names
    --src-prefix <prefix>
                          show the given source prefix instead of "a/"
    --dst-prefix <prefix>
                          show the given destination prefix instead of "b/"
    --line-prefix <prefix>
                          prepend an additional prefix to every line of output
    --no-prefix           do not show any source or destination prefix
    --inter-hunk-context <n>
                          show context between diff hunks up to the specified number of lines
    --output-indicator-new <char>
                          specify the character to indicate a new line instead of '+'
    --output-indicator-old <char>
                          specify the character to indicate an old line instead of '-'
    --output-indicator-context <char>
                          specify the character to indicate a context instead of ' '

Diff rename options
    -B, --break-rewrites[=<n>[/<m>]]
                          break complete rewrite changes into pairs of delete and create
    -M, --find-renames[=<n>]
                          detect renames
    -D, --irreversible-delete
                          omit the preimage for deletes
    -C, --find-copies[=<n>]
                          detect copies
    --find-copies-harder  use unmodified files as source to find copies
    --no-renames          disable rename detection
    --rename-empty        use empty blobs as rename source
    --follow              continue listing the history of a file beyond renames
    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit

Diff algorithm options
    --minimal             produce the smallest possible diff
    -w, --ignore-all-space
                          ignore whitespace when comparing lines
    -b, --ignore-space-change
                          ignore changes in amount of whitespace
    --ignore-space-at-eol
                          ignore changes in whitespace at EOL
    --ignore-cr-at-eol    ignore carrier-return at the end of line
    --ignore-blank-lines  ignore changes whose lines are all blank
    -I, --ignore-matching-lines <regex>
                          ignore changes whose all lines match <regex>
    --indent-heuristic    heuristic to shift diff hunk boundaries for easy reading
    --patience            generate diff using the "patience diff" algorithm
    --histogram           generate diff using the "histogram diff" algorithm
    --diff-algorithm <algorithm>
                          choose a diff algorithm
    --anchored <text>     generate diff using the "anchored diff" algorithm
    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words
    --word-diff-regex <regex>
                          use <regex> to decide what a word is
    --color-words[=<regex>]
                          equivalent to --word-diff=color --word-diff-regex=<regex>
    --color-moved[=<mode>]
                          moved lines of code are colored differently
    --color-moved-ws <mode>
                          how white spaces are ignored in --color-moved

Other diff options
    --relative[=<prefix>]
                          when run from subdir, exclude changes outside and show relative paths
    -a, --text            treat all files as text
    -R                    swap two inputs, reverse the diff
    --exit-code           exit with 1 if there were differences, 0 otherwise
    --quiet               disable all output of the program
    --ext-diff            allow an external diff helper to be executed
    --textconv            run external text conversion filters when comparing binary files
    --ignore-submodules[=<when>]
                          ignore changes to submodules in the diff generation
    --submodule[=<format>]
                          specify how differences in submodules are shown
    --ita-invisible-in-index
                          hide 'git add -N' entries from the index
    --ita-visible-in-index
                          treat 'git add -N' entries as real in the index
    -S <string>           look for differences that change the number of occurrences of the specified string
    -G <regex>            look for differences that change the number of occurrences of the specified regex
    --pickaxe-all         show all changes in the changeset with -S or -G
    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression
    -O <file>             control the order in which files appear in the output
    --rotate-to <path>    show the change in the specified path first
    --skip-to <path>      skip the output to the specified path
    --find-object <object-id>
                          look for differences that change the number of occurrences of the specified object
    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]
                          select files by diff type
    --output <file>       output to a specific file

not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:26: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:38: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
model name: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383

 Experiment start at: 2024-07-31 07:20:44.151254
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.94598997, 'precision': 0.94805014, 'recall': 0.9459958, 'specificity': 0.9459958, 'f1': 0.94592834, 'auroc': 0.9859719, 'binary_precision': 0.9784752, 'binary_recall': 0.9120623, 'binary_specificity': 0.9799293, 'binary_f1_score': 0.9441023}
confusion matrix:
       0      1
0  28562    585
1   2564  26593
---- Validation: 
scalar performance:
{'acc': 0.93586534, 'precision': 0.6225438, 'recall': 0.746835, 'specificity': 0.746835, 'f1': 0.65947473, 'auroc': 0.85648394, 'binary_precision': 0.2607313, 'binary_recall': 0.54485047, 'binary_specificity': 0.9488195, 'binary_f1_score': 0.35268816}
confusion matrix:
       0    1
0  17241  930
1    274  328
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9033499, 'precision': 0.6161115, 'recall': 0.8129158, 'specificity': 0.8129158, 'f1': 0.6561457, 'auroc': 0.8807461, 'binary_precision': 0.2446959, 'binary_recall': 0.71487606, 'binary_specificity': 0.9109555, 'binary_f1_score': 0.3645943}
confusion matrix:
      0    1
0  5463  534
1    69  173
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-31 07:49:17.095536,epoch time: 0:28:32.944282,used: 0:28:32.944282,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.963433, 'precision': 0.96378297, 'recall': 0.96343637, 'specificity': 0.96343637, 'f1': 0.96342635, 'auroc': 0.9924332, 'binary_precision': 0.9765826, 'binary_recall': 0.94965535, 'binary_specificity': 0.9772174, 'binary_f1_score': 0.96293074}
confusion matrix:
       0      1
0  28481    664
1   1468  27691
---- Validation: 
scalar performance:
{'acc': 0.93714374, 'precision': 0.6303423, 'recall': 0.7675716, 'specificity': 0.7675716, 'f1': 0.6706235, 'auroc': 0.8694916, 'binary_precision': 0.27492213, 'binary_recall': 0.58637875, 'binary_specificity': 0.9487645, 'binary_f1_score': 0.37433723}
confusion matrix:
       0    1
0  17240  931
1    249  353
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9139285, 'precision': 0.6377008, 'recall': 0.86005604, 'specificity': 0.86005604, 'f1': 0.68648905, 'auroc': 0.9110092, 'binary_precision': 0.284041, 'binary_recall': 0.8016529, 'binary_specificity': 0.91845924, 'binary_f1_score': 0.4194595}
confusion matrix:
      0    1
0  5508  489
1    48  194
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-31 08:16:28.202328,epoch time: 0:27:11.106792,used: 0:55:44.051074,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9680811, 'precision': 0.9681665, 'recall': 0.9680827, 'specificity': 0.9680827, 'f1': 0.9680797, 'auroc': 0.99408305, 'binary_precision': 0.9745498, 'binary_recall': 0.96128124, 'binary_specificity': 0.9748842, 'binary_f1_score': 0.96787}
confusion matrix:
       0      1
0  28413    732
1   1129  28030
---- Validation: 
scalar performance:
{'acc': 0.9307516, 'precision': 0.61854434, 'recall': 0.7642697, 'specificity': 0.7642697, 'f1': 0.65768284, 'auroc': 0.87139714, 'binary_precision': 0.2514245, 'binary_recall': 0.58637875, 'binary_specificity': 0.9421606, 'binary_f1_score': 0.35194415}
confusion matrix:
       0     1
0  17120  1051
1    249   353
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91729444, 'precision': 0.64141715, 'recall': 0.8578415, 'specificity': 0.8578415, 'f1': 0.6910497, 'auroc': 0.91634107, 'binary_precision': 0.29179332, 'binary_recall': 0.7933884, 'binary_specificity': 0.9222945, 'binary_f1_score': 0.42666668}
confusion matrix:
      0    1
0  5531  466
1    50  192
new oracle model saved
early stop counter: 1
val acc:0.930751621723175, best validation acc: 0.9371437430381775, corresponding to test acc:                         0.9139285087585449 / 0.917294442653656
after epoch: 3,now: 2024-07-31 08:44:12.715825,epoch time: 0:27:44.513497,used: 1:23:28.564571,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97137415, 'precision': 0.97199136, 'recall': 0.9713779, 'specificity': 0.9713779, 'f1': 0.971365, 'auroc': 0.9952692, 'binary_precision': 0.9891107, 'binary_recall': 0.9532547, 'binary_specificity': 0.9895011, 'binary_f1_score': 0.9708518}
confusion matrix:
       0      1
0  28840    306
1   1363  27795
---- Validation: 
scalar performance:
{'acc': 0.9440686, 'precision': 0.6424659, 'recall': 0.75749695, 'specificity': 0.75749695, 'f1': 0.680467, 'auroc': 0.8826131, 'binary_precision': 0.3, 'binary_recall': 0.55813956, 'binary_specificity': 0.95685434, 'binary_f1_score': 0.39024392}
confusion matrix:
       0    1
0  17387  784
1    266  336
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.93845165, 'precision': 0.6738794, 'recall': 0.84505403, 'specificity': 0.84505403, 'f1': 0.72557276, 'auroc': 0.9198945, 'binary_precision': 0.35856575, 'binary_recall': 0.74380165, 'binary_specificity': 0.94630647, 'binary_f1_score': 0.48387095}
confusion matrix:
      0    1
0  5675  322
1    62  180
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-07-31 09:12:34.543514,epoch time: 0:28:21.827689,used: 1:51:50.392260,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97530186, 'precision': 0.9753677, 'recall': 0.97530305, 'specificity': 0.97530305, 'f1': 0.975301, 'auroc': 0.9959124, 'binary_precision': 0.98101485, 'binary_recall': 0.96937376, 'binary_specificity': 0.9812324, 'binary_f1_score': 0.9751595}
confusion matrix:
       0      1
0  28599    547
1    893  28265
---- Validation: 
scalar performance:
{'acc': 0.92920685, 'precision': 0.61781394, 'recall': 0.77069914, 'specificity': 0.77069914, 'f1': 0.6576053, 'auroc': 0.88007945, 'binary_precision': 0.24948311, 'binary_recall': 0.6013289, 'binary_specificity': 0.9400693, 'binary_f1_score': 0.35265464}
confusion matrix:
       0     1
0  17082  1089
1    240   362
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9152108, 'precision': 0.636105, 'recall': 0.84486115, 'specificity': 0.84486115, 'f1': 0.6835903, 'auroc': 0.9174925, 'binary_precision': 0.2822458, 'binary_recall': 0.76859504, 'binary_specificity': 0.92112726, 'binary_f1_score': 0.41287455}
confusion matrix:
      0    1
0  5524  473
1    56  186
early stop counter: 1
val acc:0.9292068481445312, best validation acc: 0.9440686106681824, corresponding to test acc:                         0.9384516477584839 / 0.9384516477584839
after epoch: 5,now: 2024-07-31 09:40:51.579337,epoch time: 0:28:17.035823,used: 2:20:07.428083,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9776859, 'precision': 0.9778642, 'recall': 0.97768724, 'specificity': 0.97768724, 'f1': 0.9776839, 'auroc': 0.99691164, 'binary_precision': 0.9871288, 'binary_recall': 0.9679997, 'binary_specificity': 0.9873748, 'binary_f1_score': 0.9774707}
confusion matrix:
       0      1
0  28780    368
1    933  28223
---- Validation: 
scalar performance:
{'acc': 0.9384755, 'precision': 0.63103247, 'recall': 0.76022905, 'specificity': 0.76022905, 'f1': 0.6701376, 'auroc': 0.8813474, 'binary_precision': 0.27683616, 'binary_recall': 0.5697674, 'binary_specificity': 0.9506907, 'binary_f1_score': 0.37262356}
confusion matrix:
       0    1
0  17275  896
1    259  343
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9338035, 'precision': 0.6604669, 'recall': 0.82479155, 'specificity': 0.82479155, 'f1': 0.7088752, 'auroc': 0.9176551, 'binary_precision': 0.33333334, 'binary_recall': 0.7066116, 'binary_specificity': 0.94297147, 'binary_f1_score': 0.45298016}
confusion matrix:
      0    1
0  5655  342
1    71  171
early stop counter: 2
val acc:0.938475489616394, best validation acc: 0.9440686106681824, corresponding to test acc:                         0.9384516477584839 / 0.9384516477584839
after epoch: 6,now: 2024-07-31 10:11:54.853312,epoch time: 0:31:03.273975,used: 2:51:10.702058,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9781833, 'precision': 0.97852206, 'recall': 0.9781856, 'specificity': 0.9781856, 'f1': 0.97817945, 'auroc': 0.9971117, 'binary_precision': 0.9912964, 'binary_recall': 0.9648455, 'binary_specificity': 0.9915257, 'binary_f1_score': 0.97789204}
confusion matrix:
       0      1
0  28900    247
1   1025  28132
---- Validation: 
scalar performance:
{'acc': 0.93005913, 'precision': 0.61901027, 'recall': 0.77033633, 'specificity': 0.77033633, 'f1': 0.65890837, 'auroc': 0.8842346, 'binary_precision': 0.25191906, 'binary_recall': 0.5996678, 'binary_specificity': 0.9410049, 'binary_f1_score': 0.3547912}
confusion matrix:
       0     1
0  17099  1072
1    241   361
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91376823, 'precision': 0.6325015, 'recall': 0.8361798, 'specificity': 0.8361798, 'f1': 0.6785361, 'auroc': 0.9111047, 'binary_precision': 0.27575758, 'binary_recall': 0.75206614, 'binary_specificity': 0.92029345, 'binary_f1_score': 0.4035477}
confusion matrix:
      0    1
0  5519  478
1    60  182
early stop counter: 3
val acc:0.9300591349601746, best validation acc: 0.9440686106681824, corresponding to test acc:                         0.9384516477584839 / 0.9384516477584839
after epoch: 7,now: 2024-07-31 10:44:16.327882,epoch time: 0:32:21.474570,used: 3:23:32.176628,model: dset_te_center0_erm_no_git_version_2024md_07md_31_07_20_43_seed_2_23775383
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 3:23:32.176628 at 2024-07-31 10:44:16.327882
persisted model performance metric: 

scalar performance:
{'acc': 0.93845165, 'precision': 0.6738794, 'recall': 0.84505403, 'specificity': 0.84505403, 'f1': 0.72557276, 'auroc': 0.9198945, 'binary_precision': 0.35856575, 'binary_recall': 0.74380165, 'binary_specificity': 0.94630647, 'binary_f1_score': 0.48387095}
confusion matrix:
      0    1
0  5675  322
1    62  180
oracle model performance metric: 

scalar performance:
{'acc': 0.93845165, 'precision': 0.6738794, 'recall': 0.84505403, 'specificity': 0.84505403, 'f1': 0.72557276, 'auroc': 0.9198945, 'binary_precision': 0.35856575, 'binary_recall': 0.74380165, 'binary_specificity': 0.94630647, 'binary_f1_score': 0.48387095}
confusion matrix:
      0    1
0  5675  322
1    62  180
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/7.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/confusion_matrix/7.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197552 KiB |   1203 MiB | 499992 GiB | 499992 GiB |
|       from large pool | 180067 KiB |   1186 MiB | 493196 GiB | 493196 GiB |
|       from small pool |  17485 KiB |     37 MiB |   6795 GiB |   6795 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197552 KiB |   1203 MiB | 499992 GiB | 499992 GiB |
|       from large pool | 180067 KiB |   1186 MiB | 493196 GiB | 493196 GiB |
|       from small pool |  17485 KiB |     37 MiB |   6795 GiB |   6795 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195460 KiB |   1201 MiB | 498273 GiB | 498273 GiB |
|       from large pool | 178979 KiB |   1184 MiB | 491490 GiB | 491490 GiB |
|       from small pool |  16481 KiB |     36 MiB |   6782 GiB |   6782 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1348 MiB |   1354 MiB |   3542 MiB |   2194 MiB |
|       from large pool |   1310 MiB |   1316 MiB |   3472 MiB |   2162 MiB |
|       from small pool |     38 MiB |     42 MiB |     70 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40016 KiB | 173957 KiB | 291254 GiB | 291254 GiB |
|       from large pool |  30877 KiB | 172419 KiB | 284414 GiB | 284414 GiB |
|       from small pool |   9139 KiB |  21453 KiB |   6840 GiB |   6840 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7763    |   85791 K  |   85788 K  |
|       from large pool |      79    |     172    |   45916 K  |   45915 K  |
|       from small pool |    2887    |    7683    |   39875 K  |   39872 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7763    |   85791 K  |   85788 K  |
|       from large pool |      79    |     172    |   45916 K  |   45915 K  |
|       from small pool |    2887    |    7683    |   39875 K  |   39872 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     178    |     104    |
|       from large pool |      55    |      55    |     143    |      88    |
|       from small pool |      19    |      21    |      35    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      33    |    3661    |   54082 K  |   54082 K  |
|       from large pool |       9    |      57    |   34875 K  |   34875 K  |
|       from small pool |      24    |    3652    |   19207 K  |   19207 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1203 MiB | 499992 GiB | 499992 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 493196 GiB | 493196 GiB |
|       from small pool |      0 KiB |     37 MiB |   6795 GiB |   6795 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1203 MiB | 499992 GiB | 499992 GiB |
|       from large pool |  16640 KiB |   1186 MiB | 493196 GiB | 493196 GiB |
|       from small pool |      0 KiB |     37 MiB |   6795 GiB |   6795 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1201 MiB | 498273 GiB | 498273 GiB |
|       from large pool |  16640 KiB |   1184 MiB | 491490 GiB | 491490 GiB |
|       from small pool |      0 KiB |     36 MiB |   6782 GiB |   6782 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 237568 KiB |   1354 MiB |   3542 MiB |   3310 MiB |
|       from large pool | 210944 KiB |   1316 MiB |   3472 MiB |   3266 MiB |
|       from small pool |  26624 KiB |     42 MiB |     70 MiB |     44 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 173957 KiB | 291254 GiB | 291254 GiB |
|       from large pool |  30464 KiB | 172419 KiB | 284414 GiB | 284414 GiB |
|       from small pool |      0 KiB |  23495 KiB |   6840 GiB |   6840 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7763    |   85791 K  |   85791 K  |
|       from large pool |       2    |     172    |   45916 K  |   45916 K  |
|       from small pool |       0    |    7683    |   39875 K  |   39875 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7763    |   85791 K  |   85791 K  |
|       from large pool |       2    |     172    |   45916 K  |   45916 K  |
|       from small pool |       0    |    7683    |   39875 K  |   39875 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      76    |     178    |     155    |
|       from large pool |      10    |      55    |     143    |     133    |
|       from small pool |      13    |      21    |      35    |      22    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |    3661    |   54084 K  |   54084 K  |
|       from large pool |       2    |      57    |   34875 K  |   34875 K  |
|       from small pool |       0    |    3652    |   19208 K  |   19208 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Wed Jul 31 10:45:44 2024]
Finished job 0.
1 of 1 steps (100%) done
