Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Aug  1 04:54:47 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/14.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=14
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: libtorch_cuda_cu.so: cannot open shared object file: No such file or directory
  warn(f"Failed to load image Python extension: {e}")
Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



warning: Not a git repository. Use --no-index to compare two paths outside a working tree
usage: git diff --no-index [<options>] <path> <path>

Diff output format options
    -p, --patch           generate patch
    -s, --no-patch        suppress diff output
    -u                    generate patch
    -U, --unified[=<n>]   generate diffs with <n> lines context
    -W, --function-context
                          generate diffs with <n> lines context
    --raw                 generate the diff in raw format
    --patch-with-raw      synonym for '-p --raw'
    --patch-with-stat     synonym for '-p --stat'
    --numstat             machine friendly --stat
    --shortstat           output only the last line of --stat
    -X, --dirstat[=<param1,param2>...]
                          output the distribution of relative amount of changes for each sub-directory
    --cumulative          synonym for --dirstat=cumulative
    --dirstat-by-file[=<param1,param2>...]
                          synonym for --dirstat=files,param1,param2...
    --check               warn if changes introduce conflict markers or whitespace errors
    --summary             condensed summary such as creations, renames and mode changes
    --name-only           show only names of changed files
    --name-status         show only names and status of changed files
    --stat[=<width>[,<name-width>[,<count>]]]
                          generate diffstat
    --stat-width <width>  generate diffstat with a given width
    --stat-name-width <width>
                          generate diffstat with a given name width
    --stat-graph-width <width>
                          generate diffstat with a given graph width
    --stat-count <count>  generate diffstat with limited lines
    --compact-summary     generate compact summary in diffstat
    --binary              output a binary diff that can be applied
    --full-index          show full pre- and post-image object names on the "index" lines
    --color[=<when>]      show colored diff
    --ws-error-highlight <kind>
                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff
    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat
    --abbrev[=<n>]        use <n> digits to display object names
    --src-prefix <prefix>
                          show the given source prefix instead of "a/"
    --dst-prefix <prefix>
                          show the given destination prefix instead of "b/"
    --line-prefix <prefix>
                          prepend an additional prefix to every line of output
    --no-prefix           do not show any source or destination prefix
    --inter-hunk-context <n>
                          show context between diff hunks up to the specified number of lines
    --output-indicator-new <char>
                          specify the character to indicate a new line instead of '+'
    --output-indicator-old <char>
                          specify the character to indicate an old line instead of '-'
    --output-indicator-context <char>
                          specify the character to indicate a context instead of ' '

Diff rename options
    -B, --break-rewrites[=<n>[/<m>]]
                          break complete rewrite changes into pairs of delete and create
    -M, --find-renames[=<n>]
                          detect renames
    -D, --irreversible-delete
                          omit the preimage for deletes
    -C, --find-copies[=<n>]
                          detect copies
    --find-copies-harder  use unmodified files as source to find copies
    --no-renames          disable rename detection
    --rename-empty        use empty blobs as rename source
    --follow              continue listing the history of a file beyond renames
    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit

Diff algorithm options
    --minimal             produce the smallest possible diff
    -w, --ignore-all-space
                          ignore whitespace when comparing lines
    -b, --ignore-space-change
                          ignore changes in amount of whitespace
    --ignore-space-at-eol
                          ignore changes in whitespace at EOL
    --ignore-cr-at-eol    ignore carrier-return at the end of line
    --ignore-blank-lines  ignore changes whose lines are all blank
    -I, --ignore-matching-lines <regex>
                          ignore changes whose all lines match <regex>
    --indent-heuristic    heuristic to shift diff hunk boundaries for easy reading
    --patience            generate diff using the "patience diff" algorithm
    --histogram           generate diff using the "histogram diff" algorithm
    --diff-algorithm <algorithm>
                          choose a diff algorithm
    --anchored <text>     generate diff using the "anchored diff" algorithm
    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words
    --word-diff-regex <regex>
                          use <regex> to decide what a word is
    --color-words[=<regex>]
                          equivalent to --word-diff=color --word-diff-regex=<regex>
    --color-moved[=<mode>]
                          moved lines of code are colored differently
    --color-moved-ws <mode>
                          how white spaces are ignored in --color-moved

Other diff options
    --relative[=<prefix>]
                          when run from subdir, exclude changes outside and show relative paths
    -a, --text            treat all files as text
    -R                    swap two inputs, reverse the diff
    --exit-code           exit with 1 if there were differences, 0 otherwise
    --quiet               disable all output of the program
    --ext-diff            allow an external diff helper to be executed
    --textconv            run external text conversion filters when comparing binary files
    --ignore-submodules[=<when>]
                          ignore changes to submodules in the diff generation
    --submodule[=<format>]
                          specify how differences in submodules are shown
    --ita-invisible-in-index
                          hide 'git add -N' entries from the index
    --ita-visible-in-index
                          treat 'git add -N' entries as real in the index
    -S <string>           look for differences that change the number of occurrences of the specified string
    -G <regex>            look for differences that change the number of occurrences of the specified regex
    --pickaxe-all         show all changes in the changeset with -S or -G
    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression
    -O <file>             control the order in which files appear in the output
    --rotate-to <path>    show the change in the specified path first
    --skip-to <path>      skip the output to the specified path
    --find-object <object-id>
                          look for differences that change the number of occurrences of the specified object
    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]
                          select files by diff type
    --output <file>       output to a specific file

not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:26: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:38: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
model name: dset_te_center0_erm_no_git_version_2024md_08md_01_05_07_08_seed_0_23775402

 Experiment start at: 2024-08-01 05:07:08.224216
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.90195256, 'precision': 0.902308, 'recall': 0.9019656, 'specificity': 0.9019656, 'f1': 0.90193295, 'auroc': 0.9616926, 'binary_precision': 0.9144848, 'binary_recall': 0.88702315, 'binary_specificity': 0.916908, 'binary_f1_score': 0.9005447}
confusion matrix:
       0      1
0  26274   2381
1   3243  25462
---- Validation: 
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.89133674, 'precision': 0.5856967, 'recall': 0.7704807, 'specificity': 0.7704807, 'f1': 0.61434597, 'auroc': 0.8518541, 'binary_precision': 0.18533513, 'binary_recall': 0.6407465, 'binary_specificity': 0.9002149, 'binary_f1_score': 0.2875087}
confusion matrix:
       0     1
0  16338  1811
1    231   412
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87104505, 'precision': 0.60271627, 'recall': 0.83377033, 'specificity': 0.83377033, 'f1': 0.6338094, 'auroc': 0.90673816, 'binary_precision': 0.215625, 'binary_recall': 0.79310346, 'binary_specificity': 0.8744372, 'binary_f1_score': 0.33906633}
confusion matrix:
      0    1
0  5244  753
1    54  207
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 05:37:24.506949,epoch time: 0:30:16.282733,used: 0:30:16.282733,model: dset_te_center0_erm_no_git_version_2024md_08md_01_05_07_08_seed_0_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9262552, 'precision': 0.92679423, 'recall': 0.92626834, 'specificity': 0.92626834, 'f1': 0.9262334, 'auroc': 0.9762684, 'binary_precision': 0.94214576, 'binary_recall': 0.9084004, 'binary_specificity': 0.9441362, 'binary_f1_score': 0.92496544}
confusion matrix:
       0      1
0  27058   1601
1   2629  26072
---- Validation: 
scalar performance:
{'acc': 0.8753193, 'precision': 0.5785364, 'recall': 0.7809396, 'specificity': 0.7809396, 'f1': 0.60175294, 'auroc': 0.8545015, 'binary_precision': 0.16977467, 'binary_recall': 0.67962676, 'binary_specificity': 0.88225245, 'binary_f1_score': 0.2716817}
confusion matrix:
       0     1
0  16012  2137
1    206   437
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.85938, 'precision': 0.5988122, 'recall': 0.8460073, 'specificity': 0.8460073, 'f1': 0.6258659, 'auroc': 0.9180881, 'binary_precision': 0.20607787, 'binary_recall': 0.8314176, 'binary_specificity': 0.86059695, 'binary_f1_score': 0.33028919}
confusion matrix:
      0    1
0  5161  836
1    44  217
early stop counter: 1
val acc:0.8753193020820618, best validation acc: 0.8913367390632629, corresponding to test acc:                         0.8710450530052185 / 0.8710450530052185
after epoch: 2,now: 2024-08-01 06:06:31.920688,epoch time: 0:29:07.413739,used: 0:59:23.696472,model: dset_te_center0_erm_no_git_version_2024md_08md_01_05_07_08_seed_0_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.93493724, 'precision': 0.93505836, 'recall': 0.93494374, 'specificity': 0.93494374, 'f1': 0.9349333, 'auroc': 0.98042846, 'binary_precision': 0.9425108, 'binary_recall': 0.92648596, 'binary_specificity': 0.9434015, 'binary_f1_score': 0.93442965}
confusion matrix:
       0      1
0  27036   1622
1   2110  26592
---- Validation: 
scalar performance:
{'acc': 0.840943, 'precision': 0.56635696, 'recall': 0.79014444, 'specificity': 0.79014444, 'f1': 0.5757889, 'auroc': 0.8568641, 'binary_precision': 0.14368165, 'binary_recall': 0.7356143, 'binary_specificity': 0.84467465, 'binary_f1_score': 0.24040659}
confusion matrix:
       0     1
0  15330  2819
1    170   473
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82534355, 'precision': 0.5837836, 'recall': 0.84107476, 'specificity': 0.84107476, 'f1': 0.5955652, 'auroc': 0.9216032, 'binary_precision': 0.175, 'binary_recall': 0.85823756, 'binary_specificity': 0.82391196, 'binary_f1_score': 0.2907203}
confusion matrix:
      0     1
0  4941  1056
1    37   224
early stop counter: 2
val acc:0.8409429788589478, best validation acc: 0.8913367390632629, corresponding to test acc:                         0.8710450530052185 / 0.8710450530052185
after epoch: 3,now: 2024-08-01 06:35:46.651514,epoch time: 0:29:14.730826,used: 1:28:38.427298,model: dset_te_center0_erm_no_git_version_2024md_08md_01_05_07_08_seed_0_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9393131, 'precision': 0.93956333, 'recall': 0.9393215, 'specificity': 0.9393215, 'f1': 0.9393052, 'auroc': 0.98299587, 'binary_precision': 0.9502267, 'binary_recall': 0.9272822, 'binary_specificity': 0.95136076, 'binary_f1_score': 0.93861425}
confusion matrix:
       0      1
0  27266   1394
1   2087  26613
---- Validation: 
scalar performance:
{'acc': 0.85254365, 'precision': 0.5705183, 'recall': 0.7908999, 'specificity': 0.7908999, 'f1': 0.5849508, 'auroc': 0.8582897, 'binary_precision': 0.15228759, 'binary_recall': 0.7247278, 'binary_specificity': 0.857072, 'binary_f1_score': 0.25168782}
confusion matrix:
       0     1
0  15555  2594
1    177   466
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8429211, 'precision': 0.5910051, 'recall': 0.844749, 'specificity': 0.844749, 'f1': 0.61077255, 'auroc': 0.92221975, 'binary_precision': 0.18986255, 'binary_recall': 0.8467433, 'binary_specificity': 0.8427547, 'binary_f1_score': 0.31017545}
confusion matrix:
      0    1
0  5054  943
1    40  221
early stop counter: 3
val acc:0.8525436520576477, best validation acc: 0.8913367390632629, corresponding to test acc:                         0.8710450530052185 / 0.8710450530052185
after epoch: 4,now: 2024-08-01 07:05:36.150914,epoch time: 0:29:49.499400,used: 1:58:27.926698,model: dset_te_center0_erm_no_git_version_2024md_08md_01_05_07_08_seed_0_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:58:27.926698 at 2024-08-01 07:05:36.150914
persisted model performance metric: 

scalar performance:
{'acc': 0.87104505, 'precision': 0.60271627, 'recall': 0.83377033, 'specificity': 0.83377033, 'f1': 0.6338094, 'auroc': 0.90673816, 'binary_precision': 0.215625, 'binary_recall': 0.79310346, 'binary_specificity': 0.8744372, 'binary_f1_score': 0.33906633}
confusion matrix:
      0    1
0  5244  753
1    54  207
oracle model performance metric: 

scalar performance:
{'acc': 0.87104505, 'precision': 0.60271627, 'recall': 0.83377033, 'specificity': 0.83377033, 'f1': 0.6338094, 'auroc': 0.90673816, 'binary_precision': 0.215625, 'binary_recall': 0.79310346, 'binary_specificity': 0.8744372, 'binary_f1_score': 0.33906633}
confusion matrix:
      0    1
0  5244  753
1    54  207
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/14.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/14.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/confusion_matrix/14.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 191877 KiB | 461507 KiB |  87172 GiB |  87172 GiB |
|       from large pool | 174400 KiB | 427880 KiB |  85381 GiB |  85381 GiB |
|       from small pool |  17477 KiB |  38507 KiB |   1790 GiB |   1790 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 191877 KiB | 461507 KiB |  87172 GiB |  87172 GiB |
|       from large pool | 174400 KiB | 427880 KiB |  85381 GiB |  85381 GiB |
|       from small pool |  17477 KiB |  38507 KiB |   1790 GiB |   1790 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 189283 KiB | 457564 KiB |  87167 GiB |  87166 GiB |
|       from large pool | 172814 KiB | 424940 KiB |  85380 GiB |  85379 GiB |
|       from small pool |  16469 KiB |  37503 KiB |   1786 GiB |   1786 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 509952 KiB | 509952 KiB | 509952 KiB |      0 B   |
|       from large pool | 466944 KiB | 466944 KiB | 466944 KiB |      0 B   |
|       from small pool |  43008 KiB |  43008 KiB |  43008 KiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  43642 KiB |  87844 KiB |  53031 GiB |  53031 GiB |
|       from large pool |  30400 KiB |  79704 KiB |  51231 GiB |  51231 GiB |
|       from small pool |  13242 KiB |  14091 KiB |   1800 GiB |   1800 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2966    |    7633    |   18863 K  |   18860 K  |
|       from large pool |      76    |     158    |    8416 K  |    8416 K  |
|       from small pool |    2890    |    7556    |   10447 K  |   10444 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2966    |    7633    |   18863 K  |   18860 K  |
|       from large pool |      76    |     158    |    8416 K  |    8416 K  |
|       from small pool |    2890    |    7556    |   10447 K  |   10444 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      42    |      42    |      42    |       0    |
|       from large pool |      21    |      21    |      21    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      35    |    3602    |   11733 K  |   11733 K  |
|       from large pool |       9    |      18    |    6780 K  |    6780 K  |
|       from small pool |      26    |    3593    |    4952 K  |    4952 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  17088 KiB | 461507 KiB |  87172 GiB |  87172 GiB |
|       from large pool |  17088 KiB | 427880 KiB |  85381 GiB |  85381 GiB |
|       from small pool |      0 KiB |  38507 KiB |   1790 GiB |   1790 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  17088 KiB | 461507 KiB |  87172 GiB |  87172 GiB |
|       from large pool |  17088 KiB | 427880 KiB |  85381 GiB |  85381 GiB |
|       from small pool |      0 KiB |  38507 KiB |   1790 GiB |   1790 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 457564 KiB |  87167 GiB |  87166 GiB |
|       from large pool |  16640 KiB | 424940 KiB |  85380 GiB |  85380 GiB |
|       from small pool |      0 KiB |  37503 KiB |   1786 GiB |   1786 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB | 509952 KiB | 509952 KiB | 274432 KiB |
|       from large pool | 204800 KiB | 466944 KiB | 466944 KiB | 262144 KiB |
|       from small pool |  30720 KiB |  43008 KiB |  43008 KiB |  12288 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  23872 KiB |  87844 KiB |  53031 GiB |  53031 GiB |
|       from large pool |  23872 KiB |  79704 KiB |  51231 GiB |  51231 GiB |
|       from small pool |      0 KiB |  20341 KiB |   1800 GiB |   1800 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7633    |   18863 K  |   18863 K  |
|       from large pool |       2    |     158    |    8416 K  |    8416 K  |
|       from small pool |       0    |    7556    |   10447 K  |   10447 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7633    |   18863 K  |   18863 K  |
|       from large pool |       2    |     158    |    8416 K  |    8416 K  |
|       from small pool |       0    |    7556    |   10447 K  |   10447 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      25    |      42    |      42    |      17    |
|       from large pool |      10    |      21    |      21    |      11    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3602    |   11734 K  |   11734 K  |
|       from large pool |       3    |      18    |    6780 K  |    6780 K  |
|       from small pool |       0    |    3593    |    4954 K  |    4954 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  17088 KiB | 461507 KiB |  87172 GiB |  87172 GiB |
|       from large pool |  17088 KiB | 427880 KiB |  85381 GiB |  85381 GiB |
|       from small pool |      0 KiB |  38507 KiB |   1790 GiB |   1790 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  17088 KiB | 461507 KiB |  87172 GiB |  87172 GiB |
|       from large pool |  17088 KiB | 427880 KiB |  85381 GiB |  85381 GiB |
|       from small pool |      0 KiB |  38507 KiB |   1790 GiB |   1790 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 457564 KiB |  87167 GiB |  87166 GiB |
|       from large pool |  16640 KiB | 424940 KiB |  85380 GiB |  85380 GiB |
|       from small pool |      0 KiB |  37503 KiB |   1786 GiB |   1786 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 235520 KiB | 509952 KiB | 509952 KiB | 274432 KiB |
|       from large pool | 204800 KiB | 466944 KiB | 466944 KiB | 262144 KiB |
|       from small pool |  30720 KiB |  43008 KiB |  43008 KiB |  12288 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  23872 KiB |  87844 KiB |  53031 GiB |  53031 GiB |
|       from large pool |  23872 KiB |  79704 KiB |  51231 GiB |  51231 GiB |
|       from small pool |      0 KiB |  20341 KiB |   1800 GiB |   1800 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7633    |   18863 K  |   18863 K  |
|       from large pool |       2    |     158    |    8416 K  |    8416 K  |
|       from small pool |       0    |    7556    |   10447 K  |   10447 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7633    |   18863 K  |   18863 K  |
|       from large pool |       2    |     158    |    8416 K  |    8416 K  |
|       from small pool |       0    |    7556    |   10447 K  |   10447 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      25    |      42    |      42    |      17    |
|       from large pool |      10    |      21    |      21    |      11    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3602    |   11734 K  |   11734 K  |
|       from large pool |       3    |      18    |    6780 K  |    6780 K  |
|       from small pool |       0    |    3593    |    4954 K  |    4954 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



warning: Not a git repository. Use --no-index to compare two paths outside a working tree
usage: git diff --no-index [<options>] <path> <path>

Diff output format options
    -p, --patch           generate patch
    -s, --no-patch        suppress diff output
    -u                    generate patch
    -U, --unified[=<n>]   generate diffs with <n> lines context
    -W, --function-context
                          generate diffs with <n> lines context
    --raw                 generate the diff in raw format
    --patch-with-raw      synonym for '-p --raw'
    --patch-with-stat     synonym for '-p --stat'
    --numstat             machine friendly --stat
    --shortstat           output only the last line of --stat
    -X, --dirstat[=<param1,param2>...]
                          output the distribution of relative amount of changes for each sub-directory
    --cumulative          synonym for --dirstat=cumulative
    --dirstat-by-file[=<param1,param2>...]
                          synonym for --dirstat=files,param1,param2...
    --check               warn if changes introduce conflict markers or whitespace errors
    --summary             condensed summary such as creations, renames and mode changes
    --name-only           show only names of changed files
    --name-status         show only names and status of changed files
    --stat[=<width>[,<name-width>[,<count>]]]
                          generate diffstat
    --stat-width <width>  generate diffstat with a given width
    --stat-name-width <width>
                          generate diffstat with a given name width
    --stat-graph-width <width>
                          generate diffstat with a given graph width
    --stat-count <count>  generate diffstat with limited lines
    --compact-summary     generate compact summary in diffstat
    --binary              output a binary diff that can be applied
    --full-index          show full pre- and post-image object names on the "index" lines
    --color[=<when>]      show colored diff
    --ws-error-highlight <kind>
                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff
    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat
    --abbrev[=<n>]        use <n> digits to display object names
    --src-prefix <prefix>
                          show the given source prefix instead of "a/"
    --dst-prefix <prefix>
                          show the given destination prefix instead of "b/"
    --line-prefix <prefix>
                          prepend an additional prefix to every line of output
    --no-prefix           do not show any source or destination prefix
    --inter-hunk-context <n>
                          show context between diff hunks up to the specified number of lines
    --output-indicator-new <char>
                          specify the character to indicate a new line instead of '+'
    --output-indicator-old <char>
                          specify the character to indicate an old line instead of '-'
    --output-indicator-context <char>
                          specify the character to indicate a context instead of ' '

Diff rename options
    -B, --break-rewrites[=<n>[/<m>]]
                          break complete rewrite changes into pairs of delete and create
    -M, --find-renames[=<n>]
                          detect renames
    -D, --irreversible-delete
                          omit the preimage for deletes
    -C, --find-copies[=<n>]
                          detect copies
    --find-copies-harder  use unmodified files as source to find copies
    --no-renames          disable rename detection
    --rename-empty        use empty blobs as rename source
    --follow              continue listing the history of a file beyond renames
    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit

Diff algorithm options
    --minimal             produce the smallest possible diff
    -w, --ignore-all-space
                          ignore whitespace when comparing lines
    -b, --ignore-space-change
                          ignore changes in amount of whitespace
    --ignore-space-at-eol
                          ignore changes in whitespace at EOL
    --ignore-cr-at-eol    ignore carrier-return at the end of line
    --ignore-blank-lines  ignore changes whose lines are all blank
    -I, --ignore-matching-lines <regex>
                          ignore changes whose all lines match <regex>
    --indent-heuristic    heuristic to shift diff hunk boundaries for easy reading
    --patience            generate diff using the "patience diff" algorithm
    --histogram           generate diff using the "histogram diff" algorithm
    --diff-algorithm <algorithm>
                          choose a diff algorithm
    --anchored <text>     generate diff using the "anchored diff" algorithm
    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words
    --word-diff-regex <regex>
                          use <regex> to decide what a word is
    --color-words[=<regex>]
                          equivalent to --word-diff=color --word-diff-regex=<regex>
    --color-moved[=<mode>]
                          moved lines of code are colored differently
    --color-moved-ws <mode>
                          how white spaces are ignored in --color-moved

Other diff options
    --relative[=<prefix>]
                          when run from subdir, exclude changes outside and show relative paths
    -a, --text            treat all files as text
    -R                    swap two inputs, reverse the diff
    --exit-code           exit with 1 if there were differences, 0 otherwise
    --quiet               disable all output of the program
    --ext-diff            allow an external diff helper to be executed
    --textconv            run external text conversion filters when comparing binary files
    --ignore-submodules[=<when>]
                          ignore changes to submodules in the diff generation
    --submodule[=<format>]
                          specify how differences in submodules are shown
    --ita-invisible-in-index
                          hide 'git add -N' entries from the index
    --ita-visible-in-index
                          treat 'git add -N' entries as real in the index
    -S <string>           look for differences that change the number of occurrences of the specified string
    -G <regex>            look for differences that change the number of occurrences of the specified regex
    --pickaxe-all         show all changes in the changeset with -S or -G
    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression
    -O <file>             control the order in which files appear in the output
    --rotate-to <path>    show the change in the specified path first
    --skip-to <path>      skip the output to the specified path
    --find-object <object-id>
                          look for differences that change the number of occurrences of the specified object
    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]
                          select files by diff type
    --output <file>       output to a specific file

not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:26: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:38: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
model name: dset_te_center0_erm_no_git_version_2024md_08md_01_07_18_04_seed_1_23775402

 Experiment start at: 2024-08-01 07:18:05.165465
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6474379897117615
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.90277004, 'precision': 0.90498465, 'recall': 0.9027958, 'specificity': 0.9027958, 'f1': 0.90264094, 'auroc': 0.9643519, 'binary_precision': 0.93510675, 'binary_recall': 0.8657555, 'binary_specificity': 0.939836, 'binary_f1_score': 0.8990958}
confusion matrix:
       0      1
0  27056   1732
1   3870  24958
---- Validation: 
scalar performance:
{'acc': 0.9185699, 'precision': 0.61410344, 'recall': 0.76679194, 'specificity': 0.76679194, 'f1': 0.65194076, 'auroc': 0.85556805, 'binary_precision': 0.24384384, 'binary_recall': 0.6032689, 'binary_specificity': 0.93031496, 'binary_f1_score': 0.3473054}
confusion matrix:
       0     1
0  16808  1259
1    267   406
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91878825, 'precision': 0.6510243, 'recall': 0.8527963, 'specificity': 0.8527963, 'f1': 0.7011677, 'auroc': 0.9169034, 'binary_precision': 0.3123077, 'binary_recall': 0.7807692, 'binary_specificity': 0.9248234, 'binary_f1_score': 0.44615382}
confusion matrix:
      0    1
0  5499  447
1    57  203
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 07:47:09.025291,epoch time: 0:29:03.859826,used: 0:29:03.859826,model: dset_te_center0_erm_no_git_version_2024md_08md_01_07_18_04_seed_1_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9295682, 'precision': 0.9298604, 'recall': 0.9295777, 'specificity': 0.9295777, 'f1': 0.92955726, 'auroc': 0.97720927, 'binary_precision': 0.94125193, 'binary_recall': 0.9164383, 'binary_specificity': 0.9427172, 'binary_f1_score': 0.9286794}
confusion matrix:
       0      1
0  27138   1649
1   2409  26420
---- Validation: 
scalar performance:
{'acc': 0.86910355, 'precision': 0.5808127, 'recall': 0.79049087, 'specificity': 0.79049087, 'f1': 0.6035907, 'auroc': 0.85919654, 'binary_precision': 0.17399268, 'binary_recall': 0.70579493, 'binary_specificity': 0.8751868, 'binary_f1_score': 0.27916545}
confusion matrix:
       0     1
0  15812  2255
1    198   475
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8746374, 'precision': 0.6098785, 'recall': 0.8555014, 'specificity': 0.8555014, 'f1': 0.6443108, 'auroc': 0.92575943, 'binary_precision': 0.22794117, 'binary_recall': 0.8346154, 'binary_specificity': 0.8763875, 'binary_f1_score': 0.35808578}
confusion matrix:
      0    1
0  5211  735
1    43  217
early stop counter: 1
val acc:0.8691035509109497, best validation acc: 0.9185699224472046, corresponding to test acc:                         0.9187882542610168 / 0.9187882542610168
after epoch: 2,now: 2024-08-01 08:15:38.480519,epoch time: 0:28:29.455228,used: 0:57:33.315054,model: dset_te_center0_erm_no_git_version_2024md_08md_01_07_18_04_seed_1_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.93552136, 'precision': 0.9361429, 'recall': 0.9355359, 'specificity': 0.9355359, 'f1': 0.93549985, 'auroc': 0.98181105, 'binary_precision': 0.9527999, 'binary_recall': 0.9165453, 'binary_specificity': 0.9545265, 'binary_f1_score': 0.93432105}
confusion matrix:
       0      1
0  27477   1309
1   2406  26424
---- Validation: 
scalar performance:
{'acc': 0.86318034, 'precision': 0.5770746, 'recall': 0.78598845, 'specificity': 0.78598845, 'f1': 0.59701866, 'auroc': 0.8564609, 'binary_precision': 0.16672541, 'binary_recall': 0.70282316, 'binary_specificity': 0.8691537, 'binary_f1_score': 0.26951566}
confusion matrix:
       0     1
0  15703  2364
1    200   473
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87367064, 'precision': 0.6106678, 'recall': 0.86235285, 'specificity': 0.86235285, 'f1': 0.6452172, 'auroc': 0.92669994, 'binary_precision': 0.22877847, 'binary_recall': 0.85, 'binary_specificity': 0.8747057, 'binary_f1_score': 0.36052203}
confusion matrix:
      0    1
0  5201  745
1    39  221
early stop counter: 2
val acc:0.8631803393363953, best validation acc: 0.9185699224472046, corresponding to test acc:                         0.9187882542610168 / 0.9187882542610168
after epoch: 3,now: 2024-08-01 08:44:09.126915,epoch time: 0:28:30.646396,used: 1:26:03.961450,model: dset_te_center0_erm_no_git_version_2024md_08md_01_07_18_04_seed_1_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.94078034, 'precision': 0.9410343, 'recall': 0.94078875, 'specificity': 0.94078875, 'f1': 0.94077253, 'auroc': 0.98416686, 'binary_precision': 0.9517918, 'binary_recall': 0.9286804, 'binary_specificity': 0.952897, 'binary_f1_score': 0.9400941}
confusion matrix:
       0      1
0  27432   1356
1   2056  26772
---- Validation: 
scalar performance:
{'acc': 0.84866595, 'precision': 0.57052785, 'recall': 0.7827525, 'specificity': 0.7827525, 'f1': 0.58415735, 'auroc': 0.8539543, 'binary_precision': 0.15347645, 'binary_recall': 0.71173847, 'binary_specificity': 0.85376656, 'binary_f1_score': 0.25250393}
confusion matrix:
       0     1
0  15425  2642
1    194   479
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8631969, 'precision': 0.6037811, 'recall': 0.85872597, 'specificity': 0.85872597, 'f1': 0.63351583, 'auroc': 0.9259412, 'binary_precision': 0.21490803, 'binary_recall': 0.85384613, 'binary_specificity': 0.8636058, 'binary_f1_score': 0.34338745}
confusion matrix:
      0    1
0  5135  811
1    38  222
early stop counter: 3
val acc:0.8486659526824951, best validation acc: 0.9185699224472046, corresponding to test acc:                         0.9187882542610168 / 0.9187882542610168
after epoch: 4,now: 2024-08-01 09:12:13.760240,epoch time: 0:28:04.633325,used: 1:54:08.594775,model: dset_te_center0_erm_no_git_version_2024md_08md_01_07_18_04_seed_1_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:54:08.594775 at 2024-08-01 09:12:13.760240
persisted model performance metric: 

scalar performance:
{'acc': 0.91878825, 'precision': 0.6510243, 'recall': 0.8527963, 'specificity': 0.8527963, 'f1': 0.7011677, 'auroc': 0.9169034, 'binary_precision': 0.3123077, 'binary_recall': 0.7807692, 'binary_specificity': 0.9248234, 'binary_f1_score': 0.44615382}
confusion matrix:
      0    1
0  5499  447
1    57  203
oracle model performance metric: 

scalar performance:
{'acc': 0.91878825, 'precision': 0.6510243, 'recall': 0.8527963, 'specificity': 0.8527963, 'f1': 0.7011677, 'auroc': 0.9169034, 'binary_precision': 0.3123077, 'binary_recall': 0.7807692, 'binary_specificity': 0.9248234, 'binary_f1_score': 0.44615382}
confusion matrix:
      0    1
0  5499  447
1    57  203
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/14.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/confusion_matrix/14.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 190959 KiB | 461507 KiB | 174567 GiB | 174567 GiB |
|       from large pool | 173494 KiB | 427880 KiB | 170983 GiB | 170983 GiB |
|       from small pool |  17465 KiB |  38507 KiB |   3584 GiB |   3584 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 190959 KiB | 461507 KiB | 174567 GiB | 174567 GiB |
|       from large pool | 173494 KiB | 427880 KiB | 170983 GiB | 170983 GiB |
|       from small pool |  17465 KiB |  38507 KiB |   3584 GiB |   3584 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 189280 KiB | 457564 KiB | 174556 GiB | 174556 GiB |
|       from large pool | 172814 KiB | 424940 KiB | 170979 GiB | 170978 GiB |
|       from small pool |  16466 KiB |  37503 KiB |   3577 GiB |   3577 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 526336 KiB | 526336 KiB |    782 MiB | 274432 KiB |
|       from large pool | 487424 KiB | 487424 KiB |    732 MiB | 262144 KiB |
|       from small pool |  38912 KiB |  43008 KiB |     50 MiB |  12288 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40464 KiB |  87844 KiB | 108235 GiB | 108235 GiB |
|       from large pool |  31306 KiB |  79704 KiB | 104596 GiB | 104596 GiB |
|       from small pool |   9158 KiB |  20341 KiB |   3638 GiB |   3638 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2942    |    7665    |   37767 K  |   37764 K  |
|       from large pool |      76    |     158    |   16853 K  |   16853 K  |
|       from small pool |    2866    |    7588    |   20913 K  |   20910 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2942    |    7665    |   37767 K  |   37764 K  |
|       from large pool |      76    |     158    |   16853 K  |   16853 K  |
|       from small pool |    2866    |    7588    |   20913 K  |   20910 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      42    |      58    |      17    |
|       from large pool |      22    |      22    |      33    |      11    |
|       from small pool |      19    |      21    |      25    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      31    |    3618    |   22808 K  |   22808 K  |
|       from large pool |      10    |      23    |   12278 K  |   12278 K  |
|       from small pool |      21    |    3608    |   10529 K  |   10529 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  17088 KiB | 461507 KiB | 174567 GiB | 174567 GiB |
|       from large pool |  17088 KiB | 427880 KiB | 170983 GiB | 170983 GiB |
|       from small pool |      0 KiB |  38507 KiB |   3584 GiB |   3584 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  17088 KiB | 461507 KiB | 174567 GiB | 174567 GiB |
|       from large pool |  17088 KiB | 427880 KiB | 170983 GiB | 170983 GiB |
|       from small pool |      0 KiB |  38507 KiB |   3584 GiB |   3584 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 457564 KiB | 174556 GiB | 174556 GiB |
|       from large pool |  16640 KiB | 424940 KiB | 170979 GiB | 170979 GiB |
|       from small pool |      0 KiB |  37503 KiB |   3577 GiB |   3577 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 231424 KiB | 526336 KiB |    782 MiB | 569344 KiB |
|       from large pool | 204800 KiB | 487424 KiB |    732 MiB | 544768 KiB |
|       from small pool |  26624 KiB |  43008 KiB |     50 MiB |  24576 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  23872 KiB | 112281 KiB | 108236 GiB | 108236 GiB |
|       from large pool |  23872 KiB |  92928 KiB | 104597 GiB | 104597 GiB |
|       from small pool |      0 KiB |  23510 KiB |   3639 GiB |   3639 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   37767 K  |   37767 K  |
|       from large pool |       2    |     158    |   16853 K  |   16853 K  |
|       from small pool |       0    |    7588    |   20913 K  |   20913 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   37767 K  |   37767 K  |
|       from large pool |       2    |     158    |   16853 K  |   16853 K  |
|       from small pool |       0    |    7588    |   20913 K  |   20913 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      42    |      58    |      35    |
|       from large pool |      10    |      22    |      33    |      23    |
|       from small pool |      13    |      21    |      25    |      12    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3618    |   22809 K  |   22809 K  |
|       from large pool |       3    |      23    |   12278 K  |   12278 K  |
|       from small pool |       0    |    3608    |   10530 K  |   10530 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  17088 KiB | 461507 KiB | 174567 GiB | 174567 GiB |
|       from large pool |  17088 KiB | 427880 KiB | 170983 GiB | 170983 GiB |
|       from small pool |      0 KiB |  38507 KiB |   3584 GiB |   3584 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  17088 KiB | 461507 KiB | 174567 GiB | 174567 GiB |
|       from large pool |  17088 KiB | 427880 KiB | 170983 GiB | 170983 GiB |
|       from small pool |      0 KiB |  38507 KiB |   3584 GiB |   3584 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 457564 KiB | 174556 GiB | 174556 GiB |
|       from large pool |  16640 KiB | 424940 KiB | 170979 GiB | 170979 GiB |
|       from small pool |      0 KiB |  37503 KiB |   3577 GiB |   3577 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 231424 KiB | 526336 KiB |    782 MiB | 569344 KiB |
|       from large pool | 204800 KiB | 487424 KiB |    732 MiB | 544768 KiB |
|       from small pool |  26624 KiB |  43008 KiB |     50 MiB |  24576 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  23872 KiB | 112281 KiB | 108236 GiB | 108236 GiB |
|       from large pool |  23872 KiB |  92928 KiB | 104597 GiB | 104597 GiB |
|       from small pool |      0 KiB |  23510 KiB |   3639 GiB |   3639 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7665    |   37767 K  |   37767 K  |
|       from large pool |       2    |     158    |   16853 K  |   16853 K  |
|       from small pool |       0    |    7588    |   20913 K  |   20913 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7665    |   37767 K  |   37767 K  |
|       from large pool |       2    |     158    |   16853 K  |   16853 K  |
|       from small pool |       0    |    7588    |   20913 K  |   20913 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      42    |      58    |      35    |
|       from large pool |      10    |      22    |      33    |      23    |
|       from small pool |      13    |      21    |      25    |      12    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3618    |   22809 K  |   22809 K  |
|       from large pool |       3    |      23    |   12278 K  |   12278 K  |
|       from small pool |       0    |    3608    |   10530 K  |   10530 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/gizem.mert/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



warning: Not a git repository. Use --no-index to compare two paths outside a working tree
usage: git diff --no-index [<options>] <path> <path>

Diff output format options
    -p, --patch           generate patch
    -s, --no-patch        suppress diff output
    -u                    generate patch
    -U, --unified[=<n>]   generate diffs with <n> lines context
    -W, --function-context
                          generate diffs with <n> lines context
    --raw                 generate the diff in raw format
    --patch-with-raw      synonym for '-p --raw'
    --patch-with-stat     synonym for '-p --stat'
    --numstat             machine friendly --stat
    --shortstat           output only the last line of --stat
    -X, --dirstat[=<param1,param2>...]
                          output the distribution of relative amount of changes for each sub-directory
    --cumulative          synonym for --dirstat=cumulative
    --dirstat-by-file[=<param1,param2>...]
                          synonym for --dirstat=files,param1,param2...
    --check               warn if changes introduce conflict markers or whitespace errors
    --summary             condensed summary such as creations, renames and mode changes
    --name-only           show only names of changed files
    --name-status         show only names and status of changed files
    --stat[=<width>[,<name-width>[,<count>]]]
                          generate diffstat
    --stat-width <width>  generate diffstat with a given width
    --stat-name-width <width>
                          generate diffstat with a given name width
    --stat-graph-width <width>
                          generate diffstat with a given graph width
    --stat-count <count>  generate diffstat with limited lines
    --compact-summary     generate compact summary in diffstat
    --binary              output a binary diff that can be applied
    --full-index          show full pre- and post-image object names on the "index" lines
    --color[=<when>]      show colored diff
    --ws-error-highlight <kind>
                          highlight whitespace errors in the 'context', 'old' or 'new' lines in the diff
    -z                    do not munge pathnames and use NULs as output field terminators in --raw or --numstat
    --abbrev[=<n>]        use <n> digits to display object names
    --src-prefix <prefix>
                          show the given source prefix instead of "a/"
    --dst-prefix <prefix>
                          show the given destination prefix instead of "b/"
    --line-prefix <prefix>
                          prepend an additional prefix to every line of output
    --no-prefix           do not show any source or destination prefix
    --inter-hunk-context <n>
                          show context between diff hunks up to the specified number of lines
    --output-indicator-new <char>
                          specify the character to indicate a new line instead of '+'
    --output-indicator-old <char>
                          specify the character to indicate an old line instead of '-'
    --output-indicator-context <char>
                          specify the character to indicate a context instead of ' '

Diff rename options
    -B, --break-rewrites[=<n>[/<m>]]
                          break complete rewrite changes into pairs of delete and create
    -M, --find-renames[=<n>]
                          detect renames
    -D, --irreversible-delete
                          omit the preimage for deletes
    -C, --find-copies[=<n>]
                          detect copies
    --find-copies-harder  use unmodified files as source to find copies
    --no-renames          disable rename detection
    --rename-empty        use empty blobs as rename source
    --follow              continue listing the history of a file beyond renames
    -l <n>                prevent rename/copy detection if the number of rename/copy targets exceeds given limit

Diff algorithm options
    --minimal             produce the smallest possible diff
    -w, --ignore-all-space
                          ignore whitespace when comparing lines
    -b, --ignore-space-change
                          ignore changes in amount of whitespace
    --ignore-space-at-eol
                          ignore changes in whitespace at EOL
    --ignore-cr-at-eol    ignore carrier-return at the end of line
    --ignore-blank-lines  ignore changes whose lines are all blank
    -I, --ignore-matching-lines <regex>
                          ignore changes whose all lines match <regex>
    --indent-heuristic    heuristic to shift diff hunk boundaries for easy reading
    --patience            generate diff using the "patience diff" algorithm
    --histogram           generate diff using the "histogram diff" algorithm
    --diff-algorithm <algorithm>
                          choose a diff algorithm
    --anchored <text>     generate diff using the "anchored diff" algorithm
    --word-diff[=<mode>]  show word diff, using <mode> to delimit changed words
    --word-diff-regex <regex>
                          use <regex> to decide what a word is
    --color-words[=<regex>]
                          equivalent to --word-diff=color --word-diff-regex=<regex>
    --color-moved[=<mode>]
                          moved lines of code are colored differently
    --color-moved-ws <mode>
                          how white spaces are ignored in --color-moved

Other diff options
    --relative[=<prefix>]
                          when run from subdir, exclude changes outside and show relative paths
    -a, --text            treat all files as text
    -R                    swap two inputs, reverse the diff
    --exit-code           exit with 1 if there were differences, 0 otherwise
    --quiet               disable all output of the program
    --ext-diff            allow an external diff helper to be executed
    --textconv            run external text conversion filters when comparing binary files
    --ignore-submodules[=<when>]
                          ignore changes to submodules in the diff generation
    --submodule[=<format>]
                          specify how differences in submodules are shown
    --ita-invisible-in-index
                          hide 'git add -N' entries from the index
    --ita-visible-in-index
                          treat 'git add -N' entries as real in the index
    -S <string>           look for differences that change the number of occurrences of the specified string
    -G <regex>            look for differences that change the number of occurrences of the specified regex
    --pickaxe-all         show all changes in the changeset with -S or -G
    --pickaxe-regex       treat <string> in -S as extended POSIX regular expression
    -O <file>             control the order in which files appear in the output
    --rotate-to <path>    show the change in the specified path first
    --skip-to <path>      skip the output to the specified path
    --find-object <object-id>
                          look for differences that change the number of occurrences of the specified object
    --diff-filter [(A|C|D|M|R|T|U|X|B)...[*]]
                          select files by diff type
    --output <file>       output to a specific file

not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:26: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
fatal: detected dubious ownership in repository at '/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab'
To add an exception for this directory, call:

	git config --global --add safe.directory /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
not in a git repository
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab/domainlab/utils/get_git_tag.py:38: UserWarning: not in a git repository
  warnings.warn("not in a git repository")
model name: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402

 Experiment start at: 2024-08-01 09:24:11.569472
/home/aih/gizem.mert/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.754768431186676
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9024252, 'precision': 0.90329874, 'recall': 0.90243, 'specificity': 0.90243, 'f1': 0.9023731, 'auroc': 0.9625902, 'binary_precision': 0.9221195, 'binary_recall': 0.8791412, 'binary_specificity': 0.9257188, 'binary_f1_score': 0.9001176}
confusion matrix:
       0      1
0  26981   2165
1   3524  25634
---- Validation: 
scalar performance:
{'acc': 0.8578277, 'precision': 0.56293964, 'recall': 0.76193386, 'specificity': 0.76193386, 'f1': 0.57548606, 'auroc': 0.8472121, 'binary_precision': 0.13876267, 'binary_recall': 0.6594684, 'binary_specificity': 0.8643993, 'binary_f1_score': 0.22928096}
confusion matrix:
       0     1
0  15707  2464
1    205   397
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.79756373, 'precision': 0.56171083, 'recall': 0.78762937, 'specificity': 0.78762937, 'f1': 0.55644226, 'auroc': 0.8635571, 'binary_precision': 0.13457409, 'binary_recall': 0.7768595, 'binary_specificity': 0.7983992, 'binary_f1_score': 0.22940819}
confusion matrix:
      0     1
0  4788  1209
1    54   188
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 09:52:22.123410,epoch time: 0:28:10.553938,used: 0:28:10.553938,model: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9241733, 'precision': 0.925347, 'recall': 0.92417693, 'specificity': 0.92417693, 'f1': 0.9241214, 'auroc': 0.9755585, 'binary_precision': 0.9477247, 'binary_recall': 0.8978941, 'binary_specificity': 0.9504597, 'binary_f1_score': 0.9221367}
confusion matrix:
       0      1
0  27704   1444
1   2977  26179
---- Validation: 
scalar performance:
{'acc': 0.871784, 'precision': 0.5713418, 'recall': 0.77556753, 'specificity': 0.77556753, 'f1': 0.59083587, 'auroc': 0.85468304, 'binary_precision': 0.15487571, 'binary_recall': 0.67275745, 'binary_specificity': 0.8783776, 'binary_f1_score': 0.25178736}
confusion matrix:
       0     1
0  15961  2210
1    197   405
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84132075, 'precision': 0.5787425, 'recall': 0.81237346, 'specificity': 0.81237346, 'f1': 0.59360343, 'auroc': 0.89387465, 'binary_precision': 0.16785079, 'binary_recall': 0.78099173, 'binary_specificity': 0.8437552, 'binary_f1_score': 0.27631578}
confusion matrix:
      0    1
0  5060  937
1    53  189
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-01 10:20:14.434218,epoch time: 0:27:52.310808,used: 0:56:02.864746,model: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.93372667, 'precision': 0.934381, 'recall': 0.9337307, 'specificity': 0.9337307, 'f1': 0.9337021, 'auroc': 0.98018885, 'binary_precision': 0.95129174, 'binary_recall': 0.91429454, 'binary_specificity': 0.95316684, 'binary_f1_score': 0.93242633}
confusion matrix:
       0      1
0  27781   1365
1   2499  26659
---- Validation: 
scalar performance:
{'acc': 0.87279606, 'precision': 0.5728882, 'recall': 0.78090864, 'specificity': 0.78090864, 'f1': 0.5932634, 'auroc': 0.8582957, 'binary_precision': 0.15759203, 'binary_recall': 0.68272424, 'binary_specificity': 0.87909305, 'binary_f1_score': 0.25607476}
confusion matrix:
       0     1
0  15974  2197
1    191   411
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8494951, 'precision': 0.58474433, 'recall': 0.8265393, 'specificity': 0.8265393, 'f1': 0.6040906, 'auroc': 0.9028137, 'binary_precision': 0.17880185, 'binary_recall': 0.8016529, 'binary_specificity': 0.8514257, 'binary_f1_score': 0.29238886}
confusion matrix:
      0    1
0  5106  891
1    48  194
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-01 10:50:13.193528,epoch time: 0:29:58.759310,used: 1:26:01.624056,model: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9370884, 'precision': 0.9376031, 'recall': 0.93709135, 'specificity': 0.93709135, 'f1': 0.93707013, 'auroc': 0.98248446, 'binary_precision': 0.95265496, 'binary_recall': 0.91991633, 'binary_specificity': 0.9542663, 'binary_f1_score': 0.9359995}
confusion matrix:
       0      1
0  27814   1333
1   2335  26822
---- Validation: 
scalar performance:
{'acc': 0.8602248, 'precision': 0.5696459, 'recall': 0.79208183, 'specificity': 0.79208183, 'f1': 0.585544, 'auroc': 0.86239237, 'binary_precision': 0.14993075, 'binary_recall': 0.7192691, 'binary_specificity': 0.8648946, 'binary_f1_score': 0.24813752}
confusion matrix:
       0     1
0  15716  2455
1    169   433
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83378744, 'precision': 0.5787653, 'recall': 0.82629955, 'specificity': 0.82629955, 'f1': 0.59122735, 'auroc': 0.90712845, 'binary_precision': 0.16624685, 'binary_recall': 0.8181818, 'binary_specificity': 0.8344172, 'binary_f1_score': 0.27634332}
confusion matrix:
      0    1
0  5004  993
1    44  198
early stop counter: 1
val acc:0.8602247834205627, best validation acc: 0.8727960586547852, corresponding to test acc:                         0.8494951128959656 / 0.8494951128959656
after epoch: 4,now: 2024-08-01 11:19:19.286395,epoch time: 0:29:06.092867,used: 1:55:07.716923,model: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9423882, 'precision': 0.9426633, 'recall': 0.9423903, 'specificity': 0.9423903, 'f1': 0.9423795, 'auroc': 0.98489, 'binary_precision': 0.9537428, 'binary_recall': 0.9298968, 'binary_specificity': 0.9548839, 'binary_f1_score': 0.94166887}
confusion matrix:
       0      1
0  27832   1315
1   2044  27113
---- Validation: 
scalar performance:
{'acc': 0.8462686, 'precision': 0.5653577, 'recall': 0.7961153, 'specificity': 0.7961153, 'f1': 0.57551867, 'auroc': 0.8633358, 'binary_precision': 0.1406545, 'binary_recall': 0.7425249, 'binary_specificity': 0.8497056, 'binary_f1_score': 0.23650794}
confusion matrix:
       0     1
0  15440  2731
1    155   447
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8220869, 'precision': 0.575376, 'recall': 0.8281441, 'specificity': 0.8281441, 'f1': 0.58280116, 'auroc': 0.9083598, 'binary_precision': 0.15880503, 'binary_recall': 0.8347107, 'binary_specificity': 0.8215774, 'binary_f1_score': 0.2668428}
confusion matrix:
      0     1
0  4927  1070
1    40   202
early stop counter: 2
val acc:0.8462685942649841, best validation acc: 0.8727960586547852, corresponding to test acc:                         0.8494951128959656 / 0.8494951128959656
after epoch: 5,now: 2024-08-01 11:48:52.836094,epoch time: 0:29:33.549699,used: 2:24:41.266622,model: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.94508094, 'precision': 0.9453828, 'recall': 0.9450841, 'specificity': 0.9450841, 'f1': 0.94507194, 'auroc': 0.9858002, 'binary_precision': 0.9570377, 'binary_recall': 0.9320279, 'binary_specificity': 0.9581403, 'binary_f1_score': 0.94436723}
confusion matrix:
       0      1
0  27925   1220
1   1982  27177
---- Validation: 
scalar performance:
{'acc': 0.85569704, 'precision': 0.5694133, 'recall': 0.8001826, 'specificity': 0.8001826, 'f1': 0.5839517, 'auroc': 0.86595917, 'binary_precision': 0.14871624, 'binary_recall': 0.7408638, 'binary_specificity': 0.8595014, 'binary_f1_score': 0.24770898}
confusion matrix:
       0     1
0  15618  2553
1    156   446
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.836352, 'precision': 0.57991093, 'recall': 0.8276335, 'specificity': 0.8276335, 'f1': 0.5935787, 'auroc': 0.9092666, 'binary_precision': 0.16851065, 'binary_recall': 0.8181818, 'binary_specificity': 0.8370852, 'binary_f1_score': 0.27946365}
confusion matrix:
      0    1
0  5020  977
1    44  198
early stop counter: 3
val acc:0.8556970357894897, best validation acc: 0.8727960586547852, corresponding to test acc:                         0.8494951128959656 / 0.8494951128959656
after epoch: 6,now: 2024-08-01 12:15:56.624196,epoch time: 0:27:03.788102,used: 2:51:45.054724,model: dset_te_center0_erm_no_git_version_2024md_08md_01_09_24_11_seed_2_23775402
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis_new/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 2:51:45.054724 at 2024-08-01 12:15:56.624196
persisted model performance metric: 

scalar performance:
{'acc': 0.8494951, 'precision': 0.58474433, 'recall': 0.8265393, 'specificity': 0.8265393, 'f1': 0.6040906, 'auroc': 0.9028137, 'binary_precision': 0.17880185, 'binary_recall': 0.8016529, 'binary_specificity': 0.8514257, 'binary_f1_score': 0.29238886}
confusion matrix:
      0    1
0  5106  891
1    48  194
oracle model performance metric: 

scalar performance:
{'acc': 0.8494951, 'precision': 0.58474433, 'recall': 0.8265393, 'specificity': 0.8265393, 'f1': 0.6040906, 'auroc': 0.9028137, 'binary_precision': 0.17880185, 'binary_recall': 0.8016529, 'binary_specificity': 0.8514257, 'binary_f1_score': 0.29238886}
confusion matrix:
      0    1
0  5106  891
1    48  194
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/rule_results/14.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_nofreeze_halffreeze_allfreeze_2024-07-31_03-06-46/confusion_matrix/14.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 190965 KiB | 461507 KiB | 305575 GiB | 305575 GiB |
|       from large pool | 173494 KiB | 427880 KiB | 299301 GiB | 299301 GiB |
|       from small pool |  17471 KiB |  38507 KiB |   6273 GiB |   6273 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 190965 KiB | 461507 KiB | 305575 GiB | 305575 GiB |
|       from large pool | 173494 KiB | 427880 KiB | 299301 GiB | 299301 GiB |
|       from small pool |  17471 KiB |  38507 KiB |   6273 GiB |   6273 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 189282 KiB | 457564 KiB | 305556 GiB | 305556 GiB |
|       from large pool | 172814 KiB | 424940 KiB | 299295 GiB | 299295 GiB |
|       from small pool |  16468 KiB |  37503 KiB |   6261 GiB |   6261 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 526336 KiB | 526336 KiB |   1070 MiB | 569344 KiB |
|       from large pool | 487424 KiB | 487424 KiB |   1008 MiB | 544768 KiB |
|       from small pool |  38912 KiB |  43008 KiB |     62 MiB |  24576 KiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  40458 KiB | 112281 KiB | 190961 GiB | 190961 GiB |
|       from large pool |  31306 KiB |  92928 KiB | 184565 GiB | 184565 GiB |
|       from small pool |   9152 KiB |  23510 KiB |   6395 GiB |   6395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    2954    |    7751    |   66085 K  |   66082 K  |
|       from large pool |      76    |     158    |   29502 K  |   29502 K  |
|       from small pool |    2878    |    7674    |   36583 K  |   36580 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    2954    |    7751    |   66085 K  |   66082 K  |
|       from large pool |      76    |     158    |   29502 K  |   29502 K  |
|       from small pool |    2878    |    7674    |   36583 K  |   36580 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      41    |      42    |      76    |      35    |
|       from large pool |      22    |      22    |      45    |      23    |
|       from small pool |      19    |      21    |      31    |      12    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3662    |   39372 K  |   39372 K  |
|       from large pool |      10    |      23    |   20522 K  |   20522 K  |
|       from small pool |      22    |    3652    |   18849 K  |   18849 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  17088 KiB | 461507 KiB | 305575 GiB | 305575 GiB |
|       from large pool |  17088 KiB | 427880 KiB | 299301 GiB | 299301 GiB |
|       from small pool |      0 KiB |  38507 KiB |   6273 GiB |   6273 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  17088 KiB | 461507 KiB | 305575 GiB | 305575 GiB |
|       from large pool |  17088 KiB | 427880 KiB | 299301 GiB | 299301 GiB |
|       from small pool |      0 KiB |  38507 KiB |   6273 GiB |   6273 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB | 457564 KiB | 305556 GiB | 305556 GiB |
|       from large pool |  16640 KiB | 424940 KiB | 299295 GiB | 299295 GiB |
|       from small pool |      0 KiB |  37503 KiB |   6261 GiB |   6261 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 231424 KiB | 526336 KiB |   1070 MiB |    844 MiB |
|       from large pool | 204800 KiB | 487424 KiB |   1008 MiB |    808 MiB |
|       from small pool |  26624 KiB |  43008 KiB |     62 MiB |     36 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  23872 KiB | 112281 KiB | 190961 GiB | 190961 GiB |
|       from large pool |  23872 KiB |  92928 KiB | 184566 GiB | 184566 GiB |
|       from small pool |      0 KiB |  23510 KiB |   6395 GiB |   6395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    7751    |   66085 K  |   66085 K  |
|       from large pool |       2    |     158    |   29502 K  |   29502 K  |
|       from small pool |       0    |    7674    |   36583 K  |   36583 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    7751    |   66085 K  |   66085 K  |
|       from large pool |       2    |     158    |   29502 K  |   29502 K  |
|       from small pool |       0    |    7674    |   36583 K  |   36583 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      23    |      42    |      76    |      53    |
|       from large pool |      10    |      22    |      45    |      35    |
|       from small pool |      13    |      21    |      31    |      18    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3662    |   39373 K  |   39373 K  |
|       from large pool |       3    |      23    |   20522 K  |   20522 K  |
|       from small pool |       0    |    3652    |   18850 K  |   18850 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  1 12:17:31 2024]
Finished job 0.
1 of 1 steps (100%) done
