Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 31 21:54:54 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/1.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=1
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_05_03_seed_0_23917128

 Experiment start at: 2024-07-31 22:05:03.933198
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.22451263666152954
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5003661, 'precision': 0.25018305, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.333496, 'auroc': 0.5, 'binary_precision': 0.5003661, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.666992}
confusion matrix:
   0      1
0  0  28659
1  0  28701
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.034216687, 'precision': 0.017108344, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.033084642, 'auroc': 0.5, 'binary_precision': 0.034216687, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.066169284}
confusion matrix:
   0      1
0  0  18149
1  0    643
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.041706614, 'precision': 0.020853307, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.040036816, 'auroc': 0.5, 'binary_precision': 0.041706614, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08007363}
confusion matrix:
   0     1
0  0  5997
1  0   261
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-31 22:41:52.257096,epoch time: 0:36:48.323898,used: 0:36:48.323898,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_05_03_seed_0_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.50038356, 'precision': 0.25019178, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33350375, 'auroc': 0.5, 'binary_precision': 0.50038356, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6670075}
confusion matrix:
   0      1
0  0  28658
1  0  28702
---- Validation: 
scalar performance:
{'acc': 0.034216687, 'precision': 0.017108344, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.033084642, 'auroc': 0.5, 'binary_precision': 0.034216687, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.066169284}
confusion matrix:
   0      1
0  0  18149
1  0    643
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.041706614, 'precision': 0.020853307, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.040036816, 'auroc': 0.5, 'binary_precision': 0.041706614, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08007363}
confusion matrix:
   0     1
0  0  5997
1  0   261
early stop counter: 1
val acc:0.034216687083244324, best validation acc: 0.034216687083244324, corresponding to test acc:                         0.04170661419630051 / 0.04170661419630051
after epoch: 2,now: 2024-07-31 23:17:29.877272,epoch time: 0:35:37.620176,used: 1:12:25.944074,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_05_03_seed_0_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.5004358, 'precision': 0.2502179, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33352697, 'auroc': 0.5, 'binary_precision': 0.5004358, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66705394}
confusion matrix:
   0      1
0  0  28655
1  0  28705
---- Validation: 
scalar performance:
{'acc': 0.034216687, 'precision': 0.017108344, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.033084642, 'auroc': 0.5, 'binary_precision': 0.034216687, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.066169284}
confusion matrix:
   0      1
0  0  18149
1  0    643
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.041706614, 'precision': 0.020853307, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.040036816, 'auroc': 0.5, 'binary_precision': 0.041706614, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08007363}
confusion matrix:
   0     1
0  0  5997
1  0   261
early stop counter: 2
val acc:0.034216687083244324, best validation acc: 0.034216687083244324, corresponding to test acc:                         0.04170661419630051 / 0.04170661419630051
after epoch: 3,now: 2024-07-31 23:52:58.632001,epoch time: 0:35:28.754729,used: 1:47:54.698803,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_05_03_seed_0_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.50040096, 'precision': 0.25020048, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33351147, 'auroc': 0.5, 'binary_precision': 0.50040096, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66702294}
confusion matrix:
   0      1
0  0  28657
1  0  28703
---- Validation: 
scalar performance:
{'acc': 0.034216687, 'precision': 0.017108344, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.033084642, 'auroc': 0.5, 'binary_precision': 0.034216687, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.066169284}
confusion matrix:
   0      1
0  0  18149
1  0    643
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.041706614, 'precision': 0.020853307, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.040036816, 'auroc': 0.5, 'binary_precision': 0.041706614, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08007363}
confusion matrix:
   0     1
0  0  5997
1  0   261
early stop counter: 3
val acc:0.034216687083244324, best validation acc: 0.034216687083244324, corresponding to test acc:                         0.04170661419630051 / 0.04170661419630051
after epoch: 4,now: 2024-08-01 00:28:38.237328,epoch time: 0:35:39.605327,used: 2:23:34.304130,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_05_03_seed_0_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:23:34.304130 at 2024-08-01 00:28:38.237328
persisted model performance metric: 

scalar performance:
{'acc': 0.041706614, 'precision': 0.020853307, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.040036816, 'auroc': 0.5, 'binary_precision': 0.041706614, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08007363}
confusion matrix:
   0     1
0  0  5997
1  0   261
oracle model performance metric: 

scalar performance:
{'acc': 0.041706614, 'precision': 0.020853307, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.040036816, 'auroc': 0.5, 'binary_precision': 0.041706614, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08007363}
confusion matrix:
   0     1
0  0  5997
1  0   261
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/1.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 456876 KiB |   3602 MiB | 266583 GiB | 266583 GiB |
|       from large pool | 415178 KiB |   3568 MiB | 263581 GiB | 263581 GiB |
|       from small pool |  41697 KiB |     61 MiB |   3002 GiB |   3001 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 456876 KiB |   3602 MiB | 266583 GiB | 266583 GiB |
|       from large pool | 415178 KiB |   3568 MiB | 263581 GiB | 263581 GiB |
|       from small pool |  41697 KiB |     61 MiB |   3002 GiB |   3001 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447754 KiB |   3596 MiB | 266409 GiB | 266409 GiB |
|       from large pool | 407075 KiB |   3563 MiB | 263412 GiB | 263412 GiB |
|       from small pool |  40679 KiB |     60 MiB |   2997 GiB |   2997 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4016 MiB |   4016 MiB |   4016 MiB |      0 B   |
|       from large pool |   3948 MiB |   3948 MiB |   3948 MiB |      0 B   |
|       from small pool |     68 MiB |     68 MiB |     68 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 347988 KiB | 518886 KiB | 192610 GiB | 192610 GiB |
|       from large pool | 342581 KiB | 515218 KiB | 189549 GiB | 189549 GiB |
|       from small pool |   5406 KiB |  14352 KiB |   3060 GiB |   3060 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3508    |    8175    |   46032 K  |   46028 K  |
|       from large pool |     187    |     468    |   24175 K  |   24175 K  |
|       from small pool |    3321    |    7987    |   21856 K  |   21853 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3508    |    8175    |   46032 K  |   46028 K  |
|       from large pool |     187    |     468    |   24175 K  |   24175 K  |
|       from small pool |    3321    |    7987    |   21856 K  |   21853 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     199    |     199    |     199    |       0    |
|       from large pool |     165    |     165    |     165    |       0    |
|       from small pool |      34    |      34    |      34    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      72    |    3627    |   25039 K  |   25039 K  |
|       from large pool |      33    |     160    |   14577 K  |   14577 K  |
|       from small pool |      39    |    3594    |   10462 K  |   10462 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB | 266583 GiB | 266583 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 263581 GiB | 263581 GiB |
|       from small pool |      0 KiB |     61 MiB |   3002 GiB |   3002 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB | 266583 GiB | 266583 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 263581 GiB | 263581 GiB |
|       from small pool |      0 KiB |     61 MiB |   3002 GiB |   3002 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 266409 GiB | 266409 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 263412 GiB | 263412 GiB |
|       from small pool |      0 KiB |     60 MiB |   2997 GiB |   2997 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3948 MiB |   3948 MiB |   3208 MiB |
|       from small pool |     46 MiB |     68 MiB |     68 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 518886 KiB | 192610 GiB | 192610 GiB |
|       from large pool |  24320 KiB | 515218 KiB | 189549 GiB | 189549 GiB |
|       from small pool |      0 KiB |  25599 KiB |   3060 GiB |   3060 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8175    |   46032 K  |   46032 K  |
|       from large pool |       2    |     468    |   24175 K  |   24175 K  |
|       from small pool |       0    |    7987    |   21856 K  |   21856 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8175    |   46032 K  |   46032 K  |
|       from large pool |       2    |     468    |   24175 K  |   24175 K  |
|       from small pool |       0    |    7987    |   21856 K  |   21856 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     199    |     199    |     142    |
|       from large pool |      34    |     165    |     165    |     131    |
|       from small pool |      23    |      34    |      34    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3627    |   25040 K  |   25040 K  |
|       from large pool |       3    |     160    |   14577 K  |   14577 K  |
|       from small pool |       0    |    3594    |   10463 K  |   10463 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB | 266583 GiB | 266583 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 263581 GiB | 263581 GiB |
|       from small pool |      0 KiB |     61 MiB |   3002 GiB |   3002 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB | 266583 GiB | 266583 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 263581 GiB | 263581 GiB |
|       from small pool |      0 KiB |     61 MiB |   3002 GiB |   3002 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 266409 GiB | 266409 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 263412 GiB | 263412 GiB |
|       from small pool |      0 KiB |     60 MiB |   2997 GiB |   2997 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3948 MiB |   3948 MiB |   3208 MiB |
|       from small pool |     46 MiB |     68 MiB |     68 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 518886 KiB | 192610 GiB | 192610 GiB |
|       from large pool |  24320 KiB | 515218 KiB | 189549 GiB | 189549 GiB |
|       from small pool |      0 KiB |  25599 KiB |   3060 GiB |   3060 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8175    |   46032 K  |   46032 K  |
|       from large pool |       2    |     468    |   24175 K  |   24175 K  |
|       from small pool |       0    |    7987    |   21856 K  |   21856 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8175    |   46032 K  |   46032 K  |
|       from large pool |       2    |     468    |   24175 K  |   24175 K  |
|       from small pool |       0    |    7987    |   21856 K  |   21856 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     199    |     199    |     142    |
|       from large pool |      34    |     165    |     165    |     131    |
|       from small pool |      23    |      34    |      34    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3627    |   25040 K  |   25040 K  |
|       from large pool |       3    |     160    |   14577 K  |   14577 K  |
|       from small pool |       0    |    3594    |   10463 K  |   10463 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_00_39_05_seed_1_23917128

 Experiment start at: 2024-08-01 00:39:05.875798
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6890106797218323
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5003645, 'precision': 0.25018224, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33349526, 'auroc': 0.5, 'binary_precision': 0.5003645, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6669905}
confusion matrix:
   0      1
0  0  28787
1  0  28829
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 01:15:07.292800,epoch time: 0:36:01.417002,used: 0:36:01.417002,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_00_39_05_seed_1_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.5003645, 'precision': 0.25018224, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33349526, 'auroc': 0.5, 'binary_precision': 0.5003645, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6669905}
confusion matrix:
   0      1
0  0  28787
1  0  28829
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
early stop counter: 1
val acc:0.03591248765587807, best validation acc: 0.03591248765587807, corresponding to test acc:                         0.04189493879675865 / 0.04189493879675865
after epoch: 2,now: 2024-08-01 01:51:26.444714,epoch time: 0:36:19.151914,used: 1:12:20.568916,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_00_39_05_seed_1_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.5003818, 'precision': 0.2501909, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33350298, 'auroc': 0.5, 'binary_precision': 0.5003818, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66700596}
confusion matrix:
   0      1
0  0  28786
1  0  28830
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
early stop counter: 2
val acc:0.03591248765587807, best validation acc: 0.03591248765587807, corresponding to test acc:                         0.04189493879675865 / 0.04189493879675865
after epoch: 3,now: 2024-08-01 02:27:58.554556,epoch time: 0:36:32.109842,used: 1:48:52.678758,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_00_39_05_seed_1_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.5003645, 'precision': 0.25018224, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33349526, 'auroc': 0.5, 'binary_precision': 0.5003645, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6669905}
confusion matrix:
   0      1
0  0  28787
1  0  28829
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
early stop counter: 3
val acc:0.03591248765587807, best validation acc: 0.03591248765587807, corresponding to test acc:                         0.04189493879675865 / 0.04189493879675865
after epoch: 4,now: 2024-08-01 03:04:57.324377,epoch time: 0:36:58.769821,used: 2:25:51.448579,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_00_39_05_seed_1_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:25:51.448579 at 2024-08-01 03:04:57.324377
persisted model performance metric: 

scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
oracle model performance metric: 

scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454337 KiB |   3602 MiB | 534134 GiB | 534133 GiB |
|       from large pool | 412651 KiB |   3568 MiB | 528121 GiB | 528121 GiB |
|       from small pool |  41685 KiB |     61 MiB |   6012 GiB |   6012 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454337 KiB |   3602 MiB | 534134 GiB | 534133 GiB |
|       from large pool | 412651 KiB |   3568 MiB | 528121 GiB | 528121 GiB |
|       from small pool |  41685 KiB |     61 MiB |   6012 GiB |   6012 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447752 KiB |   3596 MiB | 533842 GiB | 533841 GiB |
|       from large pool | 407075 KiB |   3563 MiB | 527839 GiB | 527838 GiB |
|       from small pool |  40677 KiB |     60 MiB |   6002 GiB |   6002 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4020 MiB |   4020 MiB |   7250 MiB |   3230 MiB |
|       from large pool |   3956 MiB |   3956 MiB |   7164 MiB |   3208 MiB |
|       from small pool |     64 MiB |     68 MiB |     86 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 373055 KiB | 521909 KiB | 385837 GiB | 385836 GiB |
|       from large pool | 365588 KiB | 519546 KiB | 379698 GiB | 379698 GiB |
|       from small pool |   7466 KiB |  25599 KiB |   6138 GiB |   6138 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3484    |    8207    |   92225 K  |   92221 K  |
|       from large pool |     187    |     468    |   48443 K  |   48443 K  |
|       from small pool |    3297    |    8019    |   43781 K  |   43778 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3484    |    8207    |   92225 K  |   92221 K  |
|       from large pool |     187    |     468    |   48443 K  |   48443 K  |
|       from small pool |    3297    |    8019    |   43781 K  |   43778 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     199    |     340    |     142    |
|       from large pool |     166    |     166    |     297    |     131    |
|       from small pool |      32    |      34    |      43    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      75    |    3639    |   50031 K  |   50031 K  |
|       from large pool |      34    |     167    |   29168 K  |   29168 K  |
|       from small pool |      41    |    3605    |   20862 K  |   20862 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB | 534134 GiB | 534134 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 528121 GiB | 528121 GiB |
|       from small pool |      0 KiB |     61 MiB |   6012 GiB |   6012 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB | 534134 GiB | 534134 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 528121 GiB | 528121 GiB |
|       from small pool |      0 KiB |     61 MiB |   6012 GiB |   6012 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 533842 GiB | 533842 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 527839 GiB | 527839 GiB |
|       from small pool |      0 KiB |     60 MiB |   6002 GiB |   6002 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    808 MiB |   4020 MiB |   7250 MiB |   6442 MiB |
|       from large pool |    760 MiB |   3956 MiB |   7164 MiB |   6404 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 521909 KiB | 385837 GiB | 385837 GiB |
|       from large pool |  24320 KiB | 519546 KiB | 379699 GiB | 379699 GiB |
|       from small pool |      0 KiB |  35594 KiB |   6138 GiB |   6138 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8207    |   92225 K  |   92225 K  |
|       from large pool |       2    |     468    |   48443 K  |   48443 K  |
|       from small pool |       0    |    8019    |   43781 K  |   43781 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8207    |   92225 K  |   92225 K  |
|       from large pool |       2    |     468    |   48443 K  |   48443 K  |
|       from small pool |       0    |    8019    |   43781 K  |   43781 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     199    |     340    |     281    |
|       from large pool |      35    |     166    |     297    |     262    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3639    |   50032 K  |   50032 K  |
|       from large pool |       3    |     167    |   29168 K  |   29168 K  |
|       from small pool |       0    |    3605    |   20864 K  |   20864 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB | 534134 GiB | 534134 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 528121 GiB | 528121 GiB |
|       from small pool |      0 KiB |     61 MiB |   6012 GiB |   6012 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB | 534134 GiB | 534134 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 528121 GiB | 528121 GiB |
|       from small pool |      0 KiB |     61 MiB |   6012 GiB |   6012 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 533842 GiB | 533842 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 527839 GiB | 527839 GiB |
|       from small pool |      0 KiB |     60 MiB |   6002 GiB |   6002 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    808 MiB |   4020 MiB |   7250 MiB |   6442 MiB |
|       from large pool |    760 MiB |   3956 MiB |   7164 MiB |   6404 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 521909 KiB | 385837 GiB | 385837 GiB |
|       from large pool |  24320 KiB | 519546 KiB | 379699 GiB | 379699 GiB |
|       from small pool |      0 KiB |  35594 KiB |   6138 GiB |   6138 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8207    |   92225 K  |   92225 K  |
|       from large pool |       2    |     468    |   48443 K  |   48443 K  |
|       from small pool |       0    |    8019    |   43781 K  |   43781 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8207    |   92225 K  |   92225 K  |
|       from large pool |       2    |     468    |   48443 K  |   48443 K  |
|       from small pool |       0    |    8019    |   43781 K  |   43781 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     199    |     340    |     281    |
|       from large pool |      35    |     166    |     297    |     262    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3639    |   50032 K  |   50032 K  |
|       from large pool |       3    |     167    |   29168 K  |   29168 K  |
|       from small pool |       0    |    3605    |   20864 K  |   20864 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_03_15_39_seed_2_23917128

 Experiment start at: 2024-08-01 03:15:39.888490
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.10803013294935226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.49991423, 'precision': 0.24995711, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33329523, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29147  0
1  29157  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 03:52:52.566602,epoch time: 0:37:12.678112,used: 0:37:12.678112,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_03_15_39_seed_2_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.49991423, 'precision': 0.24995711, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33329523, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29147  0
1  29157  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
early stop counter: 1
val acc:0.9679326415061951, best validation acc: 0.9679326415061951, corresponding to test acc:                         0.9612117409706116 / 0.9612117409706116
after epoch: 2,now: 2024-08-01 04:28:52.553472,epoch time: 0:35:59.986870,used: 1:13:12.664982,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_03_15_39_seed_2_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.4998971, 'precision': 0.24994855, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3332876, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29146  0
1  29158  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
early stop counter: 2
val acc:0.9679326415061951, best validation acc: 0.9679326415061951, corresponding to test acc:                         0.9612117409706116 / 0.9612117409706116
after epoch: 3,now: 2024-08-01 05:05:37.959407,epoch time: 0:36:45.405935,used: 1:49:58.070917,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_03_15_39_seed_2_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.49991423, 'precision': 0.24995711, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33329523, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29147  0
1  29157  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
early stop counter: 3
val acc:0.9679326415061951, best validation acc: 0.9679326415061951, corresponding to test acc:                         0.9612117409706116 / 0.9612117409706116
after epoch: 4,now: 2024-08-01 05:43:16.116416,epoch time: 0:37:38.157009,used: 2:27:36.227926,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_03_15_39_seed_2_23917128
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:27:36.227926 at 2024-08-01 05:43:16.116416
persisted model performance metric: 

scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
oracle model performance metric: 

scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/1.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/confusion_matrix/1.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 457635 KiB |   3603 MiB |    786 TiB |    786 TiB |
|       from large pool | 415944 KiB |   3570 MiB |    777 TiB |    777 TiB |
|       from small pool |  41691 KiB |     61 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 457635 KiB |   3603 MiB |    786 TiB |    786 TiB |
|       from large pool | 415944 KiB |   3570 MiB |    777 TiB |    777 TiB |
|       from small pool |  41691 KiB |     61 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447753 KiB |   3596 MiB |    785 TiB |    785 TiB |
|       from large pool | 407075 KiB |   3563 MiB |    776 TiB |    776 TiB |
|       from small pool |  40678 KiB |     60 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4008 MiB |   4020 MiB |  10450 MiB |   6442 MiB |
|       from large pool |   3944 MiB |   3956 MiB |  10348 MiB |   6404 MiB |
|       from small pool |     64 MiB |     68 MiB |    102 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 349276 KiB | 521909 KiB | 585147 GiB | 585147 GiB |
|       from large pool | 341816 KiB | 519546 KiB | 575895 GiB | 575894 GiB |
|       from small pool |   7460 KiB |  35594 KiB |   9252 GiB |   9252 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3496    |    8293    |  138928 K  |  138924 K  |
|       from large pool |     187    |     468    |   72985 K  |   72985 K  |
|       from small pool |    3309    |    8105    |   65942 K  |   65938 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3496    |    8293    |  138928 K  |  138924 K  |
|       from large pool |     187    |     468    |   72985 K  |   72985 K  |
|       from small pool |    3309    |    8105    |   65942 K  |   65938 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     199    |     479    |     281    |
|       from large pool |     166    |     166    |     428    |     262    |
|       from small pool |      32    |      34    |      51    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      74    |    3682    |   76907 K  |   76906 K  |
|       from large pool |      34    |     167    |   45624 K  |   45624 K  |
|       from small pool |      40    |    3648    |   31282 K  |   31282 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3603 MiB |    786 TiB |    786 TiB |
|       from large pool |  16640 KiB |   3570 MiB |    777 TiB |    777 TiB |
|       from small pool |      0 KiB |     61 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3603 MiB |    786 TiB |    786 TiB |
|       from large pool |  16640 KiB |   3570 MiB |    777 TiB |    777 TiB |
|       from small pool |      0 KiB |     61 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |    785 TiB |    785 TiB |
|       from large pool |  16640 KiB |   3563 MiB |    776 TiB |    776 TiB |
|       from small pool |      0 KiB |     60 MiB |      8 TiB |      8 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    788 MiB |   4020 MiB |  10450 MiB |   9662 MiB |
|       from large pool |    740 MiB |   3956 MiB |  10348 MiB |   9608 MiB |
|       from small pool |     48 MiB |     68 MiB |    102 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 521909 KiB | 585148 GiB | 585148 GiB |
|       from large pool |  24320 KiB | 519546 KiB | 575895 GiB | 575895 GiB |
|       from small pool |      0 KiB |  35594 KiB |   9252 GiB |   9252 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8293    |  138928 K  |  138928 K  |
|       from large pool |       2    |     468    |   72985 K  |   72985 K  |
|       from small pool |       0    |    8105    |   65942 K  |   65942 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8293    |  138928 K  |  138928 K  |
|       from large pool |       2    |     468    |   72985 K  |   72985 K  |
|       from small pool |       0    |    8105    |   65942 K  |   65942 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      58    |     199    |     479    |     421    |
|       from large pool |      34    |     166    |     428    |     394    |
|       from small pool |      24    |      34    |      51    |      27    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3682    |   76908 K  |   76908 K  |
|       from large pool |       3    |     167    |   45624 K  |   45624 K  |
|       from small pool |       0    |    3648    |   31283 K  |   31283 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  1 05:44:51 2024]
Finished job 0.
1 of 1 steps (100%) done
