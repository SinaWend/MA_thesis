Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 31 22:06:02 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129

 Experiment start at: 2024-07-31 22:13:45.434988
before training, model accuracy: 0.22451263666152954
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9848675, 'precision': 0.9851043, 'recall': 0.9848757, 'specificity': 0.9848757, 'f1': 0.98486584, 'auroc': 0.99891305, 'binary_precision': 0.9960081, 'binary_recall': 0.97365946, 'binary_specificity': 0.99609196, 'binary_f1_score': 0.984707}
confusion matrix:
       0      1
0  28547    112
1    756  27945
---- Validation: 
scalar performance:
{'acc': 0.8832482, 'precision': 0.5961128, 'recall': 0.8450489, 'specificity': 0.8450489, 'f1': 0.6282307, 'auroc': 0.8996506, 'binary_precision': 0.2, 'binary_recall': 0.80404353, 'binary_specificity': 0.88605434, 'binary_f1_score': 0.3203222}
confusion matrix:
       0     1
0  16081  2068
1    126   517
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92649406, 'precision': 0.66648054, 'recall': 0.87552786, 'specificity': 0.87552786, 'f1': 0.7212112, 'auroc': 0.9324579, 'binary_precision': 0.34130782, 'binary_recall': 0.8199234, 'binary_specificity': 0.93113226, 'binary_f1_score': 0.481982}
confusion matrix:
      0    1
0  5584  413
1    47  214
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-31 22:52:05.356924,epoch time: 0:38:19.921936,used: 0:38:19.921936,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96630055, 'precision': 0.96839046, 'recall': 0.9663286, 'specificity': 0.9663286, 'f1': 0.96626437, 'auroc': 0.998965, 'binary_precision': 0.99988794, 'binary_recall': 0.93276197, 'binary_specificity': 0.99989533, 'binary_f1_score': 0.96515924}
confusion matrix:
       0      1
0  28653      3
1   1930  26774
---- Validation: 
scalar performance:
{'acc': 0.954768, 'precision': 0.49210364, 'recall': 0.4972974, 'specificity': 0.4972974, 'f1': 0.49308982, 'auroc': 0.9137224, 'binary_precision': 0.018604651, 'binary_recall': 0.00622084, 'binary_specificity': 0.988374, 'binary_f1_score': 0.0093240095}
confusion matrix:
       0    1
0  17938  211
1    639    4
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9506232, 'precision': 0.47898552, 'recall': 0.495998, 'specificity': 0.495998, 'f1': 0.48734334, 'auroc': 0.9225941, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.991996, 'binary_f1_score': 0.0}
confusion matrix:
      0   1
0  5949  48
1   261   0
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-31 23:29:23.915866,epoch time: 0:37:18.558942,used: 1:15:38.480878,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.98417014, 'precision': 0.9842132, 'recall': 0.9841667, 'specificity': 0.9841667, 'f1': 0.9841697, 'auroc': 0.9988153, 'binary_precision': 0.9798356, 'binary_recall': 0.9887116, 'binary_specificity': 0.97962177, 'binary_f1_score': 0.9842536}
confusion matrix:
       0      1
0  28074    584
1    324  28378
---- Validation: 
scalar performance:
{'acc': 0.9359302, 'precision': 0.6507914, 'recall': 0.83332026, 'specificity': 0.83332026, 'f1': 0.70091903, 'auroc': 0.92472947, 'binary_precision': 0.31187123, 'binary_recall': 0.7231726, 'binary_specificity': 0.943468, 'binary_f1_score': 0.43580133}
confusion matrix:
       0     1
0  17123  1026
1    178   465
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9713966, 'precision': 0.82082266, 'recall': 0.8219982, 'specificity': 0.8219982, 'f1': 0.8214092, 'auroc': 0.91292906, 'binary_precision': 0.65648854, 'binary_recall': 0.65900385, 'binary_specificity': 0.9849925, 'binary_f1_score': 0.6577438}
confusion matrix:
      0    1
0  5907   90
1    89  172
new oracle model saved
early stop counter: 1
val acc:0.9359301924705505, best validation acc: 0.9547680020332336, corresponding to test acc:                         0.9506232142448425 / 0.9713966250419617
after epoch: 3,now: 2024-08-01 00:07:11.247807,epoch time: 0:37:47.331941,used: 1:53:25.812819,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9879707, 'precision': 0.9879732, 'recall': 0.98797184, 'specificity': 0.98797184, 'f1': 0.9879707, 'auroc': 0.9988843, 'binary_precision': 0.98931044, 'binary_recall': 0.9866221, 'binary_specificity': 0.9893216, 'binary_f1_score': 0.9879644}
confusion matrix:
       0      1
0  28350    306
1    384  28320
---- Validation: 
scalar performance:
{'acc': 0.8711154, 'precision': 0.5840289, 'recall': 0.81851614, 'specificity': 0.81851614, 'f1': 0.6086049, 'auroc': 0.8870543, 'binary_precision': 0.17760058, 'binary_recall': 0.7620529, 'binary_specificity': 0.8749793, 'binary_f1_score': 0.28806585}
confusion matrix:
       0     1
0  15880  2269
1    153   490
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8991691, 'precision': 0.6305394, 'recall': 0.8649354, 'specificity': 0.8649354, 'f1': 0.67565113, 'auroc': 0.92410797, 'binary_precision': 0.2693267, 'binary_recall': 0.82758623, 'binary_specificity': 0.9022845, 'binary_f1_score': 0.406397}
confusion matrix:
      0    1
0  5411  586
1    45  216
early stop counter: 2
val acc:0.8711153864860535, best validation acc: 0.9547680020332336, corresponding to test acc:                         0.9506232142448425 / 0.9713966250419617
after epoch: 4,now: 2024-08-01 00:46:02.837072,epoch time: 0:38:51.589265,used: 2:32:17.402084,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98448396, 'precision': 0.98492026, 'recall': 0.9844967, 'specificity': 0.9844967, 'f1': 0.98448074, 'auroc': 0.99911845, 'binary_precision': 0.99967664, 'binary_recall': 0.9693074, 'binary_specificity': 0.99968594, 'binary_f1_score': 0.9842578}
confusion matrix:
       0      1
0  28647      9
1    881  27823
---- Validation: 
scalar performance:
{'acc': 0.95812047, 'precision': 0.6399471, 'recall': 0.5830392, 'specificity': 0.5830392, 'f1': 0.60307544, 'auroc': 0.8974221, 'binary_precision': 0.30851063, 'binary_recall': 0.18040435, 'binary_specificity': 0.98567414, 'binary_f1_score': 0.22767419}
confusion matrix:
       0    1
0  17889  260
1    527  116
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95158195, 'precision': 0.6540879, 'recall': 0.58078563, 'specificity': 0.58078563, 'f1': 0.6039567, 'auroc': 0.91023195, 'binary_precision': 0.3432836, 'binary_recall': 0.17624521, 'binary_specificity': 0.985326, 'binary_f1_score': 0.2329114}
confusion matrix:
      0   1
0  5909  88
1   215  46
better model found
persisted
after epoch: 5,now: 2024-08-01 01:23:29.198698,epoch time: 0:37:26.361626,used: 3:09:43.763710,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98364717, 'precision': 0.9839032, 'recall': 0.98365736, 'specificity': 0.98365736, 'f1': 0.9836452, 'auroc': 0.997336, 'binary_precision': 0.9952556, 'binary_recall': 0.97195613, 'binary_specificity': 0.9953586, 'binary_f1_score': 0.9834679}
confusion matrix:
       0      1
0  28522    133
1    805  27900
---- Validation: 
scalar performance:
{'acc': 0.95152193, 'precision': 0.649526, 'recall': 0.67338, 'specificity': 0.67338, 'f1': 0.6604219, 'auroc': 0.8778289, 'binary_precision': 0.32133332, 'binary_recall': 0.3748056, 'binary_specificity': 0.9719544, 'binary_f1_score': 0.34601578}
confusion matrix:
       0    1
0  17640  509
1    402  241
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9541387, 'precision': 0.6404852, 'recall': 0.53997594, 'specificity': 0.53997594, 'f1': 0.5572904, 'auroc': 0.852123, 'binary_precision': 0.31944445, 'binary_recall': 0.08812261, 'binary_specificity': 0.9918293, 'binary_f1_score': 0.13813815}
confusion matrix:
      0   1
0  5948  49
1   238  23
early stop counter: 1
val acc:0.9515219330787659, best validation acc: 0.9581204652786255, corresponding to test acc:                         0.9515819549560547 / 0.9713966250419617
after epoch: 6,now: 2024-08-01 02:00:47.289286,epoch time: 0:37:18.090588,used: 3:47:01.854298,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9764296, 'precision': 0.97723055, 'recall': 0.97644615, 'specificity': 0.97644615, 'f1': 0.9764203, 'auroc': 0.9974498, 'binary_precision': 0.9969837, 'binary_recall': 0.9557886, 'binary_specificity': 0.9971037, 'binary_f1_score': 0.9759516}
confusion matrix:
       0      1
0  28574     83
1   1269  27434
---- Validation: 
scalar performance:
{'acc': 0.9605683, 'precision': 0.6442231, 'recall': 0.5618049, 'specificity': 0.5618049, 'f1': 0.5840916, 'auroc': 0.88929737, 'binary_precision': 0.31851852, 'binary_recall': 0.13374805, 'binary_specificity': 0.9898617, 'binary_f1_score': 0.18838991}
confusion matrix:
       0    1
0  17965  184
1    557   86
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95589644, 'precision': 0.60030115, 'recall': 0.5115757, 'specificity': 0.5115757, 'f1': 0.5128505, 'auroc': 0.882796, 'binary_precision': 0.2413793, 'binary_recall': 0.026819924, 'binary_specificity': 0.9963315, 'binary_f1_score': 0.048275862}
confusion matrix:
      0   1
0  5975  22
1   254   7
better model found
persisted
after epoch: 7,now: 2024-08-01 02:37:56.748870,epoch time: 0:37:09.459584,used: 4:24:11.313882,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9422943, 'precision': 0.94693744, 'recall': 0.94225705, 'specificity': 0.94225705, 'f1': 0.9421406, 'auroc': 0.9971302, 'binary_precision': 0.90156573, 'binary_recall': 0.9931013, 'binary_specificity': 0.8914128, 'binary_f1_score': 0.94512236}
confusion matrix:
       0      1
0  25547   3112
1    198  28503
---- Validation: 
scalar performance:
{'acc': 0.7937952, 'precision': 0.56062573, 'recall': 0.82573986, 'specificity': 0.82573986, 'f1': 0.55159485, 'auroc': 0.890592, 'binary_precision': 0.12747811, 'binary_recall': 0.8600311, 'binary_specificity': 0.7914486, 'binary_f1_score': 0.22204378}
confusion matrix:
       0     1
0  14364  3785
1     90   553
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9236178, 'precision': 0.65478635, 'recall': 0.8392127, 'specificity': 0.8392127, 'f1': 0.7041359, 'auroc': 0.892573, 'binary_precision': 0.32125205, 'binary_recall': 0.74712646, 'binary_specificity': 0.931299, 'binary_f1_score': 0.44930878}
confusion matrix:
      0    1
0  5585  412
1    66  195
early stop counter: 1
val acc:0.7937952280044556, best validation acc: 0.9605683088302612, corresponding to test acc:                         0.9558964371681213 / 0.9713966250419617
after epoch: 8,now: 2024-08-01 03:14:59.889864,epoch time: 0:37:03.140994,used: 5:01:14.454876,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.9892434, 'precision': 0.9894074, 'recall': 0.9892499, 'specificity': 0.9892499, 'f1': 0.98924255, 'auroc': 0.99865216, 'binary_precision': 0.9985443, 'binary_recall': 0.97993034, 'binary_specificity': 0.9985694, 'binary_f1_score': 0.98914975}
confusion matrix:
       0      1
0  28619     41
1    576  28124
---- Validation: 
scalar performance:
{'acc': 0.9589187, 'precision': 0.6803374, 'recall': 0.6569579, 'specificity': 0.6569579, 'f1': 0.6677243, 'auroc': 0.8507011, 'binary_precision': 0.38420108, 'binary_recall': 0.33281493, 'binary_specificity': 0.9811009, 'binary_f1_score': 0.3566667}
confusion matrix:
       0    1
0  17806  343
1    429  214
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95190156, 'precision': 0.52938145, 'recall': 0.50582665, 'specificity': 0.50582665, 'f1': 0.50374615, 'auroc': 0.8114777, 'binary_precision': 0.1, 'binary_recall': 0.019157087, 'binary_specificity': 0.99249625, 'binary_f1_score': 0.03215434}
confusion matrix:
      0   1
0  5952  45
1   256   5
early stop counter: 2
val acc:0.9589186906814575, best validation acc: 0.9605683088302612, corresponding to test acc:                         0.9558964371681213 / 0.9713966250419617
after epoch: 9,now: 2024-08-01 03:52:19.903622,epoch time: 0:37:20.013758,used: 5:38:34.468634,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.99283475, 'precision': 0.992887, 'recall': 0.9928398, 'specificity': 0.9928398, 'f1': 0.99283457, 'auroc': 0.9991226, 'binary_precision': 0.9982041, 'binary_recall': 0.9874595, 'binary_specificity': 0.9982201, 'binary_f1_score': 0.9928027}
confusion matrix:
       0      1
0  28602     51
1    360  28347
---- Validation: 
scalar performance:
{'acc': 0.9442848, 'precision': 0.63791597, 'recall': 0.70788604, 'specificity': 0.70788604, 'f1': 0.66447055, 'auroc': 0.8791165, 'binary_precision': 0.29554656, 'binary_recall': 0.4541213, 'binary_specificity': 0.9616508, 'binary_f1_score': 0.3580625}
confusion matrix:
       0    1
0  17453  696
1    351  292
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9435922, 'precision': 0.66413385, 'recall': 0.6957185, 'specificity': 0.6957185, 'f1': 0.6782625, 'auroc': 0.8891387, 'binary_precision': 0.3535032, 'binary_recall': 0.42528737, 'binary_specificity': 0.96614975, 'binary_f1_score': 0.38608694}
confusion matrix:
      0    1
0  5794  203
1   150  111
early stop counter: 3
val acc:0.9442847967147827, best validation acc: 0.9605683088302612, corresponding to test acc:                         0.9558964371681213 / 0.9713966250419617
after epoch: 10,now: 2024-08-01 04:29:44.831350,epoch time: 0:37:24.927728,used: 6:15:59.396362,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_31_22_13_45_seed_0_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 10 with time: 6:15:59.396362 at 2024-08-01 04:29:44.831350
persisted model performance metric: 

scalar performance:
{'acc': 0.95589644, 'precision': 0.60030115, 'recall': 0.5115757, 'specificity': 0.5115757, 'f1': 0.5128505, 'auroc': 0.882796, 'binary_precision': 0.2413793, 'binary_recall': 0.026819924, 'binary_specificity': 0.9963315, 'binary_f1_score': 0.048275862}
confusion matrix:
      0   1
0  5975  22
1   254   7
oracle model performance metric: 

scalar performance:
{'acc': 0.9713966, 'precision': 0.82082266, 'recall': 0.8219982, 'specificity': 0.8219982, 'f1': 0.8214092, 'auroc': 0.91292906, 'binary_precision': 0.65648854, 'binary_recall': 0.65900385, 'binary_specificity': 0.9849925, 'binary_f1_score': 0.6577438}
confusion matrix:
      0    1
0  5907   90
1    89  172
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 457762 KiB |   3601 MiB | 658116 GiB | 658116 GiB |
|       from large pool | 416065 KiB |   3568 MiB | 650704 GiB | 650703 GiB |
|       from small pool |  41697 KiB |     61 MiB |   7412 GiB |   7412 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 457762 KiB |   3601 MiB | 658116 GiB | 658116 GiB |
|       from large pool | 416065 KiB |   3568 MiB | 650704 GiB | 650703 GiB |
|       from small pool |  41697 KiB |     61 MiB |   7412 GiB |   7412 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447754 KiB |   3596 MiB | 657618 GiB | 657618 GiB |
|       from large pool | 407075 KiB |   3563 MiB | 650218 GiB | 650218 GiB |
|       from small pool |  40679 KiB |     60 MiB |   7400 GiB |   7400 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4020 MiB |   4020 MiB |   4020 MiB |      0 B   |
|       from large pool |   3952 MiB |   3952 MiB |   3952 MiB |      0 B   |
|       from small pool |     68 MiB |     68 MiB |     68 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 388061 KiB | 515130 KiB | 459346 GiB | 459346 GiB |
|       from large pool | 382655 KiB | 511457 KiB | 451801 GiB | 451801 GiB |
|       from small pool |   5406 KiB |  14352 KiB |   7544 GiB |   7544 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3508    |    8175    |  114125 K  |  114121 K  |
|       from large pool |     187    |     468    |   60100 K  |   60100 K  |
|       from small pool |    3321    |    7987    |   54024 K  |   54021 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3508    |    8175    |  114125 K  |  114121 K  |
|       from large pool |     187    |     468    |   60100 K  |   60100 K  |
|       from small pool |    3321    |    7987    |   54024 K  |   54021 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     200    |     200    |       0    |
|       from large pool |     166    |     166    |     166    |       0    |
|       from small pool |      34    |      34    |      34    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      72    |    3629    |   63280 K  |   63280 K  |
|       from large pool |      36    |     162    |   37196 K  |   37196 K  |
|       from small pool |      36    |    3593    |   26084 K  |   26084 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3601 MiB | 658116 GiB | 658116 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 650704 GiB | 650704 GiB |
|       from small pool |      0 KiB |     61 MiB |   7412 GiB |   7412 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3601 MiB | 658116 GiB | 658116 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 650704 GiB | 650704 GiB |
|       from small pool |      0 KiB |     61 MiB |   7412 GiB |   7412 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 657618 GiB | 657618 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 650218 GiB | 650218 GiB |
|       from small pool |      0 KiB |     60 MiB |   7400 GiB |   7400 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    826 MiB |   4020 MiB |   4020 MiB |   3194 MiB |
|       from large pool |    780 MiB |   3952 MiB |   3952 MiB |   3172 MiB |
|       from small pool |     46 MiB |     68 MiB |     68 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 515130 KiB | 459346 GiB | 459346 GiB |
|       from large pool |  24320 KiB | 511457 KiB | 451801 GiB | 451801 GiB |
|       from small pool |      0 KiB |  25318 KiB |   7545 GiB |   7545 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8175    |  114125 K  |  114125 K  |
|       from large pool |       2    |     468    |   60100 K  |   60100 K  |
|       from small pool |       0    |    7987    |   54024 K  |   54024 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8175    |  114125 K  |  114125 K  |
|       from large pool |       2    |     468    |   60100 K  |   60100 K  |
|       from small pool |       0    |    7987    |   54024 K  |   54024 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     200    |     200    |     141    |
|       from large pool |      36    |     166    |     166    |     130    |
|       from small pool |      23    |      34    |      34    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3629    |   63282 K  |   63282 K  |
|       from large pool |       3    |     162    |   37196 K  |   37196 K  |
|       from small pool |       0    |    3593    |   26085 K  |   26085 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3601 MiB | 658116 GiB | 658116 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 650704 GiB | 650704 GiB |
|       from small pool |      0 KiB |     61 MiB |   7412 GiB |   7412 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3601 MiB | 658116 GiB | 658116 GiB |
|       from large pool |  16640 KiB |   3568 MiB | 650704 GiB | 650704 GiB |
|       from small pool |      0 KiB |     61 MiB |   7412 GiB |   7412 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 657618 GiB | 657618 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 650218 GiB | 650218 GiB |
|       from small pool |      0 KiB |     60 MiB |   7400 GiB |   7400 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    826 MiB |   4020 MiB |   4020 MiB |   3194 MiB |
|       from large pool |    780 MiB |   3952 MiB |   3952 MiB |   3172 MiB |
|       from small pool |     46 MiB |     68 MiB |     68 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 515130 KiB | 459346 GiB | 459346 GiB |
|       from large pool |  24320 KiB | 511457 KiB | 451801 GiB | 451801 GiB |
|       from small pool |      0 KiB |  25318 KiB |   7545 GiB |   7545 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8175    |  114125 K  |  114125 K  |
|       from large pool |       2    |     468    |   60100 K  |   60100 K  |
|       from small pool |       0    |    7987    |   54024 K  |   54024 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8175    |  114125 K  |  114125 K  |
|       from large pool |       2    |     468    |   60100 K  |   60100 K  |
|       from small pool |       0    |    7987    |   54024 K  |   54024 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     200    |     200    |     141    |
|       from large pool |      36    |     166    |     166    |     130    |
|       from small pool |      23    |      34    |      34    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3629    |   63282 K  |   63282 K  |
|       from large pool |       3    |     162    |   37196 K  |   37196 K  |
|       from small pool |       0    |    3593    |   26085 K  |   26085 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_04_37_54_seed_1_23917129

 Experiment start at: 2024-08-01 04:37:54.751191
before training, model accuracy: 0.6890106797218323
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5003645, 'precision': 0.25018224, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33349526, 'auroc': 0.5, 'binary_precision': 0.5003645, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6669905}
confusion matrix:
   0      1
0  0  28787
1  0  28829
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 05:16:05.680603,epoch time: 0:38:10.929412,used: 0:38:10.929412,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_04_37_54_seed_1_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.5003645, 'precision': 0.25018224, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33349526, 'auroc': 0.5, 'binary_precision': 0.5003645, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6669905}
confusion matrix:
   0      1
0  0  28787
1  0  28829
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
early stop counter: 1
val acc:0.03591248765587807, best validation acc: 0.03591248765587807, corresponding to test acc:                         0.04189493879675865 / 0.04189493879675865
after epoch: 2,now: 2024-08-01 05:53:46.639536,epoch time: 0:37:40.958933,used: 1:15:51.888345,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_04_37_54_seed_1_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.5003818, 'precision': 0.2501909, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33350298, 'auroc': 0.5, 'binary_precision': 0.5003818, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66700596}
confusion matrix:
   0      1
0  0  28786
1  0  28830
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
early stop counter: 2
val acc:0.03591248765587807, best validation acc: 0.03591248765587807, corresponding to test acc:                         0.04189493879675865 / 0.04189493879675865
after epoch: 3,now: 2024-08-01 06:31:34.378735,epoch time: 0:37:47.739199,used: 1:53:39.627544,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_04_37_54_seed_1_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.5003818, 'precision': 0.2501909, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33350298, 'auroc': 0.5, 'binary_precision': 0.5003818, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66700596}
confusion matrix:
   0      1
0  0  28786
1  0  28830
---- Validation: 
scalar performance:
{'acc': 0.035912488, 'precision': 0.017956244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.034667492, 'auroc': 0.5, 'binary_precision': 0.035912488, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.069334984}
confusion matrix:
   0      1
0  0  18067
1  0    673
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
early stop counter: 3
val acc:0.03591248765587807, best validation acc: 0.03591248765587807, corresponding to test acc:                         0.04189493879675865 / 0.04189493879675865
after epoch: 4,now: 2024-08-01 07:09:05.946032,epoch time: 0:37:31.567297,used: 2:31:11.194841,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_04_37_54_seed_1_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:31:11.194841 at 2024-08-01 07:09:05.946032
persisted model performance metric: 

scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
oracle model performance metric: 

scalar performance:
{'acc': 0.04189494, 'precision': 0.02094747, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.04021033, 'auroc': 0.5, 'binary_precision': 0.04189494, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.08042066}
confusion matrix:
   0     1
0  0  5946
1  0   260
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 456444 KiB |   3601 MiB |    902 TiB |    902 TiB |
|       from large pool | 414759 KiB |   3568 MiB |    892 TiB |    892 TiB |
|       from small pool |  41685 KiB |     61 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 456444 KiB |   3601 MiB |    902 TiB |    902 TiB |
|       from large pool | 414759 KiB |   3568 MiB |    892 TiB |    892 TiB |
|       from small pool |  41685 KiB |     61 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447752 KiB |   3596 MiB |    901 TiB |    901 TiB |
|       from large pool | 407075 KiB |   3563 MiB |    891 TiB |    891 TiB |
|       from small pool |  40677 KiB |     60 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3998 MiB |   4020 MiB |   7192 MiB |   3194 MiB |
|       from large pool |   3934 MiB |   3952 MiB |   7106 MiB |   3172 MiB |
|       from small pool |     64 MiB |     68 MiB |     86 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 391427 KiB | 515130 KiB | 647431 GiB | 647431 GiB |
|       from large pool | 383961 KiB | 511457 KiB | 636810 GiB | 636809 GiB |
|       from small pool |   7466 KiB |  25318 KiB |  10621 GiB |  10621 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    3484    |    8207    |  160318 K  |  160314 K  |
|       from large pool |     187    |     468    |   84397 K  |   84397 K  |
|       from small pool |    3297    |    8019    |   75920 K  |   75917 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3484    |    8207    |  160318 K  |  160314 K  |
|       from large pool |     187    |     468    |   84397 K  |   84397 K  |
|       from small pool |    3297    |    8019    |   75920 K  |   75917 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     200    |     339    |     141    |
|       from large pool |     166    |     166    |     296    |     130    |
|       from small pool |      32    |      34    |      43    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      78    |    3642    |   89128 K  |   89128 K  |
|       from large pool |      37    |     163    |   52643 K  |   52643 K  |
|       from small pool |      41    |    3605    |   36484 K  |   36484 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3601 MiB |    902 TiB |    902 TiB |
|       from large pool |  16640 KiB |   3568 MiB |    892 TiB |    892 TiB |
|       from small pool |      0 KiB |     61 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3601 MiB |    902 TiB |    902 TiB |
|       from large pool |  16640 KiB |   3568 MiB |    892 TiB |    892 TiB |
|       from small pool |      0 KiB |     61 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |    901 TiB |    901 TiB |
|       from large pool |  16640 KiB |   3563 MiB |    891 TiB |    891 TiB |
|       from small pool |      0 KiB |     60 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    828 MiB |   4020 MiB |   7192 MiB |   6364 MiB |
|       from large pool |    780 MiB |   3952 MiB |   7106 MiB |   6326 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 515130 KiB | 647431 GiB | 647431 GiB |
|       from large pool |  24320 KiB | 511457 KiB | 636810 GiB | 636810 GiB |
|       from small pool |      0 KiB |  35594 KiB |  10621 GiB |  10621 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8207    |  160318 K  |  160318 K  |
|       from large pool |       2    |     468    |   84397 K  |   84397 K  |
|       from small pool |       0    |    8019    |   75920 K  |   75920 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8207    |  160318 K  |  160318 K  |
|       from large pool |       2    |     468    |   84397 K  |   84397 K  |
|       from small pool |       0    |    8019    |   75920 K  |   75920 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      60    |     200    |     339    |     279    |
|       from large pool |      36    |     166    |     296    |     260    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3642    |   89130 K  |   89130 K  |
|       from large pool |       3    |     163    |   52643 K  |   52643 K  |
|       from small pool |       0    |    3605    |   36486 K  |   36486 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3601 MiB |    902 TiB |    902 TiB |
|       from large pool |  16640 KiB |   3568 MiB |    892 TiB |    892 TiB |
|       from small pool |      0 KiB |     61 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3601 MiB |    902 TiB |    902 TiB |
|       from large pool |  16640 KiB |   3568 MiB |    892 TiB |    892 TiB |
|       from small pool |      0 KiB |     61 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |    901 TiB |    901 TiB |
|       from large pool |  16640 KiB |   3563 MiB |    891 TiB |    891 TiB |
|       from small pool |      0 KiB |     60 MiB |     10 TiB |     10 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    828 MiB |   4020 MiB |   7192 MiB |   6364 MiB |
|       from large pool |    780 MiB |   3952 MiB |   7106 MiB |   6326 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 515130 KiB | 647431 GiB | 647431 GiB |
|       from large pool |  24320 KiB | 511457 KiB | 636810 GiB | 636810 GiB |
|       from small pool |      0 KiB |  35594 KiB |  10621 GiB |  10621 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8207    |  160318 K  |  160318 K  |
|       from large pool |       2    |     468    |   84397 K  |   84397 K  |
|       from small pool |       0    |    8019    |   75920 K  |   75920 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8207    |  160318 K  |  160318 K  |
|       from large pool |       2    |     468    |   84397 K  |   84397 K  |
|       from small pool |       0    |    8019    |   75920 K  |   75920 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      60    |     200    |     339    |     279    |
|       from large pool |      36    |     166    |     296    |     260    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3642    |   89130 K  |   89130 K  |
|       from large pool |       3    |     163    |   52643 K  |   52643 K  |
|       from small pool |       0    |    3605    |   36486 K  |   36486 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_07_17_13_seed_2_23917129

 Experiment start at: 2024-08-01 07:17:14.188557
before training, model accuracy: 0.10803013294935226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.4998971, 'precision': 0.24994855, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3332876, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29146  0
1  29158  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-01 07:55:57.473982,epoch time: 0:38:43.285425,used: 0:38:43.285425,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_07_17_13_seed_2_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.4999314, 'precision': 0.2499657, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33330286, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29148  0
1  29156  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
early stop counter: 1
val acc:0.9679326415061951, best validation acc: 0.9679326415061951, corresponding to test acc:                         0.9612117409706116 / 0.9612117409706116
after epoch: 2,now: 2024-08-01 08:33:55.195184,epoch time: 0:37:57.721202,used: 1:16:41.006627,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_07_17_13_seed_2_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.4999314, 'precision': 0.2499657, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33330286, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29148  0
1  29156  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
early stop counter: 2
val acc:0.9679326415061951, best validation acc: 0.9679326415061951, corresponding to test acc:                         0.9612117409706116 / 0.9612117409706116
after epoch: 3,now: 2024-08-01 09:12:05.556756,epoch time: 0:38:10.361572,used: 1:54:51.368199,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_07_17_13_seed_2_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.49987993, 'precision': 0.24993996, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33327997, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  29145  0
1  29159  0
---- Validation: 
scalar performance:
{'acc': 0.96793264, 'precision': 0.48396632, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49185252, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
       0  1
0  18171  0
1    602  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
early stop counter: 3
val acc:0.9679326415061951, best validation acc: 0.9679326415061951, corresponding to test acc:                         0.9612117409706116 / 0.9612117409706116
after epoch: 4,now: 2024-08-01 09:50:17.809275,epoch time: 0:38:12.252519,used: 2:33:03.620718,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_08md_01_07_17_13_seed_2_23917129
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 2:33:03.620718 at 2024-08-01 09:50:17.809275
persisted model performance metric: 

scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
oracle model performance metric: 

scalar performance:
{'acc': 0.96121174, 'precision': 0.48060587, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.49011117, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   242  0
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-31_19-22-31/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 455554 KiB |   3601 MiB |   1165 TiB |   1165 TiB |
|       from large pool | 413863 KiB |   3568 MiB |   1151 TiB |   1151 TiB |
|       from small pool |  41691 KiB |     61 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 455554 KiB |   3601 MiB |   1165 TiB |   1165 TiB |
|       from large pool | 413863 KiB |   3568 MiB |   1151 TiB |   1151 TiB |
|       from small pool |  41691 KiB |     61 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447753 KiB |   3596 MiB |   1164 TiB |   1164 TiB |
|       from large pool | 407075 KiB |   3563 MiB |   1151 TiB |   1151 TiB |
|       from small pool |  40678 KiB |     60 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3998 MiB |   4020 MiB |  10362 MiB |   6364 MiB |
|       from large pool |   3934 MiB |   3952 MiB |  10260 MiB |   6326 MiB |
|       from small pool |     64 MiB |     68 MiB |    102 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 392317 KiB | 515130 KiB |    817 TiB |    817 TiB |
|       from large pool | 384857 KiB | 511457 KiB |    804 TiB |    804 TiB |
|       from small pool |   7460 KiB |  35594 KiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Allocations           |    3496    |    8293    |  207021 K  |  207017 K  |
|       from large pool |     187    |     468    |  108968 K  |  108968 K  |
|       from small pool |    3309    |    8105    |   98052 K  |   98049 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    3496    |    8293    |  207021 K  |  207017 K  |
|       from large pool |     187    |     468    |  108968 K  |  108968 K  |
|       from small pool |    3309    |    8105    |   98052 K  |   98049 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     200    |     477    |     279    |
|       from large pool |     166    |     166    |     426    |     260    |
|       from small pool |      32    |      34    |      51    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      77    |    3689    |  115271 K  |  115271 K  |
|       from large pool |      38    |     165    |   68401 K  |   68401 K  |
|       from small pool |      39    |    3651    |   46870 K  |   46870 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3601 MiB |   1165 TiB |   1165 TiB |
|       from large pool |  16640 KiB |   3568 MiB |   1151 TiB |   1151 TiB |
|       from small pool |      0 KiB |     61 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3601 MiB |   1165 TiB |   1165 TiB |
|       from large pool |  16640 KiB |   3568 MiB |   1151 TiB |   1151 TiB |
|       from small pool |      0 KiB |     61 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |   1164 TiB |   1164 TiB |
|       from large pool |  16640 KiB |   3563 MiB |   1151 TiB |   1151 TiB |
|       from small pool |      0 KiB |     60 MiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    828 MiB |   4020 MiB |  10362 MiB |   9534 MiB |
|       from large pool |    780 MiB |   3952 MiB |  10260 MiB |   9480 MiB |
|       from small pool |     48 MiB |     68 MiB |    102 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 515130 KiB |    818 TiB |    818 TiB |
|       from large pool |  24320 KiB | 511457 KiB |    804 TiB |    804 TiB |
|       from small pool |      0 KiB |  35594 KiB |     13 TiB |     13 TiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    8293    |  207021 K  |  207021 K  |
|       from large pool |       2    |     468    |  108968 K  |  108968 K  |
|       from small pool |       0    |    8105    |   98052 K  |   98052 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    8293    |  207021 K  |  207021 K  |
|       from large pool |       2    |     468    |  108968 K  |  108968 K  |
|       from small pool |       0    |    8105    |   98052 K  |   98052 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      60    |     200    |     477    |     417    |
|       from large pool |      36    |     166    |     426    |     390    |
|       from small pool |      24    |      34    |      51    |      27    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3689    |  115272 K  |  115272 K  |
|       from large pool |       3    |     165    |   68401 K  |   68401 K  |
|       from small pool |       0    |    3651    |   46871 K  |   46871 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Thu Aug  1 09:51:41 2024]
Finished job 0.
1 of 1 steps (100%) done
