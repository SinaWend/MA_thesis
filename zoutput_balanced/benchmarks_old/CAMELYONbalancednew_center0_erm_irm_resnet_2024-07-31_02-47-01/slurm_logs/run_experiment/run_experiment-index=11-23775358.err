Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jul 31 02:50:26 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_resnet_vit_2024-07-31_02-47-01/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_resnet_vit_2024-07-31_02-47-01/rule_results/11.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=11
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358

 Experiment start at: 2024-07-31 02:58:34.483436
before training, model accuracy: 0.923138439655304
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9860356, 'precision': 0.9861318, 'recall': 0.98603034, 'specificity': 0.98603034, 'f1': 0.98603475, 'auroc': 0.9991808, 'binary_precision': 0.979481, 'binary_recall': 0.9928925, 'binary_specificity': 0.9791681, 'binary_f1_score': 0.98614115}
confusion matrix:
       0      1
0  28061    597
1    204  28498
---- Validation: 
scalar performance:
{'acc': 0.9445509, 'precision': 0.66710603, 'recall': 0.82353234, 'specificity': 0.82353234, 'f1': 0.71599585, 'auroc': 0.9298352, 'binary_precision': 0.34546864, 'binary_recall': 0.69362366, 'binary_specificity': 0.95344096, 'binary_f1_score': 0.4612203}
confusion matrix:
       0    1
0  17304  845
1    197  446
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9365612, 'precision': 0.6637922, 'recall': 0.76900804, 'specificity': 0.76900804, 'f1': 0.7008352, 'auroc': 0.8971069, 'binary_precision': 0.34615386, 'binary_recall': 0.5862069, 'binary_specificity': 0.9518092, 'binary_f1_score': 0.4352774}
confusion matrix:
      0    1
0  5708  289
1   108  153
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-31 03:12:48.190045,epoch time: 0:14:13.706609,used: 0:14:13.706609,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9963215, 'precision': 0.99633193, 'recall': 0.99632335, 'specificity': 0.99632335, 'f1': 0.99632144, 'auroc': 0.9998815, 'binary_precision': 0.99880946, 'binary_recall': 0.9938332, 'binary_specificity': 0.99881357, 'binary_f1_score': 0.9963151}
confusion matrix:
       0      1
0  28624     34
1    177  28525
---- Validation: 
scalar performance:
{'acc': 0.9579076, 'precision': 0.6507081, 'recall': 0.6024305, 'specificity': 0.6024305, 'f1': 0.62126005, 'auroc': 0.91353756, 'binary_precision': 0.3287037, 'binary_recall': 0.22083981, 'binary_specificity': 0.9840212, 'binary_f1_score': 0.26418605}
confusion matrix:
       0    1
0  17859  290
1    501  142
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95669544, 'precision': 0.6404896, 'recall': 0.51565725, 'specificity': 0.51565725, 'f1': 0.5200598, 'auroc': 0.9326563, 'binary_precision': 0.32142857, 'binary_recall': 0.03448276, 'binary_specificity': 0.9968318, 'binary_f1_score': 0.06228374}
confusion matrix:
      0   1
0  5978  19
1   252   9
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-31 03:25:13.063512,epoch time: 0:12:24.873467,used: 0:26:38.580076,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9940202, 'precision': 0.9940752, 'recall': 0.9940242, 'specificity': 0.9940242, 'f1': 0.9940201, 'auroc': 0.99973845, 'binary_precision': 0.9994716, 'binary_recall': 0.9885718, 'binary_specificity': 0.9994766, 'binary_f1_score': 0.9939918}
confusion matrix:
       0      1
0  28644     15
1    328  28373
---- Validation: 
scalar performance:
{'acc': 0.96557045, 'precision': 0.7335643, 'recall': 0.6153983, 'specificity': 0.6153983, 'f1': 0.6524247, 'auroc': 0.9199623, 'binary_precision': 0.49358973, 'binary_recall': 0.23950233, 'binary_specificity': 0.99129426, 'binary_f1_score': 0.32251307}
confusion matrix:
       0    1
0  17991  158
1    489  154
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9579738, 'precision': 0.6459533, 'recall': 0.50349796, 'specificity': 0.50349796, 'f1': 0.4967551, 'auroc': 0.92952174, 'binary_precision': 0.33333334, 'binary_recall': 0.007662835, 'binary_specificity': 0.999333, 'binary_f1_score': 0.014981273}
confusion matrix:
      0  1
0  5993  4
1   259  2
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-31 03:37:37.970066,epoch time: 0:12:24.906554,used: 0:39:03.486630,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9943166, 'precision': 0.99436784, 'recall': 0.9943203, 'specificity': 0.9943203, 'f1': 0.99431646, 'auroc': 0.9997728, 'binary_precision': 0.99957746, 'binary_recall': 0.9890592, 'binary_specificity': 0.9995813, 'binary_f1_score': 0.99429053}
confusion matrix:
       0      1
0  28648     12
1    314  28386
---- Validation: 
scalar performance:
{'acc': 0.9641337, 'precision': 0.693372, 'recall': 0.55765027, 'specificity': 0.55765027, 'f1': 0.58480686, 'auroc': 0.92858446, 'binary_precision': 0.4171123, 'binary_recall': 0.121306375, 'binary_specificity': 0.9939942, 'binary_f1_score': 0.1879518}
confusion matrix:
       0    1
0  18040  109
1    565   78
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9576542, 'precision': 0.6914807, 'recall': 0.5198222, 'specificity': 0.5198222, 'f1': 0.52749264, 'auroc': 0.92950404, 'binary_precision': 0.42307693, 'binary_recall': 0.042145595, 'binary_specificity': 0.99749875, 'binary_f1_score': 0.07665505}
confusion matrix:
      0   1
0  5982  15
1   250  11
early stop counter: 1
val acc:0.9641336798667908, best validation acc: 0.9655704498291016, corresponding to test acc:                         0.9579737782478333 / 0.9579737782478333
after epoch: 4,now: 2024-07-31 03:49:55.942230,epoch time: 0:12:17.972164,used: 0:51:21.458794,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.99475247, 'precision': 0.99480265, 'recall': 0.9947561, 'specificity': 0.9947561, 'f1': 0.99475235, 'auroc': 0.9998641, 'binary_precision': 0.9999648, 'binary_recall': 0.989547, 'binary_specificity': 0.99996513, 'binary_f1_score': 0.9947286}
confusion matrix:
       0      1
0  28659      1
1    300  28400
---- Validation: 
scalar performance:
{'acc': 0.9661026, 'precision': 0.75010014, 'recall': 0.53766805, 'specificity': 0.53766805, 'f1': 0.55919874, 'auroc': 0.9178613, 'binary_precision': 0.5319149, 'binary_recall': 0.077760495, 'binary_specificity': 0.99757564, 'binary_f1_score': 0.1356852}
confusion matrix:
       0   1
0  18105  44
1    593  50
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9581336, 'precision': 0.47914335, 'recall': 0.4999166, 'specificity': 0.4999166, 'f1': 0.48930964, 'auroc': 0.9116584, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9998332, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5996  1
1   261  0
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-07-31 04:02:12.910073,epoch time: 0:12:16.967843,used: 1:03:38.426637,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.99574614, 'precision': 0.99574924, 'recall': 0.9957453, 'specificity': 0.9957453, 'f1': 0.99574614, 'auroc': 0.9998896, 'binary_precision': 0.9947158, 'binary_recall': 0.996795, 'binary_specificity': 0.99469554, 'binary_f1_score': 0.9957543}
confusion matrix:
       0      1
0  28503    152
1     92  28613
---- Validation: 
scalar performance:
{'acc': 0.96317583, 'precision': 0.7113659, 'recall': 0.65241134, 'specificity': 0.65241134, 'f1': 0.67654127, 'auroc': 0.93621516, 'binary_precision': 0.4466231, 'binary_recall': 0.31881803, 'binary_specificity': 0.9860047, 'binary_f1_score': 0.3720508}
confusion matrix:
       0    1
0  17895  254
1    438  205
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.97267497, 'precision': 0.91889864, 'recall': 0.70356345, 'specificity': 0.70356345, 'f1': 0.770874, 'auroc': 0.9514142, 'binary_precision': 0.86290324, 'binary_recall': 0.4099617, 'binary_specificity': 0.99716526, 'binary_f1_score': 0.5558442}
confusion matrix:
      0    1
0  5980   17
1   154  107
new oracle model saved
early stop counter: 1
val acc:0.9631758332252502, best validation acc: 0.9661026000976562, corresponding to test acc:                         0.9581335783004761 / 0.9726749658584595
after epoch: 6,now: 2024-07-31 04:14:30.943232,epoch time: 0:12:18.033159,used: 1:15:56.459796,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_31_02_58_34_seed_0_23775358
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
slurmstepd: error: *** JOB 23775358 ON supergpu18 CANCELLED AT 2024-07-31T04:14:39 ***
