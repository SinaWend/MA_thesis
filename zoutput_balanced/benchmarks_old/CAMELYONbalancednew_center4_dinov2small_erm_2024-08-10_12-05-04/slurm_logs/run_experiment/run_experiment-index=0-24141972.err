Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sun Aug 11 00:16:21 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972

 Experiment start at: 2024-08-11 00:23:27.519466
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.6631401777267456
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.952286, 'precision': 0.9535054, 'recall': 0.9523035, 'specificity': 0.9523035, 'f1': 0.95225525, 'auroc': 0.9860691, 'binary_precision': 0.9771895, 'binary_recall': 0.92625767, 'binary_specificity': 0.9783493, 'binary_f1_score': 0.9510422}
confusion matrix:
       0      1
0  24763    548
1   1869  23476
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.90242624, 'precision': 0.57675624, 'recall': 0.8137106, 'specificity': 0.8137106, 'f1': 0.6055366, 'auroc': 0.89009464, 'binary_precision': 0.16109914, 'binary_recall': 0.72048193, 'binary_specificity': 0.9069392, 'binary_f1_score': 0.26332012}
confusion matrix:
       0     1
0  15174  1557
1    116   299
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82895, 'precision': 0.61915785, 'recall': 0.7731303, 'specificity': 0.7731303, 'f1': 0.6437843, 'auroc': 0.8592086, 'binary_precision': 0.26634148, 'binary_recall': 0.7072539, 'binary_specificity': 0.83900666, 'binary_f1_score': 0.3869596}
confusion matrix:
      0     1
0  7838  1504
1   226   546
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-11 00:47:44.254488,epoch time: 0:24:16.735022,used: 0:24:16.735022,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96411085, 'precision': 0.96480906, 'recall': 0.96412474, 'specificity': 0.96412474, 'f1': 0.9640982, 'auroc': 0.99178934, 'binary_precision': 0.9830021, 'binary_recall': 0.94460666, 'binary_specificity': 0.9836428, 'binary_f1_score': 0.96342206}
confusion matrix:
       0      1
0  24896    414
1   1404  23942
---- Validation: 
scalar performance:
{'acc': 0.9113496, 'precision': 0.58425266, 'recall': 0.8194579, 'specificity': 0.8194579, 'f1': 0.61788636, 'auroc': 0.9044711, 'binary_precision': 0.17595308, 'binary_recall': 0.72289157, 'binary_specificity': 0.91602415, 'binary_f1_score': 0.28301886}
confusion matrix:
       0     1
0  15326  1405
1    115   300
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88659286, 'precision': 0.6613847, 'recall': 0.75858414, 'specificity': 0.75858414, 'f1': 0.69333005, 'auroc': 0.87139106, 'binary_precision': 0.35719725, 'binary_recall': 0.60751295, 'binary_specificity': 0.90965533, 'binary_f1_score': 0.4498801}
confusion matrix:
      0    1
0  8498  844
1   303  469
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-08-11 01:11:14.867798,epoch time: 0:23:30.613310,used: 0:47:47.348332,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97196776, 'precision': 0.97254395, 'recall': 0.9719789, 'specificity': 0.9719789, 'f1': 0.9719597, 'auroc': 0.9948942, 'binary_precision': 0.98920333, 'binary_recall': 0.9543876, 'binary_specificity': 0.98957014, 'binary_f1_score': 0.97148365}
confusion matrix:
       0      1
0  25048    264
1   1156  24188
---- Validation: 
scalar performance:
{'acc': 0.94319373, 'precision': 0.6164662, 'recall': 0.79230225, 'specificity': 0.79230225, 'f1': 0.66048217, 'auroc': 0.90837383, 'binary_precision': 0.24239631, 'binary_recall': 0.63373494, 'binary_specificity': 0.9508696, 'binary_f1_score': 0.35066667}
confusion matrix:
       0    1
0  15909  822
1    152  263
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9165513, 'precision': 0.6970542, 'recall': 0.66904306, 'specificity': 0.66904306, 'f1': 0.68162286, 'auroc': 0.8721689, 'binary_precision': 0.44495413, 'binary_recall': 0.376943, 'binary_specificity': 0.9611432, 'binary_f1_score': 0.40813464}
confusion matrix:
      0    1
0  8979  363
1   481  291
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-08-11 01:34:43.025626,epoch time: 0:23:28.157828,used: 1:11:15.506160,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97676486, 'precision': 0.9770617, 'recall': 0.9767723, 'specificity': 0.9767723, 'f1': 0.97676146, 'auroc': 0.9964509, 'binary_precision': 0.98911107, 'binary_recall': 0.9641716, 'binary_specificity': 0.989373, 'binary_f1_score': 0.9764821}
confusion matrix:
       0      1
0  25044    269
1    908  24435
---- Validation: 
scalar performance:
{'acc': 0.9270967, 'precision': 0.5987399, 'recall': 0.81695235, 'specificity': 0.81695235, 'f1': 0.63958836, 'auroc': 0.9097059, 'binary_precision': 0.20536344, 'binary_recall': 0.70120484, 'binary_specificity': 0.9326998, 'binary_f1_score': 0.3176856}
confusion matrix:
       0     1
0  15605  1126
1    124   291
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.91536486, 'precision': 0.7072187, 'recall': 0.73969847, 'specificity': 0.73969847, 'f1': 0.7218617, 'auroc': 0.87841773, 'binary_precision': 0.4536424, 'binary_recall': 0.53238344, 'binary_specificity': 0.9470135, 'binary_f1_score': 0.48986894}
confusion matrix:
      0    1
0  8847  495
1   361  411
early stop counter: 1
val acc:0.9270967245101929, best validation acc: 0.9431937336921692, corresponding to test acc:                         0.9165512919425964 / 0.9165512919425964
after epoch: 4,now: 2024-08-11 01:58:07.146891,epoch time: 0:23:24.121265,used: 1:34:39.627425,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9780085, 'precision': 0.9784672, 'recall': 0.9780159, 'specificity': 0.9780159, 'f1': 0.9780035, 'auroc': 0.9969921, 'binary_precision': 0.9934012, 'binary_recall': 0.96243095, 'binary_specificity': 0.9936009, 'binary_f1_score': 0.97767085}
confusion matrix:
       0      1
0  25154    162
1    952  24388
---- Validation: 
scalar performance:
{'acc': 0.95608306, 'precision': 0.6399121, 'recall': 0.7660086, 'specificity': 0.7660086, 'f1': 0.68076515, 'auroc': 0.9092883, 'binary_precision': 0.29084158, 'binary_recall': 0.56626505, 'binary_specificity': 0.9657522, 'binary_f1_score': 0.3843009}
confusion matrix:
       0    1
0  16158  573
1    180  235
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9232747, 'precision': 0.72558, 'recall': 0.7012016, 'specificity': 0.7012016, 'f1': 0.71248305, 'auroc': 0.87713647, 'binary_precision': 0.49706745, 'binary_recall': 0.43911916, 'binary_specificity': 0.9632841, 'binary_f1_score': 0.46629983}
confusion matrix:
      0    1
0  8999  343
1   433  339
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-08-11 02:21:40.865316,epoch time: 0:23:33.718425,used: 1:58:13.345850,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98144346, 'precision': 0.98168844, 'recall': 0.9814498, 'specificity': 0.9814498, 'f1': 0.98144126, 'auroc': 0.99754393, 'binary_precision': 0.992691, 'binary_recall': 0.97004974, 'binary_specificity': 0.9928498, 'binary_f1_score': 0.9812398}
confusion matrix:
       0      1
0  25133    181
1    759  24583
---- Validation: 
scalar performance:
{'acc': 0.95369184, 'precision': 0.6286502, 'recall': 0.7483343, 'specificity': 0.7483343, 'f1': 0.6667927, 'auroc': 0.8978192, 'binary_precision': 0.26918393, 'binary_recall': 0.5325301, 'binary_specificity': 0.96413845, 'binary_f1_score': 0.3576052}
confusion matrix:
       0    1
0  16131  600
1    194  221
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.92287916, 'precision': 0.72240585, 'recall': 0.68316317, 'specificity': 0.68316317, 'f1': 0.7003184, 'auroc': 0.86883307, 'binary_precision': 0.49361023, 'binary_recall': 0.40025908, 'binary_specificity': 0.9660672, 'binary_f1_score': 0.4420601}
confusion matrix:
      0    1
0  9025  317
1   463  309
early stop counter: 1
val acc:0.953691840171814, best validation acc: 0.9560830593109131, corresponding to test acc:                         0.9232746958732605 / 0.9232746958732605
after epoch: 6,now: 2024-08-11 02:44:50.183584,epoch time: 0:23:09.318268,used: 2:21:22.664118,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.98189753, 'precision': 0.98199415, 'recall': 0.98190117, 'specificity': 0.98190117, 'f1': 0.9818967, 'auroc': 0.9975307, 'binary_precision': 0.9889494, 'binary_recall': 0.97470504, 'binary_specificity': 0.98909736, 'binary_f1_score': 0.9817756}
confusion matrix:
       0      1
0  25039    276
1    641  24700
---- Validation: 
scalar performance:
{'acc': 0.94908434, 'precision': 0.6171192, 'recall': 0.74714833, 'specificity': 0.74714833, 'f1': 0.6553276, 'auroc': 0.8950325, 'binary_precision': 0.24611974, 'binary_recall': 0.53493977, 'binary_specificity': 0.9593569, 'binary_f1_score': 0.33712986}
confusion matrix:
       0    1
0  16051  680
1    193  222
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9195175, 'precision': 0.71650976, 'recall': 0.728281, 'specificity': 0.728281, 'f1': 0.72218806, 'auroc': 0.87516177, 'binary_precision': 0.47432762, 'binary_recall': 0.50259066, 'binary_specificity': 0.9539713, 'binary_f1_score': 0.4880503}
confusion matrix:
      0    1
0  8912  430
1   384  388
early stop counter: 2
val acc:0.9490843415260315, best validation acc: 0.9560830593109131, corresponding to test acc:                         0.9232746958732605 / 0.9232746958732605
after epoch: 7,now: 2024-08-11 03:08:27.384691,epoch time: 0:23:37.201107,used: 2:44:59.865225,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9840098, 'precision': 0.9841312, 'recall': 0.9840142, 'specificity': 0.9840142, 'f1': 0.9840089, 'auroc': 0.997734, 'binary_precision': 0.9919387, 'binary_recall': 0.9759687, 'binary_specificity': 0.9920597, 'binary_f1_score': 0.9838889}
confusion matrix:
       0      1
0  25113    201
1    609  24733
---- Validation: 
scalar performance:
{'acc': 0.95083404, 'precision': 0.623815, 'recall': 0.7574443, 'specificity': 0.7574443, 'f1': 0.6637387, 'auroc': 0.9014748, 'binary_precision': 0.259009, 'binary_recall': 0.55421686, 'binary_specificity': 0.9606718, 'binary_f1_score': 0.3530315}
confusion matrix:
       0    1
0  16073  658
1    185  230
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9188254, 'precision': 0.7169795, 'recall': 0.74573076, 'specificity': 0.74573076, 'f1': 0.7301588, 'auroc': 0.88223815, 'binary_precision': 0.47231638, 'binary_recall': 0.5414508, 'binary_specificity': 0.9500107, 'binary_f1_score': 0.50452626}
confusion matrix:
      0    1
0  8875  467
1   354  418
early stop counter: 3
val acc:0.9508340358734131, best validation acc: 0.9560830593109131, corresponding to test acc:                         0.9232746958732605 / 0.9232746958732605
after epoch: 8,now: 2024-08-11 03:31:52.959587,epoch time: 0:23:25.574896,used: 3:08:25.440121,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_00_23_27_seed_0_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 3:08:25.440121 at 2024-08-11 03:31:52.959587
persisted model performance metric: 

scalar performance:
{'acc': 0.9232747, 'precision': 0.72558, 'recall': 0.7012016, 'specificity': 0.7012016, 'f1': 0.71248305, 'auroc': 0.87713647, 'binary_precision': 0.49706745, 'binary_recall': 0.43911916, 'binary_specificity': 0.9632841, 'binary_f1_score': 0.46629983}
confusion matrix:
      0    1
0  8999  343
1   433  339
oracle model performance metric: 

scalar performance:
{'acc': 0.9232747, 'precision': 0.72558, 'recall': 0.7012016, 'specificity': 0.7012016, 'f1': 0.71248305, 'auroc': 0.87713647, 'binary_precision': 0.49706745, 'binary_recall': 0.43911916, 'binary_specificity': 0.9632841, 'binary_f1_score': 0.46629983}
confusion matrix:
      0    1
0  8999  343
1   433  339
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 198334 KiB |   1195 MiB | 239703 GiB | 239702 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 236402 GiB | 236402 GiB |
|       from small pool |  18214 KiB |     38 MiB |   3300 GiB |   3300 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 198334 KiB |   1195 MiB | 239703 GiB | 239702 GiB |
|       from large pool | 180120 KiB |   1178 MiB | 236402 GiB | 236402 GiB |
|       from small pool |  18214 KiB |     38 MiB |   3300 GiB |   3300 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195642 KiB |   1193 MiB | 239695 GiB | 239695 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 236401 GiB | 236401 GiB |
|       from small pool |  16663 KiB |     36 MiB |   3294 GiB |   3294 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1346 MiB |   1346 MiB |   1346 MiB |      0 B   |
|       from large pool |   1304 MiB |   1304 MiB |   1304 MiB |      0 B   |
|       from small pool |     42 MiB |     42 MiB |     42 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  63810 KiB | 168489 KiB | 120807 GiB | 120807 GiB |
|       from large pool |  51304 KiB | 166786 KiB | 117493 GiB | 117493 GiB |
|       from small pool |  12506 KiB |  13009 KiB |   3314 GiB |   3314 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4424    |    6807    |   41760 K  |   41755 K  |
|       from large pool |      79    |     167    |   22109 K  |   22109 K  |
|       from small pool |    4345    |    6727    |   19651 K  |   19646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4424    |    6807    |   41760 K  |   41755 K  |
|       from large pool |      79    |     167    |   22109 K  |   22109 K  |
|       from small pool |    4345    |    6727    |   19651 K  |   19646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      76    |      76    |      76    |       0    |
|       from large pool |      55    |      55    |      55    |       0    |
|       from small pool |      21    |      21    |      21    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3186    |   23996 K  |   23996 K  |
|       from large pool |       9    |      57    |   15584 K  |   15584 K  |
|       from small pool |      23    |    3177    |    8411 K  |    8411 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 239703 GiB | 239703 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 236402 GiB | 236402 GiB |
|       from small pool |      0 KiB |     38 MiB |   3300 GiB |   3300 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 239703 GiB | 239703 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 236402 GiB | 236402 GiB |
|       from small pool |      0 KiB |     38 MiB |   3300 GiB |   3300 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 239695 GiB | 239695 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 236401 GiB | 236401 GiB |
|       from small pool |      0 KiB |     36 MiB |   3294 GiB |   3294 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   1346 MiB |   1346 MiB |   1090 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 120807 GiB | 120807 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 117493 GiB | 117493 GiB |
|       from small pool |      0 KiB |  23712 KiB |   3314 GiB |   3314 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   41760 K  |   41760 K  |
|       from large pool |       2    |     167    |   22109 K  |   22109 K  |
|       from small pool |       0    |    6727    |   19651 K  |   19651 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   41760 K  |   41760 K  |
|       from large pool |       2    |     167    |   22109 K  |   22109 K  |
|       from small pool |       0    |    6727    |   19651 K  |   19651 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |      76    |      76    |      50    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3186    |   23998 K  |   23998 K  |
|       from large pool |       3    |      57    |   15584 K  |   15584 K  |
|       from small pool |       0    |    3177    |    8413 K  |    8413 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 239703 GiB | 239703 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 236402 GiB | 236402 GiB |
|       from small pool |      0 KiB |     38 MiB |   3300 GiB |   3300 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 239703 GiB | 239703 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 236402 GiB | 236402 GiB |
|       from small pool |      0 KiB |     38 MiB |   3300 GiB |   3300 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 239695 GiB | 239695 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 236401 GiB | 236401 GiB |
|       from small pool |      0 KiB |     36 MiB |   3294 GiB |   3294 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 262144 KiB |   1346 MiB |   1346 MiB |   1090 MiB |
|       from large pool | 231424 KiB |   1304 MiB |   1304 MiB |   1078 MiB |
|       from small pool |  30720 KiB |     42 MiB |     42 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 120807 GiB | 120807 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 117493 GiB | 117493 GiB |
|       from small pool |      0 KiB |  23712 KiB |   3314 GiB |   3314 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6807    |   41760 K  |   41760 K  |
|       from large pool |       2    |     167    |   22109 K  |   22109 K  |
|       from small pool |       0    |    6727    |   19651 K  |   19651 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6807    |   41760 K  |   41760 K  |
|       from large pool |       2    |     167    |   22109 K  |   22109 K  |
|       from small pool |       0    |    6727    |   19651 K  |   19651 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      26    |      76    |      76    |      50    |
|       from large pool |      11    |      55    |      55    |      44    |
|       from small pool |      15    |      21    |      21    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3186    |   23998 K  |   23998 K  |
|       from large pool |       3    |      57    |   15584 K  |   15584 K  |
|       from small pool |       0    |    3177    |    8413 K  |    8413 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_03_41_22_seed_1_24141972

 Experiment start at: 2024-08-11 03:41:22.872356
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.5408779978752136
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9463724, 'precision': 0.9484048, 'recall': 0.946399, 'specificity': 0.946399, 'f1': 0.94631374, 'auroc': 0.98579574, 'binary_precision': 0.9787907, 'binary_recall': 0.9126042, 'binary_specificity': 0.98019373, 'binary_f1_score': 0.9445394}
confusion matrix:
       0      1
0  24893    503
1   2223  23213
---- Validation: 
scalar performance:
{'acc': 0.939555, 'precision': 0.6015269, 'recall': 0.7407092, 'specificity': 0.7407092, 'f1': 0.6375823, 'auroc': 0.8685188, 'binary_precision': 0.21563089, 'binary_recall': 0.5313225, 'binary_specificity': 0.95009583, 'binary_f1_score': 0.3067649}
confusion matrix:
       0    1
0  15859  833
1    202  229
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8686949, 'precision': 0.6367599, 'recall': 0.74694264, 'specificity': 0.74694264, 'f1': 0.6671865, 'auroc': 0.8643991, 'binary_precision': 0.30836707, 'binary_recall': 0.6036988, 'binary_specificity': 0.8901864, 'binary_f1_score': 0.40821797}
confusion matrix:
      0     1
0  8309  1025
1   300   457
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-11 04:05:35.153184,epoch time: 0:24:12.280828,used: 0:24:12.280828,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_03_41_22_seed_1_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96154, 'precision': 0.96197754, 'recall': 0.9615516, 'specificity': 0.9615516, 'f1': 0.9615315, 'auroc': 0.9917873, 'binary_precision': 0.9763837, 'binary_recall': 0.9460193, 'binary_specificity': 0.9770839, 'binary_f1_score': 0.9609617}
confusion matrix:
       0      1
0  24815    582
1   1373  24062
---- Validation: 
scalar performance:
{'acc': 0.9313204, 'precision': 0.6009962, 'recall': 0.78734183, 'specificity': 0.78734183, 'f1': 0.6408527, 'auroc': 0.8826654, 'binary_precision': 0.21191029, 'binary_recall': 0.63573086, 'binary_specificity': 0.9389528, 'binary_f1_score': 0.31786543}
confusion matrix:
       0     1
0  15673  1019
1    157   274
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8519473, 'precision': 0.6465034, 'recall': 0.8295368, 'specificity': 0.8295368, 'f1': 0.6816001, 'auroc': 0.892915, 'binary_precision': 0.31131592, 'binary_recall': 0.8031704, 'binary_specificity': 0.85590315, 'binary_f1_score': 0.44870847}
confusion matrix:
      0     1
0  7989  1345
1   149   608
early stop counter: 1
val acc:0.9313204288482666, best validation acc: 0.9395549893379211, corresponding to test acc:                         0.8686949014663696 / 0.8686949014663696
after epoch: 2,now: 2024-08-11 04:29:16.015588,epoch time: 0:23:40.862404,used: 0:47:53.143232,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_03_41_22_seed_1_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9698812, 'precision': 0.9703362, 'recall': 0.9698923, 'specificity': 0.9698923, 'f1': 0.9698744, 'auroc': 0.99474907, 'binary_precision': 0.98514307, 'binary_recall': 0.9541952, 'binary_specificity': 0.98558944, 'binary_f1_score': 0.9694222}
confusion matrix:
       0      1
0  25032    366
1   1165  24269
---- Validation: 
scalar performance:
{'acc': 0.92997724, 'precision': 0.605255, 'recall': 0.81490636, 'specificity': 0.81490636, 'f1': 0.6479133, 'auroc': 0.8885168, 'binary_precision': 0.21888727, 'binary_recall': 0.6937355, 'binary_specificity': 0.9360772, 'binary_f1_score': 0.33277684}
confusion matrix:
       0     1
0  15625  1067
1    132   299
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84134376, 'precision': 0.6434707, 'recall': 0.8438339, 'specificity': 0.8438339, 'f1': 0.67606354, 'auroc': 0.89895546, 'binary_precision': 0.30150518, 'binary_recall': 0.84676355, 'binary_specificity': 0.84090424, 'binary_f1_score': 0.44467568}
confusion matrix:
      0     1
0  7849  1485
1   116   641
early stop counter: 2
val acc:0.9299772381782532, best validation acc: 0.9395549893379211, corresponding to test acc:                         0.8686949014663696 / 0.8686949014663696
after epoch: 3,now: 2024-08-11 04:52:53.444101,epoch time: 0:23:37.428513,used: 1:11:30.571745,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_03_41_22_seed_1_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9733632, 'precision': 0.9736993, 'recall': 0.9733733, 'specificity': 0.9733733, 'f1': 0.97335887, 'auroc': 0.9953966, 'binary_precision': 0.9865045, 'binary_recall': 0.95989776, 'binary_specificity': 0.98684883, 'binary_f1_score': 0.97301924}
confusion matrix:
       0      1
0  25063    334
1   1020  24415
---- Validation: 
scalar performance:
{'acc': 0.92548037, 'precision': 0.60216624, 'recall': 0.8261615, 'specificity': 0.8261615, 'f1': 0.6441337, 'auroc': 0.8933854, 'binary_precision': 0.21199727, 'binary_recall': 0.7215777, 'binary_specificity': 0.93074524, 'binary_f1_score': 0.32771337}
confusion matrix:
       0     1
0  15536  1156
1    120   311
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8392627, 'precision': 0.6413561, 'recall': 0.84028125, 'specificity': 0.84028125, 'f1': 0.673042, 'auroc': 0.90122277, 'binary_precision': 0.29780272, 'binary_recall': 0.84147954, 'binary_specificity': 0.8390829, 'binary_f1_score': 0.43991712}
confusion matrix:
      0     1
0  7832  1502
1   120   637
early stop counter: 3
val acc:0.9254803657531738, best validation acc: 0.9395549893379211, corresponding to test acc:                         0.8686949014663696 / 0.8686949014663696
after epoch: 4,now: 2024-08-11 05:16:31.012602,epoch time: 0:23:37.568501,used: 1:35:08.140246,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_03_41_22_seed_1_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:35:08.140246 at 2024-08-11 05:16:31.012602
persisted model performance metric: 

scalar performance:
{'acc': 0.8686949, 'precision': 0.6367599, 'recall': 0.74694264, 'specificity': 0.74694264, 'f1': 0.6671865, 'auroc': 0.8643991, 'binary_precision': 0.30836707, 'binary_recall': 0.6036988, 'binary_specificity': 0.8901864, 'binary_f1_score': 0.40821797}
confusion matrix:
      0     1
0  8309  1025
1   300   457
oracle model performance metric: 

scalar performance:
{'acc': 0.8686949, 'precision': 0.6367599, 'recall': 0.74694264, 'specificity': 0.74694264, 'f1': 0.6671865, 'auroc': 0.8643991, 'binary_precision': 0.30836707, 'binary_recall': 0.6036988, 'binary_specificity': 0.8901864, 'binary_f1_score': 0.40821797}
confusion matrix:
      0     1
0  8309  1025
1   300   457
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197423 KiB |   1195 MiB | 362157 GiB | 362157 GiB |
|       from large pool | 179215 KiB |   1178 MiB | 357156 GiB | 357156 GiB |
|       from small pool |  18208 KiB |     38 MiB |   5001 GiB |   5001 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197423 KiB |   1195 MiB | 362157 GiB | 362157 GiB |
|       from large pool | 179215 KiB |   1178 MiB | 357156 GiB | 357156 GiB |
|       from small pool |  18208 KiB |     38 MiB |   5001 GiB |   5001 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   1193 MiB | 362146 GiB | 362145 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 357154 GiB | 357154 GiB |
|       from small pool |  16662 KiB |     36 MiB |   4991 GiB |   4991 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1336 MiB |   1346 MiB |   2426 MiB |   1090 MiB |
|       from large pool |   1298 MiB |   1304 MiB |   2376 MiB |   1078 MiB |
|       from small pool |     38 MiB |     42 MiB |     50 MiB |     12 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  48336 KiB | 168489 KiB | 187514 GiB | 187514 GiB |
|       from large pool |  37872 KiB | 166786 KiB | 182442 GiB | 182442 GiB |
|       from small pool |  10464 KiB |  23712 KiB |   5071 GiB |   5071 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6829    |   63195 K  |   63191 K  |
|       from large pool |      79    |     167    |   33413 K  |   33413 K  |
|       from small pool |    4333    |    6749    |   29781 K  |   29777 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6829    |   63195 K  |   63191 K  |
|       from large pool |      79    |     167    |   33413 K  |   33413 K  |
|       from small pool |    4333    |    6749    |   29781 K  |   29777 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      74    |      76    |     124    |      50    |
|       from large pool |      55    |      55    |      99    |      44    |
|       from small pool |      19    |      21    |      25    |       6    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3196    |   37949 K  |   37949 K  |
|       from large pool |      11    |      58    |   23975 K  |   23975 K  |
|       from small pool |      21    |    3185    |   13974 K  |   13974 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 362157 GiB | 362157 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 357156 GiB | 357156 GiB |
|       from small pool |      0 KiB |     38 MiB |   5001 GiB |   5001 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 362157 GiB | 362157 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 357156 GiB | 357156 GiB |
|       from small pool |      0 KiB |     38 MiB |   5001 GiB |   5001 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 362146 GiB | 362145 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 357154 GiB | 357154 GiB |
|       from small pool |      0 KiB |     36 MiB |   4991 GiB |   4991 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 245760 KiB |   1346 MiB |   2426 MiB |   2186 MiB |
|       from large pool | 217088 KiB |   1304 MiB |   2376 MiB |   2164 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 187514 GiB | 187514 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 182443 GiB | 182443 GiB |
|       from small pool |      0 KiB |  25471 KiB |   5071 GiB |   5071 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |   63195 K  |   63195 K  |
|       from large pool |       2    |     167    |   33413 K  |   33413 K  |
|       from small pool |       0    |    6749    |   29781 K  |   29781 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |   63195 K  |   63195 K  |
|       from large pool |       2    |     167    |   33413 K  |   33413 K  |
|       from small pool |       0    |    6749    |   29781 K  |   29781 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     124    |     100    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3196    |   37951 K  |   37951 K  |
|       from large pool |       3    |      58    |   23975 K  |   23975 K  |
|       from small pool |       0    |    3185    |   13976 K  |   13976 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 362157 GiB | 362157 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 357156 GiB | 357156 GiB |
|       from small pool |      0 KiB |     38 MiB |   5001 GiB |   5001 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 362157 GiB | 362157 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 357156 GiB | 357156 GiB |
|       from small pool |      0 KiB |     38 MiB |   5001 GiB |   5001 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 362146 GiB | 362145 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 357154 GiB | 357154 GiB |
|       from small pool |      0 KiB |     36 MiB |   4991 GiB |   4991 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 245760 KiB |   1346 MiB |   2426 MiB |   2186 MiB |
|       from large pool | 217088 KiB |   1304 MiB |   2376 MiB |   2164 MiB |
|       from small pool |  28672 KiB |     42 MiB |     50 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 187514 GiB | 187514 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 182443 GiB | 182443 GiB |
|       from small pool |      0 KiB |  25471 KiB |   5071 GiB |   5071 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6829    |   63195 K  |   63195 K  |
|       from large pool |       2    |     167    |   33413 K  |   33413 K  |
|       from small pool |       0    |    6749    |   29781 K  |   29781 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6829    |   63195 K  |   63195 K  |
|       from large pool |       2    |     167    |   33413 K  |   33413 K  |
|       from small pool |       0    |    6749    |   29781 K  |   29781 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     124    |     100    |
|       from large pool |      10    |      55    |      99    |      89    |
|       from small pool |      14    |      21    |      25    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3196    |   37951 K  |   37951 K  |
|       from large pool |       3    |      58    |   23975 K  |   23975 K  |
|       from small pool |       0    |    3185    |   13976 K  |   13976 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_05_26_31_seed_2_24141972

 Experiment start at: 2024-08-11 05:26:31.816661
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.8581054210662842
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9475975, 'precision': 0.9491287, 'recall': 0.94760203, 'specificity': 0.94760203, 'f1': 0.9475532, 'auroc': 0.98593783, 'binary_precision': 0.9753913, 'binary_recall': 0.9183816, 'binary_specificity': 0.9768225, 'binary_f1_score': 0.94602835}
confusion matrix:
       0      1
0  25245    599
1   2110  23742
---- Validation: 
scalar performance:
{'acc': 0.93325156, 'precision': 0.585501, 'recall': 0.72437847, 'specificity': 0.72437847, 'f1': 0.6173381, 'auroc': 0.83921194, 'binary_precision': 0.18395816, 'binary_recall': 0.5047847, 'binary_specificity': 0.94397223, 'binary_f1_score': 0.26964855}
confusion matrix:
       0    1
0  15770  936
1    207  211
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8916964, 'precision': 0.6660968, 'recall': 0.73300254, 'specificity': 0.73300254, 'f1': 0.6913261, 'auroc': 0.86462796, 'binary_precision': 0.37285224, 'binary_recall': 0.544542, 'binary_specificity': 0.92146313, 'binary_f1_score': 0.44263127}
confusion matrix:
      0    1
0  8565  730
1   363  434
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-08-11 05:52:28.000061,epoch time: 0:25:56.183400,used: 0:25:56.183400,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_05_26_31_seed_2_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96402043, 'precision': 0.96454036, 'recall': 0.96402496, 'specificity': 0.96402496, 'f1': 0.9640106, 'auroc': 0.9919838, 'binary_precision': 0.9801497, 'binary_recall': 0.9472442, 'binary_specificity': 0.9808057, 'binary_f1_score': 0.96341604}
confusion matrix:
       0      1
0  25345    496
1   1364  24491
---- Validation: 
scalar performance:
{'acc': 0.9174842, 'precision': 0.5779832, 'recall': 0.76061475, 'specificity': 0.76061475, 'f1': 0.60845023, 'auroc': 0.8478116, 'binary_precision': 0.1667783, 'binary_recall': 0.59569377, 'binary_specificity': 0.92553574, 'binary_f1_score': 0.26059654}
confusion matrix:
       0     1
0  15462  1244
1    169   249
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89962345, 'precision': 0.6782971, 'recall': 0.7304233, 'specificity': 0.7304233, 'f1': 0.6996114, 'auroc': 0.8771558, 'binary_precision': 0.39811322, 'binary_recall': 0.5294856, 'binary_specificity': 0.93136096, 'binary_f1_score': 0.4544965}
confusion matrix:
      0    1
0  8657  638
1   375  422
new oracle model saved
early stop counter: 1
val acc:0.9174842238426208, best validation acc: 0.9332515597343445, corresponding to test acc:                         0.8916963934898376 / 0.899623453617096
after epoch: 2,now: 2024-08-11 06:16:36.540323,epoch time: 0:24:08.540262,used: 0:50:04.723662,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_05_26_31_seed_2_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9708295, 'precision': 0.97114515, 'recall': 0.97083044, 'specificity': 0.97083044, 'f1': 0.9708246, 'auroc': 0.9947759, 'binary_precision': 0.9833598, 'binary_recall': 0.95787233, 'binary_specificity': 0.9837886, 'binary_f1_score': 0.97044873}
confusion matrix:
       0      1
0  25427    419
1   1089  24761
---- Validation: 
scalar performance:
{'acc': 0.9163163, 'precision': 0.578132, 'recall': 0.7658474, 'specificity': 0.7658474, 'f1': 0.6086825, 'auroc': 0.85555923, 'binary_precision': 0.1667761, 'binary_recall': 0.6076555, 'binary_specificity': 0.92403924, 'binary_f1_score': 0.26172078}
confusion matrix:
       0     1
0  15437  1269
1    164   254
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.90200156, 'precision': 0.68896836, 'recall': 0.7575245, 'specificity': 0.7575245, 'f1': 0.7157701, 'auroc': 0.8852484, 'binary_precision': 0.41474244, 'binary_recall': 0.5859473, 'binary_specificity': 0.92910165, 'binary_f1_score': 0.4856994}
confusion matrix:
      0    1
0  8636  659
1   330  467
new oracle model saved
early stop counter: 2
val acc:0.9163162708282471, best validation acc: 0.9332515597343445, corresponding to test acc:                         0.8916963934898376 / 0.9020015597343445
after epoch: 3,now: 2024-08-11 06:40:35.777945,epoch time: 0:23:59.237622,used: 1:14:03.961284,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_05_26_31_seed_2_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9745435, 'precision': 0.97475815, 'recall': 0.97454554, 'specificity': 0.97454554, 'f1': 0.97454065, 'auroc': 0.99584424, 'binary_precision': 0.9849018, 'binary_recall': 0.9638727, 'binary_specificity': 0.9852184, 'binary_f1_score': 0.97427374}
confusion matrix:
       0      1
0  25461    382
1    934  24919
---- Validation: 
scalar performance:
{'acc': 0.92577666, 'precision': 0.58599955, 'recall': 0.761366, 'specificity': 0.761366, 'f1': 0.619972, 'auroc': 0.86120266, 'binary_precision': 0.18289962, 'binary_recall': 0.5885168, 'binary_specificity': 0.93421525, 'binary_f1_score': 0.27906975}
confusion matrix:
       0     1
0  15607  1099
1    172   246
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9049742, 'precision': 0.69704175, 'recall': 0.7706095, 'specificity': 0.7706095, 'f1': 0.7256674, 'auroc': 0.89045835, 'binary_precision': 0.42869717, 'binary_recall': 0.6110414, 'binary_specificity': 0.9301775, 'binary_f1_score': 0.5038799}
confusion matrix:
      0    1
0  8646  649
1   310  487
new oracle model saved
early stop counter: 3
val acc:0.9257766604423523, best validation acc: 0.9332515597343445, corresponding to test acc:                         0.8916963934898376 / 0.9049742221832275
after epoch: 4,now: 2024-08-11 07:04:07.502680,epoch time: 0:23:31.724735,used: 1:37:35.686019,model: dset_te_center4_erm_b8efecac6_not_commited_2024md_08md_11_05_26_31_seed_2_24141972
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 4 with time: 1:37:35.686019 at 2024-08-11 07:04:07.502680
persisted model performance metric: 

scalar performance:
{'acc': 0.8916964, 'precision': 0.6660968, 'recall': 0.73300254, 'specificity': 0.73300254, 'f1': 0.6913261, 'auroc': 0.86462796, 'binary_precision': 0.37285224, 'binary_recall': 0.544542, 'binary_specificity': 0.92146313, 'binary_f1_score': 0.44263127}
confusion matrix:
      0    1
0  8565  730
1   363  434
oracle model performance metric: 

scalar performance:
{'acc': 0.9049742, 'precision': 0.69704175, 'recall': 0.7706095, 'specificity': 0.7706095, 'f1': 0.7256674, 'auroc': 0.89045835, 'binary_precision': 0.42869717, 'binary_recall': 0.6110414, 'binary_specificity': 0.9301775, 'binary_f1_score': 0.5038799}
confusion matrix:
      0    1
0  8646  649
1   310  487
results aggregation path: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalancednew_center4_dinov2small_erm_2024-08-10_12-05-04/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 197419 KiB |   1195 MiB | 486343 GiB | 486343 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 479620 GiB | 479620 GiB |
|       from small pool |  18208 KiB |     38 MiB |   6722 GiB |   6722 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 197419 KiB |   1195 MiB | 486343 GiB | 486343 GiB |
|       from large pool | 179211 KiB |   1178 MiB | 479620 GiB | 479620 GiB |
|       from small pool |  18208 KiB |     38 MiB |   6722 GiB |   6722 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 195641 KiB |   1193 MiB | 486322 GiB | 486322 GiB |
|       from large pool | 178979 KiB |   1176 MiB | 479613 GiB | 479613 GiB |
|       from small pool |  16662 KiB |     36 MiB |   6709 GiB |   6709 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1328 MiB |   1346 MiB |   3514 MiB |   2186 MiB |
|       from large pool |   1290 MiB |   1304 MiB |   3454 MiB |   2164 MiB |
|       from small pool |     38 MiB |     42 MiB |     60 MiB |     22 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  42197 KiB | 168489 KiB | 260161 GiB | 260160 GiB |
|       from large pool |  31733 KiB | 166786 KiB | 253309 GiB | 253309 GiB |
|       from small pool |  10464 KiB |  25471 KiB |   6851 GiB |   6851 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    4412    |    6937    |   84906 K  |   84901 K  |
|       from large pool |      79    |     167    |   44876 K  |   44876 K  |
|       from small pool |    4333    |    6857    |   40029 K  |   40025 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    4412    |    6937    |   84906 K  |   84901 K  |
|       from large pool |      79    |     167    |   44876 K  |   44876 K  |
|       from small pool |    4333    |    6857    |   40029 K  |   40025 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      73    |      76    |     173    |     100    |
|       from large pool |      54    |      55    |     143    |      89    |
|       from small pool |      19    |      21    |      30    |      11    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      32    |    3250    |   51451 K  |   51451 K  |
|       from large pool |      11    |      58    |   31853 K  |   31853 K  |
|       from small pool |      21    |    3239    |   19597 K  |   19597 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   1195 MiB | 486343 GiB | 486343 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 479620 GiB | 479620 GiB |
|       from small pool |      0 KiB |     38 MiB |   6722 GiB |   6722 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   1195 MiB | 486343 GiB | 486343 GiB |
|       from large pool |  16640 KiB |   1178 MiB | 479620 GiB | 479620 GiB |
|       from small pool |      0 KiB |     38 MiB |   6722 GiB |   6722 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1193 MiB | 486322 GiB | 486322 GiB |
|       from large pool |  16640 KiB |   1176 MiB | 479613 GiB | 479613 GiB |
|       from small pool |      0 KiB |     36 MiB |   6709 GiB |   6709 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 239616 KiB |   1346 MiB |   3514 MiB |   3280 MiB |
|       from large pool | 210944 KiB |   1304 MiB |   3454 MiB |   3248 MiB |
|       from small pool |  28672 KiB |     42 MiB |     60 MiB |     32 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  30464 KiB | 168489 KiB | 260161 GiB | 260161 GiB |
|       from large pool |  30464 KiB | 166786 KiB | 253309 GiB | 253309 GiB |
|       from small pool |      0 KiB |  25471 KiB |   6851 GiB |   6851 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    6937    |   84906 K  |   84906 K  |
|       from large pool |       2    |     167    |   44876 K  |   44876 K  |
|       from small pool |       0    |    6857    |   40029 K  |   40029 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    6937    |   84906 K  |   84906 K  |
|       from large pool |       2    |     167    |   44876 K  |   44876 K  |
|       from small pool |       0    |    6857    |   40029 K  |   40029 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      24    |      76    |     173    |     149    |
|       from large pool |      10    |      55    |     143    |     133    |
|       from small pool |      14    |      21    |      30    |      16    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |    3250    |   51453 K  |   51453 K  |
|       from large pool |       3    |      58    |   31853 K  |   31853 K  |
|       from small pool |       0    |    3239    |   19599 K  |   19599 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sun Aug 11 07:06:11 2024]
Finished job 0.
1 of 1 steps (100%) done
