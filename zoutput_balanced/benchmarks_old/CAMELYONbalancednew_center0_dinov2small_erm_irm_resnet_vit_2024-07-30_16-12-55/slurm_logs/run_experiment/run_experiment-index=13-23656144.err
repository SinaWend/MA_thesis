Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Tue Jul 30 19:55:40 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_resnet_vit_2024-07-30_16-12-55/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalancednew_center0_dinov2small_erm_irm_resnet_vit_2024-07-30_16-12-55/rule_results/13.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=13
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144

 Experiment start at: 2024-07-30 20:31:07.601996
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.9563758969306946
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.98091006, 'precision': 0.98124576, 'recall': 0.98090005, 'specificity': 0.98090005, 'f1': 0.98090637, 'auroc': 0.99895895, 'binary_precision': 0.9687256, 'binary_recall': 0.99393773, 'binary_specificity': 0.96786237, 'binary_f1_score': 0.9811697}
confusion matrix:
       0      1
0  27737    921
1    174  28528
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.82396764, 'precision': 0.5747032, 'recall': 0.8676125, 'specificity': 0.8676125, 'f1': 0.5811631, 'auroc': 0.9327074, 'binary_precision': 0.15308513, 'binary_recall': 0.91446346, 'binary_specificity': 0.8207615, 'binary_f1_score': 0.26226583}
confusion matrix:
       0     1
0  14896  3253
1     55   588
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83013743, 'precision': 0.5859059, 'recall': 0.843576, 'specificity': 0.843576, 'f1': 0.59994996, 'auroc': 0.9232125, 'binary_precision': 0.1792, 'binary_recall': 0.85823756, 'binary_specificity': 0.82891446, 'binary_f1_score': 0.29649237}
confusion matrix:
      0     1
0  4971  1026
1    37   224
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-30 21:32:46.446783,epoch time: 1:01:38.844787,used: 1:01:38.844787,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.99321824, 'precision': 0.9932585, 'recall': 0.99322224, 'specificity': 0.99322224, 'f1': 0.9932182, 'auroc': 0.999658, 'binary_precision': 0.9979249, 'binary_recall': 0.98850334, 'binary_specificity': 0.9979411, 'binary_f1_score': 0.9931918}
confusion matrix:
       0      1
0  28597     59
1    330  28374
---- Validation: 
scalar performance:
{'acc': 0.9673265, 'precision': 0.75268644, 'recall': 0.76856863, 'specificity': 0.76856863, 'f1': 0.76035774, 'auroc': 0.9365667, 'binary_precision': 0.5211679, 'binary_recall': 0.55520993, 'binary_specificity': 0.9819274, 'binary_f1_score': 0.5376505}
confusion matrix:
       0    1
0  17821  328
1    286  357
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9694791, 'precision': 0.8474039, 'recall': 0.71655464, 'specificity': 0.71655464, 'f1': 0.7652633, 'auroc': 0.93580246, 'binary_precision': 0.71875, 'binary_recall': 0.44061303, 'binary_specificity': 0.99249625, 'binary_f1_score': 0.5463183}
confusion matrix:
      0    1
0  5952   45
1   146  115
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-30 22:31:54.181827,epoch time: 0:59:07.735044,used: 2:00:46.579831,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9944909, 'precision': 0.99450755, 'recall': 0.99448895, 'specificity': 0.99448895, 'f1': 0.99449086, 'auroc': 0.9998379, 'binary_precision': 0.99182177, 'binary_recall': 0.99721265, 'binary_specificity': 0.99176526, 'binary_f1_score': 0.9945099}
confusion matrix:
       0      1
0  28423    236
1     80  28621
---- Validation: 
scalar performance:
{'acc': 0.95929116, 'precision': 0.713232, 'recall': 0.8214128, 'specificity': 0.8214128, 'f1': 0.7548424, 'auroc': 0.92078805, 'binary_precision': 0.4382591, 'binary_recall': 0.6734059, 'binary_specificity': 0.9694198, 'binary_f1_score': 0.5309626}
confusion matrix:
       0    1
0  17594  555
1    210  433
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9488655, 'precision': 0.5844704, 'recall': 0.5335599, 'specificity': 0.5335599, 'f1': 0.54484665, 'auroc': 0.9270994, 'binary_precision': 0.20792079, 'binary_recall': 0.08045977, 'binary_specificity': 0.98666, 'binary_f1_score': 0.1160221}
confusion matrix:
      0   1
0  5917  80
1   240  21
early stop counter: 1
val acc:0.9592911601066589, best validation acc: 0.9673265218734741, corresponding to test acc:                         0.9694790840148926 / 0.9694790840148926
after epoch: 3,now: 2024-07-30 23:31:26.527753,epoch time: 0:59:32.345926,used: 3:00:18.925757,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9943166, 'precision': 0.99435353, 'recall': 0.9943204, 'specificity': 0.9943204, 'f1': 0.9943166, 'auroc': 0.9997652, 'binary_precision': 0.99883986, 'binary_recall': 0.98979235, 'binary_specificity': 0.99884844, 'binary_f1_score': 0.99429554}
confusion matrix:
       0      1
0  28623     33
1    293  28411
---- Validation: 
scalar performance:
{'acc': 0.96902937, 'precision': 0.7665162, 'recall': 0.75369906, 'specificity': 0.75369906, 'f1': 0.7599327, 'auroc': 0.9350735, 'binary_precision': 0.5499182, 'binary_recall': 0.5225505, 'binary_specificity': 0.98484766, 'binary_f1_score': 0.53588516}
confusion matrix:
       0    1
0  17874  275
1    307  336
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96276766, 'precision': 0.86189914, 'recall': 0.57746017, 'specificity': 0.57746017, 'f1': 0.62061036, 'auroc': 0.93643963, 'binary_precision': 0.7592593, 'binary_recall': 0.15708812, 'binary_specificity': 0.99783224, 'binary_f1_score': 0.26031744}
confusion matrix:
      0   1
0  5984  13
1   220  41
better model found
persisted
after epoch: 4,now: 2024-07-31 00:30:28.158767,epoch time: 0:59:01.631014,used: 3:59:20.556771,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.996461, 'precision': 0.99647033, 'recall': 0.9964626, 'specificity': 0.9964626, 'f1': 0.996461, 'auroc': 0.99984986, 'binary_precision': 0.99880975, 'binary_recall': 0.9941115, 'binary_specificity': 0.9988137, 'binary_f1_score': 0.99645513}
confusion matrix:
       0      1
0  28626     34
1    169  28531
---- Validation: 
scalar performance:
{'acc': 0.9725415, 'precision': 0.81672907, 'recall': 0.70601374, 'specificity': 0.70601374, 'f1': 0.7486188, 'auroc': 0.9423084, 'binary_precision': 0.65375304, 'binary_recall': 0.41990668, 'binary_specificity': 0.9921208, 'binary_f1_score': 0.5113637}
confusion matrix:
       0    1
0  18006  143
1    373  270
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9592522, 'precision': 0.8237244, 'recall': 0.52065593, 'specificity': 0.52065593, 'f1': 0.52929366, 'auroc': 0.8910873, 'binary_precision': 0.6875, 'binary_recall': 0.042145595, 'binary_specificity': 0.99916625, 'binary_f1_score': 0.07942238}
confusion matrix:
      0   1
0  5992   5
1   250  11
better model found
persisted
after epoch: 5,now: 2024-07-31 01:29:52.027833,epoch time: 0:59:23.869066,used: 4:58:44.425837,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9955195, 'precision': 0.9955497, 'recall': 0.9955226, 'specificity': 0.9955226, 'f1': 0.9955195, 'auroc': 0.99986994, 'binary_precision': 0.9996136, 'binary_recall': 0.99142915, 'binary_specificity': 0.99961615, 'binary_f1_score': 0.99550456}
confusion matrix:
       0      1
0  28647     11
1    246  28456
---- Validation: 
scalar performance:
{'acc': 0.96392083, 'precision': 0.606471, 'recall': 0.5117867, 'specificity': 0.5117867, 'f1': 0.5146824, 'auroc': 0.9437828, 'binary_precision': 0.24637681, 'binary_recall': 0.02643857, 'binary_specificity': 0.9971348, 'binary_f1_score': 0.04775281}
confusion matrix:
       0   1
0  18097  52
1    626  17
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9579738, 'precision': 0.47914, 'recall': 0.49983326, 'specificity': 0.49983326, 'f1': 0.48926792, 'auroc': 0.9074681, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9996665, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5995  2
1   261  0
early stop counter: 1
val acc:0.9639208316802979, best validation acc: 0.9725415110588074, corresponding to test acc:                         0.9592521786689758 / 0.9694790840148926
after epoch: 6,now: 2024-07-31 02:23:21.982296,epoch time: 0:53:29.954463,used: 5:52:14.380300,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_30_20_31_06_seed_0_23656144
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
slurmstepd: error: *** JOB 23656144 ON gpusrv12 CANCELLED AT 2024-07-31T02:41:50 ***
