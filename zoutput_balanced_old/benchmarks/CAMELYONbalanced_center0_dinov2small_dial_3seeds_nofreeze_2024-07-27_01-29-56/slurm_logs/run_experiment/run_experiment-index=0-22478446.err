Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 20 10:21:15 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446

 Experiment start at: 2024-07-20 10:25:30.821960
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.569767415523529
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.97558594, 'precision': 0.9755637, 'recall': 0.97562, 'specificity': 0.97562, 'f1': 0.97558343, 'auroc': 0.9965327, 'binary_precision': 0.9786684, 'binary_recall': 0.97300774, 'binary_specificity': 0.9782322, 'binary_f1_score': 0.97582984}
confusion matrix:
      0     1
0  1483    33
1    42  1514
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.7585404, 'precision': 0.75942886, 'recall': 0.75891644, 'specificity': 0.75891644, 'f1': 0.75847614, 'auroc': 0.84554386, 'binary_precision': 0.7403561, 'binary_recall': 0.78582674, 'binary_specificity': 0.73200613, 'binary_f1_score': 0.76241404}
confusion matrix:
     0    1
0  478  175
1  136  499
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8372093, 'precision': 0.8414642, 'recall': 0.83720934, 'specificity': 0.83720934, 'f1': 0.83670056, 'auroc': 0.9304273, 'binary_precision': 0.8033473, 'binary_recall': 0.89302325, 'binary_specificity': 0.7813954, 'binary_f1_score': 0.84581494}
confusion matrix:
     0    1
0  168   47
1   23  192
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-20 10:27:41.309824,epoch time: 0:02:10.487864,used: 0:02:10.487864,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97591144, 'precision': 0.9760236, 'recall': 0.9760672, 'specificity': 0.9760672, 'f1': 0.9759114, 'auroc': 0.9955915, 'binary_precision': 0.98750824, 'binary_recall': 0.96467566, 'binary_specificity': 0.98745877, 'binary_f1_score': 0.9759584}
confusion matrix:
      0     1
0  1496    19
1    55  1502
---- Validation: 
scalar performance:
{'acc': 0.65217394, 'precision': 0.713066, 'recall': 0.648351, 'specificity': 0.648351, 'f1': 0.6219825, 'auroc': 0.7840036, 'binary_precision': 0.8235294, 'binary_recall': 0.37480316, 'binary_specificity': 0.9218989, 'binary_f1_score': 0.51515156}
confusion matrix:
     0    1
0  602   51
1  397  238
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8697674, 'precision': 0.87925184, 'recall': 0.8697674, 'specificity': 0.8697674, 'f1': 0.8689481, 'auroc': 0.93328285, 'binary_precision': 0.9392265, 'binary_recall': 0.7906977, 'binary_specificity': 0.9488372, 'binary_f1_score': 0.8585859}
confusion matrix:
     0    1
0  204   11
1   45  170
new oracle model saved
early stop counter: 1
val acc:0.6521739363670349, best validation acc: 0.7585403919219971, corresponding to test acc:                         0.8372092843055725 / 0.869767427444458
after epoch: 2,now: 2024-07-20 10:29:10.357257,epoch time: 0:01:29.047433,used: 0:03:39.535297,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9684245, 'precision': 0.9697786, 'recall': 0.96807754, 'specificity': 0.96807754, 'f1': 0.9683786, 'auroc': 0.99839157, 'binary_precision': 0.94788474, 'binary_recall': 0.9922978, 'binary_specificity': 0.9438573, 'binary_f1_score': 0.9695829}
confusion matrix:
      0     1
0  1429    85
1    12  1546
---- Validation: 
scalar performance:
{'acc': 0.86024845, 'precision': 0.860356, 'recall': 0.86011267, 'specificity': 0.86011267, 'f1': 0.8601824, 'auroc': 0.9127202, 'binary_precision': 0.864, 'binary_recall': 0.8503937, 'binary_specificity': 0.86983156, 'binary_f1_score': 0.85714287}
confusion matrix:
     0    1
0  568   85
1   95  540
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87906975, 'precision': 0.8806839, 'recall': 0.87906975, 'specificity': 0.87906975, 'f1': 0.8789414, 'auroc': 0.9358356, 'binary_precision': 0.90547264, 'binary_recall': 0.8465116, 'binary_specificity': 0.9116279, 'binary_f1_score': 0.875}
confusion matrix:
     0    1
0  196   19
1   33  182
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-20 10:30:40.243297,epoch time: 0:01:29.886040,used: 0:05:09.421337,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9866536, 'precision': 0.9866376, 'recall': 0.98671496, 'specificity': 0.98671496, 'f1': 0.98665273, 'auroc': 0.99913263, 'binary_precision': 0.9915639, 'binary_recall': 0.9820051, 'binary_specificity': 0.9914248, 'binary_f1_score': 0.9867614}
confusion matrix:
      0     1
0  1503    13
1    28  1528
---- Validation: 
scalar performance:
{'acc': 0.8470497, 'precision': 0.8577812, 'recall': 0.8458369, 'specificity': 0.8458369, 'f1': 0.84554803, 'auroc': 0.9188361, 'binary_precision': 0.9163498, 'binary_recall': 0.75905514, 'binary_specificity': 0.9326187, 'binary_f1_score': 0.8303187}
confusion matrix:
     0    1
0  609   44
1  153  482
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.855814, 'precision': 0.8880867, 'recall': 0.855814, 'specificity': 0.855814, 'f1': 0.8527527, 'auroc': 0.94178474, 'binary_precision': 1.0, 'binary_recall': 0.7116279, 'binary_specificity': 1.0, 'binary_f1_score': 0.8315217}
confusion matrix:
     0    1
0  215    0
1   62  153
early stop counter: 1
val acc:0.8470497131347656, best validation acc: 0.8602484464645386, corresponding to test acc:                         0.8790697455406189 / 0.8790697455406189
after epoch: 4,now: 2024-07-20 10:32:10.089077,epoch time: 0:01:29.845780,used: 0:06:39.267117,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98860675, 'precision': 0.9885874, 'recall': 0.98862773, 'specificity': 0.98862773, 'f1': 0.9886049, 'auroc': 0.9993484, 'binary_precision': 0.99034125, 'binary_recall': 0.987163, 'binary_specificity': 0.99009246, 'binary_f1_score': 0.98874956}
confusion matrix:
      0     1
0  1499    15
1    20  1538
---- Validation: 
scalar performance:
{'acc': 0.75, 'precision': 0.7847451, 'recall': 0.7475202, 'specificity': 0.7475202, 'f1': 0.7408515, 'auroc': 0.8656383, 'binary_precision': 0.8807786, 'binary_recall': 0.57007873, 'binary_specificity': 0.9249617, 'binary_f1_score': 0.6921606}
confusion matrix:
     0    1
0  604   49
1  273  362
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.88139534, 'precision': 0.89578843, 'recall': 0.88139534, 'specificity': 0.88139534, 'f1': 0.88030714, 'auroc': 0.9395132, 'binary_precision': 0.97126436, 'binary_recall': 0.7860465, 'binary_specificity': 0.9767442, 'binary_f1_score': 0.8688946}
confusion matrix:
     0    1
0  210    5
1   46  169
new oracle model saved
early stop counter: 2
val acc:0.75, best validation acc: 0.8602484464645386, corresponding to test acc:                         0.8790697455406189 / 0.8813953399658203
after epoch: 5,now: 2024-07-20 10:33:39.725629,epoch time: 0:01:29.636552,used: 0:08:08.903669,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98535156, 'precision': 0.9855144, 'recall': 0.98553973, 'specificity': 0.98553973, 'f1': 0.98535156, 'auroc': 0.9994912, 'binary_precision': 0.9986816, 'binary_recall': 0.9724005, 'binary_specificity': 0.998679, 'binary_f1_score': 0.9853658}
confusion matrix:
      0     1
0  1512     2
1    43  1515
---- Validation: 
scalar performance:
{'acc': 0.7826087, 'precision': 0.8255906, 'recall': 0.7800485, 'specificity': 0.7800485, 'f1': 0.7740979, 'auroc': 0.9308027, 'binary_precision': 0.9404467, 'binary_recall': 0.5968504, 'binary_specificity': 0.9632466, 'binary_f1_score': 0.7302505}
confusion matrix:
     0    1
0  629   24
1  256  379
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81395346, 'precision': 0.86153805, 'recall': 0.8139535, 'specificity': 0.8139535, 'f1': 0.8076235, 'auroc': 0.92852354, 'binary_precision': 0.99270076, 'binary_recall': 0.63255817, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.77272725}
confusion matrix:
     0    1
0  214    1
1   79  136
early stop counter: 3
val acc:0.782608687877655, best validation acc: 0.8602484464645386, corresponding to test acc:                         0.8790697455406189 / 0.8813953399658203
after epoch: 6,now: 2024-07-20 10:35:09.960403,epoch time: 0:01:30.234774,used: 0:09:39.138443,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9827474, 'precision': 0.98290986, 'recall': 0.9829351, 'specificity': 0.9829351, 'f1': 0.9827473, 'auroc': 0.99903595, 'binary_precision': 0.9960448, 'binary_recall': 0.96983314, 'binary_specificity': 0.996037, 'binary_f1_score': 0.9827642}
confusion matrix:
      0     1
0  1508     6
1    47  1511
---- Validation: 
scalar performance:
{'acc': 0.7414596, 'precision': 0.7989299, 'recall': 0.7383596, 'specificity': 0.7383596, 'f1': 0.7267332, 'auroc': 0.9051356, 'binary_precision': 0.92655367, 'binary_recall': 0.51653546, 'binary_specificity': 0.96018374, 'binary_f1_score': 0.6632963}
confusion matrix:
     0    1
0  627   26
1  307  328
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81860465, 'precision': 0.8668942, 'recall': 0.81860465, 'specificity': 0.81860465, 'f1': 0.8124329, 'auroc': 0.91826934, 'binary_precision': 1.0, 'binary_recall': 0.6372093, 'binary_specificity': 1.0, 'binary_f1_score': 0.77840906}
confusion matrix:
     0    1
0  215    0
1   78  137
early stop counter: 4
val acc:0.7414596080780029, best validation acc: 0.8602484464645386, corresponding to test acc:                         0.8790697455406189 / 0.8813953399658203
after epoch: 7,now: 2024-07-20 10:36:40.273703,epoch time: 0:01:30.313300,used: 0:11:09.451743,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.98535156, 'precision': 0.9856019, 'recall': 0.9852406, 'specificity': 0.9852406, 'f1': 0.985345, 'auroc': 0.9994867, 'binary_precision': 0.977244, 'binary_recall': 0.9942122, 'binary_specificity': 0.97626895, 'binary_f1_score': 0.98565507}
confusion matrix:
      0     1
0  1481    36
1     9  1546
---- Validation: 
scalar performance:
{'acc': 0.871118, 'precision': 0.87380993, 'recall': 0.87052846, 'specificity': 0.87052846, 'f1': 0.87073624, 'auroc': 0.924477, 'binary_precision': 0.90222985, 'binary_recall': 0.82834643, 'binary_specificity': 0.91271055, 'binary_f1_score': 0.863711}
confusion matrix:
     0    1
0  596   57
1  109  526
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8372093, 'precision': 0.87229216, 'recall': 0.83720934, 'specificity': 0.83720934, 'f1': 0.83328164, 'auroc': 0.93806386, 'binary_precision': 0.98657715, 'binary_recall': 0.68372095, 'binary_specificity': 0.9906977, 'binary_f1_score': 0.8076923}
confusion matrix:
     0    1
0  213    2
1   68  147
better model found
persisted
after epoch: 8,now: 2024-07-20 10:38:10.875071,epoch time: 0:01:30.601368,used: 0:12:40.053111,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98502606, 'precision': 0.9853226, 'recall': 0.9849029, 'specificity': 0.9849029, 'f1': 0.9850186, 'auroc': 0.99945825, 'binary_precision': 0.9760252, 'binary_recall': 0.9948553, 'binary_specificity': 0.97495055, 'binary_f1_score': 0.98535025}
confusion matrix:
      0     1
0  1479    38
1     8  1547
---- Validation: 
scalar performance:
{'acc': 0.79425466, 'precision': 0.8312036, 'recall': 0.7919029, 'specificity': 0.7919029, 'f1': 0.7874167, 'auroc': 0.92126703, 'binary_precision': 0.93838865, 'binary_recall': 0.62362206, 'binary_specificity': 0.96018374, 'binary_f1_score': 0.7492904}
confusion matrix:
     0    1
0  627   26
1  239  396
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8255814, 'precision': 0.87068963, 'recall': 0.82558143, 'specificity': 0.82558143, 'f1': 0.8201088, 'auroc': 0.94531095, 'binary_precision': 1.0, 'binary_recall': 0.6511628, 'binary_specificity': 1.0, 'binary_f1_score': 0.78873235}
confusion matrix:
     0    1
0  215    0
1   75  140
early stop counter: 1
val acc:0.7942546606063843, best validation acc: 0.8711180090904236, corresponding to test acc:                         0.8372092843055725 / 0.8813953399658203
after epoch: 9,now: 2024-07-20 10:39:41.041770,epoch time: 0:01:30.166699,used: 0:14:10.219810,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9824219, 'precision': 0.9827353, 'recall': 0.98267144, 'specificity': 0.98267144, 'f1': 0.9824218, 'auroc': 0.999334, 'binary_precision': 0.9993364, 'binary_recall': 0.96600384, 'binary_specificity': 0.99933904, 'binary_f1_score': 0.9823874}
confusion matrix:
      0     1
0  1512     1
1    53  1506
---- Validation: 
scalar performance:
{'acc': 0.613354, 'precision': 0.7497312, 'recall': 0.60811275, 'specificity': 0.60811275, 'f1': 0.54666734, 'auroc': 0.9165379, 'binary_precision': 0.9308176, 'binary_recall': 0.23307087, 'binary_specificity': 0.98315465, 'binary_f1_score': 0.37279597}
confusion matrix:
     0    1
0  642   11
1  487  148
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.59534883, 'precision': 0.7648579, 'recall': 0.59534883, 'specificity': 0.59534883, 'f1': 0.5182724, 'auroc': 0.928372, 'binary_precision': 0.9767442, 'binary_recall': 0.19534884, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.3255814}
confusion matrix:
     0   1
0  214   1
1  173  42
early stop counter: 2
val acc:0.6133540272712708, best validation acc: 0.8711180090904236, corresponding to test acc:                         0.8372092843055725 / 0.8813953399658203
after epoch: 10,now: 2024-07-20 10:41:10.990839,epoch time: 0:01:29.949069,used: 0:15:40.168879,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9814453, 'precision': 0.9817833, 'recall': 0.98164785, 'specificity': 0.98164785, 'f1': 0.98144495, 'auroc': 0.9994582, 'binary_precision': 0.99800533, 'binary_recall': 0.9652733, 'binary_specificity': 0.99802244, 'binary_f1_score': 0.98136646}
confusion matrix:
      0     1
0  1514     3
1    54  1501
---- Validation: 
scalar performance:
{'acc': 0.6824534, 'precision': 0.7936228, 'recall': 0.6781047, 'specificity': 0.6781047, 'f1': 0.6460623, 'auroc': 0.9274758, 'binary_precision': 0.97083336, 'binary_recall': 0.36692914, 'binary_specificity': 0.9892802, 'binary_f1_score': 0.53257143}
confusion matrix:
     0    1
0  646    7
1  402  233
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75348836, 'precision': 0.83091867, 'recall': 0.75348836, 'specificity': 0.75348836, 'f1': 0.73817235, 'auroc': 0.9368307, 'binary_precision': 0.990991, 'binary_recall': 0.5116279, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.6748466}
confusion matrix:
     0    1
0  214    1
1  105  110
early stop counter: 3
val acc:0.6824533939361572, best validation acc: 0.8711180090904236, corresponding to test acc:                         0.8372092843055725 / 0.8813953399658203
after epoch: 11,now: 2024-07-20 10:42:40.912928,epoch time: 0:01:29.922089,used: 0:17:10.090968,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9873047, 'precision': 0.9874288, 'recall': 0.98746705, 'specificity': 0.98746705, 'f1': 0.9873046, 'auroc': 0.99957395, 'binary_precision': 0.9993421, 'binary_recall': 0.9755941, 'binary_specificity': 0.99933994, 'binary_f1_score': 0.98732525}
confusion matrix:
      0     1
0  1514     1
1    38  1519
---- Validation: 
scalar performance:
{'acc': 0.5931677, 'precision': 0.73970586, 'recall': 0.58761865, 'specificity': 0.58761865, 'f1': 0.5132121, 'auroc': 0.92242646, 'binary_precision': 0.9236641, 'binary_recall': 0.19055118, 'binary_specificity': 0.9846861, 'binary_f1_score': 0.31592688}
confusion matrix:
     0    1
0  643   10
1  514  121
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5232558, 'precision': 0.75595236, 'recall': 0.5232558, 'specificity': 0.5232558, 'f1': 0.38302714, 'auroc': 0.9403353, 'binary_precision': 1.0, 'binary_recall': 0.046511628, 'binary_specificity': 1.0, 'binary_f1_score': 0.08888888}
confusion matrix:
     0   1
0  215   0
1  205  10
early stop counter: 4
val acc:0.5931677222251892, best validation acc: 0.8711180090904236, corresponding to test acc:                         0.8372092843055725 / 0.8813953399658203
after epoch: 12,now: 2024-07-20 10:44:10.898432,epoch time: 0:01:29.985504,used: 0:18:40.076472,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.9902344, 'precision': 0.9902085, 'recall': 0.9902884, 'specificity': 0.9902884, 'f1': 0.9902333, 'auroc': 0.99959517, 'binary_precision': 0.99417853, 'binary_recall': 0.9865212, 'binary_specificity': 0.9940555, 'binary_f1_score': 0.990335}
confusion matrix:
      0     1
0  1505     9
1    21  1537
---- Validation: 
scalar performance:
{'acc': 0.8051242, 'precision': 0.84038866, 'recall': 0.80286145, 'specificity': 0.80286145, 'f1': 0.79910207, 'auroc': 0.93538964, 'binary_precision': 0.9465116, 'binary_recall': 0.6409449, 'binary_specificity': 0.96477795, 'binary_f1_score': 0.7643193}
confusion matrix:
     0    1
0  630   23
1  228  407
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8534884, 'precision': 0.8844344, 'recall': 0.8534883, 'specificity': 0.8534883, 'f1': 0.8504793, 'auroc': 0.9443375, 'binary_precision': 0.9935065, 'binary_recall': 0.7116279, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.8292683}
confusion matrix:
     0    1
0  214    1
1   62  153
early stop counter: 5
val acc:0.8051242232322693, best validation acc: 0.8711180090904236, corresponding to test acc:                         0.8372092843055725 / 0.8813953399658203
after epoch: 13,now: 2024-07-20 10:45:41.015891,epoch time: 0:01:30.117459,used: 0:20:10.193931,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_25_30_seed_0_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 13 with time: 0:20:10.193931 at 2024-07-20 10:45:41.015891
persisted model performance metric: 

scalar performance:
{'acc': 0.8372093, 'precision': 0.87229216, 'recall': 0.83720934, 'specificity': 0.83720934, 'f1': 0.83328164, 'auroc': 0.93806386, 'binary_precision': 0.98657715, 'binary_recall': 0.68372095, 'binary_specificity': 0.9906977, 'binary_f1_score': 0.8076923}
confusion matrix:
     0    1
0  213    2
1   68  147
oracle model performance metric: 

scalar performance:
{'acc': 0.88139534, 'precision': 0.89578843, 'recall': 0.88139534, 'specificity': 0.88139534, 'f1': 0.88030714, 'auroc': 0.9395132, 'binary_precision': 0.97126436, 'binary_recall': 0.7860465, 'binary_specificity': 0.9767442, 'binary_f1_score': 0.8688946}
confusion matrix:
     0    1
0  210    5
1   46  169
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454829 KiB |   2003 MiB |  28945 GiB |  28945 GiB |
|       from large pool | 414237 KiB |   1971 MiB |  28569 GiB |  28568 GiB |
|       from small pool |  40592 KiB |     56 MiB |    376 GiB |    376 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454829 KiB |   2003 MiB |  28945 GiB |  28945 GiB |
|       from large pool | 414237 KiB |   1971 MiB |  28569 GiB |  28568 GiB |
|       from small pool |  40592 KiB |     56 MiB |    376 GiB |    376 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447480 KiB |   1998 MiB |  28934 GiB |  28934 GiB |
|       from large pool | 407075 KiB |   1966 MiB |  28558 GiB |  28558 GiB |
|       from small pool |  40405 KiB |     56 MiB |    375 GiB |    375 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2276 MiB |   2276 MiB |   2276 MiB |      0 B   |
|       from large pool |   2212 MiB |   2212 MiB |   2212 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 329554 KiB | 366275 KiB |  23154 GiB |  23154 GiB |
|       from large pool | 323043 KiB | 360722 KiB |  22759 GiB |  22759 GiB |
|       from small pool |   6511 KiB |  12075 KiB |    395 GiB |    395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1298    |    1669    |    5498 K  |    5497 K  |
|       from large pool |     187    |     311    |    2663 K  |    2663 K  |
|       from small pool |    1111    |    1407    |    2835 K  |    2834 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1298    |    1669    |    5498 K  |    5497 K  |
|       from large pool |     187    |     311    |    2663 K  |    2663 K  |
|       from small pool |    1111    |    1407    |    2835 K  |    2834 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     124    |     124    |     124    |       0    |
|       from large pool |      92    |      92    |      92    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      68    |     253    |    2833 K  |    2832 K  |
|       from large pool |      32    |      88    |    1677 K  |    1677 K  |
|       from small pool |      36    |     221    |    1155 K  |    1155 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2003 MiB |  28945 GiB |  28945 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  28569 GiB |  28569 GiB |
|       from small pool |      0 KiB |     56 MiB |    376 GiB |    376 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2003 MiB |  28945 GiB |  28945 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  28569 GiB |  28569 GiB |
|       from small pool |      0 KiB |     56 MiB |    376 GiB |    376 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1998 MiB |  28934 GiB |  28934 GiB |
|       from large pool |  16640 KiB |   1966 MiB |  28558 GiB |  28558 GiB |
|       from small pool |      0 KiB |     56 MiB |    375 GiB |    375 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 784384 KiB |   2276 MiB |   2276 MiB |   1510 MiB |
|       from large pool | 737280 KiB |   2212 MiB |   2212 MiB |   1492 MiB |
|       from small pool |  47104 KiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 366275 KiB |  23155 GiB |  23155 GiB |
|       from large pool |  24320 KiB | 360722 KiB |  22759 GiB |  22759 GiB |
|       from small pool |      0 KiB |  19953 KiB |    395 GiB |    395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1669    |    5498 K  |    5498 K  |
|       from large pool |       2    |     311    |    2663 K  |    2663 K  |
|       from small pool |       0    |    1407    |    2835 K  |    2835 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1669    |    5498 K  |    5498 K  |
|       from large pool |       2    |     311    |    2663 K  |    2663 K  |
|       from small pool |       0    |    1407    |    2835 K  |    2835 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      56    |     124    |     124    |      68    |
|       from large pool |      33    |      92    |      92    |      59    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    2833 K  |    2833 K  |
|       from large pool |       3    |      88    |    1677 K  |    1677 K  |
|       from small pool |       0    |     221    |    1155 K  |    1155 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2003 MiB |  28945 GiB |  28945 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  28569 GiB |  28569 GiB |
|       from small pool |      0 KiB |     56 MiB |    376 GiB |    376 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2003 MiB |  28945 GiB |  28945 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  28569 GiB |  28569 GiB |
|       from small pool |      0 KiB |     56 MiB |    376 GiB |    376 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1998 MiB |  28934 GiB |  28934 GiB |
|       from large pool |  16640 KiB |   1966 MiB |  28558 GiB |  28558 GiB |
|       from small pool |      0 KiB |     56 MiB |    375 GiB |    375 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 784384 KiB |   2276 MiB |   2276 MiB |   1510 MiB |
|       from large pool | 737280 KiB |   2212 MiB |   2212 MiB |   1492 MiB |
|       from small pool |  47104 KiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 366275 KiB |  23155 GiB |  23155 GiB |
|       from large pool |  24320 KiB | 360722 KiB |  22759 GiB |  22759 GiB |
|       from small pool |      0 KiB |  19953 KiB |    395 GiB |    395 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1669    |    5498 K  |    5498 K  |
|       from large pool |       2    |     311    |    2663 K  |    2663 K  |
|       from small pool |       0    |    1407    |    2835 K  |    2835 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1669    |    5498 K  |    5498 K  |
|       from large pool |       2    |     311    |    2663 K  |    2663 K  |
|       from small pool |       0    |    1407    |    2835 K  |    2835 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      56    |     124    |     124    |      68    |
|       from large pool |      33    |      92    |      92    |      59    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    2833 K  |    2833 K  |
|       from large pool |       3    |      88    |    1677 K  |    1677 K  |
|       from small pool |       0    |     221    |    1155 K  |    1155 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446

 Experiment start at: 2024-07-20 10:47:08.239128
before training, model accuracy: 0.6177777647972107
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96223956, 'precision': 0.96326905, 'recall': 0.96196187, 'specificity': 0.96196187, 'f1': 0.9621963, 'auroc': 0.9961474, 'binary_precision': 0.9444444, 'binary_recall': 0.9832905, 'binary_specificity': 0.94063324, 'binary_f1_score': 0.96347606}
confusion matrix:
      0     1
0  1426    90
1    26  1530
---- Validation: 
scalar performance:
{'acc': 0.78142077, 'precision': 0.8006532, 'recall': 0.78346133, 'specificity': 0.78346133, 'f1': 0.77866256, 'auroc': 0.8938873, 'binary_precision': 0.720403, 'binary_recall': 0.9079365, 'binary_specificity': 0.65898615, 'binary_f1_score': 0.8033708}
confusion matrix:
     0    1
0  429  222
1   58  572
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.68, 'precision': 0.7549593, 'recall': 0.68, 'specificity': 0.68, 'f1': 0.6546137, 'auroc': 0.9205333, 'binary_precision': 0.6167147, 'binary_recall': 0.95111114, 'binary_specificity': 0.40888888, 'binary_f1_score': 0.7482518}
confusion matrix:
    0    1
0  92  133
1  11  214
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-20 10:48:51.290617,epoch time: 0:01:43.051489,used: 0:01:43.051489,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9638672, 'precision': 0.9640982, 'recall': 0.9637529, 'specificity': 0.9637529, 'f1': 0.963851, 'auroc': 0.9949095, 'binary_precision': 0.9563843, 'binary_recall': 0.97299033, 'binary_specificity': 0.9545155, 'binary_f1_score': 0.9646158}
confusion matrix:
      0     1
0  1448    69
1    42  1513
---- Validation: 
scalar performance:
{'acc': 0.79234976, 'precision': 0.7960725, 'recall': 0.79324114, 'specificity': 0.79324114, 'f1': 0.7919936, 'auroc': 0.8882769, 'binary_precision': 0.75852275, 'binary_recall': 0.84761906, 'binary_specificity': 0.7388633, 'binary_f1_score': 0.8005997}
confusion matrix:
     0    1
0  481  170
1   96  534
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75777775, 'precision': 0.77822787, 'recall': 0.7577778, 'specificity': 0.7577778, 'f1': 0.75324357, 'auroc': 0.90793085, 'binary_precision': 0.7027972, 'binary_recall': 0.8933333, 'binary_specificity': 0.62222224, 'binary_f1_score': 0.78669274}
confusion matrix:
     0    1
0  140   85
1   24  201
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-20 10:50:20.930858,epoch time: 0:01:29.640241,used: 0:03:12.691730,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9798177, 'precision': 0.9799665, 'recall': 0.9797386, 'specificity': 0.9797386, 'f1': 0.97981095, 'auroc': 0.99806947, 'binary_precision': 0.9739517, 'binary_recall': 0.9864865, 'binary_specificity': 0.97299075, 'binary_f1_score': 0.980179}
confusion matrix:
      0     1
0  1477    41
1    21  1533
---- Validation: 
scalar performance:
{'acc': 0.852459, 'precision': 0.8598704, 'recall': 0.8512801, 'specificity': 0.8512801, 'f1': 0.851363, 'auroc': 0.91645086, 'binary_precision': 0.9075786, 'binary_recall': 0.77936506, 'binary_specificity': 0.92319506, 'binary_f1_score': 0.8385995}
confusion matrix:
     0    1
0  601   50
1  139  491
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8622222, 'precision': 0.8861421, 'recall': 0.8622222, 'specificity': 0.8622222, 'f1': 0.86005497, 'auroc': 0.9364741, 'binary_precision': 0.98224854, 'binary_recall': 0.73777777, 'binary_specificity': 0.9866667, 'binary_f1_score': 0.8426396}
confusion matrix:
     0    1
0  222    3
1   59  166
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-20 10:51:50.699859,epoch time: 0:01:29.769001,used: 0:04:42.460731,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97786456, 'precision': 0.9784692, 'recall': 0.9781057, 'specificity': 0.9781057, 'f1': 0.9778627, 'auroc': 0.9990318, 'binary_precision': 0.9986577, 'binary_recall': 0.95752895, 'binary_specificity': 0.9986825, 'binary_f1_score': 0.97766095}
confusion matrix:
      0     1
0  1516     2
1    66  1488
---- Validation: 
scalar performance:
{'acc': 0.7712724, 'precision': 0.82443964, 'recall': 0.76792115, 'specificity': 0.76792115, 'f1': 0.7599677, 'auroc': 0.9110898, 'binary_precision': 0.95174265, 'binary_recall': 0.56349206, 'binary_specificity': 0.97235024, 'binary_f1_score': 0.7078763}
confusion matrix:
     0    1
0  633   18
1  275  355
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.77111113, 'precision': 0.8241309, 'recall': 0.77111113, 'specificity': 0.77111113, 'f1': 0.7613519, 'auroc': 0.8980149, 'binary_precision': 0.95522386, 'binary_recall': 0.5688889, 'binary_specificity': 0.97333336, 'binary_f1_score': 0.71309197}
confusion matrix:
     0    1
0  219    6
1   97  128
early stop counter: 1
val acc:0.7712724208831787, best validation acc: 0.8524590134620667, corresponding to test acc:                         0.8622221946716309 / 0.8622221946716309
after epoch: 4,now: 2024-07-20 10:53:20.450078,epoch time: 0:01:29.750219,used: 0:06:12.210950,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98502606, 'precision': 0.9850303, 'recall': 0.9851043, 'specificity': 0.9851043, 'f1': 0.9850255, 'auroc': 0.9991009, 'binary_precision': 0.99153095, 'binary_recall': 0.9787781, 'binary_specificity': 0.99143046, 'binary_f1_score': 0.98511326}
confusion matrix:
      0     1
0  1504    13
1    33  1522
---- Validation: 
scalar performance:
{'acc': 0.84231067, 'precision': 0.8483933, 'recall': 0.84121865, 'specificity': 0.84121865, 'f1': 0.84128463, 'auroc': 0.9026382, 'binary_precision': 0.890511, 'binary_recall': 0.7746032, 'binary_specificity': 0.9078341, 'binary_f1_score': 0.8285229}
confusion matrix:
     0    1
0  591   60
1  142  488
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82222223, 'precision': 0.82286, 'recall': 0.82222223, 'specificity': 0.82222223, 'f1': 0.8221344, 'auroc': 0.91514075, 'binary_precision': 0.8372093, 'binary_recall': 0.8, 'binary_specificity': 0.84444445, 'binary_f1_score': 0.8181818}
confusion matrix:
     0    1
0  190   35
1   45  180
early stop counter: 2
val acc:0.8423106670379639, best validation acc: 0.8524590134620667, corresponding to test acc:                         0.8622221946716309 / 0.8622221946716309
after epoch: 5,now: 2024-07-20 10:54:50.300168,epoch time: 0:01:29.850090,used: 0:07:42.061040,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.96940106, 'precision': 0.9706579, 'recall': 0.96979594, 'specificity': 0.96979594, 'f1': 0.96939355, 'auroc': 0.998152, 'binary_precision': 0.99863666, 'binary_recall': 0.940912, 'binary_specificity': 0.9986799, 'binary_f1_score': 0.96891534}
confusion matrix:
      0     1
0  1513     2
1    92  1465
---- Validation: 
scalar performance:
{'acc': 0.71818894, 'precision': 0.7987453, 'recall': 0.71387607, 'specificity': 0.71387607, 'f1': 0.6951723, 'auroc': 0.9111842, 'binary_precision': 0.9498328, 'binary_recall': 0.45079365, 'binary_specificity': 0.9769585, 'binary_f1_score': 0.61141014}
confusion matrix:
     0    1
0  636   15
1  346  284
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7688889, 'precision': 0.83844256, 'recall': 0.7688889, 'specificity': 0.7688889, 'f1': 0.7563718, 'auroc': 0.92385185, 'binary_precision': 0.9918699, 'binary_recall': 0.5422222, 'binary_specificity': 0.9955556, 'binary_f1_score': 0.7011494}
confusion matrix:
     0    1
0  224    1
1  103  122
early stop counter: 3
val acc:0.7181889414787292, best validation acc: 0.8524590134620667, corresponding to test acc:                         0.8622221946716309 / 0.8622221946716309
after epoch: 6,now: 2024-07-20 10:56:20.026470,epoch time: 0:01:29.726302,used: 0:09:11.787342,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9892578, 'precision': 0.9892378, 'recall': 0.9892857, 'specificity': 0.9892857, 'f1': 0.9892566, 'auroc': 0.99872357, 'binary_precision': 0.9916075, 'binary_recall': 0.98714656, 'binary_specificity': 0.9914248, 'binary_f1_score': 0.989372}
confusion matrix:
      0     1
0  1503    13
1    20  1536
---- Validation: 
scalar performance:
{'acc': 0.77907884, 'precision': 0.8176073, 'recall': 0.7761905, 'specificity': 0.7761905, 'f1': 0.7709026, 'auroc': 0.9076927, 'binary_precision': 0.92420536, 'binary_recall': 0.6, 'binary_specificity': 0.95238096, 'binary_f1_score': 0.7276227}
confusion matrix:
     0    1
0  620   31
1  252  378
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75555557, 'precision': 0.81243205, 'recall': 0.7555555, 'specificity': 0.7555555, 'f1': 0.7439002, 'auroc': 0.9011161, 'binary_precision': 0.9457364, 'binary_recall': 0.5422222, 'binary_specificity': 0.9688889, 'binary_f1_score': 0.6892655}
confusion matrix:
     0    1
0  218    7
1  103  122
early stop counter: 4
val acc:0.7790788412094116, best validation acc: 0.8524590134620667, corresponding to test acc:                         0.8622221946716309 / 0.8622221946716309
after epoch: 7,now: 2024-07-20 10:57:50.188281,epoch time: 0:01:30.161811,used: 0:10:41.949153,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.98307294, 'precision': 0.98330164, 'recall': 0.9832475, 'specificity': 0.9832475, 'f1': 0.9830729, 'auroc': 0.9994061, 'binary_precision': 0.9973527, 'binary_recall': 0.9691318, 'binary_specificity': 0.9973632, 'binary_f1_score': 0.9830398}
confusion matrix:
      0     1
0  1513     4
1    48  1507
---- Validation: 
scalar performance:
{'acc': 0.7619048, 'precision': 0.81805575, 'recall': 0.758423, 'specificity': 0.758423, 'f1': 0.7492293, 'auroc': 0.93863416, 'binary_precision': 0.9476584, 'binary_recall': 0.5460318, 'binary_specificity': 0.9708141, 'binary_f1_score': 0.69284993}
confusion matrix:
     0    1
0  632   19
1  286  344
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.58, 'precision': 0.7717391, 'recall': 0.58, 'specificity': 0.58, 'f1': 0.4900437, 'auroc': 0.92013824, 'binary_precision': 1.0, 'binary_recall': 0.16, 'binary_specificity': 1.0, 'binary_f1_score': 0.27586207}
confusion matrix:
     0   1
0  225   0
1  189  36
early stop counter: 5
val acc:0.761904776096344, best validation acc: 0.8524590134620667, corresponding to test acc:                         0.8622221946716309 / 0.8622221946716309
after epoch: 8,now: 2024-07-20 10:59:20.478540,epoch time: 0:01:30.290259,used: 0:12:12.239412,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_10_47_08_seed_1_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 0:12:12.239412 at 2024-07-20 10:59:20.478540
persisted model performance metric: 

scalar performance:
{'acc': 0.8622222, 'precision': 0.8861421, 'recall': 0.8622222, 'specificity': 0.8622222, 'f1': 0.86005497, 'auroc': 0.9364741, 'binary_precision': 0.98224854, 'binary_recall': 0.73777777, 'binary_specificity': 0.9866667, 'binary_f1_score': 0.8426396}
confusion matrix:
     0    1
0  222    3
1   59  166
oracle model performance metric: 

scalar performance:
{'acc': 0.8622222, 'precision': 0.8861421, 'recall': 0.8622222, 'specificity': 0.8622222, 'f1': 0.86005497, 'auroc': 0.9364741, 'binary_precision': 0.98224854, 'binary_recall': 0.73777777, 'binary_specificity': 0.9866667, 'binary_f1_score': 0.8426396}
confusion matrix:
     0    1
0  222    3
1   59  166
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 453077 KiB |   2003 MiB |  47165 GiB |  47164 GiB |
|       from large pool | 412478 KiB |   1971 MiB |  46546 GiB |  46546 GiB |
|       from small pool |  40598 KiB |     60 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 453077 KiB |   2003 MiB |  47165 GiB |  47164 GiB |
|       from large pool | 412478 KiB |   1971 MiB |  46546 GiB |  46546 GiB |
|       from small pool |  40598 KiB |     60 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   1998 MiB |  47120 GiB |  47120 GiB |
|       from large pool | 407075 KiB |   1966 MiB |  46503 GiB |  46503 GiB |
|       from small pool |  40406 KiB |     60 MiB |    617 GiB |    617 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2284 MiB |   2284 MiB |   3794 MiB |   1510 MiB |
|       from large pool |   2214 MiB |   2214 MiB |   3706 MiB |   1492 MiB |
|       from small pool |     70 MiB |     70 MiB |     88 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 364075 KiB | 400806 KiB |  37043 GiB |  37042 GiB |
|       from large pool | 357569 KiB | 395253 KiB |  36393 GiB |  36393 GiB |
|       from small pool |   6505 KiB |  19953 KiB |    649 GiB |    649 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1310    |    1681    |    8952 K  |    8951 K  |
|       from large pool |     187    |     311    |    4338 K  |    4338 K  |
|       from small pool |    1123    |    1419    |    4614 K  |    4613 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1310    |    1681    |    8952 K  |    8951 K  |
|       from large pool |     187    |     311    |    4338 K  |    4338 K  |
|       from small pool |    1123    |    1419    |    4614 K  |    4613 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     128    |     128    |     196    |      68    |
|       from large pool |      93    |      93    |     152    |      59    |
|       from small pool |      35    |      35    |      44    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      79    |     263    |    4729 K  |    4729 K  |
|       from large pool |      40    |      93    |    2889 K  |    2889 K  |
|       from small pool |      39    |     223    |    1839 K  |    1839 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2003 MiB |  47165 GiB |  47165 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  46546 GiB |  46546 GiB |
|       from small pool |      0 KiB |     60 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2003 MiB |  47165 GiB |  47165 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  46546 GiB |  46546 GiB |
|       from small pool |      0 KiB |     60 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1998 MiB |  47120 GiB |  47120 GiB |
|       from large pool |  16640 KiB |   1966 MiB |  46503 GiB |  46503 GiB |
|       from small pool |      0 KiB |     60 MiB |    617 GiB |    617 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    798 MiB |   2284 MiB |   3794 MiB |   2996 MiB |
|       from large pool |    752 MiB |   2214 MiB |   3706 MiB |   2954 MiB |
|       from small pool |     46 MiB |     70 MiB |     88 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 400806 KiB |  37043 GiB |  37043 GiB |
|       from large pool |  24320 KiB | 395253 KiB |  36394 GiB |  36394 GiB |
|       from small pool |      0 KiB |  20222 KiB |    649 GiB |    649 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1681    |    8952 K  |    8952 K  |
|       from large pool |       2    |     311    |    4338 K  |    4338 K  |
|       from small pool |       0    |    1419    |    4614 K  |    4614 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1681    |    8952 K  |    8952 K  |
|       from large pool |       2    |     311    |    4338 K  |    4338 K  |
|       from small pool |       0    |    1419    |    4614 K  |    4614 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     128    |     196    |     139    |
|       from large pool |      34    |      93    |     152    |     118    |
|       from small pool |      23    |      35    |      44    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     263    |    4729 K  |    4729 K  |
|       from large pool |       3    |      93    |    2889 K  |    2889 K  |
|       from small pool |       0    |     223    |    1839 K  |    1839 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2003 MiB |  47165 GiB |  47165 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  46546 GiB |  46546 GiB |
|       from small pool |      0 KiB |     60 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2003 MiB |  47165 GiB |  47165 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  46546 GiB |  46546 GiB |
|       from small pool |      0 KiB |     60 MiB |    618 GiB |    618 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1998 MiB |  47120 GiB |  47120 GiB |
|       from large pool |  16640 KiB |   1966 MiB |  46503 GiB |  46503 GiB |
|       from small pool |      0 KiB |     60 MiB |    617 GiB |    617 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    798 MiB |   2284 MiB |   3794 MiB |   2996 MiB |
|       from large pool |    752 MiB |   2214 MiB |   3706 MiB |   2954 MiB |
|       from small pool |     46 MiB |     70 MiB |     88 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 400806 KiB |  37043 GiB |  37043 GiB |
|       from large pool |  24320 KiB | 395253 KiB |  36394 GiB |  36394 GiB |
|       from small pool |      0 KiB |  20222 KiB |    649 GiB |    649 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1681    |    8952 K  |    8952 K  |
|       from large pool |       2    |     311    |    4338 K  |    4338 K  |
|       from small pool |       0    |    1419    |    4614 K  |    4614 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1681    |    8952 K  |    8952 K  |
|       from large pool |       2    |     311    |    4338 K  |    4338 K  |
|       from small pool |       0    |    1419    |    4614 K  |    4614 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     128    |     196    |     139    |
|       from large pool |      34    |      93    |     152    |     118    |
|       from small pool |      23    |      35    |      44    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     263    |    4729 K  |    4729 K  |
|       from large pool |       3    |      93    |    2889 K  |    2889 K  |
|       from small pool |       0    |     223    |    1839 K  |    1839 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446

 Experiment start at: 2024-07-20 11:00:42.102046
before training, model accuracy: 0.41203704476356506
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.90052354, 'precision': 0.911595, 'recall': 0.8998852, 'specificity': 0.8998852, 'f1': 0.89974093, 'auroc': 0.9873629, 'binary_precision': 0.84602463, 'binary_recall': 0.9811688, 'binary_specificity': 0.8186016, 'binary_f1_score': 0.90859884}
confusion matrix:
      0     1
0  1241   275
1    29  1511
---- Validation: 
scalar performance:
{'acc': 0.8169014, 'precision': 0.8213364, 'recall': 0.8184383, 'specificity': 0.8184383, 'f1': 0.816664, 'auroc': 0.8969394, 'binary_precision': 0.7763533, 'binary_recall': 0.8762058, 'binary_specificity': 0.7606707, 'binary_f1_score': 0.82326293}
confusion matrix:
     0    1
0  499  157
1   77  545
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.787037, 'precision': 0.79432964, 'recall': 0.787037, 'specificity': 0.787037, 'f1': 0.7857097, 'auroc': 0.8879458, 'binary_precision': 0.748, 'binary_recall': 0.8657407, 'binary_specificity': 0.7083333, 'binary_f1_score': 0.8025751}
confusion matrix:
     0    1
0  153   63
1   29  187
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-20 11:02:21.401922,epoch time: 0:01:39.299876,used: 0:01:39.299876,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9695681, 'precision': 0.969872, 'recall': 0.96968186, 'specificity': 0.96968186, 'f1': 0.96956664, 'auroc': 0.9948797, 'binary_precision': 0.9839465, 'binary_recall': 0.95519483, 'binary_specificity': 0.9841689, 'binary_f1_score': 0.96935755}
confusion matrix:
      0     1
0  1492    24
1    69  1471
---- Validation: 
scalar performance:
{'acc': 0.8270736, 'precision': 0.8303724, 'recall': 0.8256804, 'specificity': 0.8256804, 'f1': 0.82611275, 'auroc': 0.8883642, 'binary_precision': 0.8573975, 'binary_recall': 0.7733119, 'binary_specificity': 0.8780488, 'binary_f1_score': 0.8131868}
confusion matrix:
     0    1
0  576   80
1  141  481
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8402778, 'precision': 0.8404602, 'recall': 0.8402778, 'specificity': 0.8402778, 'f1': 0.84025645, 'auroc': 0.9182956, 'binary_precision': 0.8483412, 'binary_recall': 0.8287037, 'binary_specificity': 0.8518519, 'binary_f1_score': 0.8384075}
confusion matrix:
     0    1
0  184   32
1   37  179
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-20 11:03:50.827830,epoch time: 0:01:29.425908,used: 0:03:08.725784,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9620419, 'precision': 0.96316504, 'recall': 0.96185964, 'specificity': 0.96185964, 'f1': 0.962006, 'auroc': 0.9954218, 'binary_precision': 0.942236, 'binary_recall': 0.9850649, 'binary_specificity': 0.93865436, 'binary_f1_score': 0.9631746}
confusion matrix:
      0     1
0  1423    93
1    23  1517
---- Validation: 
scalar performance:
{'acc': 0.70187795, 'precision': 0.7517378, 'recall': 0.7076038, 'specificity': 0.7076038, 'f1': 0.6899171, 'auroc': 0.8436177, 'binary_precision': 0.6328556, 'binary_recall': 0.92282957, 'binary_specificity': 0.49237806, 'binary_f1_score': 0.75081754}
confusion matrix:
     0    1
0  323  333
1   48  574
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6157407, 'precision': 0.7353967, 'recall': 0.6157407, 'specificity': 0.6157407, 'f1': 0.5598006, 'auroc': 0.89283264, 'binary_precision': 0.5675676, 'binary_recall': 0.9722222, 'binary_specificity': 0.25925925, 'binary_f1_score': 0.71672356}
confusion matrix:
    0    1
0  56  160
1   6  210
early stop counter: 1
val acc:0.7018779516220093, best validation acc: 0.8270735740661621, corresponding to test acc:                         0.8402777910232544 / 0.8402777910232544
after epoch: 3,now: 2024-07-20 11:05:19.804362,epoch time: 0:01:28.976532,used: 0:04:37.702316,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.94502616, 'precision': 0.94919324, 'recall': 0.9446578, 'specificity': 0.9446578, 'f1': 0.9448635, 'auroc': 0.9961189, 'binary_precision': 0.9078478, 'binary_recall': 0.99155843, 'binary_specificity': 0.89775723, 'binary_f1_score': 0.9478585}
confusion matrix:
      0     1
0  1361   155
1    13  1527
---- Validation: 
scalar performance:
{'acc': 0.8599374, 'precision': 0.86031425, 'recall': 0.8604423, 'specificity': 0.8604423, 'f1': 0.8599353, 'auroc': 0.9213469, 'binary_precision': 0.8402458, 'binary_recall': 0.87942123, 'binary_specificity': 0.8414634, 'binary_f1_score': 0.85938734}
confusion matrix:
     0    1
0  552  104
1   75  547
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.875, 'precision': 0.88051325, 'recall': 0.875, 'specificity': 0.875, 'f1': 0.8745456, 'auroc': 0.9371785, 'binary_precision': 0.9263158, 'binary_recall': 0.8148148, 'binary_specificity': 0.9351852, 'binary_f1_score': 0.8669951}
confusion matrix:
     0    1
0  202   14
1   40  176
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-07-20 11:07:51.508316,epoch time: 0:02:31.703954,used: 0:07:09.406270,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9810209, 'precision': 0.98114973, 'recall': 0.98096836, 'specificity': 0.98096836, 'f1': 0.981017, 'auroc': 0.9986923, 'binary_precision': 0.975, 'binary_recall': 0.9876623, 'binary_specificity': 0.9742744, 'binary_f1_score': 0.98129034}
confusion matrix:
      0     1
0  1477    39
1    19  1521
---- Validation: 
scalar performance:
{'acc': 0.728482, 'precision': 0.8048035, 'recall': 0.72168607, 'specificity': 0.72168607, 'f1': 0.70633006, 'auroc': 0.90477216, 'binary_precision': 0.9508197, 'binary_recall': 0.46623793, 'binary_specificity': 0.97713417, 'binary_f1_score': 0.6256742}
confusion matrix:
     0    1
0  641   15
1  332  290
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6712963, 'precision': 0.7953873, 'recall': 0.6712963, 'specificity': 0.6712963, 'f1': 0.63272345, 'auroc': 0.9080075, 'binary_precision': 0.9868421, 'binary_recall': 0.3472222, 'binary_specificity': 0.9953704, 'binary_f1_score': 0.51369864}
confusion matrix:
     0   1
0  215   1
1  141  75
early stop counter: 1
val acc:0.7284820079803467, best validation acc: 0.8599374294281006, corresponding to test acc:                         0.875 / 0.875
after epoch: 5,now: 2024-07-20 11:09:20.367614,epoch time: 0:01:28.859298,used: 0:08:38.265568,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.97742146, 'precision': 0.9778709, 'recall': 0.9775563, 'specificity': 0.9775563, 'f1': 0.9774194, 'auroc': 0.99734175, 'binary_precision': 0.99462, 'binary_recall': 0.9603896, 'binary_specificity': 0.99472296, 'binary_f1_score': 0.9772051}
confusion matrix:
      0     1
0  1508     8
1    61  1479
---- Validation: 
scalar performance:
{'acc': 0.6314554, 'precision': 0.76767707, 'recall': 0.62171596, 'specificity': 0.62171596, 'f1': 0.56824416, 'auroc': 0.8501392, 'binary_precision': 0.9520958, 'binary_recall': 0.255627, 'binary_specificity': 0.9878049, 'binary_f1_score': 0.4030418}
confusion matrix:
     0    1
0  648    8
1  463  159
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.49537036, 'precision': 0.2488372, 'recall': 0.49537036, 'specificity': 0.49537036, 'f1': 0.33126935, 'auroc': 0.809435, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9907407, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  214  2
1  216  0
early stop counter: 2
val acc:0.6314554214477539, best validation acc: 0.8599374294281006, corresponding to test acc:                         0.875 / 0.875
after epoch: 6,now: 2024-07-20 11:10:49.233559,epoch time: 0:01:28.865945,used: 0:10:07.131513,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.986911, 'precision': 0.98692465, 'recall': 0.98695135, 'specificity': 0.98695135, 'f1': 0.98691094, 'auroc': 0.999447, 'binary_precision': 0.992126, 'binary_recall': 0.9818182, 'binary_specificity': 0.99208444, 'binary_f1_score': 0.9869452}
confusion matrix:
      0     1
0  1504    12
1    28  1512
---- Validation: 
scalar performance:
{'acc': 0.58059466, 'precision': 0.7362945, 'recall': 0.56946516, 'specificity': 0.56946516, 'f1': 0.48354602, 'auroc': 0.8843963, 'binary_precision': 0.92156863, 'binary_recall': 0.1511254, 'binary_specificity': 0.9878049, 'binary_f1_score': 0.2596685}
confusion matrix:
     0   1
0  648   8
1  528  94
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5347222, 'precision': 0.7296244, 'recall': 0.5347222, 'specificity': 0.5347222, 'f1': 0.40939853, 'auroc': 0.9115869, 'binary_precision': 0.9411765, 'binary_recall': 0.074074075, 'binary_specificity': 0.9953704, 'binary_f1_score': 0.13733906}
confusion matrix:
     0   1
0  215   1
1  200  16
early stop counter: 3
val acc:0.5805946588516235, best validation acc: 0.8599374294281006, corresponding to test acc:                         0.875 / 0.875
after epoch: 7,now: 2024-07-20 11:12:18.613738,epoch time: 0:01:29.380179,used: 0:11:36.511692,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.98232985, 'precision': 0.9823636, 'recall': 0.98238015, 'specificity': 0.98238015, 'f1': 0.9823298, 'auroc': 0.998769, 'binary_precision': 0.9888158, 'binary_recall': 0.975974, 'binary_specificity': 0.9887863, 'binary_f1_score': 0.9823529}
confusion matrix:
      0     1
0  1499    17
1    37  1503
---- Validation: 
scalar performance:
{'acc': 0.80125195, 'precision': 0.8252105, 'recall': 0.7975698, 'specificity': 0.7975698, 'f1': 0.79605544, 'auroc': 0.8844061, 'binary_precision': 0.90707964, 'binary_recall': 0.659164, 'binary_specificity': 0.9359756, 'binary_f1_score': 0.763501}
confusion matrix:
     0    1
0  614   42
1  212  410
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8148148, 'precision': 0.8451128, 'recall': 0.8148148, 'specificity': 0.8148148, 'f1': 0.8106592, 'auroc': 0.89064646, 'binary_precision': 0.94736844, 'binary_recall': 0.6666667, 'binary_specificity': 0.962963, 'binary_f1_score': 0.78260875}
confusion matrix:
     0    1
0  208    8
1   72  144
early stop counter: 4
val acc:0.8012519478797913, best validation acc: 0.8599374294281006, corresponding to test acc:                         0.875 / 0.875
after epoch: 8,now: 2024-07-20 11:13:48.591141,epoch time: 0:01:29.977403,used: 0:13:06.489095,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98003924, 'precision': 0.9802586, 'recall': 0.9801383, 'specificity': 0.9801383, 'f1': 0.98003876, 'auroc': 0.9982408, 'binary_precision': 0.99267155, 'binary_recall': 0.96753246, 'binary_specificity': 0.9927441, 'binary_f1_score': 0.97994083}
confusion matrix:
      0     1
0  1505    11
1    50  1490
---- Validation: 
scalar performance:
{'acc': 0.68622845, 'precision': 0.7499001, 'recall': 0.6792776, 'specificity': 0.6792776, 'f1': 0.6596719, 'auroc': 0.85819745, 'binary_precision': 0.8695652, 'binary_recall': 0.41800642, 'binary_specificity': 0.9405488, 'binary_f1_score': 0.5646037}
confusion matrix:
     0    1
0  617   39
1  362  260
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7662037, 'precision': 0.8005299, 'recall': 0.7662037, 'specificity': 0.7662037, 'f1': 0.75933146, 'auroc': 0.8608539, 'binary_precision': 0.9020979, 'binary_recall': 0.5972222, 'binary_specificity': 0.9351852, 'binary_f1_score': 0.718663}
confusion matrix:
     0    1
0  202   14
1   87  129
early stop counter: 5
val acc:0.6862284541130066, best validation acc: 0.8599374294281006, corresponding to test acc:                         0.875 / 0.875
after epoch: 9,now: 2024-07-20 11:15:18.036300,epoch time: 0:01:29.445159,used: 0:14:35.934254,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_20_11_00_42_seed_2_22478446
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 9 with time: 0:14:35.934254 at 2024-07-20 11:15:18.036300
persisted model performance metric: 

scalar performance:
{'acc': 0.875, 'precision': 0.88051325, 'recall': 0.875, 'specificity': 0.875, 'f1': 0.8745456, 'auroc': 0.9371785, 'binary_precision': 0.9263158, 'binary_recall': 0.8148148, 'binary_specificity': 0.9351852, 'binary_f1_score': 0.8669951}
confusion matrix:
     0    1
0  202   14
1   40  176
oracle model performance metric: 

scalar performance:
{'acc': 0.875, 'precision': 0.88051325, 'recall': 0.875, 'specificity': 0.875, 'f1': 0.8745456, 'auroc': 0.9371785, 'binary_precision': 0.9263158, 'binary_recall': 0.8148148, 'binary_specificity': 0.9351852, 'binary_f1_score': 0.8669951}
confusion matrix:
     0    1
0  202   14
1   40  176
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_nofreeze_2024-07-19_18-41-07/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 453367 KiB |   2003 MiB |  67382 GiB |  67382 GiB |
|       from large pool | 412775 KiB |   1971 MiB |  66499 GiB |  66498 GiB |
|       from small pool |  40592 KiB |     60 MiB |    883 GiB |    883 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 453367 KiB |   2003 MiB |  67382 GiB |  67382 GiB |
|       from large pool | 412775 KiB |   1971 MiB |  66499 GiB |  66498 GiB |
|       from small pool |  40592 KiB |     60 MiB |    883 GiB |    883 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   1998 MiB |  67332 GiB |  67331 GiB |
|       from large pool | 407075 KiB |   1966 MiB |  66450 GiB |  66450 GiB |
|       from small pool |  40406 KiB |     60 MiB |    881 GiB |    881 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2278 MiB |   2284 MiB |   5274 MiB |   2996 MiB |
|       from large pool |   2214 MiB |   2214 MiB |   5168 MiB |   2954 MiB |
|       from small pool |     64 MiB |     70 MiB |    106 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 324872 KiB | 400806 KiB |  52358 GiB |  52358 GiB |
|       from large pool | 318361 KiB | 395253 KiB |  51431 GiB |  51430 GiB |
|       from small pool |   6511 KiB |  20222 KiB |    927 GiB |    927 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1298    |    1681    |   12782 K  |   12781 K  |
|       from large pool |     187    |     311    |    6199 K  |    6198 K  |
|       from small pool |    1111    |    1419    |    6583 K  |    6582 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1298    |    1681    |   12782 K  |   12781 K  |
|       from large pool |     187    |     311    |    6199 K  |    6198 K  |
|       from small pool |    1111    |    1419    |    6583 K  |    6582 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     125    |     128    |     264    |     139    |
|       from large pool |      93    |      93    |     211    |     118    |
|       from small pool |      32    |      35    |      53    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |     263    |    6787 K  |    6787 K  |
|       from large pool |      35    |      93    |    4171 K  |    4171 K  |
|       from small pool |      36    |     223    |    2616 K  |    2616 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   2003 MiB |  67382 GiB |  67382 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  66499 GiB |  66499 GiB |
|       from small pool |      0 KiB |     60 MiB |    883 GiB |    883 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   2003 MiB |  67382 GiB |  67382 GiB |
|       from large pool |  16640 KiB |   1971 MiB |  66499 GiB |  66499 GiB |
|       from small pool |      0 KiB |     60 MiB |    883 GiB |    883 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   1998 MiB |  67332 GiB |  67332 GiB |
|       from large pool |  16640 KiB |   1966 MiB |  66450 GiB |  66450 GiB |
|       from small pool |      0 KiB |     60 MiB |    881 GiB |    881 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 778240 KiB |   2284 MiB |   5274 MiB |   4514 MiB |
|       from large pool | 731136 KiB |   2214 MiB |   5168 MiB |   4454 MiB |
|       from small pool |  47104 KiB |     70 MiB |    106 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 400806 KiB |  52358 GiB |  52358 GiB |
|       from large pool |  24320 KiB | 395253 KiB |  51431 GiB |  51431 GiB |
|       from small pool |      0 KiB |  20228 KiB |    927 GiB |    927 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1681    |   12782 K  |   12782 K  |
|       from large pool |       2    |     311    |    6199 K  |    6199 K  |
|       from small pool |       0    |    1419    |    6583 K  |    6583 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1681    |   12782 K  |   12782 K  |
|       from large pool |       2    |     311    |    6199 K  |    6199 K  |
|       from small pool |       0    |    1419    |    6583 K  |    6583 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      56    |     128    |     264    |     208    |
|       from large pool |      33    |      93    |     211    |     178    |
|       from small pool |      23    |      35    |      53    |      30    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     263    |    6788 K  |    6788 K  |
|       from large pool |       3    |      93    |    4171 K  |    4171 K  |
|       from small pool |       0    |     223    |    2616 K  |    2616 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 20 11:16:07 2024]
Finished job 0.
1 of 1 steps (100%) done
