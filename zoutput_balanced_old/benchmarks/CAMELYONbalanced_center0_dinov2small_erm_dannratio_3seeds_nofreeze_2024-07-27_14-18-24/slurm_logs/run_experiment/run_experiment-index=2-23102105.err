Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 14:32:25 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105

 Experiment start at: 2024-07-27 14:33:10.564555
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.49534884095191956
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.8961589, 'precision': 0.8963804, 'recall': 0.8963567, 'specificity': 0.8963567, 'f1': 0.89615875, 'auroc': 0.9629047, 'binary_precision': 0.9099934, 'binary_recall': 0.8825417, 'binary_specificity': 0.91017175, 'binary_f1_score': 0.89605737}
confusion matrix:
      0     1
0  1378   136
1   183  1375
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.49456522, 'precision': 0.7468896, 'recall': 0.5015314, 'specificity': 0.5015314, 'f1': 0.33361042, 'auroc': 0.65283424, 'binary_precision': 0.49377915, 'binary_recall': 1.0, 'binary_specificity': 0.0030627872, 'binary_f1_score': 0.661114}
confusion matrix:
   0    1
0  2  651
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5023256, 'precision': 0.75058275, 'recall': 0.5023256, 'specificity': 0.5023256, 'f1': 0.3384806, 'auroc': 0.7328826, 'binary_precision': 0.5011655, 'binary_recall': 1.0, 'binary_specificity': 0.004651163, 'binary_f1_score': 0.6677019}
confusion matrix:
   0    1
0  1  214
1  0  215
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 14:35:48.888702,epoch time: 0:02:38.324147,used: 0:02:38.324147,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9352214, 'precision': 0.9361937, 'recall': 0.93559515, 'specificity': 0.93559515, 'f1': 0.93521094, 'auroc': 0.9837611, 'binary_precision': 0.960678, 'binary_recall': 0.90949935, 'binary_specificity': 0.9616909, 'binary_f1_score': 0.93438846}
confusion matrix:
      0     1
0  1456    58
1   141  1417
---- Validation: 
scalar performance:
{'acc': 0.5046584, 'precision': 0.6494062, 'recall': 0.5113769, 'specificity': 0.5113769, 'f1': 0.36142686, 'auroc': 0.6575973, 'binary_precision': 0.49881235, 'binary_recall': 0.992126, 'binary_specificity': 0.030627871, 'binary_f1_score': 0.6638567}
confusion matrix:
    0    1
0  20  633
1   5  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.76121145, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
better model found
persisted
after epoch: 2,now: 2024-07-27 14:37:43.625106,epoch time: 0:01:54.736404,used: 0:04:33.060551,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9267578, 'precision': 0.9328821, 'recall': 0.92604184, 'specificity': 0.92604184, 'f1': 0.926404, 'auroc': 0.9909847, 'binary_precision': 0.88439304, 'binary_recall': 0.98392284, 'binary_specificity': 0.86816084, 'binary_f1_score': 0.9315068}
confusion matrix:
      0     1
0  1317   200
1    25  1530
---- Validation: 
scalar performance:
{'acc': 0.72981364, 'precision': 0.7659228, 'recall': 0.73234373, 'specificity': 0.73234373, 'f1': 0.72169405, 'auroc': 0.7969107, 'binary_precision': 0.6643757, 'binary_recall': 0.9133858, 'binary_specificity': 0.55130166, 'binary_f1_score': 0.7692308}
confusion matrix:
     0    1
0  360  293
1   55  580
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75348836, 'precision': 0.77648, 'recall': 0.7534884, 'specificity': 0.7534884, 'f1': 0.74825466, 'auroc': 0.85050297, 'binary_precision': 0.6967509, 'binary_recall': 0.89767444, 'binary_specificity': 0.60930234, 'binary_f1_score': 0.7845528}
confusion matrix:
     0    1
0  131   84
1   22  193
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-27 14:39:38.274976,epoch time: 0:01:54.649870,used: 0:06:27.710421,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9554036, 'precision': 0.9567932, 'recall': 0.9558182, 'specificity': 0.9558182, 'f1': 0.9553904, 'auroc': 0.9930377, 'binary_precision': 0.9856361, 'binary_recall': 0.9254978, 'binary_specificity': 0.98613864, 'binary_f1_score': 0.9546207}
confusion matrix:
      0     1
0  1494    21
1   116  1441
---- Validation: 
scalar performance:
{'acc': 0.70108694, 'precision': 0.70913076, 'recall': 0.70238507, 'specificity': 0.70238507, 'f1': 0.6990097, 'auroc': 0.7362796, 'binary_precision': 0.6644737, 'binary_recall': 0.79527557, 'binary_specificity': 0.6094946, 'binary_f1_score': 0.72401434}
confusion matrix:
     0    1
0  398  255
1  130  505
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.73023254, 'precision': 0.7469888, 'recall': 0.7302326, 'specificity': 0.7302326, 'f1': 0.72557825, 'auroc': 0.769735, 'binary_precision': 0.6826568, 'binary_recall': 0.8604651, 'binary_specificity': 0.6, 'binary_f1_score': 0.7613169}
confusion matrix:
     0    1
0  129   86
1   30  185
early stop counter: 1
val acc:0.7010869383811951, best validation acc: 0.7298136353492737, corresponding to test acc:                         0.7534883618354797 / 0.7534883618354797
after epoch: 4,now: 2024-07-27 14:41:32.671302,epoch time: 0:01:54.396326,used: 0:08:22.106747,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9514974, 'precision': 0.954936, 'recall': 0.9520954, 'specificity': 0.9520954, 'f1': 0.95144284, 'auroc': 0.99492395, 'binary_precision': 0.9978769, 'binary_recall': 0.90616965, 'binary_specificity': 0.9980211, 'binary_f1_score': 0.94981474}
confusion matrix:
      0     1
0  1513     3
1   146  1410
---- Validation: 
scalar performance:
{'acc': 0.6273292, 'precision': 0.6520755, 'recall': 0.6243696, 'specificity': 0.6243696, 'f1': 0.60828435, 'auroc': 0.76406527, 'binary_precision': 0.7100271, 'binary_recall': 0.41259843, 'binary_specificity': 0.8361409, 'binary_f1_score': 0.5219123}
confusion matrix:
     0    1
0  546  107
1  373  262
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7116279, 'precision': 0.7437035, 'recall': 0.7116279, 'specificity': 0.7116279, 'f1': 0.70181644, 'auroc': 0.84828556, 'binary_precision': 0.8321168, 'binary_recall': 0.53023255, 'binary_specificity': 0.89302325, 'binary_f1_score': 0.6477273}
confusion matrix:
     0    1
0  192   23
1  101  114
early stop counter: 2
val acc:0.6273291707038879, best validation acc: 0.7298136353492737, corresponding to test acc:                         0.7534883618354797 / 0.7534883618354797
after epoch: 5,now: 2024-07-27 14:43:27.770975,epoch time: 0:01:55.099673,used: 0:10:17.206420,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9593099, 'precision': 0.9615835, 'recall': 0.95977485, 'specificity': 0.95977485, 'f1': 0.959283, 'auroc': 0.9959847, 'binary_precision': 0.9972184, 'binary_recall': 0.9221865, 'binary_specificity': 0.9973632, 'binary_f1_score': 0.95823586}
confusion matrix:
      0     1
0  1513     4
1   121  1434
---- Validation: 
scalar performance:
{'acc': 0.65993786, 'precision': 0.680678, 'recall': 0.65746224, 'specificity': 0.65746224, 'f1': 0.647706, 'auroc': 0.7809962, 'binary_precision': 0.7384988, 'binary_recall': 0.48031497, 'binary_specificity': 0.8346095, 'binary_f1_score': 0.5820611}
confusion matrix:
     0    1
0  545  108
1  330  305
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7906977, 'precision': 0.79274964, 'recall': 0.7906977, 'specificity': 0.7906977, 'f1': 0.7903303, 'auroc': 0.8635262, 'binary_precision': 0.8172589, 'binary_recall': 0.74883723, 'binary_specificity': 0.83255816, 'binary_f1_score': 0.78155345}
confusion matrix:
     0    1
0  179   36
1   54  161
new oracle model saved
early stop counter: 3
val acc:0.659937858581543, best validation acc: 0.7298136353492737, corresponding to test acc:                         0.7534883618354797 / 0.7906976938247681
after epoch: 6,now: 2024-07-27 14:45:22.629887,epoch time: 0:01:54.858912,used: 0:12:12.065332,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9430339, 'precision': 0.9441476, 'recall': 0.94341046, 'specificity': 0.94341046, 'f1': 0.94302166, 'auroc': 0.9897908, 'binary_precision': 0.97006804, 'binary_recall': 0.9158638, 'binary_specificity': 0.9709571, 'binary_f1_score': 0.94218695}
confusion matrix:
      0     1
0  1471    44
1   131  1426
---- Validation: 
scalar performance:
{'acc': 0.63586956, 'precision': 0.70996416, 'recall': 0.63993317, 'specificity': 0.63993317, 'f1': 0.60445136, 'auroc': 0.7773715, 'binary_precision': 0.58169293, 'binary_recall': 0.93070865, 'binary_specificity': 0.34915772, 'binary_f1_score': 0.7159298}
confusion matrix:
     0    1
0  228  425
1   44  591
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7186046, 'precision': 0.78050745, 'recall': 0.7186046, 'specificity': 0.7186046, 'f1': 0.7021735, 'auroc': 0.8903407, 'binary_precision': 0.64873415, 'binary_recall': 0.95348835, 'binary_specificity': 0.48372093, 'binary_f1_score': 0.77212805}
confusion matrix:
     0    1
0  104  111
1   10  205
early stop counter: 4
val acc:0.635869562625885, best validation acc: 0.7298136353492737, corresponding to test acc:                         0.7534883618354797 / 0.7906976938247681
after epoch: 7,now: 2024-07-27 14:47:16.987642,epoch time: 0:01:54.357755,used: 0:14:06.423087,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.95996094, 'precision': 0.96011806, 'recall': 0.95985997, 'specificity': 0.95985997, 'f1': 0.95994407, 'auroc': 0.9940797, 'binary_precision': 0.95437264, 'binary_recall': 0.9672447, 'binary_specificity': 0.95247525, 'binary_f1_score': 0.96076554}
confusion matrix:
      0     1
0  1443    72
1    51  1506
---- Validation: 
scalar performance:
{'acc': 0.78571427, 'precision': 0.7879127, 'recall': 0.78630185, 'specificity': 0.78630185, 'f1': 0.78550744, 'auroc': 0.840026, 'binary_precision': 0.7590188, 'binary_recall': 0.82834643, 'binary_specificity': 0.7442573, 'binary_f1_score': 0.7921687}
confusion matrix:
     0    1
0  486  167
1  109  526
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82093024, 'precision': 0.82402146, 'recall': 0.82093024, 'specificity': 0.82093024, 'f1': 0.8205021, 'auroc': 0.88053, 'binary_precision': 0.7923729, 'binary_recall': 0.8697674, 'binary_specificity': 0.772093, 'binary_f1_score': 0.8292683}
confusion matrix:
     0    1
0  166   49
1   28  187
new oracle model saved
better model found
persisted
after epoch: 8,now: 2024-07-27 14:49:12.386243,epoch time: 0:01:55.398601,used: 0:16:01.821688,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.976888, 'precision': 0.9769654, 'recall': 0.9770093, 'specificity': 0.9770093, 'f1': 0.97688794, 'auroc': 0.9978949, 'binary_precision': 0.98687667, 'binary_recall': 0.96720254, 'binary_specificity': 0.9868161, 'binary_f1_score': 0.9769406}
confusion matrix:
      0     1
0  1497    20
1    51  1504
---- Validation: 
scalar performance:
{'acc': 0.7841615, 'precision': 0.78592116, 'recall': 0.7835767, 'specificity': 0.7835767, 'f1': 0.78355825, 'auroc': 0.86029106, 'binary_precision': 0.8051282, 'binary_recall': 0.7417323, 'binary_specificity': 0.82542115, 'binary_f1_score': 0.7721312}
confusion matrix:
     0    1
0  539  114
1  164  471
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80465114, 'precision': 0.8063477, 'recall': 0.80465114, 'specificity': 0.80465114, 'f1': 0.8043803, 'auroc': 0.83595455, 'binary_precision': 0.8291457, 'binary_recall': 0.76744187, 'binary_specificity': 0.8418605, 'binary_f1_score': 0.7971014}
confusion matrix:
     0    1
0  181   34
1   50  165
early stop counter: 1
val acc:0.7841615080833435, best validation acc: 0.7857142686843872, corresponding to test acc:                         0.8209302425384521 / 0.8209302425384521
after epoch: 9,now: 2024-07-27 14:51:07.442435,epoch time: 0:01:55.056192,used: 0:17:56.877880,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9319661, 'precision': 0.93795466, 'recall': 0.9311923, 'specificity': 0.9311923, 'f1': 0.93163747, 'auroc': 0.99529135, 'binary_precision': 0.8900463, 'binary_recall': 0.987797, 'binary_specificity': 0.8745875, 'binary_f1_score': 0.9363774}
confusion matrix:
      0     1
0  1325   190
1    19  1538
---- Validation: 
scalar performance:
{'acc': 0.7282609, 'precision': 0.76015306, 'recall': 0.73066044, 'specificity': 0.73066044, 'f1': 0.72098434, 'auroc': 0.80216694, 'binary_precision': 0.66550523, 'binary_recall': 0.9023622, 'binary_specificity': 0.55895865, 'binary_f1_score': 0.76604277}
confusion matrix:
     0    1
0  365  288
1   62  573
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7744186, 'precision': 0.78945327, 'recall': 0.7744186, 'specificity': 0.7744186, 'f1': 0.77145076, 'auroc': 0.8605517, 'binary_precision': 0.7234849, 'binary_recall': 0.88837206, 'binary_specificity': 0.6604651, 'binary_f1_score': 0.79749477}
confusion matrix:
     0    1
0  142   73
1   24  191
early stop counter: 2
val acc:0.72826087474823, best validation acc: 0.7857142686843872, corresponding to test acc:                         0.8209302425384521 / 0.8209302425384521
after epoch: 10,now: 2024-07-27 14:53:02.261479,epoch time: 0:01:54.819044,used: 0:19:51.696924,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9638672, 'precision': 0.96503603, 'recall': 0.9642299, 'specificity': 0.9642299, 'f1': 0.9638588, 'auroc': 0.9962851, 'binary_precision': 0.9918312, 'binary_recall': 0.9363753, 'binary_specificity': 0.99208444, 'binary_f1_score': 0.96330583}
confusion matrix:
      0     1
0  1504    12
1    99  1457
---- Validation: 
scalar performance:
{'acc': 0.70962733, 'precision': 0.7204739, 'recall': 0.71111166, 'specificity': 0.71111166, 'f1': 0.70691085, 'auroc': 0.7481352, 'binary_precision': 0.66795367, 'binary_recall': 0.81732285, 'binary_specificity': 0.6049005, 'binary_f1_score': 0.7351275}
confusion matrix:
     0    1
0  395  258
1  116  519
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.76744187, 'precision': 0.77913254, 'recall': 0.76744187, 'specificity': 0.76744187, 'f1': 0.76498115, 'auroc': 0.7976527, 'binary_precision': 0.72200775, 'binary_recall': 0.8697674, 'binary_specificity': 0.66511625, 'binary_f1_score': 0.78902954}
confusion matrix:
     0    1
0  143   72
1   28  187
early stop counter: 3
val acc:0.7096273303031921, best validation acc: 0.7857142686843872, corresponding to test acc:                         0.8209302425384521 / 0.8209302425384521
after epoch: 11,now: 2024-07-27 14:54:57.083529,epoch time: 0:01:54.822050,used: 0:21:46.518974,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.96972656, 'precision': 0.970309, 'recall': 0.9695105, 'specificity': 0.9695105, 'f1': 0.9697011, 'auroc': 0.9966373, 'binary_precision': 0.95695573, 'binary_recall': 0.98459566, 'binary_specificity': 0.95442533, 'binary_f1_score': 0.9705789}
confusion matrix:
      0     1
0  1445    69
1    24  1534
---- Validation: 
scalar performance:
{'acc': 0.79037267, 'precision': 0.7981901, 'recall': 0.7914821, 'specificity': 0.7914821, 'f1': 0.78938955, 'auroc': 0.8631308, 'binary_precision': 0.7462888, 'binary_recall': 0.8708661, 'binary_specificity': 0.712098, 'binary_f1_score': 0.80377907}
confusion matrix:
     0    1
0  465  188
1   82  553
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83255816, 'precision': 0.8326733, 'recall': 0.83255816, 'specificity': 0.83255816, 'f1': 0.8325436, 'auroc': 0.90840447, 'binary_precision': 0.826484, 'binary_recall': 0.8418605, 'binary_specificity': 0.82325584, 'binary_f1_score': 0.8341014}
confusion matrix:
     0    1
0  177   38
1   34  181
new oracle model saved
better model found
persisted
after epoch: 12,now: 2024-07-27 14:56:52.523304,epoch time: 0:01:55.439775,used: 0:23:41.958749,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.97753906, 'precision': 0.97764695, 'recall': 0.9777144, 'specificity': 0.9777144, 'f1': 0.9775389, 'auroc': 0.99681485, 'binary_precision': 0.9894875, 'binary_recall': 0.96600384, 'binary_specificity': 0.989425, 'binary_f1_score': 0.9776047}
confusion matrix:
      0     1
0  1497    16
1    53  1506
---- Validation: 
scalar performance:
{'acc': 0.8167702, 'precision': 0.8172525, 'recall': 0.81703824, 'specificity': 0.81703824, 'f1': 0.8167591, 'auroc': 0.89448583, 'binary_precision': 0.800905, 'binary_recall': 0.83622044, 'binary_specificity': 0.79785603, 'binary_f1_score': 0.81818175}
confusion matrix:
     0    1
0  521  132
1  104  531
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81395346, 'precision': 0.81529033, 'recall': 0.8139535, 'specificity': 0.8139535, 'f1': 0.8137561, 'auroc': 0.9038832, 'binary_precision': 0.8358209, 'binary_recall': 0.7813954, 'binary_specificity': 0.8465116, 'binary_f1_score': 0.8076923}
confusion matrix:
     0    1
0  182   33
1   47  168
better model found
persisted
after epoch: 13,now: 2024-07-27 14:58:47.437494,epoch time: 0:01:54.914190,used: 0:25:36.872939,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 14
---- Training Domain: 
scalar performance:
{'acc': 0.976888, 'precision': 0.9771515, 'recall': 0.9771217, 'specificity': 0.9771217, 'f1': 0.976888, 'auroc': 0.9975864, 'binary_precision': 0.99271524, 'binary_recall': 0.9615138, 'binary_specificity': 0.99272966, 'binary_f1_score': 0.9768654}
confusion matrix:
      0     1
0  1502    11
1    60  1499
---- Validation: 
scalar performance:
{'acc': 0.70108694, 'precision': 0.7517611, 'recall': 0.6978922, 'specificity': 0.6978922, 'f1': 0.683082, 'auroc': 0.81979954, 'binary_precision': 0.8612717, 'binary_recall': 0.46929133, 'binary_specificity': 0.9264931, 'binary_f1_score': 0.6075433}
confusion matrix:
     0    1
0  605   48
1  337  298
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7348837, 'precision': 0.7771963, 'recall': 0.7348837, 'specificity': 0.7348837, 'f1': 0.7243652, 'auroc': 0.8704597, 'binary_precision': 0.8854962, 'binary_recall': 0.53953487, 'binary_specificity': 0.9302326, 'binary_f1_score': 0.67052025}
confusion matrix:
     0    1
0  200   15
1   99  116
early stop counter: 1
val acc:0.7010869383811951, best validation acc: 0.8167701959609985, corresponding to test acc:                         0.8139534592628479 / 0.8325581550598145
after epoch: 14,now: 2024-07-27 15:00:42.609423,epoch time: 0:01:55.171929,used: 0:27:32.044868,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 15
---- Training Domain: 
scalar performance:
{'acc': 0.9742839, 'precision': 0.97427654, 'recall': 0.97428393, 'specificity': 0.97428393, 'f1': 0.9742801, 'auroc': 0.99696535, 'binary_precision': 0.97490346, 'binary_recall': 0.97427654, 'binary_specificity': 0.9742914, 'binary_f1_score': 0.9745899}
confusion matrix:
      0     1
0  1478    39
1    40  1515
---- Validation: 
scalar performance:
{'acc': 0.68167704, 'precision': 0.7098695, 'recall': 0.67903197, 'specificity': 0.67903197, 'f1': 0.6685846, 'auroc': 0.8153839, 'binary_precision': 0.7833753, 'binary_recall': 0.48976377, 'binary_specificity': 0.86830014, 'binary_f1_score': 0.60271317}
confusion matrix:
     0    1
0  567   86
1  324  311
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6395349, 'precision': 0.70742214, 'recall': 0.6395349, 'specificity': 0.6395349, 'f1': 0.60741234, 'auroc': 0.85224444, 'binary_precision': 0.82608694, 'binary_recall': 0.3534884, 'binary_specificity': 0.9255814, 'binary_f1_score': 0.495114}
confusion matrix:
     0   1
0  199  16
1  139  76
early stop counter: 2
val acc:0.6816770434379578, best validation acc: 0.8167701959609985, corresponding to test acc:                         0.8139534592628479 / 0.8325581550598145
after epoch: 15,now: 2024-07-27 15:02:38.001031,epoch time: 0:01:55.391608,used: 0:29:27.436476,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 16
---- Training Domain: 
scalar performance:
{'acc': 0.9667969, 'precision': 0.9678482, 'recall': 0.9671818, 'specificity': 0.9671818, 'f1': 0.9667913, 'auroc': 0.99510443, 'binary_precision': 0.99389416, 'binary_recall': 0.9403081, 'binary_specificity': 0.9940555, 'binary_f1_score': 0.9663589}
confusion matrix:
      0     1
0  1505     9
1    93  1465
---- Validation: 
scalar performance:
{'acc': 0.7119565, 'precision': 0.72002876, 'recall': 0.7105437, 'specificity': 0.7105437, 'f1': 0.7083616, 'auroc': 0.7829207, 'binary_precision': 0.7588235, 'binary_recall': 0.6094488, 'binary_specificity': 0.8116386, 'binary_f1_score': 0.6759825}
confusion matrix:
     0    1
0  530  123
1  248  387
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7906977, 'precision': 0.7907983, 'recall': 0.7906977, 'specificity': 0.7906977, 'f1': 0.7906796, 'auroc': 0.8419254, 'binary_precision': 0.7853881, 'binary_recall': 0.8, 'binary_specificity': 0.7813954, 'binary_f1_score': 0.7926267}
confusion matrix:
     0    1
0  168   47
1   43  172
early stop counter: 3
val acc:0.7119565010070801, best validation acc: 0.8167701959609985, corresponding to test acc:                         0.8139534592628479 / 0.8325581550598145
after epoch: 16,now: 2024-07-27 15:04:33.516596,epoch time: 0:01:55.515565,used: 0:31:22.952041,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 17
---- Training Domain: 
scalar performance:
{'acc': 0.9609375, 'precision': 0.96207035, 'recall': 0.9612955, 'specificity': 0.9612955, 'f1': 0.9609287, 'auroc': 0.99362075, 'binary_precision': 0.9884354, 'binary_recall': 0.93380463, 'binary_specificity': 0.9887863, 'binary_f1_score': 0.96034366}
confusion matrix:
      0     1
0  1499    17
1   103  1453
---- Validation: 
scalar performance:
{'acc': 0.7259317, 'precision': 0.7573726, 'recall': 0.72343636, 'specificity': 0.72343636, 'f1': 0.7158164, 'auroc': 0.8438003, 'binary_precision': 0.84390247, 'binary_recall': 0.5448819, 'binary_specificity': 0.90199083, 'binary_f1_score': 0.6622009}
confusion matrix:
     0    1
0  589   64
1  289  346
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7744186, 'precision': 0.810177, 'recall': 0.7744186, 'specificity': 0.7744186, 'f1': 0.76772416, 'auroc': 0.89763117, 'binary_precision': 0.91549295, 'binary_recall': 0.60465115, 'binary_specificity': 0.94418603, 'binary_f1_score': 0.72829133}
confusion matrix:
     0    1
0  203   12
1   85  130
early stop counter: 4
val acc:0.725931704044342, best validation acc: 0.8167701959609985, corresponding to test acc:                         0.8139534592628479 / 0.8325581550598145
after epoch: 17,now: 2024-07-27 15:06:29.035874,epoch time: 0:01:55.519278,used: 0:33:18.471319,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 18
---- Training Domain: 
scalar performance:
{'acc': 0.97233075, 'precision': 0.97281736, 'recall': 0.9726095, 'specificity': 0.9726095, 'f1': 0.97232985, 'auroc': 0.9961778, 'binary_precision': 0.99198395, 'binary_recall': 0.9531451, 'binary_specificity': 0.99207395, 'binary_f1_score': 0.97217673}
confusion matrix:
      0     1
0  1502    12
1    73  1485
---- Validation: 
scalar performance:
{'acc': 0.6746894, 'precision': 0.7282609, 'recall': 0.67122906, 'specificity': 0.67122906, 'f1': 0.65168583, 'auroc': 0.84883463, 'binary_precision': 0.83540374, 'binary_recall': 0.42362204, 'binary_specificity': 0.9188361, 'binary_f1_score': 0.5621734}
confusion matrix:
     0    1
0  600   53
1  366  269
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6976744, 'precision': 0.73132324, 'recall': 0.6976744, 'specificity': 0.6976744, 'f1': 0.68626523, 'auroc': 0.8653759, 'binary_precision': 0.81954885, 'binary_recall': 0.5069767, 'binary_specificity': 0.88837206, 'binary_f1_score': 0.62643677}
confusion matrix:
     0    1
0  191   24
1  106  109
early stop counter: 5
val acc:0.6746894121170044, best validation acc: 0.8167701959609985, corresponding to test acc:                         0.8139534592628479 / 0.8325581550598145
after epoch: 18,now: 2024-07-27 15:08:24.367596,epoch time: 0:01:55.331722,used: 0:35:13.803041,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_14_33_10_seed_0_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 18 with time: 0:35:13.803041 at 2024-07-27 15:08:24.367596
persisted model performance metric: 

scalar performance:
{'acc': 0.81395346, 'precision': 0.81529033, 'recall': 0.8139535, 'specificity': 0.8139535, 'f1': 0.8137561, 'auroc': 0.9038832, 'binary_precision': 0.8358209, 'binary_recall': 0.7813954, 'binary_specificity': 0.8465116, 'binary_f1_score': 0.8076923}
confusion matrix:
     0    1
0  182   33
1   47  168
oracle model performance metric: 

scalar performance:
{'acc': 0.83255816, 'precision': 0.8326733, 'recall': 0.83255816, 'specificity': 0.83255816, 'f1': 0.8325436, 'auroc': 0.90840447, 'binary_precision': 0.826484, 'binary_recall': 0.8418605, 'binary_specificity': 0.82325584, 'binary_f1_score': 0.8341014}
confusion matrix:
     0    1
0  177   38
1   34  181
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 456776 KiB |   3602 MiB |  65885 GiB |  65885 GiB |
|       from large pool | 416173 KiB |   3569 MiB |  65131 GiB |  65130 GiB |
|       from small pool |  40602 KiB |     56 MiB |    754 GiB |    754 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 456776 KiB |   3602 MiB |  65885 GiB |  65885 GiB |
|       from large pool | 416173 KiB |   3569 MiB |  65131 GiB |  65130 GiB |
|       from small pool |  40602 KiB |     56 MiB |    754 GiB |    754 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  65644 GiB |  65644 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  64891 GiB |  64891 GiB |
|       from small pool |  40406 KiB |     56 MiB |    752 GiB |    752 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4018 MiB |   4018 MiB |   4018 MiB |      0 B   |
|       from large pool |   3954 MiB |   3954 MiB |   3954 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 348088 KiB | 496525 KiB |  48365 GiB |  48365 GiB |
|       from large pool | 341586 KiB | 492852 KiB |  47596 GiB |  47595 GiB |
|       from small pool |   6501 KiB |  14115 KiB |    769 GiB |    769 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1697    |   11421 K  |   11420 K  |
|       from large pool |     187    |     468    |    5968 K  |    5968 K  |
|       from small pool |    1131    |    1435    |    5453 K  |    5451 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1697    |   11421 K  |   11420 K  |
|       from large pool |     187    |     468    |    5968 K  |    5968 K  |
|       from small pool |    1131    |    1435    |    5453 K  |    5451 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     197    |     197    |     197    |       0    |
|       from large pool |     165    |     165    |     165    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      83    |     250    |    6525 K  |    6525 K  |
|       from large pool |      32    |     164    |    3797 K  |    3797 K  |
|       from small pool |      51    |     218    |    2727 K  |    2727 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  65885 GiB |  65885 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  65131 GiB |  65131 GiB |
|       from small pool |      0 KiB |     56 MiB |    754 GiB |    754 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  65885 GiB |  65885 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  65131 GiB |  65131 GiB |
|       from small pool |      0 KiB |     56 MiB |    754 GiB |    754 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  65644 GiB |  65644 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  64891 GiB |  64891 GiB |
|       from small pool |      0 KiB |     56 MiB |    752 GiB |    752 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4018 MiB |   4018 MiB |   3232 MiB |
|       from large pool |    740 MiB |   3954 MiB |   3954 MiB |   3214 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  48366 GiB |  48366 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  47596 GiB |  47596 GiB |
|       from small pool |      0 KiB |  22317 KiB |    769 GiB |    769 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |   11421 K  |   11421 K  |
|       from large pool |       2    |     468    |    5968 K  |    5968 K  |
|       from small pool |       0    |    1435    |    5453 K  |    5453 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |   11421 K  |   11421 K  |
|       from large pool |       2    |     468    |    5968 K  |    5968 K  |
|       from small pool |       0    |    1435    |    5453 K  |    5453 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     197    |     197    |     140    |
|       from large pool |      34    |     165    |     165    |     131    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     250    |    6525 K  |    6525 K  |
|       from large pool |       3    |     164    |    3797 K  |    3797 K  |
|       from small pool |       0    |     218    |    2727 K  |    2727 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  65885 GiB |  65885 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  65131 GiB |  65131 GiB |
|       from small pool |      0 KiB |     56 MiB |    754 GiB |    754 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  65885 GiB |  65885 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  65131 GiB |  65131 GiB |
|       from small pool |      0 KiB |     56 MiB |    754 GiB |    754 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  65644 GiB |  65644 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  64891 GiB |  64891 GiB |
|       from small pool |      0 KiB |     56 MiB |    752 GiB |    752 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4018 MiB |   4018 MiB |   3232 MiB |
|       from large pool |    740 MiB |   3954 MiB |   3954 MiB |   3214 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  48366 GiB |  48366 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  47596 GiB |  47596 GiB |
|       from small pool |      0 KiB |  22317 KiB |    769 GiB |    769 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |   11421 K  |   11421 K  |
|       from large pool |       2    |     468    |    5968 K  |    5968 K  |
|       from small pool |       0    |    1435    |    5453 K  |    5453 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |   11421 K  |   11421 K  |
|       from large pool |       2    |     468    |    5968 K  |    5968 K  |
|       from small pool |       0    |    1435    |    5453 K  |    5453 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     197    |     197    |     140    |
|       from large pool |      34    |     165    |     165    |     131    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     250    |    6525 K  |    6525 K  |
|       from large pool |       3    |     164    |    3797 K  |    3797 K  |
|       from small pool |       0    |     218    |    2727 K  |    2727 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105

 Experiment start at: 2024-07-27 15:09:01.639046
before training, model accuracy: 0.5911111235618591
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 15:11:42.277992,epoch time: 0:02:40.638946,used: 0:02:40.638946,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 1
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 2,now: 2024-07-27 15:13:37.722256,epoch time: 0:01:55.444264,used: 0:04:36.083210,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.5058594, 'precision': 0.2529297, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33592737, 'auroc': 0.5, 'binary_precision': 0.5058594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67185473}
confusion matrix:
   0     1
0  0  1518
1  0  1554
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 2
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 15:15:33.450252,epoch time: 0:01:55.727996,used: 0:06:31.811206,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 3
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 15:17:29.585488,epoch time: 0:01:56.135236,used: 0:08:27.946442,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 4
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 15:19:25.816696,epoch time: 0:01:56.231208,used: 0:10:24.177650,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 5
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 15:21:21.911990,epoch time: 0:01:56.095294,used: 0:12:20.272944,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_09_01_seed_1_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:12:20.272944 at 2024-07-27 15:21:21.911990
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 456876 KiB |   3602 MiB |  88536 GiB |  88536 GiB |
|       from large pool | 416267 KiB |   3569 MiB |  87513 GiB |  87513 GiB |
|       from small pool |  40608 KiB |     60 MiB |   1023 GiB |   1023 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 456876 KiB |   3602 MiB |  88536 GiB |  88536 GiB |
|       from large pool | 416267 KiB |   3569 MiB |  87513 GiB |  87513 GiB |
|       from small pool |  40608 KiB |     60 MiB |   1023 GiB |   1023 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447482 KiB |   3596 MiB |  88278 GiB |  88278 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  87257 GiB |  87256 GiB |
|       from small pool |  40407 KiB |     60 MiB |   1021 GiB |   1021 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4024 MiB |   4024 MiB |   7256 MiB |   3232 MiB |
|       from large pool |   3956 MiB |   3956 MiB |   7170 MiB |   3214 MiB |
|       from small pool |     68 MiB |     68 MiB |     86 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 347988 KiB | 496525 KiB |  64772 GiB |  64772 GiB |
|       from large pool | 339444 KiB | 492922 KiB |  63727 GiB |  63727 GiB |
|       from small pool |   8543 KiB |  22317 KiB |   1045 GiB |   1045 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1330    |    1709    |   15356 K  |   15355 K  |
|       from large pool |     187    |     468    |    8030 K  |    8030 K  |
|       from small pool |    1143    |    1447    |    7325 K  |    7324 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1330    |    1709    |   15356 K  |   15355 K  |
|       from large pool |     187    |     468    |    8030 K  |    8030 K  |
|       from small pool |    1143    |    1447    |    7325 K  |    7324 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     200    |     340    |     140    |
|       from large pool |     166    |     166    |     297    |     131    |
|       from small pool |      34    |      34    |      43    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      89    |     255    |    8940 K  |    8940 K  |
|       from large pool |      36    |     164    |    5312 K  |    5312 K  |
|       from small pool |      53    |     219    |    3627 K  |    3627 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  88536 GiB |  88536 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  87513 GiB |  87513 GiB |
|       from small pool |      0 KiB |     60 MiB |   1023 GiB |   1023 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  88536 GiB |  88536 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  87513 GiB |  87513 GiB |
|       from small pool |      0 KiB |     60 MiB |   1023 GiB |   1023 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  88278 GiB |  88278 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  87257 GiB |  87257 GiB |
|       from small pool |      0 KiB |     60 MiB |   1021 GiB |   1021 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4024 MiB |   7256 MiB |   6470 MiB |
|       from large pool |    738 MiB |   3956 MiB |   7170 MiB |   6432 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  64773 GiB |  64773 GiB |
|       from large pool |  24320 KiB | 492922 KiB |  63727 GiB |  63727 GiB |
|       from small pool |      0 KiB |  32850 KiB |   1045 GiB |   1045 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |   15356 K  |   15356 K  |
|       from large pool |       2    |     468    |    8030 K  |    8030 K  |
|       from small pool |       0    |    1447    |    7325 K  |    7325 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |   15356 K  |   15356 K  |
|       from large pool |       2    |     468    |    8030 K  |    8030 K  |
|       from small pool |       0    |    1447    |    7325 K  |    7325 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     340    |     283    |
|       from large pool |      33    |     166    |     297    |     264    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     255    |    8940 K  |    8940 K  |
|       from large pool |       3    |     164    |    5312 K  |    5312 K  |
|       from small pool |       0    |     219    |    3628 K  |    3628 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  88536 GiB |  88536 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  87513 GiB |  87513 GiB |
|       from small pool |      0 KiB |     60 MiB |   1023 GiB |   1023 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  88536 GiB |  88536 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  87513 GiB |  87513 GiB |
|       from small pool |      0 KiB |     60 MiB |   1023 GiB |   1023 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  88278 GiB |  88278 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  87257 GiB |  87257 GiB |
|       from small pool |      0 KiB |     60 MiB |   1021 GiB |   1021 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4024 MiB |   7256 MiB |   6470 MiB |
|       from large pool |    738 MiB |   3956 MiB |   7170 MiB |   6432 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  64773 GiB |  64773 GiB |
|       from large pool |  24320 KiB | 492922 KiB |  63727 GiB |  63727 GiB |
|       from small pool |      0 KiB |  32850 KiB |   1045 GiB |   1045 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |   15356 K  |   15356 K  |
|       from large pool |       2    |     468    |    8030 K  |    8030 K  |
|       from small pool |       0    |    1447    |    7325 K  |    7325 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |   15356 K  |   15356 K  |
|       from large pool |       2    |     468    |    8030 K  |    8030 K  |
|       from small pool |       0    |    1447    |    7325 K  |    7325 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     340    |     283    |
|       from large pool |      33    |     166    |     297    |     264    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     255    |    8940 K  |    8940 K  |
|       from large pool |       3    |     164    |    5312 K  |    5312 K  |
|       from small pool |       0    |     219    |    3628 K  |    3628 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105

 Experiment start at: 2024-07-27 15:21:58.517842
before training, model accuracy: 0.5254629850387573
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.62958115, 'precision': 0.77494377, 'recall': 0.62670565, 'specificity': 0.62670565, 'f1': 0.57043153, 'auroc': 0.97069716, 'binary_precision': 0.5769811, 'binary_recall': 0.99285716, 'binary_specificity': 0.26055408, 'binary_f1_score': 0.7298329}
confusion matrix:
     0     1
0  395  1121
1   11  1529
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.81151724, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.9115119, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  216
1  0  216
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 15:24:35.013284,epoch time: 0:02:36.495442,used: 0:02:36.495442,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
better model found
persisted
after epoch: 2,now: 2024-07-27 15:26:28.257522,epoch time: 0:01:53.244238,used: 0:04:29.739680,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 1
val acc:0.5133020281791687, best validation acc: 0.5133020281791687, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 15:28:21.414922,epoch time: 0:01:53.157400,used: 0:06:22.897080,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 2
val acc:0.5133020281791687, best validation acc: 0.5133020281791687, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 15:30:14.258178,epoch time: 0:01:52.843256,used: 0:08:15.740336,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 3
val acc:0.5133020281791687, best validation acc: 0.5133020281791687, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 15:32:07.413108,epoch time: 0:01:53.154930,used: 0:10:08.895266,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 4
val acc:0.5133020281791687, best validation acc: 0.5133020281791687, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 15:34:01.123467,epoch time: 0:01:53.710359,used: 0:12:02.605625,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 5
val acc:0.5133020281791687, best validation acc: 0.5133020281791687, corresponding to test acc:                         0.5 / 0.5
after epoch: 7,now: 2024-07-27 15:35:54.464134,epoch time: 0:01:53.340667,used: 0:13:55.946292,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_15_21_58_seed_2_23102105
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 0:13:55.946292 at 2024-07-27 15:35:54.464134
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.9115119, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  216
1  0  216
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_dannratio_10seeds_nofreeze_2024-07-27_14-18-24/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 455505 KiB |   3602 MiB | 114624 GiB | 114624 GiB |
|       from large pool | 414902 KiB |   3569 MiB | 113295 GiB | 113295 GiB |
|       from small pool |  40602 KiB |     60 MiB |   1328 GiB |   1328 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 455505 KiB |   3602 MiB | 114624 GiB | 114624 GiB |
|       from large pool | 414902 KiB |   3569 MiB | 113295 GiB | 113295 GiB |
|       from small pool |  40602 KiB |     60 MiB |   1328 GiB |   1328 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB | 114347 GiB | 114347 GiB |
|       from large pool | 407075 KiB |   3563 MiB | 113021 GiB | 113020 GiB |
|       from small pool |  40406 KiB |     60 MiB |   1326 GiB |   1326 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4018 MiB |   4024 MiB |  10488 MiB |   6470 MiB |
|       from large pool |   3954 MiB |   3956 MiB |  10386 MiB |   6432 MiB |
|       from small pool |     64 MiB |     68 MiB |    102 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 349359 KiB | 496525 KiB |  83816 GiB |  83816 GiB |
|       from large pool | 340809 KiB | 492922 KiB |  82459 GiB |  82459 GiB |
|       from small pool |   8549 KiB |  32850 KiB |   1357 GiB |   1357 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1709    |   19880 K  |   19879 K  |
|       from large pool |     187    |     468    |   10403 K  |   10403 K  |
|       from small pool |    1131    |    1447    |    9476 K  |    9475 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1709    |   19880 K  |   19879 K  |
|       from large pool |     187    |     468    |   10403 K  |   10403 K  |
|       from small pool |    1131    |    1447    |    9476 K  |    9475 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     197    |     200    |     480    |     283    |
|       from large pool |     165    |     166    |     429    |     264    |
|       from small pool |      32    |      34    |      51    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      85    |     255    |   11684 K  |   11684 K  |
|       from large pool |      34    |     166    |    7023 K  |    7023 K  |
|       from small pool |      51    |     219    |    4661 K  |    4661 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB | 114624 GiB | 114624 GiB |
|       from large pool |  16640 KiB |   3569 MiB | 113295 GiB | 113295 GiB |
|       from small pool |      0 KiB |     60 MiB |   1328 GiB |   1328 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB | 114624 GiB | 114624 GiB |
|       from large pool |  16640 KiB |   3569 MiB | 113295 GiB | 113295 GiB |
|       from small pool |      0 KiB |     60 MiB |   1328 GiB |   1328 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB | 114347 GiB | 114347 GiB |
|       from large pool |  16640 KiB |   3563 MiB | 113021 GiB | 113021 GiB |
|       from small pool |      0 KiB |     60 MiB |   1326 GiB |   1326 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4024 MiB |  10488 MiB |   9702 MiB |
|       from large pool |    738 MiB |   3956 MiB |  10386 MiB |   9648 MiB |
|       from small pool |     48 MiB |     68 MiB |    102 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  83817 GiB |  83817 GiB |
|       from large pool |  24320 KiB | 492922 KiB |  82459 GiB |  82459 GiB |
|       from small pool |      0 KiB |  32856 KiB |   1357 GiB |   1357 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |   19880 K  |   19880 K  |
|       from large pool |       2    |     468    |   10403 K  |   10403 K  |
|       from small pool |       0    |    1447    |    9476 K  |    9476 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |   19880 K  |   19880 K  |
|       from large pool |       2    |     468    |   10403 K  |   10403 K  |
|       from small pool |       0    |    1447    |    9476 K  |    9476 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     480    |     423    |
|       from large pool |      33    |     166    |     429    |     396    |
|       from small pool |      24    |      34    |      51    |      27    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     255    |   11685 K  |   11685 K  |
|       from large pool |       3    |     166    |    7023 K  |    7023 K  |
|       from small pool |       0    |     219    |    4661 K  |    4661 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 15:36:02 2024]
Finished job 0.
1 of 1 steps (100%) done
