Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Tue Jul 23 04:24:36 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257

 Experiment start at: 2024-07-23 04:25:17.668845
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.569767415523529
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9371745, 'precision': 0.9431204, 'recall': 0.9379566, 'specificity': 0.9379566, 'f1': 0.9370303, 'auroc': 0.9943394, 'binary_precision': 0.99780864, 'binary_recall': 0.877892, 'binary_specificity': 0.9980211, 'binary_f1_score': 0.93401706}
confusion matrix:
      0     1
0  1513     3
1   190  1366
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.67236024, 'precision': 0.77271605, 'recall': 0.6680638, 'specificity': 0.6680638, 'f1': 0.63581693, 'auroc': 0.87916946, 'binary_precision': 0.9346939, 'binary_recall': 0.36062992, 'binary_specificity': 0.9754977, 'binary_f1_score': 0.5204545}
confusion matrix:
     0    1
0  637   16
1  406  229
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.74418604, 'precision': 0.83076924, 'recall': 0.74418604, 'specificity': 0.74418604, 'f1': 0.7262732, 'auroc': 0.9255814, 'binary_precision': 1.0, 'binary_recall': 0.4883721, 'binary_specificity': 1.0, 'binary_f1_score': 0.65625}
confusion matrix:
     0    1
0  215    0
1  110  105
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-23 04:26:43.719433,epoch time: 0:01:26.050588,used: 0:01:26.050588,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97753906, 'precision': 0.97785485, 'recall': 0.97776186, 'specificity': 0.97776186, 'f1': 0.97753894, 'auroc': 0.9975946, 'binary_precision': 0.9940239, 'binary_recall': 0.96146435, 'binary_specificity': 0.9940594, 'binary_f1_score': 0.97747314}
confusion matrix:
      0     1
0  1506     9
1    60  1497
---- Validation: 
scalar performance:
{'acc': 0.6552795, 'precision': 0.7325345, 'recall': 0.6511751, 'specificity': 0.6511751, 'f1': 0.62048364, 'auroc': 0.8105148, 'binary_precision': 0.8631179, 'binary_recall': 0.35748032, 'binary_specificity': 0.9448698, 'binary_f1_score': 0.5055679}
confusion matrix:
     0    1
0  617   36
1  408  227
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83488375, 'precision': 0.8502262, 'recall': 0.8348837, 'specificity': 0.8348837, 'f1': 0.8330554, 'auroc': 0.9163872, 'binary_precision': 0.9235294, 'binary_recall': 0.73023254, 'binary_specificity': 0.9395349, 'binary_f1_score': 0.8155844}
confusion matrix:
     0    1
0  202   13
1   58  157
new oracle model saved
early stop counter: 1
val acc:0.6552795171737671, best validation acc: 0.6723602414131165, corresponding to test acc:                         0.7441860437393188 / 0.8348837494850159
after epoch: 2,now: 2024-07-23 04:28:05.436836,epoch time: 0:01:21.717403,used: 0:02:47.767991,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.98372394, 'precision': 0.9837983, 'recall': 0.98367035, 'specificity': 0.98367035, 'f1': 0.9837193, 'auroc': 0.99882317, 'binary_precision': 0.9802296, 'binary_recall': 0.9877892, 'binary_specificity': 0.97955143, 'binary_f1_score': 0.9839949}
confusion matrix:
      0     1
0  1485    31
1    19  1537
---- Validation: 
scalar performance:
{'acc': 0.6840062, 'precision': 0.7333759, 'recall': 0.6807213, 'specificity': 0.6807213, 'f1': 0.6639036, 'auroc': 0.824319, 'binary_precision': 0.8372781, 'binary_recall': 0.4456693, 'binary_specificity': 0.91577333, 'binary_f1_score': 0.5817061}
confusion matrix:
     0    1
0  598   55
1  352  283
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.855814, 'precision': 0.85609126, 'recall': 0.855814, 'specificity': 0.855814, 'f1': 0.8557859, 'auroc': 0.91260135, 'binary_precision': 0.8660287, 'binary_recall': 0.8418605, 'binary_specificity': 0.8697674, 'binary_f1_score': 0.8537736}
confusion matrix:
     0    1
0  187   28
1   34  181
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-23 04:29:27.469682,epoch time: 0:01:22.032846,used: 0:04:09.800837,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.98795575, 'precision': 0.9879399, 'recall': 0.98797405, 'specificity': 0.98797405, 'f1': 0.9879544, 'auroc': 0.9989152, 'binary_precision': 0.9896774, 'binary_recall': 0.9864952, 'binary_specificity': 0.98945284, 'binary_f1_score': 0.9880837}
confusion matrix:
      0     1
0  1501    16
1    21  1534
---- Validation: 
scalar performance:
{'acc': 0.74378884, 'precision': 0.7723577, 'recall': 0.7414814, 'specificity': 0.7414814, 'f1': 0.73564994, 'auroc': 0.8798423, 'binary_precision': 0.85714287, 'binary_recall': 0.5763779, 'binary_specificity': 0.906585, 'binary_f1_score': 0.6892655}
confusion matrix:
     0    1
0  592   61
1  269  366
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7953488, 'precision': 0.8122356, 'recall': 0.7953488, 'specificity': 0.7953488, 'f1': 0.7925438, 'auroc': 0.9032991, 'binary_precision': 0.8848485, 'binary_recall': 0.67906976, 'binary_specificity': 0.9116279, 'binary_f1_score': 0.76842105}
confusion matrix:
     0    1
0  196   19
1   69  146
better model found
persisted
after epoch: 4,now: 2024-07-23 04:30:49.547963,epoch time: 0:01:22.078281,used: 0:05:31.879118,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98307294, 'precision': 0.9832562, 'recall': 0.9829768, 'specificity': 0.9829768, 'f1': 0.983066, 'auroc': 0.9990097, 'binary_precision': 0.9765526, 'binary_recall': 0.9903599, 'binary_specificity': 0.9755937, 'binary_f1_score': 0.9834078}
confusion matrix:
      0     1
0  1479    37
1    15  1541
---- Validation: 
scalar performance:
{'acc': 0.85636646, 'precision': 0.8670156, 'recall': 0.85517716, 'specificity': 0.85517716, 'f1': 0.85500073, 'auroc': 0.9303397, 'binary_precision': 0.9261364, 'binary_recall': 0.7700787, 'binary_specificity': 0.94027567, 'binary_f1_score': 0.84092855}
confusion matrix:
     0    1
0  614   39
1  146  489
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.855814, 'precision': 0.87615776, 'recall': 0.855814, 'specificity': 0.855814, 'f1': 0.8538377, 'auroc': 0.92586255, 'binary_precision': 0.96363634, 'binary_recall': 0.73953485, 'binary_specificity': 0.97209305, 'binary_f1_score': 0.83684206}
confusion matrix:
     0    1
0  209    6
1   56  159
better model found
persisted
after epoch: 5,now: 2024-07-23 04:32:11.904413,epoch time: 0:01:22.356450,used: 0:06:54.235568,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98307294, 'precision': 0.98317945, 'recall': 0.9832072, 'specificity': 0.9832072, 'f1': 0.9830729, 'auroc': 0.9981658, 'binary_precision': 0.99408287, 'binary_recall': 0.97234726, 'binary_specificity': 0.99406725, 'binary_f1_score': 0.9830949}
confusion matrix:
      0     1
0  1508     9
1    43  1512
---- Validation: 
scalar performance:
{'acc': 0.80279505, 'precision': 0.83237237, 'recall': 0.8006946, 'specificity': 0.8006946, 'f1': 0.7975144, 'auroc': 0.9175966, 'binary_precision': 0.9280899, 'binary_recall': 0.6503937, 'binary_specificity': 0.9509954, 'binary_f1_score': 0.76481485}
confusion matrix:
     0    1
0  621   32
1  222  413
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80697674, 'precision': 0.84455127, 'recall': 0.8069768, 'specificity': 0.8069768, 'f1': 0.80156684, 'auroc': 0.9206923, 'binary_precision': 0.9583333, 'binary_recall': 0.6418605, 'binary_specificity': 0.97209305, 'binary_f1_score': 0.7688023}
confusion matrix:
     0    1
0  209    6
1   77  138
early stop counter: 1
val acc:0.8027950525283813, best validation acc: 0.8563664555549622, corresponding to test acc:                         0.8558139801025391 / 0.8558139801025391
after epoch: 6,now: 2024-07-23 04:33:34.271260,epoch time: 0:01:22.366847,used: 0:08:16.602415,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.98828125, 'precision': 0.98828125, 'recall': 0.98836404, 'specificity': 0.98836404, 'f1': 0.9882807, 'auroc': 0.99922585, 'binary_precision': 0.9947917, 'binary_recall': 0.9820051, 'binary_specificity': 0.99472296, 'binary_f1_score': 0.988357}
confusion matrix:
      0     1
0  1508     8
1    28  1528
---- Validation: 
scalar performance:
{'acc': 0.78959626, 'precision': 0.8137502, 'recall': 0.7876343, 'specificity': 0.7876343, 'f1': 0.7846604, 'auroc': 0.88573635, 'binary_precision': 0.89737993, 'binary_recall': 0.6472441, 'binary_specificity': 0.92802453, 'binary_f1_score': 0.7520585}
confusion matrix:
     0    1
0  606   47
1  224  411
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.872093, 'precision': 0.877193, 'recall': 0.872093, 'specificity': 0.872093, 'f1': 0.8716592, 'auroc': 0.93605196, 'binary_precision': 0.92105263, 'binary_recall': 0.81395346, 'binary_specificity': 0.9302326, 'binary_f1_score': 0.86419755}
confusion matrix:
     0    1
0  200   15
1   40  175
new oracle model saved
early stop counter: 2
val acc:0.7895962595939636, best validation acc: 0.8563664555549622, corresponding to test acc:                         0.8558139801025391 / 0.8720930218696594
after epoch: 7,now: 2024-07-23 04:34:56.742908,epoch time: 0:01:22.471648,used: 0:09:39.074063,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9866536, 'precision': 0.9866934, 'recall': 0.98676586, 'specificity': 0.98676586, 'f1': 0.9866534, 'auroc': 0.99874854, 'binary_precision': 0.9954218, 'binary_recall': 0.9781491, 'binary_specificity': 0.9953826, 'binary_f1_score': 0.9867099}
confusion matrix:
      0     1
0  1509     7
1    34  1522
---- Validation: 
scalar performance:
{'acc': 0.77329195, 'precision': 0.79624087, 'recall': 0.77131593, 'specificity': 0.77131593, 'f1': 0.76791763, 'auroc': 0.88967454, 'binary_precision': 0.8752735, 'binary_recall': 0.62992126, 'binary_specificity': 0.91271055, 'binary_f1_score': 0.73260075}
confusion matrix:
     0    1
0  596   57
1  235  400
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.74418604, 'precision': 0.8151084, 'recall': 0.74418604, 'specificity': 0.74418604, 'f1': 0.7289336, 'auroc': 0.89458084, 'binary_precision': 0.96460176, 'binary_recall': 0.5069767, 'binary_specificity': 0.98139536, 'binary_f1_score': 0.6646341}
confusion matrix:
     0    1
0  211    4
1  106  109
early stop counter: 3
val acc:0.7732919454574585, best validation acc: 0.8563664555549622, corresponding to test acc:                         0.8558139801025391 / 0.8720930218696594
after epoch: 8,now: 2024-07-23 04:36:19.139824,epoch time: 0:01:22.396916,used: 0:11:01.470979,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98079425, 'precision': 0.98126984, 'recall': 0.98104113, 'specificity': 0.98104113, 'f1': 0.98079354, 'auroc': 0.99978507, 'binary_precision': 1.0, 'binary_recall': 0.96208227, 'binary_specificity': 1.0, 'binary_f1_score': 0.98067474}
confusion matrix:
      0     1
0  1516     0
1    59  1497
---- Validation: 
scalar performance:
{'acc': 0.73059005, 'precision': 0.80279505, 'recall': 0.72714067, 'specificity': 0.72714067, 'f1': 0.7115394, 'auroc': 0.92496896, 'binary_precision': 0.94720495, 'binary_recall': 0.48031497, 'binary_specificity': 0.9739663, 'binary_f1_score': 0.63740855}
confusion matrix:
     0    1
0  636   17
1  330  305
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7093023, 'precision': 0.81113327, 'recall': 0.7093023, 'specificity': 0.7093023, 'f1': 0.68339705, 'auroc': 0.91508925, 'binary_precision': 0.98913044, 'binary_recall': 0.4232558, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.5928339}
confusion matrix:
     0   1
0  214   1
1  124  91
early stop counter: 4
val acc:0.7305900454521179, best validation acc: 0.8563664555549622, corresponding to test acc:                         0.8558139801025391 / 0.8720930218696594
after epoch: 9,now: 2024-07-23 04:37:42.106166,epoch time: 0:01:22.966342,used: 0:12:24.437321,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9876302, 'precision': 0.9877242, 'recall': 0.9877506, 'specificity': 0.9877506, 'f1': 0.98763025, 'auroc': 0.9995295, 'binary_precision': 0.99802893, 'binary_recall': 0.9774775, 'binary_specificity': 0.9980237, 'binary_f1_score': 0.98764634}
confusion matrix:
      0     1
0  1515     3
1    35  1519
---- Validation: 
scalar performance:
{'acc': 0.61568326, 'precision': 0.74604833, 'recall': 0.6105184, 'specificity': 0.6105184, 'f1': 0.5515746, 'auroc': 0.8696386, 'binary_precision': 0.92168677, 'binary_recall': 0.24094488, 'binary_specificity': 0.98009187, 'binary_f1_score': 0.38202247}
confusion matrix:
     0    1
0  640   13
1  482  153
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5232558, 'precision': 0.7143142, 'recall': 0.5232558, 'specificity': 0.5232558, 'f1': 0.38653085, 'auroc': 0.9007896, 'binary_precision': 0.9166667, 'binary_recall': 0.05116279, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.0969163}
confusion matrix:
     0   1
0  214   1
1  204  11
early stop counter: 5
val acc:0.6156832575798035, best validation acc: 0.8563664555549622, corresponding to test acc:                         0.8558139801025391 / 0.8720930218696594
after epoch: 10,now: 2024-07-23 04:39:04.504285,epoch time: 0:01:22.398119,used: 0:13:46.835440,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_25_17_seed_0_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 10 with time: 0:13:46.835440 at 2024-07-23 04:39:04.504285
persisted model performance metric: 

scalar performance:
{'acc': 0.855814, 'precision': 0.87615776, 'recall': 0.855814, 'specificity': 0.855814, 'f1': 0.8538377, 'auroc': 0.92586255, 'binary_precision': 0.96363634, 'binary_recall': 0.73953485, 'binary_specificity': 0.97209305, 'binary_f1_score': 0.83684206}
confusion matrix:
     0    1
0  209    6
1   56  159
oracle model performance metric: 

scalar performance:
{'acc': 0.872093, 'precision': 0.877193, 'recall': 0.872093, 'specificity': 0.872093, 'f1': 0.8716592, 'auroc': 0.93605196, 'binary_precision': 0.92105263, 'binary_recall': 0.81395346, 'binary_specificity': 0.9302326, 'binary_f1_score': 0.86419755}
confusion matrix:
     0    1
0  200   15
1   40  175
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454592 KiB |   3644 MiB |  21972 GiB |  21972 GiB |
|       from large pool | 414039 KiB |   3611 MiB |  21822 GiB |  21822 GiB |
|       from small pool |  40553 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454592 KiB |   3644 MiB |  21972 GiB |  21972 GiB |
|       from large pool | 414039 KiB |   3611 MiB |  21822 GiB |  21822 GiB |
|       from small pool |  40553 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447480 KiB |   3642 MiB |  21966 GiB |  21965 GiB |
|       from large pool | 407075 KiB |   3608 MiB |  21816 GiB |  21816 GiB |
|       from small pool |  40405 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4030 MiB |   4030 MiB |   4030 MiB |      0 B   |
|       from large pool |   3966 MiB |   3966 MiB |   3966 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 550975 KiB | 640882 KiB |  10767 GiB |  10767 GiB |
|       from large pool | 544425 KiB | 634037 KiB |  10610 GiB |  10610 GiB |
|       from small pool |   6550 KiB |  12114 KiB |    157 GiB |    157 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1220    |    1591    |    2149 K  |    2148 K  |
|       from large pool |     187    |     311    |    1038 K  |    1037 K  |
|       from small pool |    1033    |    1329    |    1111 K  |    1110 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1220    |    1591    |    2149 K  |    2148 K  |
|       from large pool |     187    |     311    |    1038 K  |    1037 K  |
|       from small pool |    1033    |    1329    |    1111 K  |    1110 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     150    |     150    |     150    |       0    |
|       from large pool |     118    |     118    |     118    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      68    |     155    |    1309 K  |    1309 K  |
|       from large pool |      32    |     117    |     823 K  |     823 K  |
|       from small pool |      36    |     123    |     485 K  |     485 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  21972 GiB |  21972 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  21822 GiB |  21822 GiB |
|       from small pool |      0 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  21972 GiB |  21972 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  21822 GiB |  21822 GiB |
|       from small pool |      0 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  21966 GiB |  21966 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  21816 GiB |  21816 GiB |
|       from small pool |      0 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    982 MiB |   4030 MiB |   4030 MiB |   3048 MiB |
|       from large pool |    936 MiB |   3966 MiB |   3966 MiB |   3030 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 640882 KiB |  10768 GiB |  10768 GiB |
|       from large pool |   3840 KiB | 634037 KiB |  10611 GiB |  10611 GiB |
|       from small pool |      0 KiB |  21810 KiB |    157 GiB |    157 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1591    |    2149 K  |    2149 K  |
|       from large pool |       2    |     311    |    1038 K  |    1038 K  |
|       from small pool |       0    |    1329    |    1111 K  |    1111 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1591    |    2149 K  |    2149 K  |
|       from large pool |       2    |     311    |    1038 K  |    1038 K  |
|       from small pool |       0    |    1329    |    1111 K  |    1111 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     150    |     150    |      91    |
|       from large pool |      36    |     118    |     118    |      82    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     155    |    1309 K  |    1309 K  |
|       from large pool |       1    |     117    |     823 K  |     823 K  |
|       from small pool |       0    |     123    |     486 K  |     486 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  21972 GiB |  21972 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  21822 GiB |  21822 GiB |
|       from small pool |      0 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  21972 GiB |  21972 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  21822 GiB |  21822 GiB |
|       from small pool |      0 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  21966 GiB |  21966 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  21816 GiB |  21816 GiB |
|       from small pool |      0 KiB |     56 MiB |    149 GiB |    149 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    982 MiB |   4030 MiB |   4030 MiB |   3048 MiB |
|       from large pool |    936 MiB |   3966 MiB |   3966 MiB |   3030 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 640882 KiB |  10768 GiB |  10768 GiB |
|       from large pool |   3840 KiB | 634037 KiB |  10611 GiB |  10611 GiB |
|       from small pool |      0 KiB |  21810 KiB |    157 GiB |    157 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1591    |    2149 K  |    2149 K  |
|       from large pool |       2    |     311    |    1038 K  |    1038 K  |
|       from small pool |       0    |    1329    |    1111 K  |    1111 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1591    |    2149 K  |    2149 K  |
|       from large pool |       2    |     311    |    1038 K  |    1038 K  |
|       from small pool |       0    |    1329    |    1111 K  |    1111 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     150    |     150    |      91    |
|       from large pool |      36    |     118    |     118    |      82    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     155    |    1309 K  |    1309 K  |
|       from large pool |       1    |     117    |     823 K  |     823 K  |
|       from small pool |       0    |     123    |     486 K  |     486 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257

 Experiment start at: 2024-07-23 04:40:18.004243
before training, model accuracy: 0.6177777647972107
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9560547, 'precision': 0.9561557, 'recall': 0.95598805, 'specificity': 0.95598805, 'f1': 0.9560426, 'auroc': 0.99203646, 'binary_precision': 0.9515924, 'binary_recall': 0.962009, 'binary_specificity': 0.9499671, 'binary_f1_score': 0.9567723}
confusion matrix:
      0     1
0  1443    76
1    59  1494
---- Validation: 
scalar performance:
{'acc': 0.80093676, 'precision': 0.8235107, 'recall': 0.7987455, 'specificity': 0.7987455, 'f1': 0.7965549, 'auroc': 0.91003585, 'binary_precision': 0.9049676, 'binary_recall': 0.66507936, 'binary_specificity': 0.9324117, 'binary_f1_score': 0.76669717}
confusion matrix:
     0    1
0  607   44
1  211  419
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8288889, 'precision': 0.8588362, 'recall': 0.8288889, 'specificity': 0.8288889, 'f1': 0.82524276, 'auroc': 0.9142716, 'binary_precision': 0.9625, 'binary_recall': 0.6844444, 'binary_specificity': 0.97333336, 'binary_f1_score': 0.8}
confusion matrix:
     0    1
0  219    6
1   71  154
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-23 04:41:43.292296,epoch time: 0:01:25.288053,used: 0:01:25.288053,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9671224, 'precision': 0.9686781, 'recall': 0.96755695, 'specificity': 0.96755695, 'f1': 0.9671111, 'auroc': 0.9971914, 'binary_precision': 0.9993141, 'binary_recall': 0.9357739, 'binary_specificity': 0.99933994, 'binary_f1_score': 0.9665008}
confusion matrix:
      0     1
0  1514     1
1   100  1457
---- Validation: 
scalar performance:
{'acc': 0.6057767, 'precision': 0.7022219, 'recall': 0.5999744, 'specificity': 0.5999744, 'f1': 0.5456506, 'auroc': 0.8469753, 'binary_precision': 0.8378378, 'binary_recall': 0.24603175, 'binary_specificity': 0.953917, 'binary_f1_score': 0.3803681}
confusion matrix:
     0    1
0  621   30
1  475  155
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7977778, 'precision': 0.80906594, 'recall': 0.7977778, 'specificity': 0.7977778, 'f1': 0.7959143, 'auroc': 0.8619654, 'binary_precision': 0.8681319, 'binary_recall': 0.7022222, 'binary_specificity': 0.8933333, 'binary_f1_score': 0.7764128}
confusion matrix:
     0    1
0  201   24
1   67  158
early stop counter: 1
val acc:0.6057767271995544, best validation acc: 0.800936758518219, corresponding to test acc:                         0.8288888931274414 / 0.8288888931274414
after epoch: 2,now: 2024-07-23 04:43:04.928756,epoch time: 0:01:21.636460,used: 0:02:46.924513,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9736328, 'precision': 0.97456765, 'recall': 0.97397953, 'specificity': 0.97397953, 'f1': 0.973629, 'auroc': 0.99903256, 'binary_precision': 0.9993234, 'binary_recall': 0.9486191, 'binary_specificity': 0.99933994, 'binary_f1_score': 0.97331136}
confusion matrix:
      0     1
0  1514     1
1    80  1477
---- Validation: 
scalar performance:
{'acc': 0.6986729, 'precision': 0.7812381, 'recall': 0.69416285, 'specificity': 0.69416285, 'f1': 0.6717286, 'auroc': 0.8777729, 'binary_precision': 0.92957747, 'binary_recall': 0.41904762, 'binary_specificity': 0.96927804, 'binary_f1_score': 0.5776805}
confusion matrix:
     0    1
0  631   20
1  366  264
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75333333, 'precision': 0.8111656, 'recall': 0.75333333, 'specificity': 0.75333333, 'f1': 0.7413137, 'auroc': 0.88576794, 'binary_precision': 0.9453125, 'binary_recall': 0.5377778, 'binary_specificity': 0.9688889, 'binary_f1_score': 0.6855524}
confusion matrix:
     0    1
0  218    7
1  104  121
early stop counter: 2
val acc:0.698672890663147, best validation acc: 0.800936758518219, corresponding to test acc:                         0.8288888931274414 / 0.8288888931274414
after epoch: 3,now: 2024-07-23 04:44:27.093609,epoch time: 0:01:22.164853,used: 0:04:09.089366,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9817708, 'precision': 0.9820585, 'recall': 0.98165387, 'specificity': 0.98165387, 'f1': 0.9817624, 'auroc': 0.99914026, 'binary_precision': 0.97285354, 'binary_recall': 0.9916345, 'binary_specificity': 0.97167325, 'binary_f1_score': 0.98215425}
confusion matrix:
      0     1
0  1475    43
1    13  1541
---- Validation: 
scalar performance:
{'acc': 0.7876659, 'precision': 0.80997324, 'recall': 0.7854327, 'specificity': 0.7854327, 'f1': 0.782838, 'auroc': 0.88250554, 'binary_precision': 0.8891304, 'binary_recall': 0.64920634, 'binary_specificity': 0.921659, 'binary_f1_score': 0.75045866}
confusion matrix:
     0    1
0  600   51
1  221  409
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8066667, 'precision': 0.8194444, 'recall': 0.8066667, 'specificity': 0.8066667, 'f1': 0.80471385, 'auroc': 0.8868938, 'binary_precision': 0.8833333, 'binary_recall': 0.70666665, 'binary_specificity': 0.9066667, 'binary_f1_score': 0.7851852}
confusion matrix:
     0    1
0  204   21
1   66  159
early stop counter: 3
val acc:0.7876659035682678, best validation acc: 0.800936758518219, corresponding to test acc:                         0.8288888931274414 / 0.8288888931274414
after epoch: 4,now: 2024-07-23 04:45:48.635467,epoch time: 0:01:21.541858,used: 0:05:30.631224,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.95996094, 'precision': 0.96177423, 'recall': 0.960356, 'specificity': 0.960356, 'f1': 0.9599408, 'auroc': 0.99696684, 'binary_precision': 0.99378884, 'binary_recall': 0.9266409, 'binary_specificity': 0.9940711, 'binary_f1_score': 0.959041}
confusion matrix:
      0     1
0  1509     9
1   114  1440
---- Validation: 
scalar performance:
{'acc': 0.72287273, 'precision': 0.7986236, 'recall': 0.7186892, 'specificity': 0.7186892, 'f1': 0.7016038, 'auroc': 0.91605103, 'binary_precision': 0.94498384, 'binary_recall': 0.46349207, 'binary_specificity': 0.9738863, 'binary_f1_score': 0.6219382}
confusion matrix:
     0    1
0  634   17
1  338  292
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6155556, 'precision': 0.773569, 'recall': 0.6155556, 'specificity': 0.6155556, 'f1': 0.5506727, 'auroc': 0.9171753, 'binary_precision': 0.9814815, 'binary_recall': 0.23555556, 'binary_specificity': 0.9955556, 'binary_f1_score': 0.37992832}
confusion matrix:
     0   1
0  224   1
1  172  53
early stop counter: 4
val acc:0.7228727340698242, best validation acc: 0.800936758518219, corresponding to test acc:                         0.8288888931274414 / 0.8288888931274414
after epoch: 5,now: 2024-07-23 04:47:10.101185,epoch time: 0:01:21.465718,used: 0:06:52.096942,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9742839, 'precision': 0.97519493, 'recall': 0.97459006, 'specificity': 0.97459006, 'f1': 0.9742797, 'auroc': 0.99904615, 'binary_precision': 0.9993234, 'binary_recall': 0.94983923, 'binary_specificity': 0.99934083, 'binary_f1_score': 0.9739531}
confusion matrix:
      0     1
0  1516     1
1    78  1477
---- Validation: 
scalar performance:
{'acc': 0.5714286, 'precision': 0.70103574, 'recall': 0.56469536, 'specificity': 0.56469536, 'f1': 0.47964475, 'auroc': 0.8723917, 'binary_precision': 0.8584071, 'binary_recall': 0.15396826, 'binary_specificity': 0.97542244, 'binary_f1_score': 0.26110363}
confusion matrix:
     0   1
0  635  16
1  533  97
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7111111, 'precision': 0.76846945, 'recall': 0.7111111, 'specificity': 0.7111111, 'f1': 0.69481015, 'auroc': 0.87689877, 'binary_precision': 0.892562, 'binary_recall': 0.48, 'binary_specificity': 0.94222224, 'binary_f1_score': 0.6242774}
confusion matrix:
     0    1
0  212   13
1  117  108
early stop counter: 5
val acc:0.5714285969734192, best validation acc: 0.800936758518219, corresponding to test acc:                         0.8288888931274414 / 0.8288888931274414
after epoch: 6,now: 2024-07-23 04:48:31.843683,epoch time: 0:01:21.742498,used: 0:08:13.839440,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_40_17_seed_1_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:08:13.839440 at 2024-07-23 04:48:31.843683
persisted model performance metric: 

scalar performance:
{'acc': 0.8288889, 'precision': 0.8588362, 'recall': 0.8288889, 'specificity': 0.8288889, 'f1': 0.82524276, 'auroc': 0.9142716, 'binary_precision': 0.9625, 'binary_recall': 0.6844444, 'binary_specificity': 0.97333336, 'binary_f1_score': 0.8}
confusion matrix:
     0    1
0  219    6
1   71  154
oracle model performance metric: 

scalar performance:
{'acc': 0.8288889, 'precision': 0.8588362, 'recall': 0.8288889, 'specificity': 0.8288889, 'f1': 0.82524276, 'auroc': 0.9142716, 'binary_precision': 0.9625, 'binary_recall': 0.6844444, 'binary_specificity': 0.97333336, 'binary_f1_score': 0.8}
confusion matrix:
     0    1
0  219    6
1   71  154
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 451882 KiB |   3644 MiB |  35541 GiB |  35541 GiB |
|       from large pool | 411326 KiB |   3611 MiB |  35296 GiB |  35295 GiB |
|       from small pool |  40556 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 451882 KiB |   3644 MiB |  35541 GiB |  35541 GiB |
|       from large pool | 411326 KiB |   3611 MiB |  35296 GiB |  35295 GiB |
|       from small pool |  40556 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3642 MiB |  35532 GiB |  35531 GiB |
|       from large pool | 407075 KiB |   3608 MiB |  35286 GiB |  35286 GiB |
|       from small pool |  40406 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4084 MiB |   4084 MiB |   7132 MiB |   3048 MiB |
|       from large pool |   4014 MiB |   4014 MiB |   7044 MiB |   3030 MiB |
|       from small pool |     70 MiB |     70 MiB |     88 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 590549 KiB | 662353 KiB |  17460 GiB |  17459 GiB |
|       from large pool | 584002 KiB | 657915 KiB |  17202 GiB |  17201 GiB |
|       from small pool |   6547 KiB |  21810 KiB |    257 GiB |    257 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1226    |    1597    |    3474 K  |    3473 K  |
|       from large pool |     187    |     311    |    1678 K  |    1677 K  |
|       from small pool |    1039    |    1335    |    1796 K  |    1795 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1226    |    1597    |    3474 K  |    3473 K  |
|       from large pool |     187    |     311    |    1678 K  |    1677 K  |
|       from small pool |    1039    |    1335    |    1796 K  |    1795 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     156    |     156    |     247    |      91    |
|       from large pool |     121    |     121    |     203    |      82    |
|       from small pool |      35    |      35    |      44    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |     160    |    2082 K  |    2082 K  |
|       from large pool |      35    |     121    |    1330 K  |    1329 K  |
|       from small pool |      36    |     125    |     752 K  |     752 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  35541 GiB |  35541 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35296 GiB |  35295 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  35541 GiB |  35541 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35296 GiB |  35295 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  35532 GiB |  35532 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  35286 GiB |  35286 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1018 MiB |   4084 MiB |   7132 MiB |   6114 MiB |
|       from large pool |    972 MiB |   4014 MiB |   7044 MiB |   6072 MiB |
|       from small pool |     46 MiB |     70 MiB |     88 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 662353 KiB |  17460 GiB |  17460 GiB |
|       from large pool |   3840 KiB | 657915 KiB |  17202 GiB |  17202 GiB |
|       from small pool |      0 KiB |  22312 KiB |    257 GiB |    257 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1597    |    3474 K  |    3474 K  |
|       from large pool |       2    |     311    |    1678 K  |    1678 K  |
|       from small pool |       0    |    1335    |    1796 K  |    1796 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1597    |    3474 K  |    3474 K  |
|       from large pool |       2    |     311    |    1678 K  |    1678 K  |
|       from small pool |       0    |    1335    |    1796 K  |    1796 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      62    |     156    |     247    |     185    |
|       from large pool |      39    |     121    |     203    |     164    |
|       from small pool |      23    |      35    |      44    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     160    |    2082 K  |    2082 K  |
|       from large pool |       1    |     121    |    1330 K  |    1330 K  |
|       from small pool |       0    |     125    |     752 K  |     752 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  35541 GiB |  35541 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35296 GiB |  35295 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  35541 GiB |  35541 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35296 GiB |  35295 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  35532 GiB |  35532 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  35286 GiB |  35286 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1018 MiB |   4084 MiB |   7132 MiB |   6114 MiB |
|       from large pool |    972 MiB |   4014 MiB |   7044 MiB |   6072 MiB |
|       from small pool |     46 MiB |     70 MiB |     88 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 662353 KiB |  17460 GiB |  17460 GiB |
|       from large pool |   3840 KiB | 657915 KiB |  17202 GiB |  17202 GiB |
|       from small pool |      0 KiB |  22312 KiB |    257 GiB |    257 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1597    |    3474 K  |    3474 K  |
|       from large pool |       2    |     311    |    1678 K  |    1678 K  |
|       from small pool |       0    |    1335    |    1796 K  |    1796 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1597    |    3474 K  |    3474 K  |
|       from large pool |       2    |     311    |    1678 K  |    1678 K  |
|       from small pool |       0    |    1335    |    1796 K  |    1796 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      62    |     156    |     247    |     185    |
|       from large pool |      39    |     121    |     203    |     164    |
|       from small pool |      23    |      35    |      44    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     160    |    2082 K  |    2082 K  |
|       from large pool |       1    |     121    |    1330 K  |    1330 K  |
|       from small pool |       0    |     125    |     752 K  |     752 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257

 Experiment start at: 2024-07-23 04:49:46.704587
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.41203704476356506
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9305921, 'precision': 0.9386271, 'recall': 0.9311358, 'specificity': 0.9311358, 'f1': 0.9303285, 'auroc': 0.9962225, 'binary_precision': 1.0, 'binary_recall': 0.86227155, 'binary_specificity': 1.0, 'binary_f1_score': 0.9260428}
confusion matrix:
      0     1
0  1508     0
1   211  1321
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.5477308, 'precision': 0.74502033, 'recall': 0.5354531, 'specificity': 0.5354531, 'f1': 0.41542235, 'auroc': 0.8877466, 'binary_precision': 0.9583333, 'binary_recall': 0.073954985, 'binary_specificity': 0.9969512, 'binary_f1_score': 0.13731344}
confusion matrix:
     0   1
0  654   2
1  576  46
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5208333, 'precision': 0.7553191, 'recall': 0.5208333, 'specificity': 0.5208333, 'f1': 0.37802818, 'auroc': 0.8699417, 'binary_precision': 1.0, 'binary_recall': 0.041666668, 'binary_specificity': 1.0, 'binary_f1_score': 0.080000006}
confusion matrix:
     0  1
0  216  0
1  207  9
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-23 04:51:14.206361,epoch time: 0:01:27.501774,used: 0:01:27.501774,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9694079, 'precision': 0.97079957, 'recall': 0.96957624, 'specificity': 0.96957624, 'f1': 0.96939206, 'auroc': 0.99778044, 'binary_precision': 0.99791956, 'binary_recall': 0.94113797, 'binary_specificity': 0.99801457, 'binary_f1_score': 0.96869737}
confusion matrix:
      0     1
0  1508     3
1    90  1439
---- Validation: 
scalar performance:
{'acc': 0.7089202, 'precision': 0.7694253, 'recall': 0.70242286, 'specificity': 0.70242286, 'f1': 0.68730617, 'auroc': 0.86399114, 'binary_precision': 0.890625, 'binary_recall': 0.45819935, 'binary_specificity': 0.94664633, 'binary_f1_score': 0.6050955}
confusion matrix:
     0    1
0  621   35
1  337  285
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7615741, 'precision': 0.81222653, 'recall': 0.7615741, 'specificity': 0.7615741, 'f1': 0.7514953, 'auroc': 0.8706275, 'binary_precision': 0.93798447, 'binary_recall': 0.5601852, 'binary_specificity': 0.962963, 'binary_f1_score': 0.7014492}
confusion matrix:
     0    1
0  208    8
1   95  121
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-23 04:52:36.168085,epoch time: 0:01:21.961724,used: 0:02:49.463498,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9799342, 'precision': 0.9805157, 'recall': 0.9800862, 'specificity': 0.9800862, 'f1': 0.97993153, 'auroc': 0.9987633, 'binary_precision': 0.9993211, 'binary_recall': 0.9608355, 'binary_specificity': 0.9993369, 'binary_f1_score': 0.97970045}
confusion matrix:
      0     1
0  1507     1
1    60  1472
---- Validation: 
scalar performance:
{'acc': 0.5978091, 'precision': 0.76330936, 'recall': 0.5869834, 'specificity': 0.5869834, 'f1': 0.5103974, 'auroc': 0.8705151, 'binary_precision': 0.9655172, 'binary_recall': 0.1800643, 'binary_specificity': 0.99390244, 'binary_f1_score': 0.30352303}
confusion matrix:
     0    1
0  652    4
1  510  112
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5601852, 'precision': 0.6969697, 'recall': 0.5601852, 'specificity': 0.5601852, 'f1': 0.46778712, 'auroc': 0.86158264, 'binary_precision': 0.8611111, 'binary_recall': 0.14351852, 'binary_specificity': 0.9768519, 'binary_f1_score': 0.24603176}
confusion matrix:
     0   1
0  211   5
1  185  31
early stop counter: 1
val acc:0.5978090763092041, best validation acc: 0.7089201807975769, corresponding to test acc:                         0.7615740895271301 / 0.7615740895271301
after epoch: 3,now: 2024-07-23 04:53:57.600250,epoch time: 0:01:21.432165,used: 0:04:10.895663,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.98815787, 'precision': 0.9881513, 'recall': 0.9881716, 'specificity': 0.9881716, 'f1': 0.98815763, 'auroc': 0.9990179, 'binary_precision': 0.9901639, 'binary_recall': 0.9862835, 'binary_specificity': 0.9900596, 'binary_f1_score': 0.98822}
confusion matrix:
      0     1
0  1494    15
1    21  1510
---- Validation: 
scalar performance:
{'acc': 0.8270736, 'precision': 0.85312057, 'recall': 0.82343054, 'specificity': 0.82343054, 'f1': 0.82259756, 'auroc': 0.92416525, 'binary_precision': 0.94260484, 'binary_recall': 0.6864952, 'binary_specificity': 0.96036583, 'binary_f1_score': 0.79441863}
confusion matrix:
     0    1
0  630   26
1  195  427
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8217593, 'precision': 0.86586976, 'recall': 0.8217592, 'specificity': 0.8217592, 'f1': 0.81622, 'auroc': 0.93554956, 'binary_precision': 0.9929078, 'binary_recall': 0.6481481, 'binary_specificity': 0.9953704, 'binary_f1_score': 0.78431374}
confusion matrix:
     0    1
0  215    1
1   76  140
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-07-23 04:55:19.583650,epoch time: 0:01:21.983400,used: 0:05:32.879063,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.99111843, 'precision': 0.99113655, 'recall': 0.9911946, 'specificity': 0.9911946, 'f1': 0.99111825, 'auroc': 0.9995494, 'binary_precision': 0.9980211, 'binary_recall': 0.9843852, 'binary_specificity': 0.998004, 'binary_f1_score': 0.9911562}
confusion matrix:
      0     1
0  1500     3
1    24  1513
---- Validation: 
scalar performance:
{'acc': 0.8262911, 'precision': 0.85259485, 'recall': 0.82262665, 'specificity': 0.82262665, 'f1': 0.8217492, 'auroc': 0.9184059, 'binary_precision': 0.9424779, 'binary_recall': 0.68488747, 'binary_specificity': 0.96036583, 'binary_f1_score': 0.7932961}
confusion matrix:
     0    1
0  630   26
1  196  426
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8032407, 'precision': 0.8295214, 'recall': 0.8032407, 'specificity': 0.8032407, 'f1': 0.79923785, 'auroc': 0.89737654, 'binary_precision': 0.92258066, 'binary_recall': 0.662037, 'binary_specificity': 0.9444444, 'binary_f1_score': 0.7708895}
confusion matrix:
     0    1
0  204   12
1   73  143
early stop counter: 1
val acc:0.8262910842895508, best validation acc: 0.8270735740661621, corresponding to test acc:                         0.8217592835426331 / 0.8217592835426331
after epoch: 5,now: 2024-07-23 04:56:40.552175,epoch time: 0:01:20.968525,used: 0:06:53.847588,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98453945, 'precision': 0.98492354, 'recall': 0.98443425, 'specificity': 0.98443425, 'f1': 0.98453283, 'auroc': 0.99948233, 'binary_precision': 0.9732484, 'binary_recall': 0.99673843, 'binary_specificity': 0.97213006, 'binary_f1_score': 0.9848534}
confusion matrix:
      0     1
0  1465    42
1     5  1528
---- Validation: 
scalar performance:
{'acc': 0.85837245, 'precision': 0.8586056, 'recall': 0.8579596, 'specificity': 0.8579596, 'f1': 0.85816395, 'auroc': 0.91735697, 'binary_precision': 0.86326194, 'binary_recall': 0.8424437, 'binary_specificity': 0.8734756, 'binary_f1_score': 0.85272574}
confusion matrix:
     0    1
0  573   83
1   98  524
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8263889, 'precision': 0.8264519, 'recall': 0.82638884, 'specificity': 0.82638884, 'f1': 0.8263805, 'auroc': 0.9027349, 'binary_precision': 0.8309859, 'binary_recall': 0.8194444, 'binary_specificity': 0.8333333, 'binary_f1_score': 0.8251748}
confusion matrix:
     0    1
0  180   36
1   39  177
new oracle model saved
better model found
persisted
after epoch: 6,now: 2024-07-23 04:58:02.412270,epoch time: 0:01:21.860095,used: 0:08:15.707683,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.97960526, 'precision': 0.9802296, 'recall': 0.9797914, 'specificity': 0.9797914, 'f1': 0.9796027, 'auroc': 0.99914294, 'binary_precision': 1.0, 'binary_recall': 0.9595828, 'binary_specificity': 1.0, 'binary_f1_score': 0.9793746}
confusion matrix:
      0     1
0  1506     0
1    62  1472
---- Validation: 
scalar performance:
{'acc': 0.5743349, 'precision': 0.76712227, 'recall': 0.56274265, 'specificity': 0.56274265, 'f1': 0.4658258, 'auroc': 0.89117455, 'binary_precision': 0.9875, 'binary_recall': 0.12700965, 'binary_specificity': 0.9984756, 'binary_f1_score': 0.22507122}
confusion matrix:
     0   1
0  655   1
1  543  79
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5092593, 'precision': 0.75233644, 'recall': 0.5092593, 'specificity': 0.5092593, 'f1': 0.35358554, 'auroc': 0.84130657, 'binary_precision': 1.0, 'binary_recall': 0.018518519, 'binary_specificity': 1.0, 'binary_f1_score': 0.036363635}
confusion matrix:
     0  1
0  216  0
1  212  4
early stop counter: 1
val acc:0.5743349194526672, best validation acc: 0.8583724498748779, corresponding to test acc:                         0.8263888955116272 / 0.8263888955116272
after epoch: 7,now: 2024-07-23 04:59:24.007504,epoch time: 0:01:21.595234,used: 0:09:37.302917,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9838816, 'precision': 0.98420477, 'recall': 0.98398787, 'specificity': 0.98398787, 'f1': 0.98388064, 'auroc': 0.9995905, 'binary_precision': 0.9986541, 'binary_recall': 0.9693011, 'binary_specificity': 0.99867463, 'binary_f1_score': 0.9837587}
confusion matrix:
      0     1
0  1507     2
1    47  1484
---- Validation: 
scalar performance:
{'acc': 0.6651017, 'precision': 0.7705976, 'recall': 0.65657353, 'specificity': 0.65657353, 'f1': 0.6218987, 'auroc': 0.8895234, 'binary_precision': 0.93303573, 'binary_recall': 0.33601287, 'binary_specificity': 0.97713417, 'binary_f1_score': 0.49408987}
confusion matrix:
     0    1
0  641   15
1  413  209
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.662037, 'precision': 0.7684659, 'recall': 0.662037, 'specificity': 0.662037, 'f1': 0.62485725, 'auroc': 0.89761233, 'binary_precision': 0.9375, 'binary_recall': 0.3472222, 'binary_specificity': 0.9768519, 'binary_f1_score': 0.5067567}
confusion matrix:
     0   1
0  211   5
1  141  75
early stop counter: 2
val acc:0.6651017069816589, best validation acc: 0.8583724498748779, corresponding to test acc:                         0.8263888955116272 / 0.8263888955116272
after epoch: 8,now: 2024-07-23 05:00:45.456023,epoch time: 0:01:21.448519,used: 0:10:58.751436,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98618424, 'precision': 0.9863861, 'recall': 0.9862901, 'specificity': 0.9862901, 'f1': 0.986184, 'auroc': 0.99927974, 'binary_precision': 0.99866223, 'binary_recall': 0.97390735, 'binary_specificity': 0.99867284, 'binary_f1_score': 0.98612946}
confusion matrix:
      0     1
0  1505     2
1    40  1493
---- Validation: 
scalar performance:
{'acc': 0.6830986, 'precision': 0.7740843, 'recall': 0.67522895, 'specificity': 0.67522895, 'f1': 0.64849174, 'auroc': 0.8610599, 'binary_precision': 0.9254902, 'binary_recall': 0.37942123, 'binary_specificity': 0.9710366, 'binary_f1_score': 0.5381984}
confusion matrix:
     0    1
0  637   19
1  386  236
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5277778, 'precision': 0.673913, 'recall': 0.5277778, 'specificity': 0.5277778, 'f1': 0.40219778, 'auroc': 0.8534379, 'binary_precision': 0.8333333, 'binary_recall': 0.06944445, 'binary_specificity': 0.9861111, 'binary_f1_score': 0.12820514}
confusion matrix:
     0   1
0  213   3
1  201  15
early stop counter: 3
val acc:0.6830986142158508, best validation acc: 0.8583724498748779, corresponding to test acc:                         0.8263888955116272 / 0.8263888955116272
after epoch: 9,now: 2024-07-23 05:02:07.924454,epoch time: 0:01:22.468431,used: 0:12:21.219867,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.98256576, 'precision': 0.98261046, 'recall': 0.9826149, 'specificity': 0.9826149, 'f1': 0.98256576, 'auroc': 0.9988166, 'binary_precision': 0.98940396, 'binary_recall': 0.97583276, 'binary_specificity': 0.9893969, 'binary_f1_score': 0.98257154}
confusion matrix:
      0     1
0  1493    16
1    37  1494
---- Validation: 
scalar performance:
{'acc': 0.78482, 'precision': 0.828365, 'recall': 0.77989715, 'specificity': 0.77989715, 'f1': 0.77530426, 'auroc': 0.92472404, 'binary_precision': 0.9414758, 'binary_recall': 0.5948553, 'binary_specificity': 0.964939, 'binary_f1_score': 0.72906405}
confusion matrix:
     0    1
0  633   23
1  252  370
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5300926, 'precision': 0.7577566, 'recall': 0.5300926, 'specificity': 0.5300926, 'f1': 0.39692605, 'auroc': 0.88663834, 'binary_precision': 1.0, 'binary_recall': 0.060185187, 'binary_specificity': 1.0, 'binary_f1_score': 0.11353712}
confusion matrix:
     0   1
0  216   0
1  203  13
early stop counter: 4
val acc:0.784820020198822, best validation acc: 0.8583724498748779, corresponding to test acc:                         0.8263888955116272 / 0.8263888955116272
after epoch: 10,now: 2024-07-23 05:03:28.901603,epoch time: 0:01:20.977149,used: 0:13:42.197016,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.99210525, 'precision': 0.99215686, 'recall': 0.9921773, 'specificity': 0.9921773, 'f1': 0.99210525, 'auroc': 0.99969184, 'binary_precision': 1.0, 'binary_recall': 0.9843546, 'binary_specificity': 1.0, 'binary_f1_score': 0.9921156}
confusion matrix:
      0     1
0  1506     0
1    24  1510
---- Validation: 
scalar performance:
{'acc': 0.6236307, 'precision': 0.769281, 'recall': 0.61359406, 'specificity': 0.61359406, 'f1': 0.55464095, 'auroc': 0.8891429, 'binary_precision': 0.9607843, 'binary_recall': 0.2363344, 'binary_specificity': 0.99085367, 'binary_f1_score': 0.3793548}
confusion matrix:
     0    1
0  650    6
1  475  147
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5324074, 'precision': 0.70289856, 'recall': 0.5324074, 'specificity': 0.5324074, 'f1': 0.4080586, 'auroc': 0.84312844, 'binary_precision': 0.8888889, 'binary_recall': 0.074074075, 'binary_specificity': 0.9907407, 'binary_f1_score': 0.13675213}
confusion matrix:
     0   1
0  214   2
1  200  16
early stop counter: 5
val acc:0.623630702495575, best validation acc: 0.8583724498748779, corresponding to test acc:                         0.8263888955116272 / 0.8263888955116272
after epoch: 11,now: 2024-07-23 05:04:50.370486,epoch time: 0:01:21.468883,used: 0:15:03.665899,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_04_49_46_seed_2_22779257
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 11 with time: 0:15:03.665899 at 2024-07-23 05:04:50.370486
persisted model performance metric: 

scalar performance:
{'acc': 0.8263889, 'precision': 0.8264519, 'recall': 0.82638884, 'specificity': 0.82638884, 'f1': 0.8263805, 'auroc': 0.9027349, 'binary_precision': 0.8309859, 'binary_recall': 0.8194444, 'binary_specificity': 0.8333333, 'binary_f1_score': 0.8251748}
confusion matrix:
     0    1
0  180   36
1   39  177
oracle model performance metric: 

scalar performance:
{'acc': 0.8263889, 'precision': 0.8264519, 'recall': 0.82638884, 'specificity': 0.82638884, 'f1': 0.8263805, 'auroc': 0.9027349, 'binary_precision': 0.8309859, 'binary_recall': 0.8194444, 'binary_specificity': 0.8333333, 'binary_f1_score': 0.8251748}
confusion matrix:
     0    1
0  180   36
1   39  177
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs32_nofreeze_2024-07-23_01-16-41/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 452485 KiB |   3644 MiB |  59389 GiB |  59388 GiB |
|       from large pool | 411932 KiB |   3611 MiB |  58981 GiB |  58981 GiB |
|       from small pool |  40553 KiB |     60 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 452485 KiB |   3644 MiB |  59389 GiB |  59388 GiB |
|       from large pool | 411932 KiB |   3611 MiB |  58981 GiB |  58981 GiB |
|       from small pool |  40553 KiB |     60 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3642 MiB |  59373 GiB |  59373 GiB |
|       from large pool | 407075 KiB |   3608 MiB |  58966 GiB |  58966 GiB |
|       from small pool |  40406 KiB |     60 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4078 MiB |   4084 MiB |  10192 MiB |   6114 MiB |
|       from large pool |   4014 MiB |   4014 MiB |  10086 MiB |   6072 MiB |
|       from small pool |     64 MiB |     70 MiB |    106 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 583802 KiB | 662353 KiB |  28979 GiB |  28978 GiB |
|       from large pool | 577252 KiB | 657915 KiB |  28551 GiB |  28550 GiB |
|       from small pool |   6550 KiB |  22312 KiB |    427 GiB |    427 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1220    |    1597    |    5804 K  |    5803 K  |
|       from large pool |     187    |     311    |    2802 K  |    2802 K  |
|       from small pool |    1033    |    1335    |    3001 K  |    3000 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1220    |    1597    |    5804 K  |    5803 K  |
|       from large pool |     187    |     311    |    2802 K  |    2802 K  |
|       from small pool |    1033    |    1335    |    3001 K  |    3000 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     156    |     156    |     341    |     185    |
|       from large pool |     124    |     124    |     288    |     164    |
|       from small pool |      32    |      35    |      53    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |     160    |    3433 K  |    3433 K  |
|       from large pool |      36    |     124    |    2219 K  |    2219 K  |
|       from small pool |      35    |     125    |    1214 K  |    1214 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  59389 GiB |  59389 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  58981 GiB |  58981 GiB |
|       from small pool |      0 KiB |     60 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  59389 GiB |  59389 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  58981 GiB |  58981 GiB |
|       from small pool |      0 KiB |     60 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  59373 GiB |  59373 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  58966 GiB |  58966 GiB |
|       from small pool |      0 KiB |     60 MiB |    407 GiB |    407 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1012 MiB |   4084 MiB |  10192 MiB |   9180 MiB |
|       from large pool |    966 MiB |   4014 MiB |  10086 MiB |   9120 MiB |
|       from small pool |     46 MiB |     70 MiB |    106 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 662353 KiB |  28979 GiB |  28979 GiB |
|       from large pool |   3840 KiB | 657915 KiB |  28551 GiB |  28551 GiB |
|       from small pool |      0 KiB |  22315 KiB |    427 GiB |    427 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1597    |    5804 K  |    5804 K  |
|       from large pool |       2    |     311    |    2802 K  |    2802 K  |
|       from small pool |       0    |    1335    |    3001 K  |    3001 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1597    |    5804 K  |    5804 K  |
|       from large pool |       2    |     311    |    2802 K  |    2802 K  |
|       from small pool |       0    |    1335    |    3001 K  |    3001 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      62    |     156    |     341    |     279    |
|       from large pool |      39    |     124    |     288    |     249    |
|       from small pool |      23    |      35    |      53    |      30    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     160    |    3433 K  |    3433 K  |
|       from large pool |       1    |     124    |    2219 K  |    2219 K  |
|       from small pool |       0    |     125    |    1214 K  |    1214 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Tue Jul 23 05:05:36 2024]
Finished job 0.
1 of 1 steps (100%) done
