Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 01:18:58 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/20.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=20
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484

 Experiment start at: 2024-07-27 01:19:45.320061
before training, model accuracy: 0.38604649901390076
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9280599, 'precision': 0.9353504, 'recall': 0.9290627, 'specificity': 0.9290627, 'f1': 0.9278568, 'auroc': 0.9897276, 'binary_precision': 0.9955556, 'binary_recall': 0.86209106, 'binary_specificity': 0.9960344, 'binary_f1_score': 0.9240288}
confusion matrix:
      0     1
0  1507     6
1   215  1344
---- Validation: 
scalar performance:
{'acc': 0.7003106, 'precision': 0.7530371, 'recall': 0.6970614, 'specificity': 0.6970614, 'f1': 0.68162906, 'auroc': 0.8275482, 'binary_precision': 0.86510265, 'binary_recall': 0.46456692, 'binary_specificity': 0.9295559, 'binary_f1_score': 0.60450816}
confusion matrix:
     0    1
0  607   46
1  340  295
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7860465, 'precision': 0.7890732, 'recall': 0.7860465, 'specificity': 0.7860465, 'f1': 0.78548497, 'auroc': 0.85709035, 'binary_precision': 0.81865287, 'binary_recall': 0.7348837, 'binary_specificity': 0.8372093, 'binary_f1_score': 0.7745098}
confusion matrix:
     0    1
0  180   35
1   57  158
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 01:21:23.118517,epoch time: 0:01:37.798456,used: 0:01:37.798456,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.94596356, 'precision': 0.94797766, 'recall': 0.9455141, 'specificity': 0.9455141, 'f1': 0.94585425, 'auroc': 0.99334705, 'binary_precision': 0.9213075, 'binary_recall': 0.9768934, 'binary_specificity': 0.91413474, 'binary_f1_score': 0.94828653}
confusion matrix:
      0     1
0  1384   130
1    36  1522
---- Validation: 
scalar performance:
{'acc': 0.6242236, 'precision': 0.76112974, 'recall': 0.61909294, 'specificity': 0.61909294, 'f1': 0.5624361, 'auroc': 0.88004005, 'binary_precision': 0.9467456, 'binary_recall': 0.2519685, 'binary_specificity': 0.98621744, 'binary_f1_score': 0.39801}
confusion matrix:
     0    1
0  644    9
1  475  160
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7093023, 'precision': 0.81113327, 'recall': 0.7093023, 'specificity': 0.7093023, 'f1': 0.68339705, 'auroc': 0.8969172, 'binary_precision': 0.98913044, 'binary_recall': 0.4232558, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.5928339}
confusion matrix:
     0   1
0  214   1
1  124  91
early stop counter: 1
val acc:0.6242235898971558, best validation acc: 0.7003105878829956, corresponding to test acc:                         0.7860465049743652 / 0.7860465049743652
after epoch: 2,now: 2024-07-27 01:22:53.608325,epoch time: 0:01:30.489808,used: 0:03:08.288264,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.92610675, 'precision': 0.93366283, 'recall': 0.92531013, 'specificity': 0.92531013, 'f1': 0.9256792, 'auroc': 0.99524283, 'binary_precision': 0.87942857, 'binary_recall': 0.9897106, 'binary_specificity': 0.8609097, 'binary_f1_score': 0.9313162}
confusion matrix:
      0     1
0  1306   211
1    16  1539
---- Validation: 
scalar performance:
{'acc': 0.78881985, 'precision': 0.8115845, 'recall': 0.79068863, 'specificity': 0.79068863, 'f1': 0.78559345, 'auroc': 0.8814726, 'binary_precision': 0.7237978, 'binary_recall': 0.92440945, 'binary_specificity': 0.6569678, 'binary_f1_score': 0.8118949}
confusion matrix:
     0    1
0  429  224
1   48  587
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80465114, 'precision': 0.81796837, 'recall': 0.80465114, 'specificity': 0.80465114, 'f1': 0.8025842, 'auroc': 0.8866631, 'binary_precision': 0.7528958, 'binary_recall': 0.90697676, 'binary_specificity': 0.7023256, 'binary_f1_score': 0.8227848}
confusion matrix:
     0    1
0  151   64
1   20  195
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-27 01:24:24.337523,epoch time: 0:01:30.729198,used: 0:04:39.017462,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.91308594, 'precision': 0.9136745, 'recall': 0.91284263, 'specificity': 0.91284263, 'f1': 0.9130062, 'auroc': 0.96612847, 'binary_precision': 0.9011194, 'binary_recall': 0.9306358, 'binary_specificity': 0.8950495, 'binary_f1_score': 0.9156398}
confusion matrix:
      0     1
0  1356   159
1   108  1449
---- Validation: 
scalar performance:
{'acc': 0.64052796, 'precision': 0.67180693, 'recall': 0.64339876, 'specificity': 0.64339876, 'f1': 0.6261014, 'auroc': 0.77036333, 'binary_precision': 0.5949227, 'binary_recall': 0.8488189, 'binary_specificity': 0.43797857, 'binary_f1_score': 0.69954574}
confusion matrix:
     0    1
0  286  367
1   96  539
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6418605, 'precision': 0.7412531, 'recall': 0.6418605, 'specificity': 0.6418605, 'f1': 0.600738, 'auroc': 0.8368199, 'binary_precision': 0.58640224, 'binary_recall': 0.96279067, 'binary_specificity': 0.32093024, 'binary_f1_score': 0.7288732}
confusion matrix:
    0    1
0  69  146
1   8  207
early stop counter: 1
val acc:0.6405279636383057, best validation acc: 0.7888198494911194, corresponding to test acc:                         0.804651141166687 / 0.804651141166687
after epoch: 4,now: 2024-07-27 01:25:55.066059,epoch time: 0:01:30.728536,used: 0:06:09.745998,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.96028644, 'precision': 0.9617713, 'recall': 0.9607353, 'specificity': 0.9607353, 'f1': 0.9602742, 'auroc': 0.9955189, 'binary_precision': 0.9917808, 'binary_recall': 0.9293967, 'binary_specificity': 0.99207395, 'binary_f1_score': 0.9595759}
confusion matrix:
      0     1
0  1502    12
1   110  1448
---- Validation: 
scalar performance:
{'acc': 0.8175466, 'precision': 0.81906986, 'recall': 0.81802106, 'specificity': 0.81802106, 'f1': 0.8174541, 'auroc': 0.89237076, 'binary_precision': 0.79325515, 'binary_recall': 0.8519685, 'binary_specificity': 0.78407353, 'binary_f1_score': 0.8215642}
confusion matrix:
     0    1
0  512  141
1   94  541
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83023256, 'precision': 0.8323102, 'recall': 0.83023256, 'specificity': 0.83023256, 'f1': 0.8299668, 'auroc': 0.90492165, 'binary_precision': 0.8060345, 'binary_recall': 0.8697674, 'binary_specificity': 0.7906977, 'binary_f1_score': 0.836689}
confusion matrix:
     0    1
0  170   45
1   28  187
new oracle model saved
better model found
persisted
after epoch: 5,now: 2024-07-27 01:27:26.252302,epoch time: 0:01:31.186243,used: 0:07:40.932241,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.95996094, 'precision': 0.962301, 'recall': 0.96045864, 'specificity': 0.96045864, 'f1': 0.9599345, 'auroc': 0.9957696, 'binary_precision': 0.99860823, 'binary_recall': 0.9222365, 'binary_specificity': 0.9986807, 'binary_f1_score': 0.9589041}
confusion matrix:
      0     1
0  1514     2
1   121  1435
---- Validation: 
scalar performance:
{'acc': 0.7833851, 'precision': 0.80366486, 'recall': 0.78155214, 'specificity': 0.78155214, 'f1': 0.7789222, 'auroc': 0.8996756, 'binary_precision': 0.8787234, 'binary_recall': 0.6503937, 'binary_specificity': 0.91271055, 'binary_f1_score': 0.74751127}
confusion matrix:
     0    1
0  596   57
1  222  413
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81860465, 'precision': 0.82037896, 'recall': 0.8186047, 'specificity': 0.8186047, 'f1': 0.8183532, 'auroc': 0.89793396, 'binary_precision': 0.8442211, 'binary_recall': 0.7813954, 'binary_specificity': 0.855814, 'binary_f1_score': 0.8115942}
confusion matrix:
     0    1
0  184   31
1   47  168
early stop counter: 1
val acc:0.7833850979804993, best validation acc: 0.8175466060638428, corresponding to test acc:                         0.830232560634613 / 0.830232560634613
after epoch: 6,now: 2024-07-27 01:28:56.279687,epoch time: 0:01:30.027385,used: 0:09:10.959626,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9716797, 'precision': 0.97220707, 'recall': 0.9714926, 'specificity': 0.9714926, 'f1': 0.971659, 'auroc': 0.99724996, 'binary_precision': 0.9593496, 'binary_recall': 0.9858612, 'binary_specificity': 0.957124, 'binary_f1_score': 0.97242475}
confusion matrix:
      0     1
0  1451    65
1    22  1534
---- Validation: 
scalar performance:
{'acc': 0.76863354, 'precision': 0.8095577, 'recall': 0.7711495, 'specificity': 0.7711495, 'f1': 0.76181006, 'auroc': 0.8801558, 'binary_precision': 0.6934558, 'binary_recall': 0.9511811, 'binary_specificity': 0.5911179, 'binary_f1_score': 0.80212486}
confusion matrix:
     0    1
0  386  267
1   31  604
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75813955, 'precision': 0.7928293, 'recall': 0.75813955, 'specificity': 0.75813955, 'f1': 0.75075793, 'auroc': 0.8772526, 'binary_precision': 0.6920415, 'binary_recall': 0.9302326, 'binary_specificity': 0.5860465, 'binary_f1_score': 0.79365075}
confusion matrix:
     0    1
0  126   89
1   15  200
early stop counter: 2
val acc:0.7686335444450378, best validation acc: 0.8175466060638428, corresponding to test acc:                         0.830232560634613 / 0.830232560634613
after epoch: 7,now: 2024-07-27 01:30:25.985379,epoch time: 0:01:29.705692,used: 0:10:40.665318,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9720052, 'precision': 0.97209454, 'recall': 0.97193766, 'specificity': 0.97193766, 'f1': 0.97199595, 'auroc': 0.9968603, 'binary_precision': 0.96817315, 'binary_recall': 0.9768786, 'binary_specificity': 0.9669967, 'binary_f1_score': 0.9725064}
confusion matrix:
      0     1
0  1465    50
1    36  1521
---- Validation: 
scalar performance:
{'acc': 0.7282609, 'precision': 0.7610433, 'recall': 0.7257334, 'specificity': 0.7257334, 'f1': 0.71797293, 'auroc': 0.8540015, 'binary_precision': 0.85012287, 'binary_recall': 0.5448819, 'binary_specificity': 0.906585, 'binary_f1_score': 0.6641075}
confusion matrix:
     0    1
0  592   61
1  289  346
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8372093, 'precision': 0.8677945, 'recall': 0.83720934, 'specificity': 0.83720934, 'f1': 0.8337531, 'auroc': 0.9407896, 'binary_precision': 0.9738562, 'binary_recall': 0.69302326, 'binary_specificity': 0.98139536, 'binary_f1_score': 0.8097826}
confusion matrix:
     0    1
0  211    4
1   66  149
new oracle model saved
early stop counter: 3
val acc:0.72826087474823, best validation acc: 0.8175466060638428, corresponding to test acc:                         0.830232560634613 / 0.8372092843055725
after epoch: 8,now: 2024-07-27 01:31:57.371143,epoch time: 0:01:31.385764,used: 0:12:12.051082,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.97786456, 'precision': 0.97797453, 'recall': 0.977793, 'specificity': 0.977793, 'f1': 0.97785723, 'auroc': 0.9979834, 'binary_precision': 0.97328246, 'binary_recall': 0.9832905, 'binary_specificity': 0.9722955, 'binary_f1_score': 0.9782609}
confusion matrix:
      0     1
0  1474    42
1    26  1530
---- Validation: 
scalar performance:
{'acc': 0.8035714, 'precision': 0.82219374, 'recall': 0.8052369, 'specificity': 0.8052369, 'f1': 0.8012568, 'auroc': 0.9049475, 'binary_precision': 0.74116164, 'binary_recall': 0.92440945, 'binary_specificity': 0.6860643, 'binary_f1_score': 0.82270503}
confusion matrix:
     0    1
0  448  205
1   48  587
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7976744, 'precision': 0.81007755, 'recall': 0.7976744, 'specificity': 0.7976744, 'f1': 0.7956307, 'auroc': 0.9112601, 'binary_precision': 0.748062, 'binary_recall': 0.89767444, 'binary_specificity': 0.6976744, 'binary_f1_score': 0.8160677}
confusion matrix:
     0    1
0  150   65
1   22  193
early stop counter: 4
val acc:0.8035714030265808, best validation acc: 0.8175466060638428, corresponding to test acc:                         0.830232560634613 / 0.8372092843055725
after epoch: 9,now: 2024-07-27 01:33:28.116439,epoch time: 0:01:30.745296,used: 0:13:42.796378,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9547526, 'precision': 0.9578309, 'recall': 0.95528936, 'specificity': 0.95528936, 'f1': 0.95470744, 'auroc': 0.9980835, 'binary_precision': 0.99859154, 'binary_recall': 0.9118971, 'binary_specificity': 0.9986816, 'binary_f1_score': 0.95327735}
confusion matrix:
      0     1
0  1515     2
1   137  1418
---- Validation: 
scalar performance:
{'acc': 0.57841617, 'precision': 0.7402468, 'recall': 0.57259285, 'specificity': 0.57259285, 'f1': 0.48564684, 'auroc': 0.9046279, 'binary_precision': 0.9339623, 'binary_recall': 0.15590551, 'binary_specificity': 0.9892802, 'binary_f1_score': 0.26720646}
confusion matrix:
     0   1
0  646   7
1  536  99
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5488372, 'precision': 0.7628362, 'recall': 0.5488372, 'specificity': 0.5488372, 'f1': 0.43353432, 'auroc': 0.930622, 'binary_precision': 1.0, 'binary_recall': 0.09767442, 'binary_specificity': 1.0, 'binary_f1_score': 0.17796612}
confusion matrix:
     0   1
0  215   0
1  194  21
early stop counter: 5
val acc:0.5784161686897278, best validation acc: 0.8175466060638428, corresponding to test acc:                         0.830232560634613 / 0.8372092843055725
after epoch: 10,now: 2024-07-27 01:34:59.003448,epoch time: 0:01:30.887009,used: 0:15:13.683387,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_44_seed_0_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 10 with time: 0:15:13.683387 at 2024-07-27 01:34:59.003448
persisted model performance metric: 

scalar performance:
{'acc': 0.83023256, 'precision': 0.8323102, 'recall': 0.83023256, 'specificity': 0.83023256, 'f1': 0.8299668, 'auroc': 0.90492165, 'binary_precision': 0.8060345, 'binary_recall': 0.8697674, 'binary_specificity': 0.7906977, 'binary_f1_score': 0.836689}
confusion matrix:
     0    1
0  170   45
1   28  187
oracle model performance metric: 

scalar performance:
{'acc': 0.8372093, 'precision': 0.8677945, 'recall': 0.83720934, 'specificity': 0.83720934, 'f1': 0.8337531, 'auroc': 0.9407896, 'binary_precision': 0.9738562, 'binary_recall': 0.69302326, 'binary_specificity': 0.98139536, 'binary_f1_score': 0.8097826}
confusion matrix:
     0    1
0  211    4
1   66  149
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/20.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/20.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/20.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    917 MiB |  13688 MiB |  24498 GiB |  24498 GiB |
|       from large pool |    856 MiB |  13629 MiB |  24190 GiB |  24189 GiB |
|       from small pool |     60 MiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    917 MiB |  13688 MiB |  24498 GiB |  24498 GiB |
|       from large pool |    856 MiB |  13629 MiB |  24190 GiB |  24189 GiB |
|       from small pool |     60 MiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    904 MiB |  13680 MiB |  24476 GiB |  24475 GiB |
|       from large pool |    844 MiB |  13621 MiB |  24168 GiB |  24167 GiB |
|       from small pool |     60 MiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14826 MiB |  14826 MiB |  14826 MiB |      0 B   |
|       from large pool |  14720 MiB |  14720 MiB |  14720 MiB |      0 B   |
|       from small pool |    106 MiB |    106 MiB |    106 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1652 MiB |   2261 MiB |  18281 GiB |  18279 GiB |
|       from large pool |   1641 MiB |   2254 MiB |  17970 GiB |  17969 GiB |
|       from small pool |     11 MiB |     17 MiB |    310 GiB |    310 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1784    |    3095    |    4450 K  |    4448 K  |
|       from large pool |     265    |    1491    |    2204 K  |    2204 K  |
|       from small pool |    1519    |    2211    |    2246 K  |    2244 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1784    |    3095    |    4450 K  |    4448 K  |
|       from large pool |     265    |    1491    |    2204 K  |    2204 K  |
|       from small pool |    1519    |    2211    |    2246 K  |    2244 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     594    |     594    |     594    |       0    |
|       from large pool |     541    |     541    |     541    |       0    |
|       from small pool |      53    |      53    |      53    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     134    |     579    |    2727 K  |    2727 K  |
|       from large pool |      52    |     536    |    1498 K  |    1498 K  |
|       from small pool |      82    |     233    |    1229 K  |    1229 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  24498 GiB |  24498 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  24190 GiB |  24190 GiB |
|       from small pool |      0 KiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  24498 GiB |  24498 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  24190 GiB |  24190 GiB |
|       from small pool |      0 KiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  24476 GiB |  24476 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  24168 GiB |  24168 GiB |
|       from small pool |      0 KiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2570 MiB |  14826 MiB |  14826 MiB |  12256 MiB |
|       from large pool |   2498 MiB |  14720 MiB |  14720 MiB |  12222 MiB |
|       from small pool |     72 MiB |    106 MiB |    106 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2261 MiB |  18281 GiB |  18281 GiB |
|       from large pool |  24320 KiB |   2254 MiB |  17971 GiB |  17971 GiB |
|       from small pool |      0 KiB |     35 MiB |    310 GiB |    310 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3095    |    4450 K  |    4450 K  |
|       from large pool |       2    |    1491    |    2204 K  |    2204 K  |
|       from small pool |       0    |    2211    |    2246 K  |    2246 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3095    |    4450 K  |    4450 K  |
|       from large pool |       2    |    1491    |    2204 K  |    2204 K  |
|       from small pool |       0    |    2211    |    2246 K  |    2246 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      91    |     594    |     594    |     503    |
|       from large pool |      55    |     541    |     541    |     486    |
|       from small pool |      36    |      53    |      53    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     579    |    2727 K  |    2727 K  |
|       from large pool |       2    |     536    |    1498 K  |    1498 K  |
|       from small pool |       0    |     233    |    1229 K  |    1229 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  24498 GiB |  24498 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  24190 GiB |  24190 GiB |
|       from small pool |      0 KiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  24498 GiB |  24498 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  24190 GiB |  24190 GiB |
|       from small pool |      0 KiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  24476 GiB |  24476 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  24168 GiB |  24168 GiB |
|       from small pool |      0 KiB |     97 MiB |    308 GiB |    308 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2570 MiB |  14826 MiB |  14826 MiB |  12256 MiB |
|       from large pool |   2498 MiB |  14720 MiB |  14720 MiB |  12222 MiB |
|       from small pool |     72 MiB |    106 MiB |    106 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2261 MiB |  18281 GiB |  18281 GiB |
|       from large pool |  24320 KiB |   2254 MiB |  17971 GiB |  17971 GiB |
|       from small pool |      0 KiB |     35 MiB |    310 GiB |    310 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3095    |    4450 K  |    4450 K  |
|       from large pool |       2    |    1491    |    2204 K  |    2204 K  |
|       from small pool |       0    |    2211    |    2246 K  |    2246 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3095    |    4450 K  |    4450 K  |
|       from large pool |       2    |    1491    |    2204 K  |    2204 K  |
|       from small pool |       0    |    2211    |    2246 K  |    2246 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      91    |     594    |     594    |     503    |
|       from large pool |      55    |     541    |     541    |     486    |
|       from small pool |      36    |      53    |      53    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     579    |    2727 K  |    2727 K  |
|       from large pool |       2    |     536    |    1498 K  |    1498 K  |
|       from small pool |       0    |     233    |    1229 K  |    1229 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484

 Experiment start at: 2024-07-27 01:35:33.126649
before training, model accuracy: 0.5155555605888367
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9479167, 'precision': 0.9502234, 'recall': 0.9474979, 'specificity': 0.9474979, 'f1': 0.94780827, 'auroc': 0.9931359, 'binary_precision': 0.9209415, 'binary_recall': 0.9813505, 'binary_specificity': 0.9136453, 'binary_f1_score': 0.9501867}
confusion matrix:
      0     1
0  1386   131
1    29  1526
---- Validation: 
scalar performance:
{'acc': 0.68930525, 'precision': 0.7732303, 'recall': 0.69377875, 'specificity': 0.69377875, 'f1': 0.666497, 'auroc': 0.8932972, 'binary_precision': 0.61764705, 'binary_recall': 0.96666664, 'binary_specificity': 0.42089093, 'binary_f1_score': 0.75371283}
confusion matrix:
     0    1
0  274  377
1   21  609
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6511111, 'precision': 0.75351274, 'recall': 0.6511111, 'specificity': 0.6511111, 'f1': 0.6119219, 'auroc': 0.9142716, 'binary_precision': 0.5923913, 'binary_recall': 0.9688889, 'binary_specificity': 0.33333334, 'binary_f1_score': 0.7352445}
confusion matrix:
    0    1
0  75  150
1   7  218
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 01:37:09.133534,epoch time: 0:01:36.006885,used: 0:01:36.006885,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97265625, 'precision': 0.97292256, 'recall': 0.9728648, 'specificity': 0.9728648, 'f1': 0.97265613, 'auroc': 0.9967869, 'binary_precision': 0.98807156, 'binary_recall': 0.9576108, 'binary_specificity': 0.9881188, 'binary_f1_score': 0.9726027}
confusion matrix:
      0     1
0  1497    18
1    66  1491
---- Validation: 
scalar performance:
{'acc': 0.81030446, 'precision': 0.81273675, 'recall': 0.8095494, 'specificity': 0.8095494, 'f1': 0.80963445, 'auroc': 0.87266964, 'binary_precision': 0.83652174, 'binary_recall': 0.76349205, 'binary_specificity': 0.85560673, 'binary_f1_score': 0.7983403}
confusion matrix:
     0    1
0  557   94
1  149  481
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83111113, 'precision': 0.8320556, 'recall': 0.8311111, 'specificity': 0.8311111, 'f1': 0.8309909, 'auroc': 0.8979753, 'binary_precision': 0.814346, 'binary_recall': 0.8577778, 'binary_specificity': 0.80444443, 'binary_f1_score': 0.83549786}
confusion matrix:
     0    1
0  181   44
1   32  193
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 01:38:41.882535,epoch time: 0:01:32.749001,used: 0:03:08.755886,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9749349, 'precision': 0.97504413, 'recall': 0.9750507, 'specificity': 0.9750507, 'f1': 0.97493494, 'auroc': 0.9961883, 'binary_precision': 0.9855263, 'binary_recall': 0.96458465, 'binary_specificity': 0.9855168, 'binary_f1_score': 0.9749431}
confusion matrix:
      0     1
0  1497    22
1    55  1498
---- Validation: 
scalar performance:
{'acc': 0.8610461, 'precision': 0.8675277, 'recall': 0.859959, 'specificity': 0.859959, 'f1': 0.8601419, 'auroc': 0.9066174, 'binary_precision': 0.91240877, 'binary_recall': 0.7936508, 'binary_specificity': 0.92626727, 'binary_f1_score': 0.84889644}
confusion matrix:
     0    1
0  603   48
1  130  500
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86444443, 'precision': 0.86829287, 'recall': 0.86444443, 'specificity': 0.86444443, 'f1': 0.86408937, 'auroc': 0.92827654, 'binary_precision': 0.9059406, 'binary_recall': 0.81333333, 'binary_specificity': 0.91555554, 'binary_f1_score': 0.85714287}
confusion matrix:
     0    1
0  206   19
1   42  183
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-27 01:40:16.606279,epoch time: 0:01:34.723744,used: 0:04:43.479630,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9501953, 'precision': 0.95427376, 'recall': 0.95070875, 'specificity': 0.95070875, 'f1': 0.95011795, 'auroc': 0.996315, 'binary_precision': 1.0, 'binary_recall': 0.90141755, 'binary_specificity': 1.0, 'binary_f1_score': 0.9481532}
confusion matrix:
      0     1
0  1520     0
1   153  1399
---- Validation: 
scalar performance:
{'acc': 0.5800156, 'precision': 0.72952306, 'recall': 0.5732719, 'specificity': 0.5732719, 'f1': 0.48966414, 'auroc': 0.87978446, 'binary_precision': 0.91071427, 'binary_recall': 0.16190477, 'binary_specificity': 0.984639, 'binary_f1_score': 0.27493262}
confusion matrix:
     0    1
0  641   10
1  528  102
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.74666667, 'precision': 0.82051283, 'recall': 0.74666667, 'specificity': 0.74666667, 'f1': 0.73118275, 'auroc': 0.8930371, 'binary_precision': 0.974359, 'binary_recall': 0.50666666, 'binary_specificity': 0.9866667, 'binary_f1_score': 0.6666666}
confusion matrix:
     0    1
0  222    3
1  111  114
early stop counter: 1
val acc:0.5800155997276306, best validation acc: 0.8610460758209229, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 4,now: 2024-07-27 01:41:50.455716,epoch time: 0:01:33.849437,used: 0:06:17.329067,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.97786456, 'precision': 0.9784437, 'recall': 0.9781321, 'specificity': 0.9781321, 'f1': 0.97786325, 'auroc': 0.9985815, 'binary_precision': 0.9986595, 'binary_recall': 0.95758355, 'binary_specificity': 0.9986807, 'binary_f1_score': 0.9776903}
confusion matrix:
      0     1
0  1514     2
1    66  1490
---- Validation: 
scalar performance:
{'acc': 0.8149883, 'precision': 0.82589424, 'recall': 0.8134664, 'specificity': 0.8134664, 'f1': 0.8128792, 'auroc': 0.8915545, 'binary_precision': 0.8815534, 'binary_recall': 0.72063494, 'binary_specificity': 0.906298, 'binary_f1_score': 0.7930131}
confusion matrix:
     0    1
0  590   61
1  176  454
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8466667, 'precision': 0.8467283, 'recall': 0.8466667, 'specificity': 0.8466667, 'f1': 0.84665984, 'auroc': 0.9076148, 'binary_precision': 0.8513514, 'binary_recall': 0.84, 'binary_specificity': 0.85333335, 'binary_f1_score': 0.84563756}
confusion matrix:
     0    1
0  192   33
1   36  189
early stop counter: 2
val acc:0.8149883151054382, best validation acc: 0.8610460758209229, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 5,now: 2024-07-27 01:43:22.604181,epoch time: 0:01:32.148465,used: 0:07:49.477532,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9860026, 'precision': 0.9859768, 'recall': 0.98604167, 'specificity': 0.98604167, 'f1': 0.9860008, 'auroc': 0.999195, 'binary_precision': 0.9890252, 'binary_recall': 0.98331195, 'binary_specificity': 0.98877144, 'binary_f1_score': 0.9861603}
confusion matrix:
      0     1
0  1497    17
1    26  1532
---- Validation: 
scalar performance:
{'acc': 0.8384075, 'precision': 0.8394164, 'recall': 0.83794165, 'specificity': 0.83794165, 'f1': 0.83811986, 'auroc': 0.89002514, 'binary_precision': 0.85427135, 'binary_recall': 0.8095238, 'binary_specificity': 0.8663595, 'binary_f1_score': 0.8312958}
confusion matrix:
     0    1
0  564   87
1  120  510
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82666665, 'precision': 0.8304262, 'recall': 0.82666665, 'specificity': 0.82666665, 'f1': 0.82617223, 'auroc': 0.93013334, 'binary_precision': 0.79518074, 'binary_recall': 0.88, 'binary_specificity': 0.7733333, 'binary_f1_score': 0.8354431}
confusion matrix:
     0    1
0  174   51
1   27  198
early stop counter: 3
val acc:0.8384075164794922, best validation acc: 0.8610460758209229, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 6,now: 2024-07-27 01:44:54.974260,epoch time: 0:01:32.370079,used: 0:09:21.847611,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9827474, 'precision': 0.9827983, 'recall': 0.98284805, 'specificity': 0.98284805, 'f1': 0.9827472, 'auroc': 0.9986332, 'binary_precision': 0.99148655, 'binary_recall': 0.97426, 'binary_specificity': 0.9914361, 'binary_f1_score': 0.98279774}
confusion matrix:
      0     1
0  1505    13
1    40  1514
---- Validation: 
scalar performance:
{'acc': 0.84543324, 'precision': 0.8573415, 'recall': 0.8439324, 'specificity': 0.8439324, 'f1': 0.8436973, 'auroc': 0.9132159, 'binary_precision': 0.9186047, 'binary_recall': 0.75238097, 'binary_specificity': 0.9354839, 'binary_f1_score': 0.8272251}
confusion matrix:
     0    1
0  609   42
1  156  474
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8666667, 'precision': 0.8724343, 'recall': 0.8666667, 'specificity': 0.8666667, 'f1': 0.8661485, 'auroc': 0.92770374, 'binary_precision': 0.9187817, 'binary_recall': 0.80444443, 'binary_specificity': 0.9288889, 'binary_f1_score': 0.8578199}
confusion matrix:
     0    1
0  209   16
1   44  181
new oracle model saved
early stop counter: 4
val acc:0.845433235168457, best validation acc: 0.8610460758209229, corresponding to test acc:                         0.8644444346427917 / 0.8666666746139526
after epoch: 7,now: 2024-07-27 01:46:27.748429,epoch time: 0:01:32.774169,used: 0:10:54.621780,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.97233075, 'precision': 0.9734541, 'recall': 0.9726864, 'specificity': 0.9726864, 'f1': 0.9723247, 'auroc': 0.9980271, 'binary_precision': 1.0, 'binary_recall': 0.94537276, 'binary_specificity': 1.0, 'binary_f1_score': 0.97191936}
confusion matrix:
      0     1
0  1516     0
1    85  1471
---- Validation: 
scalar performance:
{'acc': 0.7603435, 'precision': 0.8112016, 'recall': 0.75698924, 'specificity': 0.75698924, 'f1': 0.7484987, 'auroc': 0.8957647, 'binary_precision': 0.9329759, 'binary_recall': 0.552381, 'binary_specificity': 0.96159756, 'binary_f1_score': 0.69391835}
confusion matrix:
     0    1
0  626   25
1  282  348
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8, 'precision': 0.8434143, 'recall': 0.8, 'specificity': 0.8, 'f1': 0.7934727, 'auroc': 0.90062225, 'binary_precision': 0.9655172, 'binary_recall': 0.62222224, 'binary_specificity': 0.9777778, 'binary_f1_score': 0.7567568}
confusion matrix:
     0    1
0  220    5
1   85  140
early stop counter: 5
val acc:0.7603434920310974, best validation acc: 0.8610460758209229, corresponding to test acc:                         0.8644444346427917 / 0.8666666746139526
after epoch: 8,now: 2024-07-27 01:48:00.300332,epoch time: 0:01:32.551903,used: 0:12:27.173683,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_35_32_seed_1_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 0:12:27.173683 at 2024-07-27 01:48:00.300332
persisted model performance metric: 

scalar performance:
{'acc': 0.86444443, 'precision': 0.86829287, 'recall': 0.86444443, 'specificity': 0.86444443, 'f1': 0.86408937, 'auroc': 0.92827654, 'binary_precision': 0.9059406, 'binary_recall': 0.81333333, 'binary_specificity': 0.91555554, 'binary_f1_score': 0.85714287}
confusion matrix:
     0    1
0  206   19
1   42  183
oracle model performance metric: 

scalar performance:
{'acc': 0.8666667, 'precision': 0.8724343, 'recall': 0.8666667, 'specificity': 0.8666667, 'f1': 0.8661485, 'auroc': 0.92770374, 'binary_precision': 0.9187817, 'binary_recall': 0.80444443, 'binary_specificity': 0.9288889, 'binary_f1_score': 0.8578199}
confusion matrix:
     0    1
0  209   16
1   44  181
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/20.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/20.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    915 MiB |  13688 MiB |  44636 GiB |  44635 GiB |
|       from large pool |    855 MiB |  13629 MiB |  44072 GiB |  44071 GiB |
|       from small pool |     60 MiB |    100 MiB |    563 GiB |    563 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    915 MiB |  13688 MiB |  44636 GiB |  44635 GiB |
|       from large pool |    855 MiB |  13629 MiB |  44072 GiB |  44071 GiB |
|       from small pool |     60 MiB |    100 MiB |    563 GiB |    563 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    904 MiB |  13680 MiB |  44595 GiB |  44594 GiB |
|       from large pool |    844 MiB |  13621 MiB |  44032 GiB |  44032 GiB |
|       from small pool |     60 MiB |    100 MiB |    562 GiB |    562 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14766 MiB |  14826 MiB |  27022 MiB |  12256 MiB |
|       from large pool |  14654 MiB |  14720 MiB |  26876 MiB |  12222 MiB |
|       from small pool |    112 MiB |    112 MiB |    146 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   2018 MiB |   2828 MiB |  34634 GiB |  34632 GiB |
|       from large pool |   2008 MiB |   2819 MiB |  34068 GiB |  34066 GiB |
|       from small pool |      9 MiB |     35 MiB |    566 GiB |    566 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1796    |    3099    |    8102 K  |    8100 K  |
|       from large pool |     265    |    1491    |    4015 K  |    4014 K  |
|       from small pool |    1531    |    2223    |    4087 K  |    4086 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1796    |    3099    |    8102 K  |    8100 K  |
|       from large pool |     265    |    1491    |    4015 K  |    4014 K  |
|       from small pool |    1531    |    2223    |    4087 K  |    4086 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     557    |     594    |    1060    |     503    |
|       from large pool |     501    |     541    |     987    |     486    |
|       from small pool |      56    |      56    |      73    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     137    |     579    |    4781 K  |    4781 K  |
|       from large pool |      55    |     536    |    2566 K  |    2566 K  |
|       from small pool |      82    |     238    |    2214 K  |    2214 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  44636 GiB |  44636 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  44072 GiB |  44072 GiB |
|       from small pool |      0 KiB |    100 MiB |    563 GiB |    563 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  44636 GiB |  44636 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  44072 GiB |  44072 GiB |
|       from small pool |      0 KiB |    100 MiB |    563 GiB |    563 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  44595 GiB |  44595 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  44032 GiB |  44032 GiB |
|       from small pool |      0 KiB |    100 MiB |    562 GiB |    562 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2934 MiB |  14826 MiB |  27022 MiB |  24088 MiB |
|       from large pool |   2864 MiB |  14720 MiB |  26876 MiB |  24012 MiB |
|       from small pool |     70 MiB |    112 MiB |    146 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2828 MiB |  34634 GiB |  34634 GiB |
|       from large pool |  24320 KiB |   2819 MiB |  34068 GiB |  34068 GiB |
|       from small pool |      0 KiB |     47 MiB |    566 GiB |    566 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |    8102 K  |    8102 K  |
|       from large pool |       2    |    1491    |    4015 K  |    4015 K  |
|       from small pool |       0    |    2223    |    4087 K  |    4087 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |    8102 K  |    8102 K  |
|       from large pool |       2    |    1491    |    4015 K  |    4015 K  |
|       from small pool |       0    |    2223    |    4087 K  |    4087 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      92    |     594    |    1060    |     968    |
|       from large pool |      57    |     541    |     987    |     930    |
|       from small pool |      35    |      56    |      73    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     579    |    4782 K  |    4782 K  |
|       from large pool |       2    |     536    |    2566 K  |    2566 K  |
|       from small pool |       0    |     238    |    2215 K  |    2215 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  44636 GiB |  44636 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  44072 GiB |  44072 GiB |
|       from small pool |      0 KiB |    100 MiB |    563 GiB |    563 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  44636 GiB |  44636 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  44072 GiB |  44072 GiB |
|       from small pool |      0 KiB |    100 MiB |    563 GiB |    563 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  44595 GiB |  44595 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  44032 GiB |  44032 GiB |
|       from small pool |      0 KiB |    100 MiB |    562 GiB |    562 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2934 MiB |  14826 MiB |  27022 MiB |  24088 MiB |
|       from large pool |   2864 MiB |  14720 MiB |  26876 MiB |  24012 MiB |
|       from small pool |     70 MiB |    112 MiB |    146 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2828 MiB |  34634 GiB |  34634 GiB |
|       from large pool |  24320 KiB |   2819 MiB |  34068 GiB |  34068 GiB |
|       from small pool |      0 KiB |     47 MiB |    566 GiB |    566 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |    8102 K  |    8102 K  |
|       from large pool |       2    |    1491    |    4015 K  |    4015 K  |
|       from small pool |       0    |    2223    |    4087 K  |    4087 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |    8102 K  |    8102 K  |
|       from large pool |       2    |    1491    |    4015 K  |    4015 K  |
|       from small pool |       0    |    2223    |    4087 K  |    4087 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      92    |     594    |    1060    |     968    |
|       from large pool |      57    |     541    |     987    |     930    |
|       from small pool |      35    |      56    |      73    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     579    |    4782 K  |    4782 K  |
|       from large pool |       2    |     536    |    2566 K  |    2566 K  |
|       from small pool |       0    |     238    |    2215 K  |    2215 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484

 Experiment start at: 2024-07-27 01:48:34.170270
before training, model accuracy: 0.6134259104728699
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9502618, 'precision': 0.95121783, 'recall': 0.950454, 'specificity': 0.950454, 'f1': 0.95024735, 'auroc': 0.9896905, 'binary_precision': 0.9740437, 'binary_recall': 0.925974, 'binary_specificity': 0.97493404, 'binary_f1_score': 0.9494008}
confusion matrix:
      0     1
0  1478    38
1   114  1426
---- Validation: 
scalar performance:
{'acc': 0.7597809, 'precision': 0.7603622, 'recall': 0.76033986, 'specificity': 0.76033986, 'f1': 0.75978076, 'auroc': 0.8406056, 'binary_precision': 0.739726, 'binary_recall': 0.7813505, 'binary_specificity': 0.7393293, 'binary_f1_score': 0.75996876}
confusion matrix:
     0    1
0  485  171
1  136  486
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8009259, 'precision': 0.8139535, 'recall': 0.80092597, 'specificity': 0.80092597, 'f1': 0.79883915, 'auroc': 0.92033184, 'binary_precision': 0.75, 'binary_recall': 0.9027778, 'binary_specificity': 0.6990741, 'binary_f1_score': 0.8193278}
confusion matrix:
     0    1
0  151   65
1   21  195
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 01:50:07.813158,epoch time: 0:01:33.642888,used: 0:01:33.642888,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96007854, 'precision': 0.960101, 'recall': 0.96012235, 'specificity': 0.96012235, 'f1': 0.96007836, 'auroc': 0.9922819, 'binary_precision': 0.96583444, 'binary_recall': 0.95454544, 'binary_specificity': 0.9656992, 'binary_f1_score': 0.9601568}
confusion matrix:
      0     1
0  1464    52
1    70  1470
---- Validation: 
scalar performance:
{'acc': 0.80985916, 'precision': 0.81243587, 'recall': 0.8110369, 'specificity': 0.8110369, 'f1': 0.80976117, 'auroc': 0.8946774, 'binary_precision': 0.7766423, 'binary_recall': 0.8553055, 'binary_specificity': 0.7667683, 'binary_f1_score': 0.8140781}
confusion matrix:
     0    1
0  503  153
1   90  532
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8125, 'precision': 0.8125067, 'recall': 0.8125, 'specificity': 0.8125, 'f1': 0.81249905, 'auroc': 0.90877914, 'binary_precision': 0.8110599, 'binary_recall': 0.8148148, 'binary_specificity': 0.8101852, 'binary_f1_score': 0.812933}
confusion matrix:
     0    1
0  175   41
1   40  176
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 01:51:37.792027,epoch time: 0:01:29.978869,used: 0:03:03.621757,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9515707, 'precision': 0.95406276, 'recall': 0.95129013, 'specificity': 0.95129013, 'f1': 0.95148015, 'auroc': 0.9963908, 'binary_precision': 0.9223301, 'binary_recall': 0.987013, 'binary_specificity': 0.9155673, 'binary_f1_score': 0.9535759}
confusion matrix:
      0     1
0  1388   128
1    20  1520
---- Validation: 
scalar performance:
{'acc': 0.76447576, 'precision': 0.7938224, 'recall': 0.7685794, 'specificity': 0.7685794, 'f1': 0.76018226, 'auroc': 0.8768357, 'binary_precision': 0.694075, 'binary_recall': 0.92282957, 'binary_specificity': 0.6143293, 'binary_f1_score': 0.7922706}
confusion matrix:
     0    1
0  403  253
1   48  574
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7199074, 'precision': 0.77264756, 'recall': 0.7199074, 'specificity': 0.7199074, 'f1': 0.70567405, 'auroc': 0.89801955, 'binary_precision': 0.65273315, 'binary_recall': 0.9398148, 'binary_specificity': 0.5, 'binary_f1_score': 0.7703985}
confusion matrix:
     0    1
0  108  108
1   13  203
early stop counter: 1
val acc:0.7644757628440857, best validation acc: 0.8098591566085815, corresponding to test acc:                         0.8125 / 0.8125
after epoch: 3,now: 2024-07-27 01:53:08.035495,epoch time: 0:01:30.243468,used: 0:04:33.865225,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.90281415, 'precision': 0.9174092, 'recall': 0.902086, 'specificity': 0.902086, 'f1': 0.90183634, 'auroc': 0.99550337, 'binary_precision': 0.841296, 'binary_recall': 0.9948052, 'binary_specificity': 0.80936676, 'binary_f1_score': 0.91163343}
confusion matrix:
      0     1
0  1227   289
1     8  1532
---- Validation: 
scalar performance:
{'acc': 0.6744914, 'precision': 0.7687885, 'recall': 0.6821769, 'specificity': 0.6821769, 'f1': 0.64874524, 'auroc': 0.89766, 'binary_precision': 0.6027944, 'binary_recall': 0.9710611, 'binary_specificity': 0.3932927, 'binary_f1_score': 0.74384236}
confusion matrix:
     0    1
0  258  398
1   18  604
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6898148, 'precision': 0.7831202, 'recall': 0.6898148, 'specificity': 0.6898148, 'f1': 0.66196394, 'auroc': 0.92982686, 'binary_precision': 0.62058824, 'binary_recall': 0.9768519, 'binary_specificity': 0.4027778, 'binary_f1_score': 0.75899285}
confusion matrix:
    0    1
0  87  129
1   5  211
early stop counter: 2
val acc:0.6744914054870605, best validation acc: 0.8098591566085815, corresponding to test acc:                         0.8125 / 0.8125
after epoch: 4,now: 2024-07-27 01:54:37.784653,epoch time: 0:01:29.749158,used: 0:06:03.614383,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9777487, 'precision': 0.9778422, 'recall': 0.9778193, 'specificity': 0.9778193, 'f1': 0.9777487, 'auroc': 0.99812174, 'binary_precision': 0.9867725, 'binary_recall': 0.9688312, 'binary_specificity': 0.9868074, 'binary_f1_score': 0.97771955}
confusion matrix:
      0     1
0  1496    20
1    48  1492
---- Validation: 
scalar performance:
{'acc': 0.7785602, 'precision': 0.78341967, 'recall': 0.7766744, 'specificity': 0.7766744, 'f1': 0.7766886, 'auroc': 0.86441505, 'binary_precision': 0.81447124, 'binary_recall': 0.7057878, 'binary_specificity': 0.847561, 'binary_f1_score': 0.7562446}
confusion matrix:
     0    1
0  556  100
1  183  439
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8263889, 'precision': 0.8272376, 'recall': 0.8263889, 'specificity': 0.8263889, 'f1': 0.8262763, 'auroc': 0.92388976, 'binary_precision': 0.8105727, 'binary_recall': 0.8518519, 'binary_specificity': 0.8009259, 'binary_f1_score': 0.8306998}
confusion matrix:
     0    1
0  173   43
1   32  184
new oracle model saved
early stop counter: 3
val acc:0.778560221195221, best validation acc: 0.8098591566085815, corresponding to test acc:                         0.8125 / 0.8263888955116272
after epoch: 5,now: 2024-07-27 01:56:08.056645,epoch time: 0:01:30.271992,used: 0:07:33.886375,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9790576, 'precision': 0.97913384, 'recall': 0.9791231, 'specificity': 0.9791231, 'f1': 0.97905755, 'auroc': 0.9976888, 'binary_precision': 0.9874505, 'binary_recall': 0.97077924, 'binary_specificity': 0.987467, 'binary_f1_score': 0.97904384}
confusion matrix:
      0     1
0  1497    19
1    45  1495
---- Validation: 
scalar performance:
{'acc': 0.82472616, 'precision': 0.8421099, 'recall': 0.82168555, 'specificity': 0.82168555, 'f1': 0.8214157, 'auroc': 0.90618384, 'binary_precision': 0.9128631, 'binary_recall': 0.7073955, 'binary_specificity': 0.9359756, 'binary_f1_score': 0.79710144}
confusion matrix:
     0    1
0  614   42
1  182  440
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8472222, 'precision': 0.86086607, 'recall': 0.8472222, 'specificity': 0.8472222, 'f1': 0.84576434, 'auroc': 0.92727625, 'binary_precision': 0.9310345, 'binary_recall': 0.75, 'binary_specificity': 0.9444444, 'binary_f1_score': 0.8307692}
confusion matrix:
     0    1
0  204   12
1   54  162
new oracle model saved
better model found
persisted
after epoch: 6,now: 2024-07-27 01:57:39.592067,epoch time: 0:01:31.535422,used: 0:09:05.421797,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9741492, 'precision': 0.9742856, 'recall': 0.9740937, 'specificity': 0.9740937, 'f1': 0.9741436, 'auroc': 0.99796283, 'binary_precision': 0.96796924, 'binary_recall': 0.9811688, 'binary_specificity': 0.9670185, 'binary_f1_score': 0.9745244}
confusion matrix:
      0     1
0  1466    50
1    29  1511
---- Validation: 
scalar performance:
{'acc': 0.7965571, 'precision': 0.8005345, 'recall': 0.7949132, 'specificity': 0.7949132, 'f1': 0.7951479, 'auroc': 0.8782326, 'binary_precision': 0.8290909, 'binary_recall': 0.73311895, 'binary_specificity': 0.85670733, 'binary_f1_score': 0.778157}
confusion matrix:
     0    1
0  562   94
1  166  456
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8449074, 'precision': 0.8475969, 'recall': 0.8449074, 'specificity': 0.8449074, 'f1': 0.8446068, 'auroc': 0.9349333, 'binary_precision': 0.81702125, 'binary_recall': 0.8888889, 'binary_specificity': 0.8009259, 'binary_f1_score': 0.8514412}
confusion matrix:
     0    1
0  173   43
1   24  192
early stop counter: 1
val acc:0.7965571284294128, best validation acc: 0.8247261643409729, corresponding to test acc:                         0.8472222089767456 / 0.8472222089767456
after epoch: 7,now: 2024-07-27 01:59:10.053849,epoch time: 0:01:30.461782,used: 0:10:35.883579,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9810209, 'precision': 0.9812545, 'recall': 0.98112255, 'specificity': 0.98112255, 'f1': 0.98102045, 'auroc': 0.99881613, 'binary_precision': 0.994, 'binary_recall': 0.9681818, 'binary_specificity': 0.9940633, 'binary_f1_score': 0.98092103}
confusion matrix:
      0     1
0  1507     9
1    49  1491
---- Validation: 
scalar performance:
{'acc': 0.657277, 'precision': 0.7383965, 'recall': 0.6492432, 'specificity': 0.6492432, 'f1': 0.61838263, 'auroc': 0.8487545, 'binary_precision': 0.87096775, 'binary_recall': 0.34726688, 'binary_specificity': 0.9512195, 'binary_f1_score': 0.49655172}
confusion matrix:
     0    1
0  624   32
1  406  216
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8518519, 'precision': 0.8597475, 'recall': 0.8518518, 'specificity': 0.8518518, 'f1': 0.8510345, 'auroc': 0.93353486, 'binary_precision': 0.9130435, 'binary_recall': 0.7777778, 'binary_specificity': 0.9259259, 'binary_f1_score': 0.84}
confusion matrix:
     0    1
0  200   16
1   48  168
new oracle model saved
early stop counter: 2
val acc:0.65727698802948, best validation acc: 0.8247261643409729, corresponding to test acc:                         0.8472222089767456 / 0.8518518805503845
after epoch: 8,now: 2024-07-27 02:00:40.413818,epoch time: 0:01:30.359969,used: 0:12:06.243548,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98232985, 'precision': 0.9823904, 'recall': 0.9823904, 'specificity': 0.9823904, 'f1': 0.9823299, 'auroc': 0.998521, 'binary_precision': 0.99010557, 'binary_recall': 0.9746753, 'binary_specificity': 0.99010557, 'binary_f1_score': 0.9823299}
confusion matrix:
      0     1
0  1501    15
1    39  1501
---- Validation: 
scalar performance:
{'acc': 0.7331768, 'precision': 0.77065337, 'recall': 0.7280507, 'specificity': 0.7280507, 'f1': 0.7206142, 'auroc': 0.85659456, 'binary_precision': 0.86493504, 'binary_recall': 0.53536975, 'binary_specificity': 0.9207317, 'binary_f1_score': 0.6613704}
confusion matrix:
     0    1
0  604   52
1  289  333
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7199074, 'precision': 0.7403542, 'recall': 0.7199074, 'specificity': 0.7199074, 'f1': 0.7138212, 'auroc': 0.82986116, 'binary_precision': 0.8104575, 'binary_recall': 0.5740741, 'binary_specificity': 0.8657407, 'binary_f1_score': 0.6720868}
confusion matrix:
     0    1
0  187   29
1   92  124
early stop counter: 3
val acc:0.7331768274307251, best validation acc: 0.8247261643409729, corresponding to test acc:                         0.8472222089767456 / 0.8518518805503845
after epoch: 9,now: 2024-07-27 02:02:10.165130,epoch time: 0:01:29.751312,used: 0:13:35.994860,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9829843, 'precision': 0.98316514, 'recall': 0.98307574, 'specificity': 0.98307574, 'f1': 0.982984, 'auroc': 0.99806094, 'binary_precision': 0.9946808, 'binary_recall': 0.9714286, 'binary_specificity': 0.99472296, 'binary_f1_score': 0.9829172}
confusion matrix:
      0     1
0  1508     8
1    44  1496
---- Validation: 
scalar performance:
{'acc': 0.62676054, 'precision': 0.7679784, 'recall': 0.61685115, 'specificity': 0.61685115, 'f1': 0.5602561, 'auroc': 0.8731129, 'binary_precision': 0.9559748, 'binary_recall': 0.244373, 'binary_specificity': 0.9893293, 'binary_f1_score': 0.3892446}
confusion matrix:
     0    1
0  649    7
1  470  152
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.49537036, 'precision': 0.37383178, 'recall': 0.49537036, 'specificity': 0.49537036, 'f1': 0.3352908, 'auroc': 0.8817301, 'binary_precision': 0.25, 'binary_recall': 0.0046296297, 'binary_specificity': 0.9861111, 'binary_f1_score': 0.009090909}
confusion matrix:
     0  1
0  213  3
1  215  1
early stop counter: 4
val acc:0.6267605423927307, best validation acc: 0.8247261643409729, corresponding to test acc:                         0.8472222089767456 / 0.8518518805503845
after epoch: 10,now: 2024-07-27 02:03:40.151107,epoch time: 0:01:29.985977,used: 0:15:05.980837,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9842932, 'precision': 0.9842889, 'recall': 0.9843179, 'specificity': 0.9843179, 'f1': 0.98429286, 'auroc': 0.9986316, 'binary_precision': 0.9875817, 'binary_recall': 0.9811688, 'binary_specificity': 0.987467, 'binary_f1_score': 0.98436475}
confusion matrix:
      0     1
0  1497    19
1    29  1511
---- Validation: 
scalar performance:
{'acc': 0.7832551, 'precision': 0.8020275, 'recall': 0.77983105, 'specificity': 0.77983105, 'f1': 0.77830327, 'auroc': 0.87307614, 'binary_precision': 0.87096775, 'binary_recall': 0.65112543, 'binary_specificity': 0.9085366, 'binary_f1_score': 0.7451702}
confusion matrix:
     0    1
0  596   60
1  217  405
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7384259, 'precision': 0.7691703, 'recall': 0.7384259, 'specificity': 0.7384259, 'f1': 0.7307372, 'auroc': 0.87493575, 'binary_precision': 0.86013985, 'binary_recall': 0.5694444, 'binary_specificity': 0.9074074, 'binary_f1_score': 0.68523675}
confusion matrix:
     0    1
0  196   20
1   93  123
early stop counter: 5
val acc:0.7832551002502441, best validation acc: 0.8247261643409729, corresponding to test acc:                         0.8472222089767456 / 0.8518518805503845
after epoch: 11,now: 2024-07-27 02:05:10.142191,epoch time: 0:01:29.991084,used: 0:16:35.971921,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_48_33_seed_2_23090484
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 11 with time: 0:16:35.971921 at 2024-07-27 02:05:10.142191
persisted model performance metric: 

scalar performance:
{'acc': 0.8472222, 'precision': 0.86086607, 'recall': 0.8472222, 'specificity': 0.8472222, 'f1': 0.84576434, 'auroc': 0.92727625, 'binary_precision': 0.9310345, 'binary_recall': 0.75, 'binary_specificity': 0.9444444, 'binary_f1_score': 0.8307692}
confusion matrix:
     0    1
0  204   12
1   54  162
oracle model performance metric: 

scalar performance:
{'acc': 0.8518519, 'precision': 0.8597475, 'recall': 0.8518518, 'specificity': 0.8518518, 'f1': 0.8510345, 'auroc': 0.93353486, 'binary_precision': 0.9130435, 'binary_recall': 0.7777778, 'binary_specificity': 0.9259259, 'binary_f1_score': 0.84}
confusion matrix:
     0    1
0  200   16
1   48  168
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/20.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/20.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    915 MiB |  13688 MiB |  71606 GiB |  71605 GiB |
|       from large pool |    855 MiB |  13629 MiB |  70704 GiB |  70704 GiB |
|       from small pool |     60 MiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    915 MiB |  13688 MiB |  71606 GiB |  71605 GiB |
|       from large pool |    855 MiB |  13629 MiB |  70704 GiB |  70704 GiB |
|       from small pool |     60 MiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    904 MiB |  13680 MiB |  71459 GiB |  71458 GiB |
|       from large pool |    844 MiB |  13621 MiB |  70559 GiB |  70558 GiB |
|       from small pool |     60 MiB |    100 MiB |    899 GiB |    899 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14736 MiB |  14826 MiB |  38824 MiB |  24088 MiB |
|       from large pool |  14630 MiB |  14720 MiB |  38642 MiB |  24012 MiB |
|       from small pool |    106 MiB |    112 MiB |    182 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1956 MiB |   3061 MiB |  55571 GiB |  55569 GiB |
|       from large pool |   1946 MiB |   3051 MiB |  54665 GiB |  54663 GiB |
|       from small pool |      9 MiB |     47 MiB |    905 GiB |    905 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1784    |    3099    |   12979 K  |   12977 K  |
|       from large pool |     265    |    1491    |    6432 K  |    6432 K  |
|       from small pool |    1519    |    2223    |    6546 K  |    6544 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1784    |    3099    |   12979 K  |   12977 K  |
|       from large pool |     265    |    1491    |    6432 K  |    6432 K  |
|       from small pool |    1519    |    2223    |    6546 K  |    6544 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     548    |     594    |    1516    |     968    |
|       from large pool |     495    |     541    |    1425    |     930    |
|       from small pool |      53    |      56    |      91    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     137    |     579    |    7877 K  |    7877 K  |
|       from large pool |      53    |     536    |    4315 K  |    4315 K  |
|       from small pool |      84    |     238    |    3561 K  |    3561 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  71606 GiB |  71606 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  70704 GiB |  70704 GiB |
|       from small pool |      0 KiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  71606 GiB |  71606 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  70704 GiB |  70704 GiB |
|       from small pool |      0 KiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  71459 GiB |  71459 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  70559 GiB |  70559 GiB |
|       from small pool |      0 KiB |    100 MiB |    899 GiB |    899 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2872 MiB |  14826 MiB |  38824 MiB |  35952 MiB |
|       from large pool |   2802 MiB |  14720 MiB |  38642 MiB |  35840 MiB |
|       from small pool |     70 MiB |    112 MiB |    182 MiB |    112 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   3061 MiB |  55571 GiB |  55571 GiB |
|       from large pool |  24320 KiB |   3051 MiB |  54665 GiB |  54665 GiB |
|       from small pool |      0 KiB |     47 MiB |    905 GiB |    905 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |   12979 K  |   12979 K  |
|       from large pool |       2    |    1491    |    6432 K  |    6432 K  |
|       from small pool |       0    |    2223    |    6546 K  |    6546 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |   12979 K  |   12979 K  |
|       from large pool |       2    |    1491    |    6432 K  |    6432 K  |
|       from small pool |       0    |    2223    |    6546 K  |    6546 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      90    |     594    |    1516    |    1426    |
|       from large pool |      55    |     541    |    1425    |    1370    |
|       from small pool |      35    |      56    |      91    |      56    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     579    |    7877 K  |    7877 K  |
|       from large pool |       2    |     536    |    4315 K  |    4315 K  |
|       from small pool |       0    |     238    |    3562 K  |    3562 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 02:05:20 2024]
Finished job 0.
1 of 1 steps (100%) done
