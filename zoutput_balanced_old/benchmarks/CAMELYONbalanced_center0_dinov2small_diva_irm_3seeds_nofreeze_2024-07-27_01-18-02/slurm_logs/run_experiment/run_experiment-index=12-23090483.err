Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 01:18:59 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/12.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=12
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483

 Experiment start at: 2024-07-27 01:19:47.954665
before training, model accuracy: 0.38604649901390076
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9215495, 'precision': 0.93015146, 'recall': 0.92239714, 'specificity': 0.92239714, 'f1': 0.9212514, 'auroc': 0.98904645, 'binary_precision': 0.9939804, 'binary_recall': 0.85006434, 'binary_specificity': 0.99472994, 'binary_f1_score': 0.9164065}
confusion matrix:
      0     1
0  1510     8
1   233  1321
---- Validation: 
scalar performance:
{'acc': 0.73913044, 'precision': 0.7485896, 'recall': 0.737712, 'specificity': 0.737712, 'f1': 0.7358284, 'auroc': 0.8378966, 'binary_precision': 0.79371315, 'binary_recall': 0.63622046, 'binary_specificity': 0.83920366, 'binary_f1_score': 0.70629376}
confusion matrix:
     0    1
0  548  105
1  231  404
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81860465, 'precision': 0.8196002, 'recall': 0.81860465, 'specificity': 0.81860465, 'f1': 0.81846327, 'auroc': 0.88067055, 'binary_precision': 0.8374384, 'binary_recall': 0.7906977, 'binary_specificity': 0.8465116, 'binary_f1_score': 0.8133971}
confusion matrix:
     0    1
0  182   33
1   45  170
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 01:21:23.504300,epoch time: 0:01:35.549635,used: 0:01:35.549635,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9378255, 'precision': 0.94374716, 'recall': 0.9386463, 'specificity': 0.9386463, 'f1': 0.9376867, 'auroc': 0.99514794, 'binary_precision': 0.99854016, 'binary_recall': 0.8786127, 'binary_specificity': 0.9986799, 'binary_f1_score': 0.93474543}
confusion matrix:
      0     1
0  1513     2
1   189  1368
---- Validation: 
scalar performance:
{'acc': 0.5295031, 'precision': 0.7432186, 'recall': 0.52285635, 'specificity': 0.52285635, 'f1': 0.3864063, 'auroc': 0.8479217, 'binary_precision': 0.9677419, 'binary_recall': 0.047244094, 'binary_specificity': 0.9984686, 'binary_f1_score': 0.09009009}
confusion matrix:
     0   1
0  652   1
1  605  30
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.69069767, 'precision': 0.8032962, 'recall': 0.69069767, 'specificity': 0.69069767, 'f1': 0.6590537, 'auroc': 0.9158248, 'binary_precision': 0.9880952, 'binary_recall': 0.3860465, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.55518395}
confusion matrix:
     0   1
0  214   1
1  132  83
early stop counter: 1
val acc:0.5295031070709229, best validation acc: 0.739130437374115, corresponding to test acc:                         0.8186046481132507 / 0.8186046481132507
after epoch: 2,now: 2024-07-27 01:22:51.591716,epoch time: 0:01:28.087416,used: 0:03:03.637051,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9661458, 'precision': 0.9664314, 'recall': 0.9663721, 'specificity': 0.9663721, 'f1': 0.96614563, 'auroc': 0.99491906, 'binary_precision': 0.9820955, 'binary_recall': 0.9505777, 'binary_specificity': 0.98216647, 'binary_f1_score': 0.96607953}
confusion matrix:
      0     1
0  1487    27
1    77  1481
---- Validation: 
scalar performance:
{'acc': 0.7507764, 'precision': 0.78672016, 'recall': 0.7482642, 'specificity': 0.7482642, 'f1': 0.7414203, 'auroc': 0.8581761, 'binary_precision': 0.88480395, 'binary_recall': 0.5685039, 'binary_specificity': 0.92802453, 'binary_f1_score': 0.6922339}
confusion matrix:
     0    1
0  606   47
1  274  361
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8581395, 'precision': 0.8678889, 'recall': 0.8581395, 'specificity': 0.8581395, 'f1': 0.8571934, 'auroc': 0.9286533, 'binary_precision': 0.92777777, 'binary_recall': 0.7767442, 'binary_specificity': 0.9395349, 'binary_f1_score': 0.8455696}
confusion matrix:
     0    1
0  202   13
1   48  167
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-27 01:24:21.038057,epoch time: 0:01:29.446341,used: 0:04:33.083392,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9560547, 'precision': 0.9589447, 'recall': 0.9566933, 'specificity': 0.9566933, 'f1': 0.9560194, 'auroc': 0.99634635, 'binary_precision': 0.99929875, 'binary_recall': 0.9140475, 'binary_specificity': 0.99933904, 'binary_f1_score': 0.95477384}
confusion matrix:
      0     1
0  1512     1
1   134  1425
---- Validation: 
scalar performance:
{'acc': 0.6273292, 'precision': 0.73257446, 'recall': 0.62254643, 'specificity': 0.62254643, 'f1': 0.57498765, 'auroc': 0.8248954, 'binary_precision': 0.88557214, 'binary_recall': 0.28031495, 'binary_specificity': 0.96477795, 'binary_f1_score': 0.4258373}
confusion matrix:
     0    1
0  630   23
1  457  178
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8511628, 'precision': 0.8680088, 'recall': 0.8511628, 'specificity': 0.8511628, 'f1': 0.84943986, 'auroc': 0.9188102, 'binary_precision': 0.9467456, 'binary_recall': 0.74418604, 'binary_specificity': 0.95813954, 'binary_f1_score': 0.8333334}
confusion matrix:
     0    1
0  206    9
1   55  160
early stop counter: 1
val acc:0.6273291707038879, best validation acc: 0.7507764101028442, corresponding to test acc:                         0.8581395149230957 / 0.8581395149230957
after epoch: 4,now: 2024-07-27 01:25:49.490219,epoch time: 0:01:28.452162,used: 0:06:01.535554,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9690755, 'precision': 0.96905583, 'recall': 0.9690989, 'specificity': 0.9690989, 'f1': 0.96907234, 'auroc': 0.99628437, 'binary_precision': 0.9715762, 'binary_recall': 0.96720254, 'binary_specificity': 0.97099537, 'binary_f1_score': 0.96938443}
confusion matrix:
      0     1
0  1473    44
1    51  1504
---- Validation: 
scalar performance:
{'acc': 0.79891306, 'precision': 0.80708754, 'recall': 0.800035, 'specificity': 0.800035, 'f1': 0.7979483, 'auroc': 0.8701234, 'binary_precision': 0.7533693, 'binary_recall': 0.88031495, 'binary_specificity': 0.719755, 'binary_f1_score': 0.81191}
confusion matrix:
     0    1
0  470  183
1   76  559
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7906977, 'precision': 0.8034049, 'recall': 0.7906977, 'specificity': 0.7906977, 'f1': 0.788483, 'auroc': 0.8995998, 'binary_precision': 0.74131274, 'binary_recall': 0.89302325, 'binary_specificity': 0.6883721, 'binary_f1_score': 0.8101266}
confusion matrix:
     0    1
0  148   67
1   23  192
better model found
persisted
after epoch: 5,now: 2024-07-27 01:27:17.696395,epoch time: 0:01:28.206176,used: 0:07:29.741730,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.97558594, 'precision': 0.9763272, 'recall': 0.97588277, 'specificity': 0.97588277, 'f1': 0.97558343, 'auroc': 0.99881935, 'binary_precision': 0.9986532, 'binary_recall': 0.9530848, 'binary_specificity': 0.9986807, 'binary_f1_score': 0.975337}
confusion matrix:
      0     1
0  1514     2
1    73  1483
---- Validation: 
scalar performance:
{'acc': 0.70263976, 'precision': 0.7964951, 'recall': 0.69866395, 'specificity': 0.69866395, 'f1': 0.6744518, 'auroc': 0.91751456, 'binary_precision': 0.959854, 'binary_recall': 0.41417322, 'binary_specificity': 0.98315465, 'binary_f1_score': 0.5786578}
confusion matrix:
     0    1
0  642   11
1  372  263
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.76744187, 'precision': 0.8375795, 'recall': 0.76744187, 'specificity': 0.76744187, 'f1': 0.7547006, 'auroc': 0.9339318, 'binary_precision': 0.991453, 'binary_recall': 0.53953487, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.69879514}
confusion matrix:
     0    1
0  214    1
1   99  116
early stop counter: 1
val acc:0.7026397585868835, best validation acc: 0.7989130616188049, corresponding to test acc:                         0.7906976938247681 / 0.8581395149230957
after epoch: 6,now: 2024-07-27 01:28:45.474098,epoch time: 0:01:27.777703,used: 0:08:57.519433,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9794922, 'precision': 0.979707, 'recall': 0.9796978, 'specificity': 0.9796978, 'f1': 0.9794922, 'auroc': 0.99757206, 'binary_precision': 0.9940516, 'binary_recall': 0.9653402, 'binary_specificity': 0.9940555, 'binary_f1_score': 0.9794855}
confusion matrix:
      0     1
0  1505     9
1    54  1504
---- Validation: 
scalar performance:
{'acc': 0.6125776, 'precision': 0.7440684, 'recall': 0.60736877, 'specificity': 0.60736877, 'f1': 0.5467037, 'auroc': 0.88641405, 'binary_precision': 0.9197531, 'binary_recall': 0.23464566, 'binary_specificity': 0.98009187, 'binary_f1_score': 0.37390214}
confusion matrix:
     0    1
0  640   13
1  486  149
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8, 'precision': 0.85404277, 'recall': 0.79999995, 'specificity': 0.79999995, 'f1': 0.79206496, 'auroc': 0.9333261, 'binary_precision': 0.99236643, 'binary_recall': 0.60465115, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.7514451}
confusion matrix:
     0    1
0  214    1
1   85  130
early stop counter: 2
val acc:0.6125776171684265, best validation acc: 0.7989130616188049, corresponding to test acc:                         0.7906976938247681 / 0.8581395149230957
after epoch: 7,now: 2024-07-27 01:30:13.731236,epoch time: 0:01:28.257138,used: 0:10:25.776571,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9707031, 'precision': 0.9713403, 'recall': 0.97101426, 'specificity': 0.97101426, 'f1': 0.97070134, 'auroc': 0.9981618, 'binary_precision': 0.9926174, 'binary_recall': 0.949294, 'binary_specificity': 0.9927345, 'binary_f1_score': 0.9704724}
confusion matrix:
      0     1
0  1503    11
1    79  1479
---- Validation: 
scalar performance:
{'acc': 0.6242236, 'precision': 0.7402459, 'recall': 0.6192883, 'specificity': 0.6192883, 'f1': 0.56762576, 'auroc': 0.8826494, 'binary_precision': 0.9037433, 'binary_recall': 0.26614174, 'binary_specificity': 0.97243494, 'binary_f1_score': 0.41119224}
confusion matrix:
     0    1
0  635   18
1  466  169
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75581396, 'precision': 0.81787634, 'recall': 0.75581396, 'specificity': 0.75581396, 'f1': 0.7432836, 'auroc': 0.91524065, 'binary_precision': 0.9583333, 'binary_recall': 0.53488374, 'binary_specificity': 0.9767442, 'binary_f1_score': 0.6865672}
confusion matrix:
     0    1
0  210    5
1  100  115
early stop counter: 3
val acc:0.6242235898971558, best validation acc: 0.7989130616188049, corresponding to test acc:                         0.7906976938247681 / 0.8581395149230957
after epoch: 8,now: 2024-07-27 01:31:41.759494,epoch time: 0:01:28.028258,used: 0:11:53.804829,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.9739583, 'precision': 0.9744686, 'recall': 0.97377586, 'specificity': 0.97377586, 'f1': 0.9739398, 'auroc': 0.99762976, 'binary_precision': 0.9618273, 'binary_recall': 0.9877892, 'binary_specificity': 0.9597625, 'binary_f1_score': 0.9746354}
confusion matrix:
      0     1
0  1455    61
1    19  1537
---- Validation: 
scalar performance:
{'acc': 0.8128882, 'precision': 0.82314825, 'recall': 0.81412137, 'specificity': 0.81412137, 'f1': 0.81177616, 'auroc': 0.89051616, 'binary_precision': 0.7619681, 'binary_recall': 0.9023622, 'binary_specificity': 0.72588056, 'binary_f1_score': 0.82624376}
confusion matrix:
     0    1
0  474  179
1   62  573
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8255814, 'precision': 0.83249384, 'recall': 0.82558143, 'specificity': 0.82558143, 'f1': 0.82467014, 'auroc': 0.9148729, 'binary_precision': 0.7845529, 'binary_recall': 0.89767444, 'binary_specificity': 0.75348836, 'binary_f1_score': 0.8373102}
confusion matrix:
     0    1
0  162   53
1   22  193
better model found
persisted
after epoch: 9,now: 2024-07-27 01:33:10.390576,epoch time: 0:01:28.631082,used: 0:13:22.435911,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.97786456, 'precision': 0.9780086, 'recall': 0.9777898, 'specificity': 0.9777898, 'f1': 0.97785777, 'auroc': 0.9982221, 'binary_precision': 0.97202796, 'binary_recall': 0.98454607, 'binary_specificity': 0.9710336, 'binary_f1_score': 0.978247}
confusion matrix:
      0     1
0  1475    44
1    24  1529
---- Validation: 
scalar performance:
{'acc': 0.867236, 'precision': 0.86762714, 'recall': 0.8670039, 'specificity': 0.8670039, 'f1': 0.86712635, 'auroc': 0.92374384, 'binary_precision': 0.8766234, 'binary_recall': 0.8503937, 'binary_specificity': 0.88361406, 'binary_f1_score': 0.8633093}
confusion matrix:
     0    1
0  577   76
1   95  540
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89302325, 'precision': 0.89885616, 'recall': 0.89302325, 'specificity': 0.89302325, 'f1': 0.8926307, 'auroc': 0.9498972, 'binary_precision': 0.94708997, 'binary_recall': 0.83255816, 'binary_specificity': 0.95348835, 'binary_f1_score': 0.8861386}
confusion matrix:
     0    1
0  205   10
1   36  179
new oracle model saved
better model found
persisted
after epoch: 10,now: 2024-07-27 01:34:39.706321,epoch time: 0:01:29.315745,used: 0:14:51.751656,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9713542, 'precision': 0.97276616, 'recall': 0.9710603, 'specificity': 0.9710603, 'f1': 0.9713161, 'auroc': 0.9990581, 'binary_precision': 0.94969326, 'binary_recall': 0.996139, 'binary_specificity': 0.94598156, 'binary_f1_score': 0.9723618}
confusion matrix:
      0     1
0  1436    82
1     6  1548
---- Validation: 
scalar performance:
{'acc': 0.80667704, 'precision': 0.8254725, 'recall': 0.80834305, 'specificity': 0.80834305, 'f1': 0.8043989, 'auroc': 0.8973243, 'binary_precision': 0.74368685, 'binary_recall': 0.9275591, 'binary_specificity': 0.6891271, 'binary_f1_score': 0.82550806}
confusion matrix:
     0    1
0  450  203
1   46  589
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83488375, 'precision': 0.84752154, 'recall': 0.8348837, 'specificity': 0.8348837, 'f1': 0.83336884, 'auroc': 0.9167334, 'binary_precision': 0.78125, 'binary_recall': 0.9302326, 'binary_specificity': 0.73953485, 'binary_f1_score': 0.849257}
confusion matrix:
     0    1
0  159   56
1   15  200
early stop counter: 1
val acc:0.8066770434379578, best validation acc: 0.8672360181808472, corresponding to test acc:                         0.8930232524871826 / 0.8930232524871826
after epoch: 11,now: 2024-07-27 01:36:07.741339,epoch time: 0:01:28.035018,used: 0:16:19.786674,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9788411, 'precision': 0.9792273, 'recall': 0.979082, 'specificity': 0.979082, 'f1': 0.97884077, 'auroc': 0.9987494, 'binary_precision': 0.9966711, 'binary_recall': 0.96146435, 'binary_specificity': 0.9966997, 'binary_f1_score': 0.97875124}
confusion matrix:
      0     1
0  1510     5
1    60  1497
---- Validation: 
scalar performance:
{'acc': 0.8501553, 'precision': 0.8550214, 'recall': 0.84933376, 'specificity': 0.84933376, 'f1': 0.84940356, 'auroc': 0.91455066, 'binary_precision': 0.8932384, 'binary_recall': 0.7905512, 'binary_specificity': 0.9081164, 'binary_f1_score': 0.8387636}
confusion matrix:
     0    1
0  593   60
1  133  502
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.89302325, 'precision': 0.90711486, 'recall': 0.89302325, 'specificity': 0.89302325, 'f1': 0.8920895, 'auroc': 0.95550025, 'binary_precision': 0.98285717, 'binary_recall': 0.8, 'binary_specificity': 0.9860465, 'binary_f1_score': 0.8820513}
confusion matrix:
     0    1
0  212    3
1   43  172
early stop counter: 2
val acc:0.8501552939414978, best validation acc: 0.8672360181808472, corresponding to test acc:                         0.8930232524871826 / 0.8930232524871826
after epoch: 12,now: 2024-07-27 01:37:35.675877,epoch time: 0:01:27.934538,used: 0:17:47.721212,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.9876302, 'precision': 0.987736, 'recall': 0.9877956, 'specificity': 0.9877956, 'f1': 0.9876301, 'auroc': 0.99940395, 'binary_precision': 0.999343, 'binary_recall': 0.9762516, 'binary_specificity': 0.9993395, 'binary_f1_score': 0.9876624}
confusion matrix:
      0     1
0  1513     1
1    37  1521
---- Validation: 
scalar performance:
{'acc': 0.63819873, 'precision': 0.75320727, 'recall': 0.63341814, 'specificity': 0.63341814, 'f1': 0.5873838, 'auroc': 0.90013146, 'binary_precision': 0.920398, 'binary_recall': 0.2913386, 'binary_specificity': 0.9754977, 'binary_f1_score': 0.44258377}
confusion matrix:
     0    1
0  637   16
1  450  185
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.68372095, 'precision': 0.7629175, 'recall': 0.68372095, 'specificity': 0.68372095, 'f1': 0.6579637, 'auroc': 0.9023255, 'binary_precision': 0.9072165, 'binary_recall': 0.40930232, 'binary_specificity': 0.95813954, 'binary_f1_score': 0.5641026}
confusion matrix:
     0   1
0  206   9
1  127  88
early stop counter: 3
val acc:0.638198733329773, best validation acc: 0.8672360181808472, corresponding to test acc:                         0.8930232524871826 / 0.8930232524871826
after epoch: 13,now: 2024-07-27 01:39:03.367043,epoch time: 0:01:27.691166,used: 0:19:15.412378,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 14
---- Training Domain: 
scalar performance:
{'acc': 0.9840495, 'precision': 0.98404944, 'recall': 0.98415804, 'specificity': 0.98415804, 'f1': 0.9840486, 'auroc': 0.9988799, 'binary_precision': 0.99153644, 'binary_recall': 0.97690827, 'binary_specificity': 0.9914078, 'binary_f1_score': 0.984168}
confusion matrix:
      0     1
0  1500    13
1    36  1523
---- Validation: 
scalar performance:
{'acc': 0.84006214, 'precision': 0.853705, 'recall': 0.83868515, 'specificity': 0.83868515, 'f1': 0.8380942, 'auroc': 0.92362326, 'binary_precision': 0.9197652, 'binary_recall': 0.7401575, 'binary_specificity': 0.9372129, 'binary_f1_score': 0.8202443}
confusion matrix:
     0    1
0  612   41
1  165  470
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8418605, 'precision': 0.8774272, 'recall': 0.8418604, 'specificity': 0.8418604, 'f1': 0.838045, 'auroc': 0.9633315, 'binary_precision': 0.9932886, 'binary_recall': 0.6883721, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.8131868}
confusion matrix:
     0    1
0  214    1
1   67  148
early stop counter: 4
val acc:0.840062141418457, best validation acc: 0.8672360181808472, corresponding to test acc:                         0.8930232524871826 / 0.8930232524871826
after epoch: 14,now: 2024-07-27 01:40:31.358669,epoch time: 0:01:27.991626,used: 0:20:43.404004,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 15
---- Training Domain: 
scalar performance:
{'acc': 0.98372394, 'precision': 0.98375505, 'recall': 0.98369104, 'specificity': 0.98369104, 'f1': 0.9837193, 'auroc': 0.9987786, 'binary_precision': 0.98210865, 'binary_recall': 0.98588836, 'binary_specificity': 0.9814937, 'binary_f1_score': 0.98399484}
confusion matrix:
      0     1
0  1485    28
1    22  1537
---- Validation: 
scalar performance:
{'acc': 0.85248446, 'precision': 0.8558205, 'recall': 0.8518045, 'specificity': 0.8518045, 'f1': 0.85194147, 'auroc': 0.9063077, 'binary_precision': 0.8869565, 'binary_recall': 0.8031496, 'binary_specificity': 0.9004594, 'binary_f1_score': 0.8429752}
confusion matrix:
     0    1
0  588   65
1  125  510
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8534884, 'precision': 0.8802122, 'recall': 0.8534883, 'specificity': 0.8534883, 'f1': 0.85086787, 'auroc': 0.9475338, 'binary_precision': 0.98101264, 'binary_recall': 0.7209302, 'binary_specificity': 0.9860465, 'binary_f1_score': 0.83109915}
confusion matrix:
     0    1
0  212    3
1   60  155
early stop counter: 5
val acc:0.8524844646453857, best validation acc: 0.8672360181808472, corresponding to test acc:                         0.8930232524871826 / 0.8930232524871826
after epoch: 15,now: 2024-07-27 01:41:59.298273,epoch time: 0:01:27.939604,used: 0:22:11.343608,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_19_47_seed_0_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 15 with time: 0:22:11.343608 at 2024-07-27 01:41:59.298273
persisted model performance metric: 

scalar performance:
{'acc': 0.89302325, 'precision': 0.89885616, 'recall': 0.89302325, 'specificity': 0.89302325, 'f1': 0.8926307, 'auroc': 0.9498972, 'binary_precision': 0.94708997, 'binary_recall': 0.83255816, 'binary_specificity': 0.95348835, 'binary_f1_score': 0.8861386}
confusion matrix:
     0    1
0  205   10
1   36  179
oracle model performance metric: 

scalar performance:
{'acc': 0.89302325, 'precision': 0.89885616, 'recall': 0.89302325, 'specificity': 0.89302325, 'f1': 0.8926307, 'auroc': 0.9498972, 'binary_precision': 0.94708997, 'binary_recall': 0.83255816, 'binary_specificity': 0.95348835, 'binary_f1_score': 0.8861386}
confusion matrix:
     0    1
0  205   10
1   36  179
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/12.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    917 MiB |  13688 MiB |  36642 GiB |  36641 GiB |
|       from large pool |    856 MiB |  13629 MiB |  36181 GiB |  36181 GiB |
|       from small pool |     60 MiB |     97 MiB |    460 GiB |    460 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    917 MiB |  13688 MiB |  36642 GiB |  36641 GiB |
|       from large pool |    856 MiB |  13629 MiB |  36181 GiB |  36181 GiB |
|       from small pool |     60 MiB |     97 MiB |    460 GiB |    460 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    904 MiB |  13680 MiB |  36609 GiB |  36608 GiB |
|       from large pool |    844 MiB |  13621 MiB |  36149 GiB |  36149 GiB |
|       from small pool |     60 MiB |     97 MiB |    459 GiB |    459 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14826 MiB |  14826 MiB |  14826 MiB |      0 B   |
|       from large pool |  14720 MiB |  14720 MiB |  14720 MiB |      0 B   |
|       from small pool |    106 MiB |    106 MiB |    106 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1652 MiB |   2261 MiB |  27305 GiB |  27304 GiB |
|       from large pool |   1641 MiB |   2254 MiB |  26843 GiB |  26841 GiB |
|       from small pool |     11 MiB |     17 MiB |    462 GiB |    462 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1784    |    3095    |    6648 K  |    6646 K  |
|       from large pool |     265    |    1491    |    3296 K  |    3296 K  |
|       from small pool |    1519    |    2211    |    3352 K  |    3350 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1784    |    3095    |    6648 K  |    6646 K  |
|       from large pool |     265    |    1491    |    3296 K  |    3296 K  |
|       from small pool |    1519    |    2211    |    3352 K  |    3350 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     594    |     594    |     594    |       0    |
|       from large pool |     541    |     541    |     541    |       0    |
|       from small pool |      53    |      53    |      53    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     135    |     581    |    4148 K  |    4148 K  |
|       from large pool |      52    |     536    |    2240 K  |    2240 K  |
|       from small pool |      83    |     237    |    1907 K  |    1907 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  36642 GiB |  36642 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  36181 GiB |  36181 GiB |
|       from small pool |      0 KiB |     97 MiB |    460 GiB |    460 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  36642 GiB |  36642 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  36181 GiB |  36181 GiB |
|       from small pool |      0 KiB |     97 MiB |    460 GiB |    460 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  36609 GiB |  36609 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  36149 GiB |  36149 GiB |
|       from small pool |      0 KiB |     97 MiB |    459 GiB |    459 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2570 MiB |  14826 MiB |  14826 MiB |  12256 MiB |
|       from large pool |   2498 MiB |  14720 MiB |  14720 MiB |  12222 MiB |
|       from small pool |     72 MiB |    106 MiB |    106 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2261 MiB |  27306 GiB |  27306 GiB |
|       from large pool |  24320 KiB |   2254 MiB |  26843 GiB |  26843 GiB |
|       from small pool |      0 KiB |     40 MiB |    462 GiB |    462 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3095    |    6648 K  |    6648 K  |
|       from large pool |       2    |    1491    |    3296 K  |    3296 K  |
|       from small pool |       0    |    2211    |    3352 K  |    3352 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3095    |    6648 K  |    6648 K  |
|       from large pool |       2    |    1491    |    3296 K  |    3296 K  |
|       from small pool |       0    |    2211    |    3352 K  |    3352 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      91    |     594    |     594    |     503    |
|       from large pool |      55    |     541    |     541    |     486    |
|       from small pool |      36    |      53    |      53    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     581    |    4148 K  |    4148 K  |
|       from large pool |       2    |     536    |    2240 K  |    2240 K  |
|       from small pool |       0    |     237    |    1908 K  |    1908 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  36642 GiB |  36642 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  36181 GiB |  36181 GiB |
|       from small pool |      0 KiB |     97 MiB |    460 GiB |    460 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  36642 GiB |  36642 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  36181 GiB |  36181 GiB |
|       from small pool |      0 KiB |     97 MiB |    460 GiB |    460 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  36609 GiB |  36609 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  36149 GiB |  36149 GiB |
|       from small pool |      0 KiB |     97 MiB |    459 GiB |    459 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2570 MiB |  14826 MiB |  14826 MiB |  12256 MiB |
|       from large pool |   2498 MiB |  14720 MiB |  14720 MiB |  12222 MiB |
|       from small pool |     72 MiB |    106 MiB |    106 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2261 MiB |  27306 GiB |  27306 GiB |
|       from large pool |  24320 KiB |   2254 MiB |  26843 GiB |  26843 GiB |
|       from small pool |      0 KiB |     40 MiB |    462 GiB |    462 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3095    |    6648 K  |    6648 K  |
|       from large pool |       2    |    1491    |    3296 K  |    3296 K  |
|       from small pool |       0    |    2211    |    3352 K  |    3352 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3095    |    6648 K  |    6648 K  |
|       from large pool |       2    |    1491    |    3296 K  |    3296 K  |
|       from small pool |       0    |    2211    |    3352 K  |    3352 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      91    |     594    |     594    |     503    |
|       from large pool |      55    |     541    |     541    |     486    |
|       from small pool |      36    |      53    |      53    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     581    |    4148 K  |    4148 K  |
|       from large pool |       2    |     536    |    2240 K  |    2240 K  |
|       from small pool |       0    |     237    |    1908 K  |    1908 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483

 Experiment start at: 2024-07-27 01:42:35.030234
before training, model accuracy: 0.5155555605888367
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.95442706, 'precision': 0.9544723, 'recall': 0.95437986, 'specificity': 0.95437986, 'f1': 0.954416, 'auroc': 0.9910481, 'binary_precision': 0.9520767, 'binary_recall': 0.9581994, 'binary_specificity': 0.95056033, 'binary_f1_score': 0.95512825}
confusion matrix:
      0     1
0  1442    75
1    65  1490
---- Validation: 
scalar performance:
{'acc': 0.75565964, 'precision': 0.79629385, 'recall': 0.75865334, 'specificity': 0.75865334, 'f1': 0.7483722, 'auroc': 0.90570486, 'binary_precision': 0.68239355, 'binary_recall': 0.9412698, 'binary_specificity': 0.5760369, 'binary_f1_score': 0.7911941}
confusion matrix:
     0    1
0  375  276
1   37  593
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75555557, 'precision': 0.79046273, 'recall': 0.75555557, 'specificity': 0.75555557, 'f1': 0.74798393, 'auroc': 0.9152395, 'binary_precision': 0.68976897, 'binary_recall': 0.9288889, 'binary_specificity': 0.5822222, 'binary_f1_score': 0.7916667}
confusion matrix:
     0    1
0  131   94
1   16  209
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 01:44:09.587966,epoch time: 0:01:34.557732,used: 0:01:34.557732,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.93880206, 'precision': 0.94385123, 'recall': 0.9394499, 'specificity': 0.9394499, 'f1': 0.9386819, 'auroc': 0.9926063, 'binary_precision': 0.9942113, 'binary_recall': 0.8841699, 'binary_specificity': 0.99472994, 'binary_f1_score': 0.93596727}
confusion matrix:
      0     1
0  1510     8
1   180  1374
---- Validation: 
scalar performance:
{'acc': 0.85480094, 'precision': 0.857602, 'recall': 0.85407066, 'specificity': 0.85407066, 'f1': 0.8543015, 'auroc': 0.90436935, 'binary_precision': 0.8854167, 'binary_recall': 0.8095238, 'binary_specificity': 0.8986175, 'binary_f1_score': 0.84577113}
confusion matrix:
     0    1
0  585   66
1  120  510
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8377778, 'precision': 0.83778447, 'recall': 0.83777773, 'specificity': 0.83777773, 'f1': 0.837777, 'auroc': 0.9207308, 'binary_precision': 0.83928573, 'binary_recall': 0.83555555, 'binary_specificity': 0.84, 'binary_f1_score': 0.8374165}
confusion matrix:
     0    1
0  189   36
1   37  188
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 01:45:40.375813,epoch time: 0:01:30.787847,used: 0:03:05.345579,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9720052, 'precision': 0.9720745, 'recall': 0.9719496, 'specificity': 0.9719496, 'f1': 0.97199714, 'auroc': 0.9949807, 'binary_precision': 0.96875, 'binary_recall': 0.9762211, 'binary_specificity': 0.9676781, 'binary_f1_score': 0.9724712}
confusion matrix:
      0     1
0  1467    49
1    37  1519
---- Validation: 
scalar performance:
{'acc': 0.8384075, 'precision': 0.83836037, 'recall': 0.8383769, 'specificity': 0.8383769, 'f1': 0.83836806, 'auroc': 0.9058567, 'binary_precision': 0.83518225, 'binary_recall': 0.8365079, 'binary_specificity': 0.8402458, 'binary_f1_score': 0.8358446}
confusion matrix:
     0    1
0  547  104
1  103  527
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82222223, 'precision': 0.8222477, 'recall': 0.82222223, 'specificity': 0.82222223, 'f1': 0.82221866, 'auroc': 0.9003259, 'binary_precision': 0.81938326, 'binary_recall': 0.82666665, 'binary_specificity': 0.81777775, 'binary_f1_score': 0.82300884}
confusion matrix:
     0    1
0  184   41
1   39  186
early stop counter: 1
val acc:0.8384075164794922, best validation acc: 0.8548009395599365, corresponding to test acc:                         0.8377777934074402 / 0.8377777934074402
after epoch: 3,now: 2024-07-27 01:47:09.916053,epoch time: 0:01:29.540240,used: 0:04:34.885819,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.976888, 'precision': 0.97686374, 'recall': 0.97693264, 'specificity': 0.97693264, 'f1': 0.9768857, 'auroc': 0.99780566, 'binary_precision': 0.9805951, 'binary_recall': 0.9736673, 'binary_specificity': 0.980198, 'binary_f1_score': 0.9771189}
confusion matrix:
      0     1
0  1485    30
1    41  1516
---- Validation: 
scalar performance:
{'acc': 0.8071819, 'precision': 0.8162543, 'recall': 0.80855095, 'specificity': 0.80855095, 'f1': 0.8062254, 'auroc': 0.898854, 'binary_precision': 0.75843453, 'binary_recall': 0.8920635, 'binary_specificity': 0.7250384, 'binary_f1_score': 0.81983954}
confusion matrix:
     0    1
0  472  179
1   68  562
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.76666665, 'precision': 0.79261315, 'recall': 0.76666665, 'specificity': 0.76666665, 'f1': 0.76137686, 'auroc': 0.9063506, 'binary_precision': 0.70547944, 'binary_recall': 0.91555554, 'binary_specificity': 0.61777776, 'binary_f1_score': 0.7969052}
confusion matrix:
     0    1
0  139   86
1   19  206
early stop counter: 2
val acc:0.8071818947792053, best validation acc: 0.8548009395599365, corresponding to test acc:                         0.8377777934074402 / 0.8377777934074402
after epoch: 4,now: 2024-07-27 01:48:40.422958,epoch time: 0:01:30.506905,used: 0:06:05.392724,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9788411, 'precision': 0.97886217, 'recall': 0.9789485, 'specificity': 0.9789485, 'f1': 0.9788405, 'auroc': 0.997414, 'binary_precision': 0.98694515, 'binary_recall': 0.97109824, 'binary_specificity': 0.9867987, 'binary_f1_score': 0.9789576}
confusion matrix:
      0     1
0  1495    20
1    45  1512
---- Validation: 
scalar performance:
{'acc': 0.84153, 'precision': 0.8417454, 'recall': 0.8412954, 'specificity': 0.8412954, 'f1': 0.8414048, 'auroc': 0.89008605, 'binary_precision': 0.8471545, 'binary_recall': 0.8269841, 'binary_specificity': 0.85560673, 'binary_f1_score': 0.8369478}
confusion matrix:
     0    1
0  557   94
1  109  521
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7866667, 'precision': 0.80559707, 'recall': 0.78666663, 'specificity': 0.78666663, 'f1': 0.7833109, 'auroc': 0.9186963, 'binary_precision': 0.72953737, 'binary_recall': 0.9111111, 'binary_specificity': 0.6622222, 'binary_f1_score': 0.8102767}
confusion matrix:
     0    1
0  149   76
1   20  205
early stop counter: 3
val acc:0.8415300250053406, best validation acc: 0.8548009395599365, corresponding to test acc:                         0.8377777934074402 / 0.8377777934074402
after epoch: 5,now: 2024-07-27 01:50:09.904677,epoch time: 0:01:29.481719,used: 0:07:34.874443,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9794922, 'precision': 0.9798429, 'recall': 0.9797243, 'specificity': 0.9797243, 'f1': 0.97949195, 'auroc': 0.9971241, 'binary_precision': 0.99667555, 'binary_recall': 0.9627489, 'binary_specificity': 0.9966997, 'binary_f1_score': 0.9794185}
confusion matrix:
      0     1
0  1510     5
1    58  1499
---- Validation: 
scalar performance:
{'acc': 0.8149883, 'precision': 0.82238483, 'recall': 0.8137225, 'specificity': 0.8137225, 'f1': 0.81345856, 'auroc': 0.88449275, 'binary_precision': 0.8672897, 'binary_recall': 0.73650795, 'binary_specificity': 0.89093703, 'binary_f1_score': 0.7965665}
confusion matrix:
     0    1
0  580   71
1  166  464
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8088889, 'precision': 0.80891335, 'recall': 0.8088889, 'specificity': 0.8088889, 'f1': 0.80888516, 'auroc': 0.8969284, 'binary_precision': 0.8061674, 'binary_recall': 0.81333333, 'binary_specificity': 0.80444443, 'binary_f1_score': 0.8097346}
confusion matrix:
     0    1
0  181   44
1   42  183
early stop counter: 4
val acc:0.8149883151054382, best validation acc: 0.8548009395599365, corresponding to test acc:                         0.8377777934074402 / 0.8377777934074402
after epoch: 6,now: 2024-07-27 01:51:39.426041,epoch time: 0:01:29.521364,used: 0:09:04.395807,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9798177, 'precision': 0.97986126, 'recall': 0.9799141, 'specificity': 0.9799141, 'f1': 0.9798175, 'auroc': 0.99754894, 'binary_precision': 0.9882199, 'binary_recall': 0.97168595, 'binary_specificity': 0.9881423, 'binary_f1_score': 0.9798832}
confusion matrix:
      0     1
0  1500    18
1    44  1510
---- Validation: 
scalar performance:
{'acc': 0.82982045, 'precision': 0.82991517, 'recall': 0.82997954, 'specificity': 0.82997954, 'f1': 0.8298179, 'auroc': 0.89578426, 'binary_precision': 0.81888545, 'binary_recall': 0.8396825, 'binary_specificity': 0.8202765, 'binary_f1_score': 0.8291536}
confusion matrix:
     0    1
0  534  117
1  101  529
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7977778, 'precision': 0.80516195, 'recall': 0.7977778, 'specificity': 0.7977778, 'f1': 0.79654706, 'auroc': 0.9035456, 'binary_precision': 0.75769234, 'binary_recall': 0.8755556, 'binary_specificity': 0.72, 'binary_f1_score': 0.81237113}
confusion matrix:
     0    1
0  162   63
1   28  197
early stop counter: 5
val acc:0.829820454120636, best validation acc: 0.8548009395599365, corresponding to test acc:                         0.8377777934074402 / 0.8377777934074402
after epoch: 7,now: 2024-07-27 01:53:09.614320,epoch time: 0:01:30.188279,used: 0:10:34.584086,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_42_34_seed_1_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 0:10:34.584086 at 2024-07-27 01:53:09.614320
persisted model performance metric: 

scalar performance:
{'acc': 0.8377778, 'precision': 0.83778447, 'recall': 0.83777773, 'specificity': 0.83777773, 'f1': 0.837777, 'auroc': 0.9207308, 'binary_precision': 0.83928573, 'binary_recall': 0.83555555, 'binary_specificity': 0.84, 'binary_f1_score': 0.8374165}
confusion matrix:
     0    1
0  189   36
1   37  188
oracle model performance metric: 

scalar performance:
{'acc': 0.8377778, 'precision': 0.83778447, 'recall': 0.83777773, 'specificity': 0.83777773, 'f1': 0.837777, 'auroc': 0.9207308, 'binary_precision': 0.83928573, 'binary_recall': 0.83555555, 'binary_specificity': 0.84, 'binary_f1_score': 0.8374165}
confusion matrix:
     0    1
0  189   36
1   37  188
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    915 MiB |  13688 MiB |  54289 GiB |  54288 GiB |
|       from large pool |    855 MiB |  13629 MiB |  53605 GiB |  53604 GiB |
|       from small pool |     60 MiB |    100 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    915 MiB |  13688 MiB |  54289 GiB |  54288 GiB |
|       from large pool |    855 MiB |  13629 MiB |  53605 GiB |  53604 GiB |
|       from small pool |     60 MiB |    100 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    904 MiB |  13680 MiB |  54240 GiB |  54239 GiB |
|       from large pool |    844 MiB |  13621 MiB |  53557 GiB |  53556 GiB |
|       from small pool |     60 MiB |    100 MiB |    683 GiB |    683 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14766 MiB |  14826 MiB |  27022 MiB |  12256 MiB |
|       from large pool |  14654 MiB |  14720 MiB |  26876 MiB |  12222 MiB |
|       from small pool |    112 MiB |    112 MiB |    146 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   2018 MiB |   2828 MiB |  41637 GiB |  41635 GiB |
|       from large pool |   2008 MiB |   2819 MiB |  40950 GiB |  40948 GiB |
|       from small pool |      9 MiB |     40 MiB |    687 GiB |    687 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1796    |    3099    |    9849 K  |    9847 K  |
|       from large pool |     265    |    1491    |    4883 K  |    4882 K  |
|       from small pool |    1531    |    2223    |    4966 K  |    4964 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1796    |    3099    |    9849 K  |    9847 K  |
|       from large pool |     265    |    1491    |    4883 K  |    4882 K  |
|       from small pool |    1531    |    2223    |    4966 K  |    4964 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     557    |     594    |    1060    |     503    |
|       from large pool |     501    |     541    |     987    |     486    |
|       from small pool |      56    |      56    |      73    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     133    |     581    |    5981 K  |    5981 K  |
|       from large pool |      55    |     536    |    3177 K  |    3177 K  |
|       from small pool |      78    |     237    |    2804 K  |    2804 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  54289 GiB |  54289 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  53605 GiB |  53605 GiB |
|       from small pool |      0 KiB |    100 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  54289 GiB |  54289 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  53605 GiB |  53605 GiB |
|       from small pool |      0 KiB |    100 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  54240 GiB |  54240 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  53557 GiB |  53557 GiB |
|       from small pool |      0 KiB |    100 MiB |    683 GiB |    683 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2934 MiB |  14826 MiB |  27022 MiB |  24088 MiB |
|       from large pool |   2864 MiB |  14720 MiB |  26876 MiB |  24012 MiB |
|       from small pool |     70 MiB |    112 MiB |    146 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2828 MiB |  41638 GiB |  41638 GiB |
|       from large pool |  24320 KiB |   2819 MiB |  40950 GiB |  40950 GiB |
|       from small pool |      0 KiB |     45 MiB |    687 GiB |    687 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |    9849 K  |    9849 K  |
|       from large pool |       2    |    1491    |    4883 K  |    4883 K  |
|       from small pool |       0    |    2223    |    4966 K  |    4966 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |    9849 K  |    9849 K  |
|       from large pool |       2    |    1491    |    4883 K  |    4883 K  |
|       from small pool |       0    |    2223    |    4966 K  |    4966 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      92    |     594    |    1060    |     968    |
|       from large pool |      57    |     541    |     987    |     930    |
|       from small pool |      35    |      56    |      73    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     581    |    5982 K  |    5982 K  |
|       from large pool |       2    |     536    |    3177 K  |    3177 K  |
|       from small pool |       0    |     237    |    2804 K  |    2804 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  54289 GiB |  54289 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  53605 GiB |  53605 GiB |
|       from small pool |      0 KiB |    100 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  54289 GiB |  54289 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  53605 GiB |  53605 GiB |
|       from small pool |      0 KiB |    100 MiB |    684 GiB |    684 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  54240 GiB |  54240 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  53557 GiB |  53557 GiB |
|       from small pool |      0 KiB |    100 MiB |    683 GiB |    683 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2934 MiB |  14826 MiB |  27022 MiB |  24088 MiB |
|       from large pool |   2864 MiB |  14720 MiB |  26876 MiB |  24012 MiB |
|       from small pool |     70 MiB |    112 MiB |    146 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2828 MiB |  41638 GiB |  41638 GiB |
|       from large pool |  24320 KiB |   2819 MiB |  40950 GiB |  40950 GiB |
|       from small pool |      0 KiB |     45 MiB |    687 GiB |    687 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |    9849 K  |    9849 K  |
|       from large pool |       2    |    1491    |    4883 K  |    4883 K  |
|       from small pool |       0    |    2223    |    4966 K  |    4966 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |    9849 K  |    9849 K  |
|       from large pool |       2    |    1491    |    4883 K  |    4883 K  |
|       from small pool |       0    |    2223    |    4966 K  |    4966 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      92    |     594    |    1060    |     968    |
|       from large pool |      57    |     541    |     987    |     930    |
|       from small pool |      35    |      56    |      73    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     581    |    5982 K  |    5982 K  |
|       from large pool |       2    |     536    |    3177 K  |    3177 K  |
|       from small pool |       0    |     237    |    2804 K  |    2804 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483

 Experiment start at: 2024-07-27 01:53:43.244169
before training, model accuracy: 0.6134259104728699
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9348822, 'precision': 0.93514395, 'recall': 0.93479335, 'specificity': 0.93479335, 'f1': 0.9348595, 'auroc': 0.98537755, 'binary_precision': 0.9262556, 'binary_recall': 0.9461039, 'binary_specificity': 0.92348284, 'binary_f1_score': 0.9360745}
confusion matrix:
      0     1
0  1400   116
1    83  1457
---- Validation: 
scalar performance:
{'acc': 0.7754304, 'precision': 0.7851486, 'recall': 0.777792, 'specificity': 0.777792, 'f1': 0.77438486, 'auroc': 0.8761298, 'binary_precision': 0.7254374, 'binary_recall': 0.8665595, 'binary_specificity': 0.6890244, 'binary_f1_score': 0.7897436}
confusion matrix:
     0    1
0  452  204
1   83  539
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7824074, 'precision': 0.7843823, 'recall': 0.7824074, 'specificity': 0.7824074, 'f1': 0.78202903, 'auroc': 0.88299465, 'binary_precision': 0.7606838, 'binary_recall': 0.8240741, 'binary_specificity': 0.7407407, 'binary_f1_score': 0.7911112}
confusion matrix:
     0    1
0  160   56
1   38  178
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 01:55:15.606550,epoch time: 0:01:32.362381,used: 0:01:32.362381,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95909685, 'precision': 0.95976186, 'recall': 0.95895815, 'specificity': 0.95895815, 'f1': 0.95907086, 'auroc': 0.9940355, 'binary_precision': 0.9441306, 'binary_recall': 0.97662336, 'binary_specificity': 0.9412929, 'binary_f1_score': 0.96010214}
confusion matrix:
      0     1
0  1427    89
1    36  1504
---- Validation: 
scalar performance:
{'acc': 0.799687, 'precision': 0.8062948, 'recall': 0.8015866, 'specificity': 0.8015866, 'f1': 0.79918337, 'auroc': 0.8988315, 'binary_precision': 0.75416666, 'binary_recall': 0.87299037, 'binary_specificity': 0.73018295, 'binary_f1_score': 0.8092399}
confusion matrix:
     0    1
0  479  177
1   79  543
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8171296, 'precision': 0.82568073, 'recall': 0.8171296, 'specificity': 0.8171296, 'f1': 0.8159213, 'auroc': 0.92982686, 'binary_precision': 0.7729084, 'binary_recall': 0.8981481, 'binary_specificity': 0.7361111, 'binary_f1_score': 0.8308351}
confusion matrix:
     0    1
0  159   57
1   22  194
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 01:56:44.491349,epoch time: 0:01:28.884799,used: 0:03:01.247180,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9594241, 'precision': 0.9612938, 'recall': 0.9591851, 'specificity': 0.9591851, 'f1': 0.95936555, 'auroc': 0.9970077, 'binary_precision': 0.9338235, 'binary_recall': 0.9896104, 'binary_specificity': 0.9287599, 'binary_f1_score': 0.96090794}
confusion matrix:
      0     1
0  1408   108
1    16  1524
---- Validation: 
scalar performance:
{'acc': 0.7300469, 'precision': 0.78402215, 'recall': 0.7357094, 'specificity': 0.7357094, 'f1': 0.719572, 'auroc': 0.91052663, 'binary_precision': 0.65337765, 'binary_recall': 0.948553, 'binary_specificity': 0.52286583, 'binary_f1_score': 0.7737706}
confusion matrix:
     0    1
0  343  313
1   32  590
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7986111, 'precision': 0.8209621, 'recall': 0.79861116, 'specificity': 0.79861116, 'f1': 0.79504293, 'auroc': 0.9151449, 'binary_precision': 0.73626375, 'binary_recall': 0.9305556, 'binary_specificity': 0.6666667, 'binary_f1_score': 0.8220859}
confusion matrix:
     0    1
0  144   72
1   15  201
early stop counter: 1
val acc:0.7300469279289246, best validation acc: 0.7996870279312134, corresponding to test acc:                         0.8171296119689941 / 0.8171296119689941
after epoch: 3,now: 2024-07-27 01:58:12.167852,epoch time: 0:01:27.676503,used: 0:04:28.923683,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9751309, 'precision': 0.9751239, 'recall': 0.9751499, 'specificity': 0.9751499, 'f1': 0.9751302, 'auroc': 0.99573684, 'binary_precision': 0.9778068, 'binary_recall': 0.9727273, 'binary_specificity': 0.97757256, 'binary_f1_score': 0.97526044}
confusion matrix:
      0     1
0  1482    34
1    42  1498
---- Validation: 
scalar performance:
{'acc': 0.64319247, 'precision': 0.7311568, 'recall': 0.6346904, 'specificity': 0.6346904, 'f1': 0.5976426, 'auroc': 0.8199817, 'binary_precision': 0.86725664, 'binary_recall': 0.31511253, 'binary_specificity': 0.9542683, 'binary_f1_score': 0.4622641}
confusion matrix:
     0    1
0  626   30
1  426  196
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.75, 'precision': 0.7775029, 'recall': 0.75, 'specificity': 0.75, 'f1': 0.7436483, 'auroc': 0.87390685, 'binary_precision': 0.8648649, 'binary_recall': 0.5925926, 'binary_specificity': 0.9074074, 'binary_f1_score': 0.70329666}
confusion matrix:
     0    1
0  196   20
1   88  128
early stop counter: 2
val acc:0.6431924700737, best validation acc: 0.7996870279312134, corresponding to test acc:                         0.8171296119689941 / 0.8171296119689941
after epoch: 4,now: 2024-07-27 01:59:40.037510,epoch time: 0:01:27.869658,used: 0:05:56.793341,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.95778793, 'precision': 0.9605974, 'recall': 0.9581066, 'specificity': 0.9581066, 'f1': 0.9577418, 'auroc': 0.9967885, 'binary_precision': 0.9985866, 'binary_recall': 0.91753244, 'binary_specificity': 0.9986807, 'binary_f1_score': 0.9563452}
confusion matrix:
      0     1
0  1514     2
1   127  1413
---- Validation: 
scalar performance:
{'acc': 0.7261346, 'precision': 0.7959174, 'recall': 0.71952444, 'specificity': 0.71952444, 'f1': 0.70500946, 'auroc': 0.8869059, 'binary_precision': 0.933121, 'binary_recall': 0.47106108, 'binary_specificity': 0.9679878, 'binary_f1_score': 0.62606835}
confusion matrix:
     0    1
0  635   21
1  329  293
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7800926, 'precision': 0.8373693, 'recall': 0.7800926, 'specificity': 0.7800926, 'f1': 0.7703452, 'auroc': 0.9075575, 'binary_precision': 0.97637796, 'binary_recall': 0.5740741, 'binary_specificity': 0.9861111, 'binary_f1_score': 0.7230322}
confusion matrix:
     0    1
0  213    3
1   92  124
early stop counter: 3
val acc:0.7261345982551575, best validation acc: 0.7996870279312134, corresponding to test acc:                         0.8171296119689941 / 0.8171296119689941
after epoch: 5,now: 2024-07-27 02:01:07.671792,epoch time: 0:01:27.634282,used: 0:07:24.427623,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9816754, 'precision': 0.981696, 'recall': 0.9816588, 'specificity': 0.9816588, 'f1': 0.9816736, 'auroc': 0.99856293, 'binary_precision': 0.9799483, 'binary_recall': 0.98376626, 'binary_specificity': 0.97955143, 'binary_f1_score': 0.98185354}
confusion matrix:
      0     1
0  1485    31
1    25  1515
---- Validation: 
scalar performance:
{'acc': 0.74491394, 'precision': 0.76218176, 'recall': 0.74131685, 'specificity': 0.74131685, 'f1': 0.7386404, 'auroc': 0.85072005, 'binary_precision': 0.8231441, 'binary_recall': 0.6061093, 'binary_specificity': 0.8765244, 'binary_f1_score': 0.69814813}
confusion matrix:
     0    1
0  575   81
1  245  377
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8055556, 'precision': 0.809375, 'recall': 0.8055556, 'specificity': 0.8055556, 'f1': 0.8049536, 'auroc': 0.86244, 'binary_precision': 0.775, 'binary_recall': 0.8611111, 'binary_specificity': 0.75, 'binary_f1_score': 0.81578946}
confusion matrix:
     0    1
0  162   54
1   30  186
early stop counter: 4
val acc:0.7449139356613159, best validation acc: 0.7996870279312134, corresponding to test acc:                         0.8171296119689941 / 0.8171296119689941
after epoch: 6,now: 2024-07-27 02:02:35.334729,epoch time: 0:01:27.662937,used: 0:08:52.090560,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9728403, 'precision': 0.97332567, 'recall': 0.97298, 'specificity': 0.97298, 'f1': 0.97283757, 'auroc': 0.9976171, 'binary_precision': 0.9905724, 'binary_recall': 0.95519483, 'binary_specificity': 0.99076515, 'binary_f1_score': 0.972562}
confusion matrix:
      0     1
0  1502    14
1    69  1471
---- Validation: 
scalar performance:
{'acc': 0.6197183, 'precision': 0.6561278, 'recall': 0.61278284, 'specificity': 0.61278284, 'f1': 0.58811593, 'auroc': 0.7959155, 'binary_precision': 0.72516555, 'binary_recall': 0.35209003, 'binary_specificity': 0.8734756, 'binary_f1_score': 0.47402596}
confusion matrix:
     0    1
0  573   83
1  403  219
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7824074, 'precision': 0.78958243, 'recall': 0.7824074, 'specificity': 0.7824074, 'f1': 0.78105116, 'auroc': 0.82212365, 'binary_precision': 0.744, 'binary_recall': 0.8611111, 'binary_specificity': 0.7037037, 'binary_f1_score': 0.7982833}
confusion matrix:
     0    1
0  152   64
1   30  186
early stop counter: 5
val acc:0.6197183132171631, best validation acc: 0.7996870279312134, corresponding to test acc:                         0.8171296119689941 / 0.8171296119689941
after epoch: 7,now: 2024-07-27 02:04:03.096587,epoch time: 0:01:27.761858,used: 0:10:19.852418,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_01_53_42_seed_2_23090483
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 0:10:19.852418 at 2024-07-27 02:04:03.096587
persisted model performance metric: 

scalar performance:
{'acc': 0.8171296, 'precision': 0.82568073, 'recall': 0.8171296, 'specificity': 0.8171296, 'f1': 0.8159213, 'auroc': 0.92982686, 'binary_precision': 0.7729084, 'binary_recall': 0.8981481, 'binary_specificity': 0.7361111, 'binary_f1_score': 0.8308351}
confusion matrix:
     0    1
0  159   57
1   22  194
oracle model performance metric: 

scalar performance:
{'acc': 0.8171296, 'precision': 0.82568073, 'recall': 0.8171296, 'specificity': 0.8171296, 'f1': 0.8159213, 'auroc': 0.92982686, 'binary_precision': 0.7729084, 'binary_recall': 0.8981481, 'binary_specificity': 0.7361111, 'binary_f1_score': 0.8308351}
confusion matrix:
     0    1
0  159   57
1   22  194
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/12.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/12.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |    915 MiB |  13688 MiB |  71528 GiB |  71527 GiB |
|       from large pool |    855 MiB |  13629 MiB |  70627 GiB |  70626 GiB |
|       from small pool |     60 MiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Active memory         |    915 MiB |  13688 MiB |  71528 GiB |  71527 GiB |
|       from large pool |    855 MiB |  13629 MiB |  70627 GiB |  70626 GiB |
|       from small pool |     60 MiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |    904 MiB |  13680 MiB |  71411 GiB |  71410 GiB |
|       from large pool |    844 MiB |  13621 MiB |  70512 GiB |  70511 GiB |
|       from small pool |     60 MiB |    100 MiB |    899 GiB |    899 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14736 MiB |  14826 MiB |  38824 MiB |  24088 MiB |
|       from large pool |  14630 MiB |  14720 MiB |  38642 MiB |  24012 MiB |
|       from small pool |    106 MiB |    112 MiB |    182 MiB |     76 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1956 MiB |   3061 MiB |  55030 GiB |  55028 GiB |
|       from large pool |   1946 MiB |   3051 MiB |  54125 GiB |  54123 GiB |
|       from small pool |      9 MiB |     45 MiB |    905 GiB |    905 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1784    |    3099    |   12969 K  |   12968 K  |
|       from large pool |     265    |    1491    |    6429 K  |    6428 K  |
|       from small pool |    1519    |    2223    |    6540 K  |    6539 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1784    |    3099    |   12969 K  |   12968 K  |
|       from large pool |     265    |    1491    |    6429 K  |    6428 K  |
|       from small pool |    1519    |    2223    |    6540 K  |    6539 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     548    |     594    |    1516    |     968    |
|       from large pool |     495    |     541    |    1425    |     930    |
|       from small pool |      53    |      56    |      91    |      38    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     132    |     581    |    7947 K  |    7947 K  |
|       from large pool |      53    |     536    |    4295 K  |    4295 K  |
|       from small pool |      79    |     237    |    3652 K  |    3652 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13688 MiB |  71528 GiB |  71528 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  70627 GiB |  70627 GiB |
|       from small pool |      0 KiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13688 MiB |  71528 GiB |  71528 GiB |
|       from large pool |  16640 KiB |  13629 MiB |  70627 GiB |  70627 GiB |
|       from small pool |      0 KiB |    100 MiB |    901 GiB |    901 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13680 MiB |  71411 GiB |  71411 GiB |
|       from large pool |  16640 KiB |  13621 MiB |  70512 GiB |  70512 GiB |
|       from small pool |      0 KiB |    100 MiB |    899 GiB |    899 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2872 MiB |  14826 MiB |  38824 MiB |  35952 MiB |
|       from large pool |   2802 MiB |  14720 MiB |  38642 MiB |  35840 MiB |
|       from small pool |     70 MiB |    112 MiB |    182 MiB |    112 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   3061 MiB |  55031 GiB |  55031 GiB |
|       from large pool |  24320 KiB |   3051 MiB |  54125 GiB |  54125 GiB |
|       from small pool |      0 KiB |     45 MiB |    905 GiB |    905 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |   12969 K  |   12969 K  |
|       from large pool |       2    |    1491    |    6429 K  |    6429 K  |
|       from small pool |       0    |    2223    |    6540 K  |    6540 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |   12969 K  |   12969 K  |
|       from large pool |       2    |    1491    |    6429 K  |    6429 K  |
|       from small pool |       0    |    2223    |    6540 K  |    6540 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      90    |     594    |    1516    |    1426    |
|       from large pool |      55    |     541    |    1425    |    1370    |
|       from small pool |      35    |      56    |      91    |      56    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |     581    |    7947 K  |    7947 K  |
|       from large pool |       2    |     536    |    4295 K  |    4295 K  |
|       from small pool |       0    |     237    |    3652 K  |    3652 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 02:04:13 2024]
Finished job 0.
1 of 1 steps (100%) done
