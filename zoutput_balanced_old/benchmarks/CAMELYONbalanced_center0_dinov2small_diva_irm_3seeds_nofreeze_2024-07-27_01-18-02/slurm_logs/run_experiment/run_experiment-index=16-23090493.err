Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 02:23:21 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/16.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=16
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493

 Experiment start at: 2024-07-27 02:24:04.657700
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.46279069781303406
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9248047, 'precision': 0.9277183, 'recall': 0.92428744, 'specificity': 0.92428744, 'f1': 0.92460275, 'auroc': 0.985896, 'binary_precision': 0.8955224, 'binary_recall': 0.9640103, 'binary_specificity': 0.88456464, 'binary_f1_score': 0.9285051}
confusion matrix:
      0     1
0  1341   175
1    56  1500
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.68555903, 'precision': 0.7770152, 'recall': 0.6895238, 'specificity': 0.6895238, 'f1': 0.6600221, 'auroc': 0.90485346, 'binary_precision': 0.61431414, 'binary_recall': 0.97322834, 'binary_specificity': 0.4058193, 'binary_f1_score': 0.7531992}
confusion matrix:
     0    1
0  265  388
1   17  618
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6744186, 'precision': 0.78520644, 'recall': 0.67441857, 'specificity': 0.67441857, 'f1': 0.6394, 'auroc': 0.92573285, 'binary_precision': 0.6074498, 'binary_recall': 0.9860465, 'binary_specificity': 0.3627907, 'binary_f1_score': 0.751773}
confusion matrix:
    0    1
0  78  137
1   3  212
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 02:25:33.183023,epoch time: 0:01:28.525323,used: 0:01:28.525323,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9485677, 'precision': 0.95266527, 'recall': 0.9492525, 'specificity': 0.9492525, 'f1': 0.9484967, 'auroc': 0.9955801, 'binary_precision': 0.99928623, 'binary_recall': 0.89916503, 'binary_specificity': 0.99933994, 'binary_f1_score': 0.9465855}
confusion matrix:
      0     1
0  1514     1
1   157  1400
---- Validation: 
scalar performance:
{'acc': 0.636646, 'precision': 0.75025976, 'recall': 0.631865, 'specificity': 0.631865, 'f1': 0.5856129, 'auroc': 0.8688741, 'binary_precision': 0.91542286, 'binary_recall': 0.28976378, 'binary_specificity': 0.9739663, 'binary_f1_score': 0.4401914}
confusion matrix:
     0    1
0  636   17
1  451  184
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80930233, 'precision': 0.8138927, 'recall': 0.80930233, 'specificity': 0.80930233, 'f1': 0.8086026, 'auroc': 0.90040016, 'binary_precision': 0.8518519, 'binary_recall': 0.74883723, 'binary_specificity': 0.8697674, 'binary_f1_score': 0.7970297}
confusion matrix:
     0    1
0  187   28
1   54  161
new oracle model saved
early stop counter: 1
val acc:0.6366459727287292, best validation acc: 0.6855590343475342, corresponding to test acc:                         0.6744186282157898 / 0.8093023300170898
after epoch: 2,now: 2024-07-27 02:26:56.201610,epoch time: 0:01:23.018587,used: 0:02:51.543910,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9580078, 'precision': 0.96074253, 'recall': 0.95860076, 'specificity': 0.95860076, 'f1': 0.9579756, 'auroc': 0.99619514, 'binary_precision': 1.0, 'binary_recall': 0.9172015, 'binary_specificity': 1.0, 'binary_f1_score': 0.95681286}
confusion matrix:
      0     1
0  1514     0
1   129  1429
---- Validation: 
scalar performance:
{'acc': 0.5923913, 'precision': 0.7565639, 'recall': 0.5867227, 'specificity': 0.5867227, 'f1': 0.5081663, 'auroc': 0.87337965, 'binary_precision': 0.9583333, 'binary_recall': 0.18110237, 'binary_specificity': 0.992343, 'binary_f1_score': 0.30463576}
confusion matrix:
     0    1
0  648    5
1  520  115
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7348837, 'precision': 0.8031043, 'recall': 0.7348837, 'specificity': 0.7348837, 'f1': 0.71907663, 'auroc': 0.8961384, 'binary_precision': 0.94690263, 'binary_recall': 0.4976744, 'binary_specificity': 0.97209305, 'binary_f1_score': 0.652439}
confusion matrix:
     0    1
0  209    6
1  108  107
early stop counter: 2
val acc:0.592391312122345, best validation acc: 0.6855590343475342, corresponding to test acc:                         0.6744186282157898 / 0.8093023300170898
after epoch: 3,now: 2024-07-27 02:28:18.743632,epoch time: 0:01:22.542022,used: 0:04:14.085932,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9641927, 'precision': 0.9657574, 'recall': 0.9646517, 'specificity': 0.9646517, 'f1': 0.9641808, 'auroc': 0.99711215, 'binary_precision': 0.99657065, 'binary_recall': 0.9326059, 'binary_specificity': 0.9966975, 'binary_f1_score': 0.9635279}
confusion matrix:
      0     1
0  1509     5
1   105  1453
---- Validation: 
scalar performance:
{'acc': 0.8082298, 'precision': 0.83872914, 'recall': 0.80611956, 'specificity': 0.80611956, 'f1': 0.80304384, 'auroc': 0.9237703, 'binary_precision': 0.9369369, 'binary_recall': 0.6551181, 'binary_specificity': 0.95712095, 'binary_f1_score': 0.7710843}
confusion matrix:
     0    1
0  625   28
1  219  416
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.83255816, 'precision': 0.8532203, 'recall': 0.83255816, 'specificity': 0.83255816, 'f1': 0.8300731, 'auroc': 0.91322875, 'binary_precision': 0.9386503, 'binary_recall': 0.7116279, 'binary_specificity': 0.95348835, 'binary_f1_score': 0.8095238}
confusion matrix:
     0    1
0  205   10
1   62  153
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-07-27 02:29:42.702466,epoch time: 0:01:23.958834,used: 0:05:38.044766,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9661458, 'precision': 0.96770114, 'recall': 0.96653533, 'specificity': 0.96653533, 'f1': 0.966133, 'auroc': 0.99854934, 'binary_precision': 0.99794096, 'binary_recall': 0.9350482, 'binary_specificity': 0.99802244, 'binary_f1_score': 0.9654715}
confusion matrix:
      0     1
0  1514     3
1   101  1454
---- Validation: 
scalar performance:
{'acc': 0.60170805, 'precision': 0.7613374, 'recall': 0.5961715, 'specificity': 0.5961715, 'f1': 0.52378917, 'auroc': 0.91326284, 'binary_precision': 0.9621212, 'binary_recall': 0.2, 'binary_specificity': 0.992343, 'binary_f1_score': 0.33116037}
confusion matrix:
     0    1
0  648    5
1  508  127
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5511628, 'precision': 0.7634804, 'recall': 0.5511628, 'specificity': 0.5511628, 'f1': 0.43793136, 'auroc': 0.9150027, 'binary_precision': 1.0, 'binary_recall': 0.10232558, 'binary_specificity': 1.0, 'binary_f1_score': 0.18565401}
confusion matrix:
     0   1
0  215   0
1  193  22
early stop counter: 1
val acc:0.6017080545425415, best validation acc: 0.8082298040390015, corresponding to test acc:                         0.8325581550598145 / 0.8325581550598145
after epoch: 5,now: 2024-07-27 02:31:05.128115,epoch time: 0:01:22.425649,used: 0:07:00.470415,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.96223956, 'precision': 0.9633162, 'recall': 0.961968, 'specificity': 0.961968, 'f1': 0.96219623, 'auroc': 0.99641824, 'binary_precision': 0.94386184, 'binary_recall': 0.98392284, 'binary_specificity': 0.9400132, 'binary_f1_score': 0.96347606}
confusion matrix:
      0     1
0  1426    91
1    25  1530
---- Validation: 
scalar performance:
{'acc': 0.7795031, 'precision': 0.78136516, 'recall': 0.7800461, 'specificity': 0.7800461, 'f1': 0.77933073, 'auroc': 0.8629463, 'binary_precision': 0.754717, 'binary_recall': 0.81889766, 'binary_specificity': 0.7411945, 'binary_f1_score': 0.7854985}
confusion matrix:
     0    1
0  484  169
1  115  520
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7930232, 'precision': 0.8019663, 'recall': 0.7930232, 'specificity': 0.7930232, 'f1': 0.79147935, 'auroc': 0.8832666, 'binary_precision': 0.75, 'binary_recall': 0.87906975, 'binary_specificity': 0.7069768, 'binary_f1_score': 0.8094218}
confusion matrix:
     0    1
0  152   63
1   26  189
early stop counter: 2
val acc:0.7795031070709229, best validation acc: 0.8082298040390015, corresponding to test acc:                         0.8325581550598145 / 0.8325581550598145
after epoch: 6,now: 2024-07-27 02:32:27.819848,epoch time: 0:01:22.691733,used: 0:08:23.162148,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9593099, 'precision': 0.961867, 'recall': 0.95988446, 'specificity': 0.95988446, 'f1': 0.9592816, 'auroc': 0.99823546, 'binary_precision': 1.0, 'binary_recall': 0.9197689, 'binary_specificity': 1.0, 'binary_f1_score': 0.95820796}
confusion matrix:
      0     1
0  1514     0
1   125  1433
---- Validation: 
scalar performance:
{'acc': 0.5706522, 'precision': 0.7437291, 'recall': 0.56467545, 'specificity': 0.56467545, 'f1': 0.4701296, 'auroc': 0.9129541, 'binary_precision': 0.9456522, 'binary_recall': 0.13700788, 'binary_specificity': 0.992343, 'binary_f1_score': 0.23933975}
confusion matrix:
     0   1
0  648   5
1  548  87
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.53720933, 'precision': 0.7596618, 'recall': 0.5372093, 'specificity': 0.5372093, 'f1': 0.4110765, 'auroc': 0.9286101, 'binary_precision': 1.0, 'binary_recall': 0.074418604, 'binary_specificity': 1.0, 'binary_f1_score': 0.13852814}
confusion matrix:
     0   1
0  215   0
1  199  16
early stop counter: 3
val acc:0.570652186870575, best validation acc: 0.8082298040390015, corresponding to test acc:                         0.8325581550598145 / 0.8325581550598145
after epoch: 7,now: 2024-07-27 02:33:50.248926,epoch time: 0:01:22.429078,used: 0:09:45.591226,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9798177, 'precision': 0.9798219, 'recall': 0.9798952, 'specificity': 0.9798952, 'f1': 0.97981703, 'auroc': 0.99788547, 'binary_precision': 0.98631924, 'binary_recall': 0.97363347, 'binary_specificity': 0.9861569, 'binary_f1_score': 0.9799353}
confusion matrix:
      0     1
0  1496    21
1    41  1514
---- Validation: 
scalar performance:
{'acc': 0.8734472, 'precision': 0.8762578, 'recall': 0.8740628, 'specificity': 0.8740628, 'f1': 0.87331885, 'auroc': 0.931736, 'binary_precision': 0.8400576, 'binary_recall': 0.91811025, 'binary_specificity': 0.8300153, 'binary_f1_score': 0.8773514}
confusion matrix:
     0    1
0  542  111
1   52  583
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8744186, 'precision': 0.8752303, 'recall': 0.8744186, 'specificity': 0.8744186, 'f1': 0.87435067, 'auroc': 0.93743646, 'binary_precision': 0.8926829, 'binary_recall': 0.8511628, 'binary_specificity': 0.89767444, 'binary_f1_score': 0.8714286}
confusion matrix:
     0    1
0  193   22
1   32  183
new oracle model saved
better model found
persisted
after epoch: 8,now: 2024-07-27 02:35:13.983217,epoch time: 0:01:23.734291,used: 0:11:09.325517,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.97753906, 'precision': 0.9780085, 'recall': 0.9773526, 'specificity': 0.9773526, 'f1': 0.9775226, 'auroc': 0.9988791, 'binary_precision': 0.9661866, 'binary_recall': 0.9903723, 'binary_specificity': 0.9643329, 'binary_f1_score': 0.9781299}
confusion matrix:
      0     1
0  1460    54
1    15  1543
---- Validation: 
scalar performance:
{'acc': 0.8113354, 'precision': 0.8354228, 'recall': 0.81319773, 'specificity': 0.81319773, 'f1': 0.8084899, 'auroc': 0.92585707, 'binary_precision': 0.7419753, 'binary_recall': 0.9464567, 'binary_specificity': 0.67993873, 'binary_f1_score': 0.8318339}
confusion matrix:
     0    1
0  444  209
1   34  601
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81860465, 'precision': 0.8288783, 'recall': 0.81860465, 'specificity': 0.81860465, 'f1': 0.81717694, 'auroc': 0.92679286, 'binary_precision': 0.770751, 'binary_recall': 0.90697676, 'binary_specificity': 0.73023254, 'binary_f1_score': 0.8333334}
confusion matrix:
     0    1
0  157   58
1   20  195
early stop counter: 1
val acc:0.8113353848457336, best validation acc: 0.8734471797943115, corresponding to test acc:                         0.8744186162948608 / 0.8744186162948608
after epoch: 9,now: 2024-07-27 02:36:36.471857,epoch time: 0:01:22.488640,used: 0:12:31.814157,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.98860675, 'precision': 0.9885878, 'recall': 0.9886493, 'specificity': 0.9886493, 'f1': 0.98860586, 'auroc': 0.99929374, 'binary_precision': 0.992228, 'binary_recall': 0.985209, 'binary_specificity': 0.9920896, 'binary_f1_score': 0.988706}
confusion matrix:
      0     1
0  1505    12
1    23  1532
---- Validation: 
scalar performance:
{'acc': 0.85636646, 'precision': 0.872449, 'recall': 0.85491675, 'specificity': 0.85491675, 'f1': 0.85441816, 'auroc': 0.9340223, 'binary_precision': 0.9464286, 'binary_recall': 0.7511811, 'binary_specificity': 0.9586524, 'binary_f1_score': 0.83757687}
confusion matrix:
     0    1
0  626   27
1  158  477
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7790698, 'precision': 0.8433043, 'recall': 0.7790698, 'specificity': 0.7790698, 'f1': 0.76822823, 'auroc': 0.94072473, 'binary_precision': 0.9918033, 'binary_recall': 0.5627907, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.71810085}
confusion matrix:
     0    1
0  214    1
1   94  121
early stop counter: 2
val acc:0.8563664555549622, best validation acc: 0.8734471797943115, corresponding to test acc:                         0.8744186162948608 / 0.8744186162948608
after epoch: 10,now: 2024-07-27 02:37:58.870248,epoch time: 0:01:22.398391,used: 0:13:54.212548,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9788411, 'precision': 0.97904253, 'recall': 0.97872955, 'specificity': 0.97872955, 'f1': 0.97883105, 'auroc': 0.9982551, 'binary_precision': 0.9721695, 'binary_recall': 0.9865212, 'binary_specificity': 0.9709379, 'binary_f1_score': 0.9792928}
confusion matrix:
      0     1
0  1470    44
1    21  1537
---- Validation: 
scalar performance:
{'acc': 0.7911491, 'precision': 0.79423106, 'recall': 0.7904029, 'specificity': 0.7904029, 'f1': 0.7902782, 'auroc': 0.8627124, 'binary_precision': 0.8210526, 'binary_recall': 0.73700786, 'binary_specificity': 0.84379786, 'binary_f1_score': 0.7767635}
confusion matrix:
     0    1
0  551  102
1  167  468
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.855814, 'precision': 0.8583255, 'recall': 0.855814, 'specificity': 0.855814, 'f1': 0.85556084, 'auroc': 0.9350351, 'binary_precision': 0.82832617, 'binary_recall': 0.89767444, 'binary_specificity': 0.81395346, 'binary_f1_score': 0.8616072}
confusion matrix:
     0    1
0  175   40
1   22  193
early stop counter: 3
val acc:0.7911490797996521, best validation acc: 0.8734471797943115, corresponding to test acc:                         0.8744186162948608 / 0.8744186162948608
after epoch: 11,now: 2024-07-27 02:39:21.728632,epoch time: 0:01:22.858384,used: 0:15:17.070932,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9716797, 'precision': 0.9726949, 'recall': 0.9713625, 'specificity': 0.9713625, 'f1': 0.97164404, 'auroc': 0.99828804, 'binary_precision': 0.95434916, 'binary_recall': 0.9916667, 'binary_specificity': 0.9510582, 'binary_f1_score': 0.9726501}
confusion matrix:
      0     1
0  1438    74
1    13  1547
---- Validation: 
scalar performance:
{'acc': 0.84782606, 'precision': 0.852367, 'recall': 0.84862113, 'specificity': 0.84862113, 'f1': 0.84751683, 'auroc': 0.9123337, 'binary_precision': 0.8087201, 'binary_recall': 0.9055118, 'binary_specificity': 0.79173046, 'binary_f1_score': 0.8543833}
confusion matrix:
     0    1
0  517  136
1   60  575
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7906977, 'precision': 0.8170643, 'recall': 0.7906977, 'specificity': 0.7906977, 'f1': 0.7862539, 'auroc': 0.9327204, 'binary_precision': 0.7256318, 'binary_recall': 0.9348837, 'binary_specificity': 0.6465116, 'binary_f1_score': 0.81707317}
confusion matrix:
     0    1
0  139   76
1   14  201
early stop counter: 4
val acc:0.8478260636329651, best validation acc: 0.8734471797943115, corresponding to test acc:                         0.8744186162948608 / 0.8744186162948608
after epoch: 12,now: 2024-07-27 02:40:44.403702,epoch time: 0:01:22.675070,used: 0:16:39.746002,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.98046875, 'precision': 0.9809524, 'recall': 0.9807322, 'specificity': 0.9807322, 'f1': 0.98046803, 'auroc': 0.99906194, 'binary_precision': 1.0, 'binary_recall': 0.96146435, 'binary_specificity': 1.0, 'binary_f1_score': 0.9803536}
confusion matrix:
      0     1
0  1515     0
1    60  1497
---- Validation: 
scalar performance:
{'acc': 0.5698758, 'precision': 0.74817026, 'recall': 0.5638664, 'specificity': 0.5638664, 'f1': 0.46783525, 'auroc': 0.90214694, 'binary_precision': 0.9550562, 'binary_recall': 0.13385826, 'binary_specificity': 0.99387443, 'binary_f1_score': 0.23480663}
confusion matrix:
     0   1
0  649   4
1  550  85
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.62093025, 'precision': 0.7843915, 'recall': 0.62093025, 'specificity': 0.62093025, 'f1': 0.55731976, 'auroc': 0.9235046, 'binary_precision': 1.0, 'binary_recall': 0.24186046, 'binary_specificity': 1.0, 'binary_f1_score': 0.3895131}
confusion matrix:
     0   1
0  215   0
1  163  52
early stop counter: 5
val acc:0.5698757767677307, best validation acc: 0.8734471797943115, corresponding to test acc:                         0.8744186162948608 / 0.8744186162948608
after epoch: 13,now: 2024-07-27 02:42:07.311020,epoch time: 0:01:22.907318,used: 0:18:02.653320,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_24_03_seed_0_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 13 with time: 0:18:02.653320 at 2024-07-27 02:42:07.311020
persisted model performance metric: 

scalar performance:
{'acc': 0.8744186, 'precision': 0.8752303, 'recall': 0.8744186, 'specificity': 0.8744186, 'f1': 0.87435067, 'auroc': 0.93743646, 'binary_precision': 0.8926829, 'binary_recall': 0.8511628, 'binary_specificity': 0.89767444, 'binary_f1_score': 0.8714286}
confusion matrix:
     0    1
0  193   22
1   32  183
oracle model performance metric: 

scalar performance:
{'acc': 0.8744186, 'precision': 0.8752303, 'recall': 0.8744186, 'specificity': 0.8744186, 'f1': 0.87435067, 'auroc': 0.93743646, 'binary_precision': 0.8926829, 'binary_recall': 0.8511628, 'binary_specificity': 0.89767444, 'binary_f1_score': 0.8714286}
confusion matrix:
     0    1
0  193   22
1   32  183
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/16.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/16.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/16.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1064 MiB |  13837 MiB |  31958 GiB |  31957 GiB |
|       from large pool |   1003 MiB |  13776 MiB |  31558 GiB |  31557 GiB |
|       from small pool |     61 MiB |     98 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1064 MiB |  13837 MiB |  31958 GiB |  31957 GiB |
|       from large pool |   1003 MiB |  13776 MiB |  31558 GiB |  31557 GiB |
|       from small pool |     61 MiB |     98 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1052 MiB |  13828 MiB |  31933 GiB |  31932 GiB |
|       from large pool |    991 MiB |  13768 MiB |  31533 GiB |  31532 GiB |
|       from small pool |     61 MiB |     98 MiB |    399 GiB |    399 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14988 MiB |  14988 MiB |  14988 MiB |      0 B   |
|       from large pool |  14880 MiB |  14880 MiB |  14880 MiB |      0 B   |
|       from small pool |    108 MiB |    108 MiB |    108 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1747 MiB |   2238 MiB |  25313 GiB |  25311 GiB |
|       from large pool |   1738 MiB |   2232 MiB |  24910 GiB |  24908 GiB |
|       from small pool |      8 MiB |     16 MiB |    402 GiB |    402 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1784    |    3095    |    5768 K  |    5767 K  |
|       from large pool |     265    |    1491    |    2856 K  |    2856 K  |
|       from small pool |    1519    |    2211    |    2912 K  |    2910 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1784    |    3095    |    5768 K  |    5767 K  |
|       from large pool |     265    |    1491    |    2856 K  |    2856 K  |
|       from small pool |    1519    |    2211    |    2912 K  |    2910 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     591    |     591    |     591    |       0    |
|       from large pool |     537    |     537    |     537    |       0    |
|       from small pool |      54    |      54    |      54    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     140    |     574    |    3930 K  |    3930 K  |
|       from large pool |      56    |     532    |    2075 K  |    2075 K  |
|       from small pool |      84    |     235    |    1854 K  |    1854 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13837 MiB |  31958 GiB |  31958 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  31558 GiB |  31558 GiB |
|       from small pool |      0 KiB |     98 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13837 MiB |  31958 GiB |  31958 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  31558 GiB |  31558 GiB |
|       from small pool |      0 KiB |     98 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13828 MiB |  31933 GiB |  31933 GiB |
|       from large pool |  16640 KiB |  13768 MiB |  31533 GiB |  31533 GiB |
|       from small pool |      0 KiB |     98 MiB |    399 GiB |    399 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2812 MiB |  14988 MiB |  14988 MiB |  12176 MiB |
|       from large pool |   2742 MiB |  14880 MiB |  14880 MiB |  12138 MiB |
|       from small pool |     70 MiB |    108 MiB |    108 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2238 MiB |  25314 GiB |  25314 GiB |
|       from large pool |  24320 KiB |   2232 MiB |  24911 GiB |  24911 GiB |
|       from small pool |      0 KiB |     38 MiB |    403 GiB |    403 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3095    |    5768 K  |    5768 K  |
|       from large pool |       2    |    1491    |    2856 K  |    2856 K  |
|       from small pool |       0    |    2211    |    2912 K  |    2912 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3095    |    5768 K  |    5768 K  |
|       from large pool |       2    |    1491    |    2856 K  |    2856 K  |
|       from small pool |       0    |    2211    |    2912 K  |    2912 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      89    |     591    |     591    |     502    |
|       from large pool |      54    |     537    |     537    |     483    |
|       from small pool |      35    |      54    |      54    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     574    |    3930 K  |    3930 K  |
|       from large pool |       3    |     532    |    2075 K  |    2075 K  |
|       from small pool |       0    |     235    |    1854 K  |    1854 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13837 MiB |  31958 GiB |  31958 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  31558 GiB |  31558 GiB |
|       from small pool |      0 KiB |     98 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13837 MiB |  31958 GiB |  31958 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  31558 GiB |  31558 GiB |
|       from small pool |      0 KiB |     98 MiB |    400 GiB |    400 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13828 MiB |  31933 GiB |  31933 GiB |
|       from large pool |  16640 KiB |  13768 MiB |  31533 GiB |  31533 GiB |
|       from small pool |      0 KiB |     98 MiB |    399 GiB |    399 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2812 MiB |  14988 MiB |  14988 MiB |  12176 MiB |
|       from large pool |   2742 MiB |  14880 MiB |  14880 MiB |  12138 MiB |
|       from small pool |     70 MiB |    108 MiB |    108 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   2238 MiB |  25314 GiB |  25314 GiB |
|       from large pool |  24320 KiB |   2232 MiB |  24911 GiB |  24911 GiB |
|       from small pool |      0 KiB |     38 MiB |    403 GiB |    403 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3095    |    5768 K  |    5768 K  |
|       from large pool |       2    |    1491    |    2856 K  |    2856 K  |
|       from small pool |       0    |    2211    |    2912 K  |    2912 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3095    |    5768 K  |    5768 K  |
|       from large pool |       2    |    1491    |    2856 K  |    2856 K  |
|       from small pool |       0    |    2211    |    2912 K  |    2912 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      89    |     591    |     591    |     502    |
|       from large pool |      54    |     537    |     537    |     483    |
|       from small pool |      35    |      54    |      54    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     574    |    3930 K  |    3930 K  |
|       from large pool |       3    |     532    |    2075 K  |    2075 K  |
|       from small pool |       0    |     235    |    1854 K  |    1854 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493

 Experiment start at: 2024-07-27 02:42:45.795836
before training, model accuracy: 0.5666666626930237
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9016927, 'precision': 0.9153906, 'recall': 0.9030156, 'specificity': 0.9030156, 'f1': 0.90106857, 'auroc': 0.9845859, 'binary_precision': 0.9944882, 'binary_recall': 0.8106547, 'binary_specificity': 0.99537647, 'binary_f1_score': 0.8932107}
confusion matrix:
      0     1
0  1507     7
1   295  1263
---- Validation: 
scalar performance:
{'acc': 0.7533177, 'precision': 0.7625468, 'recall': 0.7517153, 'specificity': 0.7517153, 'f1': 0.7502924, 'auroc': 0.8383074, 'binary_precision': 0.80784315, 'binary_recall': 0.6539683, 'binary_specificity': 0.8494624, 'binary_f1_score': 0.72280705}
confusion matrix:
     0    1
0  553   98
1  218  412
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80222225, 'precision': 0.80251503, 'recall': 0.80222225, 'specificity': 0.80222225, 'f1': 0.8021743, 'auroc': 0.8825284, 'binary_precision': 0.8119266, 'binary_recall': 0.7866667, 'binary_specificity': 0.81777775, 'binary_f1_score': 0.7990971}
confusion matrix:
     0    1
0  184   41
1   48  177
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 02:44:14.867323,epoch time: 0:01:29.071487,used: 0:01:29.071487,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95996094, 'precision': 0.9613788, 'recall': 0.96035683, 'specificity': 0.96035683, 'f1': 0.9599481, 'auroc': 0.995425, 'binary_precision': 0.99041754, 'binary_recall': 0.92994857, 'binary_specificity': 0.99076515, 'binary_f1_score': 0.9592311}
confusion matrix:
      0     1
0  1502    14
1   109  1447
---- Validation: 
scalar performance:
{'acc': 0.82045275, 'precision': 0.842544, 'recall': 0.8183564, 'specificity': 0.8183564, 'f1': 0.81679523, 'auroc': 0.9033818, 'binary_precision': 0.9255319, 'binary_recall': 0.6904762, 'binary_specificity': 0.94623655, 'binary_f1_score': 0.7909091}
confusion matrix:
     0    1
0  616   35
1  195  435
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8577778, 'precision': 0.8671775, 'recall': 0.8577778, 'specificity': 0.8577778, 'f1': 0.8568617, 'auroc': 0.91466665, 'binary_precision': 0.9259259, 'binary_recall': 0.7777778, 'binary_specificity': 0.93777776, 'binary_f1_score': 0.84541065}
confusion matrix:
     0    1
0  211   14
1   50  175
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 02:45:40.597924,epoch time: 0:01:25.730601,used: 0:02:54.802088,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.95442706, 'precision': 0.9570989, 'recall': 0.9549016, 'specificity': 0.9549016, 'f1': 0.9543879, 'auroc': 0.9970877, 'binary_precision': 0.99509805, 'binary_recall': 0.9144144, 'binary_specificity': 0.9953887, 'binary_f1_score': 0.9530516}
confusion matrix:
      0     1
0  1511     7
1   133  1421
---- Validation: 
scalar performance:
{'acc': 0.8126464, 'precision': 0.8225197, 'recall': 0.8111879, 'specificity': 0.8111879, 'f1': 0.8106663, 'auroc': 0.8933557, 'binary_precision': 0.875, 'binary_recall': 0.7222222, 'binary_specificity': 0.90015364, 'binary_f1_score': 0.79130435}
confusion matrix:
     0    1
0  586   65
1  175  455
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82, 'precision': 0.82337916, 'recall': 0.82, 'specificity': 0.82, 'f1': 0.8195286, 'auroc': 0.89491355, 'binary_precision': 0.85643566, 'binary_recall': 0.7688889, 'binary_specificity': 0.8711111, 'binary_f1_score': 0.8103045}
confusion matrix:
     0    1
0  196   29
1   52  173
early stop counter: 1
val acc:0.8126463890075684, best validation acc: 0.8204527497291565, corresponding to test acc:                         0.8577777743339539 / 0.8577777743339539
after epoch: 3,now: 2024-07-27 02:47:04.677054,epoch time: 0:01:24.079130,used: 0:04:18.881218,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97298175, 'precision': 0.9736744, 'recall': 0.9727835, 'specificity': 0.9727835, 'f1': 0.9729601, 'auroc': 0.99798596, 'binary_precision': 0.95825547, 'binary_recall': 0.989704, 'binary_specificity': 0.955863, 'binary_f1_score': 0.9737259}
confusion matrix:
      0     1
0  1451    67
1    16  1538
---- Validation: 
scalar performance:
{'acc': 0.7135051, 'precision': 0.7427836, 'recall': 0.71057343, 'specificity': 0.71057343, 'f1': 0.7027194, 'auroc': 0.84432495, 'binary_precision': 0.8230958, 'binary_recall': 0.53174603, 'binary_specificity': 0.8894009, 'binary_f1_score': 0.6460945}
confusion matrix:
     0    1
0  579   72
1  295  335
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.79555553, 'precision': 0.8052014, 'recall': 0.79555553, 'specificity': 0.79555553, 'f1': 0.7939273, 'auroc': 0.8747852, 'binary_precision': 0.85945946, 'binary_recall': 0.70666665, 'binary_specificity': 0.8844444, 'binary_f1_score': 0.7756098}
confusion matrix:
     0    1
0  199   26
1   66  159
early stop counter: 2
val acc:0.7135050892829895, best validation acc: 0.8204527497291565, corresponding to test acc:                         0.8577777743339539 / 0.8577777743339539
after epoch: 4,now: 2024-07-27 02:48:29.171879,epoch time: 0:01:24.494825,used: 0:05:43.376043,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9404297, 'precision': 0.94517416, 'recall': 0.93984544, 'specificity': 0.93984544, 'f1': 0.94020814, 'auroc': 0.9954599, 'binary_precision': 0.90205276, 'binary_recall': 0.989704, 'binary_specificity': 0.8899868, 'binary_f1_score': 0.9438478}
confusion matrix:
      0     1
0  1351   167
1    16  1538
---- Validation: 
scalar performance:
{'acc': 0.77907884, 'precision': 0.78960323, 'recall': 0.7774706, 'specificity': 0.7774706, 'f1': 0.77633035, 'auroc': 0.85955673, 'binary_precision': 0.8408644, 'binary_recall': 0.6793651, 'binary_specificity': 0.875576, 'binary_f1_score': 0.7515364}
confusion matrix:
     0    1
0  570   81
1  202  428
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82222223, 'precision': 0.8234746, 'recall': 0.82222223, 'specificity': 0.82222223, 'f1': 0.82205, 'auroc': 0.9024395, 'binary_precision': 0.8033473, 'binary_recall': 0.85333335, 'binary_specificity': 0.7911111, 'binary_f1_score': 0.82758623}
confusion matrix:
     0    1
0  178   47
1   33  192
early stop counter: 3
val acc:0.7790788412094116, best validation acc: 0.8204527497291565, corresponding to test acc:                         0.8577777743339539 / 0.8577777743339539
after epoch: 5,now: 2024-07-27 02:49:53.424406,epoch time: 0:01:24.252527,used: 0:07:07.628570,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.94889325, 'precision': 0.95310634, 'recall': 0.9495177, 'specificity': 0.9495177, 'f1': 0.9488164, 'auroc': 0.99876463, 'binary_precision': 1.0, 'binary_recall': 0.8990354, 'binary_specificity': 1.0, 'binary_f1_score': 0.9468337}
confusion matrix:
      0     1
0  1517     0
1   157  1398
---- Validation: 
scalar performance:
{'acc': 0.51444185, 'precision': 0.7556952, 'recall': 0.5063492, 'specificity': 0.5063492, 'f1': 0.35089675, 'auroc': 0.883554, 'binary_precision': 1.0, 'binary_recall': 0.012698413, 'binary_specificity': 1.0, 'binary_f1_score': 0.025078371}
confusion matrix:
     0  1
0  651  0
1  622  8
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5088889, 'precision': 0.75224215, 'recall': 0.5088889, 'specificity': 0.5088889, 'f1': 0.35278767, 'auroc': 0.9074963, 'binary_precision': 1.0, 'binary_recall': 0.017777778, 'binary_specificity': 1.0, 'binary_f1_score': 0.0349345}
confusion matrix:
     0  1
0  225  0
1  221  4
early stop counter: 4
val acc:0.5144418478012085, best validation acc: 0.8204527497291565, corresponding to test acc:                         0.8577777743339539 / 0.8577777743339539
after epoch: 6,now: 2024-07-27 02:51:17.684021,epoch time: 0:01:24.259615,used: 0:08:31.888185,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.97721356, 'precision': 0.9777794, 'recall': 0.9774942, 'specificity': 0.9774942, 'f1': 0.9772124, 'auroc': 0.9987469, 'binary_precision': 0.9979906, 'binary_recall': 0.95696855, 'binary_specificity': 0.9980198, 'binary_f1_score': 0.9770492}
confusion matrix:
      0     1
0  1512     3
1    67  1490
---- Validation: 
scalar performance:
{'acc': 0.735363, 'precision': 0.7921437, 'recall': 0.7316948, 'specificity': 0.7316948, 'f1': 0.71978897, 'auroc': 0.88091093, 'binary_precision': 0.91690546, 'binary_recall': 0.50793654, 'binary_specificity': 0.95545316, 'binary_f1_score': 0.6537283}
confusion matrix:
     0    1
0  622   29
1  310  320
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.81777775, 'precision': 0.840397, 'recall': 0.81777775, 'specificity': 0.81777775, 'f1': 0.81469953, 'auroc': 0.8942864, 'binary_precision': 0.92814374, 'binary_recall': 0.6888889, 'binary_specificity': 0.94666666, 'binary_f1_score': 0.7908163}
confusion matrix:
     0    1
0  213   12
1   70  155
early stop counter: 5
val acc:0.7353630065917969, best validation acc: 0.8204527497291565, corresponding to test acc:                         0.8577777743339539 / 0.8577777743339539
after epoch: 7,now: 2024-07-27 02:52:41.601675,epoch time: 0:01:23.917654,used: 0:09:55.805839,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_42_45_seed_1_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 0:09:55.805839 at 2024-07-27 02:52:41.601675
persisted model performance metric: 

scalar performance:
{'acc': 0.8577778, 'precision': 0.8671775, 'recall': 0.8577778, 'specificity': 0.8577778, 'f1': 0.8568617, 'auroc': 0.91466665, 'binary_precision': 0.9259259, 'binary_recall': 0.7777778, 'binary_specificity': 0.93777776, 'binary_f1_score': 0.84541065}
confusion matrix:
     0    1
0  211   14
1   50  175
oracle model performance metric: 

scalar performance:
{'acc': 0.8577778, 'precision': 0.8671775, 'recall': 0.8577778, 'specificity': 0.8577778, 'f1': 0.8568617, 'auroc': 0.91466665, 'binary_precision': 0.9259259, 'binary_recall': 0.7777778, 'binary_specificity': 0.93777776, 'binary_f1_score': 0.84541065}
confusion matrix:
     0    1
0  211   14
1   50  175
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/16.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/16.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1064 MiB |  13837 MiB |  49700 GiB |  49699 GiB |
|       from large pool |   1003 MiB |  13776 MiB |  49076 GiB |  49075 GiB |
|       from small pool |     61 MiB |    102 MiB |    624 GiB |    624 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1064 MiB |  13837 MiB |  49700 GiB |  49699 GiB |
|       from large pool |   1003 MiB |  13776 MiB |  49076 GiB |  49075 GiB |
|       from small pool |     61 MiB |    102 MiB |    624 GiB |    624 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1052 MiB |  13828 MiB |  49661 GiB |  49660 GiB |
|       from large pool |    991 MiB |  13768 MiB |  49038 GiB |  49037 GiB |
|       from small pool |     61 MiB |    102 MiB |    623 GiB |    623 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14916 MiB |  14988 MiB |  27092 MiB |  12176 MiB |
|       from large pool |  14804 MiB |  14880 MiB |  26942 MiB |  12138 MiB |
|       from small pool |    112 MiB |    112 MiB |    150 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1939 MiB |   3001 MiB |  38751 GiB |  38749 GiB |
|       from large pool |   1930 MiB |   2992 MiB |  38122 GiB |  38120 GiB |
|       from small pool |      8 MiB |     38 MiB |    628 GiB |    628 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1796    |    3099    |    8969 K  |    8967 K  |
|       from large pool |     265    |    1491    |    4441 K  |    4441 K  |
|       from small pool |    1531    |    2223    |    4527 K  |    4526 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1796    |    3099    |    8969 K  |    8967 K  |
|       from large pool |     265    |    1491    |    4441 K  |    4441 K  |
|       from small pool |    1531    |    2223    |    4527 K  |    4526 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     556    |     591    |    1058    |     502    |
|       from large pool |     500    |     537    |     983    |     483    |
|       from small pool |      56    |      56    |      75    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     126    |     574    |    6114 K  |    6114 K  |
|       from large pool |      49    |     532    |    3310 K  |    3310 K  |
|       from small pool |      77    |     235    |    2803 K  |    2803 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13837 MiB |  49700 GiB |  49700 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  49076 GiB |  49076 GiB |
|       from small pool |      0 KiB |    102 MiB |    624 GiB |    624 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13837 MiB |  49700 GiB |  49700 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  49076 GiB |  49076 GiB |
|       from small pool |      0 KiB |    102 MiB |    624 GiB |    624 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13828 MiB |  49661 GiB |  49661 GiB |
|       from large pool |  16640 KiB |  13768 MiB |  49038 GiB |  49038 GiB |
|       from small pool |      0 KiB |    102 MiB |    623 GiB |    623 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3004 MiB |  14988 MiB |  27092 MiB |  24088 MiB |
|       from large pool |   2934 MiB |  14880 MiB |  26942 MiB |  24008 MiB |
|       from small pool |     70 MiB |    112 MiB |    150 MiB |     80 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   3001 MiB |  38751 GiB |  38751 GiB |
|       from large pool |  24320 KiB |   2992 MiB |  38122 GiB |  38122 GiB |
|       from small pool |      0 KiB |     38 MiB |    628 GiB |    628 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |    8969 K  |    8969 K  |
|       from large pool |       2    |    1491    |    4441 K  |    4441 K  |
|       from small pool |       0    |    2223    |    4527 K  |    4527 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |    8969 K  |    8969 K  |
|       from large pool |       2    |    1491    |    4441 K  |    4441 K  |
|       from small pool |       0    |    2223    |    4527 K  |    4527 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      89    |     591    |    1058    |     969    |
|       from large pool |      54    |     537    |     983    |     929    |
|       from small pool |      35    |      56    |      75    |      40    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     574    |    6114 K  |    6114 K  |
|       from large pool |       3    |     532    |    3310 K  |    3310 K  |
|       from small pool |       0    |     235    |    2803 K  |    2803 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13837 MiB |  49700 GiB |  49700 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  49076 GiB |  49076 GiB |
|       from small pool |      0 KiB |    102 MiB |    624 GiB |    624 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13837 MiB |  49700 GiB |  49700 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  49076 GiB |  49076 GiB |
|       from small pool |      0 KiB |    102 MiB |    624 GiB |    624 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13828 MiB |  49661 GiB |  49661 GiB |
|       from large pool |  16640 KiB |  13768 MiB |  49038 GiB |  49038 GiB |
|       from small pool |      0 KiB |    102 MiB |    623 GiB |    623 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3004 MiB |  14988 MiB |  27092 MiB |  24088 MiB |
|       from large pool |   2934 MiB |  14880 MiB |  26942 MiB |  24008 MiB |
|       from small pool |     70 MiB |    112 MiB |    150 MiB |     80 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   3001 MiB |  38751 GiB |  38751 GiB |
|       from large pool |  24320 KiB |   2992 MiB |  38122 GiB |  38122 GiB |
|       from small pool |      0 KiB |     38 MiB |    628 GiB |    628 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |    8969 K  |    8969 K  |
|       from large pool |       2    |    1491    |    4441 K  |    4441 K  |
|       from small pool |       0    |    2223    |    4527 K  |    4527 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |    8969 K  |    8969 K  |
|       from large pool |       2    |    1491    |    4441 K  |    4441 K  |
|       from small pool |       0    |    2223    |    4527 K  |    4527 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      89    |     591    |    1058    |     969    |
|       from large pool |      54    |     537    |     983    |     929    |
|       from small pool |      35    |      56    |      75    |      40    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     574    |    6114 K  |    6114 K  |
|       from large pool |       3    |     532    |    3310 K  |    3310 K  |
|       from small pool |       0    |     235    |    2803 K  |    2803 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/init.py:452: UserWarning: Initializing zero-element tensors is a no-op
  warnings.warn("Initializing zero-element tensors is a no-op")
Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main

using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493

 Experiment start at: 2024-07-27 02:53:19.536371
before training, model accuracy: 0.48842594027519226
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9548429, 'precision': 0.95497227, 'recall': 0.9549224, 'specificity': 0.9549224, 'f1': 0.9548426, 'auroc': 0.9904641, 'binary_precision': 0.9648541, 'binary_recall': 0.9448052, 'binary_specificity': 0.96503955, 'binary_f1_score': 0.95472443}
confusion matrix:
      0     1
0  1463    53
1    85  1455
---- Validation: 
scalar performance:
{'acc': 0.7816901, 'precision': 0.7934016, 'recall': 0.78426445, 'specificity': 0.78426445, 'f1': 0.7804252, 'auroc': 0.89358675, 'binary_precision': 0.72775567, 'binary_recall': 0.88102895, 'binary_specificity': 0.6875, 'binary_f1_score': 0.79709095}
confusion matrix:
     0    1
0  451  205
1   74  548
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7986111, 'precision': 0.813452, 'recall': 0.7986111, 'specificity': 0.7986111, 'f1': 0.7961987, 'auroc': 0.9104724, 'binary_precision': 0.7452471, 'binary_recall': 0.9074074, 'binary_specificity': 0.6898148, 'binary_f1_score': 0.8183716}
confusion matrix:
     0    1
0  149   67
1   20  196
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 02:54:46.079205,epoch time: 0:01:26.542834,used: 0:01:26.542834,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9587696, 'precision': 0.96100116, 'recall': 0.95905495, 'specificity': 0.95905495, 'f1': 0.95873547, 'auroc': 0.992353, 'binary_precision': 0.99509805, 'binary_recall': 0.9227273, 'binary_specificity': 0.9953826, 'binary_f1_score': 0.9575472}
confusion matrix:
      0     1
0  1509     7
1   119  1421
---- Validation: 
scalar performance:
{'acc': 0.75117373, 'precision': 0.7646208, 'recall': 0.7479977, 'specificity': 0.7479977, 'f1': 0.7462512, 'auroc': 0.8616555, 'binary_precision': 0.8179916, 'binary_recall': 0.62861735, 'binary_specificity': 0.86737806, 'binary_f1_score': 0.71090907}
confusion matrix:
     0    1
0  569   87
1  231  391
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7824074, 'precision': 0.7848495, 'recall': 0.7824074, 'specificity': 0.7824074, 'f1': 0.78194004, 'auroc': 0.8783222, 'binary_precision': 0.81122446, 'binary_recall': 0.7361111, 'binary_specificity': 0.8287037, 'binary_f1_score': 0.7718446}
confusion matrix:
     0    1
0  179   37
1   57  159
early stop counter: 1
val acc:0.751173734664917, best validation acc: 0.7816901206970215, corresponding to test acc:                         0.7986111044883728 / 0.7986111044883728
after epoch: 2,now: 2024-07-27 02:56:08.443888,epoch time: 0:01:22.364683,used: 0:02:48.907517,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.97316754, 'precision': 0.9731605, 'recall': 0.9731865, 'specificity': 0.9731865, 'f1': 0.9731668, 'auroc': 0.99668217, 'binary_precision': 0.97584856, 'binary_recall': 0.97077924, 'binary_specificity': 0.9755937, 'binary_f1_score': 0.97330725}
confusion matrix:
      0     1
0  1479    37
1    45  1495
---- Validation: 
scalar performance:
{'acc': 0.8169014, 'precision': 0.81676185, 'recall': 0.8168551, 'specificity': 0.8168551, 'f1': 0.8168005, 'auroc': 0.89581454, 'binary_precision': 0.80990416, 'binary_recall': 0.81511253, 'binary_specificity': 0.81859756, 'binary_f1_score': 0.8125}
confusion matrix:
     0    1
0  537  119
1  115  507
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8078704, 'precision': 0.81617177, 'recall': 0.8078704, 'specificity': 0.8078704, 'f1': 0.8066009, 'auroc': 0.92176783, 'binary_precision': 0.76494026, 'binary_recall': 0.8888889, 'binary_specificity': 0.7268519, 'binary_f1_score': 0.82226986}
confusion matrix:
     0    1
0  157   59
1   24  192
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-27 02:57:32.071889,epoch time: 0:01:23.628001,used: 0:04:12.535518,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9646597, 'precision': 0.966326, 'recall': 0.96443653, 'specificity': 0.96443653, 'f1': 0.96461385, 'auroc': 0.99830854, 'binary_precision': 0.9403444, 'binary_recall': 0.99285716, 'binary_specificity': 0.93601584, 'binary_f1_score': 0.96588755}
confusion matrix:
      0     1
0  1419    97
1    11  1529
---- Validation: 
scalar performance:
{'acc': 0.7574335, 'precision': 0.7741394, 'recall': 0.7605947, 'specificity': 0.7605947, 'f1': 0.75505257, 'auroc': 0.83449584, 'binary_precision': 0.6994885, 'binary_recall': 0.87942123, 'binary_specificity': 0.6417683, 'binary_f1_score': 0.77920234}
confusion matrix:
     0    1
0  421  235
1   75  547
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7268519, 'precision': 0.7953125, 'recall': 0.7268518, 'specificity': 0.7268518, 'f1': 0.71004736, 'auroc': 0.90288496, 'binary_precision': 0.653125, 'binary_recall': 0.9675926, 'binary_specificity': 0.4861111, 'binary_f1_score': 0.7798508}
confusion matrix:
     0    1
0  105  111
1    7  209
early stop counter: 1
val acc:0.7574334740638733, best validation acc: 0.8169013857841492, corresponding to test acc:                         0.8078703880310059 / 0.8078703880310059
after epoch: 4,now: 2024-07-27 02:58:54.204745,epoch time: 0:01:22.132856,used: 0:05:34.668374,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9757853, 'precision': 0.9757838, 'recall': 0.9757838, 'specificity': 0.9757838, 'f1': 0.9757838, 'auroc': 0.99627566, 'binary_precision': 0.975974, 'binary_recall': 0.975974, 'binary_specificity': 0.9755937, 'binary_f1_score': 0.975974}
confusion matrix:
      0     1
0  1479    37
1    37  1503
---- Validation: 
scalar performance:
{'acc': 0.7394366, 'precision': 0.74813694, 'recall': 0.7367314, 'specificity': 0.7367314, 'f1': 0.7355466, 'auroc': 0.84670806, 'binary_precision': 0.7884232, 'binary_recall': 0.6350482, 'binary_specificity': 0.8384146, 'binary_f1_score': 0.7034728}
confusion matrix:
     0    1
0  550  106
1  227  395
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8171296, 'precision': 0.8176812, 'recall': 0.8171296, 'specificity': 0.8171296, 'f1': 0.8170502, 'auroc': 0.87628603, 'binary_precision': 0.80444443, 'binary_recall': 0.837963, 'binary_specificity': 0.7962963, 'binary_f1_score': 0.8208617}
confusion matrix:
     0    1
0  172   44
1   35  181
new oracle model saved
early stop counter: 2
val acc:0.7394366264343262, best validation acc: 0.8169013857841492, corresponding to test acc:                         0.8078703880310059 / 0.8171296119689941
after epoch: 5,now: 2024-07-27 03:00:17.022458,epoch time: 0:01:22.817713,used: 0:06:57.486087,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.98036647, 'precision': 0.980517, 'recall': 0.9803088, 'specificity': 0.9803088, 'f1': 0.98036206, 'auroc': 0.99794316, 'binary_precision': 0.9737516, 'binary_recall': 0.9876623, 'binary_specificity': 0.97295517, 'binary_f1_score': 0.98065764}
confusion matrix:
      0     1
0  1475    41
1    19  1521
---- Validation: 
scalar performance:
{'acc': 0.75352114, 'precision': 0.801779, 'recall': 0.7480761, 'specificity': 0.7480761, 'f1': 0.74043065, 'auroc': 0.8848326, 'binary_precision': 0.91598916, 'binary_recall': 0.54340833, 'binary_specificity': 0.9527439, 'binary_f1_score': 0.6821392}
confusion matrix:
     0    1
0  625   31
1  284  338
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7407407, 'precision': 0.8064164, 'recall': 0.7407408, 'specificity': 0.7407408, 'f1': 0.7260622, 'auroc': 0.9083719, 'binary_precision': 0.94827586, 'binary_recall': 0.5092593, 'binary_specificity': 0.9722222, 'binary_f1_score': 0.66265064}
confusion matrix:
     0    1
0  210    6
1  106  110
early stop counter: 3
val acc:0.7535211443901062, best validation acc: 0.8169013857841492, corresponding to test acc:                         0.8078703880310059 / 0.8171296119689941
after epoch: 6,now: 2024-07-27 03:01:39.159939,epoch time: 0:01:22.137481,used: 0:08:19.623568,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9820026, 'precision': 0.982126, 'recall': 0.9820812, 'specificity': 0.9820812, 'f1': 0.9820025, 'auroc': 0.99799454, 'binary_precision': 0.9920477, 'binary_recall': 0.9720779, 'binary_specificity': 0.99208444, 'binary_f1_score': 0.98196125}
confusion matrix:
      0     1
0  1504    12
1    43  1497
---- Validation: 
scalar performance:
{'acc': 0.7965571, 'precision': 0.81948483, 'recall': 0.7929133, 'specificity': 0.7929133, 'f1': 0.79134434, 'auroc': 0.89020467, 'binary_precision': 0.8986784, 'binary_recall': 0.6559486, 'binary_specificity': 0.92987806, 'binary_f1_score': 0.7583644}
confusion matrix:
     0    1
0  610   46
1  214  408
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7569444, 'precision': 0.7861439, 'recall': 0.7569444, 'specificity': 0.7569444, 'f1': 0.7505815, 'auroc': 0.85866773, 'binary_precision': 0.877551, 'binary_recall': 0.5972222, 'binary_specificity': 0.9166667, 'binary_f1_score': 0.71074384}
confusion matrix:
     0    1
0  198   18
1   87  129
early stop counter: 4
val acc:0.7965571284294128, best validation acc: 0.8169013857841492, corresponding to test acc:                         0.8078703880310059 / 0.8171296119689941
after epoch: 7,now: 2024-07-27 03:03:01.791004,epoch time: 0:01:22.631065,used: 0:09:42.254633,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.97938484, 'precision': 0.9797976, 'recall': 0.9795146, 'specificity': 0.9795146, 'f1': 0.9793832, 'auroc': 0.99888164, 'binary_precision': 0.9959704, 'binary_recall': 0.962987, 'binary_specificity': 0.9960422, 'binary_f1_score': 0.979201}
confusion matrix:
      0     1
0  1510     6
1    57  1483
---- Validation: 
scalar performance:
{'acc': 0.6737089, 'precision': 0.7523794, 'recall': 0.6660409, 'specificity': 0.6660409, 'f1': 0.6400129, 'auroc': 0.8465096, 'binary_precision': 0.8867925, 'binary_recall': 0.37781352, 'binary_specificity': 0.9542683, 'binary_f1_score': 0.529876}
confusion matrix:
     0    1
0  626   30
1  387  235
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7916667, 'precision': 0.8096105, 'recall': 0.7916666, 'specificity': 0.7916666, 'f1': 0.7886038, 'auroc': 0.8992627, 'binary_precision': 0.88414633, 'binary_recall': 0.6712963, 'binary_specificity': 0.912037, 'binary_f1_score': 0.7631579}
confusion matrix:
     0    1
0  197   19
1   71  145
early stop counter: 5
val acc:0.6737089157104492, best validation acc: 0.8169013857841492, corresponding to test acc:                         0.8078703880310059 / 0.8171296119689941
after epoch: 8,now: 2024-07-27 03:04:24.152846,epoch time: 0:01:22.361842,used: 0:11:04.616475,model: dset_te_center0_diva_b8efecac6_not_commited_2024md_07md_27_02_53_18_seed_2_23090493
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 0:11:04.616475 at 2024-07-27 03:04:24.152846
persisted model performance metric: 

scalar performance:
{'acc': 0.8078704, 'precision': 0.81617177, 'recall': 0.8078704, 'specificity': 0.8078704, 'f1': 0.8066009, 'auroc': 0.92176783, 'binary_precision': 0.76494026, 'binary_recall': 0.8888889, 'binary_specificity': 0.7268519, 'binary_f1_score': 0.82226986}
confusion matrix:
     0    1
0  157   59
1   24  192
oracle model performance metric: 

scalar performance:
{'acc': 0.8171296, 'precision': 0.8176812, 'recall': 0.8171296, 'specificity': 0.8171296, 'f1': 0.8170502, 'auroc': 0.87628603, 'binary_precision': 0.80444443, 'binary_recall': 0.837963, 'binary_specificity': 0.7962963, 'binary_f1_score': 0.8208617}
confusion matrix:
     0    1
0  172   44
1   35  181
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/rule_results/16.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_diva_irm_3seeds_nofreeze_2024-07-27_01-18-02/confusion_matrix/16.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   1063 MiB |  13837 MiB |  69421 GiB |  69420 GiB |
|       from large pool |   1002 MiB |  13776 MiB |  68549 GiB |  68548 GiB |
|       from small pool |     61 MiB |    102 MiB |    872 GiB |    872 GiB |
|---------------------------------------------------------------------------|
| Active memory         |   1063 MiB |  13837 MiB |  69421 GiB |  69420 GiB |
|       from large pool |   1002 MiB |  13776 MiB |  68549 GiB |  68548 GiB |
|       from small pool |     61 MiB |    102 MiB |    872 GiB |    872 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |   1052 MiB |  13828 MiB |  69365 GiB |  69364 GiB |
|       from large pool |    991 MiB |  13768 MiB |  68494 GiB |  68493 GiB |
|       from small pool |     61 MiB |    102 MiB |    870 GiB |    870 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |  14898 MiB |  14988 MiB |  38986 MiB |  24088 MiB |
|       from large pool |  14790 MiB |  14880 MiB |  38798 MiB |  24008 MiB |
|       from small pool |    108 MiB |    112 MiB |    188 MiB |     80 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   1980 MiB |   3249 MiB |  55274 GiB |  55272 GiB |
|       from large pool |   1971 MiB |   3240 MiB |  54396 GiB |  54395 GiB |
|       from small pool |      8 MiB |     38 MiB |    877 GiB |    877 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1784    |    3099    |   12529 K  |   12527 K  |
|       from large pool |     265    |    1491    |    6203 K  |    6203 K  |
|       from small pool |    1519    |    2223    |    6325 K  |    6323 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1784    |    3099    |   12529 K  |   12527 K  |
|       from large pool |     265    |    1491    |    6203 K  |    6203 K  |
|       from small pool |    1519    |    2223    |    6325 K  |    6323 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     549    |     591    |    1518    |     969    |
|       from large pool |     495    |     537    |    1424    |     929    |
|       from small pool |      54    |      56    |      94    |      40    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |     135    |     574    |    8434 K  |    8434 K  |
|       from large pool |      54    |     532    |    4551 K  |    4551 K  |
|       from small pool |      81    |     236    |    3883 K  |    3883 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |  13837 MiB |  69421 GiB |  69421 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  68549 GiB |  68549 GiB |
|       from small pool |      0 KiB |    102 MiB |    872 GiB |    872 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |  13837 MiB |  69421 GiB |  69421 GiB |
|       from large pool |  16640 KiB |  13776 MiB |  68549 GiB |  68549 GiB |
|       from small pool |      0 KiB |    102 MiB |    872 GiB |    872 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |  13828 MiB |  69365 GiB |  69365 GiB |
|       from large pool |  16640 KiB |  13768 MiB |  68494 GiB |  68494 GiB |
|       from small pool |      0 KiB |    102 MiB |    870 GiB |    870 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   3044 MiB |  14988 MiB |  38986 MiB |  35942 MiB |
|       from large pool |   2974 MiB |  14880 MiB |  38798 MiB |  35824 MiB |
|       from small pool |     70 MiB |    112 MiB |    188 MiB |    118 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB |   3249 MiB |  55275 GiB |  55275 GiB |
|       from large pool |  24320 KiB |   3240 MiB |  54397 GiB |  54397 GiB |
|       from small pool |      0 KiB |     41 MiB |    877 GiB |    877 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    3099    |   12529 K  |   12529 K  |
|       from large pool |       2    |    1491    |    6203 K  |    6203 K  |
|       from small pool |       0    |    2223    |    6325 K  |    6325 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    3099    |   12529 K  |   12529 K  |
|       from large pool |       2    |    1491    |    6203 K  |    6203 K  |
|       from small pool |       0    |    2223    |    6325 K  |    6325 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      91    |     591    |    1518    |    1427    |
|       from large pool |      56    |     537    |    1424    |    1368    |
|       from small pool |      35    |      56    |      94    |      59    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     574    |    8434 K  |    8434 K  |
|       from large pool |       3    |     532    |    4551 K  |    4551 K  |
|       from small pool |       0    |     236    |    3883 K  |    3883 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 03:04:32 2024]
Finished job 0.
1 of 1 steps (100%) done
