Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Tue Jul 23 01:57:10 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/rule_results/0.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=0
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262

 Experiment start at: 2024-07-23 01:59:53.047000
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.569767415523529
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9684245, 'precision': 0.9685465, 'recall': 0.9685833, 'specificity': 0.9685833, 'f1': 0.9684244, 'auroc': 0.9958831, 'binary_precision': 0.9802632, 'binary_recall': 0.95696855, 'binary_specificity': 0.980198, 'binary_f1_score': 0.96847576}
confusion matrix:
      0     1
0  1485    30
1    67  1490
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.8214286, 'precision': 0.82836527, 'recall': 0.8224355, 'specificity': 0.8224355, 'f1': 0.82077134, 'auroc': 0.90140057, 'binary_precision': 0.7770178, 'binary_recall': 0.8944882, 'binary_specificity': 0.75038284, 'binary_f1_score': 0.8316252}
confusion matrix:
     0    1
0  490  163
1   67  568
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.82790697, 'precision': 0.83022153, 'recall': 0.82790697, 'specificity': 0.82790697, 'f1': 0.8276049, 'auroc': 0.91554356, 'binary_precision': 0.8025751, 'binary_recall': 0.8697674, 'binary_specificity': 0.7860465, 'binary_f1_score': 0.83482146}
confusion matrix:
     0    1
0  169   46
1   28  187
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-23 02:01:48.169347,epoch time: 0:01:55.122347,used: 0:01:55.122347,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.93391925, 'precision': 0.9415684, 'recall': 0.9330057, 'specificity': 0.9330057, 'f1': 0.93352365, 'auroc': 0.99636257, 'binary_precision': 0.88692176, 'binary_recall': 0.99679077, 'binary_specificity': 0.8692206, 'binary_f1_score': 0.93865216}
confusion matrix:
      0     1
0  1316   198
1     5  1553
---- Validation: 
scalar performance:
{'acc': 0.63897514, 'precision': 0.7674345, 'recall': 0.6437557, 'specificity': 0.6437557, 'f1': 0.59392583, 'auroc': 0.9101392, 'binary_precision': 0.5785582, 'binary_recall': 0.9858268, 'binary_specificity': 0.30168453, 'binary_f1_score': 0.7291788}
confusion matrix:
     0    1
0  197  456
1    9  626
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6, 'precision': 0.73914844, 'recall': 0.6, 'specificity': 0.6, 'f1': 0.5319106, 'auroc': 0.89700377, 'binary_precision': 0.55672824, 'binary_recall': 0.98139536, 'binary_specificity': 0.21860465, 'binary_f1_score': 0.7104377}
confusion matrix:
    0    1
0  47  168
1   4  211
early stop counter: 1
val acc:0.6389751434326172, best validation acc: 0.8214285969734192, corresponding to test acc:                         0.8279069662094116 / 0.8279069662094116
after epoch: 2,now: 2024-07-23 02:03:25.723537,epoch time: 0:01:37.554190,used: 0:03:32.676537,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9746094, 'precision': 0.97529733, 'recall': 0.9749306, 'specificity': 0.9749306, 'f1': 0.9746076, 'auroc': 0.9972851, 'binary_precision': 0.99731183, 'binary_recall': 0.9525032, 'binary_specificity': 0.99735796, 'binary_f1_score': 0.97439265}
confusion matrix:
      0     1
0  1510     4
1    74  1484
---- Validation: 
scalar performance:
{'acc': 0.8680124, 'precision': 0.8727647, 'recall': 0.86722696, 'specificity': 0.86722696, 'f1': 0.86739343, 'auroc': 0.92763627, 'binary_precision': 0.91150445, 'binary_recall': 0.8110236, 'binary_specificity': 0.9234303, 'binary_f1_score': 0.85833335}
confusion matrix:
     0    1
0  603   50
1  120  515
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8604651, 'precision': 0.8650135, 'recall': 0.8604651, 'specificity': 0.8604651, 'f1': 0.86002904, 'auroc': 0.9270957, 'binary_precision': 0.90575916, 'binary_recall': 0.80465114, 'binary_specificity': 0.9162791, 'binary_f1_score': 0.8522167}
confusion matrix:
     0    1
0  197   18
1   42  173
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-23 02:05:04.945205,epoch time: 0:01:39.221668,used: 0:05:11.898205,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97526044, 'precision': 0.9759629, 'recall': 0.9755674, 'specificity': 0.9755674, 'f1': 0.97525835, 'auroc': 0.99822366, 'binary_precision': 0.9979825, 'binary_recall': 0.953115, 'binary_specificity': 0.9980198, 'binary_f1_score': 0.97503287}
confusion matrix:
      0     1
0  1512     3
1    73  1484
---- Validation: 
scalar performance:
{'acc': 0.7795031, 'precision': 0.8059996, 'recall': 0.7774198, 'specificity': 0.7774198, 'f1': 0.7737147, 'auroc': 0.89761853, 'binary_precision': 0.89261746, 'binary_recall': 0.62834644, 'binary_specificity': 0.9264931, 'binary_f1_score': 0.73752314}
confusion matrix:
     0    1
0  605   48
1  236  399
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.74883723, 'precision': 0.81409574, 'recall': 0.74883723, 'specificity': 0.74883723, 'f1': 0.73507667, 'auroc': 0.91787994, 'binary_precision': 0.95726496, 'binary_recall': 0.52093023, 'binary_specificity': 0.9767442, 'binary_f1_score': 0.67469877}
confusion matrix:
     0    1
0  210    5
1  103  112
early stop counter: 1
val acc:0.7795031070709229, best validation acc: 0.8680124282836914, corresponding to test acc:                         0.8604651093482971 / 0.8604651093482971
after epoch: 4,now: 2024-07-23 02:06:42.437454,epoch time: 0:01:37.492249,used: 0:06:49.390454,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9785156, 'precision': 0.97864217, 'recall': 0.9786885, 'specificity': 0.9786885, 'f1': 0.97851557, 'auroc': 0.99838686, 'binary_precision': 0.9907895, 'binary_recall': 0.9666239, 'binary_specificity': 0.990753, 'binary_f1_score': 0.9785575}
confusion matrix:
      0     1
0  1500    14
1    52  1506
---- Validation: 
scalar performance:
{'acc': 0.77018636, 'precision': 0.82375467, 'recall': 0.7673198, 'specificity': 0.7673198, 'f1': 0.758957, 'auroc': 0.9301902, 'binary_precision': 0.952, 'binary_recall': 0.5622047, 'binary_specificity': 0.97243494, 'binary_f1_score': 0.7069307}
confusion matrix:
     0    1
0  635   18
1  278  357
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.76046515, 'precision': 0.8380503, 'recall': 0.76046515, 'specificity': 0.76046515, 'f1': 0.7458848, 'auroc': 0.94600326, 'binary_precision': 1.0, 'binary_recall': 0.52093023, 'binary_specificity': 1.0, 'binary_f1_score': 0.68501526}
confusion matrix:
     0    1
0  215    0
1  103  112
early stop counter: 2
val acc:0.7701863646507263, best validation acc: 0.8680124282836914, corresponding to test acc:                         0.8604651093482971 / 0.8604651093482971
after epoch: 5,now: 2024-07-23 02:08:20.898464,epoch time: 0:01:38.461010,used: 0:08:27.851464,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.99121094, 'precision': 0.9912368, 'recall': 0.9911858, 'specificity': 0.9911858, 'f1': 0.9912087, 'auroc': 0.9995655, 'binary_precision': 0.98976326, 'binary_recall': 0.99293965, 'binary_specificity': 0.989432, 'binary_f1_score': 0.9913489}
confusion matrix:
      0     1
0  1498    16
1    11  1547
---- Validation: 
scalar performance:
{'acc': 0.7088509, 'precision': 0.7795423, 'recall': 0.7052887, 'specificity': 0.7052887, 'f1': 0.686905, 'auroc': 0.8764852, 'binary_precision': 0.9166667, 'binary_recall': 0.4503937, 'binary_specificity': 0.96018374, 'binary_f1_score': 0.60401267}
confusion matrix:
     0    1
0  627   26
1  349  286
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.80465114, 'precision': 0.85651, 'recall': 0.80465114, 'specificity': 0.80465114, 'f1': 0.79727906, 'auroc': 0.9389075, 'binary_precision': 0.99248123, 'binary_recall': 0.6139535, 'binary_specificity': 0.9953488, 'binary_f1_score': 0.7586207}
confusion matrix:
     0    1
0  214    1
1   83  132
early stop counter: 3
val acc:0.7088509202003479, best validation acc: 0.8680124282836914, corresponding to test acc:                         0.8604651093482971 / 0.8604651093482971
after epoch: 6,now: 2024-07-23 02:09:58.288256,epoch time: 0:01:37.389792,used: 0:10:05.241256,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9873047, 'precision': 0.98733103, 'recall': 0.9874085, 'specificity': 0.9874085, 'f1': 0.98730445, 'auroc': 0.9991356, 'binary_precision': 0.99542785, 'binary_recall': 0.97943443, 'binary_specificity': 0.9953826, 'binary_f1_score': 0.9873664}
confusion matrix:
      0     1
0  1509     7
1    32  1524
---- Validation: 
scalar performance:
{'acc': 0.7872671, 'precision': 0.82762516, 'recall': 0.78479457, 'specificity': 0.78479457, 'f1': 0.77948236, 'auroc': 0.92539155, 'binary_precision': 0.93917274, 'binary_recall': 0.60787404, 'binary_specificity': 0.96171516, 'binary_f1_score': 0.7380497}
confusion matrix:
     0    1
0  628   25
1  249  386
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8116279, 'precision': 0.8574797, 'recall': 0.8116279, 'specificity': 0.8116279, 'f1': 0.8053875, 'auroc': 0.9318334, 'binary_precision': 0.98550725, 'binary_recall': 0.63255817, 'binary_specificity': 0.9906977, 'binary_f1_score': 0.77053833}
confusion matrix:
     0    1
0  213    2
1   79  136
early stop counter: 4
val acc:0.7872670888900757, best validation acc: 0.8680124282836914, corresponding to test acc:                         0.8604651093482971 / 0.8604651093482971
after epoch: 7,now: 2024-07-23 02:11:35.946411,epoch time: 0:01:37.658155,used: 0:11:42.899411,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9749349, 'precision': 0.9756503, 'recall': 0.9747144, 'specificity': 0.9747144, 'f1': 0.9749129, 'auroc': 0.9987689, 'binary_precision': 0.96017426, 'binary_recall': 0.9916452, 'binary_specificity': 0.95778364, 'binary_f1_score': 0.97565603}
confusion matrix:
      0     1
0  1452    64
1    13  1543
---- Validation: 
scalar performance:
{'acc': 0.8299689, 'precision': 0.83468264, 'recall': 0.830793, 'specificity': 0.830793, 'f1': 0.8295866, 'auroc': 0.92221004, 'binary_precision': 0.7913165, 'binary_recall': 0.8897638, 'binary_specificity': 0.77182233, 'binary_f1_score': 0.83765745}
confusion matrix:
     0    1
0  504  149
1   70  565
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8581395, 'precision': 0.8590795, 'recall': 0.8581395, 'specificity': 0.8581395, 'f1': 0.85804665, 'auroc': 0.9315738, 'binary_precision': 0.877451, 'binary_recall': 0.83255816, 'binary_specificity': 0.88372093, 'binary_f1_score': 0.85441536}
confusion matrix:
     0    1
0  190   25
1   36  179
early stop counter: 5
val acc:0.8299689292907715, best validation acc: 0.8680124282836914, corresponding to test acc:                         0.8604651093482971 / 0.8604651093482971
after epoch: 8,now: 2024-07-23 02:13:13.668599,epoch time: 0:01:37.722188,used: 0:13:20.621599,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_01_59_53_seed_0_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 0:13:20.621599 at 2024-07-23 02:13:13.668599
persisted model performance metric: 

scalar performance:
{'acc': 0.8604651, 'precision': 0.8650135, 'recall': 0.8604651, 'specificity': 0.8604651, 'f1': 0.86002904, 'auroc': 0.9270957, 'binary_precision': 0.90575916, 'binary_recall': 0.80465114, 'binary_specificity': 0.9162791, 'binary_f1_score': 0.8522167}
confusion matrix:
     0    1
0  197   18
1   42  173
oracle model performance metric: 

scalar performance:
{'acc': 0.8604651, 'precision': 0.8650135, 'recall': 0.8604651, 'specificity': 0.8604651, 'f1': 0.86002904, 'auroc': 0.9270957, 'binary_precision': 0.90575916, 'binary_recall': 0.80465114, 'binary_specificity': 0.9162791, 'binary_f1_score': 0.8522167}
confusion matrix:
     0    1
0  197   18
1   42  173
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/rule_results/0.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454592 KiB |   3644 MiB |  17759 GiB |  17759 GiB |
|       from large pool | 414039 KiB |   3611 MiB |  17637 GiB |  17637 GiB |
|       from small pool |  40553 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454592 KiB |   3644 MiB |  17759 GiB |  17759 GiB |
|       from large pool | 414039 KiB |   3611 MiB |  17637 GiB |  17637 GiB |
|       from small pool |  40553 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447480 KiB |   3642 MiB |  17754 GiB |  17754 GiB |
|       from large pool | 407075 KiB |   3608 MiB |  17632 GiB |  17632 GiB |
|       from small pool |  40405 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4030 MiB |   4030 MiB |   4030 MiB |      0 B   |
|       from large pool |   3966 MiB |   3966 MiB |   3966 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 550975 KiB | 640882 KiB |   8700 GiB |   8699 GiB |
|       from large pool | 544425 KiB | 634037 KiB |   8572 GiB |   8572 GiB |
|       from small pool |   6550 KiB |  12114 KiB |    127 GiB |    127 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1220    |    1591    |    1734 K  |    1732 K  |
|       from large pool |     187    |     311    |     839 K  |     839 K  |
|       from small pool |    1033    |    1329    |     894 K  |     893 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1220    |    1591    |    1734 K  |    1732 K  |
|       from large pool |     187    |     311    |     839 K  |     839 K  |
|       from small pool |    1033    |    1329    |     894 K  |     893 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     150    |     150    |     150    |       0    |
|       from large pool |     118    |     118    |     118    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      69    |     157    |    1046 K  |    1046 K  |
|       from large pool |      32    |     117    |     667 K  |     667 K  |
|       from small pool |      37    |     125    |     378 K  |     378 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  17759 GiB |  17759 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  17637 GiB |  17637 GiB |
|       from small pool |      0 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  17759 GiB |  17759 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  17637 GiB |  17637 GiB |
|       from small pool |      0 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  17754 GiB |  17754 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  17632 GiB |  17632 GiB |
|       from small pool |      0 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    982 MiB |   4030 MiB |   4030 MiB |   3048 MiB |
|       from large pool |    936 MiB |   3966 MiB |   3966 MiB |   3030 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 640882 KiB |   8700 GiB |   8700 GiB |
|       from large pool |   3840 KiB | 634037 KiB |   8572 GiB |   8572 GiB |
|       from small pool |      0 KiB |  21810 KiB |    127 GiB |    127 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1591    |    1734 K  |    1734 K  |
|       from large pool |       2    |     311    |     839 K  |     839 K  |
|       from small pool |       0    |    1329    |     894 K  |     894 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1591    |    1734 K  |    1734 K  |
|       from large pool |       2    |     311    |     839 K  |     839 K  |
|       from small pool |       0    |    1329    |     894 K  |     894 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     150    |     150    |      91    |
|       from large pool |      36    |     118    |     118    |      82    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     157    |    1046 K  |    1046 K  |
|       from large pool |       1    |     117    |     667 K  |     667 K  |
|       from small pool |       0    |     125    |     378 K  |     378 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  17759 GiB |  17759 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  17637 GiB |  17637 GiB |
|       from small pool |      0 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  17759 GiB |  17759 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  17637 GiB |  17637 GiB |
|       from small pool |      0 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  17754 GiB |  17754 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  17632 GiB |  17632 GiB |
|       from small pool |      0 KiB |     56 MiB |    121 GiB |    121 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    982 MiB |   4030 MiB |   4030 MiB |   3048 MiB |
|       from large pool |    936 MiB |   3966 MiB |   3966 MiB |   3030 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 640882 KiB |   8700 GiB |   8700 GiB |
|       from large pool |   3840 KiB | 634037 KiB |   8572 GiB |   8572 GiB |
|       from small pool |      0 KiB |  21810 KiB |    127 GiB |    127 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1591    |    1734 K  |    1734 K  |
|       from large pool |       2    |     311    |     839 K  |     839 K  |
|       from small pool |       0    |    1329    |     894 K  |     894 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1591    |    1734 K  |    1734 K  |
|       from large pool |       2    |     311    |     839 K  |     839 K  |
|       from small pool |       0    |    1329    |     894 K  |     894 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     150    |     150    |      91    |
|       from large pool |      36    |     118    |     118    |      82    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     157    |    1046 K  |    1046 K  |
|       from large pool |       1    |     117    |     667 K  |     667 K  |
|       from small pool |       0    |     125    |     378 K  |     378 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262

 Experiment start at: 2024-07-23 02:14:40.744552
before training, model accuracy: 0.6177777647972107
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.91341144, 'precision': 0.9230852, 'recall': 0.9123982, 'specificity': 0.9123982, 'f1': 0.9127573, 'auroc': 0.9917295, 'binary_precision': 0.86243683, 'binary_recall': 0.98651254, 'binary_specificity': 0.83828384, 'binary_f1_score': 0.9203115}
confusion matrix:
      0     1
0  1270   245
1    21  1536
---- Validation: 
scalar performance:
{'acc': 0.7392662, 'precision': 0.79591, 'recall': 0.74280596, 'specificity': 0.74280596, 'f1': 0.7279736, 'auroc': 0.924007, 'binary_precision': 0.6622807, 'binary_recall': 0.95873016, 'binary_specificity': 0.5268817, 'binary_f1_score': 0.78339815}
confusion matrix:
     0    1
0  343  308
1   26  604
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.77555555, 'precision': 0.81210846, 'recall': 0.77555555, 'specificity': 0.77555555, 'f1': 0.76878583, 'auroc': 0.92756546, 'binary_precision': 0.705298, 'binary_recall': 0.94666666, 'binary_specificity': 0.60444444, 'binary_f1_score': 0.80834913}
confusion matrix:
     0    1
0  136   89
1   12  213
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-23 02:16:22.407761,epoch time: 0:01:41.663209,used: 0:01:41.663209,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.90755206, 'precision': 0.92082196, 'recall': 0.90884817, 'specificity': 0.90884817, 'f1': 0.90699387, 'auroc': 0.99183816, 'binary_precision': 0.9992163, 'binary_recall': 0.8183569, 'binary_specificity': 0.9993395, 'binary_f1_score': 0.89978826}
confusion matrix:
      0     1
0  1513     1
1   283  1275
---- Validation: 
scalar performance:
{'acc': 0.5480094, 'precision': 0.71095645, 'recall': 0.54065543, 'specificity': 0.54065543, 'f1': 0.42839164, 'auroc': 0.8706343, 'binary_precision': 0.8923077, 'binary_recall': 0.092063494, 'binary_specificity': 0.9892473, 'binary_f1_score': 0.16690648}
confusion matrix:
     0   1
0  644   7
1  572  58
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.61777776, 'precision': 0.7744534, 'recall': 0.61777776, 'specificity': 0.61777776, 'f1': 0.5541475, 'auroc': 0.90652835, 'binary_precision': 0.9818182, 'binary_recall': 0.24, 'binary_specificity': 0.9955556, 'binary_f1_score': 0.3857143}
confusion matrix:
     0   1
0  224   1
1  171  54
early stop counter: 1
val acc:0.5480093955993652, best validation acc: 0.7392662167549133, corresponding to test acc:                         0.7755555510520935 / 0.7755555510520935
after epoch: 2,now: 2024-07-23 02:18:00.007558,epoch time: 0:01:37.599797,used: 0:03:19.263006,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9703776, 'precision': 0.9704712, 'recall': 0.97031265, 'specificity': 0.97031265, 'f1': 0.97036874, 'auroc': 0.9959023, 'binary_precision': 0.966242, 'binary_recall': 0.9755627, 'binary_specificity': 0.9650626, 'binary_f1_score': 0.97088}
confusion matrix:
      0     1
0  1464    53
1    38  1517
---- Validation: 
scalar performance:
{'acc': 0.8594848, 'precision': 0.8596976, 'recall': 0.8592678, 'specificity': 0.8592678, 'f1': 0.85937977, 'auroc': 0.90419865, 'binary_precision': 0.86525977, 'binary_recall': 0.8460317, 'binary_specificity': 0.8725038, 'binary_f1_score': 0.85553765}
confusion matrix:
     0    1
0  568   83
1   97  533
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86444443, 'precision': 0.87149644, 'recall': 0.86444443, 'specificity': 0.86444443, 'f1': 0.8637981, 'auroc': 0.9396938, 'binary_precision': 0.92268044, 'binary_recall': 0.79555553, 'binary_specificity': 0.93333334, 'binary_f1_score': 0.8544153}
confusion matrix:
     0    1
0  210   15
1   46  179
new oracle model saved
better model found
persisted
after epoch: 3,now: 2024-07-23 02:19:37.945273,epoch time: 0:01:37.937715,used: 0:04:57.200721,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9746094, 'precision': 0.975034, 'recall': 0.9744525, 'specificity': 0.9744525, 'f1': 0.9745939, 'auroc': 0.9977015, 'binary_precision': 0.9635907, 'binary_recall': 0.9871383, 'binary_specificity': 0.96176666, 'binary_f1_score': 0.9752224}
confusion matrix:
      0     1
0  1459    58
1    20  1535
---- Validation: 
scalar performance:
{'acc': 0.83138174, 'precision': 0.83789563, 'recall': 0.83251405, 'specificity': 0.83251405, 'f1': 0.83086216, 'auroc': 0.91405165, 'binary_precision': 0.7867036, 'binary_recall': 0.9015873, 'binary_specificity': 0.76344085, 'binary_f1_score': 0.8402367}
confusion matrix:
     0    1
0  497  154
1   62  568
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.86444443, 'precision': 0.8660714, 'recall': 0.8644445, 'specificity': 0.8644445, 'f1': 0.86429363, 'auroc': 0.9447901, 'binary_precision': 0.84166664, 'binary_recall': 0.8977778, 'binary_specificity': 0.83111113, 'binary_f1_score': 0.86881715}
confusion matrix:
     0    1
0  187   38
1   23  202
early stop counter: 1
val acc:0.8313817381858826, best validation acc: 0.8594847917556763, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 4,now: 2024-07-23 02:21:14.392836,epoch time: 0:01:36.447563,used: 0:06:33.648284,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98860675, 'precision': 0.98859394, 'recall': 0.98866546, 'specificity': 0.98866546, 'f1': 0.9886061, 'auroc': 0.9988719, 'binary_precision': 0.9935065, 'binary_recall': 0.98392284, 'binary_specificity': 0.993408, 'binary_f1_score': 0.9886914}
confusion matrix:
      0     1
0  1507    10
1    25  1530
---- Validation: 
scalar performance:
{'acc': 0.83138174, 'precision': 0.83155334, 'recall': 0.8311572, 'specificity': 0.8311572, 'f1': 0.83125573, 'auroc': 0.902192, 'binary_precision': 0.83603895, 'binary_recall': 0.8174603, 'binary_specificity': 0.84485406, 'binary_f1_score': 0.82664526}
confusion matrix:
     0    1
0  550  101
1  115  515
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8622222, 'precision': 0.8622508, 'recall': 0.8622222, 'specificity': 0.8622222, 'f1': 0.8622195, 'auroc': 0.93457776, 'binary_precision': 0.85903084, 'binary_recall': 0.8666667, 'binary_specificity': 0.8577778, 'binary_f1_score': 0.8628319}
confusion matrix:
     0    1
0  193   32
1   30  195
early stop counter: 2
val acc:0.8313817381858826, best validation acc: 0.8594847917556763, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 5,now: 2024-07-23 02:22:53.021729,epoch time: 0:01:38.628893,used: 0:08:12.277177,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9658203, 'precision': 0.96763253, 'recall': 0.9662379, 'specificity': 0.9662379, 'f1': 0.9658041, 'auroc': 0.9992051, 'binary_precision': 1.0, 'binary_recall': 0.93247586, 'binary_specificity': 1.0, 'binary_f1_score': 0.96505827}
confusion matrix:
      0     1
0  1517     0
1   105  1450
---- Validation: 
scalar performance:
{'acc': 0.72287273, 'precision': 0.7960949, 'recall': 0.7187404, 'specificity': 0.7187404, 'f1': 0.7021354, 'auroc': 0.9103162, 'binary_precision': 0.93929714, 'binary_recall': 0.46666667, 'binary_specificity': 0.9708141, 'binary_f1_score': 0.6235419}
confusion matrix:
     0    1
0  632   19
1  336  294
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7511111, 'precision': 0.80152273, 'recall': 0.75111115, 'specificity': 0.75111115, 'f1': 0.7402544, 'auroc': 0.90639013, 'binary_precision': 0.924812, 'binary_recall': 0.5466667, 'binary_specificity': 0.95555556, 'binary_f1_score': 0.68715084}
confusion matrix:
     0    1
0  215   10
1  102  123
early stop counter: 3
val acc:0.7228727340698242, best validation acc: 0.8594847917556763, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 6,now: 2024-07-23 02:24:30.632627,epoch time: 0:01:37.610898,used: 0:09:49.888075,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9817708, 'precision': 0.98198867, 'recall': 0.9816552, 'specificity': 0.9816552, 'f1': 0.9817619, 'auroc': 0.9990652, 'binary_precision': 0.97471553, 'binary_recall': 0.9897304, 'binary_specificity': 0.97357994, 'binary_f1_score': 0.9821656}
confusion matrix:
      0     1
0  1474    40
1    16  1542
---- Validation: 
scalar performance:
{'acc': 0.8290398, 'precision': 0.8291136, 'recall': 0.82918584, 'specificity': 0.82918584, 'f1': 0.82903606, 'auroc': 0.89129543, 'binary_precision': 0.81860465, 'binary_recall': 0.83809525, 'binary_specificity': 0.8202765, 'binary_f1_score': 0.82823527}
confusion matrix:
     0    1
0  534  117
1  102  528
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7822222, 'precision': 0.78963697, 'recall': 0.7822222, 'specificity': 0.7822222, 'f1': 0.78081954, 'auroc': 0.87527895, 'binary_precision': 0.743295, 'binary_recall': 0.8622222, 'binary_specificity': 0.7022222, 'binary_f1_score': 0.79835397}
confusion matrix:
     0    1
0  158   67
1   31  194
early stop counter: 4
val acc:0.8290398120880127, best validation acc: 0.8594847917556763, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 7,now: 2024-07-23 02:26:09.059842,epoch time: 0:01:38.427215,used: 0:11:28.315290,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9895833, 'precision': 0.9895627, 'recall': 0.9896324, 'specificity': 0.9896324, 'f1': 0.9895824, 'auroc': 0.9996766, 'binary_precision': 0.9935233, 'binary_recall': 0.9858612, 'binary_specificity': 0.9934037, 'binary_f1_score': 0.9896774}
confusion matrix:
      0     1
0  1506    10
1    22  1534
---- Validation: 
scalar performance:
{'acc': 0.852459, 'precision': 0.86358595, 'recall': 0.85102403, 'specificity': 0.85102403, 'f1': 0.8509237, 'auroc': 0.9199205, 'binary_precision': 0.92322457, 'binary_recall': 0.76349205, 'binary_specificity': 0.9385561, 'binary_f1_score': 0.835795}
confusion matrix:
     0    1
0  611   40
1  149  481
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.84444445, 'precision': 0.85349387, 'recall': 0.84444445, 'specificity': 0.84444445, 'f1': 0.84344244, 'auroc': 0.9105185, 'binary_precision': 0.9100529, 'binary_recall': 0.7644445, 'binary_specificity': 0.92444444, 'binary_f1_score': 0.8309179}
confusion matrix:
     0    1
0  208   17
1   53  172
early stop counter: 5
val acc:0.8524590134620667, best validation acc: 0.8594847917556763, corresponding to test acc:                         0.8644444346427917 / 0.8644444346427917
after epoch: 8,now: 2024-07-23 02:27:46.422458,epoch time: 0:01:37.362616,used: 0:13:05.677906,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_14_40_seed_1_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 8 with time: 0:13:05.677906 at 2024-07-23 02:27:46.422458
persisted model performance metric: 

scalar performance:
{'acc': 0.86444443, 'precision': 0.87149644, 'recall': 0.86444443, 'specificity': 0.86444443, 'f1': 0.8637981, 'auroc': 0.9396938, 'binary_precision': 0.92268044, 'binary_recall': 0.79555553, 'binary_specificity': 0.93333334, 'binary_f1_score': 0.8544153}
confusion matrix:
     0    1
0  210   15
1   46  179
oracle model performance metric: 

scalar performance:
{'acc': 0.86444443, 'precision': 0.87149644, 'recall': 0.86444443, 'specificity': 0.86444443, 'f1': 0.8637981, 'auroc': 0.9396938, 'binary_precision': 0.92268044, 'binary_recall': 0.79555553, 'binary_specificity': 0.93333334, 'binary_f1_score': 0.8544153}
confusion matrix:
     0    1
0  210   15
1   46  179
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 451882 KiB |   3644 MiB |  35545 GiB |  35545 GiB |
|       from large pool | 411326 KiB |   3611 MiB |  35299 GiB |  35298 GiB |
|       from small pool |  40556 KiB |     60 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 451882 KiB |   3644 MiB |  35545 GiB |  35545 GiB |
|       from large pool | 411326 KiB |   3611 MiB |  35299 GiB |  35298 GiB |
|       from small pool |  40556 KiB |     60 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3642 MiB |  35535 GiB |  35535 GiB |
|       from large pool | 407075 KiB |   3608 MiB |  35289 GiB |  35289 GiB |
|       from small pool |  40406 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4084 MiB |   4084 MiB |   7132 MiB |   3048 MiB |
|       from large pool |   4014 MiB |   4014 MiB |   7044 MiB |   3030 MiB |
|       from small pool |     70 MiB |     70 MiB |     88 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 590549 KiB | 662353 KiB |  17479 GiB |  17478 GiB |
|       from large pool | 584002 KiB | 657915 KiB |  17220 GiB |  17220 GiB |
|       from small pool |   6547 KiB |  21810 KiB |    258 GiB |    258 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1226    |    1597    |    3475 K  |    3473 K  |
|       from large pool |     187    |     311    |    1677 K  |    1677 K  |
|       from small pool |    1039    |    1335    |    1797 K  |    1796 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1226    |    1597    |    3475 K  |    3473 K  |
|       from large pool |     187    |     311    |    1677 K  |    1677 K  |
|       from small pool |    1039    |    1335    |    1797 K  |    1796 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     156    |     156    |     247    |      91    |
|       from large pool |     121    |     121    |     203    |      82    |
|       from small pool |      35    |      35    |      44    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      71    |     160    |    2055 K  |    2055 K  |
|       from large pool |      35    |     121    |    1328 K  |    1327 K  |
|       from small pool |      36    |     125    |     727 K  |     727 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  35545 GiB |  35545 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35299 GiB |  35299 GiB |
|       from small pool |      0 KiB |     60 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  35545 GiB |  35545 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35299 GiB |  35299 GiB |
|       from small pool |      0 KiB |     60 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  35535 GiB |  35535 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  35289 GiB |  35289 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1018 MiB |   4084 MiB |   7132 MiB |   6114 MiB |
|       from large pool |    972 MiB |   4014 MiB |   7044 MiB |   6072 MiB |
|       from small pool |     46 MiB |     70 MiB |     88 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 662353 KiB |  17479 GiB |  17479 GiB |
|       from large pool |   3840 KiB | 657915 KiB |  17221 GiB |  17221 GiB |
|       from small pool |      0 KiB |  22312 KiB |    258 GiB |    258 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1597    |    3475 K  |    3475 K  |
|       from large pool |       2    |     311    |    1677 K  |    1677 K  |
|       from small pool |       0    |    1335    |    1797 K  |    1797 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1597    |    3475 K  |    3475 K  |
|       from large pool |       2    |     311    |    1677 K  |    1677 K  |
|       from small pool |       0    |    1335    |    1797 K  |    1797 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      62    |     156    |     247    |     185    |
|       from large pool |      39    |     121    |     203    |     164    |
|       from small pool |      23    |      35    |      44    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     160    |    2056 K  |    2056 K  |
|       from large pool |       1    |     121    |    1328 K  |    1328 K  |
|       from small pool |       0    |     125    |     728 K  |     728 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  35545 GiB |  35545 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35299 GiB |  35299 GiB |
|       from small pool |      0 KiB |     60 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  35545 GiB |  35545 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  35299 GiB |  35299 GiB |
|       from small pool |      0 KiB |     60 MiB |    246 GiB |    246 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  35535 GiB |  35535 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  35289 GiB |  35289 GiB |
|       from small pool |      0 KiB |     60 MiB |    245 GiB |    245 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1018 MiB |   4084 MiB |   7132 MiB |   6114 MiB |
|       from large pool |    972 MiB |   4014 MiB |   7044 MiB |   6072 MiB |
|       from small pool |     46 MiB |     70 MiB |     88 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 662353 KiB |  17479 GiB |  17479 GiB |
|       from large pool |   3840 KiB | 657915 KiB |  17221 GiB |  17221 GiB |
|       from small pool |      0 KiB |  22312 KiB |    258 GiB |    258 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1597    |    3475 K  |    3475 K  |
|       from large pool |       2    |     311    |    1677 K  |    1677 K  |
|       from small pool |       0    |    1335    |    1797 K  |    1797 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1597    |    3475 K  |    3475 K  |
|       from large pool |       2    |     311    |    1677 K  |    1677 K  |
|       from small pool |       0    |    1335    |    1797 K  |    1797 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      62    |     156    |     247    |     185    |
|       from large pool |      39    |     121    |     203    |     164    |
|       from small pool |      23    |      35    |      44    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     160    |    2056 K  |    2056 K  |
|       from large pool |       1    |     121    |    1328 K  |    1328 K  |
|       from small pool |       0    |     125    |     728 K  |     728 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'888c1ef2'
model name: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262

 Experiment start at: 2024-07-23 02:29:17.722284
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.41203704476356506
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.96546054, 'precision': 0.96558, 'recall': 0.96540004, 'specificity': 0.96540004, 'f1': 0.9654523, 'auroc': 0.9948697, 'binary_precision': 0.9600773, 'binary_recall': 0.9719687, 'binary_specificity': 0.95883137, 'binary_f1_score': 0.96598643}
confusion matrix:
      0     1
0  1444    62
1    43  1491
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.8262911, 'precision': 0.82770765, 'recall': 0.827168, 'specificity': 0.827168, 'f1': 0.8262703, 'auroc': 0.8905846, 'binary_precision': 0.79850745, 'binary_recall': 0.86012864, 'binary_specificity': 0.79420733, 'binary_f1_score': 0.8281734}
confusion matrix:
     0    1
0  521  135
1   87  535
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8194444, 'precision': 0.81947184, 'recall': 0.8194444, 'specificity': 0.8194444, 'f1': 0.8194406, 'auroc': 0.89343274, 'binary_precision': 0.8165138, 'binary_recall': 0.8240741, 'binary_specificity': 0.8148148, 'binary_f1_score': 0.8202765}
confusion matrix:
     0    1
0  176   40
1   38  178
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-23 02:31:01.905253,epoch time: 0:01:44.182969,used: 0:01:44.182969,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.98059213, 'precision': 0.9806964, 'recall': 0.9806662, 'specificity': 0.9806662, 'f1': 0.980592, 'auroc': 0.99803436, 'binary_precision': 0.99002, 'binary_recall': 0.9712794, 'binary_specificity': 0.99005306, 'binary_f1_score': 0.9805601}
confusion matrix:
      0     1
0  1493    15
1    44  1488
---- Validation: 
scalar performance:
{'acc': 0.8028169, 'precision': 0.8251358, 'recall': 0.79926085, 'specificity': 0.79926085, 'f1': 0.79796743, 'auroc': 0.8963537, 'binary_precision': 0.9039301, 'binary_recall': 0.6655949, 'binary_specificity': 0.93292683, 'binary_f1_score': 0.76666665}
confusion matrix:
     0    1
0  612   44
1  208  414
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7939815, 'precision': 0.8449091, 'recall': 0.7939815, 'specificity': 0.7939815, 'f1': 0.7860851, 'auroc': 0.9074074, 'binary_precision': 0.97744364, 'binary_recall': 0.6018519, 'binary_specificity': 0.9861111, 'binary_f1_score': 0.7449857}
confusion matrix:
     0    1
0  213    3
1   86  130
early stop counter: 1
val acc:0.8028169274330139, best validation acc: 0.8262910842895508, corresponding to test acc:                         0.8194444179534912 / 0.8194444179534912
after epoch: 2,now: 2024-07-23 02:32:37.896989,epoch time: 0:01:35.991736,used: 0:03:20.174705,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9838816, 'precision': 0.9839306, 'recall': 0.98385453, 'specificity': 0.98385453, 'f1': 0.9838797, 'auroc': 0.99826556, 'binary_precision': 0.98054475, 'binary_recall': 0.98758984, 'binary_specificity': 0.9801193, 'binary_f1_score': 0.9840547}
confusion matrix:
      0     1
0  1479    30
1    19  1512
---- Validation: 
scalar performance:
{'acc': 0.79890454, 'precision': 0.79876953, 'recall': 0.79890794, 'specificity': 0.79890794, 'f1': 0.7988147, 'auroc': 0.87463236, 'binary_precision': 0.7901431, 'binary_recall': 0.7990354, 'binary_specificity': 0.7987805, 'binary_f1_score': 0.7945643}
confusion matrix:
     0    1
0  524  132
1  125  497
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8009259, 'precision': 0.8011583, 'recall': 0.8009259, 'specificity': 0.8009259, 'f1': 0.80088747, 'auroc': 0.86621225, 'binary_precision': 0.7927928, 'binary_recall': 0.8148148, 'binary_specificity': 0.787037, 'binary_f1_score': 0.80365294}
confusion matrix:
     0    1
0  170   46
1   40  176
early stop counter: 2
val acc:0.798904538154602, best validation acc: 0.8262910842895508, corresponding to test acc:                         0.8194444179534912 / 0.8194444179534912
after epoch: 3,now: 2024-07-23 02:34:14.652743,epoch time: 0:01:36.755754,used: 0:04:56.930459,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9707237, 'precision': 0.971276, 'recall': 0.97084576, 'specificity': 0.97084576, 'f1': 0.97071934, 'auroc': 0.9967377, 'binary_precision': 0.9891378, 'binary_recall': 0.95228755, 'binary_specificity': 0.98940396, 'binary_f1_score': 0.970363}
confusion matrix:
      0     1
0  1494    16
1    73  1457
---- Validation: 
scalar performance:
{'acc': 0.76447576, 'precision': 0.77145594, 'recall': 0.76649624, 'specificity': 0.76649624, 'f1': 0.7637466, 'auroc': 0.8739511, 'binary_precision': 0.7207703, 'binary_recall': 0.8424437, 'binary_specificity': 0.6905488, 'binary_f1_score': 0.77687174}
confusion matrix:
     0    1
0  453  203
1   98  524
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8171296, 'precision': 0.81746304, 'recall': 0.8171296, 'specificity': 0.8171296, 'f1': 0.8170816, 'auroc': 0.89240396, 'binary_precision': 0.80717486, 'binary_recall': 0.8333333, 'binary_specificity': 0.8009259, 'binary_f1_score': 0.82004553}
confusion matrix:
     0    1
0  173   43
1   36  180
early stop counter: 3
val acc:0.7644757628440857, best validation acc: 0.8262910842895508, corresponding to test acc:                         0.8194444179534912 / 0.8194444179534912
after epoch: 4,now: 2024-07-23 02:35:50.480194,epoch time: 0:01:35.827451,used: 0:06:32.757910,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9736842, 'precision': 0.97383296, 'recall': 0.9736254, 'specificity': 0.9736254, 'f1': 0.97367823, 'auroc': 0.99786687, 'binary_precision': 0.96718144, 'binary_recall': 0.9810705, 'binary_specificity': 0.9661804, 'binary_f1_score': 0.9740765}
confusion matrix:
      0     1
0  1457    51
1    29  1503
---- Validation: 
scalar performance:
{'acc': 0.81924886, 'precision': 0.8345618, 'recall': 0.8163502, 'specificity': 0.8163502, 'f1': 0.8161088, 'auroc': 0.8999907, 'binary_precision': 0.8997955, 'binary_recall': 0.7073955, 'binary_specificity': 0.9253049, 'binary_f1_score': 0.7920792}
confusion matrix:
     0    1
0  607   49
1  182  440
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.8310185, 'precision': 0.841025, 'recall': 0.83101857, 'specificity': 0.83101857, 'f1': 0.8297698, 'auroc': 0.8981267, 'binary_precision': 0.89944136, 'binary_recall': 0.7453704, 'binary_specificity': 0.9166667, 'binary_f1_score': 0.8151899}
confusion matrix:
     0    1
0  198   18
1   55  161
new oracle model saved
early stop counter: 4
val acc:0.8192488551139832, best validation acc: 0.8262910842895508, corresponding to test acc:                         0.8194444179534912 / 0.8310185074806213
after epoch: 5,now: 2024-07-23 02:37:26.319339,epoch time: 0:01:35.839145,used: 0:08:08.597055,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9753289, 'precision': 0.9762958, 'recall': 0.97553813, 'specificity': 0.97553813, 'f1': 0.97532254, 'auroc': 0.99887025, 'binary_precision': 1.0, 'binary_recall': 0.9510763, 'binary_specificity': 1.0, 'binary_f1_score': 0.9749248}
confusion matrix:
      0     1
0  1507     0
1    75  1458
---- Validation: 
scalar performance:
{'acc': 0.5172144, 'precision': 0.7576591, 'recall': 0.5040193, 'specificity': 0.5040193, 'f1': 0.34804705, 'auroc': 0.87517214, 'binary_precision': 1.0, 'binary_recall': 0.008038585, 'binary_specificity': 1.0, 'binary_f1_score': 0.015948962}
confusion matrix:
     0  1
0  656  0
1  617  5
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.8099333, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 5
val acc:0.5172144174575806, best validation acc: 0.8262910842895508, corresponding to test acc:                         0.8194444179534912 / 0.8310185074806213
after epoch: 6,now: 2024-07-23 02:39:03.246254,epoch time: 0:01:36.926915,used: 0:09:45.523970,model: dset_te_center0_erm_b888c1ef2_not_commited_2024md_07md_23_02_29_17_seed_2_22769262
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:09:45.523970 at 2024-07-23 02:39:03.246254
persisted model performance metric: 

scalar performance:
{'acc': 0.8194444, 'precision': 0.81947184, 'recall': 0.8194444, 'specificity': 0.8194444, 'f1': 0.8194406, 'auroc': 0.89343274, 'binary_precision': 0.8165138, 'binary_recall': 0.8240741, 'binary_specificity': 0.8148148, 'binary_f1_score': 0.8202765}
confusion matrix:
     0    1
0  176   40
1   38  178
oracle model performance metric: 

scalar performance:
{'acc': 0.8310185, 'precision': 0.841025, 'recall': 0.83101857, 'specificity': 0.83101857, 'f1': 0.8297698, 'auroc': 0.8981267, 'binary_precision': 0.89944136, 'binary_recall': 0.7453704, 'binary_specificity': 0.9166667, 'binary_f1_score': 0.8151899}
confusion matrix:
     0    1
0  198   18
1   55  161
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/rule_results/0.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_irm_dial_lr1e5_bs16_allfreeze_2024-07-22_23-46-53/confusion_matrix/0.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 452485 KiB |   3644 MiB |  48963 GiB |  48963 GiB |
|       from large pool | 411932 KiB |   3611 MiB |  48624 GiB |  48624 GiB |
|       from small pool |  40553 KiB |     60 MiB |    339 GiB |    339 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 452485 KiB |   3644 MiB |  48963 GiB |  48963 GiB |
|       from large pool | 411932 KiB |   3611 MiB |  48624 GiB |  48624 GiB |
|       from small pool |  40553 KiB |     60 MiB |    339 GiB |    339 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3642 MiB |  48950 GiB |  48950 GiB |
|       from large pool | 407075 KiB |   3608 MiB |  48612 GiB |  48611 GiB |
|       from small pool |  40406 KiB |     60 MiB |    338 GiB |    338 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4078 MiB |   4084 MiB |  10192 MiB |   6114 MiB |
|       from large pool |   4014 MiB |   4014 MiB |  10086 MiB |   6072 MiB |
|       from small pool |     64 MiB |     70 MiB |    106 MiB |     42 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 583802 KiB | 662353 KiB |  23954 GiB |  23953 GiB |
|       from large pool | 577252 KiB | 657915 KiB |  23599 GiB |  23598 GiB |
|       from small pool |   6550 KiB |  22312 KiB |    355 GiB |    355 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1220    |    1597    |    4779 K  |    4778 K  |
|       from large pool |     187    |     311    |    2311 K  |    2311 K  |
|       from small pool |    1033    |    1335    |    2467 K  |    2466 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1220    |    1597    |    4779 K  |    4778 K  |
|       from large pool |     187    |     311    |    2311 K  |    2311 K  |
|       from small pool |    1033    |    1335    |    2467 K  |    2466 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     156    |     156    |     341    |     185    |
|       from large pool |     124    |     124    |     288    |     164    |
|       from small pool |      32    |      35    |      53    |      21    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      73    |     160    |    2813 K  |    2812 K  |
|       from large pool |      36    |     124    |    1833 K  |    1833 K  |
|       from small pool |      37    |     125    |     979 K  |     979 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3644 MiB |  48963 GiB |  48963 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  48624 GiB |  48624 GiB |
|       from small pool |      0 KiB |     60 MiB |    339 GiB |    339 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3644 MiB |  48963 GiB |  48963 GiB |
|       from large pool |  16640 KiB |   3611 MiB |  48624 GiB |  48624 GiB |
|       from small pool |      0 KiB |     60 MiB |    339 GiB |    339 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3642 MiB |  48950 GiB |  48950 GiB |
|       from large pool |  16640 KiB |   3608 MiB |  48612 GiB |  48612 GiB |
|       from small pool |      0 KiB |     60 MiB |    338 GiB |    338 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   1012 MiB |   4084 MiB |  10192 MiB |   9180 MiB |
|       from large pool |    966 MiB |   4014 MiB |  10086 MiB |   9120 MiB |
|       from small pool |     46 MiB |     70 MiB |    106 MiB |     60 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |   3840 KiB | 662353 KiB |  23954 GiB |  23954 GiB |
|       from large pool |   3840 KiB | 657915 KiB |  23599 GiB |  23599 GiB |
|       from small pool |      0 KiB |  22315 KiB |    355 GiB |    355 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1597    |    4779 K  |    4779 K  |
|       from large pool |       2    |     311    |    2311 K  |    2311 K  |
|       from small pool |       0    |    1335    |    2467 K  |    2467 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1597    |    4779 K  |    4779 K  |
|       from large pool |       2    |     311    |    2311 K  |    2311 K  |
|       from small pool |       0    |    1335    |    2467 K  |    2467 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      62    |     156    |     341    |     279    |
|       from large pool |      39    |     124    |     288    |     249    |
|       from small pool |      23    |      35    |      53    |      30    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       1    |     160    |    2813 K  |    2813 K  |
|       from large pool |       1    |     124    |    1833 K  |    1833 K  |
|       from small pool |       0    |     125    |     979 K  |     979 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Tue Jul 23 02:39:58 2024]
Finished job 0.
1 of 1 steps (100%) done
