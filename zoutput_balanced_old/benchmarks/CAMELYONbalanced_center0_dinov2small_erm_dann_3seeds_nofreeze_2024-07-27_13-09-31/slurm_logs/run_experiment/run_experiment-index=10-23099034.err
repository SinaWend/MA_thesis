Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 13:10:32 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/10.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=10
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034

 Experiment start at: 2024-07-27 13:11:27.150148
before training, model accuracy: 0.49534884095191956
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:13:43.530998,epoch time: 0:02:16.380850,used: 0:02:16.380850,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 1
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 2,now: 2024-07-27 13:15:43.247636,epoch time: 0:01:59.716638,used: 0:04:16.097488,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 2
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 13:17:43.574646,epoch time: 0:02:00.327010,used: 0:06:16.424498,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.50716144, 'precision': 0.25358072, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3365011, 'auroc': 0.5, 'binary_precision': 0.50716144, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6730022}
confusion matrix:
   0     1
0  0  1514
1  0  1558
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 3
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 13:19:44.771363,epoch time: 0:02:01.196717,used: 0:08:17.621215,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 4
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 13:21:46.549278,epoch time: 0:02:01.777915,used: 0:10:19.399130,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 5
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 13:23:47.739053,epoch time: 0:02:01.189775,used: 0:12:20.588905,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_26_seed_0_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:12:20.588905 at 2024-07-27 13:23:47.739053
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/10.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/10.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/10.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 455608 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool | 415006 KiB |   3568 MiB |  21427 GiB |  21426 GiB |
|       from small pool |  40602 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 455608 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool | 415006 KiB |   3568 MiB |  21427 GiB |  21426 GiB |
|       from small pool |  40602 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  21335 GiB |  21334 GiB |
|       from small pool |  40406 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4016 MiB |   4016 MiB |   4016 MiB |      0 B   |
|       from large pool |   3952 MiB |   3952 MiB |   3952 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 349255 KiB | 496525 KiB |  15171 GiB |  15171 GiB |
|       from large pool | 342754 KiB | 492852 KiB |  14918 GiB |  14918 GiB |
|       from small pool |   6501 KiB |  14115 KiB |    252 GiB |    252 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1697    |    3794 K  |    3793 K  |
|       from large pool |     187    |     468    |    1976 K  |    1975 K  |
|       from small pool |    1131    |    1435    |    1818 K  |    1817 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1697    |    3794 K  |    3793 K  |
|       from large pool |     187    |     468    |    1976 K  |    1975 K  |
|       from small pool |    1131    |    1435    |    1818 K  |    1817 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     198    |     198    |       0    |
|       from large pool |     166    |     166    |     166    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      82    |     249    |    2194 K  |    2194 K  |
|       from large pool |      31    |     165    |    1332 K  |    1332 K  |
|       from small pool |      51    |     218    |     861 K  |     861 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  21335 GiB |  21335 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3952 MiB |   3952 MiB |   3212 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  15172 GiB |  15172 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  14919 GiB |  14919 GiB |
|       from small pool |      0 KiB |  22317 KiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     198    |     198    |     141    |
|       from large pool |      34    |     166    |     166    |     132    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     249    |    2194 K  |    2194 K  |
|       from large pool |       3    |     165    |    1332 K  |    1332 K  |
|       from small pool |       0    |     218    |     861 K  |     861 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  21335 GiB |  21335 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3952 MiB |   3952 MiB |   3212 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  15172 GiB |  15172 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  14919 GiB |  14919 GiB |
|       from small pool |      0 KiB |  22317 KiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     198    |     198    |     141    |
|       from large pool |      34    |     166    |     166    |     132    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     249    |    2194 K  |    2194 K  |
|       from large pool |       3    |     165    |    1332 K  |    1332 K  |
|       from small pool |       0    |     218    |     861 K  |     861 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034

 Experiment start at: 2024-07-27 13:24:18.337182
before training, model accuracy: 0.5911111235618591
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.50716144, 'precision': 0.25358072, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3365011, 'auroc': 0.5, 'binary_precision': 0.50716144, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6730022}
confusion matrix:
   0     1
0  0  1514
1  0  1558
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:26:23.645437,epoch time: 0:02:05.308255,used: 0:02:05.308255,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 1
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 2,now: 2024-07-27 13:28:24.398969,epoch time: 0:02:00.753532,used: 0:04:06.061787,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 2
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 13:30:25.295414,epoch time: 0:02:00.896445,used: 0:06:06.958232,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 3
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 13:32:26.325968,epoch time: 0:02:01.030554,used: 0:08:07.988786,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.5058594, 'precision': 0.2529297, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33592737, 'auroc': 0.5, 'binary_precision': 0.5058594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67185473}
confusion matrix:
   0     1
0  0  1518
1  0  1554
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 4
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 13:34:27.612520,epoch time: 0:02:01.286552,used: 0:10:09.275338,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 5
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 13:36:28.581998,epoch time: 0:02:00.969478,used: 0:12:10.244816,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_18_seed_1_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:12:10.244816 at 2024-07-27 13:36:28.581998
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/10.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/10.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454480 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool | 413871 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |  40608 KiB |     60 MiB |    498 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454480 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool | 413871 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |  40608 KiB |     60 MiB |    498 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447482 KiB |   3596 MiB |  43186 GiB |  43185 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  42689 GiB |  42688 GiB |
|       from small pool |  40407 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4008 MiB |   4016 MiB |   7238 MiB |   3230 MiB |
|       from large pool |   3940 MiB |   3952 MiB |   7152 MiB |   3212 MiB |
|       from small pool |     68 MiB |     68 MiB |     86 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 350384 KiB | 496525 KiB |  30281 GiB |  30280 GiB |
|       from large pool | 341840 KiB | 492852 KiB |  29772 GiB |  29771 GiB |
|       from small pool |   8543 KiB |  22317 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1330    |    1709    |    7600 K  |    7598 K  |
|       from large pool |     187    |     468    |    3953 K  |    3953 K  |
|       from small pool |    1143    |    1447    |    3646 K  |    3645 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1330    |    1709    |    7600 K  |    7598 K  |
|       from large pool |     187    |     468    |    3953 K  |    3953 K  |
|       from small pool |    1143    |    1447    |    3646 K  |    3645 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     200    |     341    |     141    |
|       from large pool |     166    |     166    |     298    |     132    |
|       from small pool |      34    |      34    |      43    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      87    |     253    |    4313 K  |    4313 K  |
|       from large pool |      34    |     165    |    2580 K  |    2580 K  |
|       from small pool |      53    |     219    |    1732 K  |    1732 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  43186 GiB |  43186 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  42689 GiB |  42689 GiB |
|       from small pool |      0 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   7238 MiB |   6452 MiB |
|       from large pool |    738 MiB |   3952 MiB |   7152 MiB |   6414 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  30281 GiB |  30281 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  29772 GiB |  29772 GiB |
|       from small pool |      0 KiB |  32850 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     341    |     284    |
|       from large pool |      33    |     166    |     298    |     265    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    4313 K  |    4313 K  |
|       from large pool |       3    |     165    |    2580 K  |    2580 K  |
|       from small pool |       0    |     219    |    1733 K  |    1733 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  43186 GiB |  43186 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  42689 GiB |  42689 GiB |
|       from small pool |      0 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   7238 MiB |   6452 MiB |
|       from large pool |    738 MiB |   3952 MiB |   7152 MiB |   6414 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  30281 GiB |  30281 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  29772 GiB |  29772 GiB |
|       from small pool |      0 KiB |  32850 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     341    |     284    |
|       from large pool |      33    |     166    |     298    |     265    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    4313 K  |    4313 K  |
|       from large pool |       3    |     165    |    2580 K  |    2580 K  |
|       from small pool |       0    |     219    |    1733 K  |    1733 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034

 Experiment start at: 2024-07-27 13:36:59.248941
before training, model accuracy: 0.5254629850387573
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.7568717, 'precision': 0.8192769, 'recall': 0.75512713, 'specificity': 0.75512713, 'f1': 0.7435305, 'auroc': 0.9613322, 'binary_precision': 0.6800723, 'binary_recall': 0.97727275, 'binary_specificity': 0.5329815, 'binary_f1_score': 0.802025}
confusion matrix:
     0     1
0  808   708
1   35  1505
---- Validation: 
scalar performance:
{'acc': 0.4913928, 'precision': 0.7444968, 'recall': 0.50457317, 'specificity': 0.50457317, 'f1': 0.33746895, 'auroc': 0.8546829, 'binary_precision': 0.4889937, 'binary_recall': 1.0, 'binary_specificity': 0.009146341, 'binary_f1_score': 0.656811}
confusion matrix:
   0    1
0  6  650
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5023148, 'precision': 0.7505801, 'recall': 0.5023148, 'specificity': 0.5023148, 'f1': 0.3384568, 'auroc': 0.88091564, 'binary_precision': 0.5011601, 'binary_recall': 1.0, 'binary_specificity': 0.0046296297, 'binary_f1_score': 0.667697}
confusion matrix:
   0    1
0  1  215
1  0  216
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:39:02.979307,epoch time: 0:02:03.730366,used: 0:02:03.730366,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.8802356, 'precision': 0.89853716, 'recall': 0.88108146, 'specificity': 0.88108146, 'f1': 0.8790066, 'auroc': 0.8855053, 'binary_precision': 0.98592716, 'binary_recall': 0.77337664, 'binary_specificity': 0.9887863, 'binary_f1_score': 0.8668122}
confusion matrix:
      0     1
0  1499    17
1   349  1191
---- Validation: 
scalar performance:
{'acc': 0.7245696, 'precision': 0.7399431, 'recall': 0.7277493, 'specificity': 0.7277493, 'f1': 0.72177875, 'auroc': 0.761912, 'binary_precision': 0.6721939, 'binary_recall': 0.84726685, 'binary_specificity': 0.6082317, 'binary_f1_score': 0.74964446}
confusion matrix:
     0    1
0  399  257
1   95  527
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7615741, 'precision': 0.76637566, 'recall': 0.76157403, 'specificity': 0.76157403, 'f1': 0.76049477, 'auroc': 0.8140003, 'binary_precision': 0.7306122, 'binary_recall': 0.8287037, 'binary_specificity': 0.6944444, 'binary_f1_score': 0.77657264}
confusion matrix:
     0    1
0  150   66
1   37  179
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 13:41:03.373548,epoch time: 0:02:00.394241,used: 0:04:04.124607,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.8969241, 'precision': 0.9047359, 'recall': 0.8974754, 'specificity': 0.8974754, 'f1': 0.8965113, 'auroc': 0.9105258, 'binary_precision': 0.962963, 'binary_recall': 0.8272727, 'binary_specificity': 0.9676781, 'binary_f1_score': 0.88997555}
confusion matrix:
      0     1
0  1467    49
1   266  1274
---- Validation: 
scalar performance:
{'acc': 0.5015649, 'precision': 0.7232072, 'recall': 0.51444006, 'specificity': 0.51444006, 'f1': 0.36003706, 'auroc': 0.6806623, 'binary_precision': 0.49403343, 'binary_recall': 0.9983923, 'binary_specificity': 0.030487806, 'binary_f1_score': 0.66098994}
confusion matrix:
    0    1
0  20  636
1   1  621
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5462963, 'precision': 0.7205882, 'recall': 0.5462963, 'specificity': 0.5462963, 'f1': 0.4346154, 'auroc': 0.76564646, 'binary_precision': 0.5245098, 'binary_recall': 0.9907407, 'binary_specificity': 0.10185185, 'binary_f1_score': 0.68589747}
confusion matrix:
    0    1
0  22  194
1   2  214
early stop counter: 1
val acc:0.5015649199485779, best validation acc: 0.7245696187019348, corresponding to test acc:                         0.7615740895271301 / 0.7615740895271301
after epoch: 3,now: 2024-07-27 13:43:03.175842,epoch time: 0:01:59.802294,used: 0:06:03.926901,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9070681, 'precision': 0.9211111, 'recall': 0.9077922, 'specificity': 0.9077922, 'f1': 0.9063905, 'auroc': 0.9077922, 'binary_precision': 1.0, 'binary_recall': 0.8155844, 'binary_specificity': 1.0, 'binary_f1_score': 0.89842635}
confusion matrix:
      0     1
0  1516     0
1   284  1256
---- Validation: 
scalar performance:
{'acc': 0.5031299, 'precision': 0.2874901, 'recall': 0.49013314, 'specificity': 0.49013314, 'f1': 0.33611912, 'auroc': 0.49012822, 'binary_precision': 0.06666667, 'binary_recall': 0.001607717, 'binary_specificity': 0.97865856, 'binary_f1_score': 0.0031397175}
confusion matrix:
     0   1
0  642  14
1  621   1
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.49537036, 'precision': 0.2488372, 'recall': 0.49537036, 'specificity': 0.49537036, 'f1': 0.33126935, 'auroc': 0.49537036, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9907407, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  214  2
1  216  0
early stop counter: 2
val acc:0.5031298995018005, best validation acc: 0.7245696187019348, corresponding to test acc:                         0.7615740895271301 / 0.7615740895271301
after epoch: 4,now: 2024-07-27 13:45:03.270986,epoch time: 0:02:00.095144,used: 0:08:04.022045,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.8893979, 'precision': 0.9032643, 'recall': 0.89013124, 'specificity': 0.89013124, 'f1': 0.88856626, 'auroc': 0.8965254, 'binary_precision': 0.98003197, 'binary_recall': 0.7967532, 'binary_specificity': 0.98350924, 'binary_f1_score': 0.8789398}
confusion matrix:
      0     1
0  1491    25
1   313  1227
---- Validation: 
scalar performance:
{'acc': 0.6768388, 'precision': 0.67665136, 'recall': 0.67671406, 'specificity': 0.67671406, 'f1': 0.67667234, 'auroc': 0.65037423, 'binary_precision': 0.6666667, 'binary_recall': 0.67202574, 'binary_specificity': 0.68140244, 'binary_f1_score': 0.6693355}
confusion matrix:
     0    1
0  447  209
1  204  418
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7268519, 'precision': 0.72968745, 'recall': 0.7268518, 'specificity': 0.7268518, 'f1': 0.7260062, 'auroc': 0.70756173, 'binary_precision': 0.7552083, 'binary_recall': 0.6712963, 'binary_specificity': 0.7824074, 'binary_f1_score': 0.7107843}
confusion matrix:
     0    1
0  169   47
1   71  145
early stop counter: 3
val acc:0.6768388152122498, best validation acc: 0.7245696187019348, corresponding to test acc:                         0.7615740895271301 / 0.7615740895271301
after epoch: 5,now: 2024-07-27 13:47:03.199233,epoch time: 0:01:59.928247,used: 0:10:03.950292,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.8841623, 'precision': 0.8890657, 'recall': 0.8846075, 'specificity': 0.8846075, 'f1': 0.883875, 'auroc': 0.90840924, 'binary_precision': 0.93475074, 'binary_recall': 0.8279221, 'binary_specificity': 0.9412929, 'binary_f1_score': 0.87809914}
confusion matrix:
      0     1
0  1427    89
1   265  1275
---- Validation: 
scalar performance:
{'acc': 0.7245696, 'precision': 0.7396487, 'recall': 0.72099984, 'specificity': 0.72099984, 'f1': 0.7179352, 'auroc': 0.74438274, 'binary_precision': 0.79347825, 'binary_recall': 0.5868167, 'binary_specificity': 0.85518295, 'binary_f1_score': 0.6746765}
confusion matrix:
     0    1
0  561   95
1  257  365
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6574074, 'precision': 0.74260044, 'recall': 0.6574074, 'specificity': 0.6574074, 'f1': 0.6244361, 'auroc': 0.71780694, 'binary_precision': 0.8863636, 'binary_recall': 0.3611111, 'binary_specificity': 0.9537037, 'binary_f1_score': 0.5131579}
confusion matrix:
     0   1
0  206  10
1  138  78
early stop counter: 4
val acc:0.7245696187019348, best validation acc: 0.7245696187019348, corresponding to test acc:                         0.7615740895271301 / 0.7615740895271301
after epoch: 6,now: 2024-07-27 13:49:03.571570,epoch time: 0:02:00.372337,used: 0:12:04.322629,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.8448953, 'precision': 0.88090456, 'recall': 0.8461039, 'specificity': 0.8461039, 'f1': 0.8414576, 'auroc': 0.8464286, 'binary_precision': 1.0, 'binary_recall': 0.6922078, 'binary_specificity': 1.0, 'binary_f1_score': 0.8181121}
confusion matrix:
      0     1
0  1516     0
1   474  1066
---- Validation: 
scalar performance:
{'acc': 0.5023474, 'precision': 0.32897455, 'recall': 0.48945427, 'specificity': 0.48945427, 'f1': 0.3385287, 'auroc': 0.48788947, 'binary_precision': 0.15, 'binary_recall': 0.004823151, 'binary_specificity': 0.9740854, 'binary_f1_score': 0.009345794}
confusion matrix:
     0   1
0  639  17
1  619   3
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.49537036, 'precision': 0.2488372, 'recall': 0.49537036, 'specificity': 0.49537036, 'f1': 0.33126935, 'auroc': 0.49537036, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9907407, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  214  2
1  216  0
early stop counter: 5
val acc:0.5023474097251892, best validation acc: 0.7245696187019348, corresponding to test acc:                         0.7615740895271301 / 0.7615740895271301
after epoch: 7,now: 2024-07-27 13:51:03.783161,epoch time: 0:02:00.211591,used: 0:14:04.534220,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_59_seed_2_23099034
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 7 with time: 0:14:04.534220 at 2024-07-27 13:51:03.783161
persisted model performance metric: 

scalar performance:
{'acc': 0.7615741, 'precision': 0.76637566, 'recall': 0.76157403, 'specificity': 0.76157403, 'f1': 0.76049477, 'auroc': 0.8140003, 'binary_precision': 0.7306122, 'binary_recall': 0.8287037, 'binary_specificity': 0.6944444, 'binary_f1_score': 0.77657264}
confusion matrix:
     0    1
0  150   66
1   37  179
oracle model performance metric: 

scalar performance:
{'acc': 0.7615741, 'precision': 0.76637566, 'recall': 0.76157403, 'specificity': 0.76157403, 'f1': 0.76049477, 'auroc': 0.8140003, 'binary_precision': 0.7306122, 'binary_recall': 0.8287037, 'binary_specificity': 0.6944444, 'binary_f1_score': 0.77657264}
confusion matrix:
     0    1
0  150   66
1   37  179
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/10.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/10.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454625 KiB |   3602 MiB |  68418 GiB |  68418 GiB |
|       from large pool | 414023 KiB |   3569 MiB |  67634 GiB |  67633 GiB |
|       from small pool |  40602 KiB |     60 MiB |    784 GiB |    784 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454625 KiB |   3602 MiB |  68418 GiB |  68418 GiB |
|       from large pool | 414023 KiB |   3569 MiB |  67634 GiB |  67633 GiB |
|       from small pool |  40602 KiB |     60 MiB |    784 GiB |    784 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  68204 GiB |  68203 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  67420 GiB |  67420 GiB |
|       from small pool |  40406 KiB |     60 MiB |    783 GiB |    783 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4002 MiB |   4016 MiB |  10454 MiB |   6452 MiB |
|       from large pool |   3938 MiB |   3952 MiB |  10352 MiB |   6414 MiB |
|       from small pool |     64 MiB |     68 MiB |    102 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 391198 KiB | 496525 KiB |  48114 GiB |  48114 GiB |
|       from large pool | 382649 KiB | 492852 KiB |  47312 GiB |  47311 GiB |
|       from small pool |   8549 KiB |  32850 KiB |    802 GiB |    802 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1709    |   11995 K  |   11994 K  |
|       from large pool |     187    |     468    |    6243 K  |    6243 K  |
|       from small pool |    1131    |    1447    |    5752 K  |    5750 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1709    |   11995 K  |   11994 K  |
|       from large pool |     187    |     468    |    6243 K  |    6243 K  |
|       from small pool |    1131    |    1447    |    5752 K  |    5750 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     197    |     200    |     481    |     284    |
|       from large pool |     165    |     166    |     430    |     265    |
|       from small pool |      32    |      34    |      51    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      83    |     253    |    6739 K  |    6739 K  |
|       from large pool |      34    |     165    |    4006 K  |    4006 K  |
|       from small pool |      49    |     219    |    2732 K  |    2732 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  68418 GiB |  68418 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  67634 GiB |  67634 GiB |
|       from small pool |      0 KiB |     60 MiB |    784 GiB |    784 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  68418 GiB |  68418 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  67634 GiB |  67634 GiB |
|       from small pool |      0 KiB |     60 MiB |    784 GiB |    784 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  68204 GiB |  68204 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  67420 GiB |  67420 GiB |
|       from small pool |      0 KiB |     60 MiB |    783 GiB |    783 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    826 MiB |   4016 MiB |  10454 MiB |   9628 MiB |
|       from large pool |    778 MiB |   3952 MiB |  10352 MiB |   9574 MiB |
|       from small pool |     48 MiB |     68 MiB |    102 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  48114 GiB |  48114 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  47312 GiB |  47312 GiB |
|       from small pool |      0 KiB |  32856 KiB |    802 GiB |    802 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |   11995 K  |   11995 K  |
|       from large pool |       2    |     468    |    6243 K  |    6243 K  |
|       from small pool |       0    |    1447    |    5752 K  |    5752 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |   11995 K  |   11995 K  |
|       from large pool |       2    |     468    |    6243 K  |    6243 K  |
|       from small pool |       0    |    1447    |    5752 K  |    5752 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      59    |     200    |     481    |     422    |
|       from large pool |      35    |     166    |     430    |     395    |
|       from small pool |      24    |      34    |      51    |      27    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    6739 K  |    6739 K  |
|       from large pool |       3    |     165    |    4006 K  |    4006 K  |
|       from small pool |       0    |     219    |    2733 K  |    2733 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 13:51:11 2024]
Finished job 0.
1 of 1 steps (100%) done
