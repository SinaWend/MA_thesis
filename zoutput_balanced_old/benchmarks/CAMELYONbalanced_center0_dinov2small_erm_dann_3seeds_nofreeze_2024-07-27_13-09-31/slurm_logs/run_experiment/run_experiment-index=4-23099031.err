Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 13:10:29 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/4.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=4
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031

 Experiment start at: 2024-07-27 13:11:27.186682
before training, model accuracy: 0.49534884095191956
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9475911, 'precision': 0.94805604, 'recall': 0.9478207, 'specificity': 0.9478207, 'f1': 0.9475887, 'auroc': 0.9721003, 'binary_precision': 0.96590906, 'binary_recall': 0.92926043, 'binary_specificity': 0.966381, 'binary_f1_score': 0.9472304}
confusion matrix:
      0     1
0  1466    51
1   110  1445
---- Validation: 
scalar performance:
{'acc': 0.73136646, 'precision': 0.77850914, 'recall': 0.7342007, 'specificity': 0.7342007, 'f1': 0.7210237, 'auroc': 0.7391578, 'binary_precision': 0.6603774, 'binary_recall': 0.93700784, 'binary_specificity': 0.5313936, 'binary_f1_score': 0.77473956}
confusion matrix:
     0    1
0  347  306
1   40  595
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7651163, 'precision': 0.8041245, 'recall': 0.7651163, 'specificity': 0.7651163, 'f1': 0.75733507, 'auroc': 0.7697242, 'binary_precision': 0.69520545, 'binary_recall': 0.94418603, 'binary_specificity': 0.5860465, 'binary_f1_score': 0.800789}
confusion matrix:
     0    1
0  126   89
1   12  203
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:13:43.017668,epoch time: 0:02:15.830986,used: 0:02:15.830986,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.76171875, 'precision': 0.8350961, 'recall': 0.7647476, 'specificity': 0.7647476, 'f1': 0.7492896, 'auroc': 0.85681033, 'binary_precision': 0.9951923, 'binary_recall': 0.5321337, 'binary_specificity': 0.9973615, 'binary_f1_score': 0.6934673}
confusion matrix:
      0    1
0  1512    4
1   728  828
---- Validation: 
scalar performance:
{'acc': 0.5069876, 'precision': 0.2534938, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33642453, 'auroc': 0.69445324, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  653  0
1  635  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.69711196, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  215  0
1  215  0
early stop counter: 1
val acc:0.5069875717163086, best validation acc: 0.7313664555549622, corresponding to test acc:                         0.765116274356842 / 0.765116274356842
after epoch: 2,now: 2024-07-27 13:15:41.832369,epoch time: 0:01:58.814701,used: 0:04:14.645687,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.507487, 'precision': 0.2537435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33664435, 'auroc': 0.5, 'binary_precision': 0.507487, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6732887}
confusion matrix:
   0     1
0  0  1513
1  0  1559
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 2
val acc:0.4930124282836914, best validation acc: 0.7313664555549622, corresponding to test acc:                         0.765116274356842 / 0.765116274356842
after epoch: 3,now: 2024-07-27 13:17:41.023379,epoch time: 0:01:59.191010,used: 0:06:13.836697,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.50716144, 'precision': 0.25358072, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3365011, 'auroc': 0.5, 'binary_precision': 0.50716144, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6730022}
confusion matrix:
   0     1
0  0  1514
1  0  1558
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 3
val acc:0.4930124282836914, best validation acc: 0.7313664555549622, corresponding to test acc:                         0.765116274356842 / 0.765116274356842
after epoch: 4,now: 2024-07-27 13:19:40.064723,epoch time: 0:01:59.041344,used: 0:08:12.878041,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.50683594, 'precision': 0.25341797, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33635774, 'auroc': 0.5, 'binary_precision': 0.50683594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6727155}
confusion matrix:
   0     1
0  0  1515
1  0  1557
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 4
val acc:0.4930124282836914, best validation acc: 0.7313664555549622, corresponding to test acc:                         0.765116274356842 / 0.765116274356842
after epoch: 5,now: 2024-07-27 13:21:38.929940,epoch time: 0:01:58.865217,used: 0:10:11.743258,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 5
val acc:0.4930124282836914, best validation acc: 0.7313664555549622, corresponding to test acc:                         0.765116274356842 / 0.765116274356842
after epoch: 6,now: 2024-07-27 13:23:37.936971,epoch time: 0:01:59.007031,used: 0:12:10.750289,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:12:10.750289 at 2024-07-27 13:23:37.936971
persisted model performance metric: 

scalar performance:
{'acc': 0.7651163, 'precision': 0.8041245, 'recall': 0.7651163, 'specificity': 0.7651163, 'f1': 0.75733507, 'auroc': 0.7697242, 'binary_precision': 0.69520545, 'binary_recall': 0.94418603, 'binary_specificity': 0.5860465, 'binary_f1_score': 0.800789}
confusion matrix:
     0    1
0  126   89
1   12  203
oracle model performance metric: 

scalar performance:
{'acc': 0.7651163, 'precision': 0.8041245, 'recall': 0.7651163, 'specificity': 0.7651163, 'f1': 0.75733507, 'auroc': 0.7697242, 'binary_precision': 0.69520545, 'binary_recall': 0.94418603, 'binary_specificity': 0.5860465, 'binary_f1_score': 0.800789}
confusion matrix:
     0    1
0  126   89
1   12  203
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/4.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/4.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/4.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 455608 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool | 415006 KiB |   3568 MiB |  21427 GiB |  21426 GiB |
|       from small pool |  40602 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 455608 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool | 415006 KiB |   3568 MiB |  21427 GiB |  21426 GiB |
|       from small pool |  40602 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  21335 GiB |  21334 GiB |
|       from small pool |  40406 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4016 MiB |   4016 MiB |   4016 MiB |      0 B   |
|       from large pool |   3952 MiB |   3952 MiB |   3952 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 349255 KiB | 496525 KiB |  15171 GiB |  15171 GiB |
|       from large pool | 342754 KiB | 492852 KiB |  14918 GiB |  14918 GiB |
|       from small pool |   6501 KiB |  14115 KiB |    252 GiB |    252 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1697    |    3794 K  |    3793 K  |
|       from large pool |     187    |     468    |    1976 K  |    1975 K  |
|       from small pool |    1131    |    1435    |    1818 K  |    1817 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1697    |    3794 K  |    3793 K  |
|       from large pool |     187    |     468    |    1976 K  |    1975 K  |
|       from small pool |    1131    |    1435    |    1818 K  |    1817 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     198    |     198    |       0    |
|       from large pool |     166    |     166    |     166    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      79    |     251    |    2210 K  |    2210 K  |
|       from large pool |      31    |     165    |    1332 K  |    1332 K  |
|       from small pool |      48    |     220    |     877 K  |     877 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  21335 GiB |  21335 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3952 MiB |   3952 MiB |   3212 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  15172 GiB |  15172 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  14919 GiB |  14919 GiB |
|       from small pool |      0 KiB |  24365 KiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     198    |     198    |     141    |
|       from large pool |      34    |     166    |     166    |     132    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     251    |    2210 K  |    2210 K  |
|       from large pool |       3    |     165    |    1332 K  |    1332 K  |
|       from small pool |       0    |     220    |     877 K  |     877 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  21335 GiB |  21335 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3952 MiB |   3952 MiB |   3212 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  15172 GiB |  15172 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  14919 GiB |  14919 GiB |
|       from small pool |      0 KiB |  24365 KiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     198    |     198    |     141    |
|       from large pool |      34    |     166    |     166    |     132    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     251    |    2210 K  |    2210 K  |
|       from large pool |       3    |     165    |    1332 K  |    1332 K  |
|       from small pool |       0    |     220    |     877 K  |     877 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031

 Experiment start at: 2024-07-27 13:24:07.913865
before training, model accuracy: 0.5911111235618591
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.5058594, 'precision': 0.2529297, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33592737, 'auroc': 0.5, 'binary_precision': 0.5058594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67185473}
confusion matrix:
   0     1
0  0  1518
1  0  1554
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:26:10.598536,epoch time: 0:02:02.684671,used: 0:02:02.684671,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 1
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 2,now: 2024-07-27 13:28:09.268220,epoch time: 0:01:58.669684,used: 0:04:01.354355,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 2
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 13:30:08.401207,epoch time: 0:01:59.132987,used: 0:06:00.487342,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 3
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 13:32:07.470526,epoch time: 0:01:59.069319,used: 0:07:59.556661,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 4
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 13:34:06.738868,epoch time: 0:01:59.268342,used: 0:09:58.825003,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 5
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 13:36:05.876692,epoch time: 0:01:59.137824,used: 0:11:57.962827,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_07_seed_1_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:11:57.962827 at 2024-07-27 13:36:05.876692
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/4.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/4.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454480 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool | 413871 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |  40608 KiB |     60 MiB |    498 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454480 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool | 413871 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |  40608 KiB |     60 MiB |    498 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447482 KiB |   3596 MiB |  43186 GiB |  43185 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  42689 GiB |  42688 GiB |
|       from small pool |  40407 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4008 MiB |   4016 MiB |   7238 MiB |   3230 MiB |
|       from large pool |   3940 MiB |   3952 MiB |   7152 MiB |   3212 MiB |
|       from small pool |     68 MiB |     68 MiB |     86 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 350384 KiB | 496525 KiB |  30281 GiB |  30280 GiB |
|       from large pool | 341840 KiB | 492852 KiB |  29772 GiB |  29771 GiB |
|       from small pool |   8543 KiB |  24365 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1330    |    1709    |    7600 K  |    7598 K  |
|       from large pool |     187    |     468    |    3953 K  |    3953 K  |
|       from small pool |    1143    |    1447    |    3646 K  |    3645 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1330    |    1709    |    7600 K  |    7598 K  |
|       from large pool |     187    |     468    |    3953 K  |    3953 K  |
|       from small pool |    1143    |    1447    |    3646 K  |    3645 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     200    |     341    |     141    |
|       from large pool |     166    |     166    |     298    |     132    |
|       from small pool |      34    |      34    |      43    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      87    |     253    |    4329 K  |    4329 K  |
|       from large pool |      34    |     165    |    2580 K  |    2580 K  |
|       from small pool |      53    |     220    |    1748 K  |    1748 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  43186 GiB |  43186 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  42689 GiB |  42689 GiB |
|       from small pool |      0 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   7238 MiB |   6452 MiB |
|       from large pool |    738 MiB |   3952 MiB |   7152 MiB |   6414 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  30281 GiB |  30281 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  29772 GiB |  29772 GiB |
|       from small pool |      0 KiB |  32850 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     341    |     284    |
|       from large pool |      33    |     166    |     298    |     265    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    4329 K  |    4329 K  |
|       from large pool |       3    |     165    |    2580 K  |    2580 K  |
|       from small pool |       0    |     220    |    1748 K  |    1748 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  43186 GiB |  43186 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  42689 GiB |  42689 GiB |
|       from small pool |      0 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   7238 MiB |   6452 MiB |
|       from large pool |    738 MiB |   3952 MiB |   7152 MiB |   6414 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  30281 GiB |  30281 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  29772 GiB |  29772 GiB |
|       from small pool |      0 KiB |  32850 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     341    |     284    |
|       from large pool |      33    |     166    |     298    |     265    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    4329 K  |    4329 K  |
|       from large pool |       3    |     165    |    2580 K  |    2580 K  |
|       from small pool |       0    |     220    |    1748 K  |    1748 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031

 Experiment start at: 2024-07-27 13:36:34.999098
before training, model accuracy: 0.5254629850387573
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.8861257, 'precision': 0.89568186, 'recall': 0.88674057, 'specificity': 0.88674057, 'f1': 0.8855432, 'auroc': 0.8994665, 'binary_precision': 0.95916796, 'binary_recall': 0.8084416, 'binary_specificity': 0.96503955, 'binary_f1_score': 0.87737846}
confusion matrix:
      0     1
0  1463    53
1   295  1245
---- Validation: 
scalar performance:
{'acc': 0.6737089, 'precision': 0.6735432, 'recall': 0.6736237, 'specificity': 0.6736237, 'f1': 0.67356324, 'auroc': 0.66829073, 'binary_precision': 0.6629571, 'binary_recall': 0.670418, 'binary_specificity': 0.6768293, 'binary_f1_score': 0.6666667}
confusion matrix:
     0    1
0  444  212
1  205  417
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6828704, 'precision': 0.69195896, 'recall': 0.6828704, 'specificity': 0.6828704, 'f1': 0.67907166, 'auroc': 0.68242025, 'binary_precision': 0.7337278, 'binary_recall': 0.5740741, 'binary_specificity': 0.7916667, 'binary_f1_score': 0.64415586}
confusion matrix:
     0    1
0  171   45
1   92  124
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:38:36.142176,epoch time: 0:02:01.143078,used: 0:02:01.143078,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.8838351, 'precision': 0.8934202, 'recall': 0.8844524, 'specificity': 0.8844524, 'f1': 0.88323545, 'auroc': 0.8980284, 'binary_precision': 0.95682347, 'binary_recall': 0.8058441, 'binary_specificity': 0.9630607, 'binary_f1_score': 0.8748678}
confusion matrix:
      0     1
0  1460    56
1   299  1241
---- Validation: 
scalar performance:
{'acc': 0.58137715, 'precision': 0.6986064, 'recall': 0.5912257, 'specificity': 0.5912257, 'f1': 0.5212226, 'auroc': 0.7691419, 'binary_precision': 0.5392245, 'binary_recall': 0.9614148, 'binary_specificity': 0.22103658, 'binary_f1_score': 0.69093007}
confusion matrix:
     0    1
0  145  511
1   24  598
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5833333, 'precision': 0.6846505, 'recall': 0.5833333, 'specificity': 0.5833333, 'f1': 0.5170907, 'auroc': 0.7771883, 'binary_precision': 0.54787236, 'binary_recall': 0.9537037, 'binary_specificity': 0.21296297, 'binary_f1_score': 0.695946}
confusion matrix:
    0    1
0  46  170
1  10  206
early stop counter: 1
val acc:0.5813771486282349, best validation acc: 0.6737089157104492, corresponding to test acc:                         0.6828703880310059 / 0.6828703880310059
after epoch: 2,now: 2024-07-27 13:40:34.105830,epoch time: 0:01:57.963654,used: 0:03:59.106732,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.83311516, 'precision': 0.8414731, 'recall': 0.8324984, 'specificity': 0.8324984, 'f1': 0.83189845, 'auroc': 0.93596077, 'binary_precision': 0.7899775, 'binary_recall': 0.91103894, 'binary_specificity': 0.7539578, 'binary_f1_score': 0.8462003}
confusion matrix:
      0     1
0  1143   373
1   137  1403
---- Validation: 
scalar performance:
{'acc': 0.56964004, 'precision': 0.74009347, 'recall': 0.5805427, 'specificity': 0.5805427, 'f1': 0.49038184, 'auroc': 0.76675844, 'binary_precision': 0.53103447, 'binary_recall': 0.9903537, 'binary_specificity': 0.17073171, 'binary_f1_score': 0.691358}
confusion matrix:
     0    1
0  112  544
1    6  616
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5162037, 'precision': 0.6985816, 'recall': 0.5162037, 'specificity': 0.5162037, 'f1': 0.37201875, 'auroc': 0.801301, 'binary_precision': 0.50827426, 'binary_recall': 0.9953704, 'binary_specificity': 0.037037037, 'binary_f1_score': 0.6729264}
confusion matrix:
   0    1
0  8  208
1  1  215
early stop counter: 2
val acc:0.569640040397644, best validation acc: 0.6737089157104492, corresponding to test acc:                         0.6828703880310059 / 0.6828703880310059
after epoch: 3,now: 2024-07-27 13:42:32.305799,epoch time: 0:01:58.199969,used: 0:05:57.306701,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.83409685, 'precision': 0.87361825, 'recall': 0.83537424, 'specificity': 0.83537424, 'f1': 0.829954, 'auroc': 0.836291, 'binary_precision': 0.99711263, 'binary_recall': 0.6727273, 'binary_specificity': 0.9980211, 'binary_f1_score': 0.80341226}
confusion matrix:
      0     1
0  1513     3
1   504  1036
---- Validation: 
scalar performance:
{'acc': 0.4968701, 'precision': 0.30815348, 'recall': 0.48411888, 'specificity': 0.48411888, 'f1': 0.33603308, 'auroc': 0.48406988, 'binary_precision': 0.11111111, 'binary_recall': 0.004823151, 'binary_specificity': 0.9634146, 'binary_f1_score': 0.009244992}
confusion matrix:
     0   1
0  632  24
1  619   3
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.49537036, 'precision': 0.41549295, 'recall': 0.4953704, 'specificity': 0.4953704, 'f1': 0.33922708, 'auroc': 0.49541324, 'binary_precision': 0.33333334, 'binary_recall': 0.009259259, 'binary_specificity': 0.9814815, 'binary_f1_score': 0.018018018}
confusion matrix:
     0  1
0  212  4
1  214  2
early stop counter: 3
val acc:0.49687010049819946, best validation acc: 0.6737089157104492, corresponding to test acc:                         0.6828703880310059 / 0.6828703880310059
after epoch: 4,now: 2024-07-27 13:44:30.370845,epoch time: 0:01:58.065046,used: 0:07:55.371747,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.88972515, 'precision': 0.9083424, 'recall': 0.890569, 'specificity': 0.890569, 'f1': 0.88860095, 'auroc': 0.89133275, 'binary_precision': 0.9975186, 'binary_recall': 0.7831169, 'binary_specificity': 0.9980211, 'binary_f1_score': 0.87740993}
confusion matrix:
      0     1
0  1513     3
1   334  1206
---- Validation: 
scalar performance:
{'acc': 0.4945227, 'precision': 0.3656623, 'recall': 0.48212394, 'specificity': 0.48212394, 'f1': 0.34411553, 'auroc': 0.48208964, 'binary_precision': 0.22727273, 'binary_recall': 0.01607717, 'binary_specificity': 0.9481707, 'binary_f1_score': 0.030030029}
confusion matrix:
     0   1
0  622  34
1  612  10
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.48842594, 'precision': 0.24707259, 'recall': 0.48842594, 'specificity': 0.48842594, 'f1': 0.3281493, 'auroc': 0.48842594, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9768519, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  211  5
1  216  0
early stop counter: 4
val acc:0.49452269077301025, best validation acc: 0.6737089157104492, corresponding to test acc:                         0.6828703880310059 / 0.6828703880310059
after epoch: 5,now: 2024-07-27 13:46:28.448138,epoch time: 0:01:58.077293,used: 0:09:53.449040,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.80399215, 'precision': 0.82608116, 'recall': 0.8029649, 'specificity': 0.8029649, 'f1': 0.80023694, 'auroc': 0.9361619, 'binary_precision': 0.74315244, 'binary_recall': 0.93376625, 'binary_specificity': 0.6721636, 'binary_f1_score': 0.8276259}
confusion matrix:
      0     1
0  1019   497
1   102  1438
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.5196014, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.8626007, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  216
1  0  216
early stop counter: 5
val acc:0.4866979718208313, best validation acc: 0.6737089157104492, corresponding to test acc:                         0.6828703880310059 / 0.6828703880310059
after epoch: 6,now: 2024-07-27 13:48:26.947991,epoch time: 0:01:58.499853,used: 0:11:51.948893,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_34_seed_2_23099031
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:11:51.948893 at 2024-07-27 13:48:26.947991
persisted model performance metric: 

scalar performance:
{'acc': 0.6828704, 'precision': 0.69195896, 'recall': 0.6828704, 'specificity': 0.6828704, 'f1': 0.67907166, 'auroc': 0.68242025, 'binary_precision': 0.7337278, 'binary_recall': 0.5740741, 'binary_specificity': 0.7916667, 'binary_f1_score': 0.64415586}
confusion matrix:
     0    1
0  171   45
1   92  124
oracle model performance metric: 

scalar performance:
{'acc': 0.6828704, 'precision': 0.69195896, 'recall': 0.6828704, 'specificity': 0.6828704, 'f1': 0.67907166, 'auroc': 0.68242025, 'binary_precision': 0.7337278, 'binary_recall': 0.5740741, 'binary_specificity': 0.7916667, 'binary_f1_score': 0.64415586}
confusion matrix:
     0    1
0  171   45
1   92  124
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/4.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/4.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454297 KiB |   3602 MiB |  64856 GiB |  64855 GiB |
|       from large pool | 413695 KiB |   3569 MiB |  64111 GiB |  64111 GiB |
|       from small pool |  40602 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454297 KiB |   3602 MiB |  64856 GiB |  64855 GiB |
|       from large pool | 413695 KiB |   3569 MiB |  64111 GiB |  64111 GiB |
|       from small pool |  40602 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  64658 GiB |  64658 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  63915 GiB |  63915 GiB |
|       from small pool |  40406 KiB |     60 MiB |    743 GiB |    743 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4002 MiB |   4016 MiB |  10454 MiB |   6452 MiB |
|       from large pool |   3938 MiB |   3952 MiB |  10352 MiB |   6414 MiB |
|       from small pool |     64 MiB |     68 MiB |    102 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 412006 KiB | 496525 KiB |  45591 GiB |  45591 GiB |
|       from large pool | 403457 KiB | 492852 KiB |  44831 GiB |  44830 GiB |
|       from small pool |   8549 KiB |  32850 KiB |    760 GiB |    760 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1709    |   11373 K  |   11372 K  |
|       from large pool |     187    |     468    |    5919 K  |    5918 K  |
|       from small pool |    1131    |    1447    |    5454 K  |    5453 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1709    |   11373 K  |   11372 K  |
|       from large pool |     187    |     468    |    5919 K  |    5918 K  |
|       from small pool |    1131    |    1447    |    5454 K  |    5453 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     197    |     200    |     481    |     284    |
|       from large pool |     165    |     166    |     430    |     265    |
|       from small pool |      32    |      34    |      51    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      84    |     253    |    6410 K  |    6409 K  |
|       from large pool |      35    |     165    |    3807 K  |    3807 K  |
|       from small pool |      49    |     220    |    2602 K  |    2602 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  64856 GiB |  64856 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  64111 GiB |  64111 GiB |
|       from small pool |      0 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  64856 GiB |  64856 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  64111 GiB |  64111 GiB |
|       from small pool |      0 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  64658 GiB |  64658 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  63915 GiB |  63915 GiB |
|       from small pool |      0 KiB |     60 MiB |    743 GiB |    743 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    846 MiB |   4016 MiB |  10454 MiB |   9608 MiB |
|       from large pool |    798 MiB |   3952 MiB |  10352 MiB |   9554 MiB |
|       from small pool |     48 MiB |     68 MiB |    102 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  45592 GiB |  45592 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  44831 GiB |  44831 GiB |
|       from small pool |      0 KiB |  36677 KiB |    760 GiB |    760 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |   11373 K  |   11373 K  |
|       from large pool |       2    |     468    |    5919 K  |    5919 K  |
|       from small pool |       0    |    1447    |    5454 K  |    5454 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |   11373 K  |   11373 K  |
|       from large pool |       2    |     468    |    5919 K  |    5919 K  |
|       from small pool |       0    |    1447    |    5454 K  |    5454 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      60    |     200    |     481    |     421    |
|       from large pool |      36    |     166    |     430    |     394    |
|       from small pool |      24    |      34    |      51    |      27    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    6410 K  |    6410 K  |
|       from large pool |       3    |     165    |    3807 K  |    3807 K  |
|       from small pool |       0    |     220    |    2603 K  |    2603 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 13:48:34 2024]
Finished job 0.
1 of 1 steps (100%) done
