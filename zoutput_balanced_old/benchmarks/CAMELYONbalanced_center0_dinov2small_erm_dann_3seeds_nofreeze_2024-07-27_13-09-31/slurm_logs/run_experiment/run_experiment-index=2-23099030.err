Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jul 27 13:10:29 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/2.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=2
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030

 Experiment start at: 2024-07-27 13:11:27.249416
before training, model accuracy: 0.49534884095191956
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.507487, 'precision': 0.2537435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33664435, 'auroc': 0.5, 'binary_precision': 0.507487, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6732887}
confusion matrix:
   0     1
0  0  1513
1  0  1559
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:13:46.207859,epoch time: 0:02:18.958443,used: 0:02:18.958443,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.50683594, 'precision': 0.25341797, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33635774, 'auroc': 0.5, 'binary_precision': 0.50683594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6727155}
confusion matrix:
   0     1
0  0  1515
1  0  1557
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 1
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 2,now: 2024-07-27 13:15:47.009295,epoch time: 0:02:00.801436,used: 0:04:19.759879,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.50683594, 'precision': 0.25341797, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33635774, 'auroc': 0.5, 'binary_precision': 0.50683594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6727155}
confusion matrix:
   0     1
0  0  1515
1  0  1557
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 2
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 13:17:47.881753,epoch time: 0:02:00.872458,used: 0:06:20.632337,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.5058594, 'precision': 0.2529297, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33592737, 'auroc': 0.5, 'binary_precision': 0.5058594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67185473}
confusion matrix:
   0     1
0  0  1518
1  0  1554
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 3
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 13:19:48.337147,epoch time: 0:02:00.455394,used: 0:08:21.087731,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.5061849, 'precision': 0.25309244, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3360709, 'auroc': 0.5, 'binary_precision': 0.5061849, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6721418}
confusion matrix:
   0     1
0  0  1517
1  0  1555
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 4
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 13:21:48.976197,epoch time: 0:02:00.639050,used: 0:10:21.726781,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.50683594, 'precision': 0.25341797, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33635774, 'auroc': 0.5, 'binary_precision': 0.50683594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6727155}
confusion matrix:
   0     1
0  0  1515
1  0  1557
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.5, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
early stop counter: 5
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 13:23:49.930911,epoch time: 0:02:00.954714,used: 0:12:22.681495,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_11_27_seed_0_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:12:22.681495 at 2024-07-27 13:23:49.930911
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  215
1  0  215
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/2.csv
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 455608 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool | 415006 KiB |   3568 MiB |  21427 GiB |  21426 GiB |
|       from small pool |  40602 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 455608 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool | 415006 KiB |   3568 MiB |  21427 GiB |  21426 GiB |
|       from small pool |  40602 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  21335 GiB |  21334 GiB |
|       from small pool |  40406 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4016 MiB |   4016 MiB |   4016 MiB |      0 B   |
|       from large pool |   3952 MiB |   3952 MiB |   3952 MiB |      0 B   |
|       from small pool |     64 MiB |     64 MiB |     64 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory | 349255 KiB | 496525 KiB |  15171 GiB |  15171 GiB |
|       from large pool | 342754 KiB | 492852 KiB |  14918 GiB |  14918 GiB |
|       from small pool |   6501 KiB |  14115 KiB |    252 GiB |    252 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1697    |    3794 K  |    3793 K  |
|       from large pool |     187    |     468    |    1976 K  |    1975 K  |
|       from small pool |    1131    |    1435    |    1818 K  |    1817 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1697    |    3794 K  |    3793 K  |
|       from large pool |     187    |     468    |    1976 K  |    1975 K  |
|       from small pool |    1131    |    1435    |    1818 K  |    1817 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     198    |     198    |     198    |       0    |
|       from large pool |     166    |     166    |     166    |       0    |
|       from small pool |      32    |      32    |      32    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      82    |     249    |    2194 K  |    2194 K  |
|       from large pool |      31    |     165    |    1332 K  |    1332 K  |
|       from small pool |      51    |     218    |     861 K  |     861 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  21335 GiB |  21335 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3952 MiB |   3952 MiB |   3212 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  15172 GiB |  15172 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  14919 GiB |  14919 GiB |
|       from small pool |      0 KiB |  22317 KiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     198    |     198    |     141    |
|       from large pool |      34    |     166    |     166    |     132    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     249    |    2194 K  |    2194 K  |
|       from large pool |       3    |     165    |    1332 K  |    1332 K  |
|       from small pool |       0    |     218    |     861 K  |     861 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  21674 GiB |  21674 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  21427 GiB |  21427 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  21582 GiB |  21582 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  21335 GiB |  21335 GiB |
|       from small pool |      0 KiB |     56 MiB |    247 GiB |    247 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   4016 MiB |   3230 MiB |
|       from large pool |    740 MiB |   3952 MiB |   3952 MiB |   3212 MiB |
|       from small pool |     46 MiB |     64 MiB |     64 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  15172 GiB |  15172 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  14919 GiB |  14919 GiB |
|       from small pool |      0 KiB |  22317 KiB |    253 GiB |    253 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1697    |    3794 K  |    3794 K  |
|       from large pool |       2    |     468    |    1976 K  |    1976 K  |
|       from small pool |       0    |    1435    |    1818 K  |    1818 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     198    |     198    |     141    |
|       from large pool |      34    |     166    |     166    |     132    |
|       from small pool |      23    |      32    |      32    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     249    |    2194 K  |    2194 K  |
|       from large pool |       3    |     165    |    1332 K  |    1332 K  |
|       from small pool |       0    |     218    |     861 K  |     861 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030

 Experiment start at: 2024-07-27 13:24:19.299764
before training, model accuracy: 0.5911111235618591
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:26:22.930598,epoch time: 0:02:03.630834,used: 0:02:03.630834,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.50683594, 'precision': 0.25341797, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33635774, 'auroc': 0.5, 'binary_precision': 0.50683594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6727155}
confusion matrix:
   0     1
0  0  1515
1  0  1557
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 1
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 2,now: 2024-07-27 13:28:23.073544,epoch time: 0:02:00.142946,used: 0:04:03.773780,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 2
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 3,now: 2024-07-27 13:30:23.482984,epoch time: 0:02:00.409440,used: 0:06:04.183220,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.5058594, 'precision': 0.2529297, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33592737, 'auroc': 0.5, 'binary_precision': 0.5058594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67185473}
confusion matrix:
   0     1
0  0  1518
1  0  1554
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 3
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 4,now: 2024-07-27 13:32:23.570628,epoch time: 0:02:00.087644,used: 0:08:04.270864,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.50683594, 'precision': 0.25341797, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33635774, 'auroc': 0.5, 'binary_precision': 0.50683594, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6727155}
confusion matrix:
   0     1
0  0  1515
1  0  1557
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 4
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 5,now: 2024-07-27 13:34:23.955677,epoch time: 0:02:00.385049,used: 0:10:04.655913,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.50651044, 'precision': 0.25325522, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33621433, 'auroc': 0.5, 'binary_precision': 0.50651044, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.67242867}
confusion matrix:
   0     1
0  0  1516
1  0  1556
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.5, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
early stop counter: 5
val acc:0.49180328845977783, best validation acc: 0.49180328845977783, corresponding to test acc:                         0.5 / 0.5
after epoch: 6,now: 2024-07-27 13:36:24.103257,epoch time: 0:02:00.147580,used: 0:12:04.803493,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_24_19_seed_1_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:12:04.803493 at 2024-07-27 13:36:24.103257
persisted model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  225
1  0  225
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 454480 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool | 413871 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |  40608 KiB |     60 MiB |    498 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 454480 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool | 413871 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |  40608 KiB |     60 MiB |    498 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447482 KiB |   3596 MiB |  43186 GiB |  43185 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  42689 GiB |  42688 GiB |
|       from small pool |  40407 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4008 MiB |   4016 MiB |   7238 MiB |   3230 MiB |
|       from large pool |   3940 MiB |   3952 MiB |   7152 MiB |   3212 MiB |
|       from small pool |     68 MiB |     68 MiB |     86 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 350384 KiB | 496525 KiB |  30281 GiB |  30280 GiB |
|       from large pool | 341840 KiB | 492852 KiB |  29772 GiB |  29771 GiB |
|       from small pool |   8543 KiB |  22317 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1330    |    1709    |    7600 K  |    7598 K  |
|       from large pool |     187    |     468    |    3953 K  |    3953 K  |
|       from small pool |    1143    |    1447    |    3646 K  |    3645 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1330    |    1709    |    7600 K  |    7598 K  |
|       from large pool |     187    |     468    |    3953 K  |    3953 K  |
|       from small pool |    1143    |    1447    |    3646 K  |    3645 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     200    |     200    |     341    |     141    |
|       from large pool |     166    |     166    |     298    |     132    |
|       from small pool |      34    |      34    |      43    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      87    |     253    |    4313 K  |    4313 K  |
|       from large pool |      34    |     165    |    2580 K  |    2580 K  |
|       from small pool |      53    |     219    |    1732 K  |    1732 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  43186 GiB |  43186 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  42689 GiB |  42689 GiB |
|       from small pool |      0 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   7238 MiB |   6452 MiB |
|       from large pool |    738 MiB |   3952 MiB |   7152 MiB |   6414 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  30281 GiB |  30281 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  29772 GiB |  29772 GiB |
|       from small pool |      0 KiB |  32850 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     341    |     284    |
|       from large pool |      33    |     166    |     298    |     265    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    4313 K  |    4313 K  |
|       from large pool |       3    |     165    |    2580 K  |    2580 K  |
|       from small pool |       0    |     219    |    1733 K  |    1733 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3602 MiB |  43291 GiB |  43291 GiB |
|       from large pool |  16640 KiB |   3568 MiB |  42793 GiB |  42793 GiB |
|       from small pool |      0 KiB |     60 MiB |    498 GiB |    498 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  43186 GiB |  43186 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  42689 GiB |  42689 GiB |
|       from small pool |      0 KiB |     60 MiB |    497 GiB |    497 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    786 MiB |   4016 MiB |   7238 MiB |   6452 MiB |
|       from large pool |    738 MiB |   3952 MiB |   7152 MiB |   6414 MiB |
|       from small pool |     48 MiB |     68 MiB |     86 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  30281 GiB |  30281 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  29772 GiB |  29772 GiB |
|       from small pool |      0 KiB |  32850 KiB |    509 GiB |    509 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |    7600 K  |    7600 K  |
|       from large pool |       2    |     468    |    3953 K  |    3953 K  |
|       from small pool |       0    |    1447    |    3646 K  |    3646 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      57    |     200    |     341    |     284    |
|       from large pool |      33    |     166    |     298    |     265    |
|       from small pool |      24    |      34    |      43    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    4313 K  |    4313 K  |
|       from large pool |       3    |     165    |    2580 K  |    2580 K  |
|       from small pool |       0    |     219    |    1733 K  |    1733 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030

 Experiment start at: 2024-07-27 13:36:53.118371
before training, model accuracy: 0.5254629850387573
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.88841623, 'precision': 0.90380996, 'recall': 0.88918805, 'specificity': 0.88918805, 'f1': 0.88747835, 'auroc': 0.8939834, 'binary_precision': 0.98464024, 'binary_recall': 0.7909091, 'binary_specificity': 0.987467, 'binary_f1_score': 0.87720555}
confusion matrix:
      0     1
0  1497    19
1   322  1218
---- Validation: 
scalar performance:
{'acc': 0.52895147, 'precision': 0.5944171, 'recall': 0.51691043, 'specificity': 0.51691043, 'f1': 0.39803204, 'auroc': 0.516832, 'binary_precision': 0.6666667, 'binary_recall': 0.06430868, 'binary_specificity': 0.9695122, 'binary_f1_score': 0.117302045}
confusion matrix:
     0   1
0  636  20
1  582  40
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.48842594, 'precision': 0.24707259, 'recall': 0.48842594, 'specificity': 0.48842594, 'f1': 0.3281493, 'auroc': 0.4861111, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9768519, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  211  5
1  216  0
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 13:38:55.555727,epoch time: 0:02:02.437356,used: 0:02:02.437356,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
new oracle model saved
early stop counter: 1
val acc:0.5133020281791687, best validation acc: 0.5289514660835266, corresponding to test acc:                         0.48842594027519226 / 0.5
after epoch: 2,now: 2024-07-27 13:40:55.054252,epoch time: 0:01:59.498525,used: 0:04:01.935881,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 2
val acc:0.5133020281791687, best validation acc: 0.5289514660835266, corresponding to test acc:                         0.48842594027519226 / 0.5
after epoch: 3,now: 2024-07-27 13:42:54.294763,epoch time: 0:01:59.240511,used: 0:06:01.176392,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.4960733, 'precision': 0.24803665, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33158356, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  1516  0
1  1540  0
---- Validation: 
scalar performance:
{'acc': 0.513302, 'precision': 0.256651, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33919337, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  656  0
1  622  0
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
early stop counter: 3
val acc:0.5133020281791687, best validation acc: 0.5289514660835266, corresponding to test acc:                         0.48842594027519226 / 0.5
after epoch: 4,now: 2024-07-27 13:44:53.414430,epoch time: 0:01:59.119667,used: 0:08:00.296059,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.5039267, 'precision': 0.25196335, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33507395, 'auroc': 0.5, 'binary_precision': 0.5039267, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6701479}
confusion matrix:
   0     1
0  0  1516
1  0  1540
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.5, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  216
1  0  216
early stop counter: 4
val acc:0.4866979718208313, best validation acc: 0.5289514660835266, corresponding to test acc:                         0.48842594027519226 / 0.5
after epoch: 5,now: 2024-07-27 13:46:52.836290,epoch time: 0:01:59.421860,used: 0:09:59.717919,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.5039267, 'precision': 0.25196335, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33507395, 'auroc': 0.5, 'binary_precision': 0.5039267, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6701479}
confusion matrix:
   0     1
0  0  1516
1  0  1540
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.5, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.5, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6666667}
confusion matrix:
   0    1
0  0  216
1  0  216
early stop counter: 5
val acc:0.4866979718208313, best validation acc: 0.5289514660835266, corresponding to test acc:                         0.48842594027519226 / 0.5
after epoch: 6,now: 2024-07-27 13:48:52.133432,epoch time: 0:01:59.297142,used: 0:11:59.015061,model: dset_te_center0_dann_b8efecac6_not_commited_2024md_07md_27_13_36_52_seed_2_23099030
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 0:11:59.015061 at 2024-07-27 13:48:52.133432
persisted model performance metric: 

scalar performance:
{'acc': 0.48842594, 'precision': 0.24707259, 'recall': 0.48842594, 'specificity': 0.48842594, 'f1': 0.3281493, 'auroc': 0.4861111, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 0.9768519, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  211  5
1  216  0
oracle model performance metric: 

scalar performance:
{'acc': 0.5, 'precision': 0.25, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33333334, 'auroc': 0.5, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
     0  1
0  216  0
1  216  0
results aggregation path: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/rule_results/2.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONbalanced_center0_dinov2small_erm_10seeds_nofreeze_2024-07-27_13-09-31/confusion_matrix/2.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 455321 KiB |   3603 MiB |  64857 GiB |  64856 GiB |
|       from large pool | 414719 KiB |   3569 MiB |  64112 GiB |  64112 GiB |
|       from small pool |  40602 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 455321 KiB |   3603 MiB |  64857 GiB |  64856 GiB |
|       from large pool | 414719 KiB |   3569 MiB |  64112 GiB |  64112 GiB |
|       from small pool |  40602 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 447481 KiB |   3596 MiB |  64658 GiB |  64658 GiB |
|       from large pool | 407075 KiB |   3563 MiB |  63915 GiB |  63915 GiB |
|       from small pool |  40406 KiB |     60 MiB |    743 GiB |    743 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   4002 MiB |   4016 MiB |  10454 MiB |   6452 MiB |
|       from large pool |   3938 MiB |   3952 MiB |  10352 MiB |   6414 MiB |
|       from small pool |     64 MiB |     68 MiB |    102 MiB |     38 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory | 410982 KiB | 496525 KiB |  45593 GiB |  45592 GiB |
|       from large pool | 402433 KiB | 492852 KiB |  44832 GiB |  44831 GiB |
|       from small pool |   8549 KiB |  32850 KiB |    760 GiB |    760 GiB |
|---------------------------------------------------------------------------|
| Allocations           |    1318    |    1709    |   11374 K  |   11372 K  |
|       from large pool |     187    |     468    |    5919 K  |    5918 K  |
|       from small pool |    1131    |    1447    |    5455 K  |    5453 K  |
|---------------------------------------------------------------------------|
| Active allocs         |    1318    |    1709    |   11374 K  |   11372 K  |
|       from large pool |     187    |     468    |    5919 K  |    5918 K  |
|       from small pool |    1131    |    1447    |    5455 K  |    5453 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     197    |     200    |     481    |     284    |
|       from large pool |     165    |     166    |     430    |     265    |
|       from small pool |      32    |      34    |      51    |      19    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      88    |     253    |    6407 K  |    6407 K  |
|       from large pool |      36    |     165    |    3808 K  |    3808 K  |
|       from small pool |      52    |     219    |    2598 K  |    2598 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  16640 KiB |   3603 MiB |  64857 GiB |  64857 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  64112 GiB |  64112 GiB |
|       from small pool |      0 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  16640 KiB |   3603 MiB |  64857 GiB |  64857 GiB |
|       from large pool |  16640 KiB |   3569 MiB |  64112 GiB |  64112 GiB |
|       from small pool |      0 KiB |     60 MiB |    744 GiB |    744 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  16640 KiB |   3596 MiB |  64658 GiB |  64658 GiB |
|       from large pool |  16640 KiB |   3563 MiB |  63915 GiB |  63915 GiB |
|       from small pool |      0 KiB |     60 MiB |    743 GiB |    743 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |    846 MiB |   4016 MiB |  10454 MiB |   9608 MiB |
|       from large pool |    798 MiB |   3952 MiB |  10352 MiB |   9554 MiB |
|       from small pool |     48 MiB |     68 MiB |    102 MiB |     54 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  24320 KiB | 496525 KiB |  45593 GiB |  45593 GiB |
|       from large pool |  24320 KiB | 492852 KiB |  44832 GiB |  44832 GiB |
|       from small pool |      0 KiB |  32856 KiB |    761 GiB |    761 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    1709    |   11374 K  |   11374 K  |
|       from large pool |       2    |     468    |    5919 K  |    5919 K  |
|       from small pool |       0    |    1447    |    5455 K  |    5455 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    1709    |   11374 K  |   11374 K  |
|       from large pool |       2    |     468    |    5919 K  |    5919 K  |
|       from small pool |       0    |    1447    |    5455 K  |    5455 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      60    |     200    |     481    |     421    |
|       from large pool |      36    |     166    |     430    |     394    |
|       from small pool |      24    |      34    |      51    |      27    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       3    |     253    |    6407 K  |    6407 K  |
|       from large pool |       3    |     165    |    3808 K  |    3808 K  |
|       from small pool |       0    |     219    |    2598 K  |    2598 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Sat Jul 27 13:49:00 2024]
Finished job 0.
1 of 1 steps (100%) done
