Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Jul 12 09:52:20 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/rule_results/8.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=8
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846

 Experiment start at: 2024-07-12 09:59:01.132995
before training, model accuracy: 0.5319587588310242
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9511638, 'precision': 0.4755819, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48748538, 'auroc': 0.8800771, 'binary_precision': 0.9511638, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97497076}
confusion matrix:
   0      1
0  0   1519
1  0  29585
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.7068237, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.556701, 'precision': 0.2783505, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3576159, 'auroc': 0.7052196, 'binary_precision': 0.556701, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7152318}
confusion matrix:
   0    1
0  0  215
1  0  270
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-12 10:13:07.053838,epoch time: 0:14:05.920843,used: 0:14:05.920843,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.95122814, 'precision': 0.47561407, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48750228, 'auroc': 0.9200685, 'binary_precision': 0.95122814, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97500455}
confusion matrix:
   0      1
0  0   1517
1  0  29587
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.7607819, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.556701, 'precision': 0.2783505, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3576159, 'auroc': 0.77939713, 'binary_precision': 0.556701, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7152318}
confusion matrix:
   0    1
0  0  215
1  0  270
early stop counter: 1
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5567010045051575 / 0.5567010045051575
after epoch: 2,now: 2024-07-12 10:27:08.613086,epoch time: 0:14:01.559248,used: 0:28:07.480091,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.95264274, 'precision': 0.91706705, 'recall': 0.5170095, 'specificity': 0.5170095, 'f1': 0.52082676, 'auroc': 0.92884254, 'binary_precision': 0.9527782, 'binary_recall': 0.9997634, 'binary_specificity': 0.034255598, 'binary_f1_score': 0.9757055}
confusion matrix:
    0      1
0  52   1466
1   7  29579
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.782143, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.556701, 'precision': 0.2783505, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3576159, 'auroc': 0.8071835, 'binary_precision': 0.556701, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7152318}
confusion matrix:
   0    1
0  0  215
1  0  270
early stop counter: 2
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5567010045051575 / 0.5567010045051575
after epoch: 3,now: 2024-07-12 10:41:18.160878,epoch time: 0:14:09.547792,used: 0:42:17.027883,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.95634, 'precision': 0.95304954, 'recall': 0.55580574, 'specificity': 0.55580574, 'f1': 0.5888965, 'auroc': 0.93872225, 'binary_precision': 0.95637834, 'binary_recall': 0.9996958, 'binary_specificity': 0.11191574, 'binary_f1_score': 0.9775574}
confusion matrix:
     0      1
0  170   1349
1    9  29576
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.79544437, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5587629, 'precision': 0.77892566, 'recall': 0.5023256, 'specificity': 0.5023256, 'f1': 0.36271983, 'auroc': 0.8221447, 'binary_precision': 0.55785125, 'binary_recall': 1.0, 'binary_specificity': 0.004651163, 'binary_f1_score': 0.7161804}
confusion matrix:
   0    1
0  1  214
1  0  270
new oracle model saved
early stop counter: 3
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5567010045051575 / 0.5587629079818726
after epoch: 4,now: 2024-07-12 10:55:37.973103,epoch time: 0:14:19.812225,used: 0:56:36.840108,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9579797, 'precision': 0.94988656, 'recall': 0.57415444, 'specificity': 0.57415444, 'f1': 0.6176714, 'auroc': 0.9445433, 'binary_precision': 0.9581065, 'binary_recall': 0.9995268, 'binary_specificity': 0.14878209, 'binary_f1_score': 0.97837853}
confusion matrix:
     0      1
0  226   1293
1   14  29571
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.8129481, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5587629, 'precision': 0.77892566, 'recall': 0.5023256, 'specificity': 0.5023256, 'f1': 0.36271983, 'auroc': 0.8430146, 'binary_precision': 0.55785125, 'binary_recall': 1.0, 'binary_specificity': 0.004651163, 'binary_f1_score': 0.7161804}
confusion matrix:
   0    1
0  1  214
1  0  270
early stop counter: 4
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5567010045051575 / 0.5587629079818726
after epoch: 5,now: 2024-07-12 11:09:20.772348,epoch time: 0:13:42.799245,used: 1:10:19.639353,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.95910496, 'precision': 0.9362978, 'recall': 0.58942235, 'specificity': 0.58942235, 'f1': 0.6396335, 'auroc': 0.950871, 'binary_precision': 0.95955205, 'binary_recall': 0.9991212, 'binary_specificity': 0.1797235, 'binary_f1_score': 0.9789369}
confusion matrix:
     0      1
0  273   1246
1   26  29559
---- Validation: 
scalar performance:
{'acc': 0.49301243, 'precision': 0.24650621, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.33021322, 'auroc': 0.8231071, 'binary_precision': 0.49301243, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.66042644}
confusion matrix:
   0    1
0  0  653
1  0  635
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5628866, 'precision': 0.780083, 'recall': 0.5069767, 'specificity': 0.5069767, 'f1': 0.37280402, 'auroc': 0.8535745, 'binary_precision': 0.560166, 'binary_recall': 1.0, 'binary_specificity': 0.013953488, 'binary_f1_score': 0.7180851}
confusion matrix:
   0    1
0  3  212
1  0  270
new oracle model saved
early stop counter: 5
val acc:0.4930124282836914, best validation acc: 0.4930124282836914, corresponding to test acc:                         0.5567010045051575 / 0.5628865957260132
after epoch: 6,now: 2024-07-12 11:23:20.757147,epoch time: 0:13:59.984799,used: 1:24:19.624152,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_09_59_01_seed_0_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 1:24:19.624152 at 2024-07-12 11:23:20.757147
persisted model performance metric: 

scalar performance:
{'acc': 0.556701, 'precision': 0.2783505, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.3576159, 'auroc': 0.7052196, 'binary_precision': 0.556701, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7152318}
confusion matrix:
   0    1
0  0  215
1  0  270
oracle model performance metric: 

scalar performance:
{'acc': 0.5628866, 'precision': 0.780083, 'recall': 0.5069767, 'specificity': 0.5069767, 'f1': 0.37280402, 'auroc': 0.8535745, 'binary_precision': 0.560166, 'binary_recall': 1.0, 'binary_specificity': 0.013953488, 'binary_f1_score': 0.7180851}
confusion matrix:
   0    1
0  3  212
1  0  270
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/rule_results/8.csv
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/rule_results/8.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/confusion_matrix/8.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 239252 KiB |   2195 MiB | 279945 GiB | 279945 GiB |
|       from large pool | 222848 KiB |   2177 MiB | 275684 GiB | 275684 GiB |
|       from small pool |  16404 KiB |     32 MiB |   4260 GiB |   4260 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 239252 KiB |   2195 MiB | 279945 GiB | 279945 GiB |
|       from large pool | 222848 KiB |   2177 MiB | 275684 GiB | 275684 GiB |
|       from small pool |  16404 KiB |     32 MiB |   4260 GiB |   4260 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 237908 KiB |   2194 MiB | 279939 GiB | 279939 GiB |
|       from large pool | 221710 KiB |   2176 MiB | 275682 GiB | 275682 GiB |
|       from small pool |  16198 KiB |     32 MiB |   4256 GiB |   4256 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2410 MiB |   2410 MiB |   2410 MiB |      0 B   |
|       from large pool |   2372 MiB |   2372 MiB |   2372 MiB |      0 B   |
|       from small pool |     38 MiB |     38 MiB |     38 MiB |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |  31083 KiB | 233245 KiB | 167010 GiB | 167010 GiB |
|       from large pool |  27008 KiB | 232580 KiB | 162647 GiB | 162647 GiB |
|       from small pool |   4075 KiB |   9272 KiB |   4363 GiB |   4363 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     820    |    4371    |   39908 K  |   39907 K  |
|       from large pool |      76    |     251    |   25924 K  |   25924 K  |
|       from small pool |     744    |    4294    |   13983 K  |   13982 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     820    |    4371    |   39908 K  |   39907 K  |
|       from large pool |      76    |     251    |   25924 K  |   25924 K  |
|       from small pool |     744    |    4294    |   13983 K  |   13982 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     117    |     117    |     117    |       0    |
|       from large pool |      98    |      98    |      98    |       0    |
|       from small pool |      19    |      19    |      19    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      36    |    1956    |   27695 K  |   27695 K  |
|       from large pool |       7    |      98    |   18665 K  |   18665 K  |
|       from small pool |      29    |    1949    |    9029 K  |    9029 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  65536 KiB |   2195 MiB | 279945 GiB | 279945 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 275684 GiB | 275684 GiB |
|       from small pool |      0 KiB |     32 MiB |   4260 GiB |   4260 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  65536 KiB |   2195 MiB | 279945 GiB | 279945 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 275684 GiB | 275684 GiB |
|       from small pool |      0 KiB |     32 MiB |   4260 GiB |   4260 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  65536 KiB |   2194 MiB | 279939 GiB | 279939 GiB |
|       from large pool |  65536 KiB |   2176 MiB | 275682 GiB | 275682 GiB |
|       from small pool |      0 KiB |     32 MiB |   4256 GiB |   4256 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 270336 KiB |   2410 MiB |   2410 MiB |   2146 MiB |
|       from large pool | 249856 KiB |   2372 MiB |   2372 MiB |   2128 MiB |
|       from small pool |  20480 KiB |     38 MiB |     38 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   | 233245 KiB | 167010 GiB | 167010 GiB |
|       from large pool |      0 B   | 232580 KiB | 162647 GiB | 162647 GiB |
|       from small pool |      0 B   |  11483 KiB |   4363 GiB |   4363 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    4371    |   39908 K  |   39908 K  |
|       from large pool |       2    |     251    |   25924 K  |   25924 K  |
|       from small pool |       0    |    4294    |   13983 K  |   13983 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    4371    |   39908 K  |   39908 K  |
|       from large pool |       2    |     251    |   25924 K  |   25924 K  |
|       from small pool |       0    |    4294    |   13983 K  |   13983 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     117    |     117    |      96    |
|       from large pool |      11    |      98    |      98    |      87    |
|       from small pool |      10    |      19    |      19    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |    1956    |   27695 K  |   27695 K  |
|       from large pool |       0    |      98    |   18666 K  |   18666 K  |
|       from small pool |       0    |    1949    |    9029 K  |    9029 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  65536 KiB |   2195 MiB | 279945 GiB | 279945 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 275684 GiB | 275684 GiB |
|       from small pool |      0 KiB |     32 MiB |   4260 GiB |   4260 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  65536 KiB |   2195 MiB | 279945 GiB | 279945 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 275684 GiB | 275684 GiB |
|       from small pool |      0 KiB |     32 MiB |   4260 GiB |   4260 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  65536 KiB |   2194 MiB | 279939 GiB | 279939 GiB |
|       from large pool |  65536 KiB |   2176 MiB | 275682 GiB | 275682 GiB |
|       from small pool |      0 KiB |     32 MiB |   4256 GiB |   4256 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 270336 KiB |   2410 MiB |   2410 MiB |   2146 MiB |
|       from large pool | 249856 KiB |   2372 MiB |   2372 MiB |   2128 MiB |
|       from small pool |  20480 KiB |     38 MiB |     38 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   | 233245 KiB | 167010 GiB | 167010 GiB |
|       from large pool |      0 B   | 232580 KiB | 162647 GiB | 162647 GiB |
|       from small pool |      0 B   |  11483 KiB |   4363 GiB |   4363 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    4371    |   39908 K  |   39908 K  |
|       from large pool |       2    |     251    |   25924 K  |   25924 K  |
|       from small pool |       0    |    4294    |   13983 K  |   13983 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    4371    |   39908 K  |   39908 K  |
|       from large pool |       2    |     251    |   25924 K  |   25924 K  |
|       from small pool |       0    |    4294    |   13983 K  |   13983 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      21    |     117    |     117    |      96    |
|       from large pool |      11    |      98    |      98    |      87    |
|       from small pool |      10    |      19    |      19    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |    1956    |   27695 K  |   27695 K  |
|       from large pool |       0    |      98    |   18666 K  |   18666 K  |
|       from small pool |       0    |    1949    |    9029 K  |    9029 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846

 Experiment start at: 2024-07-12 11:33:05.133161
before training, model accuracy: 0.5941422581672668
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.951307, 'precision': 0.4756535, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48752296, 'auroc': 0.878199, 'binary_precision': 0.951307, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.9750459}
confusion matrix:
   0      1
0  0   1520
1  0  29696
---- Validation: 
scalar performance:
{'acc': 0.49414518, 'precision': 0.74647886, 'recall': 0.50230414, 'specificity': 0.50230414, 'f1': 0.33477584, 'auroc': 0.8596982, 'binary_precision': 0.49295774, 'binary_recall': 1.0, 'binary_specificity': 0.004608295, 'binary_f1_score': 0.6603774}
confusion matrix:
   0    1
0  3  648
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.86592877, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-12 11:47:05.221664,epoch time: 0:14:00.088503,used: 0:14:00.088503,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.951275, 'precision': 0.4756375, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4875146, 'auroc': 0.92204744, 'binary_precision': 0.951275, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.9750292}
confusion matrix:
   0      1
0  0   1521
1  0  29695
---- Validation: 
scalar performance:
{'acc': 0.49336457, 'precision': 0.74628615, 'recall': 0.5015361, 'specificity': 0.5015361, 'f1': 0.3330785, 'auroc': 0.8536391, 'binary_precision': 0.4925723, 'binary_recall': 1.0, 'binary_specificity': 0.0030721966, 'binary_f1_score': 0.66003144}
confusion matrix:
   0    1
0  2  649
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.8667369, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
early stop counter: 1
val acc:0.4933645725250244, best validation acc: 0.4941451847553253, corresponding to test acc:                         0.5292887091636658 / 0.5292887091636658
after epoch: 2,now: 2024-07-12 12:01:08.932215,epoch time: 0:14:03.710551,used: 0:28:03.799054,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.951275, 'precision': 0.4756375, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4875146, 'auroc': 0.93471056, 'binary_precision': 0.951275, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.9750292}
confusion matrix:
   0      1
0  0   1521
1  0  29695
---- Validation: 
scalar performance:
{'acc': 0.49258393, 'precision': 0.74609375, 'recall': 0.50076807, 'specificity': 0.50076807, 'f1': 0.33137667, 'auroc': 0.8554312, 'binary_precision': 0.4921875, 'binary_recall': 1.0, 'binary_specificity': 0.0015360983, 'binary_f1_score': 0.65968585}
confusion matrix:
   0    1
0  1  650
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.87230563, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
early stop counter: 2
val acc:0.4925839304924011, best validation acc: 0.4941451847553253, corresponding to test acc:                         0.5292887091636658 / 0.5292887091636658
after epoch: 3,now: 2024-07-12 12:14:46.698275,epoch time: 0:13:37.766060,used: 0:41:41.565114,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.951275, 'precision': 0.4756375, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4875146, 'auroc': 0.94184047, 'binary_precision': 0.951275, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.9750292}
confusion matrix:
   0      1
0  0   1521
1  0  29695
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.8563907, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.8749056, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
early stop counter: 3
val acc:0.49180328845977783, best validation acc: 0.4941451847553253, corresponding to test acc:                         0.5292887091636658 / 0.5292887091636658
after epoch: 4,now: 2024-07-12 12:28:21.519165,epoch time: 0:13:34.820890,used: 0:55:16.386004,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.951275, 'precision': 0.4756375, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4875146, 'auroc': 0.9481016, 'binary_precision': 0.951275, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.9750292}
confusion matrix:
   0      1
0  0   1521
1  0  29695
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.86155725, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.88267016, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
early stop counter: 4
val acc:0.49180328845977783, best validation acc: 0.4941451847553253, corresponding to test acc:                         0.5292887091636658 / 0.5292887091636658
after epoch: 5,now: 2024-07-12 12:41:55.576248,epoch time: 0:13:34.057083,used: 1:08:50.443087,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.951275, 'precision': 0.4756375, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.4875146, 'auroc': 0.95426726, 'binary_precision': 0.951275, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.9750292}
confusion matrix:
   0      1
0  0   1521
1  0  29695
---- Validation: 
scalar performance:
{'acc': 0.4918033, 'precision': 0.24590164, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32967034, 'auroc': 0.8639358, 'binary_precision': 0.4918033, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6593407}
confusion matrix:
   0    1
0  0  651
1  0  630
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.8867018, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
early stop counter: 5
val acc:0.49180328845977783, best validation acc: 0.4941451847553253, corresponding to test acc:                         0.5292887091636658 / 0.5292887091636658
after epoch: 6,now: 2024-07-12 12:55:30.556579,epoch time: 0:13:34.980331,used: 1:22:25.423418,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_11_33_05_seed_1_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 1:22:25.423418 at 2024-07-12 12:55:30.556579
persisted model performance metric: 

scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.86592877, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
oracle model performance metric: 

scalar performance:
{'acc': 0.5292887, 'precision': 0.26464435, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.34610122, 'auroc': 0.86592877, 'binary_precision': 0.5292887, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.69220245}
confusion matrix:
   0    1
0  0  225
1  0  253
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/rule_results/8.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/confusion_matrix/8.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 239249 KiB |   2195 MiB | 560872 GiB | 560872 GiB |
|       from large pool | 222848 KiB |   2177 MiB | 552336 GiB | 552335 GiB |
|       from small pool |  16401 KiB |     32 MiB |   8536 GiB |   8536 GiB |
|---------------------------------------------------------------------------|
| Active memory         | 239249 KiB |   2195 MiB | 560872 GiB | 560872 GiB |
|       from large pool | 222848 KiB |   2177 MiB | 552336 GiB | 552335 GiB |
|       from small pool |  16401 KiB |     32 MiB |   8536 GiB |   8536 GiB |
|---------------------------------------------------------------------------|
| Requested memory      | 237908 KiB |   2194 MiB | 560860 GiB | 560860 GiB |
|       from large pool | 221710 KiB |   2176 MiB | 552331 GiB | 552331 GiB |
|       from small pool |  16198 KiB |     32 MiB |   8528 GiB |   8528 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2410 MiB |   2410 MiB |   4556 MiB |   2146 MiB |
|       from large pool |   2372 MiB |   2372 MiB |   4500 MiB |   2128 MiB |
|       from small pool |     38 MiB |     38 MiB |     56 MiB |     18 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  33134 KiB | 233245 KiB | 334600 GiB | 334600 GiB |
|       from large pool |  27008 KiB | 232580 KiB | 325858 GiB | 325858 GiB |
|       from small pool |   6126 KiB |  11483 KiB |   8742 GiB |   8742 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     814    |    4385    |   79951 K  |   79950 K  |
|       from large pool |      76    |     251    |   51938 K  |   51938 K  |
|       from small pool |     738    |    4308    |   28012 K  |   28012 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     814    |    4385    |   79951 K  |   79950 K  |
|       from large pool |      76    |     251    |   51938 K  |   51938 K  |
|       from small pool |     738    |    4308    |   28012 K  |   28012 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     117    |     117    |     213    |      96    |
|       from large pool |      98    |      98    |     185    |      87    |
|       from small pool |      19    |      19    |      28    |       9    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      39    |    1967    |   55183 K  |   55183 K  |
|       from large pool |       7    |      98    |   37396 K  |   37396 K  |
|       from small pool |      32    |    1960    |   17786 K  |   17786 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  65536 KiB |   2195 MiB | 560872 GiB | 560872 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 552336 GiB | 552335 GiB |
|       from small pool |      0 KiB |     32 MiB |   8536 GiB |   8536 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  65536 KiB |   2195 MiB | 560872 GiB | 560872 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 552336 GiB | 552335 GiB |
|       from small pool |      0 KiB |     32 MiB |   8536 GiB |   8536 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  65536 KiB |   2194 MiB | 560860 GiB | 560860 GiB |
|       from large pool |  65536 KiB |   2176 MiB | 552331 GiB | 552331 GiB |
|       from small pool |      0 KiB |     32 MiB |   8528 GiB |   8528 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 272384 KiB |   2410 MiB |   4556 MiB |   4290 MiB |
|       from large pool | 249856 KiB |   2372 MiB |   4500 MiB |   4256 MiB |
|       from small pool |  22528 KiB |     38 MiB |     56 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   | 233245 KiB | 334601 GiB | 334601 GiB |
|       from large pool |      0 B   | 232580 KiB | 325858 GiB | 325858 GiB |
|       from small pool |      0 B   |  15093 KiB |   8742 GiB |   8742 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    4385    |   79951 K  |   79951 K  |
|       from large pool |       2    |     251    |   51938 K  |   51938 K  |
|       from small pool |       0    |    4308    |   28012 K  |   28012 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    4385    |   79951 K  |   79951 K  |
|       from large pool |       2    |     251    |   51938 K  |   51938 K  |
|       from small pool |       0    |    4308    |   28012 K  |   28012 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     117    |     213    |     191    |
|       from large pool |      11    |      98    |     185    |     174    |
|       from small pool |      11    |      19    |      28    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |    1967    |   55183 K  |   55183 K  |
|       from large pool |       0    |      98    |   37396 K  |   37396 K  |
|       from small pool |       0    |    1960    |   17786 K  |   17786 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  65536 KiB |   2195 MiB | 560872 GiB | 560872 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 552336 GiB | 552335 GiB |
|       from small pool |      0 KiB |     32 MiB |   8536 GiB |   8536 GiB |
|---------------------------------------------------------------------------|
| Active memory         |  65536 KiB |   2195 MiB | 560872 GiB | 560872 GiB |
|       from large pool |  65536 KiB |   2177 MiB | 552336 GiB | 552335 GiB |
|       from small pool |      0 KiB |     32 MiB |   8536 GiB |   8536 GiB |
|---------------------------------------------------------------------------|
| Requested memory      |  65536 KiB |   2194 MiB | 560860 GiB | 560860 GiB |
|       from large pool |  65536 KiB |   2176 MiB | 552331 GiB | 552331 GiB |
|       from small pool |      0 KiB |     32 MiB |   8528 GiB |   8528 GiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 272384 KiB |   2410 MiB |   4556 MiB |   4290 MiB |
|       from large pool | 249856 KiB |   2372 MiB |   4500 MiB |   4256 MiB |
|       from small pool |  22528 KiB |     38 MiB |     56 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   | 233245 KiB | 334601 GiB | 334601 GiB |
|       from large pool |      0 B   | 232580 KiB | 325858 GiB | 325858 GiB |
|       from small pool |      0 B   |  15093 KiB |   8742 GiB |   8742 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    4385    |   79951 K  |   79951 K  |
|       from large pool |       2    |     251    |   51938 K  |   51938 K  |
|       from small pool |       0    |    4308    |   28012 K  |   28012 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    4385    |   79951 K  |   79951 K  |
|       from large pool |       2    |     251    |   51938 K  |   51938 K  |
|       from small pool |       0    |    4308    |   28012 K  |   28012 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     117    |     213    |     191    |
|       from large pool |      11    |      98    |     185    |     174    |
|       from small pool |      11    |      19    |      28    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |    1967    |   55183 K  |   55183 K  |
|       from large pool |       0    |      98    |   37396 K  |   37396 K  |
|       from small pool |       0    |    1960    |   17786 K  |   17786 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846

 Experiment start at: 2024-07-12 13:04:40.603959
before training, model accuracy: 0.5705263018608093
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9516828, 'precision': 0.4758414, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48762167, 'auroc': 0.87175715, 'binary_precision': 0.9516828, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97524333}
confusion matrix:
   0      1
0  0   1516
1  0  29860
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.809412, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.7094594, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-12 13:18:32.979657,epoch time: 0:13:52.375698,used: 0:13:52.375698,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9516828, 'precision': 0.4758414, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48762167, 'auroc': 0.91606367, 'binary_precision': 0.9516828, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97524333}
confusion matrix:
   0      1
0  0   1516
1  0  29860
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.83352774, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.78251463, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
early stop counter: 1
val acc:0.4866979718208313, best validation acc: 0.4866979718208313, corresponding to test acc:                         0.5452631711959839 / 0.5452631711959839
after epoch: 2,now: 2024-07-12 13:32:15.336987,epoch time: 0:13:42.357330,used: 0:27:34.733028,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9516828, 'precision': 0.4758414, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48762167, 'auroc': 0.93730605, 'binary_precision': 0.9516828, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97524333}
confusion matrix:
   0      1
0  0   1516
1  0  29860
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.84802413, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.82323396, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
early stop counter: 2
val acc:0.4866979718208313, best validation acc: 0.4866979718208313, corresponding to test acc:                         0.5452631711959839 / 0.5452631711959839
after epoch: 3,now: 2024-07-12 13:45:50.299321,epoch time: 0:13:34.962334,used: 0:41:09.695362,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9516828, 'precision': 0.4758414, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48762167, 'auroc': 0.9501178, 'binary_precision': 0.9516828, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97524333}
confusion matrix:
   0      1
0  0   1516
1  0  29860
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.8546388, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.8449878, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
early stop counter: 3
val acc:0.4866979718208313, best validation acc: 0.4866979718208313, corresponding to test acc:                         0.5452631711959839 / 0.5452631711959839
after epoch: 4,now: 2024-07-12 13:59:30.096799,epoch time: 0:13:39.797478,used: 0:54:49.492840,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9516828, 'precision': 0.4758414, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48762167, 'auroc': 0.9584447, 'binary_precision': 0.9516828, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97524333}
confusion matrix:
   0      1
0  0   1516
1  0  29860
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.8590013, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.86255896, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
early stop counter: 4
val acc:0.4866979718208313, best validation acc: 0.4866979718208313, corresponding to test acc:                         0.5452631711959839 / 0.5452631711959839
after epoch: 5,now: 2024-07-12 14:13:07.132891,epoch time: 0:13:37.036092,used: 1:08:26.528932,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9516828, 'precision': 0.4758414, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48762167, 'auroc': 0.96150804, 'binary_precision': 0.9516828, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.97524333}
confusion matrix:
   0      1
0  0   1516
1  0  29860
---- Validation: 
scalar performance:
{'acc': 0.48669797, 'precision': 0.24334899, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.32736844, 'auroc': 0.8637974, 'binary_precision': 0.48669797, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.6547369}
confusion matrix:
   0    1
0  0  656
1  0  622
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.8703525, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
early stop counter: 5
val acc:0.4866979718208313, best validation acc: 0.4866979718208313, corresponding to test acc:                         0.5452631711959839 / 0.5452631711959839
after epoch: 6,now: 2024-07-12 14:26:47.513140,epoch time: 0:13:40.380249,used: 1:22:06.909181,model: dset_te_center0_dann_b44271c83_not_commited_2024md_07md_12_13_04_40_seed_2_21918846
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
early stop trigger
Experiment finished at epoch: 6 with time: 1:22:06.909181 at 2024-07-12 14:26:47.513140
persisted model performance metric: 

scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.7094594, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
oracle model performance metric: 

scalar performance:
{'acc': 0.5452632, 'precision': 0.2726316, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.35286105, 'auroc': 0.7094594, 'binary_precision': 0.5452632, 'binary_recall': 1.0, 'binary_specificity': 0.0, 'binary_f1_score': 0.7057221}
confusion matrix:
   0    1
0  0  216
1  0  259
results aggregation path: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/rule_results/8.csv
confusion matrix saved in file: zoutput/benchmarks/CAMELYONWILD_center0_dinov2small_erm_irm_dial_lr1e5_bs16_classbalancing10_allfreeze/confusion_matrix/8.csv.txt
before torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      | 239249 KiB |   2195 MiB |    823 TiB |    823 TiB |
|       from large pool | 222848 KiB |   2177 MiB |    810 TiB |    810 TiB |
|       from small pool |  16401 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         | 239249 KiB |   2195 MiB |    823 TiB |    823 TiB |
|       from large pool | 222848 KiB |   2177 MiB |    810 TiB |    810 TiB |
|       from small pool |  16401 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      | 237908 KiB |   2194 MiB |    823 TiB |    823 TiB |
|       from large pool | 221710 KiB |   2176 MiB |    810 TiB |    810 TiB |
|       from small pool |  16198 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   2410 MiB |   2410 MiB |   6700 MiB |   4290 MiB |
|       from large pool |   2372 MiB |   2372 MiB |   6628 MiB |   4256 MiB |
|       from small pool |     38 MiB |     38 MiB |     72 MiB |     34 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |  33134 KiB | 233245 KiB | 503041 GiB | 503041 GiB |
|       from large pool |  27008 KiB | 232580 KiB | 489898 GiB | 489898 GiB |
|       from small pool |   6126 KiB |  15093 KiB |  13143 GiB |  13143 GiB |
|---------------------------------------------------------------------------|
| Allocations           |     814    |    4405    |  120193 K  |  120192 K  |
|       from large pool |      76    |     251    |   78084 K  |   78084 K  |
|       from small pool |     738    |    4328    |   42109 K  |   42108 K  |
|---------------------------------------------------------------------------|
| Active allocs         |     814    |    4405    |  120193 K  |  120192 K  |
|       from large pool |      76    |     251    |   78084 K  |   78084 K  |
|       from small pool |     738    |    4328    |   42109 K  |   42108 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |     117    |     117    |     308    |     191    |
|       from large pool |      98    |      98    |     272    |     174    |
|       from small pool |      19    |      19    |      36    |      17    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |      41    |    1975    |   82827 K  |   82826 K  |
|       from large pool |       7    |      98    |   56221 K  |   56221 K  |
|       from small pool |      34    |    1968    |   26605 K  |   26605 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

after torch memory clean up
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |  65536 KiB |   2195 MiB |    823 TiB |    823 TiB |
|       from large pool |  65536 KiB |   2177 MiB |    810 TiB |    810 TiB |
|       from small pool |      0 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Active memory         |  65536 KiB |   2195 MiB |    823 TiB |    823 TiB |
|       from large pool |  65536 KiB |   2177 MiB |    810 TiB |    810 TiB |
|       from small pool |      0 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| Requested memory      |  65536 KiB |   2194 MiB |    823 TiB |    823 TiB |
|       from large pool |  65536 KiB |   2176 MiB |    810 TiB |    810 TiB |
|       from small pool |      0 KiB |     32 MiB |     12 TiB |     12 TiB |
|---------------------------------------------------------------------------|
| GPU reserved memory   | 272384 KiB |   2410 MiB |   6700 MiB |   6434 MiB |
|       from large pool | 249856 KiB |   2372 MiB |   6628 MiB |   6384 MiB |
|       from small pool |  22528 KiB |     38 MiB |     72 MiB |     50 MiB |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   | 233245 KiB | 503041 GiB | 503041 GiB |
|       from large pool |      0 B   | 232580 KiB | 489898 GiB | 489898 GiB |
|       from small pool |      0 B   |  15093 KiB |  13143 GiB |  13143 GiB |
|---------------------------------------------------------------------------|
| Allocations           |       2    |    4405    |  120193 K  |  120193 K  |
|       from large pool |       2    |     251    |   78084 K  |   78084 K  |
|       from small pool |       0    |    4328    |   42109 K  |   42109 K  |
|---------------------------------------------------------------------------|
| Active allocs         |       2    |    4405    |  120193 K  |  120193 K  |
|       from large pool |       2    |     251    |   78084 K  |   78084 K  |
|       from small pool |       0    |    4328    |   42109 K  |   42109 K  |
|---------------------------------------------------------------------------|
| GPU reserved segments |      22    |     117    |     308    |     286    |
|       from large pool |      11    |      98    |     272    |     261    |
|       from small pool |      11    |      19    |      36    |      25    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |    1975    |   82827 K  |   82827 K  |
|       from large pool |       0    |      98    |   56221 K  |   56221 K  |
|       from small pool |       0    |    1968    |   26605 K  |   26605 K  |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

[Fri Jul 12 14:31:42 2024]
Finished job 0.
1 of 1 steps (100%) done
