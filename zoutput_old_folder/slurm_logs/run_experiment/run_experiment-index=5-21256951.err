Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jun  8 14:35:06 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/rule_results/5.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=5
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951

 Experiment start at: 2024-06-08 14:42:47.025083
before training, model accuracy: 0.955097496509552
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9699032, 'precision': 0.788381, 'recall': 0.65296257, 'specificity': 0.65296257, 'f1': 0.6980819, 'auroc': 0.9628966, 'binary_precision': 0.60026044, 'binary_recall': 0.31317934, 'binary_specificity': 0.99274576, 'binary_f1_score': 0.41160718}
confusion matrix:
       0    1
0  42013  307
1   1011  461
---- Validation: 
scalar performance:
{'acc': 0.9684972, 'precision': 0.7743406, 'recall': 0.6521661, 'specificity': 0.6521661, 'f1': 0.6941236, 'auroc': 0.9653168, 'binary_precision': 0.5726496, 'binary_recall': 0.31259722, 'binary_specificity': 0.9917351, 'binary_f1_score': 0.40442657}
confusion matrix:
       0    1
0  17999  150
1    442  201
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.970278, 'precision': 0.9146758, 'recall': 0.6711632, 'specificity': 0.6711632, 'f1': 0.7382473, 'auroc': 0.94563854, 'binary_precision': 0.85714287, 'binary_recall': 0.3448276, 'binary_specificity': 0.99749875, 'binary_f1_score': 0.49180326}
confusion matrix:
      0   1
0  5982  15
1   171  90
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_1.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-06-08 15:25:17.585729,epoch time: 0:42:30.560646,used: 0:42:30.560646,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.97851205, 'precision': 0.8443464, 'recall': 0.8092155, 'specificity': 0.8092155, 'f1': 0.82575285, 'auroc': 0.9789853, 'binary_precision': 0.70159453, 'binary_recall': 0.6277174, 'binary_specificity': 0.9907136, 'binary_f1_score': 0.6626031}
confusion matrix:
       0    1
0  41927  393
1    548  924
---- Validation: 
scalar performance:
{'acc': 0.97722435, 'precision': 0.84676373, 'recall': 0.77969337, 'specificity': 0.77969337, 'f1': 0.80932367, 'auroc': 0.97430027, 'binary_precision': 0.70873785, 'binary_recall': 0.5676516, 'binary_specificity': 0.9917351, 'binary_f1_score': 0.6303972}
confusion matrix:
       0    1
0  17999  150
1    278  365
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9650048, 'precision': 0.90248907, 'recall': 0.59878314, 'specificity': 0.59878314, 'f1': 0.65201014, 'auroc': 0.957791, 'binary_precision': 0.83870965, 'binary_recall': 0.19923371, 'binary_specificity': 0.9983325, 'binary_f1_score': 0.32198143}
confusion matrix:
      0   1
0  5987  10
1   209  52
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_2.png
better model found
persisted
after epoch: 2,now: 2024-06-08 16:03:37.111931,epoch time: 0:38:19.526202,used: 1:20:50.086848,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.98049873, 'precision': 0.92656887, 'recall': 0.7453273, 'specificity': 0.7453273, 'f1': 0.80982375, 'auroc': 0.9848043, 'binary_precision': 0.8705036, 'binary_recall': 0.49320653, 'binary_specificity': 0.997448, 'binary_f1_score': 0.62966174}
confusion matrix:
       0    1
0  42212  108
1    746  726
---- Validation: 
scalar performance:
{'acc': 0.9773308, 'precision': 0.9438679, 'recall': 0.6867416, 'specificity': 0.6867416, 'f1': 0.7596109, 'auroc': 0.97947323, 'binary_precision': 0.90943396, 'binary_recall': 0.3748056, 'binary_specificity': 0.9986776, 'binary_f1_score': 0.530837}
confusion matrix:
       0    1
0  18125   24
1    402  241
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96228826, 'precision': 0.8500357, 'recall': 0.5735454, 'specificity': 0.5735454, 'f1': 0.6145333, 'auroc': 0.95409906, 'binary_precision': 0.7358491, 'binary_recall': 0.14942528, 'binary_specificity': 0.9976655, 'binary_f1_score': 0.24840763}
confusion matrix:
      0   1
0  5983  14
1   222  39
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_3.png
better model found
persisted
after epoch: 3,now: 2024-06-08 16:41:36.500605,epoch time: 0:37:59.388674,used: 1:58:49.475522,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.98335314, 'precision': 0.89125407, 'recall': 0.8378409, 'specificity': 0.8378409, 'f1': 0.8624317, 'auroc': 0.9867352, 'binary_precision': 0.79351264, 'binary_recall': 0.68184906, 'binary_specificity': 0.9938328, 'binary_f1_score': 0.7334552}
confusion matrix:
       0     1
0  42060   261
1    468  1003
---- Validation: 
scalar performance:
{'acc': 0.9832908, 'precision': 0.9013268, 'recall': 0.8285874, 'specificity': 0.8285874, 'f1': 0.86104053, 'auroc': 0.981989, 'binary_precision': 0.81453156, 'binary_recall': 0.66251945, 'binary_specificity': 0.9946554, 'binary_f1_score': 0.73070323}
confusion matrix:
       0    1
0  18052   97
1    217  426
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9651646, 'precision': 0.9038472, 'recall': 0.6006988, 'specificity': 0.6006988, 'f1': 0.65463996, 'auroc': 0.953574, 'binary_precision': 0.84126985, 'binary_recall': 0.20306513, 'binary_specificity': 0.9983325, 'binary_f1_score': 0.32716048}
confusion matrix:
      0   1
0  5987  10
1   208  53
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_4.png
better model found
persisted
after epoch: 4,now: 2024-06-08 17:19:40.108565,epoch time: 0:38:03.607960,used: 2:36:53.083482,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.981846, 'precision': 0.85492396, 'recall': 0.87282306, 'specificity': 0.87282306, 'f1': 0.8636334, 'auroc': 0.98498344, 'binary_precision': 0.71834624, 'binary_recall': 0.7559483, 'binary_specificity': 0.9896978, 'binary_f1_score': 0.7366678}
confusion matrix:
       0     1
0  41885   436
1    359  1112
---- Validation: 
scalar performance:
{'acc': 0.9815879, 'precision': 0.8565723, 'recall': 0.87045896, 'specificity': 0.87045896, 'f1': 0.8633708, 'auroc': 0.9800669, 'binary_precision': 0.7219731, 'binary_recall': 0.7511664, 'binary_specificity': 0.9897515, 'binary_f1_score': 0.73628056}
confusion matrix:
       0    1
0  17963  186
1    160  483
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9638862, 'precision': 0.816331, 'recall': 0.63301384, 'specificity': 0.63301384, 'f1': 0.68363285, 'auroc': 0.9464884, 'binary_precision': 0.6635514, 'binary_recall': 0.27203065, 'binary_specificity': 0.993997, 'binary_f1_score': 0.38586956}
confusion matrix:
      0   1
0  5961  36
1   190  71
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_5.png
early stop counter: 1
val acc:0.9815878868103027, best validation acc: 0.9832907915115356, corresponding to test acc:                         0.9651646018028259 / 0.9702780246734619
after epoch: 5,now: 2024-06-08 17:57:42.611703,epoch time: 0:38:02.503138,used: 3:14:55.586620,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9841752, 'precision': 0.9222181, 'recall': 0.815752, 'specificity': 0.815752, 'f1': 0.8607315, 'auroc': 0.9897368, 'binary_precision': 0.8570119, 'binary_recall': 0.6351902, 'binary_specificity': 0.9963138, 'binary_f1_score': 0.7296138}
confusion matrix:
       0    1
0  42164  156
1    537  935
---- Validation: 
scalar performance:
{'acc': 0.98217326, 'precision': 0.93007994, 'recall': 0.77775514, 'specificity': 0.77775514, 'f1': 0.8363455, 'auroc': 0.98110586, 'binary_precision': 0.87560976, 'binary_recall': 0.55832034, 'binary_specificity': 0.99718994, 'binary_f1_score': 0.6818613}
confusion matrix:
       0    1
0  18098   51
1    284  359
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9650048, 'precision': 0.861938, 'recall': 0.61710644, 'specificity': 0.61710644, 'f1': 0.6717627, 'auroc': 0.95244145, 'binary_precision': 0.75609756, 'binary_recall': 0.23754789, 'binary_specificity': 0.996665, 'binary_f1_score': 0.36151603}
confusion matrix:
      0   1
0  5977  20
1   199  62
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_6.png
early stop counter: 2
val acc:0.9821732640266418, best validation acc: 0.9832907915115356, corresponding to test acc:                         0.9651646018028259 / 0.9702780246734619
after epoch: 6,now: 2024-06-08 18:35:46.370567,epoch time: 0:38:03.758864,used: 3:52:59.345484,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.98556817, 'precision': 0.87544143, 'recall': 0.91614187, 'specificity': 0.91614187, 'f1': 0.8946515, 'auroc': 0.9910565, 'binary_precision': 0.75641024, 'binary_recall': 0.84171194, 'binary_specificity': 0.99057186, 'binary_f1_score': 0.7967846}
confusion matrix:
       0     1
0  41921   399
1    233  1239
---- Validation: 
scalar performance:
{'acc': 0.9849404, 'precision': 0.8789574, 'recall': 0.8999467, 'specificity': 0.8999467, 'f1': 0.8891438, 'auroc': 0.9830401, 'binary_precision': 0.7647059, 'binary_recall': 0.8087092, 'binary_specificity': 0.9911841, 'binary_f1_score': 0.7860923}
confusion matrix:
       0    1
0  17989  160
1    123  520
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96212846, 'precision': 0.80466473, 'recall': 0.600947, 'specificity': 0.600947, 'f1': 0.6467855, 'auroc': 0.9499037, 'binary_precision': 0.64285713, 'binary_recall': 0.20689656, 'binary_specificity': 0.9949975, 'binary_f1_score': 0.3130435}
confusion matrix:
      0   1
0  5967  30
1   207  54
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_7.png
better model found
persisted
after epoch: 7,now: 2024-06-08 19:13:54.827854,epoch time: 0:38:08.457287,used: 4:31:07.802771,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9870981, 'precision': 0.9019365, 'recall': 0.8985067, 'specificity': 0.8985067, 'f1': 0.9002136, 'auroc': 0.9891167, 'binary_precision': 0.8106996, 'binary_recall': 0.803535, 'binary_specificity': 0.9934784, 'binary_f1_score': 0.80710137}
confusion matrix:
       0     1
0  42045   276
1    289  1182
---- Validation: 
scalar performance:
{'acc': 0.98541933, 'precision': 0.9073523, 'recall': 0.86194175, 'specificity': 0.86194175, 'f1': 0.88319707, 'auroc': 0.978665, 'binary_precision': 0.8242531, 'binary_recall': 0.7293935, 'binary_specificity': 0.99449, 'binary_f1_score': 0.7739274}
confusion matrix:
       0    1
0  18049  100
1    174  469
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96708214, 'precision': 0.8477707, 'recall': 0.66766334, 'specificity': 0.66766334, 'f1': 0.7232809, 'auroc': 0.9558213, 'binary_precision': 0.72357726, 'binary_recall': 0.34099618, 'binary_specificity': 0.9943305, 'binary_f1_score': 0.4635417}
confusion matrix:
      0   1
0  5963  34
1   172  89
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_8.png
better model found
persisted
after epoch: 8,now: 2024-06-08 19:52:00.672833,epoch time: 0:38:05.844979,used: 5:09:13.647750,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.98867375, 'precision': 0.9552217, 'recall': 0.86191964, 'specificity': 0.86191964, 'f1': 0.90285575, 'auroc': 0.9936352, 'binary_precision': 0.91989666, 'binary_recall': 0.7260367, 'binary_specificity': 0.9978025, 'binary_f1_score': 0.81155014}
confusion matrix:
       0     1
0  42228    93
1    403  1068
---- Validation: 
scalar performance:
{'acc': 0.9849404, 'precision': 0.93216896, 'recall': 0.82419103, 'specificity': 0.82419103, 'f1': 0.8698927, 'auroc': 0.9799322, 'binary_precision': 0.87656903, 'binary_recall': 0.65163296, 'binary_specificity': 0.9967491, 'binary_f1_score': 0.7475468}
confusion matrix:
       0    1
0  18090   59
1    224  419
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96292746, 'precision': 0.8553785, 'recall': 0.5830406, 'specificity': 0.5830406, 'f1': 0.6279887, 'auroc': 0.9400465, 'binary_precision': 0.7457627, 'binary_recall': 0.16858238, 'binary_specificity': 0.99749875, 'binary_f1_score': 0.275}
confusion matrix:
      0   1
0  5982  15
1   217  44
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_9.png
early stop counter: 1
val acc:0.9849404096603394, best validation acc: 0.9854193329811096, corresponding to test acc:                         0.967082142829895 / 0.9702780246734619
after epoch: 9,now: 2024-06-08 20:30:27.304432,epoch time: 0:38:26.631599,used: 5:47:40.279349,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.98837686, 'precision': 0.9341048, 'recall': 0.87890774, 'specificity': 0.87890774, 'f1': 0.9044882, 'auroc': 0.9932778, 'binary_precision': 0.876466, 'binary_recall': 0.76154894, 'binary_specificity': 0.99626654, 'binary_f1_score': 0.81497633}
confusion matrix:
       0     1
0  42162   158
1    351  1121
---- Validation: 
scalar performance:
{'acc': 0.9856854, 'precision': 0.94795775, 'recall': 0.8223266, 'specificity': 0.8223266, 'f1': 0.8741517, 'auroc': 0.97713345, 'binary_precision': 0.90829694, 'binary_recall': 0.64696735, 'binary_specificity': 0.99768585, 'binary_f1_score': 0.7556766}
confusion matrix:
       0    1
0  18107   42
1    227  416
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9590924, 'precision': 0.8685657, 'recall': 0.5132432, 'specificity': 0.5132432, 'f1': 0.51547354, 'auroc': 0.9323597, 'binary_precision': 0.7777778, 'binary_recall': 0.026819924, 'binary_specificity': 0.9996665, 'binary_f1_score': 0.051851854}
confusion matrix:
      0  1
0  5995  2
1   254  7
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_10.png
better model found
persisted
after epoch: 10,now: 2024-06-08 21:08:44.603933,epoch time: 0:38:17.299501,used: 6:25:57.578850,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9902037, 'precision': 0.9457141, 'recall': 0.8978852, 'specificity': 0.8978852, 'f1': 0.92034006, 'auroc': 0.9956217, 'binary_precision': 0.8983957, 'binary_recall': 0.79891306, 'binary_specificity': 0.9968573, 'binary_f1_score': 0.84573895}
confusion matrix:
       0     1
0  42187   133
1    296  1176
---- Validation: 
scalar performance:
{'acc': 0.9848872, 'precision': 0.9226336, 'recall': 0.83316416, 'specificity': 0.83316416, 'f1': 0.87219375, 'auroc': 0.98172903, 'binary_precision': 0.85685885, 'binary_recall': 0.6702955, 'binary_specificity': 0.99603283, 'binary_f1_score': 0.75218153}
confusion matrix:
       0    1
0  18077   72
1    212  431
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9602109, 'precision': 0.79654384, 'recall': 0.5541382, 'specificity': 0.5541382, 'f1': 0.5842652, 'auroc': 0.9460985, 'binary_precision': 0.6304348, 'binary_recall': 0.11111111, 'binary_specificity': 0.99716526, 'binary_f1_score': 0.18892507}
confusion matrix:
      0   1
0  5980  17
1   232  29
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_11.png
early stop counter: 1
val acc:0.9848871827125549, best validation acc: 0.985685408115387, corresponding to test acc:                         0.959092378616333 / 0.9702780246734619
after epoch: 11,now: 2024-06-08 21:46:30.445061,epoch time: 0:37:45.841128,used: 7:03:43.419978,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_14_42_46_seed_0_21256951
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9899525, 'precision': 0.9457072, 'recall': 0.8934217, 'specificity': 0.8934217, 'f1': 0.9178115, 'auroc': 0.9958402, 'binary_precision': 0.8986852, 'binary_recall': 0.7899388, 'binary_specificity': 0.9969046, 'binary_f1_score': 0.8408104}
confusion matrix:
       0     1
0  42190   131
1    309  1162
---- Validation: 
scalar performance:
{'acc': 0.9850468, 'precision': 0.92876554, 'recall': 0.8294965, 'specificity': 0.8294965, 'f1': 0.8721384, 'auroc': 0.98139, 'binary_precision': 0.86938775, 'binary_recall': 0.66251945, 'binary_specificity': 0.9964736, 'binary_f1_score': 0.75198585}
confusion matrix:
       0    1
0  18085   64
1    217  426
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9589326, 'precision': 0.77557003, 'recall': 0.5241538, 'specificity': 0.5241538, 'f1': 0.53543204, 'auroc': 0.93162435, 'binary_precision': 0.59090906, 'binary_recall': 0.049808428, 'binary_specificity': 0.9984993, 'binary_f1_score': 0.09187279}
confusion matrix:
      0   1
0  5988   9
1   248  13
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256951_12.png
[Sat Jun  8 22:24:35 2024]
Error in rule run_experiment:
    jobid: 0
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/rule_results/5.csv

RuleException:
RuntimeError in file /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk, line 161:
[enforce fail at inline_container.cc:595] . unexpected pos 324381888 vs 324381712
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk", line 161, in __rule_run_experiment
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/run_experiment.py", line 172, in run_experiment
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp/exp_main.py", line 77, in execute
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 51, in tr_epoch
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 66, in after_epoch
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/observers/b_obvisitor.py", line 60, in update
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/msels/a_model_sel.py", line 63, in update
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/msels/c_msel_oracle.py", line 37, in base_update
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/models/a_model.py", line 159, in save
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp/exp_utils.py", line 88, in save
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/serialization.py", line 627, in save
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/serialization.py", line 475, in __exit__
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/concurrent/futures/thread.py", line 58, in run
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
