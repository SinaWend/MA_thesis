Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed Jun 12 23:16:23 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_erm_vit_resnet_dinov2_bs16_different_learningrates/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_erm_vit_resnet_dinov2_bs16_different_learningrates/rule_results/17.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=17
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_12_23_26_25_seed_0_21308371

 Experiment start at: 2024-06-12 23:26:25.815101
before training, model accuracy: 0.3101629912853241
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9674598, 'precision': 0.7594526, 'recall': 0.5910444, 'specificity': 0.5910444, 'f1': 0.63128257, 'auroc': 0.92121756, 'binary_precision': 0.54653466, 'binary_recall': 0.1875, 'binary_specificity': 0.99458885, 'binary_f1_score': 0.27921093}
---- Validation: 
scalar performance:
{'acc': 0.9665815, 'precision': 0.75813687, 'recall': 0.5671682, 'specificity': 0.5671682, 'f1': 0.6018841, 'auroc': 0.9169233, 'binary_precision': 0.5460123, 'binary_recall': 0.13841368, 'binary_specificity': 0.9959226, 'binary_f1_score': 0.22084367}
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96660274, 'precision': 0.98316145, 'recall': 0.5996169, 'specificity': 0.5996169, 'f1': 0.6575707, 'auroc': 0.87197363, 'binary_precision': 1.0, 'binary_recall': 0.19923371, 'binary_specificity': 1.0, 'binary_f1_score': 0.33226836}
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21308371_1.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-06-12 23:45:49.362361,epoch time: 0:19:23.547260,used: 0:19:23.547260,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_12_23_26_25_seed_0_21308371
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.96780235, 'precision': 0.7530439, 'recall': 0.7076116, 'specificity': 0.7076116, 'f1': 0.72785, 'auroc': 0.936092, 'binary_precision': 0.5258333, 'binary_recall': 0.42866847, 'binary_specificity': 0.9865548, 'binary_f1_score': 0.47230542}
---- Validation: 
scalar performance:
{'acc': 0.9690826, 'precision': 0.7838552, 'recall': 0.65171915, 'specificity': 0.65171915, 'f1': 0.69593704, 'auroc': 0.93538487, 'binary_precision': 0.591716, 'binary_recall': 0.31104198, 'binary_specificity': 0.9923963, 'binary_f1_score': 0.40774718}
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9683605, 'precision': 0.97640264, 'recall': 0.622522, 'specificity': 0.622522, 'f1': 0.6881976, 'auroc': 0.8834815, 'binary_precision': 0.9846154, 'binary_recall': 0.24521072, 'binary_specificity': 0.9998332, 'binary_f1_score': 0.39263803}
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21308371_2.png
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-06-13 00:04:48.188186,epoch time: 0:18:58.825825,used: 0:38:22.373085,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_12_23_26_25_seed_0_21308371
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9689898, 'precision': 0.7891758, 'recall': 0.6082925, 'specificity': 0.6082925, 'f1': 0.65425444, 'auroc': 0.9263774, 'binary_precision': 0.60482377, 'binary_recall': 0.22161795, 'binary_specificity': 0.99496704, 'binary_f1_score': 0.32437813}
---- Validation: 
scalar performance:
{'acc': 0.9680715, 'precision': 0.7964181, 'recall': 0.5836907, 'specificity': 0.5836907, 'f1': 0.6259862, 'auroc': 0.93683976, 'binary_precision': 0.6214689, 'binary_recall': 0.1710731, 'binary_specificity': 0.9963083, 'binary_f1_score': 0.2682927}
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9603707, 'precision': 0.98014414, 'recall': 0.5249042, 'specificity': 0.5249042, 'f1': 0.53731614, 'auroc': 0.8757597, 'binary_precision': 1.0, 'binary_recall': 0.049808428, 'binary_specificity': 1.0, 'binary_f1_score': 0.09489051}
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21308371_3.png
early stop counter: 1
val acc:0.9680715203285217, best validation acc: 0.9690825939178467, corresponding to test acc:                         0.9683604836463928 / 0.9683604836463928
after epoch: 3,now: 2024-06-13 00:24:05.793219,epoch time: 0:19:17.605033,used: 0:57:39.978118,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_12_23_26_25_seed_0_21308371
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.97008586, 'precision': 0.78629863, 'recall': 0.66813856, 'specificity': 0.66813856, 'f1': 0.710476, 'auroc': 0.93594766, 'binary_precision': 0.5950704, 'binary_recall': 0.34442934, 'binary_specificity': 0.9918478, 'binary_f1_score': 0.43631673}
---- Validation: 
slurmstepd: error: *** JOB 21308371 ON gpusrv48 CANCELLED AT 2024-06-13T00:41:20 ***
