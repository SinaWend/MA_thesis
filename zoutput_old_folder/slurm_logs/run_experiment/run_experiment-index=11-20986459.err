Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Wed May 29 10:41:17 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-6/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-6/rule_results/11.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=11
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_05md_29_10_47_55_seed_0_20986459

 Experiment start at: 2024-05-29 10:47:55.683280
before training, model accuracy: 0.2401725947856903
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9606549, 'precision': 0.5439484, 'recall': 0.5101489, 'specificity': 0.5101489, 'f1': 0.51214224, 'auroc': 0.6020556, 'binary_precision': 0.12084592, 'binary_recall': 0.027173912, 'binary_specificity': 0.9931238, 'binary_f1_score': 0.04437049}
confusion matrix:
       0    1
0  42029  291
1   1432   40
---- Validation: 
scalar performance:
{'acc': 0.95987654, 'precision': 0.49969646, 'recall': 0.49994218, 'specificity': 0.49994218, 'f1': 0.49501088, 'auroc': 0.5359358, 'binary_precision': 0.033613447, 'binary_recall': 0.00622084, 'binary_specificity': 0.99366355, 'binary_f1_score': 0.010498688}
confusion matrix:
       0    1
0  18034  115
1    639    4
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9506232, 'precision': 0.48905927, 'recall': 0.49783036, 'specificity': 0.49783036, 'f1': 0.4905567, 'auroc': 0.5263315, 'binary_precision': 0.02, 'binary_recall': 0.0038314175, 'binary_specificity': 0.9918293, 'binary_f1_score': 0.0064308676}
confusion matrix:
      0   1
0  5948  49
1   260   1
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_20986459.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-05-29 11:12:06.164822,epoch time: 0:24:10.481542,used: 0:24:10.481542,model: dset_te_center0_erm_b44271c83_not_commited_2024md_05md_29_10_47_55_seed_0_20986459
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.965496, 'precision': 0.6247712, 'recall': 0.5080578, 'specificity': 0.5080578, 'f1': 0.50785196, 'auroc': 0.67862016, 'binary_precision': 0.2826087, 'binary_recall': 0.017675051, 'binary_specificity': 0.9984405, 'binary_f1_score': 0.033269353}
confusion matrix:
       0   1
0  42255  66
1   1445  26
---- Validation: 
scalar performance:
{'acc': 0.9650383, 'precision': 0.5384841, 'recall': 0.5011144, 'specificity': 0.5011144, 'f1': 0.49412882, 'auroc': 0.6245661, 'binary_precision': 0.11111111, 'binary_recall': 0.00311042, 'binary_specificity': 0.9991184, 'binary_f1_score': 0.0060514375}
confusion matrix:
       0   1
0  18133  16
1    641   2
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95637584, 'precision': 0.5148943, 'recall': 0.50083184, 'specificity': 0.50083184, 'f1': 0.49248528, 'auroc': 0.5898671, 'binary_precision': 0.071428575, 'binary_recall': 0.0038314175, 'binary_specificity': 0.99783224, 'binary_f1_score': 0.0072727273}
confusion matrix:
      0   1
0  5984  13
1   260   1
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_20986459.png
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-05-29 11:32:49.425029,epoch time: 0:20:43.260207,used: 0:44:53.741749,model: dset_te_center0_erm_b44271c83_not_commited_2024md_05md_29_10_47_55_seed_0_20986459
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
--- Logging error ---
