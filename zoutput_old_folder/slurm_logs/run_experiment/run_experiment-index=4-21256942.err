Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Sat Jun  8 12:25:07 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/rule_results/4.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=4
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942

 Experiment start at: 2024-06-08 12:32:13.182432
before training, model accuracy: 0.955097496509552
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9749726, 'precision': 0.87888837, 'recall': 0.67624056, 'specificity': 0.67624056, 'f1': 0.7379891, 'auroc': 0.97277313, 'binary_precision': 0.7797619, 'binary_recall': 0.35597825, 'binary_specificity': 0.9965028, 'binary_f1_score': 0.48880598}
confusion matrix:
       0    1
0  42172  148
1    948  524
---- Validation: 
scalar performance:
{'acc': 0.9753619, 'precision': 0.9408018, 'recall': 0.65572006, 'specificity': 0.65572006, 'f1': 0.7260653, 'auroc': 0.97211015, 'binary_precision': 0.9054054, 'binary_recall': 0.31259722, 'binary_specificity': 0.9988429, 'binary_f1_score': 0.46473992}
confusion matrix:
       0    1
0  18128   21
1    442  201
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9603707, 'precision': 0.98014414, 'recall': 0.5249042, 'specificity': 0.5249042, 'f1': 0.53731614, 'auroc': 0.9620156, 'binary_precision': 1.0, 'binary_recall': 0.049808428, 'binary_specificity': 1.0, 'binary_f1_score': 0.09489051}
confusion matrix:
      0   1
0  5997   0
1   248  13
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_1.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-06-08 13:10:40.456539,epoch time: 0:38:27.274107,used: 0:38:27.274107,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9812294, 'precision': 0.85988206, 'recall': 0.8457024, 'specificity': 0.8457024, 'f1': 0.8526372, 'auroc': 0.98340106, 'binary_precision': 0.73016995, 'binary_recall': 0.7004076, 'binary_specificity': 0.99099714, 'binary_f1_score': 0.71497923}
confusion matrix:
       0     1
0  41939   381
1    441  1031
---- Validation: 
scalar performance:
{'acc': 0.9797254, 'precision': 0.869989, 'recall': 0.79898953, 'specificity': 0.79898953, 'f1': 0.8304043, 'auroc': 0.97833806, 'binary_precision': 0.753876, 'binary_recall': 0.60497665, 'binary_specificity': 0.99300236, 'binary_f1_score': 0.67126834}
confusion matrix:
       0    1
0  18022  127
1    254  389
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96228826, 'precision': 0.8122018, 'recall': 0.59736574, 'specificity': 0.59736574, 'f1': 0.64325, 'auroc': 0.959467, 'binary_precision': 0.65822786, 'binary_recall': 0.19923371, 'binary_specificity': 0.99549776, 'binary_f1_score': 0.30588236}
confusion matrix:
      0   1
0  5970  27
1   209  52
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_2.png
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-06-08 13:47:51.336899,epoch time: 0:37:10.880360,used: 1:15:38.154467,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9747899, 'precision': 0.9733058, 'recall': 0.62860644, 'specificity': 0.62860644, 'f1': 0.69710517, 'auroc': 0.9845889, 'binary_precision': 0.97179484, 'binary_recall': 0.2574728, 'binary_specificity': 0.99974006, 'binary_f1_score': 0.40708917}
confusion matrix:
       0    1
0  42309   11
1   1093  379
---- Validation: 
scalar performance:
{'acc': 0.97190297, 'precision': 0.9589101, 'recall': 0.59467494, 'specificity': 0.59467494, 'f1': 0.65085953, 'auroc': 0.9787239, 'binary_precision': 0.9457364, 'binary_recall': 0.18973562, 'binary_specificity': 0.9996143, 'binary_f1_score': 0.31606218}
confusion matrix:
       0    1
0  18142    7
1    521  122
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9579738, 'precision': 0.6042133, 'recall': 0.5016656, 'specificity': 0.5016656, 'f1': 0.49303976, 'auroc': 0.9563888, 'binary_precision': 0.25, 'binary_recall': 0.0038314175, 'binary_specificity': 0.99949974, 'binary_f1_score': 0.0075471695}
confusion matrix:
      0  1
0  5994  3
1   260  1
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_3.png
early stop counter: 1
val acc:0.9719029664993286, best validation acc: 0.9797254204750061, corresponding to test acc:                         0.9622882604598999 / 0.9622882604598999
after epoch: 3,now: 2024-06-08 14:25:14.129645,epoch time: 0:37:22.792746,used: 1:53:00.947213,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.981846, 'precision': 0.8547039, 'recall': 0.87306845, 'specificity': 0.87306845, 'f1': 0.86363333, 'auroc': 0.98559165, 'binary_precision': 0.7178825, 'binary_recall': 0.7564626, 'binary_specificity': 0.9896744, 'binary_f1_score': 0.73666775}
confusion matrix:
       0     1
0  41885   437
1    358  1112
---- Validation: 
scalar performance:
{'acc': 0.9804172, 'precision': 0.8527777, 'recall': 0.8496014, 'specificity': 0.8496014, 'f1': 0.8511816, 'auroc': 0.981863, 'binary_precision': 0.7158556, 'binary_recall': 0.70917577, 'binary_specificity': 0.990027, 'binary_f1_score': 0.7125}
confusion matrix:
       0    1
0  17968  181
1    187  456
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96596354, 'precision': 0.8310502, 'recall': 0.6634151, 'specificity': 0.6634151, 'f1': 0.7160256, 'auroc': 0.9602542, 'binary_precision': 0.6904762, 'binary_recall': 0.33333334, 'binary_specificity': 0.9934968, 'binary_f1_score': 0.44961238}
confusion matrix:
      0   1
0  5958  39
1   174  87
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_4.png
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-06-08 15:02:40.529317,epoch time: 0:37:26.399672,used: 2:30:27.346885,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.9849973, 'precision': 0.8848012, 'recall': 0.8840442, 'specificity': 0.8840442, 'f1': 0.8844223, 'auroc': 0.98896337, 'binary_precision': 0.7773996, 'binary_recall': 0.7758152, 'binary_specificity': 0.99227315, 'binary_f1_score': 0.77660656}
confusion matrix:
       0     1
0  41993   327
1    330  1142
---- Validation: 
scalar performance:
{'acc': 0.98366326, 'precision': 0.8865235, 'recall': 0.85803235, 'specificity': 0.85803235, 'f1': 0.8716862, 'auroc': 0.97835183, 'binary_precision': 0.7828283, 'binary_recall': 0.7231726, 'binary_specificity': 0.99289215, 'binary_f1_score': 0.7518189}
confusion matrix:
       0    1
0  18020  129
1    178  465
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96180886, 'precision': 0.7958063, 'recall': 0.6026126, 'specificity': 0.6026126, 'f1': 0.6477715, 'auroc': 0.9515865, 'binary_precision': 0.625, 'binary_recall': 0.21072797, 'binary_specificity': 0.99449724, 'binary_f1_score': 0.31518626}
confusion matrix:
      0   1
0  5964  33
1   206  55
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_5.png
better model found
persisted
after epoch: 5,now: 2024-06-08 15:41:31.241730,epoch time: 0:38:50.712413,used: 3:09:18.059298,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.981572, 'precision': 0.9318214, 'recall': 0.7603084, 'specificity': 0.7603084, 'f1': 0.8233445, 'auroc': 0.98875284, 'binary_precision': 0.88, 'binary_recall': 0.5230978, 'binary_specificity': 0.9975189, 'binary_f1_score': 0.6561568}
confusion matrix:
       0    1
0  42215  105
1    702  770
---- Validation: 
scalar performance:
{'acc': 0.97988504, 'precision': 0.953418, 'recall': 0.72331655, 'specificity': 0.72331655, 'f1': 0.79672706, 'auroc': 0.97776973, 'binary_precision': 0.926045, 'binary_recall': 0.44790047, 'binary_specificity': 0.9987327, 'binary_f1_score': 0.6037736}
confusion matrix:
       0    1
0  18126   23
1    355  288
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.958613, 'precision': 0.9792999, 'recall': 0.50383145, 'specificity': 0.50383145, 'f1': 0.4970357, 'auroc': 0.96095306, 'binary_precision': 1.0, 'binary_recall': 0.007662835, 'binary_specificity': 1.0, 'binary_f1_score': 0.015209124}
confusion matrix:
      0  1
0  5997  0
1   259  2
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_6.png
early stop counter: 1
val acc:0.9798850417137146, best validation acc: 0.9836632609367371, corresponding to test acc:                         0.9618088603019714 / 0.9659635424613953
after epoch: 6,now: 2024-06-08 16:18:44.217247,epoch time: 0:37:12.975517,used: 3:46:31.034815,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.9871894, 'precision': 0.88838136, 'recall': 0.9251772, 'specificity': 0.9251772, 'f1': 0.9058742, 'auroc': 0.9934403, 'binary_precision': 0.7816945, 'binary_recall': 0.8586956, 'binary_specificity': 0.9916588, 'binary_f1_score': 0.8183878}
confusion matrix:
       0     1
0  41967   353
1    208  1264
---- Validation: 
scalar performance:
{'acc': 0.9855257, 'precision': 0.8868154, 'recall': 0.89724946, 'specificity': 0.89724946, 'f1': 0.8919569, 'auroc': 0.9803944, 'binary_precision': 0.7806354, 'binary_recall': 0.8024883, 'binary_specificity': 0.9920106, 'binary_f1_score': 0.7914111}
confusion matrix:
       0    1
0  18004  145
1    127  516
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9651646, 'precision': 0.8431613, 'recall': 0.6336808, 'specificity': 0.6336808, 'f1': 0.6882555, 'auroc': 0.95754933, 'binary_precision': 0.7171717, 'binary_recall': 0.27203065, 'binary_specificity': 0.995331, 'binary_f1_score': 0.39444444}
confusion matrix:
      0   1
0  5969  28
1   190  71
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_7.png
better model found
persisted
after epoch: 7,now: 2024-06-08 16:55:22.201047,epoch time: 0:36:37.983800,used: 4:23:09.018615,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.9889249, 'precision': 0.9190986, 'recall': 0.90837073, 'specificity': 0.90837073, 'f1': 0.91365945, 'auroc': 0.99372506, 'binary_precision': 0.8443824, 'binary_recall': 0.8220109, 'binary_specificity': 0.99473065, 'binary_f1_score': 0.83304644}
confusion matrix:
       0     1
0  42097   223
1    262  1210
---- Validation: 
scalar performance:
{'acc': 0.98350364, 'precision': 0.89557934, 'recall': 0.8406985, 'specificity': 0.8406985, 'f1': 0.86592484, 'auroc': 0.9804957, 'binary_precision': 0.80217785, 'binary_recall': 0.6874028, 'binary_specificity': 0.9939942, 'binary_f1_score': 0.7403685}
confusion matrix:
       0    1
0  18040  109
1    201  442
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9651646, 'precision': 0.8808496, 'recall': 0.6098605, 'specificity': 0.6098605, 'f1': 0.66470504, 'auroc': 0.95242226, 'binary_precision': 0.79452056, 'binary_recall': 0.22222222, 'binary_specificity': 0.99749875, 'binary_f1_score': 0.34730536}
confusion matrix:
      0   1
0  5982  15
1   203  58
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_8.png
early stop counter: 1
val acc:0.9835036396980286, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 8,now: 2024-06-08 17:32:15.351454,epoch time: 0:36:53.150407,used: 5:00:02.169022,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.9873036, 'precision': 0.89262784, 'recall': 0.9193348, 'specificity': 0.9193348, 'f1': 0.9055041, 'auroc': 0.99515593, 'binary_precision': 0.7906091, 'binary_recall': 0.8464674, 'binary_specificity': 0.9922023, 'binary_f1_score': 0.81758523}
confusion matrix:
       0     1
0  41990   330
1    226  1246
---- Validation: 
scalar performance:
{'acc': 0.9855257, 'precision': 0.89264214, 'recall': 0.8867487, 'specificity': 0.8867487, 'f1': 0.8896712, 'auroc': 0.974225, 'binary_precision': 0.793049, 'binary_recall': 0.7807154, 'binary_specificity': 0.992782, 'binary_f1_score': 0.78683394}
confusion matrix:
       0    1
0  18018  131
1    141  502
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96196866, 'precision': 0.9055276, 'recall': 0.55322295, 'specificity': 0.55322295, 'f1': 0.58550155, 'auroc': 0.9504483, 'binary_precision': 0.8484849, 'binary_recall': 0.107279696, 'binary_specificity': 0.99916625, 'binary_f1_score': 0.19047618}
confusion matrix:
      0   1
0  5992   5
1   233  28
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_9.png
early stop counter: 2
val acc:0.9855257272720337, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 9,now: 2024-06-08 18:09:18.822553,epoch time: 0:37:03.471099,used: 5:37:05.640121,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.9899525, 'precision': 0.95707715, 'recall': 0.8816901, 'specificity': 0.8816901, 'f1': 0.9157455, 'auroc': 0.9958445, 'binary_precision': 0.9222586, 'binary_recall': 0.765625, 'binary_specificity': 0.99775517, 'binary_f1_score': 0.83667415}
confusion matrix:
       0     1
0  42225    95
1    345  1127
---- Validation: 
scalar performance:
{'acc': 0.98483396, 'precision': 0.94067454, 'recall': 0.81438524, 'specificity': 0.81438524, 'f1': 0.8661947, 'auroc': 0.97942173, 'binary_precision': 0.8942731, 'binary_recall': 0.63141525, 'binary_specificity': 0.9973552, 'binary_f1_score': 0.7402005}
confusion matrix:
       0    1
0  18101   48
1    237  406
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9587728, 'precision': 0.7657528, 'recall': 0.52223814, 'specificity': 0.52223814, 'f1': 0.5320088, 'auroc': 0.93742067, 'binary_precision': 0.5714286, 'binary_recall': 0.04597701, 'binary_specificity': 0.9984993, 'binary_f1_score': 0.08510638}
confusion matrix:
      0   1
0  5988   9
1   249  12
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_10.png
early stop counter: 3
val acc:0.9848339557647705, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 10,now: 2024-06-08 18:46:49.215325,epoch time: 0:37:30.392772,used: 6:14:36.032893,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.9893816, 'precision': 0.8969247, 'recall': 0.955163, 'specificity': 0.955163, 'f1': 0.9238788, 'auroc': 0.99541986, 'binary_precision': 0.79670006, 'binary_recall': 0.91847825, 'binary_specificity': 0.9918478, 'binary_f1_score': 0.85326606}
confusion matrix:
       0     1
0  41975   345
1    120  1352
---- Validation: 
scalar performance:
{'acc': 0.98440826, 'precision': 0.87479275, 'recall': 0.89667094, 'specificity': 0.89667094, 'f1': 0.8853936, 'auroc': 0.98072994, 'binary_precision': 0.75659823, 'binary_recall': 0.8024883, 'binary_specificity': 0.9908535, 'binary_f1_score': 0.7788679}
confusion matrix:
       0    1
0  17983  166
1    127  516
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9610099, 'precision': 0.77493393, 'recall': 0.6113574, 'specificity': 0.6113574, 'f1': 0.65479565, 'auroc': 0.9467738, 'binary_precision': 0.5825243, 'binary_recall': 0.22988506, 'binary_specificity': 0.99282974, 'binary_f1_score': 0.32967034}
confusion matrix:
      0   1
0  5954  43
1   201  60
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_11.png
early stop counter: 4
val acc:0.9844082593917847, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 11,now: 2024-06-08 19:24:20.138695,epoch time: 0:37:30.923370,used: 6:52:06.956263,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.9904092, 'precision': 0.95304775, 'recall': 0.8932583, 'specificity': 0.8932583, 'f1': 0.9208825, 'auroc': 0.99677324, 'binary_precision': 0.9133858, 'binary_recall': 0.78911567, 'binary_specificity': 0.9974009, 'binary_f1_score': 0.84671533}
confusion matrix:
       0     1
0  42212   110
1    310  1160
---- Validation: 
scalar performance:
{'acc': 0.98408896, 'precision': 0.9257896, 'recall': 0.81549966, 'specificity': 0.81549966, 'f1': 0.86181986, 'auroc': 0.9809881, 'binary_precision': 0.86440676, 'binary_recall': 0.63452566, 'binary_specificity': 0.9964736, 'binary_f1_score': 0.7318386}
confusion matrix:
       0    1
0  18085   64
1    235  408
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9582934, 'precision': 0.73062074, 'recall': 0.53664666, 'specificity': 0.53664666, 'f1': 0.55576164, 'auroc': 0.9556502, 'binary_precision': 0.5, 'binary_recall': 0.07662835, 'binary_specificity': 0.996665, 'binary_f1_score': 0.13289037}
confusion matrix:
      0   1
0  5977  20
1   241  20
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_12.png
early stop counter: 5
val acc:0.9840889573097229, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 12,now: 2024-06-08 20:01:46.170398,epoch time: 0:37:26.031703,used: 7:29:32.987966,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.9891076, 'precision': 0.9245621, 'recall': 0.9042031, 'specificity': 0.9042031, 'f1': 0.91411245, 'auroc': 0.9956794, 'binary_precision': 0.85561115, 'binary_recall': 0.8131794, 'binary_specificity': 0.99522686, 'binary_f1_score': 0.83385575}
confusion matrix:
       0     1
0  42118   202
1    275  1197
---- Validation: 
scalar performance:
{'acc': 0.9845679, 'precision': 0.9143745, 'recall': 0.8367492, 'specificity': 0.8367492, 'f1': 0.87123406, 'auroc': 0.98120815, 'binary_precision': 0.84007704, 'binary_recall': 0.67807156, 'binary_specificity': 0.9954268, 'binary_f1_score': 0.7504303}
confusion matrix:
       0    1
0  18066   83
1    207  436
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9645254, 'precision': 0.8460262, 'recall': 0.61868864, 'specificity': 0.61868864, 'f1': 0.6719122, 'auroc': 0.94442093, 'binary_precision': 0.7241379, 'binary_recall': 0.2413793, 'binary_specificity': 0.995998, 'binary_f1_score': 0.36206895}
confusion matrix:
      0   1
0  5973  24
1   198  63
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_13.png
early stop counter: 6
val acc:0.9845678806304932, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 13,now: 2024-06-08 20:39:18.721304,epoch time: 0:37:32.550906,used: 8:07:05.538872,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 14
---- Training Domain: 
scalar performance:
{'acc': 0.9901352, 'precision': 0.93960345, 'recall': 0.9037512, 'specificity': 0.9037512, 'f1': 0.920856, 'auroc': 0.9968053, 'binary_precision': 0.8857567, 'binary_recall': 0.8111413, 'binary_specificity': 0.9963611, 'binary_f1_score': 0.84680855}
confusion matrix:
       0     1
0  42166   154
1    278  1194
---- Validation: 
scalar performance:
{'acc': 0.98435503, 'precision': 0.9123929, 'recall': 0.8351388, 'specificity': 0.8351388, 'f1': 0.86945796, 'auroc': 0.9752238, 'binary_precision': 0.8362235, 'binary_recall': 0.6749611, 'binary_specificity': 0.99531657, 'binary_f1_score': 0.74698794}
confusion matrix:
       0    1
0  18064   85
1    209  434
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.958613, 'precision': 0.77959347, 'recall': 0.5111608, 'specificity': 0.5111608, 'f1': 0.5115645, 'auroc': 0.9329807, 'binary_precision': 0.6, 'binary_recall': 0.022988506, 'binary_specificity': 0.999333, 'binary_f1_score': 0.044280443}
confusion matrix:
      0  1
0  5993  4
1   255  6
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_14.png
early stop counter: 7
val acc:0.9843550324440002, best validation acc: 0.9855257272720337, corresponding to test acc:                         0.9651646018028259 / 0.9659635424613953
after epoch: 14,now: 2024-06-08 21:16:52.450276,epoch time: 0:37:33.728972,used: 8:44:39.267844,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 15
---- Training Domain: 
scalar performance:
{'acc': 0.992099, 'precision': 0.92543674, 'recall': 0.958838, 'specificity': 0.958838, 'f1': 0.9414542, 'auroc': 0.99760795, 'binary_precision': 0.8535512, 'binary_recall': 0.92318153, 'binary_specificity': 0.99449444, 'binary_f1_score': 0.887002}
confusion matrix:
       0     1
0  42088   233
1    113  1358
---- Validation: 
scalar performance:
{'acc': 0.9870157, 'precision': 0.9050338, 'recall': 0.89652073, 'specificity': 0.89652073, 'f1': 0.9007282, 'auroc': 0.9746407, 'binary_precision': 0.8171701, 'binary_recall': 0.7993779, 'binary_specificity': 0.99366355, 'binary_f1_score': 0.8081761}
confusion matrix:
       0    1
0  18034  115
1    129  514
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.964845, 'precision': 0.83416116, 'recall': 0.6353464, 'specificity': 0.6353464, 'f1': 0.6887502, 'auroc': 0.9382235, 'binary_precision': 0.69902915, 'binary_recall': 0.27586207, 'binary_specificity': 0.9948307, 'binary_f1_score': 0.3956044}
confusion matrix:
      0   1
0  5966  31
1   189  72
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_15.png
better model found
persisted
after epoch: 15,now: 2024-06-08 21:54:27.786041,epoch time: 0:37:35.335765,used: 9:22:14.603609,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 16
---- Training Domain: 
scalar performance:
{'acc': 0.9913683, 'precision': 0.9525442, 'recall': 0.91023064, 'specificity': 0.91023064, 'f1': 0.9302708, 'auroc': 0.9959142, 'binary_precision': 0.91121143, 'binary_recall': 0.8232495, 'binary_specificity': 0.9972118, 'binary_f1_score': 0.865}
confusion matrix:
       0     1
0  42203   118
1    260  1211
---- Validation: 
scalar performance:
{'acc': 0.98472756, 'precision': 0.937887, 'recall': 0.81508017, 'specificity': 0.81508017, 'f1': 0.86573064, 'auroc': 0.97417593, 'binary_precision': 0.8886463, 'binary_recall': 0.63297045, 'binary_specificity': 0.99718994, 'binary_f1_score': 0.7393279}
confusion matrix:
       0    1
0  18098   51
1    236  407
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9611697, 'precision': 0.8025534, 'recall': 0.5766264, 'specificity': 0.5766264, 'f1': 0.61618745, 'auroc': 0.94441473, 'binary_precision': 0.640625, 'binary_recall': 0.15708812, 'binary_specificity': 0.99616474, 'binary_f1_score': 0.25230768}
confusion matrix:
      0   1
0  5974  23
1   220  41
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_16.png
early stop counter: 1
val acc:0.9847275614738464, best validation acc: 0.9870157241821289, corresponding to test acc:                         0.9648450016975403 / 0.9659635424613953
after epoch: 16,now: 2024-06-08 22:32:14.730117,epoch time: 0:37:46.944076,used: 10:00:01.547685,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_08_12_32_13_seed_0_21256942
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 17
---- Training Domain: 
scalar performance:
{'acc': 0.9939715, 'precision': 0.9486637, 'recall': 0.9598328, 'specificity': 0.9598328, 'f1': 0.95417416, 'auroc': 0.9985012, 'binary_precision': 0.9, 'binary_recall': 0.9232337, 'binary_specificity': 0.99643195, 'binary_f1_score': 0.91146886}
confusion matrix:
       0     1
0  42169   151
1    113  1359
---- Validation: 
scalar performance:
{'acc': 0.98696256, 'precision': 0.9162027, 'recall': 0.87924194, 'specificity': 0.87924194, 'f1': 0.89679366, 'auroc': 0.9752823, 'binary_precision': 0.84075344, 'binary_recall': 0.7636081, 'binary_specificity': 0.9948757, 'binary_f1_score': 0.80032605}
confusion matrix:
       0    1
0  18056   93
1    152  491
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96196866, 'precision': 0.82659245, 'recall': 0.57887566, 'specificity': 0.57887566, 'f1': 0.6206759, 'auroc': 0.9430482, 'binary_precision': 0.6885246, 'binary_recall': 0.16091955, 'binary_specificity': 0.9968318, 'binary_f1_score': 0.2608696}
confusion matrix:
      0   1
0  5978  19
1   219  42
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21256942_17.png
[Sat Jun  8 23:09:56 2024]
Error in rule run_experiment:
    jobid: 0
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new_new/rule_results/4.csv

--- Logging error ---
Traceback (most recent call last):
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/serialization.py", line 628, in save
    _save(obj, opened_zipfile, pickle_module, pickle_protocol, _disable_byteorder_record)
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/serialization.py", line 862, in _save
    zip_file.write_record(name, storage, num_bytes)
RuntimeError: [enforce fail at inline_container.cc:764] . PytorchStreamWriter failed writing file data/48: file write failed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/snakemake/executors/__init__.py", line 2656, in run_wrapper
    run(
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk", line 187, in __rule_run_experiment
    rule all:
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/run_experiment.py", line 172, in run_experiment
    exp.execute()
Shutting down, this might take some time.
--- Logging error ---
