Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Mon Jun  3 09:15:45 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_patchsize256_oversampling/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_patchsize256_oversampling/rule_results/10.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=10
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740

 Experiment start at: 2024-06-03 09:20:58.361317
before training, model accuracy: 0.4410029351711273
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/autograd/graph.py:744: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.952007, 'precision': 0.8329781, 'recall': 0.96234226, 'specificity': 0.96234226, 'f1': 0.88309014, 'auroc': 0.99075365, 'binary_precision': 0.6686859, 'binary_recall': 0.97508496, 'binary_specificity': 0.9495995, 'binary_f1_score': 0.793329}
confusion matrix:
       0     1
0  40188  2133
1    110  4305
---- Validation: 
scalar performance:
{'acc': 0.8859089, 'precision': 0.5737681, 'recall': 0.73391813, 'specificity': 0.73391813, 'f1': 0.5966311, 'auroc': 0.7813527, 'binary_precision': 0.16420582, 'binary_recall': 0.57076204, 'binary_specificity': 0.8970742, 'binary_f1_score': 0.25503823}
confusion matrix:
       0     1
0  16281  1868
1    276   367
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9617994, 'precision': 0.8790078, 'recall': 0.96730196, 'specificity': 0.96730196, 'f1': 0.9164531, 'auroc': 0.9937167, 'binary_precision': 0.76147705, 'binary_recall': 0.9744572, 'binary_specificity': 0.9601467, 'binary_f1_score': 0.85490197}
confusion matrix:
      0    1
0  5758  239
1    20  763
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_1.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-06-03 09:39:07.575220,epoch time: 0:18:09.213903,used: 0:18:09.213903,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9340979, 'precision': 0.7944883, 'recall': 0.9488018, 'specificity': 0.9488018, 'f1': 0.84863317, 'auroc': 0.9872915, 'binary_precision': 0.5926697, 'binary_recall': 0.9669309, 'binary_specificity': 0.9306727, 'binary_f1_score': 0.7348942}
confusion matrix:
       0     1
0  39387  2934
1    146  4269
---- Validation: 
scalar performance:
{'acc': 0.87760746, 'precision': 0.5477818, 'recall': 0.64786434, 'specificity': 0.64786434, 'f1': 0.5585429, 'auroc': 0.68841636, 'binary_precision': 0.11872987, 'binary_recall': 0.40124416, 'binary_specificity': 0.8944845, 'binary_f1_score': 0.18323864}
confusion matrix:
       0     1
0  16234  1915
1    385   258
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9485251, 'precision': 0.84713644, 'recall': 0.9625742, 'specificity': 0.9625742, 'f1': 0.8924806, 'auroc': 0.9947038, 'binary_precision': 0.6969147, 'binary_recall': 0.9808429, 'binary_specificity': 0.9443055, 'binary_f1_score': 0.81485415}
confusion matrix:
      0    1
0  5663  334
1    15  768
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_2.png
early stop counter: 1
val acc:0.8776074647903442, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 2,now: 2024-06-03 09:56:38.020201,epoch time: 0:17:30.444981,used: 0:35:39.658884,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.9221585, 'precision': 0.7731787, 'recall': 0.94211066, 'specificity': 0.94211066, 'f1': 0.8282327, 'auroc': 0.98571813, 'binary_precision': 0.5501289, 'binary_recall': 0.96671194, 'binary_specificity': 0.91750944, 'binary_f1_score': 0.70121545}
confusion matrix:
       0     1
0  38829  3491
1    147  4269
---- Validation: 
scalar performance:
{'acc': 0.8660068, 'precision': 0.5363005, 'recall': 0.6193569, 'specificity': 0.6193569, 'f1': 0.5402877, 'auroc': 0.6173358, 'binary_precision': 0.0978121, 'binary_recall': 0.35458788, 'binary_specificity': 0.8841258, 'binary_f1_score': 0.15332887}
confusion matrix:
       0     1
0  16046  2103
1    415   228
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9582596, 'precision': 0.86848974, 'recall': 0.9714081, 'specificity': 0.9714081, 'f1': 0.91065574, 'auroc': 0.9974191, 'binary_precision': 0.7385496, 'binary_recall': 0.9885057, 'binary_specificity': 0.9543105, 'binary_f1_score': 0.8454397}
confusion matrix:
      0    1
0  5723  274
1     9  774
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_3.png
early stop counter: 2
val acc:0.8660067915916443, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 3,now: 2024-06-03 10:14:04.737547,epoch time: 0:17:26.717346,used: 0:53:06.376230,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.8623117, 'precision': 0.69960964, 'recall': 0.906631, 'specificity': 0.906631, 'f1': 0.74345934, 'auroc': 0.9772314, 'binary_precision': 0.4039395, 'binary_recall': 0.9612772, 'binary_specificity': 0.85198486, 'binary_f1_score': 0.5688442}
confusion matrix:
       0     1
0  36056  6264
1    171  4245
---- Validation: 
scalar performance:
{'acc': 0.71737975, 'precision': 0.5112238, 'recall': 0.56791234, 'specificity': 0.56791234, 'f1': 0.461261, 'auroc': 0.57038325, 'binary_precision': 0.05046225, 'binary_recall': 0.407465, 'binary_specificity': 0.7283597, 'binary_f1_score': 0.08980292}
confusion matrix:
       0     1
0  13219  4930
1    381   262
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.87876105, 'precision': 0.74319726, 'recall': 0.9275794, 'specificity': 0.9275794, 'f1': 0.7901321, 'auroc': 0.9949042, 'binary_precision': 0.48774356, 'binary_recall': 0.99106, 'binary_specificity': 0.8640987, 'binary_f1_score': 0.6537489}
confusion matrix:
      0    1
0  5182  815
1     7  776
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_4.png
early stop counter: 3
val acc:0.7173797488212585, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 4,now: 2024-06-03 10:31:35.666480,epoch time: 0:17:30.928933,used: 1:10:37.305163,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.7722527, 'precision': 0.64437145, 'recall': 0.86663914, 'specificity': 0.86663914, 'f1': 0.6528158, 'auroc': 0.97456294, 'binary_precision': 0.29109934, 'binary_recall': 0.98301244, 'binary_specificity': 0.75026584, 'binary_f1_score': 0.44918236}
confusion matrix:
       0      1
0  31752  10569
1     75   4340
---- Validation: 
scalar performance:
{'acc': 0.5758833, 'precision': 0.50465775, 'recall': 0.53441054, 'specificity': 0.53441054, 'f1': 0.3991383, 'auroc': 0.5876082, 'binary_precision': 0.039587785, 'binary_recall': 0.48989114, 'binary_specificity': 0.57892996, 'binary_f1_score': 0.073255815}
confusion matrix:
       0     1
0  10507  7642
1    328   315
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7705015, 'precision': 0.6664628, 'recall': 0.8674925, 'specificity': 0.8674925, 'f1': 0.675536, 'auroc': 0.9865832, 'binary_precision': 0.33404896, 'binary_recall': 0.9936143, 'binary_specificity': 0.7413707, 'binary_f1_score': 0.5}
confusion matrix:
      0     1
0  4446  1551
1     5   778
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_5.png
early stop counter: 4
val acc:0.5758833289146423, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 5,now: 2024-06-03 10:49:19.296171,epoch time: 0:17:43.629691,used: 1:28:20.934854,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.7704339, 'precision': 0.64337087, 'recall': 0.86512864, 'specificity': 0.86512864, 'f1': 0.6510168, 'auroc': 0.97182274, 'binary_precision': 0.28926116, 'binary_recall': 0.98187584, 'binary_specificity': 0.74838144, 'binary_f1_score': 0.44687322}
confusion matrix:
       0      1
0  31673  10649
1     80   4334
---- Validation: 
scalar performance:
{'acc': 0.73361003, 'precision': 0.514231, 'recall': 0.5830655, 'specificity': 0.5830655, 'f1': 0.47071558, 'auroc': 0.61259806, 'binary_precision': 0.055249747, 'binary_recall': 0.4214619, 'binary_specificity': 0.74466914, 'binary_f1_score': 0.09769287}
confusion matrix:
       0     1
0  13515  4634
1    372   271
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.7737463, 'precision': 0.6676941, 'recall': 0.8682164, 'specificity': 0.8682164, 'f1': 0.6782293, 'auroc': 0.9929588, 'binary_precision': 0.3369518, 'binary_recall': 0.99106, 'binary_specificity': 0.7453727, 'binary_f1_score': 0.50291646}
confusion matrix:
      0     1
0  4470  1527
1     7   776
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_6.png
early stop counter: 5
val acc:0.7336100339889526, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 6,now: 2024-06-03 11:07:00.957193,epoch time: 0:17:41.661022,used: 1:46:02.595876,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.6375599, 'precision': 0.6011189, 'recall': 0.7930815, 'specificity': 0.7930815, 'f1': 0.544739, 'auroc': 0.9493345, 'binary_precision': 0.20486356, 'binary_recall': 0.984821, 'binary_specificity': 0.6013421, 'binary_f1_score': 0.33917215}
confusion matrix:
       0      1
0  25450  16872
1     67   4347
---- Validation: 
scalar performance:
{'acc': 0.4551937, 'precision': 0.49486396, 'recall': 0.46142697, 'specificity': 0.46142697, 'f1': 0.33636013, 'auroc': 0.5435434, 'binary_precision': 0.029518485, 'binary_recall': 0.4681182, 'binary_specificity': 0.4547358, 'binary_f1_score': 0.055535056}
confusion matrix:
      0     1
0  8253  9896
1   342   301
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5579646, 'precision': 0.60332733, 'recall': 0.7495699, 'specificity': 0.7495699, 'f1': 0.50493515, 'auroc': 0.9678454, 'binary_precision': 0.20698783, 'binary_recall': 0.99872285, 'binary_specificity': 0.5004169, 'binary_f1_score': 0.34290725}
confusion matrix:
      0     1
0  3001  2996
1     1   782
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_7.png
early stop counter: 6
val acc:0.4551936984062195, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 7,now: 2024-06-03 11:24:33.465115,epoch time: 0:17:32.507922,used: 2:03:35.103798,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
scalar performance:
{'acc': 0.7394942, 'precision': 0.6269838, 'recall': 0.8360763, 'specificity': 0.8360763, 'f1': 0.6210985, 'auroc': 0.95466954, 'binary_precision': 0.26045075, 'binary_recall': 0.95516306, 'binary_specificity': 0.7169896, 'binary_f1_score': 0.40929598}
confusion matrix:
       0      1
0  30343  11977
1    198   4218
---- Validation: 
scalar performance:
{'acc': 0.62787354, 'precision': 0.50317955, 'recall': 0.5223238, 'specificity': 0.5223238, 'f1': 0.41868004, 'auroc': 0.5283866, 'binary_precision': 0.038248982, 'binary_recall': 0.40902022, 'binary_specificity': 0.6356273, 'binary_f1_score': 0.06995611}
confusion matrix:
       0     1
0  11536  6613
1    380   263
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.73908556, 'precision': 0.6528272, 'recall': 0.850844, 'specificity': 0.850844, 'f1': 0.64785165, 'auroc': 0.99020016, 'binary_precision': 0.30636293, 'binary_recall': 0.99616855, 'binary_specificity': 0.70551944, 'binary_f1_score': 0.46860918}
confusion matrix:
      0     1
0  4231  1766
1     3   780
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_8.png
early stop counter: 7
val acc:0.6278735399246216, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 8,now: 2024-06-03 11:42:16.875464,epoch time: 0:17:43.410349,used: 2:21:18.514147,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 9
---- Training Domain: 
scalar performance:
{'acc': 0.6357626, 'precision': 0.60027593, 'recall': 0.7907702, 'specificity': 0.7907702, 'f1': 0.54312366, 'auroc': 0.9424255, 'binary_precision': 0.20369413, 'binary_recall': 0.98187584, 'binary_specificity': 0.59966445, 'binary_f1_score': 0.33739442}
confusion matrix:
       0      1
0  25379  16943
1     80   4334
---- Validation: 
scalar performance:
{'acc': 0.42693698, 'precision': 0.4926219, 'recall': 0.445298, 'specificity': 0.445298, 'f1': 0.32092223, 'auroc': 0.534586, 'binary_precision': 0.027881388, 'binary_recall': 0.46500778, 'binary_specificity': 0.4255882, 'binary_f1_score': 0.05260843}
confusion matrix:
      0      1
0  7724  10425
1   344    299
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5820059, 'precision': 0.6080025, 'recall': 0.76316, 'specificity': 0.76316, 'f1': 0.5231475, 'auroc': 0.97866774, 'binary_precision': 0.21632089, 'binary_recall': 0.99872285, 'binary_specificity': 0.5275971, 'binary_f1_score': 0.35561618}
confusion matrix:
      0     1
0  3164  2833
1     1   782
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_9.png
early stop counter: 8
val acc:0.4269369840621948, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 9,now: 2024-06-03 12:00:35.525278,epoch time: 0:18:18.649814,used: 2:39:37.163961,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 10
---- Training Domain: 
scalar performance:
{'acc': 0.627696, 'precision': 0.59795916, 'recall': 0.78469044, 'specificity': 0.78469044, 'f1': 0.5368579, 'auroc': 0.9513466, 'binary_precision': 0.19974102, 'binary_recall': 0.9782559, 'binary_specificity': 0.59112495, 'binary_f1_score': 0.3317459}
confusion matrix:
       0      1
0  25017  17304
1     96   4319
---- Validation: 
scalar performance:
{'acc': 0.4597169, 'precision': 0.494486, 'recall': 0.45851833, 'specificity': 0.45851833, 'f1': 0.33825356, 'auroc': 0.5327487, 'binary_precision': 0.029114677, 'binary_recall': 0.45723173, 'binary_specificity': 0.45980495, 'binary_f1_score': 0.054743506}
confusion matrix:
      0     1
0  8345  9804
1   349   294
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5567847, 'precision': 0.6031082, 'recall': 0.74890286, 'specificity': 0.74890286, 'f1': 0.5040419, 'auroc': 0.98007846, 'binary_precision': 0.20655045, 'binary_recall': 0.99872285, 'binary_specificity': 0.49908286, 'binary_f1_score': 0.34230685}
confusion matrix:
      0     1
0  2993  3004
1     1   782
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_10.png
early stop counter: 9
val acc:0.45971688628196716, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 10,now: 2024-06-03 12:18:19.290238,epoch time: 0:17:43.764960,used: 2:57:20.928921,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 11
---- Training Domain: 
scalar performance:
{'acc': 0.64988446, 'precision': 0.60276294, 'recall': 0.79613435, 'specificity': 0.79613435, 'f1': 0.55303746, 'auroc': 0.9475945, 'binary_precision': 0.2095002, 'binary_recall': 0.9764333, 'binary_specificity': 0.61583537, 'binary_f1_score': 0.34498218}
confusion matrix:
       0      1
0  26064  16259
1    104   4309
---- Validation: 
scalar performance:
{'acc': 0.3859089, 'precision': 0.4897443, 'recall': 0.42630732, 'specificity': 0.42630732, 'f1': 0.29806006, 'auroc': 0.54183406, 'binary_precision': 0.026258586, 'binary_recall': 0.4696734, 'binary_specificity': 0.38294122, 'binary_f1_score': 0.049736496}
confusion matrix:
      0      1
0  6950  11199
1   341    302
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6386431, 'precision': 0.6206537, 'recall': 0.7946208, 'specificity': 0.7946208, 'f1': 0.5663669, 'auroc': 0.9837261, 'binary_precision': 0.24187055, 'binary_recall': 0.9974457, 'binary_specificity': 0.5917959, 'binary_f1_score': 0.38933203}
confusion matrix:
      0     1
0  3549  2448
1     2   781
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_11.png
early stop counter: 10
val acc:0.38590890169143677, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 11,now: 2024-06-03 12:35:52.821380,epoch time: 0:17:33.531142,used: 3:14:54.460063,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 12
---- Training Domain: 
scalar performance:
{'acc': 0.6227533, 'precision': 0.59764725, 'recall': 0.78418994, 'specificity': 0.78418994, 'f1': 0.53373396, 'auroc': 0.9563469, 'binary_precision': 0.1982739, 'binary_recall': 0.98324275, 'binary_specificity': 0.58513707, 'binary_f1_score': 0.3300019}
confusion matrix:
       0      1
0  24763  17557
1     74   4342
---- Validation: 
scalar performance:
{'acc': 0.38686675, 'precision': 0.48951274, 'recall': 0.42455304, 'specificity': 0.42455304, 'f1': 0.298429, 'auroc': 0.53573537, 'binary_precision': 0.026052104, 'binary_recall': 0.46500778, 'binary_specificity': 0.3840983, 'binary_f1_score': 0.04933993}
confusion matrix:
      0      1
0  6971  11178
1   344    299
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.629351, 'precision': 0.6183342, 'recall': 0.78936815, 'specificity': 0.78936815, 'f1': 0.5591841, 'auroc': 0.9817804, 'binary_precision': 0.2372418, 'binary_recall': 0.9974457, 'binary_specificity': 0.58129066, 'binary_f1_score': 0.38331288}
confusion matrix:
      0     1
0  3486  2511
1     2   781
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_12.png
early stop counter: 11
val acc:0.3868667483329773, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 12,now: 2024-06-03 12:53:24.804354,epoch time: 0:17:31.982974,used: 3:32:26.443037,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 13
---- Training Domain: 
scalar performance:
{'acc': 0.58402514, 'precision': 0.5908193, 'recall': 0.7654544, 'specificity': 0.7654544, 'f1': 0.50608975, 'auroc': 0.92688644, 'binary_precision': 0.18372759, 'binary_recall': 0.98912305, 'binary_specificity': 0.5417858, 'binary_f1_score': 0.30989316}
confusion matrix:
       0      1
0  22930  19393
1     48   4365
---- Validation: 
scalar performance:
{'acc': 0.3384951, 'precision': 0.48554465, 'recall': 0.4017605, 'specificity': 0.4017605, 'f1': 0.26998088, 'auroc': 0.5052109, 'binary_precision': 0.024370562, 'binary_recall': 0.4696734, 'binary_specificity': 0.33384758, 'binary_f1_score': 0.04633679}
confusion matrix:
      0      1
0  6059  12090
1   341    302
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5300885, 'precision': 0.5986395, 'recall': 0.7343672, 'specificity': 0.7343672, 'f1': 0.4839144, 'auroc': 0.94660217, 'binary_precision': 0.19727892, 'binary_recall': 1.0, 'binary_specificity': 0.46873435, 'binary_f1_score': 0.32954544}
confusion matrix:
      0     1
0  2811  3186
1     0   783
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_13.png
early stop counter: 12
val acc:0.3384951055049896, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 13,now: 2024-06-03 13:10:44.689752,epoch time: 0:17:19.885398,used: 3:49:46.328435,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 14
---- Training Domain: 
scalar performance:
{'acc': 0.60809654, 'precision': 0.5935367, 'recall': 0.77305937, 'specificity': 0.77305937, 'f1': 0.52236915, 'auroc': 0.93933797, 'binary_precision': 0.19136845, 'binary_recall': 0.9764386, 'binary_specificity': 0.5696801, 'binary_f1_score': 0.32001784}
confusion matrix:
       0      1
0  24110  18212
1    104   4310
---- Validation: 
scalar performance:
{'acc': 0.39841422, 'precision': 0.49003187, 'recall': 0.42753112, 'specificity': 0.42753112, 'f1': 0.3047645, 'auroc': 0.526836, 'binary_precision': 0.026217561, 'binary_recall': 0.45878693, 'binary_specificity': 0.39627528, 'binary_f1_score': 0.049600672}
confusion matrix:
      0      1
0  7192  10957
1   348    295
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.55339235, 'precision': 0.60248333, 'recall': 0.74698526, 'specificity': 0.74698526, 'f1': 0.50147367, 'auroc': 0.9772015, 'binary_precision': 0.20530322, 'binary_recall': 0.99872285, 'binary_specificity': 0.49524763, 'binary_f1_score': 0.34059232}
confusion matrix:
      0     1
0  2970  3027
1     1   782
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_14.png
early stop counter: 13
val acc:0.3984142243862152, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 14,now: 2024-06-03 13:28:28.028526,epoch time: 0:17:43.338774,used: 4:07:29.667209,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 15
---- Training Domain: 
scalar performance:
{'acc': 0.60779697, 'precision': 0.59409297, 'recall': 0.7746131, 'specificity': 0.7746131, 'f1': 0.5225519, 'auroc': 0.9401294, 'binary_precision': 0.19178629, 'binary_recall': 0.98029894, 'binary_specificity': 0.5689272, 'binary_f1_score': 0.32080925}
confusion matrix:
       0      1
0  24077  18243
1     87   4329
---- Validation: 
scalar performance:
{'acc': 0.42911878, 'precision': 0.4927832, 'recall': 0.44642752, 'specificity': 0.44642752, 'f1': 0.32211882, 'auroc': 0.5304941, 'binary_precision': 0.027988393, 'binary_recall': 0.46500778, 'binary_specificity': 0.42784727, 'binary_f1_score': 0.052798867}
confusion matrix:
      0      1
0  7765  10384
1   344    299
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.5679941, 'precision': 0.60546875, 'recall': 0.7557945, 'specificity': 0.7557945, 'f1': 0.5126381, 'auroc': 0.9733957, 'binary_precision': 0.2109375, 'binary_recall': 1.0, 'binary_specificity': 0.5115891, 'binary_f1_score': 0.3483871}
confusion matrix:
      0     1
0  3068  2929
1     0   783
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_15.png
early stop counter: 14
val acc:0.4291187822818756, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 15,now: 2024-06-03 13:45:54.937257,epoch time: 0:17:26.908731,used: 4:24:56.575940,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 16
---- Training Domain: 
scalar performance:
{'acc': 0.59159964, 'precision': 0.59083635, 'recall': 0.76546955, 'specificity': 0.76546955, 'f1': 0.5107679, 'auroc': 0.9495455, 'binary_precision': 0.18547419, 'binary_recall': 0.9798415, 'binary_specificity': 0.5510976, 'binary_f1_score': 0.31190744}
confusion matrix:
       0      1
0  23323  18998
1     89   4326
---- Validation: 
scalar performance:
{'acc': 0.48547253, 'precision': 0.4963765, 'recall': 0.47260246, 'specificity': 0.47260246, 'f1': 0.35182935, 'auroc': 0.52940404, 'binary_precision': 0.030678036, 'binary_recall': 0.45878693, 'binary_specificity': 0.48641798, 'binary_f1_score': 0.05751048}
confusion matrix:
      0     1
0  8828  9321
1   348   295
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.57168144, 'precision': 0.6061839, 'recall': 0.7578789, 'specificity': 0.7578789, 'f1': 0.5154318, 'auroc': 0.98996735, 'binary_precision': 0.21236777, 'binary_recall': 1.0, 'binary_specificity': 0.51575786, 'binary_f1_score': 0.35033557}
confusion matrix:
      0     1
0  3093  2904
1     0   783
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_16.png
early stop counter: 15
val acc:0.48547253012657166, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 16,now: 2024-06-03 14:03:26.655777,epoch time: 0:17:31.718520,used: 4:42:28.294460,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 17
---- Training Domain: 
scalar performance:
{'acc': 0.66066843, 'precision': 0.604552, 'recall': 0.7992449, 'specificity': 0.7992449, 'f1': 0.56051105, 'auroc': 0.9525729, 'binary_precision': 0.21404298, 'binary_recall': 0.97010195, 'binary_specificity': 0.6283878, 'binary_f1_score': 0.35070622}
confusion matrix:
       0      1
0  26594  15727
1    132   4283
---- Validation: 
scalar performance:
{'acc': 0.52011496, 'precision': 0.49864715, 'recall': 0.48978728, 'specificity': 0.48978728, 'f1': 0.3694435, 'auroc': 0.50632954, 'binary_precision': 0.032801516, 'binary_recall': 0.45723173, 'binary_specificity': 0.5223428, 'binary_f1_score': 0.061211742}
confusion matrix:
      0     1
0  9480  8669
1   349   294
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.6182891, 'precision': 0.6159116, 'recall': 0.78367025, 'specificity': 0.78367025, 'f1': 0.55080044, 'auroc': 0.9913827, 'binary_precision': 0.23211636, 'binary_recall': 0.99872285, 'binary_specificity': 0.56861764, 'binary_f1_score': 0.37668592}
confusion matrix:
      0     1
0  3410  2587
1     1   782
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_17.png
early stop counter: 16
val acc:0.5201149582862854, best validation acc: 0.8859089016914368, corresponding to test acc:                         0.9617993831634521 / 0.9617993831634521
after epoch: 17,now: 2024-06-03 14:21:02.823347,epoch time: 0:17:36.167570,used: 5:00:04.462030,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_03_09_20_58_seed_0_21054740
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 18
---- Training Domain: 
scalar performance:
{'acc': 0.6009928, 'precision': 0.5913274, 'recall': 0.7666982, 'specificity': 0.7666982, 'f1': 0.51676416, 'auroc': 0.93066704, 'binary_precision': 0.18800421, 'binary_recall': 0.9710145, 'binary_specificity': 0.56238186, 'binary_f1_score': 0.31501615}
confusion matrix:
       0      1
0  23800  18520
1    128   4288
---- Validation: 
scalar performance:
{'acc': 0.39144316, 'precision': 0.48978144, 'recall': 0.42617226, 'specificity': 0.42617226, 'f1': 0.30098832, 'auroc': 0.51272213, 'binary_precision': 0.026165599, 'binary_recall': 0.46345258, 'binary_specificity': 0.38889194, 'binary_f1_score': 0.049534578}
confusion matrix:
      0      1
0  7058  11091
1   345    298
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.56740415, 'precision': 0.6051142, 'recall': 0.7549058, 'specificity': 0.7549058, 'f1': 0.5120819, 'auroc': 0.97491276, 'binary_precision': 0.21055466, 'binary_recall': 0.99872285, 'binary_specificity': 0.51108885, 'binary_f1_score': 0.3477874}
confusion matrix:
      0     1
0  3065  2932
1     1   782
t-SNE plot saved as zoutput/tsne/t-SNE_Test_center0_21054740_18.png
[Mon Jun  3 14:38:29 2024]
Error in rule run_experiment:
    jobid: 0
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_patchsize256_oversampling/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_patchsize256_oversampling/rule_results/10.csv

RuleException:
RuntimeError in file /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk, line 161:
[enforce fail at inline_container.cc:595] . unexpected pos 92718208 vs 92718040
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/benchmark.smk", line 161, in __rule_run_experiment
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp_protocol/run_experiment.py", line 172, in run_experiment
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp/exp_main.py", line 77, in execute
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 51, in tr_epoch
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/trainers/train_irm.py", line 66, in after_epoch
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/observers/b_obvisitor.py", line 60, in update
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/msels/a_model_sel.py", line 63, in update
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/algos/msels/c_msel_oracle.py", line 37, in base_update
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/models/a_model.py", line 159, in save
  File "/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/exp/exp_utils.py", line 88, in save
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/serialization.py", line 627, in save
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/serialization.py", line 475, in __exit__
  File "/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/concurrent/futures/thread.py", line 58, in run
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
