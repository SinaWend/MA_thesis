Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Jun  7 05:34:04 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new/rule_results/3.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=3
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270

 Experiment start at: 2024-06-07 05:44:17.841116
before training, model accuracy: 0.955097496509552
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9672543, 'precision': 0.74970376, 'recall': 0.85641515, 'specificity': 0.85641515, 'f1': 0.7925166, 'auroc': 0.9647544, 'binary_precision': 0.50867325, 'binary_recall': 0.7375935, 'binary_specificity': 0.9752369, 'binary_f1_score': 0.6021088}
confusion matrix:
       0     1
0  41273  1048
1    386  1085
---- Validation: 
scalar performance:
{'acc': 0.9650915, 'precision': 0.7408668, 'recall': 0.83341646, 'specificity': 0.83341646, 'f1': 0.7787381, 'auroc': 0.96560735, 'binary_precision': 0.4928018, 'binary_recall': 0.69206846, 'binary_specificity': 0.97476447, 'binary_f1_score': 0.5756792}
confusion matrix:
       0    1
0  17691  458
1    198  445
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.98050493, 'precision': 0.92775774, 'recall': 0.8102596, 'specificity': 0.8102596, 'f1': 0.85878456, 'auroc': 0.95213735, 'binary_precision': 0.8716577, 'binary_recall': 0.6245211, 'binary_specificity': 0.995998, 'binary_f1_score': 0.72767854}
confusion matrix:
      0    1
0  5973   24
1    98  163
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_1.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-06-07 06:25:11.324040,epoch time: 0:40:53.482924,used: 0:40:53.482924,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9781695, 'precision': 0.8233181, 'recall': 0.8621515, 'specificity': 0.8621515, 'f1': 0.841527, 'auroc': 0.97946393, 'binary_precision': 0.6557971, 'binary_recall': 0.73777175, 'binary_specificity': 0.9865312, 'binary_f1_score': 0.6943734}
confusion matrix:
       0     1
0  41750   570
1    386  1086
---- Validation: 
scalar performance:
{'acc': 0.9777033, 'precision': 0.8353151, 'recall': 0.8196942, 'specificity': 0.8196942, 'f1': 0.82730097, 'auroc': 0.9749317, 'binary_precision': 0.6830065, 'binary_recall': 0.65007776, 'binary_specificity': 0.9893107, 'binary_f1_score': 0.66613543}
confusion matrix:
       0    1
0  17955  194
1    225  418
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96692234, 'precision': 0.8448508, 'recall': 0.66757995, 'specificity': 0.66757995, 'f1': 0.722637, 'auroc': 0.953647, 'binary_precision': 0.7177419, 'binary_recall': 0.34099618, 'binary_specificity': 0.99416375, 'binary_f1_score': 0.46233767}
confusion matrix:
      0   1
0  5962  35
1   172  89
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_2.png
better model found
persisted
after epoch: 2,now: 2024-06-07 07:04:15.765895,epoch time: 0:39:04.441855,used: 1:19:57.924779,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.981572, 'precision': 0.90592504, 'recall': 0.7832948, 'specificity': 0.7832948, 'f1': 0.8328842, 'auroc': 0.9822216, 'binary_precision': 0.82660097, 'binary_recall': 0.57074827, 'binary_specificity': 0.9958414, 'binary_f1_score': 0.6752515}
confusion matrix:
       0    1
0  42146  176
1    631  839
---- Validation: 
scalar performance:
{'acc': 0.9800979, 'precision': 0.9369309, 'recall': 0.7369278, 'specificity': 0.7369278, 'f1': 0.80523527, 'auroc': 0.9793987, 'binary_precision': 0.8921283, 'binary_recall': 0.47589424, 'binary_specificity': 0.99796134, 'binary_f1_score': 0.62068963}
confusion matrix:
       0    1
0  18112   37
1    337  306
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96180886, 'precision': 0.9144669, 'recall': 0.54947495, 'specificity': 0.54947495, 'f1': 0.579572, 'auroc': 0.9546702, 'binary_precision': 0.8666667, 'binary_recall': 0.099616855, 'binary_specificity': 0.999333, 'binary_f1_score': 0.17869414}
confusion matrix:
      0   1
0  5993   4
1   235  26
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_3.png
better model found
persisted
after epoch: 3,now: 2024-06-07 07:43:27.191939,epoch time: 0:39:11.426044,used: 1:59:09.350823,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.984061, 'precision': 0.880417, 'recall': 0.87142897, 'specificity': 0.87142897, 'f1': 0.8758646, 'auroc': 0.98561645, 'binary_precision': 0.7694986, 'binary_recall': 0.7506794, 'binary_specificity': 0.9921786, 'binary_f1_score': 0.7599725}
confusion matrix:
       0     1
0  41989   331
1    367  1105
---- Validation: 
scalar performance:
{'acc': 0.9849404, 'precision': 0.9009328, 'recall': 0.86169386, 'specificity': 0.86169386, 'f1': 0.8802201, 'auroc': 0.98151577, 'binary_precision': 0.8114187, 'binary_recall': 0.7293935, 'binary_specificity': 0.9939942, 'binary_f1_score': 0.7682228}
confusion matrix:
       0    1
0  18040  109
1    174  469
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.964845, 'precision': 0.8702507, 'recall': 0.60969377, 'specificity': 0.60969377, 'f1': 0.6635878, 'auroc': 0.9461316, 'binary_precision': 0.7733333, 'binary_recall': 0.22222222, 'binary_specificity': 0.99716526, 'binary_f1_score': 0.3452381}
confusion matrix:
      0   1
0  5980  17
1   203  58
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_4.png
better model found
persisted
after epoch: 4,now: 2024-06-07 08:22:29.221945,epoch time: 0:39:02.030006,used: 2:38:11.380829,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98239404, 'precision': 0.9278763, 'recall': 0.77811027, 'specificity': 0.77811027, 'f1': 0.8359784, 'auroc': 0.9875983, 'binary_precision': 0.8708995, 'binary_recall': 0.55910325, 'binary_specificity': 0.9971172, 'binary_f1_score': 0.68100953}
confusion matrix:
       0    1
0  42198  122
1    649  823
---- Validation: 
scalar performance:
{'acc': 0.97887397, 'precision': 0.9134775, 'recall': 0.7325438, 'specificity': 0.7325438, 'f1': 0.7958756, 'auroc': 0.9815508, 'binary_precision': 0.8455056, 'binary_recall': 0.4681182, 'binary_specificity': 0.9969695, 'binary_f1_score': 0.6026026}
confusion matrix:
       0    1
0  18094   55
1    342  301
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9614893, 'precision': 0.82802624, 'recall': 0.5676315, 'specificity': 0.5676315, 'f1': 0.60514134, 'auroc': 0.96242833, 'binary_precision': 0.6923077, 'binary_recall': 0.13793103, 'binary_specificity': 0.997332, 'binary_f1_score': 0.23003194}
confusion matrix:
      0   1
0  5981  16
1   225  36
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_5.png
early stop counter: 1
val acc:0.9788739681243896, best validation acc: 0.9849404096603394, corresponding to test acc:                         0.9648450016975403 / 0.9805049300193787
after epoch: 5,now: 2024-06-07 09:01:31.903701,epoch time: 0:39:02.681756,used: 3:17:14.062585,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 6
---- Training Domain: 
scalar performance:
{'acc': 0.9858878, 'precision': 0.921842, 'recall': 0.84778476, 'specificity': 0.84778476, 'f1': 0.8809761, 'auroc': 0.9903143, 'binary_precision': 0.85406303, 'binary_recall': 0.69972825, 'binary_specificity': 0.9958412, 'binary_f1_score': 0.7692308}
confusion matrix:
       0     1
0  42144   176
1    442  1030
---- Validation: 
scalar performance:
{'acc': 0.9826522, 'precision': 0.9142647, 'recall': 0.8012548, 'specificity': 0.8012548, 'f1': 0.8481536, 'auroc': 0.9823266, 'binary_precision': 0.8423326, 'binary_recall': 0.60653186, 'binary_specificity': 0.99597776, 'binary_f1_score': 0.7052441}
confusion matrix:
       0    1
0  18076   73
1    253  390
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.96324706, 'precision': 0.8339045, 'recall': 0.6015307, 'specificity': 0.6015307, 'f1': 0.65032005, 'auroc': 0.95584065, 'binary_precision': 0.7012987, 'binary_recall': 0.20689656, 'binary_specificity': 0.99616474, 'binary_f1_score': 0.31952664}
confusion matrix:
      0   1
0  5974  23
1   207  54
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_6.png
early stop counter: 2
val acc:0.9826521873474121, best validation acc: 0.9849404096603394, corresponding to test acc:                         0.9648450016975403 / 0.9805049300193787
after epoch: 6,now: 2024-06-07 09:40:38.783081,epoch time: 0:39:06.879380,used: 3:56:20.941965,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 7
---- Training Domain: 
scalar performance:
{'acc': 0.98602486, 'precision': 0.9239779, 'recall': 0.8478556, 'specificity': 0.8478556, 'f1': 0.8818753, 'auroc': 0.9908675, 'binary_precision': 0.85833335, 'binary_recall': 0.69972825, 'binary_specificity': 0.995983, 'binary_f1_score': 0.77095807}
confusion matrix:
       0     1
0  42150   170
1    442  1030
---- Validation: 
scalar performance:
{'acc': 0.9833972, 'precision': 0.9314678, 'recall': 0.79789025, 'specificity': 0.79789025, 'f1': 0.8515488, 'auroc': 0.9829414, 'binary_precision': 0.8769932, 'binary_recall': 0.59875584, 'binary_specificity': 0.99702466, 'binary_f1_score': 0.71164507}
confusion matrix:
       0    1
0  18095   54
1    258  385
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9605305, 'precision': 0.7989384, 'recall': 0.5616343, 'specificity': 0.5616343, 'f1': 0.59531087, 'auroc': 0.93376863, 'binary_precision': 0.63461536, 'binary_recall': 0.12643678, 'binary_specificity': 0.9968318, 'binary_f1_score': 0.21086262}
confusion matrix:
      0   1
0  5978  19
1   228  33
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21170270_7.png
early stop counter: 3
val acc:0.9833971858024597, best validation acc: 0.9849404096603394, corresponding to test acc:                         0.9648450016975403 / 0.9805049300193787
after epoch: 7,now: 2024-06-07 10:19:56.437126,epoch time: 0:39:17.654045,used: 4:35:38.596010,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_07_05_44_17_seed_0_21170270
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 8
---- Training Domain: 
slurmstepd: error: *** JOB 21170270 ON gpusrv28 CANCELLED AT 2024-06-07T10:47:19 ***
