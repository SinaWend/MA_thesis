Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Thu Jun  6 23:22:12 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_irm_vit_resnet_dinov2_bs16_lr1e-5_new/rule_results/4.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=4
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'44271c83'
model name: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_06_23_28_22_seed_0_21164309

 Experiment start at: 2024-06-06 23:28:22.625260
before training, model accuracy: 0.955097496509552
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9728718, 'precision': 0.9037879, 'recall': 0.6197454, 'specificity': 0.6197454, 'f1': 0.6801067, 'auroc': 0.965328, 'binary_precision': 0.8333333, 'binary_recall': 0.24116848, 'binary_specificity': 0.9983223, 'binary_f1_score': 0.374078}
confusion matrix:
       0    1
0  42249   71
1   1117  355
---- Validation: 
scalar performance:
{'acc': 0.97227544, 'precision': 0.95726407, 'recall': 0.6008683, 'specificity': 0.6008683, 'f1': 0.6593751, 'auroc': 0.9677054, 'binary_precision': 0.942029, 'binary_recall': 0.2021773, 'binary_specificity': 0.9995592, 'binary_f1_score': 0.33290654}
confusion matrix:
       0    1
0  18141    8
1    513  130
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9582934, 'precision': 0.4791467, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48935127, 'auroc': 0.9602046, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   261  0
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21164309_1.png
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-06-06 23:49:23.740904,epoch time: 0:21:01.115644,used: 0:21:01.115644,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_06_23_28_22_seed_0_21164309
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.9722095, 'precision': 0.9374641, 'recall': 0.5967805, 'specificity': 0.5967805, 'f1': 0.6527734, 'auroc': 0.9790764, 'binary_precision': 0.9022082, 'binary_recall': 0.19429348, 'binary_specificity': 0.99926746, 'binary_f1_score': 0.3197317}
confusion matrix:
       0    1
0  42289   31
1   1186  286
---- Validation: 
scalar performance:
{'acc': 0.96902937, 'precision': 0.94351864, 'recall': 0.55193424, 'specificity': 0.55193424, 'f1': 0.5856824, 'auroc': 0.97403896, 'binary_precision': 0.91780823, 'binary_recall': 0.10419907, 'binary_specificity': 0.99966943, 'binary_f1_score': 0.18715082}
confusion matrix:
       0   1
0  18143   6
1    576  67
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9582934, 'precision': 0.4791467, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48935127, 'auroc': 0.95542806, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   261  0
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21164309_2.png
early stop counter: 1
val acc:0.9690293669700623, best validation acc: 0.97227543592453, corresponding to test acc:                         0.9582933783531189 / 0.9582933783531189
after epoch: 2,now: 2024-06-07 00:09:40.531621,epoch time: 0:20:16.790717,used: 0:41:17.906361,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_06_23_28_22_seed_0_21164309
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.979631, 'precision': 0.8884393, 'recall': 0.764222, 'specificity': 0.764222, 'f1': 0.8136069, 'auroc': 0.9750943, 'binary_precision': 0.7929293, 'binary_recall': 0.53328806, 'binary_specificity': 0.99515593, 'binary_f1_score': 0.6376929}
confusion matrix:
       0    1
0  42115  205
1    687  785
---- Validation: 
scalar performance:
{'acc': 0.9792997, 'precision': 0.9017104, 'recall': 0.75076556, 'specificity': 0.75076556, 'f1': 0.80747855, 'auroc': 0.97154343, 'binary_precision': 0.8207071, 'binary_recall': 0.5054432, 'binary_specificity': 0.99608797, 'binary_f1_score': 0.62560153}
confusion matrix:
       0    1
0  18078   71
1    318  325
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9582934, 'precision': 0.4791467, 'recall': 0.5, 'specificity': 0.5, 'f1': 0.48935127, 'auroc': 0.9378699, 'binary_precision': 0.0, 'binary_recall': 0.0, 'binary_specificity': 1.0, 'binary_f1_score': 0.0}
confusion matrix:
      0  1
0  5997  0
1   261  0
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21164309_3.png
better model found
persisted
after epoch: 3,now: 2024-06-07 00:29:37.357656,epoch time: 0:19:56.826035,used: 1:01:14.732396,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_06_23_28_22_seed_0_21164309
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 4
---- Training Domain: 
scalar performance:
{'acc': 0.9808413, 'precision': 0.8351731, 'recall': 0.9047842, 'specificity': 0.9047842, 'f1': 0.86638355, 'auroc': 0.9848393, 'binary_precision': 0.6765363, 'binary_recall': 0.8232495, 'binary_specificity': 0.9863188, 'binary_f1_score': 0.74271697}
confusion matrix:
       0     1
0  41742   579
1    260  1211
---- Validation: 
scalar performance:
{'acc': 0.9820668, 'precision': 0.85265326, 'recall': 0.89320856, 'specificity': 0.89320856, 'f1': 0.87172365, 'auroc': 0.9808283, 'binary_precision': 0.7125, 'binary_recall': 0.7978227, 'binary_specificity': 0.9885944, 'binary_f1_score': 0.7527513}
confusion matrix:
       0    1
0  17942  207
1    130  513
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9613295, 'precision': 0.8327093, 'recall': 0.5620512, 'specificity': 0.5620512, 'f1': 0.5972314, 'auroc': 0.96213675, 'binary_precision': 0.70212764, 'binary_recall': 0.12643678, 'binary_specificity': 0.9976655, 'binary_f1_score': 0.21428573}
confusion matrix:
      0   1
0  5983  14
1   228  33
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21164309_4.png
new oracle model saved
better model found
persisted
after epoch: 4,now: 2024-06-07 00:49:32.091295,epoch time: 0:19:54.733639,used: 1:21:09.466035,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_06_23_28_22_seed_0_21164309
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
epoch: 5
---- Training Domain: 
scalar performance:
{'acc': 0.98004204, 'precision': 0.95888287, 'recall': 0.71703106, 'specificity': 0.71703106, 'f1': 0.7920064, 'auroc': 0.9876058, 'binary_precision': 0.9370425, 'binary_recall': 0.43507817, 'binary_specificity': 0.998984, 'binary_f1_score': 0.5942433}
confusion matrix:
       0    1
0  42278   43
1    831  640
---- Validation: 
scalar performance:
{'acc': 0.9766922, 'precision': 0.94791496, 'recall': 0.6744101, 'specificity': 0.6744101, 'f1': 0.7474104, 'auroc': 0.97550046, 'binary_precision': 0.9183673, 'binary_recall': 0.34992224, 'binary_specificity': 0.998898, 'binary_f1_score': 0.5067568}
confusion matrix:
       0    1
0  18129   20
1    418  225
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.9584532, 'precision': 0.97922325, 'recall': 0.5019157, 'specificity': 0.5019157, 'f1': 0.49320802, 'auroc': 0.94119585, 'binary_precision': 1.0, 'binary_recall': 0.0038314175, 'binary_specificity': 1.0, 'binary_f1_score': 0.007633588}
confusion matrix:
      0  1
0  5997  0
1   260  1
t-SNE plot saved as /localscratch/sina.wendrich/tsne/t-SNE_Test_center0_21164309_5.png
early stop counter: 1
val acc:0.9766921997070312, best validation acc: 0.982066810131073, corresponding to test acc:                         0.9613295197486877 / 0.9613295197486877
after epoch: 5,now: 2024-06-07 01:09:13.877517,epoch time: 0:19:41.786222,used: 1:40:51.252257,model: dset_te_center0_erm_b44271c83_not_commited_2024md_06md_06_23_28_22_seed_0_21164309
working direcotry: /ictstr01/groups/aih/sina.wendrich/MA_code/MA_thesis/DomainLab
slurmstepd: error: *** JOB 21164309 ON supergpu14 CANCELLED AT 2024-06-07T01:14:50 ***
