Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 2
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, nvidia_gpu=1
Select jobs to execute...

[Fri Jul 26 23:51:38 2024]
rule run_experiment:
    input: zoutput/benchmarks/CAMELYON_center0_dinov2small_erm_lr__2024-07-26_11-44-51/hyperparameters.csv
    output: zoutput/benchmarks/CAMELYON_center0_dinov2small_erm_lr__2024-07-26_11-44-51/rule_results/7.csv
    jobid: 0
    reason: Forced execution
    wildcards: index=7
    resources: mem_mb=100000, mem_mib=95368, disk_mb=1000, disk_mib=954, tmpdir=/tmp, partition=gpu_p, qos=gpu_normal, nvidia_gpu=1

Failed to import backpack: cannot import name '_grad_input_padding' from 'torch.nn.grad' (/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/grad.py)
before experiment loop: 
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

before experiment starts
|===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Active memory         |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Requested memory      |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| GPU reserved memory   |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Non-releasable memory |      0 B   |      0 B   |      0 B   |      0 B   |
|       from large pool |      0 B   |      0 B   |      0 B   |      0 B   |
|       from small pool |      0 B   |      0 B   |      0 B   |      0 B   |
|---------------------------------------------------------------------------|
| Allocations           |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       0    |       0    |       0    |       0    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|


overriding args.task None to dset


using device: cuda:0

Using cache found in /home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/swiglu_ffn.py:51: UserWarning: xFormers is not available (SwiGLU)
  warnings.warn("xFormers is not available (SwiGLU)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/attention.py:33: UserWarning: xFormers is not available (Attention)
  warnings.warn("xFormers is not available (Attention)")
/home/aih/sina.wendrich/.cache/torch/hub/facebookresearch_dinov2_main/dinov2/layers/block.py:40: UserWarning: xFormers is not available (Block)
  warnings.warn("xFormers is not available (Block)")
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/_reduction.py:42: UserWarning: size_average and reduce args will be deprecated, please use reduction='sum' instead.
  warnings.warn(warning.format(ret))
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torchmetrics/utilities/prints.py:36: UserWarning: Metric `AUROC` will save all targets and predictions in buffer. For large datasets this may lead to large memory footprint.
  warnings.warn(*args, **kwargs)



!!!: not committed yet
/ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab/domainlab/utils/get_git_tag.py:16: UserWarning: !!!: not committed yet
  warnings.warn("!!!: not committed yet")



b'8efecac6'
model name: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_27_00_01_59_seed_0_23070008

 Experiment start at: 2024-07-27 00:01:59.323306
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
before training, model accuracy: 0.7297859191894531
epoch: 1
---- Training Domain: 
scalar performance:
{'acc': 0.9909687, 'precision': 0.9880476, 'recall': 0.988372, 'specificity': 0.988372, 'f1': 0.9882097, 'auroc': 0.99902487, 'binary_precision': 0.98200583, 'binary_recall': 0.9830071, 'binary_specificity': 0.993737, 'binary_f1_score': 0.9825062}
confusion matrix:
       0      1
0  42047    265
1    250  14462
---- Validation: 
/home/aih/sina.wendrich/miniconda3/envs/domainlab_py310/lib/python3.10/site-packages/torch/nn/modules/conv.py:456: UserWarning: Plan failed with a cudnnException: CUDNN_BACKEND_EXECUTION_PLAN_DESCRIPTOR: cudnnFinalize Descriptor Failed cudnn_status: CUDNN_STATUS_NOT_SUPPORTED (Triggered internally at /opt/conda/conda-bld/pytorch_1712608935911/work/aten/src/ATen/native/cudnn/Conv_v8.cpp:919.)
  return F.conv2d(input, weight, bias, self.stride,
scalar performance:
{'acc': 0.93960196, 'precision': 0.6592715, 'recall': 0.83972156, 'specificity': 0.83972156, 'f1': 0.7107866, 'auroc': 0.9383507, 'binary_precision': 0.32845187, 'binary_recall': 0.7325039, 'binary_specificity': 0.94693923, 'binary_f1_score': 0.45353875}
confusion matrix:
       0    1
0  17186  963
1    172  471
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.95238096, 'precision': 0.7170837, 'recall': 0.80291486, 'specificity': 0.80291486, 'f1': 0.75170267, 'auroc': 0.90810907, 'binary_precision': 0.45013478, 'binary_recall': 0.63984674, 'binary_specificity': 0.965983, 'binary_f1_score': 0.528481}
confusion matrix:
      0    1
0  5793  204
1    94  167
new oracle model saved
better model found
persisted
after epoch: 1,now: 2024-07-27 00:28:04.835013,epoch time: 0:26:05.511707,used: 0:26:05.511707,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_27_00_01_59_seed_0_23070008
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 2
---- Training Domain: 
scalar performance:
{'acc': 0.99451107, 'precision': 0.99547863, 'recall': 0.9901852, 'specificity': 0.9901852, 'f1': 0.99279475, 'auroc': 0.99935913, 'binary_precision': 0.9974442, 'binary_recall': 0.9812449, 'binary_specificity': 0.9991255, 'binary_f1_score': 0.9892782}
confusion matrix:
       0      1
0  42271     37
1    276  14440
---- Validation: 
scalar performance:
{'acc': 0.96753937, 'precision': 0.7567972, 'recall': 0.6906731, 'specificity': 0.6906731, 'f1': 0.718339, 'auroc': 0.93122715, 'binary_precision': 0.53488374, 'binary_recall': 0.3934681, 'binary_specificity': 0.98787814, 'binary_f1_score': 0.453405}
confusion matrix:
       0    1
0  17929  220
1    390  253
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.964046, 'precision': 0.82792723, 'recall': 0.6239355, 'specificity': 0.6239355, 'f1': 0.6756215, 'auroc': 0.8984349, 'binary_precision': 0.6875, 'binary_recall': 0.25287357, 'binary_specificity': 0.9949975, 'binary_f1_score': 0.3697479}
confusion matrix:
      0   1
0  5967  30
1   195  66
new oracle model saved
better model found
persisted
after epoch: 2,now: 2024-07-27 00:53:15.804785,epoch time: 0:25:10.969772,used: 0:51:16.481479,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_27_00_01_59_seed_0_23070008
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
epoch: 3
---- Training Domain: 
scalar performance:
{'acc': 0.99430066, 'precision': 0.9912533, 'recall': 0.99392045, 'specificity': 0.99392045, 'f1': 0.99257725, 'auroc': 0.9996606, 'binary_precision': 0.9849006, 'binary_recall': 0.99313486, 'binary_specificity': 0.994706, 'binary_f1_score': 0.98900056}
confusion matrix:
       0      1
0  42088    224
1    101  14611
---- Validation: 
scalar performance:
{'acc': 0.95913154, 'precision': 0.7058133, 'recall': 0.7710765, 'specificity': 0.7710765, 'f1': 0.73335814, 'auroc': 0.9334594, 'binary_precision': 0.42707118, 'binary_recall': 0.56920683, 'binary_specificity': 0.97294617, 'binary_f1_score': 0.48799998}
confusion matrix:
       0    1
0  17658  491
1    277  366
---- Test Domain (oracle): 
scalar performance:
{'acc': 0.970278, 'precision': 0.8415948, 'recall': 0.74262416, 'specificity': 0.74262416, 'f1': 0.7828368, 'auroc': 0.90518695, 'binary_precision': 0.704918, 'binary_recall': 0.49425286, 'binary_specificity': 0.9909955, 'binary_f1_score': 0.5810811}
confusion matrix:
      0    1
0  5943   54
1   132  129
new oracle model saved
early stop counter: 1
val acc:0.9591315388679504, best validation acc: 0.967539370059967, corresponding to test acc:                         0.9640460014343262 / 0.9702780246734619
after epoch: 3,now: 2024-07-27 01:19:19.368505,epoch time: 0:26:03.563720,used: 1:17:20.045199,model: dset_te_center0_erm_b8efecac6_not_commited_2024md_07md_27_00_01_59_seed_0_23070008
working direcotry: /ictstr01/home/aih/sina.wendrich/MA_thesis/DomainLab
slurmstepd: error: *** JOB 23070008 ON supergpu02 CANCELLED AT 2024-07-27T01:19:20 ***
